<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="反爬虫详解, JackHCC">
    <meta name="description" content="反爬虫机制与方法详解">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>反爬虫详解 | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">反爬虫详解</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Crawler/">
                                <span class="chip bg-color">Crawler</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Basic/" class="post-category">
                                Basic
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-11-06
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    12.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    46 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="了解反爬虫"><a href="#了解反爬虫" class="headerlink" title="了解反爬虫"></a>了解反爬虫</h1><p>我们现在处于一个信息爆炸的大数据时代，数据在互联网上的传播和呈现方式多种多样，越来越多的公司开始重视保护自己的数据了，他们研发反爬虫技术，让爬虫不在可以随便的去爬取获取他们的信息。</p>
<p>如果你想要更好的获取数据，那么反爬虫的知识也需要有一定程度上的研究，当你掌握反爬虫的知识后，将会让你的爬虫更好的绕过反爬虫。</p>
<h3 id="反爬虫的概念和定义"><a href="#反爬虫的概念和定义" class="headerlink" title="反爬虫的概念和定义"></a>反爬虫的概念和定义</h3><p>反爬虫概念的理解是：一切限制爬虫程序从服务器获取数据的方式都属于反爬虫。它有多种限制手段，如：限制请求头、限制登陆、验证码检验、限制访问频率等。</p>
<p>从这些限制手段出发，可以将反爬虫分为主动型和被动型，两种类型。</p>
<p>开发者使用一些技术手段来区分正常用户和爬虫被称为主动型反爬虫，通常有限制请求头、限制访问频率、限制登陆等方式。</p>
<p>为了提高用户体验或节约资源，用一些技术间接提高爬虫访问难度被称为被动型反爬虫，通常有Ajax数据加载、点击切换标签页等方式。</p>
<p>当然，也可以从其他方面对反爬虫进行更加细化的划分，我们这里不在做详细的讲述，需要注意的是，同一种限制方式，可能属于不同的反爬虫技术类型，比如由JS加载的数据，我们可以说成动态渲染反爬虫，也可以说成是信息检验型反爬虫，所以我们在学习的时候，遇到这类情况时，知道怎么回事即可。</p>
<h3 id="爬虫和反爬虫的对立关系"><a href="#爬虫和反爬虫的对立关系" class="headerlink" title="爬虫和反爬虫的对立关系"></a>爬虫和反爬虫的对立关系</h3><p>我们通过下图来了解爬虫和反爬虫之间即针锋相对，又互相进步的关系。（从左至右，从上至下发展）</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106191453595.png" alt=""></p>
<p>反爬虫不仅要会技术，同时也需要金钱进行支撑。我们有时需要购买代理IP或者开通VIP账户等，如果爬取数据量较大时，这些将是一笔不菲的开支。同时，在研究如何破解反爬虫时，还会消耗我们大量的时间，这也是需要计算的成本。</p>
<h1 id="信息校验型"><a href="#信息校验型" class="headerlink" title="信息校验型"></a>信息校验型</h1><h2 id="签名验证反爬虫的原理和绕过方法"><a href="#签名验证反爬虫的原理和绕过方法" class="headerlink" title="签名验证反爬虫的原理和绕过方法"></a>签名验证反爬虫的原理和绕过方法</h2><p>信息校验反爬虫的方式主要是服务器对请求发起者的身份或者合法性进行判断，从而来进行反爬限制。只要我们在发送请求时将自己伪装好，即可绕过这类反爬虫。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>签名是一个根据数据源进行计算或者加密的过程，用户经过签名后会一个具有一致性和唯一性的字符串，它就是你访问服务器的身份象征。由它的一致性和唯一性这两种特性，从而可以有效的避免服务器端，将伪造的数据或被篡改的数据当初正常数据处理。</p>
<p>用于签名验证的信息通常被放在请求正文中发送到服务器端。如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106191554539.png" alt=""></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>签名验证反爬虫有多种实现方式，但是它的实现原理都是相同的，都是由客户端生成一些，随机值和不可逆的MD5加密字符串，在发起请求的同时，将这些值一同发送到服务器端。然后服务器端使用相同的方式对随机值进行计算和MD5加密，如果服务器端得到的MD5值与前端提交的MD5值相等，就代表是正常的请求，否则报错。部分代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> hashlib

<span class="token keyword">def</span> <span class="token function">Hex5</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 使用 MD5 加密值并返回加密后的字符串</span>

   manipulator <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
   manipulator<span class="token punctuation">.</span>update<span class="token punctuation">(</span>value<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> manipulator<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">Comparison</span><span class="token punctuation">(</span><span class="token punctuation">,</span> actions<span class="token punctuation">,</span> tim<span class="token punctuation">,</span> randstr<span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 根据 MD5 加密值，并与客户端提交的 MD5 值进行比对</span>

   value <span class="token operator">=</span> actions <span class="token operator">+</span> tim <span class="token operator">+</span> randstr
   hexs <span class="token operator">=</span> Hex5<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
   <span class="token keyword">if</span> sign <span class="token operator">==</span> hexs<span class="token punctuation">:</span>
       returnTrue
   returnFalse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><p>现在签名验证反爬虫已经被广泛应用于Web领域，当我们在发起请求时，发现正文中含有一些随机的字符串时，我们就要考虑目标网站可能采用了签名验证反爬虫。</p>
<p>大部分签名验证反爬虫的正文信息，都是由JavaScript进行计算的，我们在遇到它时，去JS页面中寻找相应的JS文件，从而发现它的加密方式，进而来绕过它。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>签名验证是一种较为高级的反爬虫方式，主要是通过JavaScript来生成随机字符串、多字段组合等方式来对请求进行加密。</p>
</li>
<li><p>个人感觉它是Ajax异步加载的更高级形式。绕过它不仅要在XHR中寻找请求信息，也要在JS中寻找加密的方式。</p>
</li>
<li><p>目前这种反爬虫方法已经被各类大型网站所应用，所以大家要掌握这种反爬虫的绕过方法。</p>
</li>
</ol>
<h2 id="User-Agent反爬虫的原理和绕过方法"><a href="#User-Agent反爬虫的原理和绕过方法" class="headerlink" title="User-Agent反爬虫的原理和绕过方法"></a>User-Agent反爬虫的原理和绕过方法</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>User-Agent是一种请求头，服务器可以从User-Agent对应的值中来识别用户端使用的操作系统、浏览器、浏览器引擎、操作系统语言等等。</p>
<p>浏览器User-Agent通常由浏览器标识、渲染引擎标识、版本信息这三部分来构成。我们可以在这个位置来查看我们的User-Agent请求头值。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106191812493.png" alt=""></p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>我们通过浏览器来获取数据的方式是这样的：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106191832090.png" alt=""></p>
<p>我们通过爬虫来获取数据的方式是这样的：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106191846730.png" alt=""></p>
<p>所以，我们的爬虫程序，实际上是模拟浏览器对服务器发送请求来获取数据的。</p>
<p>在向服务器发送的网络请求中，User-Agent是客户端用于表明身份的一种标识。所以，反爬虫工程师可以将一些爬虫程序的请求头放入服务器访问的黑名单中，当有网络请求时通过检测User-Agent请求头域值来判断客户端的类型，将其与黑名单中数据进行比对，一致时则拒绝其访问，从而有效的限制一些爬虫程序。</p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106191902673.png" style="zoom:67%;">

<h3 id="绕过-1"><a href="#绕过-1" class="headerlink" title="绕过"></a>绕过</h3><p>User-Agent请求头域的值是可以修改的。Requests.get（）请求中有一个headers参数，可以将我们修改后的User-Agent加入，然后将爬虫程序伪装成浏览器，以此来骗过反爬虫程序。伪装代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
   <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=0'</span><span class="token punctuation">,</span>
   <span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span> <span class="token string">'"Google Chrome";v="89", "Chromium";v="89", ";Not A Brand";v="99"'</span><span class="token punctuation">,</span>
   <span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span> <span class="token string">'?0'</span><span class="token punctuation">,</span>
   <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
   <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36'</span><span class="token punctuation">,</span>
   <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'navigate'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-User'</span><span class="token punctuation">:</span> <span class="token string">'?1'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'document'</span><span class="token punctuation">,</span>
   <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://bj.ke.com/'</span><span class="token punctuation">,</span>
   <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>User-Agent检验是一种最为初级的反爬虫方式，主要是通过服务器黑名单来限制爬虫的反爬虫方式。</p>
</li>
<li><p>对于有一定基础的小伙伴来说，这种方式基本不能够限制大家。</p>
</li>
<li><p>现在很多网站基于User-Agent检验上又增加了访问频率限制，即同一User-Agent在单位时间内访问频率过高，也会默认是爬虫，从而拉入黑名单，所以我们如果要大量需要的话，可以尝试搭建一个User-Agen池，来更好的伪装自己。</p>
</li>
</ol>
<h1 id="文本混淆"><a href="#文本混淆" class="headerlink" title="文本混淆"></a>文本混淆</h1><p>文本混淆反爬虫大多是利用CSS来进行限制爬虫，这类反爬虫使得我们无法借助一些渲染工具来获取目的数据。遇到这类反爬虫，我们需要去理解它的反爬原理，写出爬虫绕过逻辑，并用代码来实现这个逻辑，从而破解这类反爬虫。</p>
<h2 id="SVG映射反爬虫的原理和破解方法"><a href="#SVG映射反爬虫的原理和破解方法" class="headerlink" title="SVG映射反爬虫的原理和破解方法"></a>SVG映射反爬虫的原理和破解方法</h2><blockquote>
<p>SVG是用于描述二维矢量图形的一种图形格式。它基于XML描述图形，对图形进行放大或缩小操作都不会影响图形质量。</p>
</blockquote>
<ul>
<li>SVG图形</li>
</ul>
<img src="/images/loading.gif" data-original="../images/language/image-20211106192045552.png" style="zoom:50%;">

<p>这种反爬虫手段是通过映射的方式，来使SVG图形代替具体的文字。这并不会影响用户的正常阅读，但是爬虫程序因为没有映射关系，所以无法像网页一样正常获取SVG图形中的内容，从而导致无法获取网页数据。</p>
<p>从上面我们知道，这种反爬虫手段是通过映射的方式建立的，那么这种映射关系是通过怎样的方式进行建立的呢？那这就得学习一下SVG反爬虫的原理了。</p>
<h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>这种反爬虫主要是网站开发者利用CSS样式的特性，使得HTML标签和SVG图形之间形成一种独特的映射关系，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192115722.png" alt=""></p>
<p>然后根据这种映射关系，使得网页中的HTML标签，从SVG图形中取出相应的数据。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192130556.png" alt=""></p>
<p>这样就使得网站开发者进行网页设计时，只需要使用HTML标签进行占位即可，不需要将真正的数据放到页面中去。这样，爬虫程序如果不知道这种映射关系的话，就无法从SVG图形中获取正确的数据，从而实现反爬虫。</p>
<h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h3><p>破解这类反爬虫的关键是找到HTML标签与SVG图形之间的映射关系，只要找到了映射关系，那么我们就可以用Python实现映射算法，进而通过该算法，获取到真正的数据。</p>
<h4 id="1-观察HTML标签"><a href="#1-观察HTML标签" class="headerlink" title="1. 观察HTML标签"></a>1. 观察HTML标签</h4><p>我们按F12打开开发者模式来对网页进行观察，我们发现占位的标签是标签，并通过class的值来进行映射的，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192156726.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192206147.png" alt=""></p>
<h4 id="2-寻找映射关系"><a href="#2-寻找映射关系" class="headerlink" title="2. 寻找映射关系"></a>2. 寻找映射关系</h4><p>从原理中，我们知道映射关系是利用CSS样式来构造的，并且我们在对HTML标签观察时已经发现了占位标签和映射值的样式，所以我们在开发者模式中对CSS样式进行查看，最终在food.css文件中找到了映射关系，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192221655.png" alt=""></p>
<h4 id="3-下载SVG图形"><a href="#3-下载SVG图形" class="headerlink" title="3.下载SVG图形"></a>3.下载SVG图形</h4><p>在上面，我们通过对网页和CSS样式的观察，成功的找到了映射关系，那么现在需要把SVG图形给下载下来。</p>
<p>我们找到它映射的背景图片是在一个food.svg文件中，那我们把该图形下载下来，如下图：</p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106192239013.png" style="zoom:50%;">

<h4 id="4-构建映射算法"><a href="#4-构建映射算法" class="headerlink" title="4. 构建映射算法"></a>4. 构建映射算法</h4><p>在上面我们已经找到了，映射关系和SVG图形，那么我们现在就可以开始用Python来构建映射算法，从而使得爬虫可以获取一个正确的数据。</p>
<p>我们现在有两种方法来进行构建：</p>
<ul>
<li><p>程序构建法</p>
<blockquote>
<p>此方法适用于映射数量较多且映射关系较为复杂的网页。</p>
</blockquote>
<p>有些网站，因为子页面较多，页面排版不一样，所以它会使用多个CSS样式和SVG图形，依次来方便页面排版，但是它们的映射算法是不变的，此时使用程序来计算获取每个class值对应的数字是最为方便的。</p>
<p>那么如何来计算映射算法呢，我给大家总结了一个公式，大家只要牢记这个公式就可以很快的构建好映射算法了。</p>
</li>
<li><p>SVG图形的x轴坐标计算方法：字体大小/2+该字符的x轴起点位置</p>
</li>
<li><p>代码如下：</p>
</li>
<li><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 求svg转化成css的x坐标</span>
    svg_x_css <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>svg_x_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        svg_x_css<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span>j<span class="token operator">*</span><span class="token number">14</span><span class="token punctuation">)</span>
    ```<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>SVG图形的y轴坐标计算方法：（字体大小-该字符的y轴起点位置-字体大小）/2+该字符的y轴起点位置+字体大小/2</p>
</li>
<li><p>代码如下：</p>
</li>
<li><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 求svg转化成css的y坐标</span>
    a <span class="token operator">=</span> <span class="token number">0</span><span class="token comment" spellcheck="true"># a的作用是为了存储上一个y坐标的值</span>
    svg_y_css <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> svg_x_y<span class="token punctuation">:</span>
        j <span class="token operator">=</span> float<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        svg_y_css<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token number">-14</span><span class="token operator">-</span>a<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>a<span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
        a <span class="token operator">=</span> j
    ```<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>然后将SVG图形转化的坐标与CSS样式的坐标进行比对，即可求出映射值：</p>
</li>
<li><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 让css和svg转化的坐标进行比对，求出css对应svg中的位置。</span>
   <span class="token keyword">for</span> i <span class="token keyword">in</span> css_x_y<span class="token punctuation">:</span>
       a<span class="token operator">=</span>b<span class="token operator">=</span><span class="token number">0</span><span class="token comment" spellcheck="true"># a是x坐标轴对应的位置，b是y坐标轴对应的位置</span>
       x <span class="token operator">=</span> int<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       y <span class="token operator">=</span> int<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> j <span class="token keyword">in</span> svg_x_css<span class="token punctuation">:</span>
           <span class="token keyword">if</span> x <span class="token operator">>=</span> j<span class="token punctuation">:</span>
               a<span class="token operator">+=</span><span class="token number">1</span>
           <span class="token keyword">else</span><span class="token punctuation">:</span>
               <span class="token keyword">break</span>
       <span class="token keyword">for</span> k <span class="token keyword">in</span> svg_y_css<span class="token punctuation">:</span>
           <span class="token keyword">if</span> y <span class="token operator">>=</span> k<span class="token punctuation">:</span>
               b<span class="token operator">+=</span><span class="token number">1</span>
           <span class="token keyword">else</span><span class="token punctuation">:</span>
               <span class="token keyword">break</span>
       <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
           b<span class="token operator">=</span><span class="token number">1</span>
   ```<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>页面构建法</p>
<blockquote>
<p>此方法适用于映射数量较少且映射关系较为简单的网页。</p>
</blockquote>
<p>当网页页面较少时，CSS样式和SVG图形就会较少，甚至只有一个，此时，我们可以将SVG图形下载下来，并将CSS样式copy到本地，然后将背景图形替换成下载的SVG图形，从而找出映射关系，进行构建。</p>
</li>
</ul>
<h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了如何破解SVG映射反爬虫，这种反爬虫即使使用一些自动化软件或者渲染工具也无法获得真正的数据。</p>
</li>
<li><p>这类反爬虫的破解需要掌握前端的知识，所以对爬虫工程师的综合能力要求较高。</p>
</li>
<li><p>CSS样式的x、y轴的正方向与SVG图形的x、y轴正方向是相反的，大家在实战中就明白这个定义的用处了。</p>
</li>
</ol>
<h2 id="CSS偏移反爬虫的原理和破解方法"><a href="#CSS偏移反爬虫的原理和破解方法" class="headerlink" title="CSS偏移反爬虫的原理和破解方法"></a>CSS偏移反爬虫的原理和破解方法</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>在搭建网页的时候，我们需要用CSS来控制各类字符的位置，也正是如此，我们可以利用CSS来将浏览器中显示的文字，在HTML中以乱序的方式存储，从而来限制爬虫。如下图，我们发现浏览器中实际显示的是1226，但是HTML中显示的是1262。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192513807.png" alt=""></p>
<p>接下来，我们通过一个例子来了解绕过CSS偏移反爬虫的方法。</p>
<h3 id="绕过-2"><a href="#绕过-2" class="headerlink" title="绕过"></a>绕过</h3><p>从下图中我们看出机票价格的数据被包裹在一个&lt;span&gt;标签中，标签大小是64px。如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192540528.png" alt=""></p>
<p>进一步对网页进行观察发现，&lt;span&gt;标签中有五个&lt;b&gt;标签，它们每一对&lt;b&gt;标签都有特定的样式。如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192609236.png" alt=""></p>
<p>我们用这些CSS样式来进行分析的话，我们发现，第一对&lt;b&gt;标签中的四对&lt;i&gt;标签刚好占满了&lt;span&gt;标签的位置。如下图所示：</p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106192620597.png" style="zoom:67%;">

<p>浏览器中，本应显示的是5377，因为第二、三、四、五对&lt;b&gt;标签中有值，所以我们还需要看一下他们的位置。</p>
<p>第二对的&lt;b&gt;标签的位置样式是left:-64px,所以第二对&lt;b&gt;标签中的1就会覆盖第一对&lt;b&gt;标签中第一对&lt;i&gt;标签中的5；第三对的&lt;b&gt;标签的位置样式是left:-32px,第三对&lt;b&gt;标签中的2会覆盖第一对&lt;b&gt;标签中第三对&lt;i&gt;标签中的7。依次类推，第四对&lt;b&gt;标签中的6会覆盖第一对&lt;b&gt;标签中第四对&lt;i&gt;标签中的7，第五对&lt;b&gt;标签中的2会覆盖第一对&lt;b&gt;标签中第二对&lt;i&gt;标签中的3。</p>
<p>通过上面的分析，我们发现，CSS偏移反爬虫其实就是让几个数据由CSS控制位置，来对原数据进行覆盖，从而实现反爬效果。</p>
<p>那么当我们遇到这类反爬虫的时候，首先就需要对页面的CSS进行观察分析，找到偏移量的计算规律，然后提取出每个标签中left的值，根据规律来排列出真实的数据。</p>
<h3 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>CSS偏移反爬虫实质上是通过CSS样式来控制数据在页面中显示的位置，从而将乱序的数据以正常的形式展示给用户。</p>
</li>
<li><p>破解这种反爬虫的难度并不大，主要是找到位置偏移的计算方法，而且代码书写可能较为繁琐，读者们可以提前写好流程图，然后在进行书写。</p>
</li>
<li><p>目前这种反爬虫方法主要是针对于数字数据的反爬。</p>
</li>
</ol>
<h2 id="图片伪装反爬虫的原理和破解方法"><a href="#图片伪装反爬虫的原理和破解方法" class="headerlink" title="图片伪装反爬虫的原理和破解方法"></a>图片伪装反爬虫的原理和破解方法</h2><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><p>现在许多大型网站的反爬虫方式是将图片与文字混合在一起，放到页面上进行展示。这种混合展示的方式并不会影响用户的正常阅读，但是却可以限制爬虫程序获取这些内容。如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192831045.png" alt=""></p>
<h3 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h3><p>这种反爬虫的原理十分简单，就是将本应是普通文本内容的部分在前端页面中用图片来进行替换，从而达到“鱼目混珠“的效果。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106192848657.png" alt=""></p>
<h3 id="破解-1"><a href="#破解-1" class="headerlink" title="破解"></a>破解</h3><p>因为这种反爬虫方式是将内容进行替换，所以我们无法进行绕过，只能破解它来获取我们想要的内容。</p>
<p>破解的方法也比较简单，我们只需要将图片下载下来然后对里面的内容进行提取即可。提取图片中的文字有很多方式，我用的是百度AI来进行提取。代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> aip <span class="token keyword">import</span> AipOcr

APP_ID <span class="token operator">=</span> <span class="token string">'你的APPID'</span>
API_KEY <span class="token operator">=</span> <span class="token string">'API Key'</span>
SECRET_KEY <span class="token operator">=</span> <span class="token string">'你的Secret Key'</span>
client <span class="token operator">=</span> AipOcr<span class="token punctuation">(</span>APP_ID<span class="token punctuation">,</span> API_KEY<span class="token punctuation">,</span> SECRET_KEY<span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  image <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
word <span class="token operator">=</span> client<span class="token punctuation">.</span>basicGeneral<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>图片伪装反爬虫的本质就是用图片替换了原来的内容，从而让爬虫程序无法正常获取，我们只要将里面的内容识别、提取出来就可以破解这种反爬虫。</p>
</li>
<li><p>破解这种反爬虫的难度并不大，但是代码书写可能较为繁琐，读者们可以提前写好流程图，然后在进行书写。</p>
</li>
<li><p>目前这种反爬虫方法已经被各类大型网站所应用，所以大家要掌握这种反爬虫的绕过方法。</p>
</li>
</ol>
<h2 id="字体反爬虫的原理和破解方法"><a href="#字体反爬虫的原理和破解方法" class="headerlink" title="字体反爬虫的原理和破解方法"></a>字体反爬虫的原理和破解方法</h2><h3 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h3><p>在之前，网站开发者在设计网页时只能使用公用的字体来展示网页中的数据。</p>
<p>但是，随着CSS样式的深入开发，网站开发者可以将自己的字体放到服务器中。当用户在访问Web界面时，对应的字体就会被浏览器自动下载到用户的计算机中，然后通过CSS样式进行调用。</p>
<p>之后，通过一种映射关系，使得网页中的源数据变为真正的数据进行展示。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193035188.png" alt=""></p>
<p>通过这种方式，使得这样就使得网站开发者进行网页设计时，只需要使用特殊字符进行占位即可，不需要将真正的数据放到页面中去。这样，爬虫程序如果不知道这种映射关系的话，就无法从字体中获取正确的数据，从而实现反爬虫。</p>
<h3 id="破解-2"><a href="#破解-2" class="headerlink" title="破解"></a>破解</h3><p>破解这类字体反爬虫有以下几步。</p>
<h4 id="1-下载字体woff文件"><a href="#1-下载字体woff文件" class="headerlink" title="1. 下载字体woff文件"></a>1. 下载字体woff文件</h4><p>从上面我们知道，字体是在服务器上进行存储，并通过浏览器下载到我们的电脑上的，那么我们就可以在网站上找到加载的字体文件，下载下来。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193115458.png" alt=""></p>
<p>下载下来之后，打开它进行观察，这里给大家分享一个再点字体编译器网站，使用它可以很方便打开woff文件。网址：<a href="http://font.qqe2.com/index-en.html" target="_blank" rel="noopener">http://font.qqe2.com/index-en.html</a></p>
<p>打开字体文件之后，我们发现，每个数字都对应一个字符串，如7对应的是$E9C7。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193133299.png" alt=""></p>
<h4 id="2-寻找映射关系-1"><a href="#2-寻找映射关系-1" class="headerlink" title="2. 寻找映射关系"></a>2. 寻找映射关系</h4><p>通过对源网页中的占位数据和字体进行比对，我们发现将源数据中的&amp;#x替换成$，然后将字符串首字母大写，就变成了字体对应的字符串了。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193201937.png" alt=""></p>
<h4 id="3-构建映射算法"><a href="#3-构建映射算法" class="headerlink" title="3. 构建映射算法"></a>3. 构建映射算法</h4><p>在上面我们已经找到了字体之间映射关系，那么我们现在就可以开始用Python来构建映射算法，从而使得爬虫可以获取一个正确的数据。</p>
<p>构建代码如下：</p>
<pre><code>data = {
   '&amp;#xe9c7' : 7,
   '&amp;#xf57b' : 1,
   '&amp;#xe7df' : 2,
   '&amp;#xe339' : 6,
   '&amp;#xe624' : 9,
   '&amp;#xea16' : 5,
   '&amp;#xf19a' : 3,
   '&amp;#xee76' : 0,
   '&amp;#xf593' : 4,
   '&amp;#xefd4' : 8,
}</code></pre><p>之后，我们即可对网页进行爬取，然后将对应的源数据与data进行比如，从而获得正确数据。</p>
<h3 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了如何破解字体反爬虫，由于这种反爬虫是使用CSS进行加载和映射的，所以即使使用一些自动化软件或者渲染工具也无法获得真正的数据。</p>
</li>
<li><p>这类反爬虫的破解只需要将woff文件中的字体与页面数据之间的对应关系找到，构建好即可。</p>
</li>
<li><p>找到woff文件进行下载是关键。</p>
</li>
</ol>
<h1 id="特征识别"><a href="#特征识别" class="headerlink" title="特征识别"></a>特征识别</h1><p>特征识别反爬虫是利用爬虫程序的一些特殊性，来将其与正常用户的请求进行区分，从而来限制爬虫，但是现在爬虫程序的特性是可以被改变的，我们可以通过将爬虫程序的特性改变成正常用户，从而来绕过这类反爬虫。</p>
<h2 id="Python搭建IP代理池，轻松破解请求频率限制反爬虫"><a href="#Python搭建IP代理池，轻松破解请求频率限制反爬虫" class="headerlink" title="Python搭建IP代理池，轻松破解请求频率限制反爬虫"></a>Python搭建IP代理池，轻松破解请求频率限制反爬虫</h2><p>我们所写的爬虫，它对服务器发出的网络请求频率要比正常用户的高的多，从而开发者可以将请求频率过高的用户视为爬虫程序，从而来限制爬虫程序。</p>
<h3 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h3><p>因为客户端的IP地址是唯一的，所以开发者便将IP地址作为客户端的身份标识。</p>
<p>服务器可以根据客户端的IP的访问次数来标识记录，从而计算出它的请求频率。然后，对于请求频率过高的客户端进行反爬虫限制。</p>
<h3 id="破解-3"><a href="#破解-3" class="headerlink" title="破解"></a>破解</h3><p>其实破解请求频率限制反爬虫是十分简单的，因为Requests库中就有一个proxies参数，就是专门为使用IP来准备的，具体使用方法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
proxies <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://10.10.1.10:3128"</span><span class="token punctuation">,</span>
 <span class="token string">"https"</span><span class="token punctuation">:</span> <span class="token string">"https://10.10.1.10:1080"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://example.org"</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="搭建IP代理池"><a href="#搭建IP代理池" class="headerlink" title="搭建IP代理池"></a>搭建IP代理池</h3><p>搭建一个IP代理池分为三个模块，分别是爬取模块、检测模块、存储模块。下面让我们来看看这三个模块要怎么写吧。</p>
<h4 id="1-爬取模块"><a href="#1-爬取模块" class="headerlink" title="1. 爬取模块"></a>1. 爬取模块</h4><p>我们此次是在百度上搜索的一个免费的IP代理网站对其代理IP进行爬取。</p>
<p>我们打开开发者模式，然后输入对网页进行观察，我们发现数据存储在源网页中。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193531821.png" alt=""></p>
<p>既然我们已经发现数据的存储位置和存储形式了，那么就可以发起请求，提取数据了，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
   <span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span> <span class="token string">'"Chromium";v="92", " Not A;Brand";v="99", "Google Chrome";v="92"'</span><span class="token punctuation">,</span>
   <span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span> <span class="token string">'?0'</span><span class="token punctuation">,</span>
   <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
   <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36'</span><span class="token punctuation">,</span>
   <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'navigate'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-User'</span><span class="token punctuation">:</span> <span class="token string">'?1'</span><span class="token punctuation">,</span>
   <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'document'</span><span class="token punctuation">,</span>
   <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://www.kuaidaili.com/free/inha/1/'</span><span class="token punctuation">,</span>
   <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> page <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>f<span class="token string">'https://www.kuaidaili.com/free/inha/{page}/'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
   ip_list <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'data-title="IP">(.*?)&lt;/td>'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-检测模块"><a href="#2-检测模块" class="headerlink" title="2. 检测模块"></a>2. 检测模块</h4><p>因为我们是爬取的免费的IP，所以我们要对其进行检测，看看是否失效了，毕竟便宜没好货，好货不便宜么~ 检测代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> ip <span class="token keyword">in</span> ip_list<span class="token punctuation">:</span>
   <span class="token keyword">try</span><span class="token punctuation">:</span>
       response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span>ip<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
       <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
           list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
   <span class="token keyword">except</span><span class="token punctuation">:</span>
       <span class="token keyword">pass</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token string">'检测通过'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-存储模块"><a href="#3-存储模块" class="headerlink" title="3. 存储模块"></a>3. 存储模块</h4><p>我这里是将检测出来可以使用的IP代理存到了csv文件中去，大家也可以尝试使用其他类型的存储，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> csv
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'ip.csv'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
   writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
   writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>list<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="小结-6"><a href="#小结-6" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了如何破解请求频率限制的反爬虫，并教大家搭建一个自己的IP代理池。</p>
</li>
<li><p>使用代理IP来进行爬虫是当前一种非常流行的方式，因为每个用户端的IP是唯一的，一旦被认为是爬虫给限制或者是封禁了，那么对于用户来说会造成很大的损失。</p>
</li>
<li><p>免费的IP代理质量不如付费的，如果有大量的需求还是需要购买一下专业的。</p>
</li>
</ol>
<h2 id="WebDriver识别反爬虫的原理和破解方法"><a href="#WebDriver识别反爬虫的原理和破解方法" class="headerlink" title="WebDriver识别反爬虫的原理和破解方法"></a>WebDriver识别反爬虫的原理和破解方法</h2><p>有时候我们在爬取动态网页的时候，会借助渲染工具来进行爬取，这个“借助”实际上就是通过使用相应的浏览器驱动(即WebDriver)向浏览器发出命令。</p>
<p>但是有时候使用浏览器驱动来爬取网页时，会遇到这种情况</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106193918816.png" alt=""></p>
<h3 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h3><p>开发者在开发网页的时候，通过JavaScript设置一个事件，然后让这个事件来调用Navigator对象的webdriver属性，从而来判断客户端是否使用WebDriver驱动浏览器。</p>
<p>如果检测到客户端有webdriver属性，则会返回True，此时反爬虫就会认为这是一个爬虫程序，从而进行限制；如果没有检测到，则会返回False或者Undefined，此时反爬虫不会运行。</p>
<p>检测代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">webdriver <span class="token operator">=</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>webdriver<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>webdriver<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">'请不要使用自动化测试工具访问网页'</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">else</span><span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">'正常浏览器'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="破解-4"><a href="#破解-4" class="headerlink" title="破解"></a>破解</h3><p>通过学习上面的WebDriver识别反爬虫原理，我们知道反爬虫机制是根据webdriver属性的返回值来判断是否是爬虫程序访问的。</p>
<p>也就是说，当我们用浏览器驱动来爬取网页时，只要我们能够将它的特征给隐藏，让Navigator对象检测不到浏览器驱动，从而使得webdriver属性返回的值为False或者Undefined，此时就破解WebDriver识别反爬虫了。</p>
<p>上面已经分析出来解决方案了，那我们现在就可以书写代码来实现这个方案了，隐藏浏览器驱动特征的代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
option <span class="token operator">=</span> ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'useAutomationExtension'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
   <span class="token string">'user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36'</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--disable-blink-features=AutomationControlled"</span><span class="token punctuation">)</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'stealth.min.js'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
   js <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>execute_cdp_cmd<span class="token punctuation">(</span><span class="token string">'Page.addScriptToEvaluateOnNewDocument'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token string">'source'</span><span class="token punctuation">:</span> js
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>让我们来看看效果：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194049350.png" alt=""></p>
<p>此时，文章内容就被正确显示出来了，没有再出现被反爬冲限制。</p>
<h3 id="小结-7"><a href="#小结-7" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了如何破解特征识别反爬虫之WebDriver识别反爬虫。</p>
</li>
<li><p>现在很多网站对Selenium套件有着明显的限制，所以破解WebDriver识别反爬虫是一个爬虫工程师必备的技能之一。</p>
</li>
</ol>
<h2 id="隐藏链接反爬虫的原理和破解方法"><a href="#隐藏链接反爬虫的原理和破解方法" class="headerlink" title="隐藏链接反爬虫的原理和破解方法"></a>隐藏链接反爬虫的原理和破解方法</h2><p>如下图所示，网站将访问详情页的URL放到网页标签中去，所以我们在爬取时，首先要先定位到这些存在URL的标签，然后将URL提取出来，对其发送请求，才能够访问详情页，并提取其数据。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194138784.png" alt=""></p>
<p>提取这个标签中的URL，相对于我们现在的水平来说，应该是一个十分简单的事情，但是当书写代码来实现时，却显示被反爬了, 重新观察网页，寻找反爬虫的机制，终于在存储URL的标签中发现了问题。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194155302.png" alt=""></p>
<p>原来，在写爬虫的时候，我们观察并实验了前几个URL后，发现能够正常获取数据，就默认全局都应该这样写，但实际上并不是，这里面存储了隐藏链接用于反爬虫，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194211019.png" alt=""></p>
<p>这就是典型的隐藏链接反爬虫，将真假数据混在一起，当访问假数据时，默认为爬虫程序，典型例子是微博评论</p>
<h3 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h3><p>由于反爬虫机制是存在标签样式中的，并不存在页面中，所以用户在正常访问时是不会触碰到它的。</p>
<p>但是爬虫程序就不同了，因为它是从网页标签中获取数据的，一旦爬虫工程师没有注意到隐藏在标签列表中的特殊URL，就会导致爬虫程序触发反爬虫机制，从而被反爬限制。</p>
<h3 id="破解-5"><a href="#破解-5" class="headerlink" title="破解"></a>破解</h3><p>这类反爬虫主要存在于有许多标签列表的网页中。</p>
<p>因为爬虫工程师在分析网页时，通常只会分析一个点，然后由点及面，毕竟即使爬虫就是为了减少工作量，如果全部观察了，那用爬虫也没必要了。</p>
<p>隐藏链接反爬虫主要是通过封禁IP来进行反爬，所以爬虫工程师在爬取时可以加上IP代理池，在节中我们已经详细介绍了搭建IP代理池的方法，有兴趣的读者可以看看。</p>
<p>当我们在爬取标签列表较多或者数据分页较多的网站时，遇到分析的网页可以正常爬取，但是后面的数据无法正常爬取时，我们就要考虑自己是否是遇到了隐藏链接反爬虫了。</p>
<p>此时我们要加大对数据分析的范围，找到隐藏链接和真正链接之间的区别，然后在程序中进一步甄别这两种链接之后，就破解这类反爬虫了~</p>
<h3 id="小结-8"><a href="#小结-8" class="headerlink" title="小结"></a>小结</h3><ol>
<li>本节详细介绍了如何破解隐藏链接反爬虫，这类反爬虫要存在于标签列表较多的网站中，或者网页数据较多的网站</li>
<li>当我们遇到分析的部分可以正常爬取，但是后面却被反爬，这时候就要考虑是否是否是遇到了隐藏链接反爬虫了。</li>
<li>隐藏链接反爬虫属于一类非常简单的反爬虫，它主要是利用了爬虫工程师的粗心，只要我们足够细心，那么这类反爬虫对我们来说是轻而易举的。</li>
</ol>
<h1 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h1><p>验证码反爬虫可谓是现在最为流行的反爬虫手段之一，它的高速发展可谓是爬虫促进的，想要破解这类反爬虫，就一定要学好图像识别技术，利用图像识别，可以很轻松的破解一般的验证码反爬虫。</p>
<h2 id="文字点选验证码的破解方法"><a href="#文字点选验证码的破解方法" class="headerlink" title="文字点选验证码的破解方法"></a>文字点选验证码的破解方法</h2><h3 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h3><ol>
<li>获取图像</li>
<li>对图像进行二值化处理</li>
<li>识别图中轮廓</li>
<li>识别轮廓文字</li>
<li>构建待选文字图像</li>
<li>比较识别文字与待选文字图像</li>
<li>返回点选结果</li>
</ol>
<blockquote>
<p>本节仅提供基本思路，具体应用需根据各类型点选验证码自行修改。</p>
</blockquote>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><h4 id="0-导入依赖"><a href="#0-导入依赖" class="headerlink" title="0. 导入依赖"></a>0. 导入依赖</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">import</span> json
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-获取图像"><a href="#1-获取图像" class="headerlink" title="1. 获取图像"></a>1. 获取图像</h4><p>第一步是获取图像，有一些验证码图像是以二进制形式返回的，本节测试的图像是以base64编码字符串的形式返回，因此需要对其进行解码。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span>capsession<span class="token punctuation">:</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">)</span><span class="token punctuation">:</span>
    resp <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"验证码获取url"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"repData"</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">getImageFromBase64</span><span class="token punctuation">(</span>b64<span class="token punctuation">)</span><span class="token punctuation">:</span>
    buffer <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>b64<span class="token punctuation">)</span>
    nparr <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imdecode<span class="token punctuation">(</span>nparr<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span>
    <span class="token keyword">return</span> image<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-对图像进行二值化处理"><a href="#2-对图像进行二值化处理" class="headerlink" title="2. 对图像进行二值化处理"></a>2. 对图像进行二值化处理</h4><p>为了方便识别文字轮廓，我们对图像进行二值化处理。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">normalizeImage</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    _<span class="token punctuation">,</span> img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token keyword">return</span> img<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-识别图中轮廓"><a href="#3-识别图中轮廓" class="headerlink" title="3. 识别图中轮廓"></a>3. 识别图中轮廓</h4><p>在识别图中轮廓时，为了提高效率和准确度，我们对轮廓按长宽比和面积进行筛选，尽可能保证轮廓能够满足文字识别需要。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">findContour</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    contours<span class="token punctuation">,</span> _ <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span>
                                   cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">find_if_close</span><span class="token punctuation">(</span>cnt1<span class="token punctuation">,</span> cnt2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        row1<span class="token punctuation">,</span> row2 <span class="token operator">=</span> cnt1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cnt2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>row1<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>row2<span class="token punctuation">)</span><span class="token punctuation">:</span>
                dist <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>cnt1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> cnt2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> abs<span class="token punctuation">(</span>dist<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
                    returnTrue
                <span class="token keyword">elif</span> i <span class="token operator">==</span> row1 <span class="token operator">-</span> 1and j <span class="token operator">==</span> row2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    returnFalse
    LENGTH <span class="token operator">=</span> len<span class="token punctuation">(</span>contours<span class="token punctuation">)</span>
    status <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>LENGTH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> cnt1 <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>contours<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> i
        <span class="token keyword">if</span> i <span class="token operator">!=</span> LENGTH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j<span class="token punctuation">,</span> cnt2 <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span>
                dist <span class="token operator">=</span> find_if_close<span class="token punctuation">(</span>cnt1<span class="token punctuation">,</span> cnt2<span class="token punctuation">)</span>
                <span class="token keyword">if</span> dist <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                    val <span class="token operator">=</span> min<span class="token punctuation">(</span>status<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> status<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    status<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> status<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> val
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> status<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> status<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                        status<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    unified <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    maximum <span class="token operator">=</span> int<span class="token punctuation">(</span>status<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>maximum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>status <span class="token operator">==</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> pos<span class="token punctuation">.</span>size <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            cont <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">[</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> pos<span class="token punctuation">]</span><span class="token punctuation">)</span>
            hull <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>cont<span class="token punctuation">)</span>
            unified<span class="token punctuation">.</span>append<span class="token punctuation">(</span>hull<span class="token punctuation">)</span>
    cnt <span class="token operator">=</span> list<span class="token punctuation">(</span>filter<span class="token punctuation">(</span>aspectRatio<span class="token punctuation">,</span>unified<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cnt<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>cv2<span class="token punctuation">.</span>contourArea<span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cnt<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">aspectRatio</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _<span class="token punctuation">,</span>_<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boundingRect<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">&lt;</span>float<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token operator">/</span>h<span class="token operator">&lt;</span><span class="token number">1.7</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>contourArea<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">200.0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-识别轮廓文字"><a href="#4-识别轮廓文字" class="headerlink" title="4. 识别轮廓文字"></a>4. 识别轮廓文字</h4><p>我们对图中文字轮廓进行识别，返回文字轮廓与相应的坐标位置。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">extractCharContour</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> contour<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mult <span class="token operator">=</span> <span class="token number">1.2</span>
    ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    point <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> cnt <span class="token keyword">in</span> contour<span class="token punctuation">:</span>
        rect <span class="token operator">=</span> cv2<span class="token punctuation">.</span>minAreaRect<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
        box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boxPoints<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
        box <span class="token operator">=</span> np<span class="token punctuation">.</span>int0<span class="token punctuation">(</span>box<span class="token punctuation">)</span>
        W <span class="token operator">=</span> rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        H <span class="token operator">=</span> rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        Xs <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> box<span class="token punctuation">]</span>
        Ys <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> box<span class="token punctuation">]</span>
        x1 <span class="token operator">=</span> min<span class="token punctuation">(</span>Xs<span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> max<span class="token punctuation">(</span>Xs<span class="token punctuation">)</span>
        y1 <span class="token operator">=</span> min<span class="token punctuation">(</span>Ys<span class="token punctuation">)</span>
        y2 <span class="token operator">=</span> max<span class="token punctuation">(</span>Ys<span class="token punctuation">)</span>
        rotated <span class="token operator">=</span> <span class="token boolean">False</span>
        angle <span class="token operator">=</span> rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> angle <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">:</span>
            angle <span class="token operator">+=</span> <span class="token number">90</span>
            rotated <span class="token operator">=</span> <span class="token boolean">True</span>
        center <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">+</span> x2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span><span class="token punctuation">(</span>y1 <span class="token operator">+</span> y2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        size <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">(</span>mult <span class="token operator">*</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>mult <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> angle<span class="token punctuation">,</span>
                                        <span class="token number">1.0</span><span class="token punctuation">)</span>
            cropped <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRectSubPix<span class="token punctuation">(</span>img<span class="token punctuation">,</span> size<span class="token punctuation">,</span> center<span class="token punctuation">)</span>
            cropped <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>cropped<span class="token punctuation">,</span> M<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
            croppedW <span class="token operator">=</span> W ifnot rotated <span class="token keyword">else</span> H
            croppedH <span class="token operator">=</span> H ifnot rotated <span class="token keyword">else</span> W
            croppedRotated <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRectSubPix<span class="token punctuation">(</span>
                    cropped<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>int<span class="token punctuation">(</span>croppedW <span class="token operator">*</span> mult<span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>croppedH <span class="token operator">*</span> mult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>croppedRotated<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                  np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
            im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel<span class="token operator">=</span>kernel<span class="token punctuation">)</span>
            ret<span class="token punctuation">.</span>append<span class="token punctuation">(</span>im<span class="token punctuation">)</span>
            point<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">,</span> point<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="5-构建待选文字图像"><a href="#5-构建待选文字图像" class="headerlink" title="5. 构建待选文字图像"></a>5. 构建待选文字图像</h4><p>将获取的待选文字转化为图像。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">genCharacter</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">"simsun.ttc"</span><span class="token punctuation">,</span> min<span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
    draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> font<span class="token operator">=</span>font<span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="6-比较识别文字与待选文字图像"><a href="#6-比较识别文字与待选文字图像" class="headerlink" title="6. 比较识别文字与待选文字图像"></a>6. 比较识别文字与待选文字图像</h4><p>我们将识别文字轮廓与待选文字图像进行比较，获得对应位置，并根据验证码要求依次添加点选坐标。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">compareCharImage</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> point<span class="token punctuation">,</span> word_list<span class="token punctuation">)</span> 
    scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> word <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j<span class="token punctuation">,</span> char <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">:</span>
            scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>char<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    scores<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    word_set <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
    char_set <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
    answers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> score <span class="token keyword">in</span> scores<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> notin word_set<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>score <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> notin char_set<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        word_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        char_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        answers<span class="token punctuation">[</span>word_list<span class="token punctuation">[</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> point<span class="token punctuation">[</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">"x"</span><span class="token punctuation">:</span> int<span class="token punctuation">(</span>answers<span class="token punctuation">[</span>word<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"y"</span><span class="token punctuation">:</span> int<span class="token punctuation">(</span>answers<span class="token punctuation">[</span>word<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> word_list<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="7-返回点选结果"><a href="#7-返回点选结果" class="headerlink" title="7. 返回点选结果"></a>7. 返回点选结果</h4><p>最后，将得到的点选结果返回给服务器进行验证。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">checkCaptcha</span><span class="token punctuation">(</span>captchaSession<span class="token punctuation">:</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">,</span> data<span class="token punctuation">,</span> point<span class="token punctuation">)</span><span class="token punctuation">:</span>
    enc <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"secretKey"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> captchaSession<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        <span class="token string">"验证码提交url"</span><span class="token punctuation">,</span>
        json<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">"token"</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">"token"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"pointJson"</span><span class="token punctuation">:</span> enc<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="滑动拼图验证码的原理和破解方法"><a href="#滑动拼图验证码的原理和破解方法" class="headerlink" title="滑动拼图验证码的原理和破解方法"></a>滑动拼图验证码的原理和破解方法</h2><h3 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h3><p>滑动拼图验证码是在滑块验证码的基础上增加了一个随机滑动距离，用户需要将滑块滑到拼图的缺口处，使拼图完整，才能通过校验。如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194630782.png" alt=""></p>
<h3 id="破解-6"><a href="#破解-6" class="headerlink" title="破解"></a>破解</h3><p>其实破解滑动拼图验证码的原理和滑块验证码的是一样的，就是找到滑动距离，然后让滑块按照该距离进行滑动即可。</p>
<p>但是滑动拼图验证码，它的滑动距离是随机的，所以我们不能像对滑块验证码一样，通过直接观察滑块和滑轨的长度来确定滑动距离。</p>
<p>我们打开开发者模式，对网页进行观察，果然从中找到了一些线索。如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194651508.png" alt=""></p>
<p>从图中可以看出，当我们点击滑块后，拼图和缺角的CSS代码就会展示出来。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194711028.png" alt=""></p>
<p>并且我们发现，滑块移动的距离就是缺口CSS样式中的left值减去拼图CSS样式中的值。</p>
<h4 id="确定滑动距离"><a href="#确定滑动距离" class="headerlink" title="确定滑动距离"></a>确定滑动距离</h4><p>好了，通过上面的分析，我们已经找到了获取滑块滑动距离的思路了，那么现在就是来将思路转化成代码实现即可。</p>
<p><strong>1. 获取点击滑块后的网页代码</strong></p>
<p>因为点击滑块后，缺口和拼图的CSS样式才会显示出来，获取代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>r<span class="token string">'chromedriver.exe'</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
jigsawCircle <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'#jigsawCircle'</span><span class="token punctuation">)</span>
action <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
action<span class="token punctuation">.</span>click_and_hold<span class="token punctuation">(</span>jigsawCircle<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
html <span class="token operator">=</span> driver<span class="token punctuation">.</span>page_source<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2. 提取CSS样式中的left值</strong></p>
<p>采用的用BS4库进行提取，提取代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
qidian <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'missblock'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'style'</span><span class="token punctuation">]</span>
zhongdian <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'targetblock'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'style'</span><span class="token punctuation">]</span>
left_hua <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'left:(.*?)px'</span><span class="token punctuation">,</span>qidian<span class="token punctuation">)</span>
left_que <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'left:(.*?)px'</span><span class="token punctuation">,</span>zhongdian<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>3. 计算滑动距离</strong></p>
<p>计算代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">distance <span class="token operator">=</span> float<span class="token punctuation">(</span>left_que<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span>float<span class="token punctuation">(</span>left_hua<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="模拟滑动"><a href="#模拟滑动" class="headerlink" title="模拟滑动"></a>模拟滑动</h4><p>因为在计算滑动距离的时候，我们就已经将鼠标定在滑块位置了，那么我们现在只需移动鼠标到缺口处即可完成校验。代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span>distance<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="小结-9"><a href="#小结-9" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了滑动拼图验证码反爬虫的原理和破解方法。</p>
</li>
<li><p>滑动拼图验证码是现在非常流行的一种验证码反爬虫，所以大家如果想成为一名爬虫工程师，那这绝对是一个必备技能。</p>
</li>
<li><p>破解滑动拼图验证码的关键是要找到拼图和缺口这两者之间距离的联系，只要找到随机移动的距离，那模拟移动，想必对大家来说都不是什么事~</p>
</li>
</ol>
<h2 id="滑块验证码的原理和破解方法"><a href="#滑块验证码的原理和破解方法" class="headerlink" title="滑块验证码的原理和破解方法"></a>滑块验证码的原理和破解方法</h2><h3 id="原理-10"><a href="#原理-10" class="headerlink" title="原理"></a>原理</h3><p>网站开发者们认为可以从行为方面来区别人类和计算机。例如：人们可以自由的完成拖拽、按下和释放鼠标等操作，但是计算机却不可以。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106194920209.png" alt=""></p>
<h3 id="破解-7"><a href="#破解-7" class="headerlink" title="破解"></a>破解</h3><h4 id="观察滑块和轨道的长度"><a href="#观察滑块和轨道的长度" class="headerlink" title="观察滑块和轨道的长度"></a>观察滑块和轨道的长度</h4><p>我们首先要打开网页的开发者模式，来看一下滑块和轨道的长度分别是多少。</p>
<p><strong>滑块长度</strong></p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106194952797.png" style="zoom:67%;">

<p><strong>轨道长度</strong></p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195013900.png" alt=""></p>
<p>从上面我们知道了滑块的长度是50，轨道的长度是390，也就是说，滑块需要滑动的距离是340。</p>
<h4 id="模拟滑动-1"><a href="#模拟滑动-1" class="headerlink" title="模拟滑动"></a>模拟滑动</h4><p>在上面我们已经知道滑块要滑动的距离了，那么我们现在就可以开始尝试模拟滑动了。这里我们使用Selenium来完成滑块滑动的工作。</p>
<p>模拟滑动主要分为以下两步：</p>
<p><strong>1. 将鼠标定位到滑块位置</strong></p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195104292.png" alt=""></p>
<p>我们打开开发者模式，对滑块进行检查发现，滑块的class属性是hover，所以定位代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>r<span class="token string">'chromedriver.exe'</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'http://www.porters.vip/captcha/sliders.html#'</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
hover <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'.hover'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2. 移动鼠标到轨道终点</strong></p>
<p>Selenium库中有一个ActionChains模块，它可以模拟鼠标按住滑块进行移动，然后进行释放等操作，很符合我们的需求。代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
move <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
move<span class="token punctuation">.</span>click_and_hold<span class="token punctuation">(</span>hover<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
move<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">340</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
move<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="小结-10"><a href="#小结-10" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了滑块验证码反爬虫的原理和破解方法。</p>
</li>
<li><p>滑块验证码是现在比较流行的一种验证码反爬虫，所以大家如果想成为一名爬虫工程师，那这是一个必备技能。</p>
</li>
<li><p>破解滑块验证码主要分两步：一、计算出滑块要滑动的距离；二、让滑块进行移动。</p>
</li>
</ol>
<h2 id="计算型验证码反爬虫的原理和破解方法"><a href="#计算型验证码反爬虫的原理和破解方法" class="headerlink" title="计算型验证码反爬虫的原理和破解方法"></a>计算型验证码反爬虫的原理和破解方法</h2><h3 id="原理-11"><a href="#原理-11" class="headerlink" title="原理"></a>原理</h3><p>计算型验证码其实是一种特殊的字符型验证码，只不过在它的基础上增加了数字运算。</p>
<p>计算型验证码在将人类视觉和计算机视觉的差异作为区分用户和电脑的依据的同时，还加上了逻辑运算，从而来增加机器识别的难度。</p>
<h3 id="破解-8"><a href="#破解-8" class="headerlink" title="破解"></a>破解</h3><p>以下面这张验证码为例给大家讲一下如何用用图像识别的方式破解字符验证码。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195227266.png" alt=""></p>
<p>我们换一个新方式来破解验证码。此次使用的是Ddddocr库。这个库的使用非常的便捷，可以通过下面命令进行安装：</p>
<pre><code>pip install ddddocr</code></pre><p>它的参数说明</p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106195256519.png" style="zoom:67%;">

<p>我们现在书写一下代码，来实战一下，看看效果</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> ddddocr
ocr <span class="token operator">=</span> ddddocr<span class="token punctuation">.</span>DdddOcr<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'6.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
   img_bytes <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> ocr<span class="token punctuation">.</span>classification<span class="token punctuation">(</span>img_bytes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195315010.png" alt=""></p>
<p>成功的将式子识别了出来。然后我们就可以根据式子来进行算数了，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span><span class="token string">'+'</span><span class="token keyword">in</span> res<span class="token punctuation">:</span>
   zhi <span class="token operator">=</span>  int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>zhi<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token string">'-'</span><span class="token keyword">in</span> res<span class="token punctuation">:</span>
   zhi <span class="token operator">=</span>  int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span>int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>zhi<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token string">'*'</span><span class="token keyword">in</span> res<span class="token punctuation">:</span>
   zhi <span class="token operator">=</span>  int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>zhi<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token string">'/'</span><span class="token keyword">in</span> res<span class="token punctuation">:</span>
   zhi <span class="token operator">=</span>  int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>int<span class="token punctuation">(</span>res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>zhi<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果成功的计算了出来。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195330542.png" alt=""></p>
<h3 id="制作代码"><a href="#制作代码" class="headerlink" title="制作代码"></a>制作代码</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span>ImageDraw<span class="token punctuation">,</span>ImageFont
<span class="token keyword">import</span> random
<span class="token keyword">def</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 获取一个随机的rgb格式颜色</span>
   r <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   b <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 获取一个随机字符串，其中每个字符也是随机的</span>
   num_random <span class="token operator">=</span> str<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> num_random
text <span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
       k <span class="token operator">=</span> getRandomStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
       k <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span>
   text <span class="token operator">+=</span> k
text <span class="token operator">=</span> text<span class="token operator">+</span><span class="token string">' = '</span>
<span class="token comment" spellcheck="true"># 获取一个Image对象，参数分别是:RGB格式，宽120，高40，随机颜色</span>
image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取一个画笔对象，将图片对象传过去</span>
draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取一个font字体对象，参数是ttf的字体文件的目录，以及字体的大小</span>
font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span>r<span class="token string">'K:\msyh.ttc'</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 在图片上写东西，参数是定位、字符串、颜色和字体</span>
draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>text<span class="token punctuation">,</span>getRandomColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>font<span class="token operator">=</span>font<span class="token punctuation">)</span>
image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'6.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>小结</p>
<ol>
<li><p>本节详细介绍了计算型验证码反爬虫的原理和破解方法，并教大家如何做一款自己的计算型验证码。</p>
</li>
<li><p>因为计算型验证码是一种特殊的字符型验证码，所以Ddddocr库其实也适用于破解字符型验证码。</p>
</li>
<li><p>相比较于Pytesseract库，Ddddocr库的使用更加便捷且不需要进行环境配置。</p>
</li>
</ol>
<h2 id="字符型验证码反爬虫的原理和破解方法"><a href="#字符型验证码反爬虫的原理和破解方法" class="headerlink" title="字符型验证码反爬虫的原理和破解方法"></a>字符型验证码反爬虫的原理和破解方法</h2><h3 id="原理-12"><a href="#原理-12" class="headerlink" title="原理"></a>原理</h3><p>字符验证码的反爬虫原理很简单，它利用数字、字母、汉字和标点符号等字符做成一张图片，用人类和计算机对这张图片视觉上的差异作为区分用户身份的依据。</p>
<p>随着当前社会识别技术的发展，字符验证码也也在不断的改进，它通过添加干扰线、添加噪点以及增加字符的黏连程度和旋转角度来增加机器识别的难度。</p>
<h3 id="破解-9"><a href="#破解-9" class="headerlink" title="破解"></a>破解</h3><p>以下面这张验证码为例给大家讲一下如何用用图像识别的方式破解字符验证码。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195516734.png" alt=""></p>
<p>它有在线和离线两种方式，我们下面来分别进行介绍。</p>
<h4 id="离线破解"><a href="#离线破解" class="headerlink" title="离线破解"></a>离线破解</h4><p>我们离线破解验证码主要是使用的PIL库和Pytesseract库，在使用Pytesseract库时，需要先安装Tesseract-OCR。</p>
<p>验证码识别一共分为这四步：</p>
<ol>
<li><p>灰度化</p>
</li>
<li><p>二值化</p>
</li>
<li><p>识别</p>
</li>
</ol>
<p>首先使用PIL库将彩色图像转化成灰色的图像，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
im<span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'5.jpg'</span><span class="token punctuation">)</span>
imgry <span class="token operator">=</span> im<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
imgry<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'gray-'</span><span class="token operator">+</span><span class="token string">'5.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>灰度化图像：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195549591.png" alt=""></p>
<p>紧跟着二值化处理，让字符颜色跟背景颜色反差更为明显，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python">threshold <span class="token operator">=</span> <span class="token number">200</span>
Table <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> j <span class="token operator">&lt;</span> threshold<span class="token punctuation">:</span>
       Table<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
       Table<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
out <span class="token operator">=</span> imgry<span class="token punctuation">.</span>point<span class="token punctuation">(</span>Table<span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
out<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token operator">+</span><span class="token string">'5.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>二值化图像：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195611005.png" alt=""></p>
<p>尝试识别一下，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pytesseract
pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195628095.png" alt=""></p>
<h4 id="在线识别"><a href="#在线识别" class="headerlink" title="在线识别"></a>在线识别</h4><p>其实字符验证码就是一张图片，我们可以借助百度AI来进行在线识别</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> aip <span class="token keyword">import</span> AipOcr
APP_ID <span class="token operator">=</span> <span class="token string">'你的APP_ID'</span>
API_KEY <span class="token operator">=</span> <span class="token string">'你的API_KEY'</span>
SECRET_KEY <span class="token operator">=</span> <span class="token string">'你的SECRET_KEY'</span>
client <span class="token operator">=</span> AipOcr<span class="token punctuation">(</span>APP_ID<span class="token punctuation">,</span> API_KEY<span class="token punctuation">,</span> SECRET_KEY<span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'5.jpg'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
   a <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>basicGeneral<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="制作验证码"><a href="#制作验证码" class="headerlink" title="制作验证码"></a>制作验证码</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span>ImageDraw<span class="token punctuation">,</span>ImageFont
<span class="token keyword">import</span> random
<span class="token keyword">def</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   r <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   b <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   num_random <span class="token operator">=</span> str<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   random_upper_alpha <span class="token operator">=</span> chr<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   random_char <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span>num_random<span class="token punctuation">,</span>random_upper_alpha<span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> random_char
image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span>r<span class="token string">'K:\msyh.ttc'</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">+</span>i<span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>getRandomStr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>getRandomColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>font<span class="token operator">=</span>font<span class="token punctuation">)</span>
width <span class="token operator">=</span> <span class="token number">120</span>
height <span class="token operator">=</span> <span class="token number">40</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   x1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>width<span class="token punctuation">)</span>
   x2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>width<span class="token punctuation">)</span>
   y1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>height<span class="token punctuation">)</span>
   y2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>height<span class="token punctuation">)</span>
   draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>y2<span class="token punctuation">)</span><span class="token punctuation">,</span>fill<span class="token operator">=</span>getRandomColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   draw<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>fill<span class="token operator">=</span>getRandomColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>width<span class="token punctuation">)</span>
   y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>height<span class="token punctuation">)</span>
   draw<span class="token punctuation">.</span>arc<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>x<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span>y<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span>fill<span class="token operator">=</span>getRandomColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'5.jpg'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="小结-11"><a href="#小结-11" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了字符验证码反爬虫的原理和破解方法。</p>
</li>
<li><p>字符型验证码是一种比较常规的验证码反爬虫，破解方法较为简单</p>
</li>
</ol>
<h2 id="鼠标轨迹检测反爬虫的原理和破解方法"><a href="#鼠标轨迹检测反爬虫的原理和破解方法" class="headerlink" title="鼠标轨迹检测反爬虫的原理和破解方法"></a>鼠标轨迹检测反爬虫的原理和破解方法</h2><p>Selenium库经过WebDriver伪装之后，就可以对大部分的动态加载网页进行网络爬虫爬取，但是最近又出了一种鼠标轨迹检测反爬虫，它对伪装后的Selenium又开始有了限制，那么这时候怎么解决它呢？</p>
<h3 id="原理-13"><a href="#原理-13" class="headerlink" title="原理"></a>原理</h3><p>用户正常用鼠标进行点击按钮，轨迹如下图，它的轨迹线路是不规则的。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195832083.png" alt=""></p>
<p>但是，当用户使用Selenium时，它就没有轨迹了，而是直接定位到指定位置进行点击。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195845588.png" alt=""></p>
<p>找了一个鼠标检测网站来让大家更加直观的进行体会。这个网站分三层，绿色的是我们看到正常访问界面，黄色的是我们鼠标在绿色区域内移动的轨迹，白色的是鼠标移动的坐标。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195931660.png" alt=""></p>
<p>用户正常访问页面时，页面的鼠标轨迹和坐标变化，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106195959711.png" alt=""></p>
<p>我们接下来看看用Selenium库进行点击first时，鼠标的轨迹和坐标变化。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106200019152.png" alt=""></p>
<p>通过上面两个图，我们可以更加直观的感受到用Selenium来对网页进行爬取与正常用户浏览的不同，而网站开发者也恰恰是抓住这一点来建立反爬虫机制。</p>
<p>开发者在对网页开发时，对页面加入鼠标运行轨迹检测，如果只有一个点击坐标，没有移动坐标的话，那就默认这是爬虫进行访问网页的，此时要对此访问进行限制。</p>
<h3 id="破解-10"><a href="#破解-10" class="headerlink" title="破解"></a>破解</h3><p>我们通过上面的原理已经知道了网站的反爬虫机制是通过对鼠标的移动坐标进行检测，来进行反爬的。</p>
<p>那也就是说只要我们能让Selenium爬取网页时，它的移动轨迹不再是直接点击坐标，而是和正常用户一样的，就可以绕过这类反爬虫~</p>
<p>在对Selenium库的文档进行查阅时发现，它有一个move_by_offset()参数，可以控制鼠标进行上下移动，那我们现在来书写代码，来看一下，它是否可以模拟真实鼠标轨迹，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
first <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'button1'</span><span class="token punctuation">)</span>
action <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ActionChains<span class="token punctuation">(</span>browser<span class="token punctuation">)</span>
action<span class="token punctuation">.</span>click_and_hold<span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>move_by_offset<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span>
action<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>让我们来看看效果：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106200059078.png" alt=""></p>
<p>从轨迹上看，这次的访问和正常的用户访问十分相似。此时，反爬虫已经不能再从轨迹这个地方来进行限制我们了。</p>
<h3 id="小结-12"><a href="#小结-12" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>本节详细介绍了鼠标轨迹检测反爬虫的原理和破解它的方法。</p>
</li>
<li><p>使用这种限制的网站不是主流</p>
</li>
</ol>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/basic-know-006.html">https://jackhcc.github.io/posts/basic-know-006.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Crawler/">
                                    <span class="chip bg-color">Crawler</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-11-02T19-06-37',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/Language-Python-Lib1.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/7.jpg" class="responsive-img" alt="Python-Standard Library">
                        
                        <span class="card-title">Python-Standard Library</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Python标准库详解【1】
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-11-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Language/" class="post-category">
                                    Language
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/Lesson-Dialectics-Of-Nature.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/19.jpg" class="responsive-img" alt="Dialectics Of Nature Lesson">
                        
                        <span class="card-title">Dialectics Of Nature Lesson</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            自然辩证法课程知识点整理
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-11-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Lesson/" class="post-category">
                                    Lesson
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Lesson/">
                        <span class="chip bg-color">Lesson</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

