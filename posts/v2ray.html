<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="v2ray详解, JackHCC">
    <meta name="description" content="v2ray使用手册！">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>v2ray详解 | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '6a6157cb615f5da34a7b5ba8d5b2a08105734d4a084a4d2c48421c8a20ed777f';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">v2ray详解</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/VPN/">
                                <span class="chip bg-color">VPN</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/VPN/" class="post-category">
                                VPN
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-07-20
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-13
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    53 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="V2ray详解"><a href="#V2ray详解" class="headerlink" title="V2ray详解"></a>V2ray详解</h1><p><strong>配置脚本：</strong></p>
<p><a href="https://github.com/hijkpw/scripts" target="_blank" rel="noopener">https://github.com/hijkpw/scripts</a></p>
<h1 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h1><h2 id="单服务器模式"><a href="#单服务器模式" class="headerlink" title="单服务器模式"></a>单服务器模式</h2><p>和其它的网络代理工具一样，你需要在一台配置了 V2Ray 的服务器，然后在自己的设备上安装 V2Ray 客户端，然后即可流畅地访问互联网。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/-1627307137161335" alt=""></p>
<p>一个 V2Ray 服务器可同时支持多台设备，使用不同的代理协议访问。同时，经过合理的配置，V2Ray 可以识别并区分需要代理和不需要代理的流量，直连的流量不需要绕路。</p>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><p>如果你不想在每一台设备上都配置路由，你也可以设置一台中转服务器，用于接收客户端发来的所有流量，然后在服务器中进行转发判断。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/-1627307140048337" alt=""></p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>在配置 V2Ray 之前，不妨先来看一下 V2Ray 的工作原理，以下是单个 V2Ray 进程的内部结构示意图。多个 V2Ray 之间互相独立，互不影响。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/-1627307142314339" alt=""></p>
<ul>
<li><p>需要配置至少一个入站协议（Inbound）和一个出站协议（Outbound）才可以正常工作。</p>
<ul>
<li>入站协议负责与客户端（如浏览器）通信：<ul>
<li>入站协议通常可以配置用户认证，如 ID 和密码等；</li>
</ul>
</li>
</ul>
</li>
<li><p>入站协议收到数据之后，会交给分发器（Dispatcher）进行分发；</p>
</li>
<li><p>出站协议负责将数据发给服务器，如另一台主机上的 V2Ray。</p>
</li>
<li><p>当有多个出站协议时，可以配置路由（Routing）来指定某一类流量由某一个出站协议发出。</p>
<ul>
<li>路由会在必要时查询 DNS 以获取更多信息来进行判断。</li>
</ul>
</li>
</ul>
<h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><h2 id="平台支持"><a href="#平台支持" class="headerlink" title="平台支持"></a>平台支持</h2><p>V2Ray 在以下平台中可用：</p>
<ul>
<li><p>Windows 7 及之后版本（x86 / amd64）；</p>
</li>
<li><p>Mac OS X 10.10 Yosemite 及之后版本（amd64）；</p>
</li>
<li><p>Linux 2.6.23 及之后版本（x86 / amd64 / arm / arm64 / mips64 / mips）；</p>
<ul>
<li>包括但不限于 Debian 7 / 8、Ubuntu 12.04 / 14.04 及后续版本、CentOS 6 / 7、Arch Linux；</li>
</ul>
</li>
<li><p>FreeBSD (x86 / amd64)；</p>
</li>
<li><p>OpenBSD (x86 / amd64)；</p>
</li>
<li><p>Dragonfly BSD (amd64)；</p>
</li>
</ul>
<h2 id="下载-V2Ray"><a href="#下载-V2Ray" class="headerlink" title="下载 V2Ray"></a>下载 V2Ray</h2><p>预编译的压缩包可以在如下几个站点找到：</p>
<ol>
<li>Github Release: <a href="https://github.com/v2ray/v2ray-core/releases" target="_blank" rel="noopener">github.com/v2ray/v2ray-core</a></li>
<li>Github 分流: <a href="https://github.com/v2ray/dist/" target="_blank" rel="noopener">github.com/v2ray/dist</a></li>
<li>Homebrew: <a href="https://github.com/v2ray/homebrew-v2ray" target="_blank" rel="noopener">github.com/v2ray/homebrew-v2ray</a></li>
<li>Arch Linux: <a href="https://www.archlinux.org/packages/community/x86_64/v2ray/" target="_blank" rel="noopener">packages/community/x86_64/v2ray/</a></li>
<li>Snapcraft: <a href="https://snapcraft.io/v2ray-core" target="_blank" rel="noopener">snapcraft.io/v2ray-core</a></li>
</ol>
<p>压缩包均为 zip 格式，找到对应平台的压缩包，下载解压即可使用。</p>
<h2 id="验证安装包"><a href="#验证安装包" class="headerlink" title="验证安装包"></a>验证安装包</h2><p>V2Ray 提供两种验证方式：</p>
<ol>
<li>安装包 zip 文件的 SHA1 / SHA256 摘要，在每个安装包对应的<code>.dgst</code>文件中可以找到。</li>
<li>可运行程序（v2ray 或 v2ray.exe）的 gpg 签名，文件位于安装包中的 v2ray.sig 或 v2ray.exe.sig。签名公钥可以<a href="https://raw.githubusercontent.com/v2ray/v2ray-core/master/release/verify/official_release.asc" target="_blank" rel="noopener">在代码库中</a>找到。</li>
</ol>
<h2 id="Windows-和-Mac-OS-安装方式"><a href="#Windows-和-Mac-OS-安装方式" class="headerlink" title="Windows 和 Mac OS 安装方式"></a>Windows 和 Mac OS 安装方式</h2><p>通过上述方式下载的压缩包，解压之后可看到 v2ray 或 v2ray.exe。直接运行即可。</p>
<h2 id="Linux-发行版仓库"><a href="#Linux-发行版仓库" class="headerlink" title="Linux 发行版仓库"></a>Linux 发行版仓库</h2><p>部分发行版可能已收录 V2Ray 到其官方维护和支持的软件仓库/软件源中。出于兼容性、适配性考虑，您可以考虑选用由您发行版开发团队维护的软件包或下文的安装脚本亦或基于已发布的二进制文件或源代码安装。</p>
<h2 id="Linux-安装脚本"><a href="#Linux-安装脚本" class="headerlink" title="Linux 安装脚本"></a>Linux 安装脚本</h2><p>V2Ray 提供了一个在 Linux 中的自动化安装脚本。这个脚本会自动检测有没有安装过 V2Ray，如果没有，则进行完整的安装和配置；如果之前安装过 V2Ray，则只更新 V2Ray 二进制程序而不更新配置。</p>
<p>以下指令假设已在 su 环境下，如果不是，请先运行 sudo su。</p>
<p>运行下面的指令下载并安装 V2Ray。当 yum 或 apt-get 可用的情况下，此脚本会自动安装 unzip 和 daemon。这两个组件是安装 V2Ray 的必要组件。如果你使用的系统不支持 yum 或 apt-get，请自行安装 unzip 和 daemon</p>
<pre><code>bash &lt;(curl -L -s https://install.direct/go.sh)</code></pre><p>此脚本会自动安装以下文件：</p>
<ul>
<li><p><code>/usr/bin/v2ray/v2ray</code>：V2Ray 程序；</p>
</li>
<li><p><code>/usr/bin/v2ray/v2ctl</code>：V2Ray 工具；</p>
</li>
<li><p><code>/etc/v2ray/config.json</code>：配置文件；</p>
</li>
<li><p><code>/usr/bin/v2ray/geoip.dat</code>：IP 数据文件</p>
</li>
<li><p><code>/usr/bin/v2ray/geosite.dat</code>：域名数据文件</p>
</li>
</ul>
<p>此脚本会配置自动运行脚本。自动运行脚本会在系统重启之后，自动运行 V2Ray。目前自动运行脚本只支持带有 Systemd 的系统，以及 Debian / Ubuntu 全系列。</p>
<p>运行脚本位于系统的以下位置：</p>
<ul>
<li><p><code>/etc/systemd/system/v2ray.service</code>: Systemd</p>
</li>
<li><p><code>/etc/init.d/v2ray</code>: SysV</p>
</li>
</ul>
<p>脚本运行完成后，你需要：</p>
<ol>
<li>编辑 /etc/v2ray/config.json 文件来配置你需要的代理方式；</li>
<li>运行 <strong>service v2ray start</strong> 来启动 V2Ray 进程；</li>
<li>之后可以使用 <strong>service v2ray start|stop|status|reload|restart|force-reload</strong> 控制 V2Ray 的运行。</li>
</ol>
<h3 id="go-sh-参数"><a href="#go-sh-参数" class="headerlink" title="go.sh 参数"></a>go.sh 参数</h3><p>go.sh 支持如下参数，可在手动安装时根据实际情况调整：</p>
<ul>
<li><p><code>-p</code> 或 <code>--proxy</code>: 使用代理服务器来下载 V2Ray 的文件，格式与 curl 接受的参数一致，比如 <code>"socks5://127.0.0.1:1080"</code> 或 <code>"http://127.0.0.1:3128"</code>。</p>
</li>
<li><p><code>-f</code> 或 <code>--force</code>: 强制安装。在默认情况下，如果当前系统中已有最新版本的 V2Ray，go.sh 会在检测之后就退出。如果需要强制重装一遍，则需要指定该参数。</p>
</li>
<li><p><code>--version</code>: 指定需要安装的版本，比如 <code>"v1.13"</code>。默认值为最新版本。</p>
</li>
<li><p><code>--local</code>: 使用一个本地文件进行安装。如果你已经下载了某个版本的 V2Ray，则可通过这个参数指定一个文件路径来进行安装。</p>
</li>
</ul>
<p>示例：</p>
<ul>
<li><p>使用地址为 127.0.0.1:1080 的 SOCKS 代理下载并安装最新版本：<code>./go.sh -p socks5://127.0.0.1:1080</code></p>
</li>
<li><p>安装本地的 v1.13 版本：<code>./go.sh --version v1.13 --local /path/to/v2ray.zip</code></p>
</li>
</ul>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>V2Ray 提供了两个预编译的 Docker image：</p>
<ul>
<li><p><a href="https://hub.docker.com/r/v2ray/official/" target="_blank" rel="noopener">v2ray/official</a>: 包含最新发布的版本，每周跟随新版本更新；</p>
</li>
<li><p><a href="https://hub.docker.com/r/v2ray/dev/" target="_blank" rel="noopener">v2ray/dev</a>: 包含由最新的代码编译而成的程序文件，随代码库更新；</p>
</li>
</ul>
<p>两个 image 的文件结构相同：</p>
<ul>
<li><p>/etc/v2ray/config.json: 配置文件</p>
</li>
<li><p>/usr/bin/v2ray/v2ray: V2Ray 主程序</p>
</li>
<li><p>/usr/bin/v2ray/v2ctl: V2Ray 辅助工具</p>
</li>
<li><p>/usr/bin/v2ray/geoip.dat: IP 数据文件</p>
</li>
<li><p>/usr/bin/v2ray/geosite.dat: 域名数据文件</p>
</li>
</ul>
<h1 id="新手上路"><a href="#新手上路" class="headerlink" title="新手上路"></a>新手上路</h1><p>在下载并安装了 V2Ray 之后，你需要对它进行一下配置。这里介绍一下简单的配置方式，只是为了演示。</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>在你的 PC （或手机）中，你需要运行 V2Ray 并使用下面的配置：</p>
<pre><code>{
  "inbounds": [{
    "port": 1080,  // SOCKS 代理端口，在浏览器中需配置代理并指向这个端口
    "listen": "127.0.0.1",
    "protocol": "socks",
    "settings": {
      "udp": true
    }
  }],
  "outbounds": [{
    "protocol": "vmess",
    "settings": {
      "vnext": [{
        "address": "server", // 服务器地址，请修改为你自己的服务器 ip 或域名
        "port": 10086,  // 服务器端口
        "users": [{ "id": "b831381d-6324-4d53-ad4f-8cda48b30811" }]
      }]
    }
  },{
    "protocol": "freedom",
    "tag": "direct",
    "settings": {}
  }],
  "routing": {
    "domainStrategy": "IPOnDemand",
    "rules": [{
      "type": "field",
      "ip": ["geoip:private"],
      "outboundTag": "direct"
    }]
  }
}</code></pre><p>上述配置唯一要改的地方就是你的服务器 IP，配置中已注明。上述配置会把除了局域网（比如访问路由器）之外的所有流量转发到你的服务器。</p>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>然后你需要一台防火墙外的服务器，来运行服务器端的 V2Ray。配置如下：</p>
<pre><code>{
  "inbounds": [{
    "port": 10086, // 服务器监听端口，必须和上面的一样
    "protocol": "vmess",
    "settings": {
      "clients": [{ "id": "b831381d-6324-4d53-ad4f-8cda48b30811" }]
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  }]
}</code></pre><p>服务器的配置中需要确保 <code>id</code> 和端口与客户端一致，就可以正常连接了。</p>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><ul>
<li><p>在 Windows 和 macOS 中，配置文件通常是 V2Ray 同目录下的 <code>config.json</code> 文件。直接运行 <code>v2ray</code> 或 <code>v2ray.exe</code> 即可。</p>
</li>
<li><p>在 Linux 中，配置文件通常位于 <code>/etc/v2ray/config.json</code> 文件。运行 <code>v2ray --config=/etc/v2ray/config.json</code>，或使用 systemd 等工具把 V2Ray 作为服务在后台运行。</p>
</li>
</ul>
<h1 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h1><h2 id="V2Ray"><a href="#V2Ray" class="headerlink" title="V2Ray"></a>V2Ray</h2><p>V2Ray 的程序文件的命令行参数如下：</p>
<pre><code>v2ray [-version] [-test] [-config=config.json] [-format=json]</code></pre><blockquote>
<pre><code>-version</code></pre></blockquote>
<p>只输出当前版本然后退出，不运行 V2Ray 主程序。</p>
<blockquote>
<pre><code>-test</code></pre></blockquote>
<p>测试配置文件有效性，如果有问题则输出错误信息，不运行 V2Ray 主程序。</p>
<blockquote>
<pre><code>-config</code></pre></blockquote>
<p>配置文件路径，可选的形式如下:</p>
<ul>
<li><p>本地路径，可以是一个绝对路径，或者相对路径。</p>
</li>
<li><p><code>"stdin:"</code>: 表示将从标准输入读取配置文件内容，调用者必须在输入完毕后关闭标准输入流。</p>
</li>
<li><p>以<code>http://</code>或<code>https://</code>(均为小写)开头: V2Ray 将尝试从这个远程地址加载配置文件。</p>
</li>
</ul>
<blockquote>
<pre><code>-format</code></pre></blockquote>
<p>配置文件格式，可选的值有：</p>
<ul>
<li><p><code>json</code>: JSON 格式；</p>
</li>
<li><p><code>pb</code> 或 <code>protobuf</code>: Protobuf 格式；</p>
</li>
</ul>
<p>当<code>-config</code>没有指定时，V2Ray 将先后尝试从以下路径加载<code>config.json</code>:</p>
<ul>
<li><p>工作目录（Working Directory）</p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/env.html" target="_blank" rel="noopener">环境变量</a>中<code>v2ray.location.asset</code>所指定的路径</p>
</li>
</ul>
<h2 id="V2Ctl"><a href="#V2Ctl" class="headerlink" title="V2Ctl"></a>V2Ctl</h2><p>V2Ctl 是一个集合，它有若干个子命令组成。全局的命令行形式如下：</p>
<pre><code>v2ctl &lt;command&gt; &lt;options&gt;</code></pre><blockquote>
<pre><code>command</code></pre></blockquote>
<p>子命令，有以下选项:</p>
<ul>
<li><p><code>api</code>: 调用 V2Ray 进程的远程控制指令。</p>
</li>
<li><p><code>config</code>: 从标准输入读取 JSON 格式的配置，然后从标准输出打印 Protobuf 格式的配置。</p>
</li>
<li><p><code>cert</code>: 生成 TLS 证书。</p>
</li>
<li><p><code>fetch</code>: 抓取远程文件。</p>
</li>
<li><p><code>tlsping</code>: (V2Ray 4.17+) 尝试进行 TLS 握手。</p>
</li>
<li><p><code>verify</code>: 验证文件是否由 Project V 官方签名。</p>
</li>
<li><p><code>uuid</code>: 输出一个随机的 UUID。</p>
</li>
</ul>
<h3 id="V2Ctl-Api"><a href="#V2Ctl-Api" class="headerlink" title="V2Ctl Api"></a>V2Ctl Api</h3><pre><code>v2ctl api [--server=127.0.0.1:8080] &lt;Service.Method&gt; &lt;Request&gt;</code></pre><p>调用 V2Ray 进程的远程控制指令。示例：</p>
<pre><code>v2ctl api --server=127.0.0.1:8080 LoggerService.RestartLogger ''</code></pre><h3 id="V2Ctl-Config"><a href="#V2Ctl-Config" class="headerlink" title="V2Ctl Config"></a>V2Ctl Config</h3><pre><code>v2ctl config</code></pre><p>此命令没有参数。它从标准输入读取 JSON 格式的配置，然后从标准输出打印 Protobuf 格式的配置。</p>
<h3 id="V2Ctl-Cert"><a href="#V2Ctl-Cert" class="headerlink" title="V2Ctl Cert"></a>V2Ctl Cert</h3><pre><code>v2ctl cert [--ca] [--domain=v2ray.com] [--expire=240h] [--name="V2Ray Inc"] [--org="V2Ray Inc] [--json] [--file=v2ray]</code></pre><p>生成一个 TLS 证书。</p>
<blockquote>
<pre><code>--ca</code></pre></blockquote>
<p>如果指定此选项，将会生成一个 CA 证书。</p>
<blockquote>
<pre><code>--domain</code></pre></blockquote>
<p>证书的 Alternative Name 项。该参数可以多次使用，来指定多个域名。比如<code>--domain=v2ray.com --domain=v2ray.cool</code>。</p>
<blockquote>
<pre><code>--expire</code></pre></blockquote>
<p>证书有效期。格式为 Golang 的<a href="https://golang.org/pkg/time/#ParseDuration" target="_blank" rel="noopener">时间长度</a>。</p>
<blockquote>
<pre><code>--name</code></pre></blockquote>
<p>证书的 Command Name 项。</p>
<blockquote>
<pre><code>--org</code></pre></blockquote>
<p>证书的 Orgnization 项。</p>
<blockquote>
<pre><code>--json</code></pre></blockquote>
<p>将生成的证书以 V2Ray 支持的 JSON 格式输出到标准输出。默认开启。</p>
<blockquote>
<pre><code>--file</code></pre></blockquote>
<p>将证书以 PEM 格式输出到文件。当指定 <code>--file=a</code> 时，将生成 <code>a_cert.pem</code> 和 <code>a_key.pem</code> 两个文件。</p>
<h3 id="V2Ctl-Fetch"><a href="#V2Ctl-Fetch" class="headerlink" title="V2Ctl Fetch"></a>V2Ctl Fetch</h3><pre><code>v2ctl fetch &lt;url&gt;</code></pre><p>抓取指定的 URL 的内容并输出，只支持 HTTP 和 HTTPS。</p>
<h3 id="V2Ctl-TlsPing"><a href="#V2Ctl-TlsPing" class="headerlink" title="V2Ctl TlsPing"></a>V2Ctl TlsPing</h3><pre><code>v2ctl tlsping &lt;domain&gt; --ip=[ip]</code></pre><p>向指定的域名发起 TLS 握手。</p>
<blockquote>
<p>domain</p>
</blockquote>
<p>目标域名</p>
<blockquote>
<p>–ip</p>
</blockquote>
<p>此域名的 IP 地址。如果未指定此参数，V2Ctl 将使用系统的 DNS 进行域名解析。</p>
<h3 id="V2Ctl-Verify"><a href="#V2Ctl-Verify" class="headerlink" title="V2Ctl Verify"></a>V2Ctl Verify</h3><pre><code>v2ctl verify [--sig=/path/to/sigfile] &lt;filepath&gt;</code></pre><p>此命令用于验证一个文件是否由 Project V 官方签名。</p>
<blockquote>
<pre><code>--sig</code></pre></blockquote>
<p>签名文件路径，默认值为待验证文件加入’.sig’后缀。</p>
<blockquote>
<pre><code>filepath</code></pre></blockquote>
<p>待验证文件路径。</p>
<h3 id="V2Ctl-UUID"><a href="#V2Ctl-UUID" class="headerlink" title="V2Ctl UUID"></a>V2Ctl UUID</h3><pre><code>v2ctl uuid</code></pre><p>此命令没有参数。每次运行都会输出一个新的 UUID。</p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="一般问题"><a href="#一般问题" class="headerlink" title="一般问题"></a>一般问题</h2><h3 id="制作-V2Ray-的目的是什么？"><a href="#制作-V2Ray-的目的是什么？" class="headerlink" title="制作 V2Ray 的目的是什么？"></a>制作 V2Ray 的目的是什么？</h3><p>对于已公开的合法信息，人民有自由获取的权利。同时，人民也有言论自由的权利。</p>
<h3 id="是否反对管制？"><a href="#是否反对管制？" class="headerlink" title="是否反对管制？"></a>是否反对管制？</h3><p>不反对管制。事实上任何事物都需要管制，以减少大众的生活成本，比如奶粉。但监管需要有法可依、有据可循。民众都认可的监管方式也是合理的，可接受的。</p>
<h3 id="Project-V-由谁主导开发？"><a href="#Project-V-由谁主导开发？" class="headerlink" title="Project V 由谁主导开发？"></a>Project V 由谁主导开发？</h3><p>我们是一群爱好自由的人们。由于政策压力，我们倾向于保持匿名，尽可能地不透露任何身份信息。</p>
<h2 id="V2Ray-使用相关"><a href="#V2Ray-使用相关" class="headerlink" title="V2Ray 使用相关"></a>V2Ray 使用相关</h2><h3 id="V2Ray-如何升级"><a href="#V2Ray-如何升级" class="headerlink" title="V2Ray 如何升级"></a>V2Ray 如何升级</h3><ul>
<li><p>重新下载安装包，或者</p>
</li>
<li><p>如果你使用安装脚本进行安装，重新运行安装脚本即可</p>
</li>
</ul>
<h3 id="V2Ray-闪退"><a href="#V2Ray-闪退" class="headerlink" title="V2Ray 闪退"></a>V2Ray 闪退</h3><ul>
<li><p>如果你使用 Linux 并开启了 systemd，可以使用 <code>journalctl -u v2ray</code> 查看 V2Ray 退出时的日志；</p>
</li>
<li><p>一般情况可以手动运行 <code>v2ray -config=&lt;config-file&gt; -test</code> 来查看错误信息；</p>
</li>
</ul>
<h3 id="兼容性保证"><a href="#兼容性保证" class="headerlink" title="兼容性保证"></a>兼容性保证</h3><ul>
<li><p>配置文件向后兼容至少一个大版本，即 V2Ray 4.x 可以正常加载 3.x 的配置文件。</p>
</li>
<li><p>所有基于 Protobuf 的通信协议，如 Api，向后兼容至少一个大版本。</p>
</li>
<li><p>所有基于二进制的通信协议，如 Shadowsocks 和 VMess。当服务器版本不低于客户端版本时，保持永久兼容；当客户端版本超过服务器版本时，保持至少 12 个小版本的兼容性。</p>
</li>
</ul>
<h2 id="V2Ray-错误信息"><a href="#V2Ray-错误信息" class="headerlink" title="V2Ray 错误信息"></a>V2Ray 错误信息</h2><h3 id="VMess-Invalid-User"><a href="#VMess-Invalid-User" class="headerlink" title="VMess: Invalid User"></a>VMess: Invalid User</h3><p>可能的原因：</p>
<ol>
<li>客户端和服务器端的用户 ID 不匹配；</li>
<li>客户端和服务器端的用户 alterId 不匹配；</li>
<li>客户端与服务器的时间不匹配，误差不能超过90秒钟；</li>
</ol>
<h3 id="Shadowsocks-Unknown-address-type"><a href="#Shadowsocks-Unknown-address-type" class="headerlink" title="Shadowsocks: Unknown address type"></a>Shadowsocks: Unknown address type</h3><p>可能的原因：</p>
<ol>
<li>Shadowsocks 协议的加密方式或是密码不匹配；</li>
</ol>
<h3 id="Socks-Unknown-Socks-version-67"><a href="#Socks-Unknown-Socks-version-67" class="headerlink" title="Socks: Unknown Socks version: 67"></a>Socks: Unknown Socks version: 67</h3><p>可能的原因：</p>
<ul>
<li>你开启的是 Socks 代理，但在浏览器中配置了 HTTP 代理</li>
</ul>
<p>解决方案：</p>
<ul>
<li>在 V2Ray 中配置一个 HTTP 入站代理，然后把浏览器的设置指向这个代理</li>
</ul>
<h2 id="其它软件错误"><a href="#其它软件错误" class="headerlink" title="其它软件错误"></a>其它软件错误</h2><h3 id="访问-Google-时，浏览器中显示证书无效"><a href="#访问-Google-时，浏览器中显示证书无效" class="headerlink" title="访问 Google 时，浏览器中显示证书无效"></a>访问 Google 时，浏览器中显示证书无效</h3><p>错误信息：攻击者可能会试图从 <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a> 窃取您的信息（例如：密码、通讯内容或信用卡信息）。了解详情 NET::ERR_CERT_COMMON_NAME_INVALID</p>
<p>原因：你的 DNS 缓存可能已被污染。</p>
<p>解决方案：</p>
<ul>
<li><p>需要在使用代理的情况下，清空缓存并重新抓取 DNS 数据</p>
</li>
<li><p>在 V2Ray 中可使用<code>sniffing</code>功能克服一部分 DNS 污染。</p>
</li>
</ul>
<h2 id="项目授权"><a href="#项目授权" class="headerlink" title="项目授权"></a>项目授权</h2><p>Project V 使用以下方式进行授权</p>
<h3 id="V2Ray-1"><a href="#V2Ray-1" class="headerlink" title="V2Ray"></a>V2Ray</h3><p>源代码以官方发布的安装包，使用 MIT 协议授权。包括以下代码仓库中的源代码及安装包：</p>
<ul>
<li><p><a href="https://www.github.com/v2ray/v2ray-core/" target="_blank" rel="noopener">v2ray/v2ray-core</a></p>
</li>
<li><p><a href="https://www.github.com/v2ray/ext" target="_blank" rel="noopener">v2ray/ext</a></p>
</li>
</ul>
<h3 id="官方网站"><a href="#官方网站" class="headerlink" title="官方网站"></a>官方网站</h3><p>官方网站（<a href="https://www.v2ray.com/" target="_blank" rel="noopener">v2ray.com</a>）以<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="noopener">知识共享署名 4.0 国际许可协议</a>协议授权。</p>
<ul>
<li><p>包括网站中所有可见的文字内容和图片。</p>
</li>
<li><p>包括 <a href="https://www.v2ray.com/resources/v2ray_1024.png" target="_blank" rel="noopener">Project V 图标文件</a>。</p>
</li>
<li><p>包括生成网站所使用到的源代码，即<a href="https://www.github.com/v2ray/manual" target="_blank" rel="noopener">v2ray/manual</a>。</p>
</li>
</ul>
<h3 id="软件截图和其它文件"><a href="#软件截图和其它文件" class="headerlink" title="软件截图和其它文件"></a>软件截图和其它文件</h3><p>第三方所创作的内容，其版权归其创作者所有。Project V 放弃对这些内容的所有权。</p>
<ul>
<li><p>包括 Project V 使用过程中的截图。</p>
</li>
<li><p>包括运行 Project V 所需的配置文件。</p>
</li>
<li><p>包括 Project V 运行时产生的日志文件。</p>
</li>
</ul>
<h3 id="其它内容"><a href="#其它内容" class="headerlink" title="其它内容"></a>其它内容</h3><p>未在上述提及的内容，其版权视具体情况而定。</p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><p>V2Ray 本身使用基于 <a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">Protobuf</a> 的配置。由于 Protobuf 的文本格式不方便阅读，V2Ray 同时也支持 JSON 格式的配置。在运行之前，V2Ray 会自动将 JSON 转换为对应的 Protobuf。换言之，V2Ray 将来也可能会支持其它格式的配置。</p>
<p>以下介绍一下基于 JSON 格式的配置。</p>
<p>JSON，全称 <a href="https://en.wikipedia.org/wiki/JSON" target="_blank" rel="noopener">JavaScript Object Notation</a>，简而言之是 Javascript 中的对象（Object）。一个 JSON 文件包含一个完整的对象，以大括号“{”开头，大括号“}”结束。</p>
<p>一个 JSON 对象包含一系列的键值对（Key-Value Pair），一个键是一个字符串（String），而值有多种类型，常见的有字符串（String）、数字（Number）、布尔（Bool）、数组（Array）和对象（Object）。下面是一个简单的 JSON 对象示例：</p>
<pre><code>{
  "stringValue": "This is a string.",
  "numberValue": 42,
  "boolValue": true,
  "arrayValue": ["this", "is", "a", "string", "array"],
  "objectValue": {
    "another": "object"
  }
}</code></pre><p>V2Ray 的 JSON 格式支持注释，可使用“//”或者“/* */”来进行注释。在不支持注释的编辑器中可能被显示为“错误”，但实际上是可以正常使用的。</p>
<h2 id="JSON-数据类型"><a href="#JSON-数据类型" class="headerlink" title="JSON 数据类型"></a>JSON 数据类型</h2><p>这里介绍一下常用的数据类型，在之后其它的配置中会用到。</p>
<blockquote>
<p><code>boolean</code>: true | false</p>
</blockquote>
<p>布尔值，只有<code>true</code>和<code>false</code>两种取值，不带引号。</p>
<blockquote>
<pre><code>number</code></pre></blockquote>
<p>数字，在 V2Ray 的使用中通常为非负整数，即<code>0</code>、<code>53</code>…… 数字在 JSON 格式中不带引号。</p>
<blockquote>
<pre><code>string</code></pre></blockquote>
<p>字符串，由引号包含的一串字符，如无特殊说明，字符的内容不限。</p>
<blockquote>
<p><code>array</code>: []</p>
</blockquote>
<p>数组，由方括号包含的一组元素，如字符串数组表示为<code>[string]</code>。</p>
<blockquote>
<p><code>object</code>: {}</p>
</blockquote>
<p>对象，一组键值对。样例见本文上方的示例。</p>
<p>通常一个键值对的后面需要有一个逗号”,”，但如果这个键值对后面紧跟一个大括号”｝”的话，则一定不能有逗号。</p>
<h2 id="V2Ray-常用数据类型"><a href="#V2Ray-常用数据类型" class="headerlink" title="V2Ray 常用数据类型"></a>V2Ray 常用数据类型</h2><blockquote>
<p><code>map</code>: object {string:string}</p>
</blockquote>
<p>一组键值对，其类型在括号内指出。每一个键和值的类型对应相同。</p>
<blockquote>
<p><code>address</code>: string</p>
</blockquote>
<p>字符串，表示一个 IP 地址或域名，形如：<code>"8.8.8.8"</code> 或 <code>"www.v2ray.com"</code></p>
<blockquote>
<p><code>address_port</code>: string</p>
</blockquote>
<p>字符串，表示一个地址和端口，常见的形式如：<code>"8.8.8.8:53"</code>，或者 <code>"www.v2ray.com:80"</code>。在一部分配置中，地址部分可以省略，如<code>":443"</code>。</p>
<h1 id="配置文件格式"><a href="#配置文件格式" class="headerlink" title="配置文件格式"></a>配置文件格式</h1><p>V2Ray 的配置文件形式如下，客户端和服务器通用一种形式，只是实际的配置不一样。</p>
<pre><code>{
  "log": {},
  "api": {},
  "dns": {},
  "stats": {},
  "routing": {},
  "policy": {},
  "reverse": {},
  "inbounds": [],
  "outbounds": [],
  "transport": {}
}</code></pre><blockquote>
<p><code>log</code>: <a href="https://www.v2ray.com/chapter_02/01_overview.html#logobject" target="_blank" rel="noopener">LogObject</a></p>
</blockquote>
<p>日志配置，表示 V2Ray 如何输出日志。</p>
<blockquote>
<p><code>api</code>: <a href="https://www.v2ray.com/chapter_02/api.html" target="_blank" rel="noopener">ApiObject</a></p>
</blockquote>
<p>内置的远程控置 API。</p>
<blockquote>
<p><code>dns</code>: <a href="https://www.v2ray.com/chapter_02/04_dns.html" target="_blank" rel="noopener">DnsObject</a></p>
</blockquote>
<p>内置的 DNS 服务器，若此项不存在，则默认使用本机的 DNS 设置。</p>
<blockquote>
<p><code>routing</code>: <a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">RoutingObject</a></p>
</blockquote>
<p><a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">路由配置</a></p>
<blockquote>
<p><code>policy</code>: <a href="https://www.v2ray.com/chapter_02/policy.html" target="_blank" rel="noopener">PolicyObject</a></p>
</blockquote>
<p>本地策略可进行一些权限相关的配置</p>
<blockquote>
<p><code>inbounds</code>: [<a href="https://www.v2ray.com/chapter_02/01_overview.html#inboundobject" target="_blank" rel="noopener">InboundObject</a>]</p>
</blockquote>
<p>一个数组，每个元素是一个入站连接配置。</p>
<blockquote>
<p><code>outbounds</code>: [<a href="https://www.v2ray.com/chapter_02/01_overview.html#outboundobject" target="_blank" rel="noopener">OutboundObject</a>]</p>
</blockquote>
<p>一个数组，每个元素是一个出站连接配置。列表中的第一个元素作为主出站协议。当路由匹配不存在或没有匹配成功时，流量由主出站协议发出。</p>
<blockquote>
<p><code>transport</code>: <a href="https://www.v2ray.com/chapter_02/05_transport.html" target="_blank" rel="noopener">TransportObject</a></p>
</blockquote>
<p>用于配置 V2Ray 如何与其它服务器建立和使用网络连接。详见底层传输配置</p>
<blockquote>
<p><code>stats</code>: <a href="https://www.v2ray.com/chapter_02/stats.html" target="_blank" rel="noopener">StatsObject</a></p>
</blockquote>
<p>当此项存在时，开启统计信息。</p>
<blockquote>
<p><code>reverse</code>: <a href="https://www.v2ray.com/chapter_02/reverse.html" target="_blank" rel="noopener">ReverseObject</a></p>
</blockquote>
<p>反向代理配置。</p>
<h2 id="LogObject"><a href="#LogObject" class="headerlink" title="LogObject"></a>LogObject</h2><pre><code>{
  "access": "文件地址",
  "error": "文件地址",
  "loglevel": "warning"
}</code></pre><blockquote>
<p><code>access</code>: string</p>
</blockquote>
<p>访问日志的文件地址，其值是一个合法的文件地址，如<code>"/tmp/v2ray/_access.log"</code>（Linux）或者<code>"C:\\Temp\\v2ray\\_access.log"</code>（Windows）。当此项不指定或为空值时，表示将日志输出至 stdout。V2Ray 4.20 加入了特殊值<code>none</code>，即关闭access log。</p>
<blockquote>
<p><code>error</code>: string</p>
</blockquote>
<p>错误日志的文件地址，其值是一个合法的文件地址，如<code>"/tmp/v2ray/_error.log"</code>（Linux）或者<code>"C:\\Temp\\v2ray\\_error.log"</code>（Windows）。当此项不指定或为空值时，表示将日志输出至 stdout。V2Ray 4.20 加入了特殊值<code>none</code>，即关闭error log（跟<code>loglevel: "none"</code>等价）。</p>
<blockquote>
<p><code>loglevel</code>: “debug” | “info” | “warning” | “error” | “none”</p>
</blockquote>
<p>错误日志的级别。默认值为<code>"warning"</code>。</p>
<ul>
<li><p><code>"debug"</code>: 只有开发人员能看懂的信息。同时包含所有<code>"info"</code>内容。</p>
</li>
<li><p><code>"info"</code>: V2Ray 在运行时的状态，不影响正常使用。同时包含所有<code>"warning"</code>内容。</p>
</li>
<li><p><code>"warning"</code>: V2Ray 遇到了一些问题，通常是外部问题，不影响 V2Ray 的正常运行，但有可能影响用户的体验。同时包含所有<code>"error"</code>内容。</p>
</li>
<li><p><code>"error"</code>: V2Ray 遇到了无法正常运行的问题，需要立即解决。</p>
</li>
<li><p><code>"none"</code>: 不记录任何内容。</p>
</li>
</ul>
<h2 id="InboundObject"><a href="#InboundObject" class="headerlink" title="InboundObject"></a>InboundObject</h2><p>入站连接用于接收从客户端（浏览器或上一级代理服务器）发来的数据，可用的协议请见<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">协议列表</a>。</p>
<pre><code>{
  "port": 1080,
  "listen": "127.0.0.1",
  "protocol": "协议名称",
  "settings": {},
  "streamSettings": {},
  "tag": "标识",
  "sniffing": {
    "enabled": false,
    "destOverride": ["http", "tls"]
  },
  "allocate": {
    "strategy": "always",
    "refresh": 5,
    "concurrency": 3
  }
}</code></pre><blockquote>
<p><code>port</code>: number | “env:variable” | string</p>
</blockquote>
<p>端口。接受的格式如下:</p>
<ul>
<li><p>整型数值: 实际的端口号。</p>
</li>
<li><p>环境变量: 以<code>"env:"</code>开头，后面是一个环境变量的名称，如<code>"env:PORT"</code>。V2Ray 会以字符串形式解析这个环境变量。</p>
</li>
<li><p>字符串: 可以是一个数值类型的字符串，如<code>"1234"</code>；或者一个数值范围，如<code>"5-10"</code>表示端口 5 到端口 10 这 6 个端口。</p>
</li>
</ul>
<p>当只有一个端口时，V2Ray 会在此端口监听入站连接。当指定了一个端口范围时，取决于<code>allocate</code>设置。</p>
<blockquote>
<p><code>listen</code>: address</p>
</blockquote>
<p>监听地址，只允许 IP 地址，默认值为<code>"0.0.0.0"</code>，表示接收所有网卡上的连接。除此之外，必须指定一个现有网卡的地址。</p>
<blockquote>
<p><code>protocol</code>: string</p>
</blockquote>
<p>连接协议名称，可选的值见<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">协议列表</a>。</p>
<blockquote>
<p><code>settings</code>: InboundConfigurationObject</p>
</blockquote>
<p>具体的配置内容，视协议不同而不同。详见每个协议中的<code>InboundConfigurationObject</code>。</p>
<blockquote>
<p><code>streamSettings</code>: <a href="https://www.v2ray.com/chapter_02/05_transport.html#perproxy" target="_blank" rel="noopener">StreamSettingsObject</a>。</p>
</blockquote>
<p><a href="https://www.v2ray.com/chapter_02/05_transport.html#perproxy" target="_blank" rel="noopener">底层传输配置</a></p>
<blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>此入站连接的标识，用于在其它的配置中定位此连接。当其不为空时，其值必须在所有<code>tag</code>中唯一。</p>
<blockquote>
<p><code>sniffing</code>: <a href="https://www.v2ray.com/chapter_02/01_overview.html#sniffingobject" target="_blank" rel="noopener">SniffingObject</a></p>
</blockquote>
<p>尝试探测流量的类型</p>
<blockquote>
<p><code>allocate</code>: <a href="https://www.v2ray.com/chapter_02/01_overview.html#allocateobject" target="_blank" rel="noopener">AllocateObject</a></p>
</blockquote>
<p>端口分配设置</p>
<h3 id="SniffingObject"><a href="#SniffingObject" class="headerlink" title="SniffingObject"></a>SniffingObject</h3><pre><code>{
  "enabled": false,
  "destOverride": ["http", "tls"]
}</code></pre><blockquote>
<p><code>enabled</code>: true | false</p>
</blockquote>
<p>是否开启流量探测。</p>
<blockquote>
<p><code>destOverride</code>: [“http” | “tls”]</p>
</blockquote>
<p>当流量为指定类型时，按其中包括的目标地址重置当前连接的目标。</p>
<h3 id="AllocateObject"><a href="#AllocateObject" class="headerlink" title="AllocateObject"></a>AllocateObject</h3><pre><code>{
  "strategy": "always",
  "refresh": 5,
  "concurrency": 3
}</code></pre><blockquote>
<p><code>strategy</code>: “always” | “random”</p>
</blockquote>
<p>端口分配策略。<code>"always"</code>表示总是分配所有已指定的端口，<code>port</code>中指定了多少个端口，V2Ray 就会监听这些端口。<code>"random"</code>表示随机开放端口，每隔<code>refresh</code>分钟在<code>port</code>范围中随机选取<code>concurrency</code>个端口来监听。</p>
<blockquote>
<p><code>refresh</code>: number</p>
</blockquote>
<p>随机端口刷新间隔，单位为分钟。最小值为<code>2</code>，建议值为<code>5</code>。这个属性仅当<code>strategy = random</code>时有效。</p>
<blockquote>
<p><code>concurrency</code>: number</p>
</blockquote>
<p>随机端口数量。最小值为<code>1</code>，最大值为<code>port</code>范围的三分之一。建议值为<code>3</code>。</p>
<h2 id="OutboundObject"><a href="#OutboundObject" class="headerlink" title="OutboundObject"></a>OutboundObject</h2><p>出站连接用于向远程网站或下一级代理服务器发送数据，可用的协议请见<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">协议列表</a>。</p>
<pre><code>{
  "sendThrough": "0.0.0.0",
  "protocol": "协议名称",
  "settings": {},
  "tag": "标识",
  "streamSettings": {},
  "proxySettings": {
    "tag": "another-outbound-tag"
  },
  "mux": {}
}</code></pre><blockquote>
<p><code>sendThrough</code>: address</p>
</blockquote>
<p>用于发送数据的 IP 地址，当主机有多个 IP 地址时有效，默认值为<code>"0.0.0.0"</code>。</p>
<blockquote>
<p><code>protocol</code>: string</p>
</blockquote>
<p>连接协议名称，可选的值见<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">协议列表</a>。</p>
<blockquote>
<p><code>settings</code>: OutboundConfigurationObject</p>
</blockquote>
<p>具体的配置内容，视协议不同而不同。详见每个协议中的<code>OutboundConfigurationObject</code>。</p>
<blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>此出站连接的标识，用于在其它的配置中定位此连接。当其值不为空时，必须在所有 tag 中唯一。</p>
<blockquote>
<p><code>streamSettings</code>: <a href="https://www.v2ray.com/chapter_02/05_transport.html#perproxy" target="_blank" rel="noopener">StreamSettingsObject</a>。</p>
</blockquote>
<p><a href="https://www.v2ray.com/chapter_02/05_transport.html#perproxy" target="_blank" rel="noopener">底层传输配置</a></p>
<blockquote>
<p><code>proxySettings</code>: <a href="https://www.v2ray.com/chapter_02/01_overview.html#proxysettingsobject" target="_blank" rel="noopener">ProxySettingsObject</a></p>
</blockquote>
<p>出站代理配置。当出站代理生效时，此出站协议的<code>streamSettings</code>将不起作用。</p>
<blockquote>
<p><code>mux</code>: <a href="https://www.v2ray.com/chapter_02/mux.html" target="_blank" rel="noopener">MuxObject</a></p>
</blockquote>
<p><a href="https://www.v2ray.com/chapter_02/mux.html" target="_blank" rel="noopener">Mux 配置</a>。</p>
<h3 id="ProxySettingsObject"><a href="#ProxySettingsObject" class="headerlink" title="ProxySettingsObject"></a>ProxySettingsObject</h3><pre><code>{
  "tag": "another-outbound-tag"
}</code></pre><blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>当指定另一个出站协议的标识时，此出站协议发出的数据，将被转发至所指定的出站协议发出。</p>
<h1 id="V2Ray-协议列表"><a href="#V2Ray-协议列表" class="headerlink" title="V2Ray 协议列表"></a>V2Ray 协议列表</h1><p>V2Ray 支持以下协议：</p>
<ul>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/blackhole.html" target="_blank" rel="noopener">Blackhole</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/dokodemo.html" target="_blank" rel="noopener">Dokodemo-door</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/freedom.html" target="_blank" rel="noopener">Freedom</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/http.html" target="_blank" rel="noopener">HTTP</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/mtproto.html" target="_blank" rel="noopener">MTProto</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/shadowsocks.html" target="_blank" rel="noopener">Shadowsocks</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/socks.html" target="_blank" rel="noopener">Socks</a></p>
</li>
<li><p><a href="https://www.v2ray.com/chapter_02/protocols/vmess.html" target="_blank" rel="noopener">VMess</a></p>
</li>
</ul>
<h1 id="Blackhole"><a href="#Blackhole" class="headerlink" title="Blackhole"></a>Blackhole</h1><ul>
<li><p>名称: <code>blackhole</code></p>
</li>
<li><p>类型: 出站协议</p>
</li>
</ul>
<p>Blackhole（黑洞）是一个出站数据协议，它会阻碍所有数据的出站，配合<a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">路由（Routing）</a>一起使用，可以达到禁止访问某些网站的效果。</p>
<h2 id="OutboundConfigurationObject"><a href="#OutboundConfigurationObject" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "response": {
    "type": "none"
  }
}</code></pre><blockquote>
<p><code>response</code>: <a href="https://www.v2ray.com/chapter_02/protocols/blackhole.html#responseobject" target="_blank" rel="noopener">ResponseObject</a></p>
</blockquote>
<p>配置黑洞的响应数据。Blackhole 会在收到待转发数据之后，发送指定的响应数据，然后关闭连接。待转发的数据将被丢弃。如不指定此项，Blackhole 将直接关闭连接。</p>
<h3 id="ResponseObject"><a href="#ResponseObject" class="headerlink" title="ResponseObject"></a>ResponseObject</h3><pre><code>{
  "type": "none"
}</code></pre><blockquote>
<p><code>type</code>: “http” | “none”</p>
</blockquote>
<p>当<code>type</code>为<code>"none"</code>（默认值）时，Blackhole将直接关闭连接。当<code>type</code>为<code>"http"</code>时，Blackhole会发回一个简单的 HTTP 403 数据包，然后关闭连接。</p>
<h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><ul>
<li><p>名称: <code>dns</code></p>
</li>
<li><p>类型: 出站协议</p>
</li>
</ul>
<p>DNS 是一个出站协议，主要用于拦截和转发 DNS 查询。此出站协议只能接收 DNS 流量（包含基于 UDP 和 TCP 协议的查询），其它类型的流量会导致错误。</p>
<p>在处理 DNS 查询时，此出站协议会将 IP 查询（即 A 和 AAAA）转发给内置的 <a href="https://www.v2ray.com/chapter_02/04_dns.html" target="_blank" rel="noopener">DNS 服务器</a>。其它类型的查询流量将被转发至它们原本的目标地址。</p>
<h2 id="OutboundConfigurationObject-1"><a href="#OutboundConfigurationObject-1" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
    "network": "tcp",
    "address": "1.1.1.1",
    "port": 53
}</code></pre><blockquote>
<p><code>network</code>: “tcp” | “udp”</p>
</blockquote>
<p>(V2Ray 4.16+) 修改 DNS 流量的传输层协议，可选的值有<code>"tcp"</code>和<code>"udp"</code>。当不指定时，保持来源的传输方式不变。</p>
<blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>(V2Ray 4.16+) 修改 DNS 服务器地址。当不指定时，保持来源中指定的地址不变。</p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>(V2Ray 4.16+) 修改 DNS 服务器端口。当不指定时，保持来源中指定的端口不变。</p>
<h1 id="Dokodemo-door"><a href="#Dokodemo-door" class="headerlink" title="Dokodemo-door"></a>Dokodemo-door</h1><ul>
<li><p>名称: <code>dokodemo-door</code></p>
</li>
<li><p>类型: 入站协议</p>
</li>
</ul>
<p>Dokodemo door（任意门）是一个入站数据协议，它可以监听一个本地端口，并把所有进入此端口的数据发送至指定服务器的一个端口，从而达到端口映射的效果。</p>
<h2 id="InboundConfigurationObject"><a href="#InboundConfigurationObject" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><pre><code>{
  "address": "8.8.8.8",
  "port": 53,
  "network": "tcp",
  "timeout": 0,
  "followRedirect": false,
  "userLevel": 0
}</code></pre><blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>将流量转发到此地址。可以是一个 IP 地址，形如<code>"1.2.3.4"</code>，或者一个域名，形如<code>"v2ray.com"</code>。字符串类型。</p>
<p>当 <code>followRedirect</code>（见下文）为 <code>true</code> 时，<code>address</code> 可为空。</p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>将流量转发到目标地址的指定端口，范围[1, 65535]，数值类型。必填参数。</p>
<blockquote>
<p><code>network</code>: “tcp” | “udp” | “tcp,udp”</p>
</blockquote>
<p>可接收的网络协议类型。比如当指定为<code>"tcp"</code>时，任意门仅会接收 TCP 流量。默认值为<code>"tcp"</code>。</p>
<blockquote>
<p><code>timeout</code>: number</p>
</blockquote>
<p>入站数据的时间限制（秒），默认值为 300。</p>
<p>V2Ray 3.1 后等价于对应用户等级的 <code>connIdle</code> 策略</p>
<blockquote>
<p><code>followRedirect</code>: true | false</p>
</blockquote>
<p>当值为<code>true</code>时，dokodemo-door 会识别出由 iptables 转发而来的数据，并转发到相应的目标地址。详见<a href="https://www.v2ray.com/chapter_02/05_transport.html" target="_blank" rel="noopener">传输配置</a>中的<code>tproxy</code>设置。</p>
<blockquote>
<p><code>userLevel</code>: number</p>
</blockquote>
<p>用户等级，所有连接都会使用这个用户等级。</p>
<h2 id="透明代理配置样例"><a href="#透明代理配置样例" class="headerlink" title="透明代理配置样例"></a>透明代理配置样例</h2><p>V2Ray 中增加一个 dokodemo-door 的入站协议：</p>
<pre><code>{
  "network": "tcp,udp",
  "timeout": 30,
  "followRedirect": true
}</code></pre><p>配置 iptables：</p>
<pre><code># Create new chain
iptables -t nat -N V2RAY
iptables -t mangle -N V2RAY
iptables -t mangle -N V2RAY_MARK

# Ignore your V2Ray server's addresses
# It's very IMPORTANT, just be careful.
iptables -t nat -A V2RAY -d 123.123.123.123 -j RETURN

# Ignore LANs and any other addresses you'd like to bypass the proxy
# See Wikipedia and RFC5735 for full list of reserved networks.
iptables -t nat -A V2RAY -d 0.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 10.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 127.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -d 169.254.0.0/16 -j RETURN
iptables -t nat -A V2RAY -d 172.16.0.0/12 -j RETURN
iptables -t nat -A V2RAY -d 192.168.0.0/16 -j RETURN
iptables -t nat -A V2RAY -d 224.0.0.0/4 -j RETURN
iptables -t nat -A V2RAY -d 240.0.0.0/4 -j RETURN

# Anything else should be redirected to Dokodemo-door's local port
iptables -t nat -A V2RAY -p tcp -j REDIRECT --to-ports 12345

# Add any UDP rules
ip route add local default dev lo table 100
ip rule add fwmark 1 lookup 100
iptables -t mangle -A V2RAY -p udp --dport 53 -j TPROXY --on-port 12345 --tproxy-mark 0x01/0x01
iptables -t mangle -A V2RAY_MARK -p udp --dport 53 -j MARK --set-mark 1

# Apply the rules
iptables -t nat -A OUTPUT -p tcp -j V2RAY
iptables -t mangle -A PREROUTING -j V2RAY
iptables -t mangle -A OUTPUT -j V2RAY_MARK</code></pre><h1 id="Freedom"><a href="#Freedom" class="headerlink" title="Freedom"></a>Freedom</h1><ul>
<li><p>名称：<code>freedom</code></p>
</li>
<li><p>类型：出站协议</p>
</li>
</ul>
<p>Freedom 是一个出站协议，可以用来向任意网络发送（正常的） TCP 或 UDP 数据。</p>
<h2 id="OutboundConfigurationObject-2"><a href="#OutboundConfigurationObject-2" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "domainStrategy": "AsIs",
  "redirect": "127.0.0.1:3366",
  "userLevel": 0
}</code></pre><blockquote>
<p><code>domainStrategy</code>: “AsIs” | “UseIP” | “UseIPv4” | “UseIPv6”</p>
</blockquote>
<p>在目标地址为域名时，Freedom 可以直接向此域名发出连接（<code>"AsIs"</code>），或者将域名解析为 IP 之后再建立连接（<code>"UseIP"</code>、<code>"UseIPv4"</code>、<code>"UseIPv6"</code>）。解析 IP 的步骤会使用 V2Ray <a href="https://www.v2ray.com/chapter_02/04_dns.html" target="_blank" rel="noopener">内建的 DNS</a>。默认值为<code>"AsIs"</code>。</p>
<p>(V2Ray 4.6+) 当使用<code>"UseIP"</code>模式，并且<a href="https://www.v2ray.com/chapter_02/01_overview.html#outboundobject" target="_blank" rel="noopener">出站连接配置</a>中指定了<code>sendThrough</code>时，Freedom 会根据<code>sendThrough</code>的值自动判断所需的IP类型，IPv4 或 IPv6。</p>
<p>(V2Ray 4.7+) 当使用<code>"UseIPv4"</code>或<code>"UseIPv6"</code>模式时，Freedom 会只使用对应的 IPv4 或 IPv6 地址。当<code>sendThrough</code>指定了不匹配的本地地址时，将导致连接失败。</p>
<blockquote>
<p><code>redirect</code>: address_port</p>
</blockquote>
<p>Freedom 会强制将所有数据发送到指定地址（而不是入站协议指定的地址）。其值为一个字符串，样例：<code>"127.0.0.1:80"</code>, <code>":1234"</code>。当地址不指定时，如<code>":443"</code>，Freedom 不会修改原先的目标地址。当端口为<code>0</code>时，如<code>"v2ray.com:0"</code>，Freedom 不会修改原先的端口。</p>
<blockquote>
<p><code>userLevel</code>: number</p>
</blockquote>
<p>用户等级，所有连接都使用这一等级。</p>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><ul>
<li><p>名称：<code>http</code></p>
</li>
<li><p>类型：入站 / 出站</p>
</li>
</ul>
<p>HTTP 的配置分为两部分，<code>InboundConfigurationObject</code>和<code>OutboundConfigurationObject</code>，分别对应入站和出站协议配置中的<code>settings</code>项。</p>
<h2 id="InboundConfigurationObject-1"><a href="#InboundConfigurationObject-1" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><pre><code>{
  "timeout": 0,
  "accounts": [
    {
      "user": "my-username",
      "pass": "my-password"
    }
  ],
  "allowTransparent": false,
  "userLevel": 0
}</code></pre><p>应该注意，虽然<code>http inbound</code>可以提供公共服务，但http协议没有对传输加密，不适宜经公网中传输，更容易成为被人用作攻击的肉鸡。<code>http inbound</code>更有意义的用法是在局域网或本机环境下监听，为其他程序提供本地服务。</p>
<blockquote>
<p><code>timeout</code>: number</p>
</blockquote>
<p>从客户端读取数据的超时设置（秒），0 表示不限时。默认值为 300。 V2Ray 3.1 后等价于对应用户等级的 <code>connIdle</code> 策略。</p>
<blockquote>
<p><code>accounts</code>: [<a href="https://www.v2ray.com/chapter_02/protocols/http.html#accountobject" target="_blank" rel="noopener">AccountObject</a>]</p>
</blockquote>
<p>一个数组，数组中每个元素为一个用户帐号。默认值为空。</p>
<p>当 <code>accounts</code> 非空时，HTTP 代理将对入站连接进行 Basic Authentication 验证。</p>
<blockquote>
<p><code>allowTransparent</code>: true | false</p>
</blockquote>
<p>当为<code>true</code>时，会转发所有 HTTP 请求，而非只是代理请求。若配置不当，开启此选项会导致死循环。</p>
<blockquote>
<p><code>userLevel</code>: number</p>
</blockquote>
<p>用户等级，所有连接使用这一等级。</p>
<h3 id="AccountObject"><a href="#AccountObject" class="headerlink" title="AccountObject"></a>AccountObject</h3><pre><code>{
  "user": "my-username",
  "pass": "my-password"
}</code></pre><blockquote>
<p><code>user</code>: string</p>
</blockquote>
<p>用户名，字符串类型。必填。</p>
<blockquote>
<p><code>pass</code>: string</p>
</blockquote>
<p>密码，字符串类型。必填。</p>
<p>在 Linux 中使用以下环境变量即可在当前 session 使用全局 HTTP 代理（很多软件都支持这一设置，也有不支持的）。</p>
<ul>
<li><p><code>export http_proxy=http://127.0.0.1:8080/</code> (地址须改成你配置的 HTTP 入站代理地址)</p>
</li>
<li><p><code>export https_proxy=$http_proxy</code></p>
</li>
</ul>
<h2 id="OutboundConfigurationObject-3"><a href="#OutboundConfigurationObject-3" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "servers": [
    {
      "address": "192.168.108.1",
      "port": 3128,
      "users": [
        {
          "user": "my-username",
          "pass": "my-password"
        }
      ]
    }
  ]
}</code></pre><p>(V2ray 4.21.0+)</p>
<p>应该注意，虽然<code>http outbound</code>可以作为对外访问的配置，但<code>http proxy</code>协议没有对传输加密，不适宜经公网中传输，且因不支持udp传输将会导致core功能受限（Routing过程的的DNS查询不可用）。<code>http outbound</code>更有意义的用法是在特殊情况下，只能使用<code>http proxy</code>对外访问内部网络中，作为为其他协议连接代理服务器的前置代理使用（见<code>OutboundObject</code>的<code>ProxySettingsObject</code>）。另因<code>http proxy</code>只能代理tcp协议，udp系的协议均不能通过。</p>
<p>(V2ray 4.21.1+)</p>
<p>4.20.0版本中引入了http outbound作为其他协议的前置代理用法中，缺乏了对tls配置的支持。4.21.1的补丁版本中对<code>streamSettings</code>中的<code>security</code>和<code>tlsSettings</code>保留生效。目前前置代理的用法中，vmess/tcp、vmess/tcp-tls和shadowsocks等三种协议方式可使用，其他传输协议的前置代理用法需后续版本开发支持。</p>
<blockquote>
<p><code>servers</code>: 数组</p>
</blockquote>
<p>HTTP代理服务器配置，若配置多个，循环使用 (RoundRobin)。</p>
<blockquote>
<p><code>address</code>: string</p>
</blockquote>
<p>HTTP代理服务器地址，必填。</p>
<blockquote>
<p><code>port</code>: int</p>
</blockquote>
<p>HTTP代理服务器端口，必填。</p>
<blockquote>
<p><code>user</code>: [<a href="https://www.v2ray.com/chapter_02/protocols/http.html#accountobject" target="_blank" rel="noopener">AccountObject</a>]</p>
</blockquote>
<p>一个数组，数组中每个元素为一个用户帐号。默认值为空。</p>
<h1 id="MTProto"><a href="#MTProto" class="headerlink" title="MTProto"></a>MTProto</h1><ul>
<li><p>名称: <code>mtproto</code></p>
</li>
<li><p>类型: 入站 / 出站</p>
</li>
</ul>
<p>MTProto 是一个 Telegram 专用的代理协议。在 V2Ray 中可使用一组入站出站代理来完成 Telegram 数据的代理任务。</p>
<p>目前只支持转发到 Telegram 的 IPv4 地址。</p>
<h2 id="InboundConfigurationObject-2"><a href="#InboundConfigurationObject-2" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><pre><code>{
  "users": [{
    "email": "love@v2ray.com",
    "level": 0,
    "secret": "b0cbcef5a486d9636472ac27f8e11a9d"
  }]
}</code></pre><blockquote>
<p><code>users</code>: [<a href="https://www.v2ray.com/chapter_02/protocols/mtproto.html#userobject" target="_blank" rel="noopener">UserObject</a>]</p>
</blockquote>
<p>一个数组，其中每一个元素表示一个用户。目前只有第一个用户会生效。</p>
<h3 id="UserObject"><a href="#UserObject" class="headerlink" title="UserObject"></a>UserObject</h3><pre><code>{
  "email": "love@v2ray.com",
  "level": 0,
  "secret": "b0cbcef5a486d9636472ac27f8e11a9d"
}</code></pre><blockquote>
<p><code>email</code>: string</p>
</blockquote>
<p>用户邮箱，用于统计流量等辅助功能</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级。</p>
<blockquote>
<p><code>secret</code>: string</p>
</blockquote>
<p>用户密钥。必须为 32 个字符，仅可包含<code>0</code>到<code>9</code>和<code>a</code>到<code>f</code>之间的字符。</p>
<p>使用此命令生成 MTProto 代理所需要的用户密钥：<code>openssl rand -hex 16</code></p>
<h2 id="OutboundConfigurationObject-4"><a href="#OutboundConfigurationObject-4" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
}</code></pre><h2 id="样例配置"><a href="#样例配置" class="headerlink" title="样例配置"></a>样例配置</h2><p>MTProto 仅可用于 Telegram 数据。你可能需要一个路由来绑定对应的入站出站代理。以下是一个不完整的示例：</p>
<p>入站代理：</p>
<pre><code>{
  "tag": "tg-in",
  "port": 443,
  "protocol": "mtproto",
  "settings": {
    "users": [{"secret": "b0cbcef5a486d9636472ac27f8e11a9d"}]
  }
}</code></pre><p>出站代理：</p>
<pre><code>{
  "tag": "tg-out",
  "protocol": "mtproto",
  "settings": {}
}</code></pre><p>路由：</p>
<pre><code>{
  "type": "field",
  "inboundTag": ["tg-in"],
  "outboundTag": "tg-out"
}</code></pre><p>然后使用 Telegram 连接这台机器的 443 端口即可。</p>
<h1 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h1><ul>
<li><p>名称：<code>shadowsocks</code></p>
</li>
<li><p>类型：入站 / 出站</p>
</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/Shadowsocks" target="_blank" rel="noopener">Shadowsocks</a> 协议，包含入站和出站两部分，兼容大部分其它版本的实现。</p>
<p>与官方版本的兼容性：</p>
<ul>
<li><p>支持 TCP 和 UDP 数据包转发，其中 UDP 可选择性关闭；</p>
</li>
<li><p>支持 </p>
<p>OTA</p>
<p>；</p>
<ul>
<li>客户端可选开启或关闭；</li>
</ul>
</li>
<li><p>服务器端可强制开启、关闭或自适应；</p>
</li>
<li><p>加密方式（其中 </p>
<p>AEAD</p>
<p> 加密方式在 V2Ray 3.0 中加入）：</p>
<ul>
<li>aes-256-cfb</li>
</ul>
</li>
<li><p>aes-128-cfb</p>
</li>
<li><p>chacha20</p>
</li>
<li><p>chacha20-ietf</p>
</li>
<li><p>aes-256-gcm</p>
</li>
<li><p>aes-128-gcm</p>
</li>
<li><p>chacha20-poly1305 或称 chacha20-ietf-poly1305</p>
</li>
<li><p>插件：</p>
<ul>
<li>通过 Standalone 模式支持 obfs</li>
</ul>
</li>
</ul>
<p>Shadowsocks 的配置分为两部分，<code>InboundConfigurationObject</code>和<code>OutboundConfigurationObject</code>，分别对应入站和出站协议配置中的<code>settings</code>项。</p>
<h2 id="InboundConfigurationObject-3"><a href="#InboundConfigurationObject-3" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><pre><code>{
  "email": "love@v2ray.com",
  "method": "aes-128-cfb",
  "password": "密码",
  "level": 0,
  "ota": true,
  "network": "tcp"
}</code></pre><blockquote>
<p><code>email</code>: string</p>
</blockquote>
<p>邮件地址，可选，用于标识用户</p>
<blockquote>
<p><code>method</code>: string</p>
</blockquote>
<p>必填。可选的值见<a href="https://www.v2ray.com/chapter_02/protocols/shadowsocks.html#encryption-list" target="_blank" rel="noopener">加密方式列表</a></p>
<blockquote>
<p><code>password</code>: string</p>
</blockquote>
<p>必填，任意字符串。Shadowsocks 协议不限制密码长度，但短密码会更可能被破解，建议使用 16 字符或更长的密码。</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级，默认值为 <code>0</code>。详见<a href="https://www.v2ray.com/chapter_02/policy.html" target="_blank" rel="noopener">本地策略</a>。</p>
<blockquote>
<p><code>ota</code>: true | false</p>
</blockquote>
<p>是否强制 OTA，如果不指定此项，则自动判断。强制开启 OTA 后，V2Ray 会拒绝未启用 OTA 的连接。反之亦然。</p>
<p>当使用 AEAD 时，<code>ota</code> 设置无效</p>
<blockquote>
<p><code>network</code>: “tcp” | “udp” | “tcp,udp”</p>
</blockquote>
<p>可接收的网络连接类型，默认值为<code>"tcp"</code>。</p>
<h2 id="OutboundConfigurationObject-5"><a href="#OutboundConfigurationObject-5" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "servers": [
    {
      "email": "love@v2ray.com",
      "address": "127.0.0.1",
      "port": 1234,
      "method": "加密方式",
      "password": "密码",
      "ota": false,
      "level": 0
    }
  ]
}</code></pre><blockquote>
<p><code>servers</code>: [<a href="https://www.v2ray.com/chapter_02/protocols/shadowsocks.html#serverobject" target="_blank" rel="noopener">ServerObject</a>]</p>
</blockquote>
<p>一个数组，其中每一项是一个 <a href="https://www.v2ray.com/chapter_02/protocols/shadowsocks.html#serverobject" target="_blank" rel="noopener">ServerObject</a>。</p>
<h3 id="ServerObject"><a href="#ServerObject" class="headerlink" title="ServerObject"></a>ServerObject</h3><pre><code>{
  "email": "love@v2ray.com",
  "address": "127.0.0.1",
  "port": 1234,
  "method": "加密方式",
  "password": "密码",
  "ota": false,
  "level": 0
}</code></pre><blockquote>
<p><code>email</code>: string</p>
</blockquote>
<p>邮件地址，可选，用于标识用户</p>
<blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>Shadowsocks 服务器地址，支持 IPv4、IPv6 和域名。必填。</p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>Shadowsocks 服务器端口。必填。</p>
<blockquote>
<p><code>method</code>: string</p>
</blockquote>
<p>必填。可选的值见<a href="https://www.v2ray.com/chapter_02/protocols/shadowsocks.html#encryption-list" target="_blank" rel="noopener">加密方式列表</a></p>
<blockquote>
<p><code>password</code>: string</p>
</blockquote>
<p>必填。任意字符串。Shadowsocks 协议不限制密码长度，但短密码会更可能被破解，建议使用 16 字符或更长的密码。</p>
<blockquote>
<p><code>ota</code>: true | false</p>
</blockquote>
<p>是否开启 Shadowsocks 的一次验证（One time auth），默认值为<code>false</code>。</p>
<p>当使用 AEAD 时，<code>ota</code> 设置无效。</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级</p>
<h2 id="加密方式列表"><a href="#加密方式列表" class="headerlink" title="加密方式列表"></a>加密方式列表</h2><ul>
<li><p><code>"aes-256-cfb"</code></p>
</li>
<li><p><code>"aes-128-cfb"</code></p>
</li>
<li><p><code>"chacha20"</code></p>
</li>
<li><p><code>"chacha20-ietf"</code></p>
</li>
<li><p><code>"aes-256-gcm"</code></p>
</li>
<li><p><code>"aes-128-gcm"</code></p>
</li>
<li><p><code>"chacha20-poly1305"</code> 或 <code>"chacha20-ietf-poly1305"</code></p>
</li>
</ul>
<h1 id="Socks"><a href="#Socks" class="headerlink" title="Socks"></a>Socks</h1><ul>
<li><p>名称：<code>socks</code></p>
</li>
<li><p>类型：入站 / 出站</p>
</li>
</ul>
<p>标准 Socks 协议实现，兼容 <a href="http://ftp.icm.edu.pl/packages/socks/socks4/SOCKS4.protocol" target="_blank" rel="noopener">Socks 4</a>、Socks 4a 和 <a href="http://ftp.icm.edu.pl/packages/socks/socks4/SOCKS4.protocol" target="_blank" rel="noopener">Socks 5</a>。</p>
<p>Socks 的配置分为两部分，<code>InboundConfigurationObject</code>和<code>OutboundConfigurationObject</code>，分别对应入站和出站协议配置中的<code>settings</code>项。</p>
<h2 id="OutboundConfigurationObject-6"><a href="#OutboundConfigurationObject-6" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "servers": [{
    "address": "127.0.0.1",
    "port": 1234,
    "users": [
      {
        "user": "test user",
        "pass": "test pass",
        "level": 0
      }
    ]
  }]
}</code></pre><p>应该注意，虽然socks outbound可以作为对外访问的配置，但socks协议没有对传输加密，不适宜经公网中传输。socks outbound 更有意义的用法是在特殊情况下，只能使用socks proxy对外访问内部网络中，作为为其他协议连接代理服务器的前置代理使用（见<code>OutboundObject</code>的<code>ProxySettingsObject</code>）。</p>
<blockquote>
<p><code>servers</code>: [ <a href="https://www.v2ray.com/chapter_02/protocols/socks.html#serverobject" target="_blank" rel="noopener">ServerObject</a> ]</p>
</blockquote>
<p>Socks 服务器列表，其中每一项是一个服务器配置。</p>
<h3 id="ServerObject-1"><a href="#ServerObject-1" class="headerlink" title="ServerObject"></a>ServerObject</h3><pre><code>{
  "address": "127.0.0.1",
  "port": 1234,
  "users": [
    {
      "user": "test user",
      "pass": "test pass",
      "level": 0
    }
  ]
}</code></pre><blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>服务器地址。</p>
<p>仅支持连接到 Socks 5 服务器。</p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>服务器端口</p>
<blockquote>
<p><code>users</code>: [ <a href="https://www.v2ray.com/chapter_02/protocols/socks.html#userobject" target="_blank" rel="noopener">UserObject</a> ]</p>
</blockquote>
<p>用户列表，其中每一项一个用户配置。当列表不为空时，Socks 客户端会使用此用户信息进行认证；如未指定，则不进行认证。</p>
<h3 id="UserObject-1"><a href="#UserObject-1" class="headerlink" title="UserObject"></a>UserObject</h3><pre><code>{
  "user": "test user",
  "pass": "test pass",
  "level": 0
}</code></pre><blockquote>
<p><code>user</code>: string</p>
</blockquote>
<p>用户名</p>
<blockquote>
<p><code>pass</code>: string</p>
</blockquote>
<p>密码</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级</p>
<h2 id="InboundConfigurationObject-4"><a href="#InboundConfigurationObject-4" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><p>应该注意，虽然socks inbound可以公共服务端口，但socks协议没有对传输加密，不适宜经公网中传输。socks inbound更有意义的用法是在局域网或本机环境下，为其他程序提供本地服务。</p>
<pre><code>{
  "auth": "noauth",
  "accounts": [
    {
      "user": "my-username",
      "pass": "my-password"
    }
  ],
  "udp": false,
  "ip": "127.0.0.1",
  "userLevel": 0
}</code></pre><blockquote>
<p><code>auth</code>: “noauth” | “password”</p>
</blockquote>
<p>Socks 协议的认证方式，支持<code>"noauth"</code>匿名方式和<code>"password"</code>用户密码方式。默认值为<code>"noauth"</code>。</p>
<blockquote>
<p><code>accounts</code>: [ <a href="https://www.v2ray.com/chapter_02/protocols/socks.html#accountobject" target="_blank" rel="noopener">AccountObject</a> ]</p>
</blockquote>
<p>一个数组，数组中每个元素为一个用户帐号。默认值为空。此选项仅当 <code>auth</code> 为 <code>password</code> 时有效。</p>
<blockquote>
<p><code>udp</code>: true | false</p>
</blockquote>
<p>是否开启 UDP 协议的支持。默认值为 <code>false</code>。</p>
<blockquote>
<p><code>ip</code>: address</p>
</blockquote>
<p>当开启 UDP 时，V2Ray 需要知道本机的 IP 地址。默认值为<code>"127.0.0.1"</code>。</p>
<blockquote>
<p><code>userLevel</code>: number</p>
</blockquote>
<p>用户等级，所有连接使用这一等级。</p>
<h3 id="AccountObject-1"><a href="#AccountObject-1" class="headerlink" title="AccountObject"></a>AccountObject</h3><pre><code>{
  "user": "my-username",
  "pass": "my-password"
}</code></pre><blockquote>
<p><code>user</code>: string</p>
</blockquote>
<p>用户名</p>
<blockquote>
<p><code>pass</code>: string</p>
</blockquote>
<p>密码</p>
<h1 id="VMess"><a href="#VMess" class="headerlink" title="VMess"></a>VMess</h1><ul>
<li><p>名称：<code>vmess</code></p>
</li>
<li><p>类型：入站 / 出站</p>
</li>
</ul>
<p><a href="https://www.v2ray.com/developer/protocols/vmess.html" target="_blank" rel="noopener">VMess</a> 是一个加密传输协议，它分为入站和出站两部分，通常作为 V2Ray 客户端和服务器之间的桥梁。</p>
<p>VMess 依赖于系统时间，请确保使用 V2Ray 的系统 UTC 时间误差在 90 秒之内，时区无关。在 Linux 系统中可以安装<code>ntp</code>服务来自动同步系统时间。</p>
<p>VMess 的配置分为两部分，<code>InboundConfigurationObject</code>和<code>OutboundConfigurationObject</code>，分别对应入站和出站协议配置中的<code>settings</code>项。</p>
<h2 id="OutboundConfigurationObject-7"><a href="#OutboundConfigurationObject-7" class="headerlink" title="OutboundConfigurationObject"></a>OutboundConfigurationObject</h2><pre><code>{
  "vnext": [
    {
      "address": "127.0.0.1",
      "port": 37192,
      "users": [
        {
          "id": "27848739-7e62-4138-9fd3-098a63964b6b",
          "alterId": 4,
          "security": "auto",
          "level": 0
        }
      ]
    }
  ]
}</code></pre><blockquote>
<p><code>vnext</code>：[ <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html#serverobject" target="_blank" rel="noopener">ServerObject</a> ]</p>
</blockquote>
<p>一个数组，包含一系列的服务器配置</p>
<h3 id="ServerObject-2"><a href="#ServerObject-2" class="headerlink" title="ServerObject"></a>ServerObject</h3><pre><code>{
  "address": "127.0.0.1",
  "port": 37192,
  "users": []
}</code></pre><blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>服务器地址，支持 IP 地址或者域名。</p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>服务器端口号。</p>
<blockquote>
<p><code>users</code>: [ <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html#userobject" target="_blank" rel="noopener">UserObject</a> ]</p>
</blockquote>
<p>一组服务器认可的用户</p>
<h3 id="UserObject-2"><a href="#UserObject-2" class="headerlink" title="UserObject"></a>UserObject</h3><pre><code>{
  "id": "27848739-7e62-4138-9fd3-098a63964b6b",
  "alterId": 4,
  "security": "auto",
  "level": 0
}</code></pre><blockquote>
<p><code>id</code>：string</p>
</blockquote>
<p>VMess 用户的主 ID。必须是一个合法的 UUID。</p>
<blockquote>
<p><code>alterId</code>：number</p>
</blockquote>
<p>为了进一步防止被探测，一个用户可以在主 ID 的基础上，再额外生成多个 ID。这里只需要指定额外的 ID 的数量，推荐值为 4。不指定的话，默认值是 <code>0</code>。最大值 <code>65535</code>。这个值不能超过服务器端所指定的值。</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级</p>
<blockquote>
<p><code>security</code>: “aes-128-gcm” | “chacha20-poly1305” | “auto” | “none”</p>
</blockquote>
<p>加密方式，客户端将使用配置的加密方式发送数据，服务器端自动识别，无需配置。</p>
<ul>
<li><p><code>"aes-128-gcm"</code>：推荐在 PC 上使用</p>
</li>
<li><p><code>"chacha20-poly1305"</code>：推荐在手机端使用</p>
</li>
<li><p><code>"auto"</code>：默认值，自动选择（运行框架为 AMD64、ARM64 或 s390x 时为aes-128-gcm加密方式，其他情况则为 Chacha20-Poly1305 加密方式）</p>
</li>
<li><p><code>"none"</code>：不加密</p>
</li>
</ul>
<p>推荐使用<code>"auto"</code>加密方式，这样可以永久保证安全性和兼容性。</p>
<h2 id="InboundConfigurationObject-5"><a href="#InboundConfigurationObject-5" class="headerlink" title="InboundConfigurationObject"></a>InboundConfigurationObject</h2><pre><code>{
  "clients": [
    {
      "id": "27848739-7e62-4138-9fd3-098a63964b6b",
      "level": 0,
      "alterId": 4,
      "email": "love@v2ray.com"
    }
  ],
  "default": {
    "level": 0,
    "alterId": 4
  },
  "detour": {
    "to": "tag_to_detour"
  },
  "disableInsecureEncryption": false
}</code></pre><blockquote>
<p><code>clients</code>: [ <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html#clientobject" target="_blank" rel="noopener">ClientObject</a> ]</p>
</blockquote>
<p>一组服务器认可的用户。clients 可以为空。当此配置用作动态端口时，V2Ray 会自动创建用户。</p>
<blockquote>
<p><code>detour</code>: <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html#detourobject" target="_blank" rel="noopener">DetourObject</a></p>
</blockquote>
<p>指示对应的出站协议使用另一个服务器。</p>
<blockquote>
<p><code>default</code>: <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html#defaultobject" target="_blank" rel="noopener">DefaultObject</a></p>
</blockquote>
<p>可选，clients 的默认配置。仅在配合<code>detour</code>时有效。</p>
<blockquote>
<p><code>disableInsecureEncryption</code>: true | false</p>
</blockquote>
<p>是否禁止客户端使用不安全的加密方式，当客户端指定下列加密方式时，服务器会主动断开连接。默认值为<code>false</code>。</p>
<ul>
<li><p><code>"none"</code></p>
</li>
<li><p><code>"aes-128-cfb"</code></p>
</li>
</ul>
<h3 id="ClientObject"><a href="#ClientObject" class="headerlink" title="ClientObject"></a>ClientObject</h3><pre><code>{
  "id": "27848739-7e62-4138-9fd3-098a63964b6b",
  "level": 0,
  "alterId": 4,
  "email": "love@v2ray.com"
}</code></pre><blockquote>
<p><code>id</code>: string</p>
</blockquote>
<p>VMess 的用户 ID。必须是一个合法的 UUID。</p>
<blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级，详见<a href="https://www.v2ray.com/chapter_02/policy.html" target="_blank" rel="noopener">本地策略</a></p>
<blockquote>
<p><code>alterId</code>: number</p>
</blockquote>
<p>与上文出站协议中的含义相同。</p>
<blockquote>
<p><code>email</code>: string</p>
</blockquote>
<p>用户邮箱地址，用于区分不同用户的流量。</p>
<p><code>alterId</code> 取值的大小和流量特征没有必然联系。对于日常使用，<code>16</code> 以内的值已经够用了。</p>
<h3 id="DetourObject"><a href="#DetourObject" class="headerlink" title="DetourObject"></a>DetourObject</h3><pre><code>{
  "to": "tag_to_detour"
}</code></pre><blockquote>
<p><code>to</code>: string</p>
</blockquote>
<p>一个入站协议的<code>tag</code>，详见<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">配置文件</a>。指定的入站协议必须是一个 VMess</p>
<h3 id="DefaultObject"><a href="#DefaultObject" class="headerlink" title="DefaultObject"></a>DefaultObject</h3><pre><code>{
  "level": 0,
  "alterId": 4
}</code></pre><blockquote>
<p><code>level</code>: number</p>
</blockquote>
<p>用户等级，意义同上。默认值为<code>0</code>。</p>
<blockquote>
<p><code>alterId</code>: number</p>
</blockquote>
<p>和<code>ClientObject</code>中的<code>alterId</code>相同，默认值为<code>64</code>。推荐值<code>4</code>。</p>
<h1 id="本地策略"><a href="#本地策略" class="headerlink" title="本地策略"></a>本地策略</h1><p>本地策略可以配置一些用户相关的权限，比如连接超时设置。V2Ray 处理的每一个连接，都对应到一个用户，按照这个用户的等级（level）应用不同的策略。本地策略可按照等级的不同而变化。</p>
<h2 id="PolicyObject"><a href="#PolicyObject" class="headerlink" title="PolicyObject"></a>PolicyObject</h2><p><code>PolicyObject</code>对应配置文件中的<code>policy</code>项。</p>
<pre><code>{
  "levels": {
    "0": {
      "handshake": 4,
      "connIdle": 300,
      "uplinkOnly": 2,
      "downlinkOnly": 5,
      "statsUserUplink": false,
      "statsUserDownlink": false,
      "bufferSize": 10240
    }
  },
  "system": {
    "statsInboundUplink": false,
    "statsInboundDownlink": false
  }
}</code></pre><blockquote>
<p><code>level</code>: map{string: <a href="https://www.v2ray.com/chapter_02/policy.html#levelpolicyobject" target="_blank" rel="noopener">LevelPolicyObject</a>}</p>
</blockquote>
<p>一组键值对，每个键是一个字符串形式的数字（JSON 的要求），比如 <code>"0"</code>、<code>"1"</code> 等，双引号不能省略，这个数字对应用户等级。每一个值是一个 <a href="https://www.v2ray.com/chapter_02/policy.html#levelpolicyobject" target="_blank" rel="noopener">LevelPolicyObject</a>.</p>
<p>每个入站出站代理现在都可以设置用户等级，V2Ray 会根据实际的用户等级应用不同的本地策略。</p>
<blockquote>
<p><code>system</code>: <a href="https://www.v2ray.com/chapter_02/policy.html#systempolicyobject" target="_blank" rel="noopener">SystemPolicyObject</a></p>
</blockquote>
<p>V2Ray 系统的策略</p>
<h3 id="LevelPolicyObject"><a href="#LevelPolicyObject" class="headerlink" title="LevelPolicyObject"></a>LevelPolicyObject</h3><pre><code>{
  "handshake": 4,
  "connIdle": 300,
  "uplinkOnly": 2,
  "downlinkOnly": 5,
  "statsUserUplink": false,
  "statsUserDownlink": false,
  "bufferSize": 10240
}</code></pre><blockquote>
<p><code>handshake</code>: number</p>
</blockquote>
<p>连接建立时的握手时间限制。单位为秒。默认值为<code>4</code>。在入站代理处理一个新连接时，在握手阶段（比如 VMess 读取头部数据，判断目标服务器地址），如果使用的时间超过这个时间，则中断该连接。</p>
<blockquote>
<p><code>connIdle</code>: number</p>
</blockquote>
<p>连接空闲的时间限制。单位为秒。默认值为<code>300</code>。在入站出站代理处理一个连接时，如果在 <code>connIdle</code> 时间内，没有任何数据被传输（包括上行和下行数据），则中断该连接。</p>
<blockquote>
<p><code>uplinkOnly</code>: number</p>
</blockquote>
<p>当连接下行线路关闭后的时间限制。单位为秒。默认值为<code>2</code>。当服务器（如远端网站）关闭下行连接时，出站代理会在等待 <code>uplinkOnly</code> 时间后中断连接。</p>
<blockquote>
<p><code>downlinkOnly</code>: number</p>
</blockquote>
<p>当连接上行线路关闭后的时间限制。单位为秒。默认值为<code>5</code>。当客户端（如浏览器）关闭上行连接时，入站代理会在等待 <code>downlinkOnly</code> 时间后中断连接。</p>
<p>在 HTTP 浏览的场景中，可以将<code>uplinkOnly</code>和<code>downlinkOnly</code>设为<code>0</code>，以提高连接关闭的效率。</p>
<blockquote>
<p><code>statsUserUplink</code>: true | false</p>
</blockquote>
<p>当值为<code>true</code>时，开启当前等级的所有用户的上行流量统计。</p>
<blockquote>
<p><code>statsUserDownlink</code>: true | false</p>
</blockquote>
<p>当值为<code>true</code>时，开启当前等级的所有用户的下行流量统计。</p>
<blockquote>
<p><code>bufferSize</code>: number</p>
</blockquote>
<p>每个连接的内部缓存大小。单位为 kB。当值为<code>0</code>时，内部缓存被禁用。</p>
<p>默认值 (V2Ray 4.4+):</p>
<ul>
<li><p>在 ARM、MIPS、MIPSLE 平台上，默认值为<code>0</code>。</p>
</li>
<li><p>在 ARM64、MIPS64、MIPS64LE 平台上，默认值为<code>4</code>。</p>
</li>
<li><p>在其它平台上，默认值为<code>512</code>。</p>
</li>
</ul>
<p>默认值 (V2Ray 4.3-):</p>
<ul>
<li><p>在 ARM、MIPS、MIPSLE、ARM64、MIPS64、MIPS64LE 平台上，默认值为<code>16</code>。</p>
</li>
<li><p>在其它平台上，默认值为<code>2048</code>。</p>
</li>
</ul>
<p><code>bufferSize</code> 选项会覆盖<a href="https://www.v2ray.com/chapter_02/env.html#buffer-size" target="_blank" rel="noopener">环境变量</a>中<code>v2ray.ray.buffer.size</code>的设定。</p>
<h3 id="SystemPolicyObject"><a href="#SystemPolicyObject" class="headerlink" title="SystemPolicyObject"></a>SystemPolicyObject</h3><pre><code>{
  "statsInboundUplink": false,
  "statsInboundDownlink": false
}</code></pre><blockquote>
<p><code>statsInboundUplink</code>: true | false</p>
</blockquote>
<p>当值为<code>true</code>时，开启所有入站代理的上行流量统计。</p>
<blockquote>
<p><code>statsInboundDownlink</code>: true | false</p>
</blockquote>
<p>当值为<code>true</code>时，开启所有入站代理的下行流量统计。</p>
<h1 id="路由功能"><a href="#路由功能" class="headerlink" title="路由功能"></a>路由功能</h1><p>V2Ray 内建了一个简单的路由功能，可以将入站数据按需求由不同的出站连接发出，以达到按需代理的目的。这一功能的常见用法是分流国内外流量，V2Ray 可以通过内部机制判断不同地区的流量，然后将它们发送到不同的出站代理。</p>
<h2 id="RoutingObject"><a href="#RoutingObject" class="headerlink" title="RoutingObject"></a>RoutingObject</h2><p><code>RoutingObject</code> 对应主配置文件中的<code>routing</code>项。</p>
<pre><code>{
  "domainStrategy": "AsIs",
  "rules": [],
  "balancers": []
}</code></pre><blockquote>
<p><code>domainStrategy</code>: “AsIs” | “IPIfNonMatch” | “IPOnDemand”</p>
</blockquote>
<p>域名解析策略，根据不同的设置使用不同的策略。</p>
<ul>
<li><p><code>"AsIs"</code>: 只使用域名进行路由选择。默认值。</p>
</li>
<li><pre><code>"IPIfNonMatch"</code></pre><p>: 当域名没有匹配任何规则时，将域名解析成 IP（A 记录或 AAAA 记录）再次进行匹配；</p>
<ul>
<li>当一个域名有多个 A 记录时，会尝试匹配所有的 A 记录，直到其中一个与某个规则匹配为止；</li>
</ul>
</li>
<li><p>解析后的 IP 仅在路由选择时起作用，转发的数据包中依然使用原始域名；</p>
</li>
<li><p><code>"IPOnDemand"</code>: 当匹配时碰到任何基于 IP 的规则，将域名立即解析为 IP 进行匹配；</p>
</li>
</ul>
<blockquote>
<p><code>rules</code>: [<a href="https://www.v2ray.com/chapter_02/03_routing.html#ruleobject" target="_blank" rel="noopener">RuleObject</a>]</p>
</blockquote>
<p>对应一个数组，数组中每个元素是一个规则。对于每一个连接，路由将根据这些规则依次进行判断，当一个规则生效时，即将这个连接转发至它所指定的<code>outboundTag</code>(或<code>balancerTag</code>，V2Ray 4.4+)。当没有匹配到任何规则时，流量默认由主出站协议发出。</p>
<blockquote>
<p><code>balancers</code>: [ <a href="https://www.v2ray.com/chapter_02/03_routing.html#balancerobject" target="_blank" rel="noopener">BalancerObject</a> ]</p>
</blockquote>
<p>(V2Ray 4.4+)一个数组，数组中每个元素是一个负载均衡器的配置。当一个规则指向一个负载均衡器时，V2Ray 会通过此负载均衡器选出一个出站协议，然后由它转发流量。</p>
<h3 id="RuleObject"><a href="#RuleObject" class="headerlink" title="RuleObject"></a>RuleObject</h3><pre><code>{
  "type": "field",
  "domain": [
    "baidu.com",
    "qq.com",
    "geosite:cn"
  ],
  "ip": [
    "0.0.0.0/8",
    "10.0.0.0/8",
    "fc00::/7",
    "fe80::/10",
    "geoip:cn"
  ],
  "port": "53,443,1000-2000",
  "network": "tcp",
  "source": [
    "10.0.0.1"
  ],
  "user": [
    "love@v2ray.com"
  ],
  "inboundTag": [
    "tag-vmess"
  ],
  "protocol":["http", "tls", "bittorrent"],
  "attrs": "attrs[':method'] == 'GET'",
  "outboundTag": "direct",
  "balancerTag": "balancer"
}</code></pre><p>当多个属性同时指定时，这些属性需要同时满足，才可以使当前规则生效。如果多个规则分别使用了<code>domain</code>或者<code>ip</code>，需要对应添加多条规则。</p>
<blockquote>
<p><code>type</code>: “field”</p>
</blockquote>
<p>目前只支持<code>"field"</code>这一个选项。</p>
<blockquote>
<p><code>domain</code>: [string]</p>
</blockquote>
<p>一个数组，数组每一项是一个域名的匹配。有以下几种形式：</p>
<ul>
<li><p>纯字符串: 当此字符串匹配目标域名中任意部分，该规则生效。比如”sina.com”可以匹配”sina.com”、”sina.com.cn”和”<a href="http://www.sina.com&quot;，但不匹配&quot;sina.cn&quot;。" target="_blank" rel="noopener">www.sina.com"，但不匹配"sina.cn"。</a></p>
</li>
<li><p>正则表达式: 由<code>"regexp:"</code>开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如”regexp:\.goo.*\.com$”匹配”<a href="http://www.google.com&quot;、&quot;fonts.googleapis.com&quot;，但不匹配&quot;google.com&quot;。" target="_blank" rel="noopener">www.google.com"、"fonts.googleapis.com"，但不匹配"google.com"。</a></p>
</li>
<li><p>子域名 (推荐): 由<code>"domain:"</code>开始，余下部分是一个域名。当此域名是目标域名或其子域名时，该规则生效。例如”domain:v2ray.com”匹配”<a href="http://www.v2ray.com&quot;、&quot;v2ray.com&quot;，但不匹配&quot;xv2ray.com&quot;。" target="_blank" rel="noopener">www.v2ray.com"、"v2ray.com"，但不匹配"xv2ray.com"。</a></p>
</li>
<li><p>完整匹配: 由<code>"full:"</code>开始，余下部分是一个域名。当此域名完整匹配目标域名时，该规则生效。例如”full:v2ray.com”匹配”v2ray.com”但不匹配”<a href="http://www.v2ray.com&quot;。" target="_blank" rel="noopener">www.v2ray.com"。</a></p>
</li>
<li><p>预定义域名列表：由<code>"geosite:"</code>开头，余下部分是一个名称，如<code>geosite:google</code>或者<code>geosite:cn</code>。名称及域名列表参考<a href="https://www.v2ray.com/chapter_02/03_routing.html#dlc" target="_blank" rel="noopener">预定义域名列表</a>。</p>
</li>
<li><p>从文件中加载域名: 形如<code>"ext:file:tag"</code>，必须以<code>ext:</code>（小写）开头，后面跟文件名和标签，文件存放在<a href="https://www.v2ray.com/chapter_02/env.html#asset-location" target="_blank" rel="noopener">资源目录</a>中，文件格式与<code>geosite.dat</code>相同，标签必须在文件中存在。</p>
</li>
</ul>
<blockquote>
<p><code>ip</code>: [string]</p>
</blockquote>
<p>一个数组，数组内每一个元素代表一个 IP 范围。当某一元素匹配目标 IP 时，此规则生效。有以下几种形式：</p>
<ul>
<li><p>IP: 形如<code>"127.0.0.1"</code>。</p>
</li>
<li><p><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener">CIDR</a>: 形如<code>"10.0.0.0/8"</code>.</p>
</li>
<li><p>GeoIP: 形如</p>
<pre><code>"geoip:cn"</code></pre><p>，必须以</p>
<pre><code>geoip:</code></pre><p>（小写）开头，后面跟双字符国家代码，支持几乎所有可以上网的国家。</p>
<ul>
<li>特殊值：<code>"geoip:private"</code> (V2Ray 3.5+)，包含所有私有地址，如<code>127.0.0.1</code>。</li>
</ul>
</li>
<li><p>从文件中加载 IP: 形如<code>"ext:file:tag"</code>，必须以<code>ext:</code>（小写）开头，后面跟文件名和标签，文件存放在<a href="https://www.v2ray.com/chapter_02/env.html#asset-location" target="_blank" rel="noopener">资源目录</a>中，文件格式与<code>geoip.dat</code>相同标签必须在文件中存在。</p>
</li>
</ul>
<pre><code>"ext:geoip.dat:cn"`等价于`"geoip:cn"</code></pre><blockquote>
<p><code>port</code>：number | string</p>
</blockquote>
<p>端口范围，有三种形式：</p>
<ul>
<li><p><code>"a-b"</code>: a 和 b 均为正整数，且小于 65536。这个范围是一个前后闭合区间，当目标端口落在此范围内时，此规则生效。</p>
</li>
<li><p><code>a</code>: a 为正整数，且小于 65536。当目标端口为 a 时，此规则生效。</p>
</li>
<li><p>(V2Ray 4.18+) 以上两种形式的混合，以逗号”,”分隔。形如：<code>"53,443,1000-2000"</code>。</p>
</li>
</ul>
<blockquote>
<p><code>network</code>: “tcp” | “udp” | “tcp,udp”</p>
</blockquote>
<p>可选的值有”tcp”、”udp”或”tcp,udp”，当连接方式是指定的方式时，此规则生效。</p>
<blockquote>
<p><code>source</code>: [string]</p>
</blockquote>
<p>一个数组，数组内每一个元素是一个 IP 或 CIDR。当某一元素匹配来源 IP 时，此规则生效。</p>
<blockquote>
<p><code>user</code>: [string]</p>
</blockquote>
<p>一个数组，数组内每一个元素是一个邮箱地址。当某一元素匹配来源用户时，此规则生效。当前 Shadowsocks 和 VMess 支持此规则。</p>
<blockquote>
<p><code>inboundTag</code>: [string]</p>
</blockquote>
<p>一个数组，数组内每一个元素是一个标识。当某一元素匹配入站协议的标识时，此规则生效。</p>
<blockquote>
<p><code>protocol</code>: [ “http” | “tls” | “bittorrent” ]</p>
</blockquote>
<p>一个数组，数组内每一个元素表示一种协议。当某一个协议匹配当前连接的流量时，此规则生效。必须开启入站代理中的<code>sniffing</code>选项。</p>
<blockquote>
<p><code>attrs</code>: string</p>
</blockquote>
<p>(V2Ray 4.18+) 一段脚本，用于检测流量的属性值。当此脚本返回真值时，此规则生效。</p>
<p>脚本语言为 <a href="https://github.com/bazelbuild/starlark" target="_blank" rel="noopener">Starlark</a>，它的语法是 Python 的子集。脚本接受一个全局变量<code>attrs</code>，其中包含了流量相关的属性。</p>
<p>目前只有 http 入站代理会设置这一属性。</p>
<p>示例：</p>
<ul>
<li><p>检测 HTTP GET: <code>"attrs[':method'] == 'GET'"</code></p>
</li>
<li><p>检测 HTTP Path: <code>"attrs[':path'].startswith('/test')"</code></p>
</li>
<li><p>检测 Content Type: <code>"attrs['accept'].index('text/html') &gt;= 0"</code></p>
</li>
</ul>
<blockquote>
<p><code>outboundTag</code>: string</p>
</blockquote>
<p>对应一个<a href="https://www.v2ray.com/chapter_02/02_protocols.html" target="_blank" rel="noopener">额外出站连接配置</a>的标识。</p>
<blockquote>
<p><code>balancerTag</code>: string</p>
</blockquote>
<p>对应一个负载均衡器的标识。<code>balancerTag</code>和<code>outboundTag</code>须二选一。当同时指定时，<code>outboundTag</code>生效。</p>
<h3 id="BalancerObject"><a href="#BalancerObject" class="headerlink" title="BalancerObject"></a>BalancerObject</h3><p>负载均衡器配置。当一个负载均衡器生效时，它会从指定的出站协议中，按配置选出一个最合适的出站协议，进行流量转发。</p>
<pre><code>{
  "tag": "balancer",
  "selector": []
}</code></pre><blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>此负载均衡器的标识，用于匹配<code>RuleObject</code>中的<code>balancerTag</code>。</p>
<blockquote>
<p><code>selector</code>: [ string ]</p>
</blockquote>
<p>一个字符串数组，其中每一个字符串将用于和出站协议标识的前缀匹配。在以下几个出站协议标识中：<code>[ "a", "ab", "c", "ba" ]</code>，<code>"selector": ["a"]</code>将匹配到<code>[ "a", "ab" ]</code>。</p>
<p>如果匹配到多个出站协议，负载均衡器目前会从中随机选出一个作为最终的出站协议。</p>
<h2 id="预定义域名列表"><a href="#预定义域名列表" class="headerlink" title="预定义域名列表"></a>预定义域名列表</h2><p>此列表由 <a href="https://github.com/v2ray/domain-list-community" target="_blank" rel="noopener">domain-list-community</a> 项目维护，预置于每一个 V2Ray 的安装包中，文件名为<code>geosite.dat</code>。</p>
<p>这个文件包含了一些常见的域名，可用于路由和 DNS 筛选。常用的域名有：</p>
<ul>
<li><p><code>category-ads</code>: 包含了常见的广告域名。</p>
</li>
<li><p><code>category-ads-all</code>: 包含了常见的广告域名，以及广告提供商的域名。</p>
</li>
<li><p><code>cn</code>: 相当于 <code>geolocation-cn</code> 和 <code>tld-cn</code> 的合集。</p>
</li>
<li><p><code>google</code>: 包含了 Google 旗下的所有域名。</p>
</li>
<li><p><code>facebook</code>: 包含了 Facebook 旗下的所有域名。</p>
</li>
<li><p><code>geolocation-cn</code>: 包含了常见的国内站点的域名。</p>
</li>
<li><p><code>geolocation-!cn</code>: 包含了常见的非国内站点的域名。</p>
</li>
<li><p><code>speedtest</code>: 包含了所有 Speedtest 所用的域名。</p>
</li>
<li><p><code>tld-cn</code>: 包含了所有 .cn 和 .中国 结尾的域名。</p>
</li>
</ul>
<h1 id="DNS-服务器"><a href="#DNS-服务器" class="headerlink" title="DNS 服务器"></a>DNS 服务器</h1><p>V2Ray 内置了一个 DNS 服务器，其有两大主要用途：根据域名的解析IP匹配路由规则，以及像传统的DNS功能，解析目标地址进行连接。</p>
<p>由此 DNS 服务器所发出的 DNS 查询请求，会自动根据路由配置进行转发，无需额外配置。</p>
<p>由于 DNS 协议的复杂性，V2Ray 只支持最基本的 IP 查询（A 和 AAAA 记录）。推荐使用本机 DNS 配合一个额外的 DNS 服务器来做 DNS 查询，如 <a href="https://coredns.io/" target="_blank" rel="noopener">CoreDNS</a>，以使用完整的 DNS 功能。</p>
<p>注意：在<code>freedom</code>协议的<code>outbound</code>中，<code>domainStrategy</code>默认值为<code>AsIs</code>，不会使用本DNS服务器进行目的地址解析，如果需要使用应配置为<code>UseIP</code>。</p>
<h2 id="DNS-处理流程"><a href="#DNS-处理流程" class="headerlink" title="DNS 处理流程"></a>DNS 处理流程</h2><p>当某个 DNS 服务器指定的域名列表匹配了当前要查询的域名，V2Ray 会优先使用这个 DNS 服务器进行查询，否则按从上往下的顺序进行查询，同时只返回匹配 expectIPs 的 IP 列表。</p>
<p>DNS服务器的处理流程示意图如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/-1627307275706341" alt=""></p>
<h2 id="DnsObject"><a href="#DnsObject" class="headerlink" title="DnsObject"></a>DnsObject</h2><p><code>DnsObject</code>对应配置文件中的<code>dns</code>项。</p>
<pre><code>{
  "hosts": {
    "baidu.com": "127.0.0.1"
  },
  "servers": [
    {
      "address": "1.2.3.4",
      "port": 5353,
      "domains": [
        "domain:v2ray.com"
      ],
      "expectIPs": [
        "geoip:cn"
      ],
    },
    "8.8.8.8",
    "8.8.4.4",
    "localhost"
  ],
  "clientIp": "1.2.3.4",
  "tag": "dns_inbound"
}</code></pre><blockquote>
<p><code>hosts</code>: map{string: address}</p>
</blockquote>
<p>静态 IP 列表，其值为一系列的”域名”:”地址”。其中地址可以是 IP 或者域名。在解析域名时，如果域名匹配这个列表中的某一项，当该项的地址为 IP 时，则解析结果为该项的 IP，而不会使用下述的 servers 进行解析；当该项的地址为域名时，会使用此域名进行 IP 解析，而不使用原始域名。</p>
<p>域名的格式有以下几种形式：</p>
<ul>
<li><p>纯字符串: 当此域名完整匹配目标域名时，该规则生效。例如”v2ray.com”匹配”v2ray.com”但不匹配”<a href="http://www.v2ray.com&quot;。" target="_blank" rel="noopener">www.v2ray.com"。</a></p>
</li>
<li><p>正则表达式: 由<code>"regexp:"</code>开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如”regexp:\.goo.*\.com$”匹配”<a href="http://www.google.com&quot;、&quot;fonts.googleapis.com&quot;，但不匹配&quot;google.com&quot;。" target="_blank" rel="noopener">www.google.com"、"fonts.googleapis.com"，但不匹配"google.com"。</a></p>
</li>
<li><p>子域名 (推荐): 由<code>"domain:"</code>开始，余下部分是一个域名。当此域名是目标域名或其子域名时，该规则生效。例如”domain:v2ray.com”匹配”<a href="http://www.v2ray.com&quot;、&quot;v2ray.com&quot;，但不匹配&quot;xv2ray.com&quot;。" target="_blank" rel="noopener">www.v2ray.com"、"v2ray.com"，但不匹配"xv2ray.com"。</a></p>
</li>
<li><p>子串: 由<code>"keyword:"</code>开始，余下部分是一个字符串。当此字符串匹配目标域名中任意部分，该规则生效。比如”keyword:sina.com”可以匹配”sina.com”、”sina.com.cn”和”<a href="http://www.sina.com&quot;，但不匹配&quot;sina.cn&quot;。" target="_blank" rel="noopener">www.sina.com"，但不匹配"sina.cn"。</a></p>
</li>
<li><p>预定义域名列表：由<code>"geosite:"</code>开头，余下部分是一个名称，如<code>geosite:google</code>或者<code>geosite:cn</code>。名称及域名列表参考<a href="https://www.v2ray.com/chapter_02/03_routing.html#dlc" target="_blank" rel="noopener">预定义域名列表</a>。</p>
</li>
</ul>
<blockquote>
<p><code>servers</code>: [string | <a href="https://www.v2ray.com/chapter_02/04_dns.html#serverobject" target="_blank" rel="noopener">ServerObject</a> ]</p>
</blockquote>
<p>一个 DNS 服务器列表，支持的类型有两种：DNS地址（字符串形式）和<a href="https://www.v2ray.com/chapter_02/04_dns.html#serverobject" target="_blank" rel="noopener">ServerObject</a> 。</p>
<p>当它的值是一个 DNS IP 地址时，如<code>"8.8.8.8"</code>，V2Ray 会使用此地址的 53 端口进行 DNS 查询。</p>
<p>当值为<code>"localhost"</code>时，表示使用本机预设的 DNS 配置。</p>
<p>当值是<code>"https://host:port/dns-query"</code>的形式，如<code>"https://dns.google/dns-query"</code>，V2Ray 会使用<code>DNS over HTTPS</code> (RFC8484, 简称DOH) 进行查询。有些服务商拥有IP别名的证书，可以直接写IP形式，比如<code>https://1.1.1.1/dns-query</code>。也可使用非标准端口和路径，如<code>"https://a.b.c.d:8443/my-dns-query"</code> (4.22.0+)</p>
<p>当值是<code>"https+local://host:port/dns-query"</code>的形式，如<code>"https+local://dns.google/dns-query"</code>，V2Ray 会使用 <code>DOH本地模式</code> 进行查询，即DOH请求不会经过Routing/Outbound等组件，直接对外请求，以降低耗时。一般适合在服务端使用。也可使用非标端口和路径。(4.22.0+)</p>
<p>当使用 <code>localhost</code> 时，本机的 DNS 请求不受 V2Ray 控制，需要额外的配置才可以使 DNS 请求由 V2Ray 转发。</p>
<p>不同规则初始化得到的DNS客户端会在V2Ray启动日志中以<code>info</code>级别体现，比如<code>local DOH</code> <code>remote DOH</code> <code>udp</code>等模式。（4.22.0+）</p>
<blockquote>
<p><code>clientIp</code>: string</p>
</blockquote>
<p>当前系统的 IP 地址，用于 DNS 查询时，通知服务器客户端的所在位置。不能是私有地址。</p>
<blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>(V2Ray 4.13+) 由此 DNS 发出的查询流量，除<code>localhost</code> 和 <code>DOHL_</code> 模式外，都会带有此标识，可在路由使用<code>inboundTag</code>进行匹配。</p>
<h3 id="ServerObject-3"><a href="#ServerObject-3" class="headerlink" title="ServerObject"></a>ServerObject</h3><pre><code>{
  "address": "1.2.3.4",
  "port": 5353,
  "domains": [
    "domain:v2ray.com"
  ],
  "expectIPs": [
    "geoip:cn"
  ]
}</code></pre><blockquote>
<p><code>address</code>: address</p>
</blockquote>
<p>DNS 服务器地址，如<code>"8.8.8.8"</code>。对于普通DNS IP地址只支持 UDP 协议的 DNS 服务器，若地址是以”<a href="https://xn--" "https+local-8c18a="" "开头的url形式，则使用doh模式，规则同字符串模式的doh配置。"="">https://“或”https+local://“开头的URL形式，则使用DOH模式，规则同字符串模式的DOH配置。</a></p>
<blockquote>
<p><code>port</code>: number</p>
</blockquote>
<p>DNS 服务器端口，如<code>53</code>。此项缺省时默认为<code>53</code>。当使用DOH模式该项无效，非标端口应在URL中指定。</p>
<blockquote>
<p><code>domains</code>: [string]</p>
</blockquote>
<p>一个域名列表，此列表包含的域名，将优先使用此服务器进行查询。域名格式和<a href="https://www.v2ray.com/chapter_02/03_routing.html#ruleobject" target="_blank" rel="noopener">路由配置</a>中相同。</p>
<blockquote>
<p><code>expectIPs</code>:[string]</p>
</blockquote>
<p>(V2Ray 4.22.0+) 一个 IP 范围列表，格式和<a href="https://www.v2ray.com/chapter_02/03_routing.html#ruleobject" target="_blank" rel="noopener">路由配置</a>中相同。</p>
<p>当配置此项时，V2Ray DNS 会对返回的 IP 的进行校验，只返回包含 expectIPs 列表中的地址。</p>
<p>如果未配置此项，会原样返回 IP 地址。</p>
<h1 id="Mux-多路复用"><a href="#Mux-多路复用" class="headerlink" title="Mux 多路复用"></a>Mux 多路复用</h1><p>Mux 功能是在一条 TCP 连接上分发多个 TCP 连接的数据。实现细节详见<a href="https://www.v2ray.com/developer/protocols/muxcool.html" target="_blank" rel="noopener">Mux.Cool</a>。Mux 是为了减少 TCP 的握手延迟而设计，而非提高连接的吞吐量。使用 Mux 看视频、下载或者测速通常都有反效果。Mux 只需要在客户端启用，服务器端自动适配。</p>
<h2 id="MuxObject"><a href="#MuxObject" class="headerlink" title="MuxObject"></a>MuxObject</h2><p><code>MuxObject</code>对应<code>OutboundObject</code>中的<code>mux</code>项。</p>
<pre><code>{
  "enabled": false,
  "concurrency": 8
}</code></pre><blockquote>
<p><code>enabled</code>: true | false</p>
</blockquote>
<p>是否启用 Mux 转发请求</p>
<blockquote>
<p><code>concurrency</code>: number</p>
</blockquote>
<p>最大并发连接数。最小值<code>1</code>，最大值<code>1024</code>，缺省默认值<code>8</code>。</p>
<p>特殊值<code>-1</code>，不加载mux模块。(4.22.0+)</p>
<p>这个数值表示了一个 TCP 连接上最多承载的 Mux 连接数量。当客户端发出了 8 个 TCP 请求，而<code>concurrency=8</code>时，V2Ray 只会发出一条实际的 TCP 连接，客户端的 8 个请求全部由这个 TCP 连接传输。</p>
<h1 id="远程控制"><a href="#远程控制" class="headerlink" title="远程控制"></a>远程控制</h1><p>V2Ray 中可以开放一些 API 以便远程调用。这些 API 都基于 <a href="https://grpc.io/" target="_blank" rel="noopener">gRPC</a>。</p>
<p>当远程控制开启时，V2Ray 会自建一个出站代理，以<code>tag</code>配置的值为标识。用户必须手动将所有的 gRPC 入站连接通过<a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">路由</a>指向这一出站代理。</p>
<h2 id="ApiObject"><a href="#ApiObject" class="headerlink" title="ApiObject"></a>ApiObject</h2><p><code>ApiObject</code>对应配置文件中的<code>api</code>项。</p>
<pre><code>{
  "tag": "api",
  "services": [
    "HandlerService",
    "LoggerService",
    "StatsService"
  ]
}</code></pre><blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>出站代理标识</p>
<blockquote>
<p><code>services</code>: [string]</p>
</blockquote>
<p>开启的 API 列表，可选的值见<a href="https://www.v2ray.com/chapter_02/api.html#api-list" target="_blank" rel="noopener">API 列表</a>。</p>
<h2 id="支持的-API-列表"><a href="#支持的-API-列表" class="headerlink" title="支持的 API 列表"></a>支持的 API 列表</h2><h3 id="HandlerService"><a href="#HandlerService" class="headerlink" title="HandlerService"></a>HandlerService</h3><p>一些对于入站出站代理进行修改的 API，可用的功能如下：</p>
<ul>
<li><p>添加一个新的入站代理；</p>
</li>
<li><p>添加一个新的出站代理；</p>
</li>
<li><p>删除一个现有的入站代理；</p>
</li>
<li><p>删除一个现有的出站代理；</p>
</li>
<li><p>在一个入站代理中添加一个用户（仅支持 VMess）；</p>
</li>
<li><p>在一个入站代理中删除一个用户（仅支持 VMess）；</p>
</li>
</ul>
<h3 id="LoggerService"><a href="#LoggerService" class="headerlink" title="LoggerService"></a>LoggerService</h3><p>支持对内置 Logger 的重启，可配合 logrotate 进行一些对日志文件的操作。</p>
<h3 id="StatsService"><a href="#StatsService" class="headerlink" title="StatsService"></a>StatsService</h3><p>内置的数据统计服务，详见<a href="https://www.v2ray.com/chapter_02/stats.html" target="_blank" rel="noopener">统计信息</a>。</p>
<h1 id="统计信息"><a href="#统计信息" class="headerlink" title="统计信息"></a>统计信息</h1><p>V2Ray 提供了一些关于其运行状况的统计信息。</p>
<h2 id="StatsObject"><a href="#StatsObject" class="headerlink" title="StatsObject"></a>StatsObject</h2><p><code>StatsObject</code> 对应配置文件中的<code>stats</code>项。</p>
<pre><code>{
}</code></pre><p>目前统计信息没有任何参数，只要<code>StatsObject</code>项存在，内部的统计即会开启。同时你还需要在 <a href="https://www.v2ray.com/chapter_02/policy.html" target="_blank" rel="noopener">Policy</a> 中开启对应的项，才可以统计对应的数据。</p>
<p>目前已有的统计信息如下：</p>
<h2 id="用户数据"><a href="#用户数据" class="headerlink" title="用户数据"></a>用户数据</h2><blockquote>
<pre><code>user&gt;&gt;&gt;[email]&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink</code></pre></blockquote>
<p>特定用户的上行流量，单位字节。</p>
<blockquote>
<pre><code>user&gt;&gt;&gt;[email]&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink</code></pre></blockquote>
<p>特定用户的下行流量，单位字节。</p>
<p>如果对应用户没有指定 Email，则不会开启统计。</p>
<h2 id="全局数据"><a href="#全局数据" class="headerlink" title="全局数据"></a>全局数据</h2><blockquote>
<pre><code>inbound&gt;&gt;&gt;[tag]&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink</code></pre></blockquote>
<p>特定入站代理的上行流量，单位字节。</p>
<blockquote>
<pre><code>inbound&gt;&gt;&gt;[tag]&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink</code></pre></blockquote>
<p>特定入站代理的下行流量，单位字节。</p>
<h1 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h1><p>反向代理是一个 V2Ray 的附加功能，可以把服务器端的流量向客户端转发，即逆向流量转发。</p>
<p>反向代理功能在 V2Ray 4.0+ 可用。目前处于测试阶段，可能会有一些问题。</p>
<p>反向代理的大致工作原理如下:</p>
<ul>
<li><p>假设在主机 A 中有一个网页服务器，这台主机没有公网 IP，无法在公网上直接访问。另有一台主机 B，它可以由公网访问。现在我们需要把 B 作为入口，把流量从 B 转发到 A。</p>
</li>
<li><p>在主机 A 中配置一个 V2Ray，称为<code>bridge</code>，在 B 中也配置一个 V2Ray，称为<code>portal</code>。</p>
</li>
<li><p><code>bridge</code>会向<code>portal</code>主动建立连接，此连接的目标地址可以自行设定。<code>portal</code>会收到两种连接，一是由<code>bridge</code>发来的连接，二是公网用户发来的连接。<code>portal</code>会自动将两类连接合并。于是<code>bridge</code>就可以收到公网流量了。</p>
</li>
<li><p><code>bridge</code>在收到公网流量之后，会将其原封不动地发给主机 A 中的网页服务器。当然，这一步需要路由的协作。</p>
</li>
<li><p><code>bridge</code>会根据流量的大小进行动态的负载均衡。</p>
</li>
</ul>
<p>反向代理默认已开启 <a href="https://www.v2ray.com/chapter_02/mux.html" target="_blank" rel="noopener">Mux</a>，请不要在其用到的出站代理上再次开启 Mux。</p>
<h2 id="ReverseObject"><a href="#ReverseObject" class="headerlink" title="ReverseObject"></a>ReverseObject</h2><p><code>ReverseObject</code>对应配置文件中的<code>reverse</code>项。</p>
<pre><code>{
  "bridges": [{
    "tag": "bridge",
    "domain": "test.v2ray.com"
  }],
  "portals": [{
    "tag": "portal",
    "domain": "test.v2ray.com"
  }]
}</code></pre><blockquote>
<p><code>bridges</code>: [<a href="https://www.v2ray.com/chapter_02/bridgeobject" target="_blank" rel="noopener">BridgeObject</a>]</p>
</blockquote>
<p>一个数组，每一项表示一个<code>bridge</code>。每个<code>bridge</code>的配置是一个 <a href="https://www.v2ray.com/chapter_02/bridgeobject" target="_blank" rel="noopener">BridgeObject</a>。</p>
<blockquote>
<p><code>portals</code>: [<a href="https://www.v2ray.com/chapter_02/portalobject" target="_blank" rel="noopener">PortalObject</a>]</p>
</blockquote>
<p>一个数组，每一项表示一个<code>portal</code>。每个<code>portal</code>的配置是一个 <a href="https://www.v2ray.com/chapter_02/bridgeobject" target="_blank" rel="noopener">PortalObject</a>。</p>
<h3 id="BridgeObject"><a href="#BridgeObject" class="headerlink" title="BridgeObject"></a>BridgeObject</h3><pre><code>{
  "tag": "bridge",
  "domain": "test.v2ray.com"
}</code></pre><blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p>一个标识，所有由<code>bridge</code>发出的连接，都会带有这个标识。可以在<a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">路由</a>中使用<code>inboundTag</code>进行识别。</p>
<blockquote>
<p><code>domain</code>: string</p>
</blockquote>
<p>一个域名。<code>bridge</code>向<code>portal</code>建立的连接，都会使用这个域名进行发送。这个域名只作为<code>bridge</code>和<code>portal</code>的通信用途，不必真实存在。</p>
<h3 id="PortalObject"><a href="#PortalObject" class="headerlink" title="PortalObject"></a>PortalObject</h3><blockquote>
<p><code>tag</code>: string</p>
</blockquote>
<p><code>portal</code>的标识。在<a href="https://www.v2ray.com/chapter_02/03_routing.html" target="_blank" rel="noopener">路由</a>中使用<code>outboundTag</code>将流量转发到这个<code>portal</code>。</p>
<blockquote>
<p><code>domain</code>: string</p>
</blockquote>
<p>一个域名。当<code>portal</code>接收到流量时，如果流量的目标域名是此域名，则<code>portal</code>认为当前连接上<code>bridge</code>发来的通信连接。而其它流量则会被当成需要转发的流量。<code>portal</code>所做的工作就是把这两类连接进行识别并拼接。</p>
<p>和其它配置一样，一个 V2Ray 既可以作为<code>bridge</code>，也可以作为<code>portal</code>，也可以同时两者，以适用于不同的场景需要。</p>
<h2 id="完整配置"><a href="#完整配置" class="headerlink" title="完整配置"></a>完整配置</h2><p><code>bridge</code>通常需要两个出站代理，一个用于连接<code>portal</code>，另一个用于发送实际的流量。也就是说，你需要用路由区分两种流量。</p>
<p>反向代理配置:</p>
<pre><code>{
  "bridges": [{
    "tag": "bridge",
    "domain": "test.v2ray.com"
  }]
}</code></pre><p>出站代理:</p>
<pre><code>{
  "tag": "out",
  "protocol": "freedom",
  "settings": {
    "redirect": "127.0.0.1:80" // 将所有流量转发到网页服务器
  }
},
{
  "protocol": "vmess",
  "settings": {
    "vnext": [{
      "address": "portal的IP地址",
      "port": 1024,
      "users": [{"id": "27848739-7e62-4138-9fd3-098a63964b6b"}]
    }]
  },
  "tag": "interconn"
}</code></pre><p>路由配置:</p>
<pre><code>"routing": {
  "rules": [{
    "type": "field",
    "inboundTag": ["bridge"],
    "domain": ["full:test.v2ray.com"],
    "outboundTag": "interconn"
  },{
    "type": "field",
    "inboundTag": ["bridge"],
    "outboundTag": "out"
  }]
}</code></pre><p><code>portal</code>通常需要两个入站代理，一个用于接收<code>bridge</code>的连接，另一个用于接收实际的流量。同时你也需要用路由区分两种流量。</p>
<p>反向代理配置:</p>
<pre><code>{
  "portals": [{
    "tag": "portal",
    "domain": "test.v2ray.com"  // 必须和 bridge 的配置一样
  }]
}</code></pre><p>入站代理:</p>
<pre><code>{
  "tag": "external",
  "port": 80,  // 开放 80 端口，用于接收外部的 HTTP 访问
  "protocol": "dokodemo-door",
  "settings": {
    "address": "127.0.0.1",
    "port": 80,
    "network": "tcp"
  }
},
{
  "port": 1024, // 用于接收 bridge 的连接
  "tag": "interconn",
  "protocol": "vmess",
  "settings": {
    "clients": [{"id": "27848739-7e62-4138-9fd3-098a63964b6b"}]
  }
}</code></pre><p>路由配置:</p>
<pre><code>"routing": {
  "rules": [{
    "type": "field",
    "inboundTag": ["external"],
    "outboundTag": "portal"
  },{
    "type": "field",
    "inboundTag": ["interconn"],
    "outboundTag": "portal"
  }]
}</code></pre><p>在运行过程中，建议先启用<code>bridge</code>，再启用<code>portal</code>。</p>
<h1 id="底层传输配置"><a href="#底层传输配置" class="headerlink" title="底层传输配置"></a>底层传输配置</h1><p>底层传输方式（transport）是当前 V2Ray 节点和其它节点对接的方式。底层传输方式提供了稳定的数据传输通道。通常来说，一个网络连接的两端需要有对称的传输方式。比如一端用了 WebSocket，那么另一个端也必须使用 WebSocket，否则无法建立连接。</p>
<p>底层传输（transport）配置分为两部分，一是全局设置(<a href="https://www.v2ray.com/chapter_02/05_transport.html#transportobject" target="_blank" rel="noopener">TransportObject</a>)，二是分协议配置(<a href="https://www.v2ray.com/chapter_02/05_transport.html#streamsettingsobject" target="_blank" rel="noopener">StreamSettingsObject</a>)。分协议配置可以指定每个单独的入站出站协议用怎样的方式传输。通常来说客户端和服务器对应的出站入站协议需要使用同样的传输方式。当分协议传输配置指定了一种传输方式，但没有填写其设置时，此传输方式会使用全局配置中的设置。</p>
<h2 id="TransportObject"><a href="#TransportObject" class="headerlink" title="TransportObject"></a>TransportObject</h2><p><code>TransportObject</code>对应配置文件的<code>transport</code>项。</p>
<pre><code>{
  "tcpSettings": {},
  "kcpSettings": {},
  "wsSettings": {},
  "httpSettings": {},
  "dsSettings": {},
  "quicSettings": {}
}</code></pre><blockquote>
<p><code>tcpSettings</code>: TcpObject</p>
</blockquote>
<p>针对 <a href="https://www.v2ray.com/chapter_02/transport/tcp.html" target="_blank" rel="noopener">TCP 连接的配置</a>。</p>
<blockquote>
<p><code>kcpSettings</code>: KcpObject</p>
</blockquote>
<p>针对 <a href="https://www.v2ray.com/chapter_02/transport/mkcp.html" target="_blank" rel="noopener">mKCP 连接的配置</a>。</p>
<blockquote>
<p><code>wsSettings</code>: WebSocketObject</p>
</blockquote>
<p>针对 <a href="https://www.v2ray.com/chapter_02/transport/websocket.html" target="_blank" rel="noopener">WebSocket 连接的配置</a>。</p>
<blockquote>
<p><code>httpSettings</code>: HttpObject</p>
</blockquote>
<p>针对 <a href="https://www.v2ray.com/chapter_02/transport/h2.html" target="_blank" rel="noopener">HTTP/2 连接的配置</a>。</p>
<blockquote>
<p><code>dsSettings</code>: DomainSocketObject</p>
</blockquote>
<p>针于<a href="https://www.v2ray.com/chapter_02/transport/domainsocket.html" target="_blank" rel="noopener">Domain Socket 连接的配置</a>。</p>
<blockquote>
<p><code>quicSettings</code>: QUICObject</p>
</blockquote>
<p>(V2Ray 4.7+) 针于<a href="https://www.v2ray.com/chapter_02/transport/quic.html" target="_blank" rel="noopener">QUIC 连接的配置</a>。</p>
<h2 id="StreamSettingsObject"><a href="#StreamSettingsObject" class="headerlink" title="StreamSettingsObject"></a>StreamSettingsObject</h2><p><code>TransportObject</code>对应出站入站协议中的<code>streamSettings</code>项。每一个入站、出站连接都可以分别配置不同的传输配置，都可以设置<code>streamSettings</code>来进行一些传输的配置。</p>
<pre><code>{
  "network": "tcp",
  "security": "none",
  "tlsSettings": {},
  "tcpSettings": {},
  "kcpSettings": {},
  "wsSettings": {},
  "httpSettings": {},
  "dsSettings": {},
  "quicSettings": {},
  "sockopt": {
    "mark": 0,
    "tcpFastOpen": false,
    "tproxy": "off"
  }
}</code></pre><blockquote>
<p><code>network</code>: “tcp” | “kcp” | “ws” | “http” | “domainsocket” | “quic”</p>
</blockquote>
<p>数据流所使用的网络类型，默认值为 <code>"tcp"</code></p>
<blockquote>
<p><code>security</code>: “none” | “tls”</p>
</blockquote>
<p>是否启入传输层加密，支持的选项有 <code>"none"</code> 表示不加密（默认值），<code>"tls"</code> 表示使用 <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener">TLS</a>。</p>
<blockquote>
<p><code>tlsSettings</code>: <a href="https://www.v2ray.com/chapter_02/05_transport.html#tlsobject" target="_blank" rel="noopener">TLSObject</a></p>
</blockquote>
<p>TLS 配置。TLS 由 Golang 提供，支持 TLS 1.2，不支持 DTLS。</p>
<blockquote>
<p><code>tcpSettings</code>: <a href="https://www.v2ray.com/chapter_02/transport/tcp.html" target="_blank" rel="noopener">TcpObject</a></p>
</blockquote>
<p>当前连接的 TCP 配置，仅当此连接使用 TCP 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>kcpSettings</code>: KcpObject</p>
</blockquote>
<p>当前连接的 mKCP 配置，仅当此连接使用 mKCP 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>wsSettings</code>: WebSocketObject</p>
</blockquote>
<p>当前连接的 WebSocket 配置，仅当此连接使用 WebSocket 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>httpSettings</code>: HttpObject</p>
</blockquote>
<p>当前连接的 HTTP/2 配置，仅当此连接使用 HTTP/2 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>dsSettings</code>: DomainSocketObject</p>
</blockquote>
<p>当前连接的 Domain socket 配置，仅当此连接使用 Domain socket 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>quicSettings</code>: QUICObject</p>
</blockquote>
<p>(V2Ray 4.7+) 当前连接的 QUIC 配置，仅当此连接使用 QUIC 时有效。配置内容与上面的全局配置相同。</p>
<blockquote>
<p><code>sockopt</code>: SockoptObject</p>
</blockquote>
<p>连接选项</p>
<h3 id="TLSObject"><a href="#TLSObject" class="headerlink" title="TLSObject"></a>TLSObject</h3><pre><code>{
  "serverName": "v2ray.com",
  "allowInsecure": false,
  "alpn": ["http/1.1"],
  "certificates": [],
  "disableSystemRoot": false
}</code></pre><blockquote>
<p><code>serverName</code>: string</p>
</blockquote>
<p>指定服务器端证书的域名，在连接由 IP 建立时有用。当目标连接由域名指定时，比如在 Socks 入站时接收到了域名，或者由 Sniffing 功能探测出了域名，这个域名会自动用于<code>serverName</code>，无须手动配置。</p>
<blockquote>
<p><code>alpn</code>: [ string ]</p>
</blockquote>
<p>一个字符串数组，指定了 TLS 握手时指定的 ALPN 数值。默认值为<code>["http/1.1"]</code>。</p>
<blockquote>
<p><code>allowInsecure</code>: true | false</p>
</blockquote>
<p>是否允许不安全连接（用于客户端）。当值为<code>true</code>时，V2Ray 不会检查远端主机所提供的 TLS 证书的有效性。</p>
<blockquote>
<p><code>allowInsecureCiphers</code>: true | false</p>
</blockquote>
<p>是否允许不安全的加密方式。默认情况下 TLS 只使用 TLS 1.3 推荐的加密算法套件，开启这一选项会增加一些与 TLS 1.2 兼容的加密套件。</p>
<blockquote>
<p><code>disableSystemRoot</code>: true | false</p>
</blockquote>
<p>(V2Ray 4.18+) 是否禁用操作系统自带的 CA 证书。默认值为<code>false</code>。当值为<code>true</code>时，V2Ray 只会使用<code>certificates</code>中指定的证书进行 TLS 握手。</p>
<blockquote>
<p><code>certificates</code>: [ <a href="https://www.v2ray.com/chapter_02/05_transport.html#certificateobject" target="_blank" rel="noopener">CertificateObject</a> ]</p>
</blockquote>
<p>证书列表，其中每一项表示一个证书</p>
<h3 id="CertificateObject"><a href="#CertificateObject" class="headerlink" title="CertificateObject"></a>CertificateObject</h3><pre><code>{
  "usage": "encipherment",

  "certificateFile": "/path/to/certificate.crt",
  "keyFile": "/path/to/key.key",

  "certificate": [
    "-----BEGIN CERTIFICATE-----",
    "MIICwDCCAaigAwIBAgIRAO16JMdESAuHidFYJAR/7kAwDQYJKoZIhvcNAQELBQAw",
    "ADAeFw0xODA0MTAxMzU1MTdaFw0xODA0MTAxNTU1MTdaMAAwggEiMA0GCSqGSIb3",
    "DQEBAQUAA4IBDwAwggEKAoIBAQCs2PX0fFSCjOemmdm9UbOvcLctF94Ox4BpSfJ+",
    "3lJHwZbvnOFuo56WhQJWrclKoImp/c9veL1J4Bbtam3sW3APkZVEK9UxRQ57HQuw",
    "OzhV0FD20/0YELou85TwnkTw5l9GVCXT02NG+pGlYsFrxesUHpojdl8tIcn113M5",
    "pypgDPVmPeeORRf7nseMC6GhvXYM4txJPyenohwegl8DZ6OE5FkSVR5wFQtAhbON",
    "OAkIVVmw002K2J6pitPuJGOka9PxcCVWhko/W+JCGapcC7O74palwBUuXE1iH+Jp",
    "noPjGp4qE2ognW3WH/sgQ+rvo20eXb9Um1steaYY8xlxgBsXAgMBAAGjNTAzMA4G",
    "A1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMBAf8EAjAA",
    "MA0GCSqGSIb3DQEBCwUAA4IBAQBUd9sGKYemzwPnxtw/vzkV8Q32NILEMlPVqeJU",
    "7UxVgIODBV6A1b3tOUoktuhmgSSaQxjhYbFAVTD+LUglMUCxNbj56luBRlLLQWo+",
    "9BUhC/ow393tLmqKcB59qNcwbZER6XT5POYwcaKM75QVqhCJVHJNb1zSEE7Co7iO",
    "6wIan3lFyjBfYlBEz5vyRWQNIwKfdh5cK1yAu13xGENwmtlSTHiwbjBLXfk+0A/8",
    "r/2s+sCYUkGZHhj8xY7bJ1zg0FRalP5LrqY+r6BckT1QPDIQKYy615j1LpOtwZe/",
    "d4q7MD/dkzRDsch7t2cIjM/PYeMuzh87admSyL6hdtK0Nm/Q",
    "-----END CERTIFICATE-----"
  ],
  "key": [
    "-----BEGIN RSA PRIVATE KEY-----",
    "MIIEowIBAAKCAQEArNj19HxUgoznppnZvVGzr3C3LRfeDseAaUnyft5SR8GW75zh",
    "bqOeloUCVq3JSqCJqf3Pb3i9SeAW7Wpt7FtwD5GVRCvVMUUOex0LsDs4VdBQ9tP9",
    "GBC6LvOU8J5E8OZfRlQl09NjRvqRpWLBa8XrFB6aI3ZfLSHJ9ddzOacqYAz1Zj3n",
    "jkUX+57HjAuhob12DOLcST8np6IcHoJfA2ejhORZElUecBULQIWzjTgJCFVZsNNN",
    "itieqYrT7iRjpGvT8XAlVoZKP1viQhmqXAuzu+KWpcAVLlxNYh/iaZ6D4xqeKhNq",
    "IJ1t1h/7IEPq76NtHl2/VJtbLXmmGPMZcYAbFwIDAQABAoIBAFCgG4phfGIxK9Uw",
    "qrp+o9xQLYGhQnmOYb27OpwnRCYojSlT+mvLcqwvevnHsr9WxyA+PkZ3AYS2PLue",
    "C4xW0pzQgdn8wENtPOX8lHkuBocw1rNsCwDwvIguIuliSjI8o3CAy+xVDFgNhWap",
    "/CMzfQYziB7GlnrM6hH838iiy0dlv4I/HKk+3/YlSYQEvnFokTf7HxbDDmznkJTM",
    "aPKZ5qbnV+4AcQfcLYJ8QE0ViJ8dVZ7RLwIf7+SG0b0bqloti4+oQXqGtiESUwEW",
    "/Wzi7oyCbFJoPsFWp1P5+wD7jAGpAd9lPIwPahdr1wl6VwIx9W0XYjoZn71AEaw4",
    "bK4xUXECgYEA3g2o9WqyrhYSax3pGEdvV2qN0VQhw7Xe+jyy98CELOO2DNbB9QNJ",
    "8cSSU/PjkxQlgbOJc8DEprdMldN5xI/srlsbQWCj72wXxXnVnh991bI2clwt7oYi",
    "pcGZwzCrJyFL+QaZmYzLxkxYl1tCiiuqLm+EkjxCWKTX/kKEFb6rtnMCgYEAx0WR",
    "L8Uue3lXxhXRdBS5QRTBNklkSxtU+2yyXRpvFa7Qam+GghJs5RKfJ9lTvjfM/PxG",
    "3vhuBliWQOKQbm1ZGLbgGBM505EOP7DikUmH/kzKxIeRo4l64mioKdDwK/4CZtS7",
    "az0Lq3eS6bq11qL4mEdE6Gn/Y+sqB83GHZYju80CgYABFm4KbbBcW+1RKv9WSBtK",
    "gVIagV/89moWLa/uuLmtApyEqZSfn5mAHqdc0+f8c2/Pl9KHh50u99zfKv8AsHfH",
    "TtjuVAvZg10GcZdTQ/I41ruficYL0gpfZ3haVWWxNl+J47di4iapXPxeGWtVA+u8",
    "eH1cvgDRMFWCgE7nUFzE8wKBgGndUomfZtdgGrp4ouLZk6W4ogD2MpsYNSixkXyW",
    "64cIbV7uSvZVVZbJMtaXxb6bpIKOgBQ6xTEH5SMpenPAEgJoPVts816rhHdfwK5Q",
    "8zetklegckYAZtFbqmM0xjOI6bu5rqwFLWr1xo33jF0wDYPQ8RHMJkruB1FIB8V2",
    "GxvNAoGBAM4g2z8NTPMqX+8IBGkGgqmcYuRQxd3cs7LOSEjF9hPy1it2ZFe/yUKq",
    "ePa2E8osffK5LBkFzhyQb0WrGC9ijM9E6rv10gyuNjlwXdFJcdqVamxwPUBtxRJR",
    "cYTY2HRkJXDdtT0Bkc3josE6UUDvwMpO0CfAETQPto1tjNEDhQhT",
    "-----END RSA PRIVATE KEY-----"
  ]
}</code></pre><blockquote>
<p><code>usage</code>: “encipherment” | “verify” | “issue”</p>
</blockquote>
<p>证书用途，默认值为<code>"encipherment"</code></p>
<ul>
<li><p><code>"encipherment"</code>: 证书用于 TLS 认证和加密。</p>
</li>
<li><p><code>"verify"</code>: 证书用于验证远端 TLS 的证书。当使用此项时，当前证书必须为 CA 证书。</p>
</li>
<li><p><code>"issue"</code>: 证书用于签发其它证书。当使用此项时，当前证书必须为 CA 证书。</p>
</li>
</ul>
<p>在 Windows 平台上可以将自签名的 CA 证书安装到系统中，即可验证远端 TLS 的证书。</p>
<p>当有新的客户端请求时，假设所指定的<code>serverName</code>为<code>"v2ray.com"</code>，V2Ray 会先从证书列表中寻找可用于<code>"v2ray.com"</code>的证书，如果没有找到，则使用任一<code>usage</code>为<code>"issue"</code>的证书签发一个适用于<code>"v2ray.com"</code>的证书，有效期为一小时。并将新的证书加入证书列表，以供后续使用。</p>
<blockquote>
<p><code>certificateFile</code>: string</p>
</blockquote>
<p>证书文件路径，如使用 OpenSSL 生成，后缀名为 .crt。</p>
<p>使用<code>v2ctl cert -ca</code>可以生成自签名的 CA 证书。</p>
<blockquote>
<p><code>certificate</code>: [ string ]</p>
</blockquote>
<p>一个字符串数组，表示证书内容，格式如样例所示。<code>certificate</code>和<code>certificateFile</code>二者选一。</p>
<blockquote>
<p><code>keyFile</code>: string</p>
</blockquote>
<p>密钥文件路径，如使用 OpenSSL 生成，后缀名为 .key。目前暂不支持需要密码的 key 文件。</p>
<blockquote>
<p><code>key</code>: [ string ]</p>
</blockquote>
<p>一个字符串数组，表示密钥内容，格式如样例如示。<code>key</code>和<code>keyFile</code>二者选一。</p>
<p>当<code>certificateFile</code>和<code>certificate</code>同时指定时，V2Ray 优先使用<code>certificateFile</code>。<code>keyFile</code>和<code>key</code>也一样。</p>
<p>当<code>usage</code>为<code>"verify"</code>时，<code>keyFile</code>和<code>key</code>可均为空。</p>
<h3 id="SockoptObject"><a href="#SockoptObject" class="headerlink" title="SockoptObject"></a>SockoptObject</h3><pre><code>{
  "mark": 0,
  "tcpFastOpen": false,
  "tproxy": "off"
}</code></pre><blockquote>
<p><code>mark</code>: number</p>
</blockquote>
<p>一个整数。当其值非零时，在出站连接上标记 SO_MARK。</p>
<ul>
<li><p>仅适用于 Linux 系统。</p>
</li>
<li><p>需要 CAP_NET_ADMIN 权限。</p>
</li>
</ul>
<blockquote>
<p><code>tcpFastOpen</code>: true | false</p>
</blockquote>
<p>是否启用 <a href="https://zh.wikipedia.org/wiki/TCP快速打开" target="_blank" rel="noopener">TCP Fast Open</a>。当其值为<code>true</code>时，强制开启TFO；当其它为<code>false</code>时，强制关闭TFO；当此项不存在时，使用系统默认设置。可用于入站出站连接。</p>
<ul>
<li><p>仅在以下版本（或更新版本）的操作系统中可用:</p>
<ul>
<li>Windows 10 (1604)</li>
</ul>
</li>
<li><p>Mac OS 10.11 / iOS 9</p>
</li>
<li><p>Linux 3.16: 系统已默认开启，无需要配置。</p>
</li>
</ul>
<blockquote>
<p><code>tproxy</code>: “redirect” | “tproxy” | “off”</p>
</blockquote>
<p>是否开启透明代理 (仅适用于 Linux)。</p>
<ul>
<li><p><code>"redirect"</code>: 使用 Redirect 模式的透明代理。仅支持 TCP/IPv4 和 UDP 连接。</p>
</li>
<li><p><code>"tproxy"</code>: 使用 TProxy 模式的透明代理。支持 TCP 和 UDP 连接。</p>
</li>
<li><p><code>"off"</code>: 关闭透明代理。</p>
</li>
</ul>
<p>透明代理需要 Root 或 CAP_NET_ADMIN 权限。</p>
<p>当 <a href="https://www.v2ray.com/chapter_02/protocols/dokodemo.html" target="_blank" rel="noopener">Dokodemo-door</a> 中指定了<code>followRedirect</code>，且<code>sockopt.tproxy</code>为空时，<code>sockopt.tproxy</code>的值会被设为<code>"redirect"</code>。</p>
<h1 id="TCP-传输方式"><a href="#TCP-传输方式" class="headerlink" title="TCP 传输方式"></a>TCP 传输方式</h1><h2 id="TcpObject"><a href="#TcpObject" class="headerlink" title="TcpObject"></a>TcpObject</h2><pre><code>{
  "header": {
    "type": "none"
  }
}</code></pre><blockquote>
<p><code>header</code>: NoneHeaderObject | HttpHeaderobject</p>
</blockquote>
<p>数据包头部伪装设置，默认值为<code>NoneHeaderObject</code>。</p>
<h3 id="NoneHeaderObject"><a href="#NoneHeaderObject" class="headerlink" title="NoneHeaderObject"></a>NoneHeaderObject</h3><p>不进行伪装</p>
<pre><code>{
  "type": "none"
}</code></pre><blockquote>
<p><code>type</code>: “none”</p>
</blockquote>
<p>指定不进行伪装</p>
<h3 id="HttpHeaderObject"><a href="#HttpHeaderObject" class="headerlink" title="HttpHeaderObject"></a>HttpHeaderObject</h3><p>HTTP 伪装配置必须在对应的入站出站连接上同时配置，且内容必须一致。</p>
<pre><code>{
  "type": "http",
  "request": {},
  "response": {}
}</code></pre><blockquote>
<p><code>type</code>: “http”</p>
</blockquote>
<p>指定进行 HTTP 伪装</p>
<blockquote>
<p><code>request</code>: <a href="https://www.v2ray.com/chapter_02/transport/tcp.html#httprequestobject" target="_blank" rel="noopener">HTTPRequestObject</a></p>
</blockquote>
<p>HTTP 请求</p>
<blockquote>
<p><code>response</code>: <a href="https://www.v2ray.com/chapter_02/transport/tcp.html#httpresponseobject" target="_blank" rel="noopener">HTTPResponseObject</a></p>
</blockquote>
<p>HTTP 响应</p>
<h3 id="HTTPRequestObject"><a href="#HTTPRequestObject" class="headerlink" title="HTTPRequestObject"></a>HTTPRequestObject</h3><pre><code>{
  "version": "1.1",
  "method": "GET",
  "path": ["/"],
  "headers": {
    "Host": ["www.baidu.com", "www.bing.com"],
    "User-Agent": [
      "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36",
      "Mozilla/5.0 (iPhone; CPU iPhone OS 10_0_2 like Mac OS X) AppleWebKit/601.1 (KHTML, like Gecko) CriOS/53.0.2785.109 Mobile/14A456 Safari/601.1.46"
    ],
    "Accept-Encoding": ["gzip, deflate"],
    "Connection": ["keep-alive"],
    "Pragma": "no-cache"
  }
}</code></pre><blockquote>
<p><code>version</code>: string</p>
</blockquote>
<p>HTTP 版本，默认值为<code>"1.1"</code>。</p>
<blockquote>
<p><code>method</code>: string</p>
</blockquote>
<p>HTTP 方法，默认值为<code>"GET"</code>。</p>
<blockquote>
<p><code>path</code>: [ string ]</p>
</blockquote>
<p>路径，一个字符串数组。默认值为<code>["/"]</code>。当有多个值时，每次请求随机选择一个值。</p>
<blockquote>
<p><code>headers</code>: map{ string, [ string ]}</p>
</blockquote>
<p>HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是一个数组。每次请求会附上所有的键，并随机选择一个对应的值。默认值见上方示例。</p>
<h3 id="HTTPResponseObject"><a href="#HTTPResponseObject" class="headerlink" title="HTTPResponseObject"></a>HTTPResponseObject</h3><pre><code>{
  "version": "1.1",
  "status": "200",
  "reason": "OK",
  "headers": {
    "Content-Type": ["application/octet-stream", "video/mpeg"],
    "Transfer-Encoding": ["chunked"],
    "Connection": ["keep-alive"],
    "Pragma": "no-cache"
  }
}</code></pre><blockquote>
<p><code>version</code>: string</p>
</blockquote>
<p>HTTP 版本，默认值为<code>"1.1"</code>。</p>
<blockquote>
<p><code>status</code>: string</p>
</blockquote>
<p>HTTP 状态，默认值为<code>"200"</code>。</p>
<blockquote>
<p><code>reason</code>: string</p>
</blockquote>
<p>HTTP 状态说明，默认值为<code>"OK"</code>。</p>
<blockquote>
<p><code>headers</code>: map{string, [ string ]}</p>
</blockquote>
<p>HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是一个数组。每次请求会附上所有的键，并随机选择一个对应的值。默认值见上方示例。</p>
<h1 id="mKCP-传输方式"><a href="#mKCP-传输方式" class="headerlink" title="mKCP 传输方式"></a>mKCP 传输方式</h1><p>mKCP 使用 UDP 来模拟 TCP 连接，请确定主机上的防火墙配置正确。mKCP 牺牲带宽来降低延迟。传输同样的内容，mKCP 一般比 TCP 消耗更多的流量。</p>
<h2 id="KcpObject"><a href="#KcpObject" class="headerlink" title="KcpObject"></a>KcpObject</h2><pre><code>{
  "mtu": 1350,
  "tti": 20,
  "uplinkCapacity": 5,
  "downlinkCapacity": 20,
  "congestion": false,
  "readBufferSize": 1,
  "writeBufferSize": 1,
  "header": {
    "type": "none"
  }
}</code></pre><blockquote>
<p><code>mtu</code>: number</p>
</blockquote>
<p>最大传输单元（maximum transmission unit），请选择一个介于 <code>576</code> - <code>1460</code> 之间的值。默认值为 <code>1350</code>。</p>
<blockquote>
<p><code>tti</code>: number</p>
</blockquote>
<p>传输时间间隔（transmission time interval），单位毫秒（ms），mKCP 将以这个时间频率发送数据。请选译一个介于 <code>10</code> - <code>100</code> 之间的值。默认值为 <code>50</code>。</p>
<blockquote>
<p><code>uplinkCapacity</code>: number</p>
</blockquote>
<p>上行链路容量，即主机发出数据所用的最大带宽，单位 MB/s，默认值 <code>5</code>。注意是 Byte 而非 bit。可以设置为 <code>0</code>，表示一个非常小的带宽。</p>
<blockquote>
<p><code>downlinkCapacity</code>: number</p>
</blockquote>
<p>下行链路容量，即主机接收数据所用的最大带宽，单位 MB/s，默认值 <code>20</code>。注意是 Byte 而非 bit。可以设置为 <code>0</code>，表示一个非常小的带宽。</p>
<p><code>uplinkCapacity</code> 和 <code>downlinkCapacity</code> 决定了 mKCP 的传输速度。以客户端发送数据为例，客户端的 <code>uplinkCapacity</code> 指定了发送数据的速度，而服务器端的 <code>downlinkCapacity</code> 指定了接收数据的速度。两者的值以较小的一个为准。推荐把 <code>downlinkCapacity</code> 设置为一个较大的值，比如 100，而 <code>uplinkCapacity</code> 设为实际的网络速度。当速度不够时，可以逐渐增加 <code>uplinkCapacity</code> 的值，直到带宽的两倍左右。</p>
<blockquote>
<p><code>congestion</code>: true | false</p>
</blockquote>
<p>是否启用拥塞控制，默认值为 <code>false</code>。开启拥塞控制之后，V2Ray 会自动监测网络质量，当丢包严重时，会自动降低吞吐量；当网络畅通时，也会适当增加吞吐量。</p>
<blockquote>
<p><code>readBufferSize</code>: number</p>
</blockquote>
<p>单个连接的读取缓冲区大小，单位是 MB。默认值为 <code>2</code>。</p>
<blockquote>
<p><code>writeBufferSize</code>: number</p>
</blockquote>
<p>单个连接的写入缓冲区大小，单位是 MB。默认值为 <code>2</code>。</p>
<p><code>readBufferSize</code> 和 <code>writeBufferSize</code> 指定了单个连接所使用的内存大小。在需要高速传输时，指定较大的 <code>readBufferSize</code> 和 <code>writeBufferSize</code> 会在一定程度上提高速度，但也会使用更多的内存。在网速不超过 20MB/s 时，默认值 1MB 可以满足需求；超过之后，可以适当增加 <code>readBufferSize</code> 和 <code>writeBufferSize</code> 的值，然后手动平衡速度和内存的关系。</p>
<blockquote>
<p><code>header</code>: <a href="https://www.v2ray.com/chapter_02/transport/mkcp.html#headerobject" target="_blank" rel="noopener">HeaderObject</a></p>
</blockquote>
<p>数据包头部伪装设置</p>
<h3 id="HeaderObject"><a href="#HeaderObject" class="headerlink" title="HeaderObject"></a>HeaderObject</h3><pre><code>{
  "type": "none"
}</code></pre><blockquote>
<p><code>type</code>: string</p>
</blockquote>
<p>伪装类型，可选的值有：</p>
<ul>
<li><p><code>"none"</code>: 默认值，不进行伪装，发送的数据是没有特征的数据包。</p>
</li>
<li><p><code>"srtp"</code>: 伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。</p>
</li>
<li><p><code>"utp"</code>: 伪装成 uTP 数据包，会被识别为 BT 下载数据。</p>
</li>
<li><p><code>"wechat-video"</code>: 伪装成微信视频通话的数据包。</p>
</li>
<li><p><code>"dtls"</code>: 伪装成 DTLS 1.2 数据包。</p>
</li>
<li><p><code>"wireguard"</code>: 伪装成 WireGuard 数据包。(并不是真正的 WireGuard 协议)</p>
</li>
</ul>
<h2 id="对-KCP-协议的改进"><a href="#对-KCP-协议的改进" class="headerlink" title="对 KCP 协议的改进"></a>对 KCP 协议的改进</h2><h3 id="更小的协议头"><a href="#更小的协议头" class="headerlink" title="更小的协议头"></a>更小的协议头</h3><p>原生 KCP 协议使用了 24 字节的固定头部，而 mKCP 修改为数据包 18 字节，确认（ACK）包 16 字节。更小的头部有助于躲避特征检查，并加快传输速度。</p>
<p>另外，原生 KCP 的单个确认包只能确认一个数据包已收到，也就是说当 KCP 需要确认 100 个数据已收到时，它会发出 24 * 100 = 2400 字节的数据。其中包含了大量重复的头部数据，造成带宽的浪费。mKCP 会对多个确认包进行压缩，100 个确认包只需要 16 + 2 + 100 * 4 = 418 字节，相当于原生的六分之一。</p>
<h3 id="确认包重传"><a href="#确认包重传" class="headerlink" title="确认包重传"></a>确认包重传</h3><p>原生 KCP 协议的确认（ACK）包只发送一次，如果确认包丢失，则一定会导致数据重传，造成不必要的带宽浪费。而 mKCP 会以一定的频率重发确认包，直到发送方确认为止。单个确认包的大小为 22 字节，相比起数据包的 1000 字节以上，重传确认包的代价要小得多。</p>
<h3 id="连接状态控制"><a href="#连接状态控制" class="headerlink" title="连接状态控制"></a>连接状态控制</h3><p>mKCP 可以有效地开启和关闭连接。当远程主机主动关闭连接时，连接会在两秒钟之内释放；当远程主机断线时，连接会在最多 30 秒内释放。</p>
<p>原生 KCP 不支持这个场景。</p>
<h1 id="WebSocket-传输方式"><a href="#WebSocket-传输方式" class="headerlink" title="WebSocket 传输方式"></a>WebSocket 传输方式</h1><p>使用标准的 WebSocket 来传输数据。WebSocket 连接可以被其它 HTTP 服务器（如 NGINX）分流。</p>
<p>Websocket 会识别 HTTP 请求的 X-Forwarded-For 头来用做流量的源地址。</p>
<h2 id="示例配置"><a href="#示例配置" class="headerlink" title="示例配置"></a>示例配置</h2><pre><code>{
  "path": "/",
  "headers": {
    "Host": "v2ray.com"
  }
}</code></pre><blockquote>
<p><code>path</code> string</p>
</blockquote>
<p>WebSocket 所使用的 HTTP 协议路径，默认值为 <code>"/"</code>。</p>
<blockquote>
<p><code>headers</code>: map{string: string}</p>
</blockquote>
<p>自定义 HTTP 头，一个键值对，每个键表示一个 HTTP 头的名称，对应的值是字符串。默认值为空。</p>
<h1 id="HTTP-2-传输方式"><a href="#HTTP-2-传输方式" class="headerlink" title="HTTP/2 传输方式"></a>HTTP/2 传输方式</h1><p>V2Ray 3.17 中加入了基于 HTTP/2 的传输方式。它完整按照 HTTP/2 标准实现，可以通过其它的 HTTP 服务器（如 Nginx）进行中转。</p>
<p>由 HTTP/2 的建议，客户端和服务器必须同时开启 TLS 才可以正常使用这个传输方式。</p>
<p>V2Ray 4.20 中对服务端的TLS配置的强制条件移除，为了在特殊用途的分流部署环境中，由外部网关组件完成TLS层对话，V2Ray作为后端应用，网关和V2Ray间使用称为<code>h2c</code>的明文http/2进行通讯。</p>
<h2 id="HttpObject"><a href="#HttpObject" class="headerlink" title="HttpObject"></a>HttpObject</h2><p><code>HttpObject</code>对应传输配置中的<code>httpSettings</code>项。</p>
<pre><code>{
  "host": ["v2ray.com"],
  "path": "/random/path"
}</code></pre><blockquote>
<p><code>host</code>: [string]</p>
</blockquote>
<p>一个字符串数组，每一个元素是一个域名。客户端会随机从列表中选出一个域名进行通信，服务器会验证域名是否在列表中。</p>
<blockquote>
<p><code>path</code> string</p>
</blockquote>
<p>HTTP 路径，由<code>/</code>开头。客户端和服务器必须一致。可选参数，默认值为<code>"/"</code>。</p>
<h1 id="DomainSocket-传输方式"><a href="#DomainSocket-传输方式" class="headerlink" title="DomainSocket 传输方式"></a>DomainSocket 传输方式</h1><p>Domain Socket 使用标准的 Unix domain socket 来传输数据。它的优势是使用了操作系统内建的传输通道，而不会占用网络缓存。相比起本地环回网络（local loopback）来说，Domain socket 速度略快一些。</p>
<p>目前仅可用于支持 Unix domain socket 的平台，如 macOS 和 Linux。在 Windows 上不可用。</p>
<p>如果指定了 domain socket 作为传输方式，在入站出站代理中配置的端口和 IP 地址将会失效，所有的传输由 domain socket 取代。</p>
<h2 id="DomainSocketObject"><a href="#DomainSocketObject" class="headerlink" title="DomainSocketObject"></a>DomainSocketObject</h2><p><code>DomainSocketObject</code>对应传输配置中的<code>dsSettings</code>项。</p>
<pre><code>{
  "path": "/path/to/ds/file"
}</code></pre><blockquote>
<p><code>path</code>: string</p>
</blockquote>
<p>一个合法的文件路径。在运行 V2Ray 之前，这个文件必须不存在。</p>
<h1 id="QUIC-传输方式"><a href="#QUIC-传输方式" class="headerlink" title="QUIC 传输方式"></a>QUIC 传输方式</h1><p>QUIC 全称 Quick UDP Internet Connection，是由 Google 提出的使用 UDP 进行多路并发传输的协议。其主要优势是:</p>
<ol>
<li>减少了握手的延迟（1-RTT 或 0-RTT）</li>
<li>多路复用，并且没有 TCP 的阻塞问题</li>
<li>连接迁移，（主要是在客户端）当由 Wifi 转移到 4G 时，连接不会被断开。</li>
</ol>
<p>QUIC 目前处于实验期，使用了正在标准化过程中的 IETF 实现，不能保证与最终版本的兼容性。</p>
<h2 id="版本历史"><a href="#版本历史" class="headerlink" title="版本历史"></a>版本历史</h2><p>V2Ray 4.7:</p>
<ul>
<li><p>开始支持 QUIC。</p>
</li>
<li><p>默认设定:</p>
<ul>
<li>12 字节的 Connection ID</li>
</ul>
</li>
<li><p>30 秒没有数据通过时自动断开连接 (可能会影响一些长连接的使用)</p>
</li>
</ul>
<h2 id="QuicObject"><a href="#QuicObject" class="headerlink" title="QuicObject"></a>QuicObject</h2><p>QUIC 的配置对应传输配置中的 <code>quicSettings</code> 项。对接的两端的配置必须完全一致，否则连接失败。QUIC 强制要求开启 TLS，在传输配置中没有开启 TLS 时，V2Ray 会自行签发一个证书进行 TLS 通讯。在使用 QUIC 传输时，可以关闭 VMess 的加密。</p>
<pre><code>{
  "security": "none",
  "key": "",
  "header": {
    "type": "none"
  }
}</code></pre><blockquote>
<p><code>security</code>: “none” | “aes-128-gcm” | “chacha20-poly1305”</p>
</blockquote>
<p>加密方式。默认值为不加密。</p>
<p>此加密是对 QUIC 数据包的加密，加密后数据包无法被探测。</p>
<blockquote>
<p><code>key</code>: string</p>
</blockquote>
<p>加密时所用的密钥。可以是任意字符串。当<code>security</code>不为<code>"none"</code>时有效。</p>
<blockquote>
<p><code>header</code>: <a href="https://www.v2ray.com/chapter_02/transport/quic.html#headerobject" target="_blank" rel="noopener">HeaderObject</a></p>
</blockquote>
<p>数据包头部伪装设置</p>
<h3 id="HeaderObject-1"><a href="#HeaderObject-1" class="headerlink" title="HeaderObject"></a>HeaderObject</h3><pre><code>{
  "type": "none"
}</code></pre><blockquote>
<p><code>type</code>: string</p>
</blockquote>
<p>伪装类型，可选的值有：</p>
<ul>
<li><p><code>"none"</code>: 默认值，不进行伪装，发送的数据是没有特征的数据包。</p>
</li>
<li><p><code>"srtp"</code>: 伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。</p>
</li>
<li><p><code>"utp"</code>: 伪装成 uTP 数据包，会被识别为 BT 下载数据。</p>
</li>
<li><p><code>"wechat-video"</code>: 伪装成微信视频通话的数据包。</p>
</li>
<li><p><code>"dtls"</code>: 伪装成 DTLS 1.2 数据包。</p>
</li>
<li><p><code>"wireguard"</code>: 伪装成 WireGuard 数据包。(并不是真正的 WireGuard 协议)</p>
</li>
</ul>
<h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><p>V2Ray 提供以下环境变量以供修改 V2Ray 的一些底层配置。</p>
<h2 id="每个连接的缓存大小"><a href="#每个连接的缓存大小" class="headerlink" title="每个连接的缓存大小"></a>每个连接的缓存大小</h2><ul>
<li><p>名称: <code>v2ray.ray.buffer.size</code> 或 <code>V2RAY_RAY_BUFFER_SIZE</code></p>
</li>
<li><p>单位: MBytes</p>
</li>
<li><p>默认值: 在 x86、amd64、arm64、s390x 上为 2，其它平台上禁用该缓存。</p>
</li>
<li><p>特殊值: 0 表示缓存无上限</p>
</li>
</ul>
<p><strong>已过时，请使用本地策略中的 bufferSize</strong></p>
<p>对于一个代理连接，当上下游网络速度有差距时，V2Ray 会缓存一部分数据，以减小对网络传输的影响。这个配置设置了缓存的大小，越大的缓存会占用更多的内存，也会使网络性能越好。</p>
<h2 id="资源文件路径"><a href="#资源文件路径" class="headerlink" title="资源文件路径"></a>资源文件路径</h2><ul>
<li><p>名称: <code>v2ray.location.asset</code> 或 <code>V2RAY_LOCATION_ASSET</code></p>
</li>
<li><p>默认值: 和 v2ray 文件同路径</p>
</li>
</ul>
<p>这个环境变量指定了一个文件夹位置，这个文件夹应当包含 geoip.dat 和 geosite.dat 文件。</p>
<h2 id="配置文件位置"><a href="#配置文件位置" class="headerlink" title="配置文件位置"></a>配置文件位置</h2><ul>
<li><p>名称: <code>v2ray.location.config</code> 或 <code>V2RAY_LOCATION_CONFIG</code></p>
</li>
<li><p>默认值: 和 v2ray 文件同路径</p>
</li>
</ul>
<p>这个环境变量指定了一个文件夹位置，这个文件夹应当包含 config.json 文件。</p>
<h2 id="分散读取"><a href="#分散读取" class="headerlink" title="分散读取"></a>分散读取</h2><ul>
<li><p>名称：<code>v2ray.buf.readv</code> 或 <code>V2RAY_BUF_READV</code></p>
</li>
<li><p>默认值：<code>auto</code></p>
</li>
</ul>
<p>V2Ray 3.37 开始使用 Scatter/Gather IO，这一特性可以在大流量（超过 100 MByte/s）的时候依然使用较低的内存。可选的值有<code>auto</code>、<code>enable</code>和<code>disable</code>。</p>
<ul>
<li><p><code>enable</code>: 强制开启分散读取特性。</p>
</li>
<li><p><code>disable</code>: 强制关闭分散读取特性</p>
</li>
<li><p><code>auto</code>: 仅在 Windows、MacOS、Linux 并且 CPU 平台为 x86、AMD64、s390x 时，开启此特性。</p>
</li>
</ul>
<p>在流量没有达到 100 MByte/s 时，开启与否在内存使用上没有明显的差异。</p>
<h1 id="图形客户端"><a href="#图形客户端" class="headerlink" title="图形客户端"></a>图形客户端</h1><blockquote>
<p>V2RayW </p>
</blockquote>
<p>V2RayW 是一个基于 V2Ray 内核的 Windows 客户端。用户可以通过界面生成配置文件，并且可以手动更新 V2Ray 内核。下载：<a href="https://github.com/Cenmrev/V2RayW" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>V2RayN </p>
</blockquote>
<p>V2RayN 是一个基于 V2Ray 内核的 Windows 客户端。下载：<a href="https://github.com/2dust/v2rayN" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>Clash for Windows </p>
</blockquote>
<p>下载：<a href="https://github.com/Fndroid/clash_for_windows_pkg" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>V2RayX </p>
</blockquote>
<p>V2RayX 是一个基于 V2Ray 内核的 Mac OS X 客户端。用户可以通过界面生成配置文件，并且可以手动更新 V2Ray 内核。V2RayX 还可以配置系统代理。下载：<a href="https://github.com/Cenmrev/V2RayX" target="_blank" rel="noopener">Github</a></p>
<blockquote>
<p>V2RayU </p>
</blockquote>
<p>V2rayU,基于v2ray核心的mac版客户端,界面友好,使用swift4.2编写,支持vmess,shadowsocks,socks5等服务协议,支持订阅, 支持二维码,剪贴板导入,手动配置,二维码分享等。下载：<a href="https://github.com/yanue/V2rayU" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>V2RayC </p>
</blockquote>
<p>下载：<a href="https://github.com/gssdromen/V2RayC" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>ClashX </p>
</blockquote>
<p>下载：<a href="https://github.com/yichengchen/clashX" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>Qv2ray </p>
</blockquote>
<p>Qv2ray：使用 Qt 编写的 v2ray 跨平台 GUI （MacOS, Windows, Linux）支持连接导入和编辑，中英文切换</p>
<p>下载：<a href="https://github.com/lhy0403/Qv2ray" target="_blank" rel="noopener">GitHub</a></p>
<p>官网：<a href="https://lhy0403.github.io/Qv2ray" target="_blank" rel="noopener">https://lhy0403.github.io/Qv2ray</a></p>
<blockquote>
<p>Mellow </p>
</blockquote>
<p>Mellow 是一个基于规则的全局透明代理工具，可以运行在 Windows、macOS 和 Linux 上，也可以配置成路由器透明代理或代理网关，支持 SOCKS、HTTP、Shadowsocks、VMess 等多种代理协议。</p>
<p>Download: <a href="https://github.com/mellow-io/mellow" target="_blank" rel="noopener">Github</a></p>
<blockquote>
<p>Kitsunebi </p>
</blockquote>
<p>Kitsunebi 是一个基于 V2Ray 核心的移动平台应用 (iOS, Android)。它可以创建基于 VMess 或者 Shadowsocks 的 VPN 连接。Kitsunebi 支持导入和导出与 V2Ray 兼容的 JSON 配置。</p>
<p>由于使用 V2Ray 核心，Kitsunebi 几乎支持 V2Ray 的所有功能，比如 Mux 和 mKCP。</p>
<p>下载：<a href="https://itunes.apple.com/us/app/kitsunebi-proxy-utility/id1446584073?mt=8" target="_blank" rel="noopener">iTunes</a> | <a href="https://play.google.com/store/apps/details?id=fun.kitsunebi.kitsunebi4android&amp;hl=en_US" target="_blank" rel="noopener">Play Store</a></p>
<blockquote>
<p>i2Ray </p>
</blockquote>
<p>i2Ray 是另一款基于 V2Ray 核心的iOS应用。界面简洁易用，适合新手用户使用。同时兼容Shadowrocket和Quantumult格式的规则导入。</p>
<p>下载：<a href="https://itunes.apple.com/us/app/i2ray/id1445270056?mt=8" target="_blank" rel="noopener">iTunes</a></p>
<blockquote>
<p>Shadowrocket </p>
</blockquote>
<p>Shadowrocket 是一个通用的 iOS VPN 应用，它支持众多协议，如 Shadowsocks、VMess、SSR 等。</p>
<p>下载：<a href="https://itunes.apple.com/us/app/shadowrocket/id932747118?mt=8" target="_blank" rel="noopener">iTunes</a></p>
<blockquote>
<p>Pepi（原名ShadowRay）</p>
</blockquote>
<p>Pepi 是一个兼容 V2Ray 的 iOS 应用，它可以创建基于 VMess 的 VPN 连接，并与 V2Ray 服务器通信。</p>
<p>下载：<a href="https://itunes.apple.com/us/app/pepi/id1283082051?mt=8" target="_blank" rel="noopener">iTunes</a></p>
<blockquote>
<p>Quantumult </p>
</blockquote>
<p>下载：<a href="https://itunes.apple.com/us/app/quantumult/id1252015438?mt=8" target="_blank" rel="noopener">iTunes</a></p>
<blockquote>
<p>BifrostV </p>
</blockquote>
<p>BifrostV 是一个基于 V2Ray 内核的 Android 应用，它支持 VMess、Shadowsocks、Socks 协议。</p>
<p>下载：<a href="https://play.google.com/store/apps/details?id=com.github.dawndiy.bifrostv" target="_blank" rel="noopener">Play Store</a> | <a href="https://apkpure.com/bifrostv/com.github.dawndiy.bifrostv" target="_blank" rel="noopener">APK Pure</a></p>
<blockquote>
<p>V2RayNG </p>
</blockquote>
<p>V2RayNG 是一个基于 V2Ray 内核的 Android 应用，它可以创建基于 VMess 的 VPN 连接。</p>
<p>下载：<a href="https://play.google.com/store/apps/details?id=com.v2ray.ang" target="_blank" rel="noopener">Play Store</a> | <a href="https://github.com/2dust/v2rayNG" target="_blank" rel="noopener">GitHub</a></p>
<h2 id="在线工具-资源"><a href="#在线工具-资源" class="headerlink" title="在线工具/资源"></a>在线工具/资源</h2><blockquote>
<p>VeekXT V2Ray配置生成</p>
</blockquote>
<p>支持 4.x 版本的配置文件生成器 <a href="https://www.veekxt.com/utils/v2ray_gen" target="_blank" rel="noopener">veekxt.com</a></p>
<blockquote>
<p>V2Ray 配置生成器</p>
</blockquote>
<p>静态 V2Ray 配置文件生成页面 <a href="https://github.com/htfy96/v2ray-config-gen" target="_blank" rel="noopener">GitHub</a></p>
<blockquote>
<p>UUID Generator</p>
</blockquote>
<p>VMess User ID 生成工具 <a href="https://www.uuidgenerator.net/" target="_blank" rel="noopener">uuidgenerator.net</a></p>
<blockquote>
<p>vTemplate 项目仓库</p>
</blockquote>
<p>一个 V2Ray 配置文件模板收集仓库 <a href="https://github.com/KiriKira/vTemplate" target="_blank" rel="noopener">GitHub</a></p>
<h1 id="VMess-协议"><a href="#VMess-协议" class="headerlink" title="VMess 协议"></a>VMess 协议</h1><p>VMess 是 V2Ray 原创的加密通讯协议。</p>
<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>当前版本号为 1。</p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><h3 id="底层协议"><a href="#底层协议" class="headerlink" title="底层协议"></a>底层协议</h3><p>VMess 是一个基于 TCP 的协议，所有数据使用 TCP 传输。</p>
<h3 id="用户-ID"><a href="#用户-ID" class="headerlink" title="用户 ID"></a>用户 ID</h3><p>ID 等价于 <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank" rel="noopener">UUID</a>，是一个 16 字节长的随机数，它的作用相当于一个令牌（Token）。 一个 ID 形如：de305d54-75b4-431b-adb2-eb6b9e546014，几乎完全随机，可以使用任何的 UUID 生成器来生成，比如<a href="https://www.uuidgenerator.net/" target="_blank" rel="noopener">这个</a>。</p>
<p>用户 ID 可在<a href="https://www.v2ray.com/developer/chapter_02/01_overview.md" target="_blank" rel="noopener">配置文件</a>中指定。</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li><p>MD5: </p>
<p>MD5 函数</p>
<ul>
<li>输入参数为任意长度的 byte 数组</li>
</ul>
</li>
<li><p>输出为一个 16 byte 的数组</p>
</li>
<li><p>HMAC: </p>
<p>HMAC 函数</p>
<ul>
<li>输入参数为：<ul>
<li>H：散列函数</li>
</ul>
</li>
</ul>
</li>
<li><p>K：密钥，任意长度的 byte 数组</p>
</li>
<li><p>M：消息，任意长度的 byte 数组</p>
</li>
<li><p>Shake: </p>
<p>SHA3-Shake128 函数</p>
<ul>
<li>输入参数为任意长度的字符串</li>
</ul>
</li>
<li><p>输出为任意长度的字符串</p>
</li>
</ul>
<h2 id="通讯过程"><a href="#通讯过程" class="headerlink" title="通讯过程"></a>通讯过程</h2><p>VMess 是一个无状态协议，即客户端和服务器之间不需要握手即可直接传输数据，每一次数据传输对之前和之后的其它数据传输没有影响。 VMess 的客户端发起一次请求，服务器判断该请求是否来自一个合法的客户端。如验证通过，则转发该请求，并把获得的响应发回给客户端。 VMess 使用非对称格式，即客户端发出的请求和服务器端的响应使用了不同的格式。</p>
<h2 id="客户端请求"><a href="#客户端请求" class="headerlink" title="客户端请求"></a>客户端请求</h2><table>
<thead>
<tr>
<th>16 字节</th>
<th>X 字节</th>
<th>余下部分</th>
</tr>
</thead>
<tbody><tr>
<td>认证信息</td>
<td>指令部分</td>
<td>数据部分</td>
</tr>
</tbody></table>
<h3 id="认证信息"><a href="#认证信息" class="headerlink" title="认证信息"></a>认证信息</h3><p>认证信息是一个 16 字节的哈希（hash）值，它的计算方式如下：</p>
<ul>
<li><p>H = MD5</p>
</li>
<li><p>K = 用户 ID (16 字节)</p>
</li>
<li><p>M = UTC 时间，精确到秒，取值为当前时间的前后 30 秒随机值(8 字节, Big Endian)</p>
</li>
<li><p>Hash = HMAC(H, K, M)</p>
</li>
</ul>
<h3 id="指令部分"><a href="#指令部分" class="headerlink" title="指令部分"></a>指令部分</h3><p>指令部分经过 AES-128-CFB 加密：</p>
<ul>
<li><p>Key：MD5(用户 ID + []byte(‘c48619fe-8f02-49e0-b9e9-edf763e17e21’))</p>
</li>
<li><p>IV：MD5(X + X + X + X)，X = []byte(认证信息生成的时间) (8 字节, Big Endian)</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>1 字节</th>
<th>16 字节</th>
<th>16 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>4 位</th>
<th>4 位</th>
<th>1 字节</th>
<th>1 字节</th>
<th>2 字节</th>
<th>1 字节</th>
<th>N 字节</th>
<th>P 字节</th>
<th>4 字节</th>
</tr>
</thead>
<tbody><tr>
<td>版本号 Ver</td>
<td>数据加密 IV</td>
<td>数据加密 Key</td>
<td>响应认证 V</td>
<td>选项 Opt</td>
<td>余量 P</td>
<td>加密方式 Sec</td>
<td>保留</td>
<td>指令 Cmd</td>
<td>端口 Port</td>
<td>地址类型 T</td>
<td>地址 A</td>
<td>随机值</td>
<td>校验 F</td>
</tr>
</tbody></table>
<p>选项 Opt 细节：（当某一位为 1 时，表示该选项启用）</p>
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>M</td>
<td>R</td>
<td>S</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>版本号 Ver：始终为 1；</p>
</li>
<li><p>数据加密 IV：随机值；</p>
</li>
<li><p>数据加密 Key：随机值；</p>
</li>
<li><p>响应认证 V：随机值；</p>
</li>
<li><p>选项 Opt：</p>
<ul>
<li>S (0x01)：标准格式的数据流（建议开启）；</li>
</ul>
</li>
<li><p>R (0x02)：客户端期待重用 TCP 连接（V2Ray 2.23+ 弃用）；</p>
<ul>
<li>只有当 S 开启时，这一项才有效；</li>
</ul>
</li>
<li><p>M (0x04)：开启元数据混淆（建议开启）；</p>
<ul>
<li>只有当 S 开启时，这一项才有效；</li>
</ul>
</li>
<li><p>当其项开启时，客户端和服务器端需要分别构造两个 Shake 实例，分别为 RequestMask = Shake(请求数据 IV), ResponseMask = Shake(响应数据 IV)。</p>
</li>
<li><p>X：保留</p>
</li>
<li><p>余量 P：在校验值之前加入 P 字节的随机值；</p>
</li>
<li><p>加密方式：指定数据部分的加密方式，可选的值有：</p>
<ul>
<li>0x00：AES-128-CFB；</li>
</ul>
</li>
<li><p>0x01：不加密；</p>
</li>
<li><p>0x02：AES-128-GCM；</p>
</li>
<li><p>0x03：ChaCha20-Poly1305；</p>
</li>
<li><p>指令 Cmd：</p>
<ul>
<li>0x01：TCP 数据；</li>
</ul>
</li>
<li><p>0x02：UDP 数据；</p>
</li>
<li><p>端口 Port：Big Endian 格式的整型端口号；</p>
</li>
<li><p>地址类型 T：</p>
<ul>
<li>0x01：IPv4</li>
</ul>
</li>
<li><p>0x02：域名</p>
</li>
<li><p>0x03：IPv6</p>
</li>
<li><p>地址 A：</p>
<ul>
<li>当 T = 0x01 时，A 为 4 字节 IPv4 地址；</li>
</ul>
</li>
<li><p>当 T = 0x02 时，A 为 1 字节长度（L） + L 字节域名；</p>
</li>
<li><p>当 T = 0x03 时，A 为 16 字节 IPv6 地址；</p>
</li>
<li><p>校验 F：指令部分除 F 外所有内容的 FNV1a hash；</p>
</li>
</ul>
<h3 id="数据部分"><a href="#数据部分" class="headerlink" title="数据部分"></a>数据部分</h3><p>数据部分有两种格式，默认为基本格式。</p>
<h4 id="基本格式-（弃用）"><a href="#基本格式-（弃用）" class="headerlink" title="基本格式 （弃用）"></a>基本格式 （弃用）</h4><p><strong>此格式仅作为向后兼容所用，在之后的版本中可能被删除。</strong></p>
<p>所有数据均认为是请求的实际内容。这些内容将被发往指令部分所指定的地址。当 Cmd = 0x01 时，这些数据将以 TCP 的形式发送；当 Cmd = 0x02 时，这些数据将以 UDP 形式发送。</p>
<p>此格式支持“不加密”和“AES-128-CFB”两种加密方式，加密的 Key 和 IV 由指令部分指定。</p>
<h4 id="标准格式"><a href="#标准格式" class="headerlink" title="标准格式"></a>标准格式</h4><p>当 Opt(S) 开启时，数据部分使用此格式。实际的请求数据被分割为若干个小块，每个小块的格式如下。服务器校验完所有的小块之后，再按基本格式的方式进行转发。</p>
<table>
<thead>
<tr>
<th>2 字节</th>
<th>L 字节</th>
</tr>
</thead>
<tbody><tr>
<td>长度 L</td>
<td>数据包</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>长度 L：Big Endian 格式的整型，最大值为 2^14；</p>
<ul>
<li>当 Opt(M) 开启时，L 的值 = 真实值 xor Mask。Mask = (RequestMask.NextByte() &lt;&lt; 8) + RequestMask.NextByte()；</li>
</ul>
</li>
<li><p>数据包：由指定的加密方式加密过的数据包；</p>
</li>
</ul>
<p>在传输结束之前，数据包中必须有实际数据，即除了长度和认证数据之外的数据。当传输结束时，客户端必须发送一个空的数据包，即 L = 0（不加密） 或认证数据长度（有加密），来表示传输结束。</p>
<p>按加密方式不同，数据包的格式如下：</p>
<ul>
<li><p>不加密：</p>
<ul>
<li>L 字节：实际数据；</li>
</ul>
</li>
<li><p>AES-128-CFB：整个数据部分使用 AES-128-CFB 加密</p>
<ul>
<li>4 字节：实际数据的 FNV1a hash；</li>
</ul>
</li>
<li><p>L - 4 字节：实际数据；</p>
</li>
<li><p>AES-128-GCM：Key 为指令部分的 Key，IV = count (2 字节) + IV (10 字节)。count 从 0 开始递增，每个数据包加 1；IV 为 指令部分 IV 的第 3 至第 12 字节。</p>
<ul>
<li>L - 16 字节：实际数据；</li>
</ul>
</li>
<li><p>16 字节：GCM 认证信息</p>
</li>
<li><p>ChaCha20-Poly1305：Key = MD5(指令部分 Key) + MD5(MD5(指令部分 Key))，IV = count (2 字节) + IV (10 字节)。count 从 0 开始递增，每个数据包加 1；IV 为 指令部分 IV 的第 3 至第 12 字节。</p>
<ul>
<li>L - 16 字节：实际数据；</li>
</ul>
</li>
<li><p>16 字节：Poly1305 认证信息</p>
</li>
</ul>
<h2 id="服务器应答"><a href="#服务器应答" class="headerlink" title="服务器应答"></a>服务器应答</h2><p>应答头部数据使用 AES-128-CFB 加密，IV 为 MD5(数据加密 IV)，Key 为 MD5(数据加密 Key)。实际应答数据视加密设置不同而不同。</p>
<table>
<thead>
<tr>
<th>1 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>M 字节</th>
<th>余下部分</th>
</tr>
</thead>
<tbody><tr>
<td>响应认证 V</td>
<td>选项Opt</td>
<td>指令 Cmd</td>
<td>指令长度 M</td>
<td>指令内容</td>
<td>实际应答数据</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>响应认证 V：必须和客户端请求中的响应认证 V 一致；</p>
</li>
<li><p>选项 Opt：</p>
<ul>
<li>0x01：服务器端准备重用 TCP 连接（V2Ray 2.23+ 弃用）；</li>
</ul>
</li>
<li><p>指令 Cmd：</p>
<ul>
<li>0x01：动态端口指令</li>
</ul>
</li>
<li><p>实际应答数据：</p>
<ul>
<li>如果请求中的 Opt(S) 开启，则使用标准格式，否则使用基本格式。</li>
</ul>
</li>
<li><p>格式均和请求数据相同。</p>
<ul>
<li>当 Opt(M) 开启时，长度 L 的值 = 真实值 xor Mask。Mask = (ResponseMask.NextByte() &lt;&lt; 8) + ResponseMask.NextByte()；</li>
</ul>
</li>
</ul>
<h3 id="动态端口指令"><a href="#动态端口指令" class="headerlink" title="动态端口指令"></a>动态端口指令</h3><table>
<thead>
<tr>
<th>1 字节</th>
<th>2 字节</th>
<th>16 字节</th>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
</tr>
</thead>
<tbody><tr>
<td>保留</td>
<td>端口 Port</td>
<td>用户 ID</td>
<td>AlterID</td>
<td>用户等级</td>
<td>有效时间 T</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>端口 Port：Big Endian 格式的整型端口号；</p>
</li>
<li><p>有效时间 T：分钟数；</p>
</li>
</ul>
<p>客户端在收到动态端口指令时，服务器已开放新的端口用于通信，这时客户端可以将数据发往新的端口。在 T 分钟之后，这个端口将失效，客户端必须重新使用主端口进行通信。</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><ul>
<li>为确保向前兼容性，所有保留字段的值必须为 0。</li>
</ul>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="mKCP-协议"><a href="#mKCP-协议" class="headerlink" title="mKCP 协议"></a>mKCP 协议</h1><p>mKCP 是流式传输协议，由 <a href="https://github.com/skywind3000/kcp" target="_blank" rel="noopener">KCP 协议</a>修改而来，可以按顺序传输任意的数据流。</p>
<h2 id="版本-1"><a href="#版本-1" class="headerlink" title="版本"></a>版本</h2><p>mKCP 没有版本号，不保证版本之间兼容性。</p>
<h2 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h2><h3 id="底层协议-1"><a href="#底层协议-1" class="headerlink" title="底层协议"></a>底层协议</h3><p>mKCP 是一个基于 UDP 的协议，所有通讯使用 UDP 传输。</p>
<h3 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h3><ul>
<li><p>fnv: </p>
<p>FNV-1a</p>
<p> 哈希函数</p>
<ul>
<li>输入参数为任意长度的字符串；</li>
</ul>
</li>
<li><p>输入出一个 32 位无符号整数；</p>
</li>
</ul>
<h2 id="通讯过程-1"><a href="#通讯过程-1" class="headerlink" title="通讯过程"></a>通讯过程</h2><ol>
<li>mKCP 将数据流拆成若干个数据包进行发送。一个数据流有一个唯一标识，用以区分不同的数据流。数据流中的每一个数据包都携带了同样的标识。</li>
<li>mKCP 没有握手过程，当收到一个数据包时，根据其携带的数据流的标识来判断是否为新的通话，或是正在进行中的通话。</li>
<li>每一个数据包中包含若干个片段（Segment），片段分为三类：数据（Data）、确认（ACK）、心跳（Ping）。每个片段需要单独处理。</li>
</ol>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><h3 id="数据包"><a href="#数据包" class="headerlink" title="数据包"></a>数据包</h3><table>
<thead>
<tr>
<th>4 字节</th>
<th>2 字节</th>
<th>L 字节</th>
</tr>
</thead>
<tbody><tr>
<td>认证信息 A</td>
<td>数据长度 L</td>
<td>片段部分</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>认证信息 A = fnv(片段部分），big endian；</p>
</li>
<li><p>片段部分可能包含多个片段；</p>
</li>
</ul>
<h3 id="数据片段"><a href="#数据片段" class="headerlink" title="数据片段"></a>数据片段</h3><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>4 字节</th>
<th>4 字节</th>
<th>4 字节</th>
<th>2 字节</th>
<th>Len 字节</th>
</tr>
</thead>
<tbody><tr>
<td>标识 Conv</td>
<td>指令 Cmd</td>
<td>选项 Opt</td>
<td>时间戳 Ts</td>
<td>序列号 Sn</td>
<td>未确认序列号 Una</td>
<td>长度 Len</td>
<td>数据</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>标识 Conv: mKCP 数据流的标识</p>
</li>
<li><p>指令 Cmd: 常量 0x01</p>
</li>
<li><p>选项 Opt: 可选的值有：</p>
<ul>
<li>0x00: 空选项</li>
</ul>
</li>
<li><p>0x01: 对方已发出所有数据</p>
</li>
<li><p>时间戳 Ts: 当前片段从远端发送出来时的时间，big endian</p>
</li>
<li><p>序列号 Sn: 该数据片段时数据流中的位置，起始片段的序列号为 0，之后每个新片段按顺序加 1</p>
</li>
<li><p>未确认序列号 Una: 远端主机正在发送的，且尚未收到确认的最小的 Sn</p>
</li>
</ul>
<h3 id="确认片段"><a href="#确认片段" class="headerlink" title="确认片段"></a>确认片段</h3><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>4 字节</th>
<th>4 字节</th>
<th>4 字节</th>
<th>2 字节</th>
<th>Len * 4 字节</th>
</tr>
</thead>
<tbody><tr>
<td>标识 Conv</td>
<td>指令 Cmd</td>
<td>选项 Opt</td>
<td>窗口 Wnd</td>
<td>下一接收序列号 Sn</td>
<td>时间戳 Ts</td>
<td>长度 Len</td>
<td>已收到的序列号</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>标识 Conv: mKCP 数据流的标识</p>
</li>
<li><p>指令 Cmd: 常量 0x00</p>
</li>
<li><p>选项 Opt: 同上</p>
</li>
<li><p>窗口 Wnd: 远端主机可以接收的最大序列号</p>
</li>
<li><p>下一接收序列号 Sn: 远端主机未收到的数据片段中的最小序列号</p>
</li>
<li><p>时间戳 Ts: 远端主机最新收到的数据片段的时间戳，可用于计算延迟</p>
</li>
<li><p>已收到的序列号: 每个 4 字节，表示此序列号的数据已经确认收到</p>
</li>
</ul>
<p>注释：</p>
<ul>
<li>远程主机期待收到序列号 [Sn, Wnd) 范围内的数据</li>
</ul>
<h3 id="心跳片段"><a href="#心跳片段" class="headerlink" title="心跳片段"></a>心跳片段</h3><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>4 字节</th>
<th>4 字节</th>
<th>4 字节</th>
</tr>
</thead>
<tbody><tr>
<td>标识 Conv</td>
<td>指令 Cmd</td>
<td>选项 Opt</td>
<td>未确认序列号 Una</td>
<td>下一接收序列号 Sn</td>
<td>延迟 Rto</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>标识 Conv: mKCP 数据流的标识</p>
</li>
<li><p>指令 Cmd: 可选的值有</p>
<ul>
<li>0x02: 远端主机强行终止会话</li>
</ul>
</li>
<li><p>0x03: 正常心跳</p>
</li>
<li><p>选项 Opt: 同上</p>
</li>
<li><p>未确认序列号 Una: 同数据片段的 Una</p>
</li>
<li><p>下一接收序列号 Sn: 同确认片段的 Sn</p>
</li>
<li><p>延迟 Rto: 远端主机自己计算出的延迟</p>
</li>
</ul>
<h1 id="Mux-Cool-协议"><a href="#Mux-Cool-协议" class="headerlink" title="Mux.Cool 协议"></a>Mux.Cool 协议</h1><p>Mux.Cool 协议是一个多路复用传输协议，用于在一条已建立的数据流中传输多个各自独立的数据流。</p>
<h2 id="版本-2"><a href="#版本-2" class="headerlink" title="版本"></a>版本</h2><p>当前版本是 1 Beta。</p>
<h2 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h2><h3 id="底层协议-2"><a href="#底层协议-2" class="headerlink" title="底层协议"></a>底层协议</h3><p>Mux.Cool 必须运行在一个已建立的可靠数据流之上。</p>
<h2 id="通讯过程-2"><a href="#通讯过程-2" class="headerlink" title="通讯过程"></a>通讯过程</h2><p>一个 Mux.Cool 连接中可传输若干个子连接，每个子连接有一个独立的 ID 和状态。传输过程由帧（Frame）组成，每一帧用于传输一个特定的子连接的数据。</p>
<h3 id="客户端行为"><a href="#客户端行为" class="headerlink" title="客户端行为"></a>客户端行为</h3><p>当有连接需求时并且没有现有可用的连接时，客户端向服务器发起一个新连接，以下称为“主连接”。</p>
<ol>
<li>一个主连接可用于发送若干个子连接。客户端可自主决定主连接可承载的子连接数量。</li>
<li>对于一个新的子连接，客户端必须发送状态<code>New</code>以通知服务器建立子连接，然后使用状态<code>Keep</code>来传送数据。</li>
<li>当子连接结束时，客户端发送<code>End</code>状态来通知服务器关闭子连接。</li>
<li>客户端可自行决定何时关闭主连接，但必须确定服务器也同时保持连接。</li>
<li>客户端可使用 KeepAlive 状态来避免服务器关闭主连接。</li>
</ol>
<h3 id="服务器端行为"><a href="#服务器端行为" class="headerlink" title="服务器端行为"></a>服务器端行为</h3><p>当服务器端接收到新的子连接时，服务器应当按正常的连接来处理。</p>
<ol>
<li>当收到状态<code>End</code>时，服务器端可以关闭对目标地址的上行连接。</li>
<li>在服务器的响应中，必须使用与请求相同的 ID 来传输子连接的数据。</li>
<li>服务器不能使用<code>New</code>状态。</li>
<li>服务器可使用 KeepAlive 状态来避免客户端关闭主连接。</li>
</ol>
<h2 id="传输格式"><a href="#传输格式" class="headerlink" title="传输格式"></a>传输格式</h2><p>Mux.Cool 使用对称传输格式，即客户端和服务器发送和接收相同格式的数据。</p>
<h3 id="帧格式"><a href="#帧格式" class="headerlink" title="帧格式"></a>帧格式</h3><table>
<thead>
<tr>
<th>2 字节</th>
<th>L 字节</th>
<th>X 字节</th>
</tr>
</thead>
<tbody><tr>
<td>元数据长度 L</td>
<td>元数据</td>
<td>额外数据</td>
</tr>
</tbody></table>
<h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><p>元数据有若干种类型，由状态 S 来区分。所有类型的元数据都包含 ID 和 Opt 两项，其含义为：</p>
<ul>
<li><p>ID: 子连接的唯一标识</p>
</li>
<li><p>Opt:</p>
<ul>
<li>D(0x01): 有额外数据</li>
</ul>
</li>
</ul>
<p>当选项 Opt(D) 开启时，额外数据格式如下：</p>
<table>
<thead>
<tr>
<th>2 字节</th>
<th>L 字节</th>
</tr>
</thead>
<tbody><tr>
<td>长度 L</td>
<td>数据</td>
</tr>
</tbody></table>
<h4 id="新建子连接-New"><a href="#新建子连接-New" class="headerlink" title="新建子连接 (New)"></a>新建子连接 (New)</h4><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>1 字节</th>
<th>2 字节</th>
<th>1 字节</th>
<th>X 字节</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>0x01</td>
<td>选项 Opt</td>
<td>网络类型 N</td>
<td>端口</td>
<td>地址类型 T</td>
<td>地址 A</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><p>网络类型 N：</p>
<ul>
<li>0x01：TCP，表示当前子连接的流量应当以 TCP 的方式发送至目标。</li>
</ul>
</li>
<li><p>0x02：UDP，表示当前子连接的流量应当以 UDP 的方式发送至目标。</p>
</li>
<li><p>地址类型 T：</p>
<ul>
<li>0x01：IPv4</li>
</ul>
</li>
<li><p>0x02：域名</p>
</li>
<li><p>0x03：IPv6</p>
</li>
<li><p>地址 A：</p>
<ul>
<li>当 T = 0x01 时，A 为 4 字节 IPv4 地址；</li>
</ul>
</li>
<li><p>当 T = 0x02 时，A 为 1 字节长度（L） + L 字节域名；</p>
</li>
<li><p>当 T = 0x03 时，A 为 16 字节 IPv6 地址；</p>
</li>
</ul>
<p>在新建子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p>
<h4 id="保持子连接-Keep"><a href="#保持子连接-Keep" class="headerlink" title="保持子连接 (Keep)"></a>保持子连接 (Keep)</h4><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>0x02</td>
<td>选项 Opt</td>
</tr>
</tbody></table>
<p>在保持子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p>
<h4 id="关闭子连接-End"><a href="#关闭子连接-End" class="headerlink" title="关闭子连接 (End)"></a>关闭子连接 (End)</h4><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>0x03</td>
<td>选项 Opt</td>
</tr>
</tbody></table>
<p>在保持子连接时，若 Opt(D) 开启，则这一帧所带的数据需要被发往目标主机。</p>
<h4 id="保持连接-KeepAlive"><a href="#保持连接-KeepAlive" class="headerlink" title="保持连接 (KeepAlive)"></a>保持连接 (KeepAlive)</h4><table>
<thead>
<tr>
<th>2 字节</th>
<th>1 字节</th>
<th>1 字节</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>0x04</td>
<td>选项 Opt</td>
</tr>
</tbody></table>
<p>在保持连接时:</p>
<ul>
<li><p>若 Opt(D) 开启，则这一帧所带的数据必须被丢弃。</p>
</li>
<li><p>ID 可为随机值。</p>
</li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>Mux.Cool 协议与底层协议无关，理论上可以使用任何可靠的流式连接来传输 Mux.Cool 的协议数据。</p>
<p>在目标导向的协议如 Shadowsocks 和 VMess 协议中，连接建立时必须包含一个指定的地址。为了保持兼容性，Mux.Cool 协议指定地址为“v1.mux.cool”。即当主连接的目标地址与之匹配时，则进行 Mux.Cool 方式的转发，否则按传统方式进行转发。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/v2ray.html">https://jackhcc.github.io/posts/v2ray.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/VPN/">
                                    <span class="chip bg-color">VPN</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-07-20T00-50-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/docker.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/5.jpg" class="responsive-img" alt="docker详解">
                        
                        <span class="card-title">docker详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Docker使用手册
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-07-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Container/" class="post-category">
                                    Container
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Docker/">
                        <span class="chip bg-color">Docker</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/makefile.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/23.jpg" class="responsive-img" alt="MakeFile详解">
                        
                        <span class="card-title">MakeFile详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            MakeFile基础知识与语法详解~
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux-Kernel/" class="post-category">
                                    Linux Kernel
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/MakeFile/">
                        <span class="chip bg-color">MakeFile</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

