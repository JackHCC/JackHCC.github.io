<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="GNNå›¾ç¥ç»ç½‘ç»œè¯¦è§£, JackHCC">
    <meta name="description" content="GNNå›¾ç¥ç»ç½‘ç»œå­¦ä¹ å®è·µè®°å½•">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GNNå›¾ç¥ç»ç½‘ç»œè¯¦è§£ | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creativeå·¥å…·å¯¼èˆª</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLPæ¯æ—¥è®ºæ–‡</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChatèŠå¤©å®¤</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contactç•™è¨€æ¿</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creativeå·¥å…·å¯¼èˆª</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLPæ¯æ—¥è®ºæ–‡</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChatèŠå¤©å®¤</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contactç•™è¨€æ¿</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('è¯·è¾“å…¥è®¿é—®æœ¬æ–‡ç« çš„å¯†ç ')).toString(CryptoJS.enc.Hex)) {
                alert('å¯†ç é”™è¯¯ï¼Œå°†è¿”å›ä¸»é¡µï¼');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/16.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">GNNå›¾ç¥ç»ç½‘ç»œè¯¦è§£</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/GNN/">
                                <span class="chip bg-color">GNN</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Deep-Learning/" class="post-category">
                                Deep Learning
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2021-08-24
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2021-09-04
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    21k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    90 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="åŸºæœ¬åº”ç”¨"><a href="#åŸºæœ¬åº”ç”¨" class="headerlink" title="åŸºæœ¬åº”ç”¨"></a>åŸºæœ¬åº”ç”¨</h1><h2 id="å›¾åŸºç¡€ä¸ä¸­å¿ƒæŒ‡æ ‡"><a href="#å›¾åŸºç¡€ä¸ä¸­å¿ƒæŒ‡æ ‡" class="headerlink" title="å›¾åŸºç¡€ä¸ä¸­å¿ƒæŒ‡æ ‡"></a>å›¾åŸºç¡€ä¸ä¸­å¿ƒæŒ‡æ ‡</h2><h3 id="ä¸€-åŸºç¡€å±æ€§"><a href="#ä¸€-åŸºç¡€å±æ€§" class="headerlink" title="ä¸€.åŸºç¡€å±æ€§"></a>ä¸€.åŸºç¡€å±æ€§</h3><p><strong>åŸºæœ¬å®šä¹‰</strong>ï¼šèŠ‚ç‚¹ã€è¾¹<br><strong>åŸºæœ¬ç±»å‹</strong>ï¼šæœ‰å‘å›¾ã€æ— å‘å›¾ï¼›åŠ æƒå›¾ï¼ŒéåŠ æƒå›¾ï¼›è¿é€šå›¾ï¼Œéè¿é€šå›¾ï¼›è¿é€šåˆ†é‡ï¼Œå¼ºè¿é€šåˆ†é‡ï¼Œå¼±è¿é€šåˆ†é‡ï¼›äºŒéƒ¨å›¾<br><strong>é‚»å±…ï¼Œğ‘˜é˜¶é‚»å±…ï¼Œåº¦</strong><br><strong>å­å›¾ã€ğ‘˜é˜¶å­å›¾ã€è·¯å¾„ã€å›¾ç›´å¾„</strong><br><strong>è¡¨ç¤ºæ–¹å¼</strong>: é‚»æ¥çŸ©é˜µï¼Œå…³è”çŸ©é˜µ<br><strong>éå†æ–¹å¼</strong>ï¼šæ·±åº¦ä¼˜å…ˆï¼Œå¹¿åº¦ä¼˜å…ˆ</p>
<pre><code>#æ„å»ºå›¾
%matplotlib inline
from matplotlib import pyplot as plt
import networkx as nx
G=nx.Graph()#æ— å‘å›¾ï¼Œæœ‰å‘å›¾ç”¨DiGraph
G.add_nodes_from(["A","B","C","D","E","F","G","H"])
G.add_edges_from([("A","B"),("A","C"),("B","C"),("C","D"),("E","F"),("F","G"),("G","H")])
nx.draw_networkx(G)
plt.show()</code></pre><p><img src="/images/loading.gif" data-original="../images/ML/image-20210829195032100.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#åº¦</span>
nx<span class="token punctuation">.</span>degree<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>DegreeView({'A': 2, 'B': 2, 'C': 3, 'D': 1, 'E': 1, 'F': 2, 'G': 2, 'H': 1})</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#è¿é€šåˆ†é‡</span>
list<span class="token punctuation">(</span>nx<span class="token punctuation">.</span>connected_components<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>[{'A', 'B', 'C', 'D'}, {'E', 'F', 'G', 'H'}]</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#å›¾ç›´å¾„:æ‰€æœ‰ä¸¤ä¸¤èŠ‚ç‚¹ç›´æ¥æœ€çŸ­è·¯å¾„çš„æœ€å¤§å€¼</span>
subG<span class="token operator">=</span>nx<span class="token punctuation">.</span>subgraph<span class="token punctuation">(</span>G<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"D"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>diameter<span class="token punctuation">(</span>subG<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>2</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#è·¯å¾„é•¿åº¦</span>
nx<span class="token punctuation">.</span>shortest_path_length<span class="token punctuation">(</span>G<span class="token punctuation">,</span>source<span class="token operator">=</span><span class="token string">"A"</span><span class="token punctuation">,</span>target<span class="token operator">=</span><span class="token string">"D"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>2</code></pre><h3 id="äºŒ-ä¸­å¿ƒæ€§æŒ‡æ ‡"><a href="#äºŒ-ä¸­å¿ƒæ€§æŒ‡æ ‡" class="headerlink" title="äºŒ.ä¸­å¿ƒæ€§æŒ‡æ ‡"></a>äºŒ.ä¸­å¿ƒæ€§æŒ‡æ ‡</h3><p>ä¸­å¿ƒæ€§æŒ‡æ ‡ä¸»è¦ç”¨äºè¡¡é‡èŠ‚ç‚¹åœ¨å›¾ä¸­çš„é‡è¦æ€§/å½±å“åŠ›ï¼Œæˆ‘ä»¬å¯¹èŠ‚ç‚¹é‡è¦æ€§çš„è§£é‡Šæœ‰å¾ˆå¤šï¼Œä¸åŒçš„è§£é‡Šä¸‹åˆ¤å®šä¸­å¿ƒæ€§çš„æŒ‡æ ‡ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œé€šå¸¸æœ‰è¿™äº›ï¼šç‚¹åº¦ä¸­å¿ƒæ€§ï¼Œä¸­ä»‹ä¸­å¿ƒæ€§ï¼Œæ¥è¿‘ä¸­å¿ƒæ€§ï¼Œç‰¹å¾å‘é‡ä¸­å¿ƒæ€§ï¼ŒPageRankï¼Œhits</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#ç‚¹åº¦ä¸­å¿ƒæ€§</span>
<span class="token comment" spellcheck="true">#èŠ‚ç‚¹çš„é‚»å±…è¶Šå¤šï¼Œå®ƒå°±è¶Šé‡è¦ï¼Œå®šä¹‰ä¸ºï¼šåº¦/(èŠ‚ç‚¹æ•°-1)</span>
nx<span class="token punctuation">.</span>degree_centrality<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>{'A': 0.2857142857142857,
'B': 0.2857142857142857,
'C': 0.42857142857142855,
'D': 0.14285714285714285,
'E': 0.14285714285714285,
'F': 0.2857142857142857,
'G': 0.2857142857142857,
'H': 0.14285714285714285}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#ä¸­ä»‹ä¸­å¿ƒæ€§</span>
<span class="token comment" spellcheck="true">#å¦‚æœè¯¥èŠ‚ç‚¹å‡ºç°è¯¥å…¶å®ƒä¸¤ä¸¤èŠ‚ç‚¹è·¯å¾„ä¸Šçš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒå°±è¶Šé‡è¦</span>
nx<span class="token punctuation">.</span>betweenness_centrality<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>{'A': 0.0,
'B': 0.0,
'C': 0.09523809523809523,
'D': 0.0,
'E': 0.0,
'F': 0.09523809523809523,
'G': 0.09523809523809523,
'H': 0.0}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æ¥è¿‘ä¸­å¿ƒæ€§</span>
<span class="token comment" spellcheck="true">#å¦‚æœè¯¥èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»è¶Šè¿‘ï¼Œå®ƒå°±è¶Šé‡è¦</span>
nx<span class="token punctuation">.</span>closeness_centrality<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>{'A': 0.3214285714285714,
'B': 0.3214285714285714,
'C': 0.42857142857142855,
'D': 0.2571428571428571,
'E': 0.21428571428571427,
'F': 0.3214285714285714,
'G': 0.3214285714285714,
'H': 0.21428571428571427}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#ç‰¹å¾å‘é‡ä¸­å¿ƒæ€§</span>
<span class="token comment" spellcheck="true">#å®šä¹‰ï¼šå–é‚»æ¥çŸ©é˜µç‰¹å¾åˆ†è§£åï¼Œæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡</span>
<span class="token comment" spellcheck="true">#ä¸æŸèŠ‚ç‚¹è¿æ¥çš„èŠ‚ç‚¹çš„é‚»å±…è¶Šå¤šï¼Œå°±è¶Šé‡è¦</span>
<span class="token comment" spellcheck="true">#æ–°å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹Iæ¥è¿æ¥ä¸¤å—è¿é€šåˆ†é‡</span>
G<span class="token operator">=</span>nx<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span>
G<span class="token punctuation">.</span>add_nodes_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"D"</span><span class="token punctuation">,</span><span class="token string">"E"</span><span class="token punctuation">,</span><span class="token string">"F"</span><span class="token punctuation">,</span><span class="token string">"G"</span><span class="token punctuation">,</span><span class="token string">"H"</span><span class="token punctuation">,</span><span class="token string">"I"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
G<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"E"</span><span class="token punctuation">,</span><span class="token string">"F"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"F"</span><span class="token punctuation">,</span><span class="token string">"G"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"G"</span><span class="token punctuation">,</span><span class="token string">"H"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">,</span><span class="token string">"F"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>G<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> &gt;&gt;&gt;<br><img src="/images/loading.gif" data-original="../images/ML/output_10_0.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python">nx<span class="token punctuation">.</span>eigenvector_centrality<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>{'A': 0.44885390912200857,
'B': 0.5468450989996043,
'C': 0.5135021004101872,
'D': 0.21736961615213216,
'E': 0.09799461776528895,
'F': 0.2314938976977582,
'G': 0.11938887762076224,
'H': 0.0505393145300136,
'I': 0.3294789107351654}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#pagerank</span>
nx<span class="token punctuation">.</span>pagerank<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>{'A': 0.10252135128679807,
'B': 0.14929077894067944,
'C': 0.153726203840718,
'D': 0.06022249294537078,
'E': 0.06475108608528522,
'F': 0.16971188372812845,
'G': 0.1235500933464885,
'H': 0.06917616539981883,
'I': 0.1070499444267125}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#hits</span>
nx<span class="token punctuation">.</span>hits<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>({'A': 0.17564701604305502,
'B': 0.21399245433642766,
'C': 0.2009454874842481,
'D': 0.08506205753671801,
'E': 0.03834543957793587,
'F': 0.09058495722206274,
'G': 0.04671661924357704,
'H': 0.019775570471702603,
'I': 0.1289303980842729},
{'A': 0.1756470158158291,
'B': 0.21399245588711766,
'C': 0.2009454869245228,
'D': 0.085062057946483,
'E': 0.03834543855419052,
'F': 0.09058495938682286,
'G': 0.04671661787549817,
'H': 0.01977557118599924,
'I': 0.1289303964235366})</code></pre><h2 id="Graph-Embedding"><a href="#Graph-Embedding" class="headerlink" title="Graph Embedding"></a>Graph Embedding</h2><h3 id="ä¸€-DeepWalkåŸç†"><a href="#ä¸€-DeepWalkåŸç†" class="headerlink" title="ä¸€. DeepWalkåŸç†"></a>ä¸€. DeepWalkåŸç†</h3><p>å…¶å®å°±ä¸¤ä¸ªé˜¶æ®µï¼š<br>1ï¼‰å¯¹å›¾éšæœºæ¸¸èµ°å¾—åˆ°ä¸€ä¸ªåºåˆ—ï¼›<br>2ï¼‰å°†è¯¥åºåˆ—è¿›è¡Œword2vecè®­ç»ƒå¾—åˆ°embedding  </p>
<p>ä¸‹é¢åˆ©ç”¨å¯¹wordè¿›è¡Œembbedingè®­ç»ƒä¸¾ä¾‹ï¼Œæˆ‘é€‰æ‹©äº†å½“å‰çš„ä¸€æ¡å…³äºæ–°å† çš„æ–°é—»ï¼Œå¯¹å…¶åˆ†è¯æ„å»ºä¸€ä¸ªå¸¦æƒæœ‰å‘å›¾ï¼Œæƒé‡ä¸ºå…¶ç›¸é‚»ä¸¤è¯çš„å‡ºç°çš„æ¬¡æ•°</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#å‡†å¤‡é¢„æ–™</span>
corpus<span class="token operator">=</span><span class="token triple-quoted-string string">"""æ–°åç¤¾æ²³å†…5æœˆ29æ—¥ç”µï¼ˆè®°è€…è’‹å£°é›„ é»„ç¡•ï¼‰è¶Šå—å«ç”Ÿéƒ¨é•¿é˜®é’é¾™29æ—¥å®£å¸ƒè¯¥å›½å‘ç°æ–°çš„æ–°å† ç—…æ¯’å˜å¼‚æ¯’æ ªï¼Œå®ƒæ˜¯æ­¤å‰åœ¨è‹±å›½å’Œå°åº¦å‘ç°çš„å˜å¼‚æ¯’æ ªçš„æ··åˆä½“ã€‚
é˜®é’é¾™å½“å¤©åœ¨è¶Šå—å…¨å›½æ–°å† ç–«æƒ…é˜²æ§è§†é¢‘ä¼šè®®ä¸Šè¯´ï¼Œè¿™ç§å˜å¼‚æ¯’æ ªæ··åˆä½“â€œéå¸¸å±é™©â€ï¼Œä¼ æ’­æ€§æ›´å¼ºï¼Œèƒ½åœ¨ç©ºæ°”ä¸­è¿…é€Ÿä¼ æ’­ã€‚è¿™ä¸€æ–°å‘ç°çš„æ¯’æ ªæ··åˆä½“å°šæœªå‘½åã€‚
æ®â€œè¶Šå—å¿«æŠ¥ç½‘â€æŠ¥é“ï¼Œæ­¤å‰åœ¨è¶Šå—å·²å‘ç°7ç§æ–°å† ç—…æ¯’å˜å¼‚æ¯’æ ªï¼ŒåŒ…æ‹¬æœ€æ—©åœ¨å°åº¦å’Œè‹±å›½å‘ç°çš„å˜å¼‚æ¯’æ ªã€‚
è¶Šå—äºä»Šå¹´4æœˆåº•å‡ºç°æ–°ä¸€è½®æ–°å† ç–«æƒ…ï¼Œé¦–éƒ½æ²³å†…ã€å—éƒ¨èƒ¡å¿—æ˜å¸‚ã€ä¸­éƒ¨å²˜æ¸¯å¸‚ç­‰ä¸»è¦åŸå¸‚å‡ºç°å¤šä¸ªæœ¬åœŸç—…ä¾‹ï¼ŒåŒ—éƒ¨åŒ—æ±ŸçœæŸå·¥ä¸šå›­å†…å‘ç”Ÿå¤§è§„æ¨¡æ„ŸæŸ“æ–°å† ç—…æ¯’äº‹ä»¶ã€‚æ®è¶Šé€šç¤¾æŠ¥é“ï¼Œæˆªè‡³å½“åœ°æ—¶é—´29æ—¥12æ—¶ï¼Œè¶Šå—ç´¯è®¡ç¡®è¯Šæ–°å† æœ¬åœŸç—…ä¾‹5213ä¾‹ï¼Œå…¶ä¸­è‡ª4æœˆ27æ—¥ä»¥æ¥æ–°å¢ç¡®è¯Šæ–°å† æœ¬åœŸç—…ä¾‹3643ä¾‹"""</span>\
<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"ï¼Œ"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"ã€"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"ï¼ˆ"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"ï¼‰"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"â€œ"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"â€"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"ã€‚"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">corpus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>['æ–°åç¤¾æ²³å†…5æœˆ29æ—¥ç”µè®°è€…è’‹å£°é›„é»„ç¡•è¶Šå—å«ç”Ÿéƒ¨é•¿é˜®é’é¾™29æ—¥å®£å¸ƒè¯¥å›½å‘ç°æ–°çš„æ–°å† ç—…æ¯’å˜å¼‚æ¯’æ ªå®ƒæ˜¯æ­¤å‰åœ¨è‹±å›½å’Œå°åº¦å‘ç°çš„å˜å¼‚æ¯’æ ªçš„æ··åˆä½“',
'é˜®é’é¾™å½“å¤©åœ¨è¶Šå—å…¨å›½æ–°å† ç–«æƒ…é˜²æ§è§†é¢‘ä¼šè®®ä¸Šè¯´è¿™ç§å˜å¼‚æ¯’æ ªæ··åˆä½“éå¸¸å±é™©ä¼ æ’­æ€§æ›´å¼ºèƒ½åœ¨ç©ºæ°”ä¸­è¿…é€Ÿä¼ æ’­',
'è¿™ä¸€æ–°å‘ç°çš„æ¯’æ ªæ··åˆä½“å°šæœªå‘½å',
'æ®è¶Šå—å¿«æŠ¥ç½‘æŠ¥é“æ­¤å‰åœ¨è¶Šå—å·²å‘ç°7ç§æ–°å† ç—…æ¯’å˜å¼‚æ¯’æ ªåŒ…æ‹¬æœ€æ—©åœ¨å°åº¦å’Œè‹±å›½å‘ç°çš„å˜å¼‚æ¯’æ ª',
'è¶Šå—äºä»Šå¹´4æœˆåº•å‡ºç°æ–°ä¸€è½®æ–°å† ç–«æƒ…é¦–éƒ½æ²³å†…å—éƒ¨èƒ¡å¿—æ˜å¸‚ä¸­éƒ¨å²˜æ¸¯å¸‚ç­‰ä¸»è¦åŸå¸‚å‡ºç°å¤šä¸ªæœ¬åœŸç—…ä¾‹åŒ—éƒ¨åŒ—æ±ŸçœæŸå·¥ä¸šå›­å†…å‘ç”Ÿå¤§è§„æ¨¡æ„ŸæŸ“æ–°å† ç—…æ¯’äº‹ä»¶',
'æ®è¶Šé€šç¤¾æŠ¥é“æˆªè‡³å½“åœ°æ—¶é—´29æ—¥12æ—¶è¶Šå—ç´¯è®¡ç¡®è¯Šæ–°å† æœ¬åœŸç—…ä¾‹5213ä¾‹å…¶ä¸­è‡ª4æœˆ27æ—¥ä»¥æ¥æ–°å¢ç¡®è¯Šæ–°å† æœ¬åœŸç—…ä¾‹3643ä¾‹']</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> jieba
lines<span class="token operator">=</span><span class="token punctuation">[</span>list<span class="token punctuation">(</span>jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> corpus<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#åˆ†è¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Building prefix dict from the default dictionary â€¦<br>Loading model from cache C:\Users\Alei\AppData\Local\Temp\jieba.cache<br>Loading model cost 0.619 seconds.<br>Prefix dict has been built successfully.</p>
<pre class="line-numbers language-python"><code class="language-python">word_cnt<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
word_set<span class="token operator">=</span>set<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pre_cnt<span class="token operator">=</span>word_cnt<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>line<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
        word_cnt<span class="token punctuation">[</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>line<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">+</span>pre_cnt
        word_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        word_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æ„å»ºå›¾</span>
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
G<span class="token operator">=</span>nx<span class="token punctuation">.</span>DiGraph<span class="token punctuation">(</span><span class="token punctuation">)</span>
G<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> key <span class="token keyword">in</span> word_cnt<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>G<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_5_0.png" alt=""></p>
<h3 id="äºŒ-éšæœºæ¸¸èµ°å®ç°"><a href="#äºŒ-éšæœºæ¸¸èµ°å®ç°" class="headerlink" title="äºŒ.éšæœºæ¸¸èµ°å®ç°"></a>äºŒ.éšæœºæ¸¸èµ°å®ç°</h3><p>éšæœºæ¸¸èµ°çš„æ ¸å¿ƒä¹Ÿå¾ˆç®€å•ï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼š   </p>
<p>1ï¼‰ä»å›¾ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªèµ·å§‹node<br>2ï¼‰ä»å®ƒçš„ï¼ˆç®­å¤´æŒ‡å‘çš„ï¼‰é‚»å±…ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ–°node<br>3ï¼‰é‡å¤ç¬¬2ï¼‰æ­¥ï¼Œç›´åˆ°æ»¡è¶³ç»ˆæ­¢æ¡ä»¶ï¼Œä¸Šé¢çš„æ‰€æœ‰nodeç»„æˆçš„åºåˆ—å³æ˜¯æˆ‘ä»¬æ‰€éœ€   </p>
<p>å¦å¤–ï¼Œä¸Šé¢çš„æ¯ä¸€æ­¥éƒ½å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç­–ç•¥ï¼Œæ¯”å¦‚ç¬¬1ï¼‰æ­¥åˆå§‹ç‚¹ä¸ä»å›¾ä¸­éšæœºé€‰æ‹©ï¼Œè€Œæ˜¯ä»å®é™…å¥å­çš„åˆå§‹è¯ä¸­é€‰æ‹©ï¼Œç¬¬2ï¼‰æ­¥ï¼Œéšæœºé€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè€ƒè™‘è¾¹çš„æƒå€¼ï¼Œæƒå€¼è¶Šå¤§è¶Šå®¹æ˜“è¢«é€‰æ‹©ï¼Œç¬¬3ï¼‰æ­¥ï¼Œé€šå¸¸å¯ä»¥è®¾ç½®ä¸€ä¸ªæœ€å¤§æ¸¸èµ°é•¿åº¦</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">def</span> <span class="token function">walk_one_time</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span>start_node<span class="token punctuation">,</span>walk_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
    seq<span class="token operator">=</span><span class="token punctuation">[</span>start_node<span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span>walk_len<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        current_node<span class="token operator">=</span>seq<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#è·å–seqçš„æœ€æœ‰ä¸€ä¸ªèŠ‚ç‚¹</span>
        next_nodes<span class="token operator">=</span>list<span class="token punctuation">(</span>G<span class="token punctuation">.</span>successors<span class="token punctuation">(</span>current_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#è·å–æ‰€æœ‰é‚»å±…èŠ‚ç‚¹</span>
        <span class="token keyword">if</span> len<span class="token punctuation">(</span>next_nodes<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        selected_next_node<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>next_nodes<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#ä»æ‰€æœ‰é‚»å±…ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª</span>
        seq<span class="token punctuation">.</span>append<span class="token punctuation">(</span>selected_next_node<span class="token punctuation">)</span>
    <span class="token keyword">return</span> seq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#test</span>
walk_one_time<span class="token punctuation">(</span>G<span class="token punctuation">,</span><span class="token string">"å˜å¼‚"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>['å˜å¼‚', 'æ¯’æ ª', 'å®ƒ', 'æ˜¯', 'æ­¤å‰']</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#å°†ä¸Šé¢çš„è¿‡ç¨‹é‡å¤å¤šæ¬¡ï¼Œå³å¯å¾—åˆ°ä¸€ä¸ªæ–°çš„corpus</span>
<span class="token keyword">def</span> <span class="token function">deep_walk</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span>walk_len<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>num_seqs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    corpus<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_seqs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_node<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>G<span class="token punctuation">.</span>nodes<span class="token punctuation">)</span>
        corpus<span class="token punctuation">.</span>append<span class="token punctuation">(</span>walk_one_time<span class="token punctuation">(</span>G<span class="token punctuation">,</span>start_node<span class="token punctuation">,</span>walk_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> corpus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">new_corpus<span class="token operator">=</span>deep_walk<span class="token punctuation">(</span>G<span class="token punctuation">)</span>
new_corpus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>['åŒ…æ‹¬', 'æœ€æ—©', 'åœ¨', 'è¶Šå—', 'å¿«æŠ¥', 'ç½‘', 'æŠ¥é“', 'æˆªè‡³', 'å½“åœ°', 'æ—¶é—´']</code></pre><h3 id="ä¸‰-Word2Vecçš„è®­ç»ƒ"><a href="#ä¸‰-Word2Vecçš„è®­ç»ƒ" class="headerlink" title="ä¸‰.Word2Vecçš„è®­ç»ƒ"></a>ä¸‰.Word2Vecçš„è®­ç»ƒ</h3><p>word2vecçš„è®­ç»ƒå¯ä»¥ä½¿ç”¨gensimå·¥å…·åŒ…ï¼Œword2vecçš„åŸç†åŒ…æ‹¬ä¸¤ç‚¹ï¼š    </p>
<p>1ï¼‰åŸºäºè¯­è¨€æ¨¡å‹çš„åŸç†ï¼Œè¯­è¨€æ¨¡å‹çš„ä½œç”¨ç”¨äºåˆ¤æ–­ä¸€ä¸ªå¥å­å‡ºç°çš„æ¦‚ç‡ï¼Œç”±äºå¥å­é€šå¸¸ä¼šè¢«åˆ†è¯ï¼Œæ‰€æœ‰è¯­è¨€æ¨¡å‹å¯ä»¥çœ‹ä½œåˆ¤æ–­ä¸€ä¸ªè¯è¯­åºåˆ—çš„å‡ºç°æ¦‚ç‡ï¼Œå¥½çš„è¯­è¨€æ¨¡å‹åº”è¯¥èƒ½åšåˆ°æ¯”å¦‚å¦‚ä¸‹çš„åˆ¤æ–­ï¼š   </p>
<p>$$<br>Proba([[å˜å¼‚],[æ¯’æ ª],[æ··åˆä½“],[éå¸¸],[å±é™©]])&gt;Proba([[å˜å¼‚],[å±é™©],[æ··åˆä½“],[éå¸¸],[æ¯’æ ª]])<br>$$</p>
<p>æ˜¾ç„¶ï¼Œç¬¬ä¸€å¥æ˜¯äººè¯ï¼Œç¬¬äºŒå¥è¯»ä¸é€š  </p>
<p>2ï¼‰è€Œword2vecå°±æ˜¯åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹å¼è®©æˆ‘ä»¬çš„äººè¯å‡ºç°çš„æ¦‚ç‡å°½å¯èƒ½é«˜ï¼Œè€Œé¬¼è¯çš„æ¦‚ç‡å°½å¯èƒ½å°ï¼Œå®ƒé‡‡ç”¨ä¸‰å±‚çš„ç½‘ç»œç»“æ„ï¼Œ  </p>
<blockquote>
<p>2.1ï¼‰ç¬¬ä¸€å±‚æ˜¯inputå±‚ï¼Œå®ƒä¸æˆ‘ä»¬çš„è¯å…¸ä¸€ä¸€å¯¹åº”   </p>
</blockquote>
<blockquote>
<p>2.2ï¼‰ä¸­é—´å±‚æ˜¯hiddenå±‚ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬embeddingçš„ç»´åº¦    </p>
</blockquote>
<blockquote>
<p>2.3ï¼‰æœ€åä¸€å±‚æ˜¯outputå±‚ï¼Œå®ƒåŒæ ·ä¸æˆ‘ä»¬çš„è¯å…¸ä¸€ä¸€å¯¹åº”  </p>
</blockquote>
<p>å®ƒçš„è®­ç»ƒå¦‚ä¸‹å›¾ï¼Œ  </p>
<blockquote>
<p>1ï¼‰æˆ‘ä»¬å¯¹è¾“å…¥çš„æ–‡æœ¬æˆªå–ä¸€å®šçš„çª—å£ï¼Œæ¯”å¦‚window_size=2ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€‰å–ç›®æ ‡æ¬¡å‰åçš„2X2+1=5ä¸ªè¯è¯­ï¼Œæ¯”å¦‚[[å˜å¼‚],[æ¯’æ ª],[æ··åˆä½“],[éå¸¸],[å±é™©]]è¿™5ä¸ªè¯è¯­  </p>
</blockquote>
<blockquote>
<p>2ï¼‰ç„¶åï¼Œæˆ‘ä»¬æ„å»º([å˜å¼‚],[æ¯’æ ª],[éå¸¸],[å±é™©])-&gt;([æ··åˆä½“])çš„æ˜ å°„ï¼Œå…¶ä¸­å‰åŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°ä½œ[æ··åˆä½“]çš„ä¸Šä¸‹æ–‡   </p>
</blockquote>
<blockquote>
<p>3ï¼‰æœ€åï¼Œæˆ‘ä»¬åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ä¼°è®¡ä¸Šé¢çš„ä¸Šä¸‹æ–‡å’Œç›®æ ‡è¯çš„æ˜ å°„æ¦‚ç‡å°½å¯èƒ½çš„å¤§</p>
</blockquote>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210829200204048.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> word2vec
model <span class="token operator">=</span> word2vec<span class="token punctuation">.</span>Word2Vec<span class="token punctuation">(</span>new_corpus<span class="token punctuation">,</span>window<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>vector_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æŸ¥çœ‹embedding</span>
model<span class="token punctuation">.</span>wv<span class="token punctuation">[</span><span class="token string">"å˜å¼‚"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([-0.19377613,  0.10809163, -0.16566691, -0.09616406,  0.00191299],
dtype=float32)</code></pre><pre class="line-numbers language-python"><code class="language-python">model<span class="token punctuation">.</span>wv<span class="token punctuation">[</span><span class="token string">"æ··åˆä½“"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([ 0.15368475, -0.18145339,  0.00444265,  0.05817473, -0.01261494],
dtype=float32)</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ºå›¾ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹è®­ç»ƒå‡ºäº†ä¸€ä¸ªembeddingï¼Œå¦å¤–ä¸Šé¢çš„è®­ç»ƒè¿‡ç¨‹å®é™…æ˜¯é‡‡ç”¨äº†CBOWçš„æ–¹å¼ï¼Œå³ç”¨ä¸Šä¸‹æ–‡æ¥é¢„æµ‹æŸä¸ªè¯ï¼Œè€Œå®é™…deepwalkæ›´å¤šæ˜¯ä½¿ç”¨<strong>skip-gram</strong>çš„æ–¹å¼ï¼Œå³åˆ©ç”¨å•ä¸ªè¯å»é¢„æµ‹å®ƒçš„ä¸Šä¸‹æ–‡ï¼ˆä¸Šé¢å›¾ä¸­çš„ç®­å¤´åå‘ï¼‰ï¼Œè¿™æ ·è®­ç»ƒçš„embeddingæ•ˆæœé€šå¸¸ä¼šæ›´å¥½</p>
<h3 id="å››-Node2VecåŸç†"><a href="#å››-Node2VecåŸç†" class="headerlink" title="å››.Node2VecåŸç†"></a>å››.Node2VecåŸç†</h3><p>Node2vecå…¶å®æ˜¯å¯¹äºDeepWalkä¸­ç¬¬2)æ­¥ï¼Œéšæœºæ¸¸èµ°æ–¹å¼çš„è°ƒæ•´ï¼Œä»¥å­¦ä¹ åˆ°å›¾ç»“æ„çš„åŒè´¨æ€§å’Œç»“æ„æ€§ä¿¡æ¯ã€‚è¿™é‡Œï¼š  </p>
<p>1ï¼‰åŒè´¨æ€§æ˜¯æŒ‡ç›¸é‚»ä¸¤èŠ‚ç‚¹ä¹‹é—´åº”è¯¥å…·æœ‰è¾ƒé«˜çš„ç›¸ä¼¼åº¦ï¼›    </p>
<p>2ï¼‰ç»“æ„æ€§æ˜¯æŒ‡é‚»å±…ç»“æ„ç›¸ä¼¼çš„ä¸¤èŠ‚ç‚¹ä¹‹é—´åº”è¯¥å…·æœ‰è¾ƒé«˜çš„ç›¸ä¼¼åº¦ï¼Œå³ä½¿è¿™ä¸¤èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰è·¯å¾„è¿æ¥    </p>
<p>å¦‚ä¸‹å›¾ï¼Œuä¸s1,s2,s3,s4ä¹‹é—´åœ¨åŒè´¨æ€§ä¸Šåº”è¯¥å…·æœ‰è¾ƒé«˜çš„ç›¸ä¼¼åº¦ï¼Œè€Œuä¸s6åœ¨ç»“æ„æ€§ä¸Šåº”è¯¥å…·æœ‰è¾ƒé«˜ç›¸ä¼¼åº¦<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829200439020.png" alt=""></p>
<p>é‚£å¦‚ä½•æ¸¸èµ°æ‰èƒ½æç°åŒè´¨æ€§å’Œç»“æ„æ€§å‘¢ï¼Œè¿™å…¶å®å¯ä»¥åˆ©ç”¨æˆ‘ä»¬å¸¸è§çš„å›¾æœç´¢ç®—æ³•ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢(DFS)å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢(BFS):   </p>
<p>1)DFS:æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œåœ¨ç›¸ä¿©èŠ‚ç‚¹é—´æ¸¸èµ°ï¼Œå€¾å‘äºè·å–åŒè´¨æ€§ä¿¡æ¯ï¼›   </p>
<p>2)BFS:å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œä¼˜å…ˆè·å–èŠ‚ç‚¹å‘¨å›´é‚»å±…åºåˆ—ï¼Œå€¾å‘äºè·å–ç»“æ„æ€§ä¿¡æ¯ï¼›    </p>
<p>å…·ä½“çš„æ¸¸èµ°æ–¹å¼å¦‚ä¸‹<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829200449990.png" alt=""></p>
<p>å·²çŸ¥ï¼Œå½“å‰åºåˆ—çš„æœ€åä¸¤èŠ‚ç‚¹ä¸º[t,v]ï¼Œå³æœ€åä¸€æ­¥æ¸¸èµ°ä¸ºt-&gt;vï¼Œé‚£ä¹ˆæ¥ä¸‹çš„æ¸¸èµ°æ–¹å¼æ»¡è¶³å¦‚ä¸‹å…¬å¼ï¼š<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829200501619.png" alt=""><br>ä¸‹é¢ç›´è§‚è§£é‡Šä¸€ä¸‹è¿™ä¸‰ç§æƒ…å†µï¼š   </p>
<blockquote>
<p>(1) $d_{tx}=0$ï¼Œè¡¨ç¤º$t$èŠ‚ç‚¹ä¸$x$èŠ‚ç‚¹è·ç¦»ä¸º0ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œè¨€å¤–ä¹‹æ„æ˜¯è¯´ä»$v$èŠ‚ç‚¹åˆè·³å›äº†å‰èŠ‚ç‚¹$t$ï¼Œå®ƒçš„è·³è½¬æ¦‚ç‡å®šä¹‰ä¸º$\frac{1}{p}$<br>(2) $d_{tx}=1$ï¼Œè¡¨ç¤ºæ—¢ä¸$t$ç›¸è¿ï¼Œåˆä¸$v$ç›¸è¿çš„èŠ‚ç‚¹ï¼Œå¦‚å›¾ä¸­çš„$x_1$ï¼Œå®ƒçš„è·³è½¬æ¦‚ç‡å®šä¹‰ä¸º1<br>(3) $d_{tx}=2$ï¼Œå³å›¾ä¸­çš„$x_2,x_3$èŠ‚ç‚¹ï¼Œå®ƒä»¬çš„è·³è½¬æ¦‚ç‡è¢«å®šä¹‰ä¸º$\frac{1}{q}$  </p>
</blockquote>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„â€œæ¦‚ç‡â€éƒ½æœªå½’ä¸€åŒ–ï¼Œæœ€ç»ˆéœ€è¦è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œå¦å¤–node2vecè¿˜éœ€è¦è€ƒè™‘è¾¹çš„æƒé‡$w_{vx}$ï¼Œæ‰€ä»¥å®ƒå®é™…æ˜¯å¯¹$\pi_{vx}=\alpha_{pq}(t,x)\cdot w_{vx}$è¿›è¡Œå½’ä¸€åŒ–ï¼Œä¸‹é¢å¯¹è¶…å‚æ•°$p,q$è¿›è¡Œè®¨è®ºï¼›   </p>
<blockquote>
<p>å¯¹äºpï¼šå¦‚æœ$p&gt;max(q,1)$,é‚£ä¹ˆé‡‡æ ·å€¾å‘äºä¸ä¼šå¾€å›èµ°ï¼Œè€Œå¦‚ä½•$p&lt;min(q,1)$ï¼Œé‡‡æ ·å€¾å‘äºè¿”å›ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨åˆå§‹ç‚¹å‘¨å›´æ¸¸èµ°  </p>
</blockquote>
<blockquote>
<p>å¯¹äºq: å¦‚æœ$q&gt;1$ï¼Œé‡‡æ ·ç‚¹å€¾å‘äºåœ¨èµ·å§‹ç‚¹å‘¨å›´æ¸¸èµ°åšBFSé‡‡æ ·ï¼Œè€Œå¦‚æœ$q&lt;1$ï¼Œå€¾å‘äºè¿œç¦»èµ·å§‹ç‚¹ï¼ŒåšDFSé‡‡æ ·   </p>
</blockquote>
<h3 id="äº”-å®ç°"><a href="#äº”-å®ç°" class="headerlink" title="äº”.å®ç°"></a>äº”.å®ç°</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æ„å»ºå›¾</span>
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
G<span class="token operator">=</span>nx<span class="token punctuation">.</span>DiGraph<span class="token punctuation">(</span><span class="token punctuation">)</span>
edges<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s3"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s4"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s1"</span><span class="token punctuation">,</span><span class="token string">"s2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s1"</span><span class="token punctuation">,</span><span class="token string">"s3"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s3"</span><span class="token punctuation">,</span><span class="token string">"s4"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">(</span><span class="token string">"s2"</span><span class="token punctuation">,</span><span class="token string">"s4"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s5"</span><span class="token punctuation">,</span><span class="token string">"s2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s4"</span><span class="token punctuation">,</span><span class="token string">"s5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s6"</span><span class="token punctuation">,</span><span class="token string">"s5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s6"</span><span class="token punctuation">,</span><span class="token string">"s7"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s6"</span><span class="token punctuation">,</span><span class="token string">"s8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s6"</span><span class="token punctuation">,</span><span class="token string">"s9"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">(</span><span class="token string">"s5"</span><span class="token punctuation">,</span><span class="token string">"s7"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s7"</span><span class="token punctuation">,</span><span class="token string">"s8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"s8"</span><span class="token punctuation">,</span><span class="token string">"s9"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
G<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span>edges<span class="token punctuation">)</span>
G<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span><span class="token punctuation">(</span>edge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>edge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> edge <span class="token keyword">in</span> edges<span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>G<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_1_0.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">class</span> <span class="token class-name">Node2Vec</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>walk_len<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>num_seqs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>p<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>q<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>walk_len<span class="token operator">=</span>walk_len
        self<span class="token punctuation">.</span>num_seqs<span class="token operator">=</span>num_seqs
        self<span class="token punctuation">.</span>p<span class="token operator">=</span>p
        self<span class="token punctuation">.</span>q<span class="token operator">=</span>q
    <span class="token keyword">def</span> <span class="token function">walk_one_time</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>G<span class="token punctuation">,</span>start_node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#æ·»åŠ ç¬¬äºŒä¸ªç‚¹</span>
        second_node<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>list<span class="token punctuation">(</span>G<span class="token punctuation">.</span>successors<span class="token punctuation">(</span>start_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        seq<span class="token operator">=</span><span class="token punctuation">[</span>start_node<span class="token punctuation">,</span>second_node<span class="token punctuation">]</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>walk_len<span class="token number">-2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            t_node<span class="token operator">=</span>seq<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
            v_node<span class="token operator">=</span>seq<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            next_nodes<span class="token operator">=</span>list<span class="token punctuation">(</span>G<span class="token punctuation">.</span>successors<span class="token punctuation">(</span>v_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#è·å–æ‰€æœ‰é‚»å±…èŠ‚ç‚¹</span>
            proba<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#è®°å½•æ¦‚ç‡</span>
            <span class="token keyword">for</span> next_node <span class="token keyword">in</span> next_nodes<span class="token punctuation">:</span>
                path_len<span class="token operator">=</span>nx<span class="token punctuation">.</span>shortest_path_length<span class="token punctuation">(</span>G<span class="token punctuation">,</span>source<span class="token operator">=</span>t_node<span class="token punctuation">,</span>target<span class="token operator">=</span>next_node<span class="token punctuation">)</span>
                <span class="token keyword">if</span> path_len<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                    proba<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>self<span class="token punctuation">.</span>p<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> path_len<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
                    proba<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    proba<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>self<span class="token punctuation">.</span>q<span class="token punctuation">)</span>
            proba<span class="token operator">=</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>proba<span class="token punctuation">)</span>
            proba<span class="token operator">=</span>proba<span class="token operator">/</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>proba<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å½’ä¸€åŒ–</span>
            selected_next_node<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>next_nodes<span class="token punctuation">,</span>p<span class="token operator">=</span>proba<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#ä»æ‰€æœ‰é‚»å±…ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª</span>
            seq<span class="token punctuation">.</span>append<span class="token punctuation">(</span>selected_next_node<span class="token punctuation">)</span>
        <span class="token keyword">return</span> seq
    <span class="token keyword">def</span> <span class="token function">deep_walk</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>G<span class="token punctuation">)</span><span class="token punctuation">:</span>
        corpus<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_seqs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            start_node<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>G<span class="token punctuation">.</span>nodes<span class="token punctuation">)</span>
            corpus<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>walk_one_time<span class="token punctuation">(</span>G<span class="token punctuation">,</span>start_node<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> corpus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">node2vec<span class="token operator">=</span>Node2Vec<span class="token punctuation">(</span>q<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
corpus<span class="token operator">=</span>node2vec<span class="token punctuation">.</span>deep_walk<span class="token punctuation">(</span>G<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">corpus<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>[['s1', 'u', 's3', 's4', 's2', 'u', 's1', 's3', 'u', 's1']]</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#è®­ç»ƒ</span>
<span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> word2vec
model <span class="token operator">=</span> word2vec<span class="token punctuation">.</span>Word2Vec<span class="token punctuation">(</span>corpus<span class="token punctuation">,</span>window<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>vector_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æŸ¥çœ‹embedding</span>
model<span class="token punctuation">.</span>wv<span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([-0.14191031,  0.13018166,  0.1809364 , -0.10049632, -0.07593277],
dtype=float32)</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#è®¡ç®—ç›¸ä¼¼åº¦</span>
model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>similarity<span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s5"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>0.07862966</code></pre><pre class="line-numbers language-python"><code class="language-python">model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>similarity<span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"s6"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>0.6219288</code></pre><h2 id="GCN"><a href="#GCN" class="headerlink" title="GCN"></a>GCN</h2><h3 id="GCNåŸç†"><a href="#GCNåŸç†" class="headerlink" title="GCNåŸç†"></a>GCNåŸç†</h3><p><strong>1.1  é—®é¢˜1ï¼š</strong> å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„5ä¸ªç”¨æˆ·ï¼Œä»–ä»¬ç¼–å·ä¸º0~4ï¼Œä¸”çŸ¥é“ä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨é¢å¯¹çš„æ˜¯è½¦é™©åæ¬ºè¯ˆçš„é¢„æµ‹åœºæ™¯ï¼Œå·²çŸ¥ç¼–å·1ï¼Œ2çš„ä¸ºæ¬ºè¯ˆå®¢æˆ·ï¼ˆæ­£æ ·æœ¬ï¼‰ï¼Œç¼–å·4çš„ä¸ºæ­£å¸¸å®¢æˆ·ï¼ˆè´Ÿæ ·æœ¬ï¼‰ï¼Œç°åœ¨è¦æˆ‘ä»¬é¢„æµ‹å‰©ä¸‹çš„ç¼–å·0ï¼Œ3çš„å®¢æˆ·æ˜¯æ¬ºè¯ˆå®¢æˆ·è¿˜æ˜¯æ­£å¸¸å®¢æˆ·ï¼Ÿè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829200722942.png" alt=""></p>
<p>æˆ‘æƒ³åŸºäºå‰ä¸‰èŠ‚çš„å†…å®¹è‡³å°‘å¯ä»¥æœ‰ä¸¤ä¸ªæ€è·¯ï¼š   </p>
<p>ï¼ˆ1ï¼‰åŸºäºåº¦æŒ‡æ ‡ï¼šè®¡ç®—å½“å‰èŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹ä¸­æ¬ºè¯ˆå®¢æˆ·çš„å æ¯”ï¼Œé‚£ä¹ˆ0å·å®¢æˆ·å‘¨å›´1/1çš„å®¢æˆ·éƒ½æ˜¯æ¬ºè¯ˆå®¢æˆ·ï¼Œæ‰€ä»¥ä»–ä¹Ÿæ˜¯æ¬ºè¯ˆå®¢æˆ·ï¼Œè€Œå®¢æˆ·3å‘¨å›´æœ‰2/3çš„å®¢æˆ·éƒ½æ˜¯æ¬ºè¯ˆå®¢æˆ·ï¼Œæ‰€ä»¥ä»–ä¹Ÿæ˜¯æ¬ºè¯ˆå®¢æˆ·<br>ï¼ˆ2ï¼‰åŸºäºGraph Embeddingï¼šåŸºäºDeepWalkæˆ–è€…Node2Vecçš„æ–¹å¼ä¸ºæ¯ä¸ªç”¨æˆ·å­¦ä¹ ä¸€ä¸ªEmbeddingï¼Œç„¶åè®¡ç®—å®ƒä¸é‚»å±…Embeddingçš„ç›¸ä¼¼åº¦ï¼Œç„¶åç»Ÿè®¡ç´¯è®¡ç›¸ä¼¼åº¦å æ¯”æœ€é«˜çš„æ ‡ç­¾ä¸ºå½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œæˆ–è€…ç›´æ¥å°†è¿™äº›Embeddingé€åˆ°ä¸€ä¸ªåˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒ    </p>
<p><strong>1.2 é—®é¢˜2ï¼š</strong> è€Œæˆ‘ä»¬åœ¨å¤„ç†å®é™…æ•°æ®æ—¶ï¼Œå¯èƒ½å¹¶ä¸ä»…ä»…åªæœ‰ä»–ä»¬ä¹‹é—´çš„å…³ç³»æ•°æ®ï¼Œè¿˜ä¼šæœ‰ä»–ä»¬å„è‡ªçš„å› å­æ•°æ®ï¼Œæ¯”å¦‚å¹´é¾„ï¼Œæœ€è¿‘åŠå¹´çš„è´·æ¬¾é¢ï¼Œæœ€è¿‘ä¸€æœˆçš„æ¶ˆè´¹é¢åº¦è¿™ä¸‰é¡¹ï¼Œæˆ‘ä»¬å°†å…¶åŠ åˆ°å›¾ä¸­ï¼ˆå·²ç»å½’ä¸€åŒ–å¤„ç†ï¼‰   </p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210829200734312.png" alt=""></p>
<p>é‚£ç°åœ¨å¦‚ä½•å¤„ç†ï¼Ÿä»¥å¾€æˆ‘ä»¬å¯èƒ½ä¼šåªåˆ©ç”¨ä»–ä»¬çš„å› å­æ•°æ®æ¥æ„å»ºåˆ†ç±»æ¨¡å‹ï¼Œæ¯”å¦‚ä½¿ç”¨lgbmå¯¹è¿™ä¸‰ç»´åº¦çš„å› å­å»ºæ¨¡é¢„æµ‹ï¼Œä½†è¿™æ ·åˆå°‘äº†ç»“æ„ä¿¡æ¯ï¼›é‚£å¦‚æœåªåˆ©ç”¨äº†ä¸Šé¢çš„ç»“æ„ä¿¡æ¯å»ºæ¨¡åˆå°‘äº†å› å­æ•°æ®ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•å°†Embedding+å› å­ç»“åˆèµ·æ¥ï¼‰ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•åŒæ—¶åˆ©ç”¨ç»“æ„ä¿¡æ¯å’Œå› å­ä¿¡æ¯å‘¢ï¼Ÿè¿™å¯ä»¥ä»CNNçš„å·ç§¯æ“ä½œè¿›è¡Œå€Ÿé‰´   </p>
<p><strong>1.3 æ›´ä¸€èˆ¬çš„è®¤è¯†CNN:</strong> è®©æˆ‘ä»¬é‡æ–°ç†è§£ä¸€ä¸‹CNNä¸­å·ç§¯æ“ä½œï¼Œ</p>
<blockquote>
<p>1) å·ç§¯æ“ä½œæœ¬è´¨ä¸Šæ˜¯å°†æŸè§†é‡åŸŸå†…çš„åƒç´ ç‚¹æ•°æ®è¿›è¡ŒåŠ æƒèšåˆï¼Œå¦‚ä¸‹å›¾å·¦è¾¹å°†çº¢è‰²åŒºå—é™„è¿‘çš„8ä¸ªç»¿å—æ•°æ®åŠ æƒèšåˆåˆ°çº¢å—ä¸­ï¼ˆé€šå¸¸ä¼šåŒ…å«çº¢å—è‡ªèº«çš„æ•°æ®ï¼‰ï¼›<br>2) é‚£å¦‚æœæˆ‘ä»¬å°†è¿™äº›åƒç´ ç‚¹å¼ºè¡Œæ‹‰å¼€å‘¢ï¼Ÿè¿™ä¸­é—´çš„å›¾ä¸å°±æ˜¯ä¸€ä¸ªå›¾ç»“æ„äº†å—ï¼Ÿï¼ˆè€Œä¸”ç°åœ¨çš„è¾¹æ—¶å¸¦æƒé‡çš„ï¼Œå®ƒçš„æƒé‡å°±å¯¹åº”äº†å·ç§¯å—ä¸Šçš„æ•°å€¼ï¼‰ï¼›<br>3) é‚£å¦‚æœæˆ‘ä»¬å†å°†ä¸­å›¾ä¸­çš„æŸäº›è¾¹åˆ‡æ‰ï¼Œé‚£ä¸å°±æ˜¯æ›´ä¸€èˆ¬çš„å›¾ç»“æ„äº†</p>
</blockquote>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210829200751451.png" alt=""></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨CNNçš„æ–¹å¼æ¥å¤„ç†GNNï¼š<strong>å°†å‘¨å›´é‚»å±…çš„ä¿¡æ¯åŠ æƒèšåˆåˆ°ä¸­å¿ƒèŠ‚ç‚¹</strong>ï¼Œè¿™ä¾¿æ˜¯GCNçš„åŸºæœ¬æ€è·¯äº†ï¼š   </p>
<p>1ï¼‰èŠ‚ç‚¹ä¸Šçš„ä¿¡æ¯å°±æ˜¯æˆ‘ä»¬çš„å› å­ï¼Œæ¯”å¦‚ä¸Šé¢çš„å¹´é¾„ï¼Œæœ€è¿‘åŠå¹´çš„è´·æ¬¾é¢ï¼Œæœ€è¿‘ä¸€æœˆçš„æ¶ˆè´¹é¢â€¦<br>2ï¼‰è€Œå¯¹é‚»å±…çš„åŠ æƒèšåˆä¾¿æ˜¯å¯¹äºç»“æ„ä¿¡æ¯çš„å¤„ç†â€¦   </p>
<p>å¦‚æ­¤è¿™æ ·ï¼Œå°±èƒ½åŒæ—¶åˆ©ç”¨èŠ‚ç‚¹çš„å› å­ä¿¡æ¯å’Œç»“æ„ä¿¡æ¯äº†ï¼Œä¸‹é¢ä»‹ç»GCNçš„è¯¦ç»†æ¨å¯¼   </p>
<p><strong>1.4 GCNæ¨å¯¼</strong>   </p>
<p><strong>ç»“æ„ä¸Š</strong>ï¼š   </p>
<p>ä¸CNNç±»ä¼¼ï¼Œå½“å‰èŠ‚ç‚¹çš„æ›´æ–°ä¿¡æ¯ç”±å½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯å’Œå‘¨å›´é‚»å±…ä¿¡æ¯ç´¯åŠ å¾—åˆ°ï¼Œå¯¹äºå›¾ç»“æ„è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªè‡ªè¿æ¥<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829200807156.png" alt=""></p>
<p>æ¯”å¦‚å¯¹äºèŠ‚ç‚¹1ï¼Œå®ƒçš„æ›´æ–°åçš„ä¿¡æ¯å°±æ˜¯ï¼š   </p>
<p>$$<br>[0.4,0.2,0.7]+[0.2,0.3,0.5]+[0.3,0.3,0.5]+[0.4,0.2,0.3]=[1.3,1.0,2.0]<br>$$</p>
<p>å†æ¯”å¦‚ï¼Œå¯¹äºèŠ‚ç‚¹4ï¼Œå®ƒçš„æ›´æ–°åçš„ä¿¡æ¯å°±æ˜¯ï¼š   </p>
<p>$$<br>[0.2,0.4,0.3]+[0.4,0.2,0.3]=[0.6,0.6,0.6]<br>$$</p>
<p>æƒ³å¿…ï¼Œä½ ä¹Ÿå‘ç°é—®é¢˜äº†ï¼Œå¯¹äºé‚»å±…å¾ˆå¤šçš„èŠ‚ç‚¹ï¼Œèšåˆåçš„æ•°å€¼ä¼šæ¯”å…¶å®ƒé‚»å±…å°‘çš„èŠ‚ç‚¹å¤§å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œå½’ä¸€åŒ–ï¼ŒGCNæ˜¯é‡‡ç”¨çš„å½’ä¸€åŒ–æ–¹å¼å¦‚ä¸‹ï¼Œå¯¹äºèŠ‚ç‚¹$v_i,v_j$ï¼Œå®ƒä»¬çš„åº¦ä¸º$d(v_i),d(v_j)$ï¼Œèšåˆä¿¡æ¯æ—¶ï¼Œä¼šåœ¨å®ƒä»¬å‰é¢ä¹˜ä»¥ä¸€ä¸ªæƒé‡ï¼Œå³åº¦çš„ä¹˜ç§¯çš„å¹³æ–¹æ ¹çš„å€’æ•°ï¼š    </p>
<p>$$<br>\frac{1}{\sqrt{d(v_i)}\cdot \sqrt{d(v_j)}}<br>$$</p>
<p>æ‰€ä»¥ï¼Œè¿™æ—¶å¯¹äºèŠ‚ç‚¹1çš„æ›´æ–°å°±æ˜¯ï¼š   </p>
<p>$$<br>\frac{1}{4}[0.4,0.2,0.7]+\frac{1}{2\sqrt{2}}[0.2,0.3,0.5]+\frac{1}{2\sqrt{3}}[0.3,0.3,0.5]+\frac{1}{2\sqrt{3}}[0.4,0.2,0.3]<br>$$</p>
<p>ä¸Šé¢çš„æ›´æ–°æ“ä½œï¼Œå¯ä»¥å¯¹$X$å·¦ä¹˜ä¸€ä¸ªçŸ©é˜µæ¥è¿›è¡Œè®¡ç®—ï¼š   </p>
<p>$$<br>\tilde{L}_{sym}X<br>$$</p>
<p>è¿™é‡Œçš„$X$å°±æ˜¯æˆ‘ä»¬çš„å› å­æ•°æ®ï¼Œç¬¬$i$è¡Œå°±æ˜¯ç¬¬$i$ä¸ªå› å­çš„å‘é‡è¡¨ç¤ºï¼Œæ¯”å¦‚$X_{0,:}=[0.2,0.3,0.5]$ï¼Œè€Œ   </p>
<p>$$<br>\tilde{L}<em>{sym}=\tilde{D}^{-1/2}\tilde{A}\tilde{D}^{-1/2}, \tilde{A}=A+I, \tilde{D</em>{ii}}=\sum_j\tilde{A}_{ij}<br>$$</p>
<p>è¿™é‡Œçš„$A$æ˜¯è¿æ¥çŸ©é˜µï¼Œ$I$æ˜¯å•ä½çŸ©é˜µï¼Œæ‰€ä»¥$\tilde{A}X$ï¼Œå°±æ˜¯æ·»åŠ äº†è‡ªè¿æ¥ä¸”æ²¡åŠ æƒçš„èšåˆè¡¨ç¤ºï¼Œå³æœ€ä¸Šé¢çš„è¡¨ç¤ºï¼Œå¦‚èŠ‚ç‚¹1çš„èšåˆ   </p>
<p>$$<br>[0.4,0.2,0.7]+[0.2,0.3,0.5]+[0.3,0.3,0.5]+[0.4,0.2,0.3]=[1.3,1.0,2.0]<br>$$</p>
<p>è€Œ$\tilde{D}$æ˜¯$\tilde{A}$çš„åº¦çŸ©é˜µï¼Œå®ƒåªæœ‰å¯¹è§’çº¿ä¸Šæœ‰å€¼ï¼Œ$\tilde{D}_{ii}$çš„å€¼å°±æ˜¯$\tilde{A}$çš„ç¬¬$i$è¡Œæ±‚å’Œï¼Œæ‰€ä»¥$\tilde{A}$çŸ©é˜µå‰ååˆ†åˆ«ä¹˜ä¸€ä¸ª$\tilde{D}^{-1/2}$ç›¸ç­‰äºä¹˜ä»¥äº†ä¸Šæ–‡ä»‹ç»çš„æƒé‡$\frac{1}{\sqrt{d(v_i)}\cdot \sqrt{d(v_j)}}$</p>
<p><strong>å› å­ä¸Šï¼š</strong>    </p>
<p>å¯ä»¥å‘ç°$ \tilde{L}<em>{sym}X $ ä¸­çš„ $ \tilde{L}</em>{sym} $å’Œ$ X $éƒ½æ˜¯å·²çŸ¥çš„ï¼ŒGCNå¸Œæœ›å¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Œæ‰€ä»¥å¯¹äº$ \tilde{L}_{sym}X $åœ¨ç‰¹å¾ä¸Šå†åšäº†ä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œç­‰ä»·äºå³ä¹˜ä¸€ä¸ªå˜é‡çŸ©é˜µ$ W $ï¼Œä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºè¡¨è¾¾èƒ½åŠ›ï¼Œé€šå¸¸è¿˜ä¼šå¯¹ç»“æœè¿›è¡Œä¸€ä¸ªéçº¿æ€§å˜æ¢$ \sigma $ï¼Œæ‰€ä»¥æœ€ç»ˆçš„æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š   </p>
<p>$$<br>Xâ€™=\sigma(\tilde{L}_{sym}XW)<br>$$</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ$W$æ˜¯å¯¹æ¯ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹å…±äº«çš„ï¼Œè¿™é‡Œå¯ä»¥å°†å…¶ç±»æ¯”ä¸ºCNNä¸­çš„å·ç§¯æ ¸ç³»æ•°   </p>
<p><strong>å¦‚ä½•è®­ç»ƒï¼Ÿ</strong>  </p>
<p>è¿™å°±å’Œå…¶å®ƒMLçš„ä»»åŠ¡ä¸€æ ·çš„ï¼Œæ„é€ ä¸€ä¸ªæŸå¤±å‡½æ•°$loss(Xâ€™,Y)$ï¼Œç„¶ååŸºäºæ¢¯åº¦ï¼Œæ›´æ–°å‚æ•°$W$å³å¯ï¼Œæ¯”å¦‚($\eta$ä¸ºå­¦ä¹ ç‡)ï¼š</p>
<p>$$<br>W\leftarrow W-\eta\frac{\partial loss(Xâ€™,Y)}{\partial W}<br>$$</p>
<h3 id="ä»£ç å®è·µ"><a href="#ä»£ç å®è·µ" class="headerlink" title="ä»£ç å®è·µ"></a>ä»£ç å®è·µ</h3><p>ä¸‹é¢ä»…æ¼”ç¤ºä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†   </p>
<p><strong>2.1 åŠ è½½æ•°æ®å¹¶æ„å»º$\tilde{L}_{sym}$</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> code<span class="token punctuation">.</span>gcn <span class="token keyword">import</span> <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#åŠ è½½æ•°æ®</span>
dataset <span class="token operator">=</span> CoraData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Using Cached file: E:\datas\Algs\GNN\cora\processed_cora.pkl<br>Cached file: E:\datas\Algs\GNN\cora\processed_cora.pkl</p>
<p><strong>é“¾æ¥çŸ©é˜µ</strong>ï¼šè¡¨ç¤ºæ–‡ç« ä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œè¿™é‡Œæ˜¯ç¨€ç–çŸ©é˜µçš„æ ¼å¼</p>
<pre class="line-numbers language-python"><code class="language-python">dataset<span class="token punctuation">.</span>adjacency<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>&lt;2708x2708 sparse matrix of type '&lt;class 'numpy.float32'&gt;'
with 10556 stored elements in COOrdinate format&gt;</code></pre><p><strong>å› å­ä¿¡æ¯</strong>ï¼š2708X1433çš„çŸ©é˜µï¼Œå³2708ç¯‡æ–‡ç« çš„BOWè¡¨ç¤º</p>
<pre class="line-numbers language-python"><code class="language-python">dataset<span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([[0., 0., 0., ..., 0., 0., 0.],
[0., 0., 0., ..., 0., 0., 0.],
[0., 0., 0., ..., 0., 0., 0.],
...,
[0., 0., 0., ..., 0., 0., 0.],
[0., 0., 0., ..., 0., 0., 0.],
[0., 0., 0., ..., 0., 0., 0.]], dtype=float32)</code></pre><p><strong>æ ‡ç­¾ä¿¡æ¯</strong>ï¼š2708X1ï¼Œåˆ†åˆ«æ ‡è®°äº†2708ç¯‡æ–‡ç« çš„7ç§ç±»åˆ«</p>
<pre class="line-numbers language-python"><code class="language-python">dataset<span class="token punctuation">.</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([3, 4, 4, ..., 3, 3, 3], dtype=int64)</code></pre><p><strong>æ„å»º$\tilde{L}_{sym}$çš„ä»£ç </strong>ï¼š  </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">normalization</span><span class="token punctuation">(</span>adjacency<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""è®¡ç®— L=D^-0.5 * (A+I) * D^-0.5"""</span>
    adjacency <span class="token operator">+=</span> sp<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>adjacency<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># å¢åŠ è‡ªè¿æ¥</span>
    degree <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>adjacency<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    d_hat <span class="token operator">=</span> sp<span class="token punctuation">.</span>diags<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>degree<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> d_hat<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>adjacency<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>d_hat<span class="token punctuation">)</span><span class="token punctuation">.</span>tocoo<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#å¦‚æœæœ‰GPUåˆ™ä½¿ç”¨GPU</span>
device <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span>
<span class="token comment" spellcheck="true">#æ¥ç€é¢„å¤„ç†å‰©ä¸‹çš„æ•°æ®</span>
x <span class="token operator">=</span> dataset<span class="token punctuation">.</span>x <span class="token operator">/</span> dataset<span class="token punctuation">.</span>x<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># å½’ä¸€åŒ–æ•°æ®ï¼Œä½¿å¾—æ¯ä¸€è¡Œå’Œä¸º1</span>
tensor_x <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_y <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_train_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>trn_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_val_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>val_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_test_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>test_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
normalize_adjacency <span class="token operator">=</span> normalization<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>adjacency<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># è§„èŒƒåŒ–é‚»æ¥çŸ©é˜µ</span>
indices <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span><span class="token punctuation">[</span>normalize_adjacency<span class="token punctuation">.</span>row<span class="token punctuation">,</span> normalize_adjacency<span class="token punctuation">.</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span>
values <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>normalize_adjacency<span class="token punctuation">.</span>data<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
tensor_adjacency <span class="token operator">=</span> torch<span class="token punctuation">.</span>sparse<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>indices<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2708</span><span class="token punctuation">,</span> <span class="token number">2708</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2.2 æ„å»ºæ¨¡å‹</strong>  </p>
<p>è¿™éƒ¨åˆ†ä»£ç æ‹†åˆ†ä¸ºäº†ä¸¤å—ï¼Œ   </p>
<p>1ï¼‰ç¬¬ä¸€å—æ˜¯å¯¹å•æ¬¡å›¾å·ç§¯çš„æ“ä½œï¼Œå¯¹åº”ä¸Šé¢çš„å…¬å¼ï¼š$Xâ€™=\sigma(\tilde{L}_{sym}XW)$ï¼Œä»£ç å¦‚ä¸‹(è¿™é‡Œå¹¶æ²¡æœ‰å®ç°æ¿€æ´»å‡½æ•°çš„åŠŸèƒ½)ï¼š   </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GraphConvolution</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""å›¾å·ç§¯
        input_dim: èŠ‚ç‚¹è¾“å…¥ç‰¹å¾çš„ç»´åº¦
        output_dim: è¾“å‡ºç‰¹å¾ç»´åº¦ 
        use_bias : bool, optional"""</span>
        super<span class="token punctuation">(</span>GraphConvolution<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>input_dim <span class="token operator">=</span> input_dim
        self<span class="token punctuation">.</span>output_dim <span class="token operator">=</span> output_dim
        self<span class="token punctuation">.</span>use_bias <span class="token operator">=</span> use_bias
        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>output_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>register_parameter<span class="token punctuation">(</span><span class="token string">'bias'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>reset_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reset_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>zeros_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bias<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> adjacency<span class="token punctuation">,</span> input_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        adjacency: ç»è¿‡ä¸Šé¢å½’ä¸€åŒ–åçš„é“¾æ¥çŸ©é˜µï¼Œå³\tilde{L}_{sym}
        input_feature:è¾“å…¥ç‰¹å¾ï¼Œå³X """</span>
        support <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>input_feature<span class="token punctuation">,</span> self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        output <span class="token operator">=</span> torch<span class="token punctuation">.</span>sparse<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>adjacency<span class="token punctuation">,</span> support<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            output <span class="token operator">+=</span> self<span class="token punctuation">.</span>bias
        <span class="token keyword">return</span> output<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2ï¼‰ç¬¬äºŒå—ä»£ç å åŠ äº†ä¸¤å±‚å›¾å·ç§¯ï¼Œç¬¬ä¸€å±‚å°†1433ç»´çš„BOWé™ä½åˆ°16ç»´ï¼Œç¬¬äºŒå±‚å°†16ç»´é™ä½åˆ°7ç»´ï¼Œå¯¹åº”åˆ°æˆ‘ä»¬çš„ç±»åˆ«æ•°   </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GCNNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" å®šä¹‰ä¸€ä¸ªåŒ…å«ä¸¤å±‚GraphConvolutionçš„æ¨¡å‹ """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token operator">=</span><span class="token number">1433</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>GCNNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>gcn1 <span class="token operator">=</span> GraphConvolution<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>gcn2 <span class="token operator">=</span> GraphConvolution<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> adjacency<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
        h <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>gcn1<span class="token punctuation">(</span>adjacency<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">)</span>
        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>gcn2<span class="token punctuation">(</span>adjacency<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        <span class="token keyword">return</span> logits<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æ„å»ºæ¨¡å‹</span>
model <span class="token operator">=</span> GCNNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>2.3 è®­ç»ƒæ¨¡å‹</strong>  </p>
<p>ä¸»è¦åŒ…æ‹¬ï¼š<br>1ï¼‰æŸå¤±å‡½æ•°å®šä¹‰<br>2ï¼‰ä¼˜åŒ–å™¨å®šä¹‰<br>3ï¼‰è®­ç»ƒè¿‡ç¨‹ï¼š  &lt;1&gt;å‰å‘å¾—åˆ°loss ï¼› &lt;2&gt;lossåå‘æ›´æ–°å‚æ•°</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># è¶…å‚æ•°å®šä¹‰</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.1</span>
weight_decay <span class="token operator">=</span> <span class="token number">5e</span><span class="token operator">-</span><span class="token number">4</span>
epochs <span class="token operator">=</span> <span class="token number">200</span>
<span class="token comment" spellcheck="true"># æŸå¤±å‡½æ•°ä½¿ç”¨äº¤å‰ç†µ</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ä¼˜åŒ–å™¨ä½¿ç”¨Adam</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span>weight_decay<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># è®­ç»ƒ</span>
loss_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
val_acc_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> tensor_y<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># å‰å‘ä¼ æ’­</span>
    logits <span class="token operator">=</span> model<span class="token punctuation">(</span>tensor_adjacency<span class="token punctuation">,</span> tensor_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åªé€‰æ‹©è®­ç»ƒèŠ‚ç‚¹è¿›è¡Œç›‘ç£</span>
    train_mask_logits <span class="token operator">=</span> logits<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—æŸå¤±å€¼</span>
    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>train_mask_logits<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åå‘ä¼ æ’­è®¡ç®—å‚æ•°çš„æ¢¯åº¦</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•è¿›è¡Œæ¢¯åº¦æ›´æ–°</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2.4 é¢„æµ‹å¹¶æŸ¥çœ‹æ•ˆæœ</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># tsneé™ç»´ï¼ŒæŸ¥çœ‹æ•ˆæœ</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">,</span>category<span class="token operator">=</span>DeprecationWarning<span class="token punctuation">)</span>
<span class="token operator">%</span>matplotlib inline
<span class="token comment" spellcheck="true">#å¯¹Xç”¨tsneé™ç»´</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> manifold
tsne <span class="token operator">=</span> manifold<span class="token punctuation">.</span>TSNE<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>init<span class="token operator">=</span><span class="token string">"pca"</span><span class="token punctuation">)</span>
X_tsne <span class="token operator">=</span> tsne<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>tensor_x<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#é¢„æµ‹</span>
pred <span class="token operator">=</span> model<span class="token punctuation">(</span>tensor_adjacency<span class="token punctuation">,</span> tensor_x<span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#å½’ä¸€åŒ–æ˜¾ç¤º</span>
x_min<span class="token punctuation">,</span> x_max <span class="token operator">=</span> X_tsne<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> X_tsne<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
X_norm <span class="token operator">=</span> <span class="token punctuation">(</span>X_tsne <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>c<span class="token operator">=</span>pred<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_18_0.png" alt=""></p>
<h2 id="GraphSAGE"><a href="#GraphSAGE" class="headerlink" title="GraphSAGE"></a>GraphSAGE</h2><h3 id="GraphSAGEåŸç†"><a href="#GraphSAGEåŸç†" class="headerlink" title="GraphSAGEåŸç†"></a>GraphSAGEåŸç†</h3><p>GraphSAGEæ˜¯å¯¹GCNçš„ä¼˜åŒ–ï¼Œå…¶ä¸­SAGEæ˜¯sampleå’Œaggreageçš„ç¼©å†™ï¼Œä»åç§°æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºå®ƒä¸»è¦ä¼˜åŒ–çš„ä¸¤ä¸ªæ–¹å‘ï¼šå³é‡‡æ ·å’Œèšåˆ   </p>
<h4 id="é‡‡æ ·"><a href="#é‡‡æ ·" class="headerlink" title="é‡‡æ ·"></a>é‡‡æ ·</h4><p>GCNçš„è®­ç»ƒéœ€è¦å›¾çš„å…¨å±€ä¿¡æ¯ï¼ˆè¿æ¥çŸ©é˜µ$\tilde{L}_{sym}$ï¼‰ï¼Œå¯¹äºå¤ªå¤§çš„å›¾ï¼Œå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æˆ–è€…æ˜¾å­˜è¿›è¡Œè®­ç»ƒï¼Œå€Ÿé‰´DNNä¸­å¸¸ç”¨çš„æ‰¹é‡è®­ç»ƒæ–¹å¼ï¼ŒGCNä¹Ÿå¯ä»¥åˆ©ç”¨é‡‡æ ·æ¥è¿›è¡Œè®­ç»ƒï¼Œå®ƒçš„é‡‡æ ·ä¸»è¦å…³æ³¨ä¸¤æ–¹é¢ï¼š1ï¼‰<strong>é‡‡æ ·è®­ç»ƒèŠ‚ç‚¹</strong>ï¼šç”±äºGCNæ¯å¢åŠ ä¸€å±‚ï¼ŒèŠ‚ç‚¹æ‰€åˆ©ç”¨åˆ°çš„é‚»å±…ä¿¡æ¯å°±è¦å¾€å¤–æ‰©å±•ä¸€å±‚ï¼Œæ‰€ä»¥å¯¹äº$k$å±‚çš„GCNç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦æ¯ä¸ªè®­ç»ƒèŠ‚ç‚¹çš„$k$é˜¶å­å›¾æ ·æœ¬ï¼›2ï¼‰<strong>é‡‡æ ·é‚»å±…èŠ‚ç‚¹</strong>ï¼šå¦å¤–ï¼Œç”±äºæŸäº›è¶…çº§èŠ‚ç‚¹ï¼ˆåº¦ç‰¹åˆ«å¤§çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚å¹³å‡åº¦ä¸º10çš„å›¾ï¼ŒæŸäº›èŠ‚ç‚¹çš„åº¦å¯èƒ½ä¼šæœ‰100Wï¼‰å­˜åœ¨ï¼Œä¹Ÿæœ‰é€ æˆOOMçš„é£é™©ï¼Œå¯¹äº$k$é˜¶å­å›¾çš„è§„æ¨¡ä¹Ÿè¦è¿›è¡Œæ§åˆ¶ï¼Œè¿™å¯ä»¥é€šè¿‡é™åˆ¶æ¯å±‚é‚»å±…èŠ‚ç‚¹æ•°é‡æ¥æ§åˆ¶ï¼Œå¦‚ä¸‹å›¾ç¬¬ä¸€å±‚é‡‡æ ·äº†3ä¸ªèŠ‚ç‚¹ï¼Œç¬¬äºŒå±‚é‡‡æ ·äº†2ä¸ªèŠ‚ç‚¹ï¼ˆæœ‰æ”¾å›é‡‡æ ·ï¼‰<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829201055183.png" alt=""></p>
<h4 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h4><p>è¿™ä¸€éƒ¨åˆ†å…¶å®éƒ½æ˜¯å€Ÿé‰´çš„DNNä¸­çš„å¸¸è§æ“ä½œï¼Œæ¯”å¦‚å–å¹³å‡/æ±‚å’Œ/æ± åŒ–ç­‰ç­‰ï¼Œè¿™é‡Œå¯ä»¥è‡ªå·±è®¾è®¡ï¼Œéœ€è¦æ»¡è¶³ä¸¤ç‚¹ï¼š1ï¼‰ä¸å¯¹ä¸åŒçš„é‚»å±…æ•°é‡ï¼Œéœ€è¦æœ‰ç›¸åŒç»´åº¦çš„è¾“å‡ºï¼Œæ¯”å¦‚$|Agg(v_1,v_2,v_3)|=|Agg(v_1,v_2)|$ï¼ˆ$|\cdot|$è¡¨ç¤ºç»´åº¦ï¼‰ï¼›2ï¼‰å¹³ç§»ä¸å˜æ€§ï¼Œå¯¹äºä¸åŒçš„è¾“å…¥é¡ºåºéœ€è¦æœ‰ç›¸åŒçš„è¾“å‡ºï¼Œæ¯”å¦‚$|Agg(v_1,v_2)=Agg(v_2,v_1)|$ï¼Œæ¥ä¸‹æ¥å†åˆ©ç”¨ä¸Šé¢çš„ä¾‹å­æ¼”ç¤ºä¸€ä¸‹èšåˆè¿‡ç¨‹ï¼š  </p>
<blockquote>
<p>ï¼ˆ1ï¼‰é¦–å…ˆå°†è®­ç»ƒèŠ‚ç‚¹å‘¨å›´çš„3ä¸ªé‚»å±…ä¿¡æ¯èšåˆï¼Œå¾—åˆ°å›¾1ï¼›<br>ï¼ˆ2ï¼‰ç„¶åå†å°†3ä¸ªé‚»å±…çš„é‚»å±…ä¿¡æ¯èšåˆåˆ°é‚»å±…ï¼Œå¾—åˆ°å›¾2ï¼Œè¿™æ—¶ç¬¬ä¸€å±‚GCNå°±ç»“æŸäº†ï¼›<br>ï¼ˆ3ï¼‰æœ€åï¼Œå†æ¬¡å°†3ä¸ªé‚»å±…ä¿¡æ¯èšåˆåˆ°è®­ç»ƒèŠ‚ç‚¹ï¼Œå¾—åˆ°å›¾3ï¼Œç¬¬äºŒå±‚GCNç»“æŸã€‚   </p>
</blockquote>
<p>å…¶ä¸­ï¼Œæ·¡è“è‰²çš„ç‚¹ï¼Œè¡¨ç¤ºè¯¥æ¬¡æ“ä½œåä¸å†è¢«éœ€è¦çš„ç‚¹ï¼Œç²‰çº¢çš„ç‚¹è¡¨ç¤ºé‡‡æ ·ç‚¹ï¼Œçº¢è‰²å’Œæ©˜é»„è‰²åˆ†åˆ«è¡¨ç¤ºç¬¬ä¸€è½®GCNå’Œç¬¬äºŒè½®GCNèšåˆåçš„ç‚¹ï¼Œçº¢è‰²æœ‰å‘è¾¹è¡¨ç¤ºç¬¬ä¸€å±‚çš„GCNèšåˆï¼Œæ©˜é»„è‰²æœ‰å‘è¾¹è¡¨ç¤ºç¬¬äºŒå±‚çš„GCNèšåˆï¼Œæ— å‘è¾¹è¡¨ç¤ºä¸æ“ä½œ<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829201123170.png" alt=""></p>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.å‡†å¤‡æ•°æ®</span>
<span class="token keyword">from</span> code<span class="token punctuation">.</span>graph_sage <span class="token keyword">import</span> <span class="token operator">*</span>
data <span class="token operator">=</span> CoraData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data
x <span class="token operator">=</span> data<span class="token punctuation">.</span>x <span class="token operator">/</span> data<span class="token punctuation">.</span>x<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å½’ä¸€åŒ–æ•°æ®ï¼Œä½¿å¾—æ¯ä¸€è¡Œå’Œä¸º1</span>
train_index <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>data<span class="token punctuation">.</span>train_mask<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
train_label <span class="token operator">=</span> data<span class="token punctuation">.</span>y
test_index <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>data<span class="token punctuation">.</span>test_mask<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using Cached file: E:\datas\Algs\GNN\cora\ch7_cached.pkl</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.è®­ç»ƒæ¨¡å‹</span>
INPUT_DIM <span class="token operator">=</span> <span class="token number">1433</span>  <span class="token comment" spellcheck="true"># è¾“å…¥ç»´åº¦</span>
<span class="token comment" spellcheck="true"># Note: é‡‡æ ·çš„é‚»å±…é˜¶æ•°éœ€è¦ä¸GCNçš„å±‚æ•°ä¿æŒä¸€è‡´</span>
HIDDEN_DIM <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># éšè—å•å…ƒèŠ‚ç‚¹æ•°</span>
NUM_NEIGHBORS_LIST <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># æ¯é˜¶é‡‡æ ·é‚»å±…çš„èŠ‚ç‚¹æ•°</span>
BTACH_SIZE <span class="token operator">=</span> <span class="token number">16</span>  <span class="token comment" spellcheck="true"># æ‰¹å¤„ç†å¤§å°</span>
EPOCHS <span class="token operator">=</span> <span class="token number">100</span>
NUM_BATCH_PER_EPOCH <span class="token operator">=</span> <span class="token number">20</span>  <span class="token comment" spellcheck="true"># æ¯ä¸ªepochå¾ªç¯çš„æ‰¹æ¬¡æ•°</span>
LEARNING_RATE <span class="token operator">=</span> <span class="token number">0.01</span>  <span class="token comment" spellcheck="true"># å­¦ä¹ ç‡</span>
DEVICE <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span>
model <span class="token operator">=</span> GraphSage<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>INPUT_DIM<span class="token punctuation">,</span> hidden_dim<span class="token operator">=</span>HIDDEN_DIM<span class="token punctuation">,</span>
                      num_neighbors_list<span class="token operator">=</span>NUM_NEIGHBORS_LIST<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>LEARNING_RATE<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">5e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>GraphSage(
    in_features=1433, num_neighbors_list=[10, 10]
    (gcn): ModuleList(
    (0): SageGCN(
        in_features=1433, out_features=64, aggr_hidden_method=sum
        (aggregator): NeighborAggregator(in_features=1433, out_features=64, aggr_method=mean)
    )
    (1): SageGCN(
        in_features=64, out_features=7, aggr_hidden_method=sum
        (aggregator): NeighborAggregator(in_features=64, out_features=7, aggr_method=mean)
    )
    )
)</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> e <span class="token keyword">in</span> range<span class="token punctuation">(</span>EPOCHS<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> batch <span class="token keyword">in</span> range<span class="token punctuation">(</span>NUM_BATCH_PER_EPOCH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        batch_src_index <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>BTACH_SIZE<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        batch_src_label <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>train_label<span class="token punctuation">[</span>batch_src_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span>
        batch_sampling_result <span class="token operator">=</span> multihop_sampling<span class="token punctuation">(</span>batch_src_index<span class="token punctuation">,</span> NUM_NEIGHBORS_LIST<span class="token punctuation">,</span> data<span class="token punctuation">.</span>adjacency_dict<span class="token punctuation">)</span>
        batch_sampling_x <span class="token operator">=</span> <span class="token punctuation">[</span>torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span> <span class="token keyword">for</span> idx <span class="token keyword">in</span> batch_sampling_result<span class="token punctuation">]</span>
        batch_train_logits <span class="token operator">=</span> model<span class="token punctuation">(</span>batch_sampling_x<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>batch_train_logits<span class="token punctuation">,</span> batch_src_label<span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># åå‘ä¼ æ’­è®¡ç®—å‚æ•°çš„æ¢¯åº¦</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•è¿›è¡Œæ¢¯åº¦æ›´æ–°</span>
<span class="token comment" spellcheck="true">#         print("Epoch {:03d} Batch {:03d} Loss: {:.4f}".format(e, batch, loss.item()))</span>
    <span class="token comment" spellcheck="true"># test</span>
    model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        test_sampling_result <span class="token operator">=</span> multihop_sampling<span class="token punctuation">(</span>test_index<span class="token punctuation">,</span> NUM_NEIGHBORS_LIST<span class="token punctuation">,</span> data<span class="token punctuation">.</span>adjacency_dict<span class="token punctuation">)</span>
        test_x <span class="token operator">=</span> <span class="token punctuation">[</span>torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span> <span class="token keyword">for</span> idx <span class="token keyword">in</span> test_sampling_result<span class="token punctuation">]</span>
        test_logits <span class="token operator">=</span> model<span class="token punctuation">(</span>test_x<span class="token punctuation">)</span>
        test_label <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>data<span class="token punctuation">.</span>y<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span>
        predict_y <span class="token operator">=</span> test_logits<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        accuarcy <span class="token operator">=</span> torch<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>predict_y<span class="token punctuation">,</span> test_label<span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#         print("Test Accuracy: ", accuarcy)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.æŸ¥çœ‹æ•ˆæœ</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> manifold
tsne <span class="token operator">=</span> manifold<span class="token punctuation">.</span>TSNE<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>init<span class="token operator">=</span><span class="token string">"pca"</span><span class="token punctuation">)</span>
X_tsne <span class="token operator">=</span> tsne<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
total_sampling_result <span class="token operator">=</span> multihop_sampling<span class="token punctuation">(</span>list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NUM_NEIGHBORS_LIST<span class="token punctuation">,</span> data<span class="token punctuation">.</span>adjacency_dict<span class="token punctuation">)</span>
total_x <span class="token operator">=</span> <span class="token punctuation">[</span>torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span> <span class="token keyword">for</span> idx <span class="token keyword">in</span> total_sampling_result<span class="token punctuation">]</span>
pred <span class="token operator">=</span> model<span class="token punctuation">(</span>total_x<span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_min<span class="token punctuation">,</span> x_max <span class="token operator">=</span> X_tsne<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> X_tsne<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
X_norm <span class="token operator">=</span> <span class="token punctuation">(</span>X_tsne <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å½’ä¸€åŒ–</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>c<span class="token operator">=</span>pred<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_5_0-16302390215222.png" alt=""></p>
<h2 id="GAT"><a href="#GAT" class="headerlink" title="GAT"></a>GAT</h2><h3 id="GATåŸç†"><a href="#GATåŸç†" class="headerlink" title="GATåŸç†"></a>GATåŸç†</h3><p><strong>1.Attentionæ˜¯ä»€ä¹ˆï¼Ÿ</strong>   </p>
<p>GATæ˜¯Graph Attention Networksçš„ç®€ç§°ï¼Œå³å›¾æ³¨æ„åŠ›ç½‘ç»œï¼Œå€Ÿé‰´äºDNNçš„å‘å±•ï¼Œå°†Attentionåº”ç”¨äºå›¾ç½‘ç»œæ˜¯å¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œåœ¨åŸå§‹çš„GCNä¸­ï¼Œæˆ‘ä»¬å¯¹ä¿©èŠ‚ç‚¹$v_i,v_j$èšåˆæ—¶ï¼Œä¼šè®¾ç½®å®ƒä»¬çš„æƒé‡ä¸ºï¼š<br>$$<br>w_{ij}=\frac{1}{\sqrt{d(v_i)}\sqrt{d(v_j)}}<br>$$</p>
<p>è€ŒAttentionæœºåˆ¶è®¤ä¸ºï¼Œè¿™ä¸ªæƒé‡åº”è¯¥ç”±ç®—æ³•è‡ªå·±å»å­¦ä¹ ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºçš„æŒ‡å®šï¼Œæ‰€ä»¥åœ¨Attentionæœºåˆ¶ä¸‹ï¼Œæƒé‡å¯ä»¥è¢«å®šä¹‰ä¸ºå¦‚ä¸‹è¡¨è¾¾ï¼š   </p>
<p>$$<br>w_{i,j}=Attention(h_i,h_j,W)<br>$$</p>
<p>è¿™é‡Œï¼Œ$h_i,h_j$åˆ†åˆ«ä¸º$v_i,v_j$åœ¨å½“å‰å±‚çš„å‘é‡è¡¨ç¤ºï¼Œ$W$æ˜¯å¾…å­¦ä¹ å‚æ•°ï¼Œ$Attention(h_i,h_j,W)$è¾“å‡ºä¸€ä¸ªæ ‡é‡å€¼ï¼Œæ‰€ä»¥ä»»æ„æ»¡è¶³ä¸Šé¢å®šä¹‰çš„è¡¨è¾¾å¼éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§Attentionï¼Œæœ€ç®€å•çš„å°±æ˜¯$h_i,h_j$å‘é‡åšå†…ç§¯ï¼š$&lt;h_i,h_j&gt;$    </p>
<p><strong>2. GATä¸­çš„Attention</strong>  </p>
<p>å®ƒçš„å®šä¹‰å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š   </p>
<p>$$<br>e_{ij}=LeakyReLU(a^T[Wh_i||Wh_j])\<br>w_{ij}=\frac{exp(e_{ij})}{\sum_{k\in N(v_i)exp(e_{ik})}}<br>$$</p>
<p>é¦–å…ˆï¼Œ$h_i,h_j$é€šè¿‡çŸ©é˜µ$W$è¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œç„¶åé€šè¿‡$||$æ“ä½œç¬¦å°†ä¿©å‘é‡æ‹¼æ¥æˆä¸€ä¸ªå‘é‡ï¼Œæ¥ä¸‹æ¥ä¸ä¸€ä¸ªåŒç»´åº¦å‘é‡$a$åšå†…ç§¯ï¼Œæœ€åé€šè¿‡éçº¿æ€§æ¿€æ´»å‡½æ•°$LeakyReLU$å¾—åˆ°ä¸€ä¸ªæ ‡é‡$e_{ij}$ï¼Œç„¶åå¯¹å…¶è¿›è¡Œsoftmaxå½’ä¸€åŒ–å¾—åˆ°æœ€ç»ˆçš„æƒé‡å€¼ï¼ŒæŒ‰ç…§åŠ æƒæ±‚å’Œçš„æ€è·¯ï¼ŒèŠ‚ç‚¹$v_i$çš„æ–°ç‰¹å¾å‘é‡ä¸ºï¼š   </p>
<p>$$<br>hâ€™<em>i=\sigma(\sum</em>{j\in N(v_i)}w_{ij} Wh_j)<br>$$</p>
<p>é€šå¸¸æˆ‘ä»¬ä¼šå°†å•ä¸ªattentionè¿‡ç¨‹ï¼Œç‹¬ç«‹åšå¤šæ¬¡ï¼ˆä¸åŒçš„$W,a$ï¼‰ï¼Œç„¶åå°†æœ€ç»ˆå¾—åˆ°çš„å¤šä¸ªæ–°ç‰¹å¾å‘é‡æ‹¼æ¥èµ·æ¥ï¼ˆå¤šå¤´æ³¨æ„åŠ›ï¼‰ä½œä¸ºæœ€ç»ˆçš„æ–°ç‰¹å¾å‘é‡</p>
<h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> code<span class="token punctuation">.</span>gat <span class="token keyword">import</span> <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.åŠ è½½æ•°æ®</span>
dataset <span class="token operator">=</span> CoraData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data
<span class="token comment" spellcheck="true">#å¦‚æœæœ‰GPUåˆ™ä½¿ç”¨GPU</span>
device <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span>
<span class="token comment" spellcheck="true">#æ¥ç€é¢„å¤„ç†å‰©ä¸‹çš„æ•°æ®</span>
x <span class="token operator">=</span> dataset<span class="token punctuation">.</span>x <span class="token operator">/</span> dataset<span class="token punctuation">.</span>x<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># å½’ä¸€åŒ–æ•°æ®ï¼Œä½¿å¾—æ¯ä¸€è¡Œå’Œä¸º1</span>
tensor_x <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_y <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_train_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>trn_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_val_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>val_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor_test_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>test_mask<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
normalize_adjacency <span class="token operator">=</span> dataset<span class="token punctuation">.</span>adjacency
<span class="token comment" spellcheck="true"># è§„èŒƒåŒ–é‚»æ¥çŸ©é˜µ</span>
indices <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span><span class="token punctuation">[</span>normalize_adjacency<span class="token punctuation">.</span>row<span class="token punctuation">,</span> normalize_adjacency<span class="token punctuation">.</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span>
values <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>normalize_adjacency<span class="token punctuation">.</span>data<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
tensor_adjacency <span class="token operator">=</span> torch<span class="token punctuation">.</span>sparse<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>indices<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2708</span><span class="token punctuation">,</span> <span class="token number">2708</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using Cached file: E:\datas\Algs\GNN\cora\processed_cora.pkl<br>Cached file: E:\datas\Algs\GNN\cora\processed_cora.pkl</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.æ„å»ºæ¨¡å‹</span>
model <span class="token operator">=</span> GAT<span class="token punctuation">(</span><span class="token number">1433</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.è®­ç»ƒæ¨¡å‹</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.1</span>
weight_decay <span class="token operator">=</span> <span class="token number">5e</span><span class="token operator">-</span><span class="token number">4</span>
epochs <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment" spellcheck="true"># æŸå¤±å‡½æ•°ä½¿ç”¨äº¤å‰ç†µ</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ä¼˜åŒ–å™¨ä½¿ç”¨Adam</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span>weight_decay<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># è®­ç»ƒ</span>
loss_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
val_acc_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> tensor_y<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># å‰å‘ä¼ æ’­</span>
    logits <span class="token operator">=</span> model<span class="token punctuation">(</span>tensor_x<span class="token punctuation">,</span>tensor_adjacency<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åªé€‰æ‹©è®­ç»ƒèŠ‚ç‚¹è¿›è¡Œç›‘ç£</span>
    train_mask_logits <span class="token operator">=</span> logits<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—æŸå¤±å€¼</span>
    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>train_mask_logits<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åå‘ä¼ æ’­è®¡ç®—å‚æ•°çš„æ¢¯åº¦</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•è¿›è¡Œæ¢¯åº¦æ›´æ–°</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#4.æŸ¥çœ‹æ•ˆæœ</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">,</span>category<span class="token operator">=</span>DeprecationWarning<span class="token punctuation">)</span>
<span class="token operator">%</span>matplotlib inline
<span class="token comment" spellcheck="true">#å¯¹Xç”¨tsneé™ç»´</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> manifold
tsne <span class="token operator">=</span> manifold<span class="token punctuation">.</span>TSNE<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>init<span class="token operator">=</span><span class="token string">"pca"</span><span class="token punctuation">)</span>
X_tsne <span class="token operator">=</span> tsne<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>tensor_x<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#é¢„æµ‹</span>
pred <span class="token operator">=</span> model<span class="token punctuation">(</span>tensor_x<span class="token punctuation">,</span>tensor_adjacency<span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#å½’ä¸€åŒ–æ˜¾ç¤º</span>
x_min<span class="token punctuation">,</span> x_max <span class="token operator">=</span> X_tsne<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> X_tsne<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
X_norm <span class="token operator">=</span> <span class="token punctuation">(</span>X_tsne <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_norm<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>c<span class="token operator">=</span>pred<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_6_0.png" alt=""></p>
<h2 id="DGL"><a href="#DGL" class="headerlink" title="DGL"></a>DGL</h2><h3 id="è¿è¡Œæœºåˆ¶"><a href="#è¿è¡Œæœºåˆ¶" class="headerlink" title="è¿è¡Œæœºåˆ¶"></a>è¿è¡Œæœºåˆ¶</h3><p>ä¸ºäº†æ›´åŠ é«˜æ•ˆçš„è¿è¡ŒGNNï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›é«˜æ•ˆçš„å›¾è®¡ç®—æ¡†æ¶å¸®åŠ©æˆ‘ä»¬è®­ç»ƒæ¨¡å‹ï¼ŒDGLï¼ˆDeep Graph Libraryï¼‰ä¾¿æ˜¯ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„æ¡†æ¶ï¼Œå®ƒå°†æ‰€æœ‰çš„å›¾è®¡ç®—è¿‡ç¨‹æ‹†åˆ†ä¸ºäº†ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼Œåˆ†åˆ«ä»‹ç»å¦‚ä¸‹ï¼š   </p>
<p><strong>1.1 æ¶ˆæ¯ä¼ é€’å‡½æ•°</strong><br>è¯¥å‡½æ•°æ˜¯å°†ä¸€æ¡è¾¹ä»¥åŠä¸å…¶å…³è”çš„ä¸¤ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯è¿›è¡Œèšåˆï¼Œç„¶åå°†èšåˆå<strong>æ¶ˆæ¯</strong>é‡æ–°èµ‹å€¼åˆ°è¾¹ä¸Šï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„è¡¨è¾¾å¼æŠ½è±¡è¡¨è¾¾ï¼š   </p>
<p>$$<br>m_{uv}^{(t+1)}=\phi(x_u^{(t)},x_v^{(t)},w_{uv}^{(t)})<br>$$</p>
<p>å…¶ä¸­ï¼Œ$w_{uv}^{(t)}$è¡¨ç¤ºè¾¹$(u,v)$ä¸Šçš„ç‰¹å¾ï¼Œ$x_u^{(t)}$è¡¨ç¤ºèŠ‚ç‚¹$u$ä¸Šçš„ç‰¹å¾ï¼Œ$x_v^{(t)}$è¡¨ç¤ºèŠ‚ç‚¹$v$ä¸Šçš„ç‰¹å¾  </p>
<p><strong>1.2 èšåˆå‡½æ•°</strong><br>èšåˆå‡½æ•°æ˜¯å°†ä¸è®­ç»ƒèŠ‚ç‚¹å…³è”çš„è¾¹ä¸Šçš„æ¶ˆæ¯ï¼Œè¿›è¡Œèšåˆï¼š    </p>
<p>$$<br>\rho_u^{t+1}=\rho({m_{uk}^{(t+1)}\mid k\in N(u)})<br>$$</p>
<p>è¿™é‡Œï¼Œ$N(u)$è¡¨ç¤ºä¸èŠ‚ç‚¹$u$ç›¸è¿çš„é‚»å±…èŠ‚ç‚¹   </p>
<p><strong>1.3 æ›´æ–°å‡½æ•°</strong><br>æ›´æ–°å‡½æ•°çš„ä½œç”¨æ˜¯å°†èšåˆç‰¹å¾ä¸èŠ‚ç‚¹çš„æ—§ç‰¹å¾è¿›è¡Œèšåˆï¼Œç„¶åç”ŸæˆèŠ‚ç‚¹çš„æ–°ç‰¹å¾ï¼š   </p>
<p>$$<br>x_u^{(t+1)}=\varphi(x_u^{(t)},\rho_u^{t+1})<br>$$</p>
<p>æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„GCNï¼ŒGATï¼ŒGraphSAGEä¾¿å¯åˆ†è§£ä¸ºè¿™ä¸‰ä¸ªåŸºæœ¬æ“ä½œå‡½æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘åˆ©ç”¨DGLåº“æ¼”ç¤ºä¸€ä¸‹è¿™3ä¸ªåŸºæœ¬æ“ä½œ</p>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p><strong>2.1 æ„å›¾</strong>ï¼šé¦–å…ˆæ„å»ºä¸€å¼ å›¾ï¼Œå¹¶ä¸ºèŠ‚ç‚¹å’Œè¾¹èµ‹å€¼</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> dgl
<span class="token keyword">import</span> torch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<pre class="line-numbers language-python"><code class="language-python">u<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
v<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
g<span class="token operator">=</span>dgl<span class="token punctuation">.</span>graph<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#è½¬æ¢ä¸ºnetworkxå¯è§†åŒ–</span>
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>g<span class="token punctuation">.</span>to_networkx<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/ML/output_4_0.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#åˆ†åˆ«ä¸ºèŠ‚ç‚¹å’Œè¾¹èµ‹å€¼ä¸€ä¸ªä¸‰ç»´çš„å‘é‡</span>
g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span class="token operator">=</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>g<span class="token punctuation">.</span>num_nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span>edata<span class="token punctuation">[</span><span class="token string">"ex"</span><span class="token punctuation">]</span><span class="token operator">=</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>g<span class="token punctuation">.</span>num_edges<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#æŸ¥çœ‹</span>
g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>g<span class="token punctuation">.</span>edata<span class="token punctuation">[</span><span class="token string">"ex"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>(tensor([[ 0.6239,  0.3987, -0.6238],
        [-0.7141, -1.0818, -1.0757],
        [-0.0540,  1.1078,  0.2700],
        [ 0.5681, -1.0023, -1.4963],
        [-1.3526, -0.5072,  0.3111],
        [ 0.4039,  0.1909,  2.4836],
        [ 0.2190,  0.9467, -0.6446],
        [-0.5860, -1.7527, -1.0872],
        [ 0.8450,  0.9458, -0.5495],
        [ 1.3140,  0.4514,  0.5442]]),
tensor([[-0.5180, -0.1497,  0.4278],
        [ 0.7970, -0.1222, -0.5810],
        [-0.9885,  0.7971, -1.0056],
        [-0.5377,  0.3229, -0.1410],
        [ 1.2062,  1.3272, -0.4768],
        [-0.6856,  0.9685, -1.3733],
        [ 1.0140, -0.1059,  1.4300],
        [-0.4088,  0.5824, -0.4151],
        [ 1.4490, -1.0892,  0.2116],
        [ 0.2986, -0.0652, -0.4363],
        [ 0.7020,  0.6645, -1.1004],
        [ 0.7326,  0.5491,  0.8222],
        [-0.5815, -1.3774,  0.7640],
        [ 1.1323, -1.4232,  0.2073],
        [-0.3632, -1.3108, -1.2507],
        [-0.7597, -1.1140,  0.2626],
        [-0.8476, -1.2887, -0.7922]]))</code></pre><p><strong>2.2 åˆ©ç”¨apply_edgesè¿›è¡Œæ¶ˆæ¯ä¼ é€’</strong>  </p>
<p>apply_edgeså¯ä»¥å®Œæˆç¬¬ä¸€ä¸ªå‡½æ•°çš„æ“ä½œï¼Œå³å°†ä¸¤èŠ‚ç‚¹ç‰¹å¾å’Œè¾¹ç‰¹å¾è¿›è¡ŒæŸç§æ“ä½œï¼Œç„¶åå°†ç»“æœä¿å­˜å›è¾¹ä¸Šï¼Œæˆ‘ä»¬å…ˆç”¨dglè‡ªå¸¦çš„apiï¼Œå°†$u,v$èŠ‚ç‚¹çš„ç‰¹å¾ç›¸åŠ ç„¶åèµ‹å€¼åˆ°è¾¹ä¸Š</p>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>u_add_v<span class="token punctuation">(</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"add_x"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#ç¬¬ä¸€ä¸ªnxè¡¨ç¤ºuä¸Šçš„nxç‰¹å¾ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºvä¸Šçš„nxç‰¹å¾ï¼Œadd_xè¡¨ç¤ºèµ‹å€¼åˆ°è¾¹ä¸Šçš„ç‰¹å¾</span>
g<span class="token punctuation">.</span>edata<span class="token punctuation">[</span><span class="token string">"add_x"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[-0.0902, -0.6831, -1.6995],        [ 0.5699,  1.5065, -0.3538],        [ 1.1919, -0.6036, -2.1202],        [-0.7288, -0.1085, -0.3128],        [-0.7681,  0.0260, -0.8057],        [-0.1461, -2.0841, -2.5721],        [-1.4066,  0.6007,  0.5811],        [-0.7846, -1.5095, -1.1853],        [ 0.3500,  1.2987,  2.7536],        [-0.9487, -0.3163,  2.7946],        [ 0.6229,  1.1375,  1.8389],        [-0.1821, -1.5618,  1.3964],        [-0.3670, -0.8060, -1.7318],        [ 1.0640,  1.8925, -1.1941],        [ 1.5330,  1.3981, -0.1005],        [ 0.2589, -0.8069, -1.6367],        [ 2.1590,  1.3972, -0.0053]])</code></pre><p>è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ä»¥å†™è‡ªå®šä¹‰å‡½æ•°è¿›è¡Œæ“ä½œ</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">message_func</span><span class="token punctuation">(</span>edges<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'new_add_x'</span><span class="token punctuation">:</span> edges<span class="token punctuation">.</span>src<span class="token punctuation">[</span><span class="token string">'nx'</span><span class="token punctuation">]</span> <span class="token operator">+</span> edges<span class="token punctuation">.</span>dst<span class="token punctuation">[</span><span class="token string">'nx'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>message_func<span class="token punctuation">)</span>g<span class="token punctuation">.</span>edata<span class="token punctuation">[</span><span class="token string">"new_add_x"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[-0.0902, -0.6831, -1.6995],        [ 0.5699,  1.5065, -0.3538],        [ 1.1919, -0.6036, -2.1202],        [-0.7288, -0.1085, -0.3128],        [-0.7681,  0.0260, -0.8057],        [-0.1461, -2.0841, -2.5721],        [-1.4066,  0.6007,  0.5811],        [-0.7846, -1.5095, -1.1853],        [ 0.3500,  1.2987,  2.7536],        [-0.9487, -0.3163,  2.7946],        [ 0.6229,  1.1375,  1.8389],        [-0.1821, -1.5618,  1.3964],        [-0.3670, -0.8060, -1.7318],        [ 1.0640,  1.8925, -1.1941],        [ 1.5330,  1.3981, -0.1005],        [ 0.2589, -0.8069, -1.6367],        [ 2.1590,  1.3972, -0.0053]])</code></pre><p><strong>2.3 åˆ©ç”¨update_allç»„åˆæ¶ˆæ¯ä¼ é€’å‡½æ•°ä¸èšåˆå‡½æ•°</strong>  </p>
<p>update_allå°†æ¶ˆæ¯ä¼ é€’å’Œèšåˆå‡½æ•°ä¸€å¹¶è¿›è¡Œæ“ä½œï¼Œä¸‹é¢æ¼”ç¤ºå…ˆå°†é‚»å±…èŠ‚ç‚¹ç‰¹å¾åŠ åˆ°è¾¹ï¼Œç„¶åå†å°†è¾¹ç‰¹å¾åŠ åˆ°èŠ‚ç‚¹</p>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>update_all<span class="token punctuation">(</span>dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>u_add_v<span class="token punctuation">(</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"add_x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token string">"add_x"</span><span class="token punctuation">,</span><span class="token string">"add_edge_x"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"add_edge_x"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[ 0.0000,  0.0000,  0.0000],        [-0.0902, -0.6831, -1.6995],        [-0.1982,  1.5326, -1.1595],        [ 1.0459, -2.6876, -4.6922],        [-2.9200, -1.0173, -0.9170],        [-0.5987,  0.9824,  5.5482],        [ 0.6229,  1.1375,  1.8389],        [-0.5491, -2.3679, -0.3355],        [ 1.3229,  1.0856, -2.8309],        [ 3.6919,  2.7953, -0.1058]])</code></pre><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">reduce_func</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'new_add_edge_x'</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>mailbox<span class="token punctuation">[</span><span class="token string">'add_x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>update_all<span class="token punctuation">(</span>dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>u_add_v<span class="token punctuation">(</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"nx"</span><span class="token punctuation">,</span><span class="token string">"add_x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             reduce_func<span class="token punctuation">)</span>g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"new_add_edge_x"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[ 0.0000,  0.0000,  0.0000],        [-0.0902, -0.6831, -1.6995],        [-0.1982,  1.5326, -1.1595],        [ 1.0459, -2.6876, -4.6922],        [-2.9200, -1.0173, -0.9170],        [-0.5987,  0.9824,  5.5482],        [ 0.6229,  1.1375,  1.8389],        [-0.5491, -2.3679, -0.3355],        [ 1.3229,  1.0856, -2.8309],        [ 3.6919,  2.7953, -0.1058]])</code></pre><p><strong>2.3 æ›´æ–°å‡½æ•°ï¼šæœ€åç»„åˆèšåˆç‰¹å¾å’ŒåŸç‰¹å¾</strong><br>è¿™éƒ¨åˆ†æ“ä½œå°±å¾ˆå®¹æ˜“äº†ï¼Œå› ä¸ºèšåˆç‰¹å¾å’ŒåŸç‰¹å¾éƒ½åœ¨èŠ‚ç‚¹ä¸Šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ“ä½œå³å¯ï¼Œæ¯”å¦‚ç›¸åŠ </p>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[ 0.6239,  0.3987, -0.6238],
        [-0.7141, -1.0818, -1.0757],
        [-0.0540,  1.1078,  0.2700],
        [ 0.5681, -1.0023, -1.4963],
        [-1.3526, -0.5072,  0.3111],
        [ 0.4039,  0.1909,  2.4836],
        [ 0.2190,  0.9467, -0.6446],
        [-0.5860, -1.7527, -1.0872],
        [ 0.8450,  0.9458, -0.5495],
        [ 1.3140,  0.4514,  0.5442]])</code></pre><pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span class="token operator">=</span>g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span class="token operator">+</span>g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"add_edge_x"</span><span class="token punctuation">]</span>
g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"nx"</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#æ³¨æ„ä»ç¬¬äºŒè¡Œå¼€å§‹çœ‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([[ 0.6239,  0.3987, -0.6238],
        [-0.8044, -1.7649, -2.7753],
        [-0.2522,  2.6404, -0.8895],
        [ 1.6139, -3.6899, -6.1886],
        [-4.2726, -1.5244, -0.6059],
        [-0.1948,  1.1733,  8.0318],
        [ 0.8419,  2.0842,  1.1943],
        [-1.1352, -4.1206, -1.4227],
        [ 2.1679,  2.0314, -3.3804],
        [ 5.0059,  3.2467,  0.4384]])</code></pre><h3 id="PageRankç®—æ³•"><a href="#PageRankç®—æ³•" class="headerlink" title="PageRankç®—æ³•"></a>PageRankç®—æ³•</h3><p>å…³äºPageRankçš„åŸç†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ<a href="https://nbviewer.jupyter.org/github/zhulei227/ML_Notes/blob/master/notebooks/12_07_PGM_%E9%A9%AC%E5%B0%94%E7%A7%91%E5%A4%AB%E9%93%BE_PageRank%E7%AE%97%E6%B3%95.ipynb" target="_blank" rel="noopener">&gt;&gt;note</a><br><img src="/images/loading.gif" data-original="../images/ML/image-20210829201724741.png" alt=""></p>
<p>å¦‚å›¾ï¼Œä»¥èŠ‚ç‚¹Aä¸¾ä¾‹ï¼Œä»–çš„PRæ›´æ–°å…¬ç¤ºå¯ä»¥è¡¨ç¤ºä¸ºï¼š   </p>
<p>$$<br>PR_A^{(t+1)}=w_{BA}PR_B^{(t)}+w_{CA}PR_C^{(t)}<br>$$</p>
<p>è¿™é‡Œï¼Œ$w_{BA}$è¡¨ç¤ºè¾¹$(B,A)$ä¸Šçš„æƒé‡ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ºèŠ‚ç‚¹$B$çš„å‡ºåº¦çš„å€’æ•°ï¼Œè€Œ$PR_{*}$åˆ™è¡¨ç¤ºæŸèŠ‚ç‚¹çš„PRå€¼ï¼Œä¸‹é¢åˆ©ç”¨DGLæ¥è®¡ç®—PRï¼ŒèŠ‚ç‚¹ç¼–å·0 ~ 3åˆ†åˆ«å¯¹åº”ä¸Šé¢çš„èŠ‚ç‚¹A ~ D</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> dgl
<span class="token keyword">import</span> torch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<p><strong>æ„å»ºå›¾</strong></p>
<pre class="line-numbers language-python"><code class="language-python">u<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
v<span class="token operator">=</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
g<span class="token operator">=</span>dgl<span class="token punctuation">.</span>graph<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>è®¡ç®—è¾¹æƒé‡</strong></p>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"out_degrees"</span><span class="token punctuation">]</span><span class="token operator">=</span>g<span class="token punctuation">.</span>out_degrees<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">message_func</span><span class="token punctuation">(</span>edges<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"weight"</span><span class="token punctuation">:</span><span class="token number">1.0</span><span class="token operator">/</span>edges<span class="token punctuation">.</span>src<span class="token punctuation">[</span><span class="token string">"out_degrees"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
g<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>message_func<span class="token punctuation">)</span>
g<span class="token punctuation">.</span>edata<span class="token punctuation">[</span><span class="token string">"weight"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([0.3333, 0.3333, 0.3333, 0.5000, 0.5000, 1.0000, 0.5000, 0.5000])</code></pre><p><strong>è®¡ç®—PR</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#éšæœºåˆå§‹åŒ–ä¸€ç»„PR</span>
prs<span class="token operator">=</span>torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
prs<span class="token operator">=</span>prs<span class="token operator">/</span>torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>prs<span class="token punctuation">)</span>
prs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([0.1702, 0.3912, 0.1391, 0.2994])</code></pre><pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"pr"</span><span class="token punctuation">]</span><span class="token operator">=</span>prs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    g<span class="token punctuation">.</span>update_all<span class="token punctuation">(</span>dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>u_dot_e<span class="token punctuation">(</span><span class="token string">"pr"</span><span class="token punctuation">,</span><span class="token string">"weight"</span><span class="token punctuation">,</span><span class="token string">"weighted_pr"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">#å°†æºèŠ‚ç‚¹ä¸Šçš„prä¸è¾¹ä¸Šçš„weightç›¸ä¹˜åæ”¾åˆ°è¾¹ä¸Šçš„weighted_prå˜é‡ä¸­</span>
                 dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token string">"weighted_pr"</span><span class="token punctuation">,</span><span class="token string">"pr"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å°†æ‰€æœ‰å…¥è¾¹ä¸Šçš„weighted_præ±‚å’Œåèµ‹å€¼åˆ°ç›®æ ‡èŠ‚ç‚¹çš„prå˜é‡ä¸­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"pr"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>tensor([0.3333, 0.2222, 0.2222, 0.2222])</code></pre><p>ä¸Šé¢çš„å®ç°ä¸å¤Ÿä¸¥è°¨ï¼Œä¸ºäº†é˜²æ­¢æ²¡æœ‰å‡ºåº¦æˆ–è€…æ²¡æœ‰å…¥åº¦çš„èŠ‚ç‚¹ï¼Œå…¶å®éœ€è¦åœ¨èšåˆçš„æ—¶å€™å†æ·»åŠ ä¸€ä¸ªå¹³æ»‘é¡¹ï¼ˆè§ä¸Šé¢é“¾æ¥ä¸­çš„noteï¼‰</p>
<h3 id="GCNçš„DGLå®ç°"><a href="#GCNçš„DGLå®ç°" class="headerlink" title="GCNçš„DGLå®ç°"></a>GCNçš„DGLå®ç°</h3><p>æˆ‘ä»¬å…ˆæ‹GCNå‡ºæ¥çœ‹çœ‹ï¼Œå¦‚ä½•å°†å…¶æ‹†åˆ†ä¸º3ä¸ªåŸºæœ¬å‡½æ•°çš„å½¢å¼ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹å®ƒçš„çŸ©é˜µæ›´æ–°å½¢å¼ï¼š   </p>
<p>$$<br>X^{(t+1)}=\sigma(\tilde{L}_{sym}X^{(t)}W^{(t)})<br>$$<br>æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ‹†è§£ï¼š   </p>
<p><strong>æ¶ˆæ¯ä¼ é€’å‡½æ•°</strong>   </p>
<p>$$<br>m_{uv}^{(t+1)}=\frac{X_{v,:}^{(t)}W^{(t)}}{\sqrt{d_u}\cdot \sqrt{d_v}}<br>$$</p>
<p>è¿™é‡Œï¼Œ$d_u,d_v$åˆ†åˆ«è¡¨ç¤ºèŠ‚ç‚¹$u,v$çš„åº¦ï¼Œ$X_{v,:}^{(t)}$è¡¨ç¤ºèŠ‚ç‚¹$v$çš„ç¬¬$t$å±‚çš„ç‰¹å¾å‘é‡ï¼ˆè¿™é‡Œæ˜¯è¡Œå‘é‡è¡¨ç¤ºï¼‰ï¼Œ$W^{(t)}$æ˜¯å®ƒåœ¨ç¬¬$t$å±‚çš„è®­ç»ƒå‚æ•°   </p>
<p><strong>èšåˆå‡½æ•°</strong><br>$$<br>\rho_u^{(t+1)}=\sum_{v\in N(u)}m_{uv}^{(t+1)}<br>$$</p>
<p>è¿™é‡Œï¼Œåªæ˜¯ç®€å•å°†æ¯æ¡è¾¹ä¸Šçš„æ¶ˆæ¯ç›¸åŠ   </p>
<p><strong>æ›´æ–°å‡½æ•°</strong><br>$$<br>X_{u,:}^{(t+1)}=\sigma(\rho_u^{(t+1)})<br>$$</p>
<p>å°±åœ¨èšåˆå‡½æ•°çš„åŸºç¡€ä¸Šç®€å•æ·»åŠ äº†ä¸€ä¸ªæ¿€æ´»å‡½æ•°å³å¯</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>åªéœ€è¦åœ¨ä¹‹å‰gcn.pyçš„åŸºç¡€ä¸Šä¿®æ”¹å³å¯ï¼Œä¸‹é¢è¯´ä¸‹ä¸»è¦ä¿®æ”¹çš„åœ°æ–¹    </p>
<p><strong>1 å°†è¿æ¥çŸ©é˜µä¿®æ”¹ä¸ºDGLGraph</strong>    </p>
<pre class="line-numbers language-python"><code class="language-python">    @staticmethod
    <span class="token keyword">def</span> <span class="token function">build_dgl_graph</span><span class="token punctuation">(</span>adj_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""æ ¹æ®é‚»æ¥è¡¨åˆ›å»ºé‚»æ¥çŸ©é˜µ"""</span>
        edge_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> key <span class="token keyword">in</span> adj_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            edge_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> key<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> adj_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">:</span>
                edge_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> item<span class="token punctuation">]</span><span class="token punctuation">)</span>
                edge_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">,</span> key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        u<span class="token punctuation">,</span> v <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> edge_index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> edge_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> dgl<span class="token punctuation">.</span>graph<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2 GraphConvolutionçš„Forwardä¿®æ”¹ä¸ºDGLå®ç°ï¼ˆæ ¸å¿ƒï¼‰</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GraphConvolution</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>GraphConvolution<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>input_dim <span class="token operator">=</span> input_dim
        self<span class="token punctuation">.</span>output_dim <span class="token operator">=</span> output_dim
        self<span class="token punctuation">.</span>use_bias <span class="token operator">=</span> use_bias
        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>output_dim<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>register_parameter<span class="token punctuation">(</span><span class="token string">'bias'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>reset_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reset_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>kaiming_uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>zeros_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bias<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">message_func</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> edges<span class="token punctuation">)</span><span class="token punctuation">:</span>
        message <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>
            edges<span class="token punctuation">.</span>src<span class="token punctuation">[</span><span class="token string">"in_feature"</span><span class="token punctuation">]</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>edges<span class="token punctuation">.</span>src<span class="token punctuation">[</span><span class="token string">'degree'</span><span class="token punctuation">]</span> <span class="token operator">*</span> edges<span class="token punctuation">.</span>dst<span class="token punctuation">[</span><span class="token string">'degree'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_bias<span class="token punctuation">:</span>
            message <span class="token operator">+=</span> self<span class="token punctuation">.</span>bias
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"m"</span><span class="token punctuation">:</span> message<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dgl_graph<span class="token punctuation">:</span> dgl<span class="token punctuation">.</span>graph<span class="token punctuation">,</span> input_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> dgl_graph<span class="token punctuation">.</span>local_scope<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            dgl_graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"in_feature"</span><span class="token punctuation">]</span> <span class="token operator">=</span> input_feature
            dgl_graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"degree"</span><span class="token punctuation">]</span> <span class="token operator">=</span> dgl_graph<span class="token punctuation">.</span>in_degrees<span class="token punctuation">(</span><span class="token punctuation">)</span>
            dgl_graph<span class="token punctuation">.</span>update_all<span class="token punctuation">(</span>
                self<span class="token punctuation">.</span>message_func<span class="token punctuation">,</span>
                dgl<span class="token punctuation">.</span>function<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token string">"m"</span><span class="token punctuation">,</span> <span class="token string">"neigh_sum"</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token keyword">return</span> dgl_graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">"neigh_sum"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> code<span class="token punctuation">.</span>gcn_dgl <span class="token keyword">import</span> <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.åŠ è½½æ•°æ®</span>
dataset <span class="token operator">=</span> CoraData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Using Cached file: E:\datas\Algs\GNN\cora\processed_cora_dgl.pkl<br>Cached file: E:\datas\Algs\GNN\cora\processed_cora_dgl.pkl</p>
<pre class="line-numbers language-python"><code class="language-python">dataset<span class="token punctuation">.</span>dgl_graph<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>Graph(num_nodes=2708, num_edges=24424,
        ndata_schemes={}
        edata_schemes={})</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#å¦‚æœæœ‰GPUåˆ™ä½¿ç”¨GPUdevice = "cuda" if torch.cuda.is_available() else "cpu"#æ¥ç€é¢„å¤„ç†å‰©ä¸‹çš„æ•°æ®x = dataset.x / dataset.x.sum(1, keepdims=True)# å½’ä¸€åŒ–æ•°æ®ï¼Œä½¿å¾—æ¯ä¸€è¡Œå’Œä¸º1tensor_x = torch.from_numpy(x).to(device)tensor_y = torch.from_numpy(dataset.y).to(device)tensor_train_mask = torch.from_numpy(dataset.trn_mask).to(device)tensor_val_mask = torch.from_numpy(dataset.val_mask).to(device)tensor_test_mask = torch.from_numpy(dataset.test_mask).to(device)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.æ„å»ºæ¨¡å‹model = GCNNet().to(device)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">accuracy</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">:</span>    model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        logits <span class="token operator">=</span> model<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>dgl_graph<span class="token punctuation">,</span> tensor_x<span class="token punctuation">)</span>        test_mask_logits <span class="token operator">=</span> logits<span class="token punctuation">[</span>mask<span class="token punctuation">]</span>        predict_y <span class="token operator">=</span> test_mask_logits<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        accuracy <span class="token operator">=</span> torch<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>predict_y<span class="token punctuation">,</span> tensor_y<span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> accuracy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.è®­ç»ƒæ¨¡å‹</span>
<span class="token comment" spellcheck="true"># è¶…å‚æ•°å®šä¹‰</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
weight_decay <span class="token operator">=</span> <span class="token number">5e</span><span class="token operator">-</span><span class="token number">4</span>
epochs <span class="token operator">=</span> <span class="token number">200</span>
<span class="token comment" spellcheck="true"># æŸå¤±å‡½æ•°ä½¿ç”¨äº¤å‰ç†µ</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ä¼˜åŒ–å™¨ä½¿ç”¨Adam</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span>weight_decay<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># è®­ç»ƒ</span>
trn_acc_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
val_acc_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> tensor_y<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># å‰å‘ä¼ æ’­</span>
    logits <span class="token operator">=</span> model<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>dgl_graph<span class="token punctuation">,</span> tensor_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åªé€‰æ‹©è®­ç»ƒèŠ‚ç‚¹è¿›è¡Œç›‘ç£</span>
    train_mask_logits <span class="token operator">=</span> logits<span class="token punctuation">[</span>tensor_train_mask<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—æŸå¤±å€¼</span>
    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>train_mask_logits<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># åå‘ä¼ æ’­è®¡ç®—å‚æ•°çš„æ¢¯åº¦</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•è¿›è¡Œæ¢¯åº¦æ›´æ–°</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—å½“å‰æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡</span>
    train_acc <span class="token operator">=</span> accuracy<span class="token punctuation">(</span>tensor_train_mask<span class="token punctuation">)</span>
    trn_acc_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_acc<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—å½“å‰æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„å‡†ç¡®ç‡</span>
    val_acc <span class="token operator">=</span> accuracy<span class="token punctuation">(</span>tensor_val_mask<span class="token punctuation">)</span>
    val_acc_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_acc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>val_acc_history<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>trn_acc_history<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'val acc'</span><span class="token punctuation">,</span><span class="token string">'trn acc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>&lt;matplotlib.legend.Legend at 0x1a3b8099f60&gt;</code></pre><p>â€‹<br><img src="/images/loading.gif" data-original="../images/ML/output_9_1.png" alt=""><br>â€‹    </p>
<h3 id="å¼‚è´¨å›¾RGCN-èŠ‚ç‚¹é¢„æµ‹"><a href="#å¼‚è´¨å›¾RGCN-èŠ‚ç‚¹é¢„æµ‹" class="headerlink" title="å¼‚è´¨å›¾RGCN_èŠ‚ç‚¹é¢„æµ‹"></a>å¼‚è´¨å›¾RGCN_èŠ‚ç‚¹é¢„æµ‹</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>æˆ‘ä»¬é€šå¸¸å¤„ç†çš„æ›´å¤šçš„è¿˜æ˜¯å¼‚æ„å›¾ï¼Œå¼‚æ„å›¾åŒ…å«äº†å¤šç§ç±»å‹çš„èŠ‚ç‚¹ä»¥åŠå¤šç§ç±»å‹çš„è¾¹ï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„GCN/GAT/SAGEç›®å‰éƒ½åªèƒ½åº”ç”¨äºåŒè´¨å›¾ï¼ˆåªæœ‰ä¸€ç§èŠ‚ç‚¹ç±»å‹ï¼Œä¸€ç§è¾¹ç±»å‹ï¼‰ï¼Œé‚£å¦‚ä½•å°†åŒè´¨å›¾çš„ç®—æ³•æ‰©å±•åˆ°å¼‚æ„å›¾å‘¢ï¼Ÿä¸€ç§é€šå¸¸çš„åšæ³•æ˜¯ï¼š  </p>
<blockquote>
<p>ï¼ˆ1ï¼‰å°†å¼‚æ„å›¾æŒ‰ç…§è¾¹çš„ç±»åˆ«å°†åˆ‡åˆ†ä¸ºå¤šä¸ªå­å›¾ï¼›<br>ï¼ˆ2ï¼‰ç„¶ååˆ†åˆ«åœ¨è¿™äº›å­å›¾ä¸Šè¿è¡Œå›¾ç®—æ³•ï¼›<br>ï¼ˆ3ï¼‰æœ€åå°†å„å­å›¾çš„ç»“æœå†è¿›è¡Œä¸€æ¬¡èšåˆ  </p>
</blockquote>
<p>ç›¸è¾ƒäºä¹‹å‰ï¼Œæˆ‘ä»¬å°±å†å¤šä¸€æ¬¡å¯¹å…³ç³»çš„èšåˆå³å¯ï¼š   </p>
<p>$$<br>h_{i}^{(t+1)}=AGG({GNN_r(h_i^{(t)})\mid r\in R})<br>$$</p>
<p>è¿™é‡Œï¼Œ$GNN_r(h_i^{(t)})$è¡¨è¾¾åœ¨å…³ç³»$r$ä¸Šå¯¹èŠ‚ç‚¹$h_i^{(t)}$è¿è¡Œç®—æ³•$GNN$åçš„ç»“æœï¼Œ$R$è¡¨ç¤ºæ‰€æœ‰å…³ç³»ï¼Œ$AGG(\cdot)$è¡¨ç¤ºå¯¹æ‰€æœ‰ç»“æœè¿›è¡ŒæŸç§èšåˆï¼Œæ¯”å¦‚max,mean,sumç­‰</p>
<h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ä¸‹é¢åˆ©ç”¨å®˜æ–¹çš„ç¤ºä¾‹ä»¥åŠAPIæ¼”ç¤ºå¦‚ä½•æ„é€ å¼‚æ„å›¾ï¼Œå¦‚ä½•æ„é€ RGCNï¼Œå¹¶å®ŒæˆèŠ‚ç‚¹åˆ†ç±»çš„ä»»åŠ¡  </p>
<p><strong>1 æ„é€ å¼‚æ„å›¾</strong>  </p>
<p>éšæœºæ„é€ äº†1000ä¸ªç”¨æˆ·ï¼Œ500ä¸ªå•†å“ï¼Œä»¥åŠç”¨æˆ·ä¸ç”¨æˆ·ä¹‹é—´çš„followå…³ç³»ï¼Œç”¨æˆ·ä¸å•†å“ä¹‹é—´çš„clickå’Œdislikeå…³ç³»</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> dgl

n_users <span class="token operator">=</span> <span class="token number">1000</span>
n_items <span class="token operator">=</span> <span class="token number">500</span>
n_follows <span class="token operator">=</span> <span class="token number">3000</span>
n_clicks <span class="token operator">=</span> <span class="token number">5000</span>
n_dislikes <span class="token operator">=</span> <span class="token number">500</span>
n_hetero_features <span class="token operator">=</span> <span class="token number">10</span>
n_user_classes <span class="token operator">=</span> <span class="token number">5</span>
n_max_clicks <span class="token operator">=</span> <span class="token number">10</span>

follow_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
follow_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
click_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
click_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
dislike_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>
dislike_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>

hetero_graph <span class="token operator">=</span> dgl<span class="token punctuation">.</span>heterograph<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'follow'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_src<span class="token punctuation">,</span> follow_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'followed-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_dst<span class="token punctuation">,</span> follow_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_src<span class="token punctuation">,</span> click_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'clicked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_dst<span class="token punctuation">,</span> click_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'dislike'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_src<span class="token punctuation">,</span> dislike_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'disliked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_dst<span class="token punctuation">,</span> dislike_src<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_items<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_users<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_max_clicks<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># åœ¨userç±»å‹çš„èŠ‚ç‚¹å’Œclickç±»å‹çš„è¾¹ä¸Šéšæœºç”Ÿæˆè®­ç»ƒé›†çš„æ©ç </span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<p><strong>2 æ„é€ æ¨¡å‹</strong>  </p>
<p>è¿™é‡Œå¯¹æ¯ç§å…³ç³»éƒ½è®­ç»ƒçš„GCNæ¨¡å‹ï¼Œç„¶åæ¯ç§å…³ç³»çš„ç»“æœé‡‡ç”¨sumè¿›è¡Œèšåˆ</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> dgl<span class="token punctuation">.</span>nn <span class="token keyword">as</span> dglnn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">RGCN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–HeteroGraphConvï¼Œin_featsæ˜¯è¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œout_featsæ˜¯è¾“å‡ºç‰¹å¾çš„ç»´åº¦ï¼Œaggregateæ˜¯èšåˆå‡½æ•°çš„ç±»å‹</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># è¾“å…¥æ˜¯èŠ‚ç‚¹çš„ç‰¹å¾å­—å…¸</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span>
        h <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> h<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        <span class="token keyword">return</span> h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>3 è®­ç»ƒæ¨¡å‹</strong></p>
<pre class="line-numbers language-python"><code class="language-python">model <span class="token operator">=</span> RGCN<span class="token punctuation">(</span>n_hetero_features<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> hetero_graph<span class="token punctuation">.</span>etypes<span class="token punctuation">)</span>
user_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
item_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
labels <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
train_mask <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span>

node_features <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span> user_feats<span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">:</span> item_feats<span class="token punctuation">}</span>

opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># ä½¿ç”¨æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾è¿›è¡Œå‰å‘ä¼ æ’­è®¡ç®—ï¼Œå¹¶æå–è¾“å‡ºçš„userèŠ‚ç‚¹åµŒå…¥</span>
    logits <span class="token operator">=</span> model<span class="token punctuation">(</span>hetero_graph<span class="token punctuation">,</span> node_features<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># è®¡ç®—æŸå¤±å€¼</span>
    loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>logits<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># è¿›è¡Œåå‘ä¼ æ’­è®¡ç®—</span>
    opt<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>1.8662775754928589
1.851954698562622
1.8382809162139893
1.8252463340759277
1.812849998474121</code></pre><h3 id="å¼‚è´¨å›¾RGCN-è¾¹é¢„æµ‹"><a href="#å¼‚è´¨å›¾RGCN-è¾¹é¢„æµ‹" class="headerlink" title="å¼‚è´¨å›¾RGCN_è¾¹é¢„æµ‹"></a>å¼‚è´¨å›¾RGCN_è¾¹é¢„æµ‹</h3><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>è¾¹çš„é¢„æµ‹æˆ‘ä»¬å¯ä»¥åŸºäºå®ƒæ‰€å…³è”çš„ä¿©èŠ‚ç‚¹æ¥è®¡ç®—ï¼Œå¯¹äºå•ä¸ªè¾“å‡ºé¢„æµ‹ï¼Œç­‰ä»·äºæˆ‘ä»¬éœ€è¦å®šä¹‰å¦‚ä¸‹çš„ä¸€ä¸ªå‡½æ•°ï¼š   </p>
<p>$$<br>score_{(i,j)}=g(h_i,h_j)<br>$$</p>
<p>å³æ„é€ ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¿©å‘é‡$h_i,h_j$ï¼ˆåˆ†åˆ«è¡¨ç¤ºä¿©èŠ‚ç‚¹ç‰¹å¾ï¼‰ï¼Œç„¶åè¾“å‡ºä¸€ä¸ªæ ‡é‡ï¼ˆè¡¨ç¤ºè¾¹çš„è¾“å‡ºï¼‰ï¼Œæœ€ç®€å•çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç§¯$&lt;h_i,h_j&gt;$ï¼Œæˆ–è€…å°†$h_i,h_j$æ‹¼æ¥åå†è¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢$w^T(h_i||h_j)$ï¼Œæˆ–è€…å°†$h_i,h_j$ç›¸åŠ åå†è¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢$w^T(h_i+h_j)$ï¼Œè¿™é‡Œå¯ä»¥æ˜¯ä»»æ„ä½ èƒ½æƒ³åˆ°çš„æ–¹å¼ï¼ˆä¸è¿‡è¦å¯å¯¼ï¼‰ï¼Œè€Œè¿™ä¸ªæ“ä½œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨dglçš„<strong>apply_edges</strong>è¿™ä¸ªapiæ¥å®ç°ï¼Œæ¯”å¦‚ä¸‹é¢åˆ†åˆ«å®ç°å†…ç§¯å’Œçº¿æ€§å˜æ¢çš„æ“ä½œ</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> dgl<span class="token punctuation">.</span>function <span class="token keyword">as</span> fn
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">class</span> <span class="token class-name">HeteroDotProductPredictor</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> graph<span class="token punctuation">.</span>local_scope<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span> <span class="token operator">=</span> h   <span class="token comment" spellcheck="true">#ä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰èŠ‚ç‚¹ç±»å‹çš„ 'h'èµ‹å€¼</span>
            graph<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>u_dot_v<span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> etype<span class="token operator">=</span>etype<span class="token punctuation">)</span>
            <span class="token keyword">return</span> graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span>etype<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span>
<span class="token keyword">class</span> <span class="token class-name">MLPPredictor</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_features<span class="token punctuation">,</span> out_classes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>W <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>in_features <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> out_classes<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">apply_edges</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> edges<span class="token punctuation">)</span><span class="token punctuation">:</span>
        h_u <span class="token operator">=</span> edges<span class="token punctuation">.</span>src<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span>
        h_v <span class="token operator">=</span> edges<span class="token punctuation">.</span>dst<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span>
        score <span class="token operator">=</span> self<span class="token punctuation">.</span>W<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>h_u<span class="token punctuation">,</span> h_v<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'score'</span><span class="token punctuation">:</span> score<span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> graph<span class="token punctuation">.</span>local_scope<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span> <span class="token operator">=</span> h   <span class="token comment" spellcheck="true">#ä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰èŠ‚ç‚¹ç±»å‹çš„ 'h'èµ‹å€¼</span>
            graph<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>self<span class="token punctuation">.</span>apply_edges<span class="token punctuation">,</span> etype<span class="token operator">=</span>etype<span class="token punctuation">)</span>
            <span class="token keyword">return</span> graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span>etype<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>Using backend: pytorch</code></pre><h4 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ä¸‹é¢ä¸å‰ä¸€èŠ‚çš„å®ç°ä¸€æ ·çš„å†…å®¹å°±ç›´æ¥è´´è¿›æ¥äº†</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> dgl

n_users <span class="token operator">=</span> <span class="token number">1000</span>
n_items <span class="token operator">=</span> <span class="token number">500</span>
n_follows <span class="token operator">=</span> <span class="token number">3000</span>
n_clicks <span class="token operator">=</span> <span class="token number">5000</span>
n_dislikes <span class="token operator">=</span> <span class="token number">500</span>
n_hetero_features <span class="token operator">=</span> <span class="token number">10</span>
n_user_classes <span class="token operator">=</span> <span class="token number">5</span>
n_max_clicks <span class="token operator">=</span> <span class="token number">10</span>

follow_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
follow_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
click_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
click_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
dislike_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>
dislike_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>

hetero_graph <span class="token operator">=</span> dgl<span class="token punctuation">.</span>heterograph<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'follow'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_src<span class="token punctuation">,</span> follow_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'followed-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_dst<span class="token punctuation">,</span> follow_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_src<span class="token punctuation">,</span> click_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'clicked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_dst<span class="token punctuation">,</span> click_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'dislike'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_src<span class="token punctuation">,</span> dislike_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'disliked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_dst<span class="token punctuation">,</span> dislike_src<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_items<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_users<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_max_clicks<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># åœ¨userç±»å‹çš„èŠ‚ç‚¹å’Œclickç±»å‹çš„è¾¹ä¸Šéšæœºç”Ÿæˆè®­ç»ƒé›†çš„æ©ç </span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> dgl<span class="token punctuation">.</span>nn <span class="token keyword">as</span> dglnn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token keyword">class</span> <span class="token class-name">RGCN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–HeteroGraphConvï¼Œin_featsæ˜¯è¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œout_featsæ˜¯è¾“å‡ºç‰¹å¾çš„ç»´åº¦ï¼Œaggregateæ˜¯èšåˆå‡½æ•°çš„ç±»å‹</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># è¾“å…¥æ˜¯èŠ‚ç‚¹çš„ç‰¹å¾å­—å…¸</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span>
        h <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> h<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        <span class="token keyword">return</span> h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨RGCNçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ„å»ºå¯¹è¾¹çš„é¢„æµ‹ä»»åŠ¡</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_features<span class="token punctuation">,</span> hidden_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rgcn <span class="token operator">=</span> RGCN<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> hidden_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pred <span class="token operator">=</span> HeteroDotProductPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>rgcn<span class="token punctuation">(</span>g<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#è¿™é‡Œå¾—åˆ°RGCNåå„èŠ‚ç‚¹çš„ç‰¹å¾</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pred<span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#ç„¶åæ±‚å¾—è¾¹çš„score</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¨¡å‹è®­ç»ƒ</p>
<pre class="line-numbers language-python"><code class="language-python">model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> hetero_graph<span class="token punctuation">.</span>etypes<span class="token punctuation">)</span>
user_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
item_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
label <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
train_mask <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span>
node_features <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span> user_feats<span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">:</span> item_feats<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pred <span class="token operator">=</span> model<span class="token punctuation">(</span>hetero_graph<span class="token punctuation">,</span> node_features<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">)</span>
    loss <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pred<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span> <span class="token operator">-</span> label<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>39.65708541870117<br>37.67030715942383<br>35.77607727050781<br>33.9720344543457<br>32.25625228881836</p>
<h3 id="é“¾æ¥é¢„æµ‹"><a href="#é“¾æ¥é¢„æµ‹" class="headerlink" title="é“¾æ¥é¢„æµ‹"></a>é“¾æ¥é¢„æµ‹</h3><h4 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é“¾æ¥é¢„æµ‹æ˜¯é¢„æµ‹è¾¹çš„å­˜åœ¨æ€§ï¼Œæ³¨æ„å®ƒä¸è¾¹é¢„æµ‹ä»»åŠ¡å¾ˆä¸åŒï¼Œè¾¹é¢„æµ‹æ˜¯å»é¢„æµ‹å·²å­˜åœ¨çš„è¾¹çš„å±æ€§ã€‚ä½†é€šè¿‡<strong>è´Ÿé‡‡æ ·</strong>çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å°†é“¾æ¥é¢„æµ‹çš„é—®é¢˜è½¬æ¢ä¸ºè¾¹é¢„æµ‹çš„é—®é¢˜ï¼Œå¯ä»¥çœ‹ä½œï¼š   </p>
<p>$$<br>é“¾æ¥é¢„æµ‹=è´Ÿé‡‡æ ·+è¾¹é¢„æµ‹<br>$$</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼Œå¦‚æœä¸¤èŠ‚ç‚¹é—´å­˜åœ¨è¾¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰è¯¥è¾¹ä¸Šçš„å±æ€§ä¸º1ï¼Œå¦‚æœä¸å­˜åœ¨è¾¹é‚£ä¹ˆæˆ‘ä»¬å®šä¹‰è¯¥è¾¹ä¸Šçš„å±æ€§ä¸º0ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é“¾æ¥é¢„æµ‹é—®é¢˜å°±è½¬æ¢ä¸ºäº†è¾¹ä¸Šçš„1/0é¢„æµ‹é—®é¢˜ï¼Œå¦‚æœä¿©èŠ‚ç‚¹ä¸Šçš„é¢„æµ‹å€¼é è¿‘1ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ï¼Œå¦‚æœé¢„æµ‹å€¼é è¿‘0ï¼Œå°±è®¤ä¸ºå®ƒä»¬ä¹‹é—´ä¸å­˜åœ¨è¾¹ã€‚ä½†æ˜¯â€œä¸å­˜åœ¨çš„è¾¹â€çš„é‡å¾€å¾€å¾ˆå¤§ï¼Œè¿™éœ€è¦è€ƒè™‘ä»»æ„ä¸¤ä¸¤ä¹‹é—´çš„è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨è´Ÿé‡‡æ ·ï¼Œä»æ‰€æœ‰ä¸å­˜åœ¨çš„è¾¹ä¸­éšæœºé‡‡æ ·éƒ¨åˆ†å‡ºæ¥è®­ç»ƒï¼Œå¦‚ä¸‹ç¤ºä¾‹å›¾ï¼š   </p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210829203046513.png" alt=""></p>
<p>å¯¹äºä¸Šé¢çš„å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥ç±»ä¼¼äºlogisticä»»åŠ¡ï¼Œä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼š<br>$$<br>L=-log\sigma(y_{u,v})-\sum{[1-log(y_{u,k})]\mid k\in P(u)}<br>$$</p>
<p>è¿™é‡Œï¼Œ$u,v$æ˜¯å­˜åœ¨è¿æ¥çš„ç‚¹ï¼Œ$P(u)$æ˜¯å¯¹$u$çš„è´Ÿé‡‡æ ·ç‚¹çš„é›†åˆï¼Œ$y_{u,v}$ç±»ä¼¼äºä¸Šä¸€èŠ‚è¾“å…¥ä¸¤å‘é‡ï¼Œè¾“å‡ºä¸€ä¸ªæ ‡é‡çš„å‡½æ•°ï¼Œæ¯”å¦‚åšå†…ç§¯ï¼Œè€Œ$\sigma(\cdot)$æ˜¯sigmoidå‡½æ•°ï¼Œå°†è¾“å‡ºçº¦æŸåœ¨(0,1)ä¹‹é—´ï¼Œé™¤äº†äº¤å‰ç†µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©å…¶ä»–å‡½æ•°ï¼Œ<a href="https://docs.dgl.ai/guide_cn/training-link.html" target="_blank" rel="noopener">å‚è€ƒ&gt;&gt;</a></p>
<h4 id="å®ç°-4"><a href="#å®ç°-4" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>è¿™é‡Œéœ€è¦å®ç°çš„å†…å®¹å…¶å®ç›¸æ¯”ä¸Šä¸€èŠ‚ä¸»è¦å¤šäº†ä¸¤éƒ¨åˆ†å†…å®¹ï¼š<br>ï¼ˆ1ï¼‰ç¬¬ä¸€éƒ¨åˆ†æ˜¯å¤šäº†è´Ÿé‡‡æ ·ï¼›<br>ï¼ˆ2ï¼‰å¦ä¸€éƒ¨åˆ†æ˜¯éœ€è¦ä¿®æ”¹æŸå¤±å‡½æ•°çš„å®šä¹‰</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> dgl
<span class="token keyword">import</span> dgl<span class="token punctuation">.</span>nn <span class="token keyword">as</span> dglnn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> dgl<span class="token punctuation">.</span>function <span class="token keyword">as</span> fn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.ç”Ÿæˆå¼‚æ„å›¾</span>
n_users <span class="token operator">=</span> <span class="token number">1000</span>
n_items <span class="token operator">=</span> <span class="token number">500</span>
n_follows <span class="token operator">=</span> <span class="token number">3000</span>
n_clicks <span class="token operator">=</span> <span class="token number">5000</span>
n_dislikes <span class="token operator">=</span> <span class="token number">500</span>
n_hetero_features <span class="token operator">=</span> <span class="token number">10</span>
n_user_classes <span class="token operator">=</span> <span class="token number">5</span>
n_max_clicks <span class="token operator">=</span> <span class="token number">10</span>

follow_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
follow_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
click_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
click_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
dislike_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>
dislike_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>

hetero_graph <span class="token operator">=</span> dgl<span class="token punctuation">.</span>heterograph<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'follow'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_src<span class="token punctuation">,</span> follow_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'followed-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_dst<span class="token punctuation">,</span> follow_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_src<span class="token punctuation">,</span> click_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'clicked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_dst<span class="token punctuation">,</span> click_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'dislike'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_src<span class="token punctuation">,</span> dislike_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'disliked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_dst<span class="token punctuation">,</span> dislike_src<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_items<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_users<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_max_clicks<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># åœ¨userç±»å‹çš„èŠ‚ç‚¹å’Œclickç±»å‹çš„è¾¹ä¸Šéšæœºç”Ÿæˆè®­ç»ƒé›†çš„æ©ç </span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.å®šä¹‰æ¨¡å‹</span>
<span class="token keyword">class</span> <span class="token class-name">RGCN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–HeteroGraphConvï¼Œin_featsæ˜¯è¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œout_featsæ˜¯è¾“å‡ºç‰¹å¾çš„ç»´åº¦ï¼Œaggregateæ˜¯èšåˆå‡½æ•°çš„ç±»å‹</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> dglnn<span class="token punctuation">.</span>HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> dglnn<span class="token punctuation">.</span>GraphConv<span class="token punctuation">(</span>hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># è¾“å…¥æ˜¯èŠ‚ç‚¹çš„ç‰¹å¾å­—å…¸</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span>
        h <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> h<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>graph<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        <span class="token keyword">return</span> h


<span class="token keyword">class</span> <span class="token class-name">HeteroDotProductPredictor</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># hæ˜¯ä»5.1èŠ‚ä¸­å¯¹å¼‚æ„å›¾çš„æ¯ç§ç±»å‹çš„è¾¹æ‰€è®¡ç®—çš„èŠ‚ç‚¹è¡¨ç¤º</span>
        <span class="token keyword">with</span> graph<span class="token punctuation">.</span>local_scope<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            graph<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span> <span class="token operator">=</span> h
            graph<span class="token punctuation">.</span>apply_edges<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>u_dot_v<span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> etype<span class="token operator">=</span>etype<span class="token punctuation">)</span>
            <span class="token keyword">return</span> graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span>etype<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_features<span class="token punctuation">,</span> hidden_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sage <span class="token operator">=</span> RGCN<span class="token punctuation">(</span>in_features<span class="token punctuation">,</span> hidden_features<span class="token punctuation">,</span> out_features<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pred <span class="token operator">=</span> HeteroDotProductPredictor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">,</span> neg_g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>sage<span class="token punctuation">(</span>g<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pred<span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>pred<span class="token punctuation">(</span>neg_g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.å®šä¹‰è´Ÿé‡‡æ ·å‡½æ•°ï¼Œå°†è´Ÿæ ·æœ¬é‡‡æ ·ä¸ºå¦å¤–ä¸€å¼ å›¾</span>
<span class="token keyword">def</span> <span class="token function">construct_negative_graph</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> k<span class="token punctuation">,</span> etype<span class="token punctuation">)</span><span class="token punctuation">:</span>
    utype<span class="token punctuation">,</span> _<span class="token punctuation">,</span> vtype <span class="token operator">=</span> etype
    src<span class="token punctuation">,</span> dst <span class="token operator">=</span> graph<span class="token punctuation">.</span>edges<span class="token punctuation">(</span>etype<span class="token operator">=</span>etype<span class="token punctuation">)</span>
    neg_src <span class="token operator">=</span> src<span class="token punctuation">.</span>repeat_interleave<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
    neg_dst <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> graph<span class="token punctuation">.</span>num_nodes<span class="token punctuation">(</span>vtype<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">*</span> k<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dgl<span class="token punctuation">.</span>heterograph<span class="token punctuation">(</span>
        <span class="token punctuation">{</span>etype<span class="token punctuation">:</span> <span class="token punctuation">(</span>neg_src<span class="token punctuation">,</span> neg_dst<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        num_nodes_dict<span class="token operator">=</span><span class="token punctuation">{</span>ntype<span class="token punctuation">:</span> graph<span class="token punctuation">.</span>num_nodes<span class="token punctuation">(</span>ntype<span class="token punctuation">)</span> <span class="token keyword">for</span> ntype <span class="token keyword">in</span> graph<span class="token punctuation">.</span>ntypes<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#4.å®šä¹‰æŸå¤±å‡½æ•°</span>
<span class="token keyword">def</span> <span class="token function">compute_loss</span><span class="token punctuation">(</span>pos_score<span class="token punctuation">,</span> neg_score<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># é—´éš”æŸå¤±</span>
    n_edges <span class="token operator">=</span> pos_score<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> pos_score<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> neg_score<span class="token punctuation">.</span>view<span class="token punctuation">(</span>n_edges<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clamp<span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#5.è®­ç»ƒæ¨¡å‹</span>
k <span class="token operator">=</span> <span class="token number">5</span>
model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> hetero_graph<span class="token punctuation">.</span>etypes<span class="token punctuation">)</span>
user_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
item_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
node_features <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span> user_feats<span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">:</span> item_feats<span class="token punctuation">}</span>
opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    negative_graph <span class="token operator">=</span> construct_negative_graph<span class="token punctuation">(</span>hetero_graph<span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#è¿™é‡Œåªå¯¹"click"å…³ç³»è¿›è¡Œé¢„æµ‹</span>
    pos_score<span class="token punctuation">,</span> neg_score <span class="token operator">=</span> model<span class="token punctuation">(</span>hetero_graph<span class="token punctuation">,</span> negative_graph<span class="token punctuation">,</span> node_features<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    loss <span class="token operator">=</span> compute_loss<span class="token punctuation">(</span>pos_score<span class="token punctuation">,</span> neg_score<span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>1.327864170074463
1.3069148063659668
1.277003288269043
1.2585861682891846
1.246128797531128</code></pre><h3 id="æ•´å›¾é¢„æµ‹"><a href="#æ•´å›¾é¢„æµ‹" class="headerlink" title="æ•´å›¾é¢„æµ‹"></a>æ•´å›¾é¢„æµ‹</h3><h4 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>æ•´å›¾é¢„æµ‹æ˜¯é’ˆå¯¹å›¾å±‚é¢çš„å­¦ä¹ ä»»åŠ¡ï¼Œæ¯”å¦‚åˆ¤æ–­æŸè¯ç‰©åˆ†å­æ˜¯å¦å…·æœ‰æŸç§ç†åŒ–æ€§è´¨ï¼Œå†æ¯”å¦‚åˆ¤æ–­æŸç¤¾å›¢æ˜¯å¦å…·æœ‰æ¬ºè¯ˆå¯èƒ½ï¼Œè¿™éœ€è¦æˆ‘ä»¬å¯¹æ•´ä¸ªå›¾æå–å®ƒçš„ç‰¹å¾è¡¨ç¤ºï¼Œç„¶åå†åŸºäºæ­¤æ„å»ºæˆ‘ä»¬çš„å­¦ä¹ ä»»åŠ¡ï¼Œå›¾çš„æ•´ä½“ç‰¹å¾æ— å¤–ä¹æ¥æºäºä¸‰éƒ¨åˆ†ï¼š1ï¼‰èŠ‚ç‚¹ç‰¹å¾ï¼›2ï¼‰è¾¹ç‰¹å¾ï¼›3ï¼‰ç»“æ„ä¿¡æ¯ï¼ŒåŸºäºè¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¸å¤šæ–¹å¼æ¥æ„å»ºå›¾ç‰¹å¾ï¼ŒDGLæä¾›äº†ä¸€äº›ç®€å•çš„APIï¼Œæ¯”å¦‚å¯¹å„èŠ‚ç‚¹ç‰¹å¾æ±‚å’Œ/æ±‚å¹³å‡/poolingç­‰ï¼Œè¿™å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æ„å»ºä¸€äº›åŸºå‡†å›¾é¢„æµ‹æ¨¡å‹ï¼Œä¸‹é¢æˆ‘ä»¬åˆ©ç”¨å¯¹èŠ‚ç‚¹ç‰¹å¾æ±‚å¹³å‡çš„æ–¹å¼æ„å»ºå›¾ç‰¹å¾ï¼Œè¿™å¯ä»¥é€šè¿‡<code>dgl.mean_nodes</code>è¿™ä¸ªAPIå¾ˆæ–¹ä¾¿çš„å®ç°ï¼Œå®ƒç›¸å½“äºåšäº†å¦‚ä¸‹è®¡ç®—ï¼š    </p>
<p>$$<br>h_g=\frac{1}{|V|}\sum_{v\in V }h_v<br>$$</p>
<p>$h_v$è¡¨ç¤ºèŠ‚ç‚¹$v$çš„ç‰¹å¾ï¼Œç„¶ååŸºäº$h_g$ç‰¹å¾å‘é‡ï¼Œæ„å»ºæˆ‘ä»¬é¢„æµ‹æ¨¡å‹</p>
<h4 id="å®ç°-5"><a href="#å®ç°-5" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>åˆ©ç”¨dglè‡ªå¸¦çš„MiniGCDatasetæ•°æ®é›†ï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹çš„8ç§ç±»åˆ«çš„å›¾ç»“æ„<br><img src="/images/loading.gif" data-original="../images/ML/image-20210829203210021.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.å¯¼å…¥æ•°æ®</span>
<span class="token keyword">import</span> dgl
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> dgl<span class="token punctuation">.</span>data <span class="token keyword">import</span> MiniGCDataset
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx
<span class="token comment" spellcheck="true">#è¿™é‡Œï¼Œéšæœºæ„é€ äº†80ä¸ªå›¾ï¼Œæ¯ä¸ªå›¾æ˜¯å°‘10æ¡è¾¹ï¼Œæœ€å¤š30æ¡è¾¹</span>
dataset <span class="token operator">=</span> MiniGCDataset<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
graph<span class="token punctuation">,</span> label <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true">#ç»˜åˆ¶å›¾åƒ</span>
<span class="token operator">%</span>matplotlib inline
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
nx<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>graph<span class="token punctuation">.</span>to_networkx<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Class: {:d}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<p><img src="/images/loading.gif" data-original="../images/ML/output_2_1.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.å®šä¹‰æ¨¡å‹</span>
<span class="token keyword">from</span> dgl<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>pytorch <span class="token keyword">import</span> GraphConv
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">class</span> <span class="token class-name">Classifier</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">,</span> n_classes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>Classifier<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> GraphConv<span class="token punctuation">(</span>in_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> GraphConv<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classify <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> n_classes<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#çº¿æ€§åˆ†ç±»å™¨</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># ä»¥èŠ‚ç‚¹åº¦ä½œä¸ºåˆå§‹èŠ‚ç‚¹ç‰¹å¾ã€‚å¯¹äºæ— å‘å›¾ï¼Œå…¥åº¦ä¸å¤–åº¦ç›¸åŒã€‚</span>
        h <span class="token operator">=</span> g<span class="token punctuation">.</span>in_degrees<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># æ‰§è¡Œå›¾å½¢å·ç§¯å’Œæ¿€æ´»å‡½æ•°</span>
        h <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>g<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
        h <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>g<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
        g<span class="token punctuation">.</span>ndata<span class="token punctuation">[</span><span class="token string">'h'</span><span class="token punctuation">]</span> <span class="token operator">=</span> h

        <span class="token comment" spellcheck="true"># é€šè¿‡å¯¹æ‰€æœ‰èŠ‚ç‚¹è¡¨ç¤ºæ±‚å¹³å‡æ¥è®¡ç®—å›¾å½¢è¡¨ç¤ºã€‚</span>
        hg <span class="token operator">=</span> dgl<span class="token punctuation">.</span>mean_nodes<span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>hg<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.è®­ç»ƒ</span>
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader

<span class="token comment" spellcheck="true"># å°†å¤šå¼ å›¾åˆå¹¶ä¸ºä¸€å¼ å›¾</span>
<span class="token keyword">def</span> <span class="token function">collate</span><span class="token punctuation">(</span>samples<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># The input `samples` is a list of pairs (graph, label).</span>
    graphs<span class="token punctuation">,</span> labels <span class="token operator">=</span> map<span class="token punctuation">(</span>list<span class="token punctuation">,</span> zip<span class="token punctuation">(</span><span class="token operator">*</span>samples<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#æŠŠä¸€æ‰¹å›¾ zipæˆ åˆ—è¡¨å¯¹è±¡</span>
    batched_graph <span class="token operator">=</span> dgl<span class="token punctuation">.</span>batch<span class="token punctuation">(</span>graphs<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#åˆå¹¶ä¸ºä¸€å¼ å›¾</span>
    <span class="token keyword">return</span> batched_graph<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># è®­ç»ƒé›†/æµ‹è¯•é›†</span>
trainset <span class="token operator">=</span> MiniGCDataset<span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
testset <span class="token operator">=</span> MiniGCDataset<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#batchè®­ç»ƒ</span>
data_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>trainset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                         collate_fn<span class="token operator">=</span>collate<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># æ„å»ºæ¨¡å‹</span>
model <span class="token operator">=</span> Classifier<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> trainset<span class="token punctuation">.</span>num_classes<span class="token punctuation">)</span>

loss_func <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>

optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>

model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
epoch_losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    epoch_loss <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>bg<span class="token punctuation">,</span> label<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>data_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        prediction <span class="token operator">=</span> model<span class="token punctuation">(</span>bg<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> loss_func<span class="token punctuation">(</span>prediction<span class="token punctuation">,</span> label<span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
        epoch_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    epoch_loss <span class="token operator">/=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#     print('Epoch {}, loss {:.4f}'.format(epoch, epoch_loss))</span>
    epoch_losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>epoch_loss<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>epoch_losses<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>&lt;matplotlib.legend.Legend at 0x2658c2b9dd8&gt;</code></pre><p><img src="/images/loading.gif" data-original="../images/ML/output_4_1.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#4.æµ‹è¯•</span>
model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_X<span class="token punctuation">,</span> test_Y <span class="token operator">=</span> map<span class="token punctuation">(</span>list<span class="token punctuation">,</span> zip<span class="token punctuation">(</span><span class="token operator">*</span>testset<span class="token punctuation">)</span><span class="token punctuation">)</span>

test_bg <span class="token operator">=</span> dgl<span class="token punctuation">.</span>batch<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
test_Y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>test_Y<span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

pred_Y <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>model<span class="token punctuation">(</span>test_bg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Accuracy of argmax predictions on the test set: {:4f}%'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>
    <span class="token punctuation">(</span>test_Y <span class="token operator">==</span> pred_Y<span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> len<span class="token punctuation">(</span>test_Y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Accuracy of argmax predictions on the test set: 72.500000%</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#5.æŸ¥çœ‹æ··æ·†çŸ©é˜µ</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix
confusion_matrix<span class="token punctuation">(</span>test_Y<span class="token punctuation">,</span> pred_Y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>array([[10,  0,  0,  0,  0,  0,  0,  0],
    [ 0,  5,  0,  0,  3,  2,  0,  0],
    [ 0,  0, 10,  0,  0,  0,  0,  0],
    [ 0,  0,  0,  7,  0,  0,  3,  0],
    [ 0,  0,  3,  0,  0,  0,  0,  7],
    [ 0,  0,  0,  0,  2,  6,  0,  2],
    [ 0,  0,  0,  0,  0,  0, 10,  0],
    [ 0,  0,  0,  0,  0,  0,  0, 10]], dtype=int64)</code></pre><h3 id="æ‰¹é‡é‡‡æ ·è®­ç»ƒ"><a href="#æ‰¹é‡é‡‡æ ·è®­ç»ƒ" class="headerlink" title="æ‰¹é‡é‡‡æ ·è®­ç»ƒ"></a>æ‰¹é‡é‡‡æ ·è®­ç»ƒ</h3><p>å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†çš„å›¾å¾€å¾€å¾ˆå¤§ï¼Œå¯èƒ½ä¼šæœ‰ä¸Šäº¿çš„èŠ‚ç‚¹å’Œè¾¹ï¼Œå¦‚æœæŠŠè¿™äº›æ•°æ®è¿›è¡Œå…¨é‡è®­ç»ƒï¼ŒGPUæ˜¾å­˜å¾ˆéš¾æ”¾çš„ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç±»ä¼¼äºDNNä¸­é‚£æ ·çš„éšæœºæ‰¹é‡å­¦ä¹ çš„æ–¹å¼è¿›è¡Œè®­ç»ƒï¼Œä¸DNNä¸­çš„æ‰¹é‡å­¦ä¹ ä¸åŒï¼ŒGNNå¯¹å•ä¸ªè®­ç»ƒæ ·æœ¬çš„è®­ç»ƒè¿˜éœ€è¦åˆ©ç”¨åˆ°å®ƒçš„é‚»å±…èŠ‚ç‚¹ï¼Œè€Œä¸”æ¯å¤šå¢åŠ ä¸€å±‚ç½‘ç»œï¼Œæ‰€éœ€çš„é‚»å±…æ ·æœ¬è¿˜è¦å¾€å¤–æ‰©å±•ä¸€å±‚ï¼Œæ‰€ä»¥å¯¹äº$k$å±‚çš„GNNç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦å¯¹è®­ç»ƒæ ·æœ¬è¿›è¡Œ$k$é˜¶çš„å­å›¾é‡‡æ ·æ“ä½œï¼ˆå›æƒ³ä¸€ä¸‹ä¹‹å‰GraphSAGEä»£ç ä¸­é‡‡æ ·â€¦ï¼‰ï¼Œå€ŸåŠ©äºDGLçš„apiï¼Œæˆ‘ä»¬åªéœ€è¦å¤šæ·»åŠ 2è¡Œä»£ç å°±å¯ä»¥äº†â€¦</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1.å‡†å¤‡æ•°æ®</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> dgl
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> dgl<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>pytorch <span class="token keyword">import</span> HeteroGraphConv<span class="token punctuation">,</span> GraphConv

n_users <span class="token operator">=</span> <span class="token number">1000</span>
n_items <span class="token operator">=</span> <span class="token number">500</span>
n_follows <span class="token operator">=</span> <span class="token number">3000</span>
n_clicks <span class="token operator">=</span> <span class="token number">5000</span>
n_dislikes <span class="token operator">=</span> <span class="token number">500</span>
n_hetero_features <span class="token operator">=</span> <span class="token number">10</span>
n_user_classes <span class="token operator">=</span> <span class="token number">5</span>
n_max_clicks <span class="token operator">=</span> <span class="token number">10</span>

follow_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
follow_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_follows<span class="token punctuation">)</span>
click_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
click_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_clicks<span class="token punctuation">)</span>
dislike_src <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_users<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>
dislike_dst <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_items<span class="token punctuation">,</span> n_dislikes<span class="token punctuation">)</span>

hetero_graph <span class="token operator">=</span> dgl<span class="token punctuation">.</span>heterograph<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'follow'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_src<span class="token punctuation">,</span> follow_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'followed-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>follow_dst<span class="token punctuation">,</span> follow_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_src<span class="token punctuation">,</span> click_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'clicked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>click_dst<span class="token punctuation">,</span> click_src<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'dislike'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_src<span class="token punctuation">,</span> dislike_dst<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'disliked-by'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>dislike_dst<span class="token punctuation">,</span> dislike_src<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_items<span class="token punctuation">,</span> n_hetero_features<span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_users<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_max_clicks<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># åœ¨userç±»å‹çš„èŠ‚ç‚¹å’Œclickç±»å‹çš„è¾¹ä¸Šéšæœºç”Ÿæˆè®­ç»ƒé›†çš„æ©ç </span>
hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_users<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>
hetero_graph<span class="token punctuation">.</span>edges<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n_clicks<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>bool<span class="token punctuation">)</span><span class="token punctuation">.</span>bernoulli<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>

user_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
item_feats <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>
labels <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
train_mask <span class="token operator">=</span> hetero_graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'train_mask'</span><span class="token punctuation">]</span>
train_idx <span class="token operator">=</span> torch<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span>train_mask<span class="token punctuation">,</span> as_tuple<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Using backend: pytorch</p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>MultiLayerFullNeighborSampler</code>è¿›è¡Œé‡‡æ ·ï¼Œå®ƒä¼šé‡‡æ ·å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ï¼Œåˆ©ç”¨<code>NodeDataLoader</code>è¿›è¡Œæ•°æ®çš„æ‰¹é‡è¯»å–</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#2.å®šä¹‰é‡‡æ ·å™¨</span>
sampler <span class="token operator">=</span> dgl<span class="token punctuation">.</span>dataloading<span class="token punctuation">.</span>MultiLayerFullNeighborSampler<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#é‡‡æ ·2é˜¶å­å›¾ï¼Œå¯¹åº”äº†GNNä¸­2å±‚ç½‘ç»œ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">dataloader <span class="token operator">=</span> dgl<span class="token punctuation">.</span>dataloading<span class="token punctuation">.</span>NodeDataLoader<span class="token punctuation">(</span>hetero_graph<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"user"</span><span class="token punctuation">:</span> train_idx<span class="token punctuation">}</span><span class="token punctuation">,</span> sampler<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é€šè¿‡å¯¹dataloaderè¿­ä»£ï¼Œæˆ‘ä»¬æ¯æ¬¡å¯ä»¥å–å‡ºinput_nodes, output_nodes, blocksè¿™ä¸‰ä¸ªå˜é‡ï¼Œå…¶ä¸­ï¼š<br><strong>input_nodes</strong>ï¼šåŒ…æ‹¬è®­ç»ƒæ‰€éœ€çš„æ‰€æœ‰èŠ‚ç‚¹ID<br><strong>output_nodes</strong>ï¼šåŒ…æ‹¬è®­ç»ƒç›®æ ‡çš„èŠ‚ç‚¹ï¼Œå¯¹åº”ä¸Šé¢128ä¸ªéšæœºçš„userèŠ‚ç‚¹<br><strong>blocks</strong>ï¼šæ˜¯ä¸ªlist,ä»blocks[0],blocks[1]â€¦.åˆ†åˆ«å¯¹åº”äº†èŠ‚ç‚¹çš„$k$é˜¶å­å›¾ï¼Œ$k-1$é˜¶å­å›¾â€¦..ç›´åˆ°è¿™128ä¸ªuserèŠ‚ç‚¹è‡ªèº«çš„$0$é˜¶å­å›¾</p>
<pre class="line-numbers language-python"><code class="language-python">input_nodes<span class="token punctuation">,</span> output_nodes<span class="token punctuation">,</span> blocks <span class="token operator">=</span> next<span class="token punctuation">(</span>iter<span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç”±äºå°†åŸå§‹çš„å¤§å›¾åˆ‡åˆ†ä¸ºäº†ä¸€ä¸ªä¸€ä¸ªçš„blockï¼Œæ‰€ä»¥å¯¹äºæ¨¡å‹å®šä¹‰ä¸­çš„<code>forward</code>é˜¶æ®µéœ€è¦åšä¸€ç‚¹ä¿®æ”¹ï¼Œæ”¹åŠ¨ä¹Ÿå¾ˆç®€å•ï¼Œå°†åŸå§‹çš„å…¨å›¾å˜é‡ï¼Œä¾å±‚æ›¿æ¢ä¸ºå¯¹åº”çš„blockå³å¯</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#3.å®šä¹‰æ¨¡å‹</span>
<span class="token keyword">class</span> <span class="token class-name">RGCN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">,</span> rel_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–HeteroGraphConvï¼Œin_featsæ˜¯è¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œout_featsæ˜¯è¾“å‡ºç‰¹å¾çš„ç»´åº¦ï¼Œaggregateæ˜¯èšåˆå‡½æ•°çš„ç±»å‹</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> GraphConv<span class="token punctuation">(</span>in_feats<span class="token punctuation">,</span> hid_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> HeteroGraphConv<span class="token punctuation">(</span><span class="token punctuation">{</span>
            rel<span class="token punctuation">:</span> GraphConv<span class="token punctuation">(</span>hid_feats<span class="token punctuation">,</span> out_feats<span class="token punctuation">)</span>
            <span class="token keyword">for</span> rel <span class="token keyword">in</span> rel_names<span class="token punctuation">}</span><span class="token punctuation">,</span> aggregate<span class="token operator">=</span><span class="token string">'sum'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> blocks<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># è¾“å…¥æ˜¯èŠ‚ç‚¹çš„ç‰¹å¾å­—å…¸</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#2é˜¶å­å›¾</span>
        h <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> h<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#1é˜¶å­å›¾</span>
        <span class="token keyword">return</span> h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#4.è®­ç»ƒæ¨¡å‹</span>
<span class="token comment" spellcheck="true">#è®­ç»ƒé˜¶æ®µæ²¡å¤ªå¤§å·®å¼‚ï¼Œæ³¨æ„è¾“å…¥ã€è¾“å‡ºçš„å…·ä½“æ ¼å¼</span>
losses<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
model <span class="token operator">=</span> RGCN<span class="token punctuation">(</span>n_hetero_features<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> n_user_classes<span class="token punctuation">,</span> hetero_graph<span class="token punctuation">.</span>etypes<span class="token punctuation">)</span>
opt <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> input_nodes<span class="token punctuation">,</span> output_nodes<span class="token punctuation">,</span> blocks <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># blocks = [b.to(torch.device('cuda')) for b in blocks]</span>
            input_features <span class="token operator">=</span> blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>srcdata<span class="token punctuation">[</span><span class="token string">'feature'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># returns a dict</span>
            output_labels <span class="token operator">=</span> blocks<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dstdata<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># returns a dict</span>
            output_predictions <span class="token operator">=</span> model<span class="token punctuation">(</span>blocks<span class="token punctuation">,</span> input_features<span class="token punctuation">)</span>
            loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>output_predictions<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output_labels<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            opt<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            opt<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>losses<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>&gt;&gt;&gt;</p>
<pre><code>&lt;matplotlib.legend.Legend at 0x281a2e53fd0&gt;</code></pre><p>â€‹<br><img src="/images/loading.gif" data-original="../images/ML/output_10_1.png" alt=""><br>â€‹    </p>
<h1 id="å›¾ç½‘ç»œè§£é‡Š"><a href="#å›¾ç½‘ç»œè§£é‡Š" class="headerlink" title="å›¾ç½‘ç»œè§£é‡Š"></a>å›¾ç½‘ç»œè§£é‡Š</h1><p>åŸè®ºæ–‡ï¼š<a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=4700287" target="_blank" rel="noopener">The graph neural network model</a></p>
<h2 id="GNN"><a href="#GNN" class="headerlink" title="GNN"></a>GNN</h2><ol>
<li><p>å¾ˆå¤šé¢†åŸŸçš„æ•°æ®çš„åº•å±‚å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºå›¾ç»“æ„ï¼Œå¦‚è®¡ç®—æœºè§†è§‰ã€åˆ†å­åŒ–å­¦ã€åˆ†å­ç”Ÿç‰©å­¦ã€æ¨¡å¼è¯†åˆ«ã€æ•°æ®æŒ–æ˜ç­‰é¢†åŸŸã€‚</p>
<p>æœ€ç®€å•çš„å›¾ç»“æ„ä¸ºå•èŠ‚ç‚¹å›¾ï¼Œä»¥åŠä½œä¸ºèŠ‚ç‚¹åºåˆ—çš„å›¾ï¼Œæ›´å¤æ‚çš„å›¾ç»“æ„åŒ…æ‹¬æ ‘ã€æ— ç¯å›¾ã€å¸¦ç¯å›¾ç­‰ã€‚</p>
</li>
<li><p>å…³äºå›¾çš„ä»»åŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><p>åŸºäºå›¾çš„ä»»åŠ¡<code>graph-focused</code>ï¼šä»¥å›¾ä¸ºå•ä½ï¼Œç›´æ¥åœ¨å›¾ç»“æ„çš„æ•°æ®ä¸Šå®ç°åˆ†ç±»æˆ–è€…å›å½’ã€‚</p>
<p>å¦‚ï¼šå›¾è¡¨ç¤ºåŒ–å­¦åŒ–åˆç‰©ï¼Œæ¯ä¸ªé¡¶ç‚¹è¡¨ç¤ºä¸€ä¸ªåŸå­æˆ–è€…åŒ–å­¦åŸºå›¢ã€è¾¹è¡¨ç¤ºåŒ–å­¦é”®ã€‚æ¨¡å‹å¯ä»¥ç”¨äºè¯„ä¼°è¢«æ£€æµ‹çš„åŒ–åˆç‰©çš„ç±»åˆ«ã€‚</p>
<p><img src="/images/loading.gif" data-original="../images/ML/adc557597d3c3ecfb0c351e61b5bdbb2.png" alt=""></p>
</li>
<li><p>åŸºäºèŠ‚ç‚¹çš„ä»»åŠ¡ <code>node-focused</code>ï¼šä»¥èŠ‚ç‚¹ä¸ºå•ä½ï¼Œåœ¨æ¯ä¸ªç»“ç‚¹ä¸Šå®ç°åˆ†ç±»æˆ–è€…å›å½’ã€‚å¦‚ï¼š</p>
<ul>
<li><p>ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­éœ€è¦æ£€æµ‹å›¾åƒæ˜¯å¦åŒ…å«ç‰¹å®šçš„ç›®æ ‡å¹¶è¿›è¡Œç›®æ ‡å®šä½ã€‚è¯¥é—®é¢˜å¯ä»¥é€šè¿‡ä¸€ä¸ªæ˜ å°„å‡½æ•°æ¥è§£å†³ï¼Œè¯¥æ˜ å°„å‡½æ•°æ ¹æ®ç›¸åº”åŒºåŸŸæ˜¯å¦å±äºç›®æ ‡å¯¹è±¡ä»è€Œå¯¹é‚»æ¥çš„é¡¶ç‚¹è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹åº”äºåŸå ¡çš„é»‘è‰²é¡¶ç‚¹çš„è¾“å‡ºä¸º<code>1</code>ï¼Œå…¶å®ƒé¡¶ç‚¹è¾“å‡ºä¸º <code>0</code> ã€‚</p>
<p><img src="/images/loading.gif" data-original="../images/ML/2af9fa9e9f42cbcb89ae2a1f204485a3.png" alt=""></p>
</li>
<li><p>ç½‘é¡µåˆ†ç±»ä»»åŠ¡ä¸­éœ€è¦åˆ¤æ–­æ¯ä¸ªç½‘é¡µçš„ç±»åˆ«ã€‚æˆ‘ä»¬å°†æ‰€æœ‰çš„ç½‘é¡µè§†ä½œä¸€ä¸ªå¤§å›¾ï¼Œæ¯ä¸ªç½‘é¡µä»£è¡¨ä¸€ä¸ªé¡¶ç‚¹ã€ç½‘é¡µä¹‹é—´çš„è¶…é“¾æ¥ä»£è¡¨è¾¹ã€‚å¯ä»¥åˆ©ç”¨ç½‘é¡µçš„å†…å®¹å’Œå›¾ç»“æ„æ¥è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p><img src="/images/loading.gif" data-original="../images/ML/3253eb9068afcecb35c09221a503d05e.png" alt=""></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•é€šè¿‡ä½¿ç”¨é¢„å¤„ç†é˜¶æ®µæ¥å¤„ç†å›¾ç»“æ„çš„æ•°æ®ã€‚åœ¨è¿™ä¸€é˜¶æ®µï¼Œç®—æ³•å°†å›¾ç»“æ„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªæ›´ç®€å•çš„è¡¨è¾¾<code>representation</code>ï¼Œå¦‚ä¸€ä¸ªå®å€¼å‘é‡ã€‚å³ï¼šé¢„å¤„ç†é˜¶æ®µé¦–å…ˆå°†å›¾ç»“æ„çš„æ•°æ®â€œå‹ç¼©â€ ä¸ºå®å€¼å‘é‡ï¼Œç„¶åä½¿ç”¨ <code>list-based</code> æ•°æ®å¤„ç†æŠ€æœ¯æ¥å¤„ç†ã€‚</p>
<p>åœ¨æ•°æ®å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆå¦‚ï¼šæ¯ä¸ªé¡¶ç‚¹çš„æ‹“æ‰‘ä¾èµ–æ€§ï¼‰å¯èƒ½ä¼šè¢«ä¸¢å¤±ã€‚æœ€ç»ˆçš„æ•ˆæœä¸¥é‡ä¾èµ–äºæ•°æ®é¢„å¤„ç†ç®—æ³•ã€‚</p>
<p>æœ€è¿‘æœ‰å¾ˆå¤šç®—æ³•å°è¯•åœ¨é¢„å¤„ç†é˜¶æ®µä¿ç•™æ•°æ®çš„å›¾ç»“æ„æ€§è´¨ï¼Œå…¶åŸºæœ¬æ€è·¯æ˜¯ï¼šåˆ©ç”¨å›¾çš„ç»“ç‚¹ä¹‹é—´çš„æ‹“æ‰‘å…³ç³»å¯¹å›¾ç»“æ„çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œä»è€Œåœ¨æ•°æ®é¢„å¤„ç†è¿‡ç¨‹ä¸­èåˆå›¾çš„ç»“æ„ä¿¡æ¯ã€‚é€’å½’ç¥ç»ç½‘ç»œ<code>RNN</code>ã€é©¬å°”ç§‘å¤«é“¾éƒ½æ˜¯è¿™ç±»æŠ€æœ¯ã€‚</p>
<p>è®ºæ–‡ <code>ã€ŠThe graph neural network modelã€‹</code> æå‡ºäº† <code>GNN</code> æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ‰©å±•äº†<code>RNN</code> å’Œé©¬å°”ç§‘å¤«é“¾æŠ€æœ¯ï¼Œé€‚åˆå¤„ç†å›¾ç»“æ„çš„æ•°æ®ã€‚</p>
<ul>
<li><code>GNN</code> æ—¢é€‚ç”¨äº <code>graph-focused</code> ä»»åŠ¡ï¼Œåˆé€‚ç”¨äº <code>node-focused</code> ä»»åŠ¡ã€‚</li>
<li><code>GNN</code> æ‰©å±•äº†<code>RNN</code>ï¼Œå®ƒå¯ä»¥å¤„ç†æ›´å¹¿æ³›çš„å›¾ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ— ç¯å›¾ã€å¸¦ç¯å›¾ã€æœ‰å‘å›¾ã€æ— å‘å›¾ç­‰ã€‚</li>
<li><code>GNN</code> æ‰©å±•äº†é©¬å°”ç§‘å¤«é“¾ï¼Œå®ƒé€šè¿‡å¼•å…¥å­¦ä¹ ç®—æ³•å¹¶æ‰©å¤§äº†å¯å»ºæ¨¡çš„éšæœºè¿‡ç¨‹çš„ç±»å‹ä»è€Œæ‰©å±•äº†éšæœºæ¸¸èµ°ç†è®ºã€‚</li>
</ul>
</li>
<li><p><code>GNN</code> æ˜¯åŸºäºæ¶ˆæ¯æ‰©æ•£æœºåˆ¶ <code>information diffusion mechanism</code> ã€‚å›¾ç”±ä¸€ç»„å¤„ç†å•å…ƒæ¥å¤„ç†ï¼Œæ¯ä¸ªå¤„ç†å•å…ƒå¯¹åº”äºå›¾çš„ä¸€ä¸ªé¡¶ç‚¹ã€‚</p>
<ul>
<li>å¤„ç†å•å…ƒä¹‹é—´æ ¹æ®å›¾çš„è¿æ¥æ€§æ¥é“¾æ¥ã€‚</li>
<li>å¤„ç†å•å…ƒä¹‹é—´äº¤æ¢ä¿¡æ¯å¹¶æ›´æ–°å•å…ƒçŠ¶æ€ï¼Œç›´åˆ°è¾¾åˆ°ç¨³å®šçš„å¹³è¡¡ä¸ºæ­¢ã€‚</li>
<li>é€šè¿‡æ¯ä¸ªå¤„ç†å•å…ƒçš„ç¨³å®šçŠ¶æ€å¯ä»¥å¾—åˆ°å¯¹åº”é¡¶ç‚¹çš„è¾“å‡ºã€‚</li>
<li>ä¸ºç¡®ä¿å§‹ç»ˆå­˜åœ¨å”¯ä¸€çš„ç¨³å®šçŠ¶æ€ï¼Œæ¶ˆæ¯æ‰©æ•£æœºåˆ¶å­˜åœ¨çº¦æŸã€‚</li>
</ul>
</li>
</ol>
<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903094959341.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095022946.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095051917.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095117747.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095224632.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095241775.png" alt=""></p>
<h4 id="æ–¹ç¨‹æ±‚è§£ç®—æ³•"><a href="#æ–¹ç¨‹æ±‚è§£ç®—æ³•" class="headerlink" title="æ–¹ç¨‹æ±‚è§£ç®—æ³•"></a>æ–¹ç¨‹æ±‚è§£ç®—æ³•</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095335459.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095358128.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/e7b64cb02cdf984b592f9cbdaae378e0.png" alt=""></p>
<h4 id="å‚æ•°å­¦ä¹ ç®—æ³•"><a href="#å‚æ•°å­¦ä¹ ç®—æ³•" class="headerlink" title="å‚æ•°å­¦ä¹ ç®—æ³•"></a>å‚æ•°å­¦ä¹ ç®—æ³•</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095453658.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095522966.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095552140.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095614573.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095730419.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095746578.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095807563.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095832380.png" alt=""></p>
<p>8.å®é™…ä¸Šç¼–ç ç½‘ç»œä»…ä»…ç±»ä¼¼äºé™æ€çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œä½†æ˜¯ç¼–ç ç½‘ç»œçš„<code>layer</code> å±‚æ•°æ˜¯åŠ¨æ€ç¡®å®šçš„ï¼Œå¹¶ä¸”ç½‘ç»œæƒé‡æ ¹æ®è¾“å…¥å›¾çš„æ‹“æ‰‘ç»“æ„æ¥å…±äº«ã€‚å› æ­¤ä¸ºé™æ€ç½‘ç»œè®¾è®¡çš„äºŒé˜¶å­¦ä¹ ç®—æ³•ã€å‰ªæç®—æ³•ã€ä»¥åŠé€å±‚å­¦ä¹ ç®—æ³•æ— æ³•ç›´æ¥åº”ç”¨äº <code>GNN</code> ã€‚</p>
<h4 id="è½¬ç§»å‡½æ•°å’Œè¾“å‡ºå‡½æ•°"><a href="#è½¬ç§»å‡½æ•°å’Œè¾“å‡ºå‡½æ•°" class="headerlink" title="è½¬ç§»å‡½æ•°å’Œè¾“å‡ºå‡½æ•°"></a>è½¬ç§»å‡½æ•°å’Œè¾“å‡ºå‡½æ•°</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095925053.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903095956742.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100014627.png" alt=""></p>
<h3 id="æ¨¡å‹åˆ†æ"><a href="#æ¨¡å‹åˆ†æ" class="headerlink" title="æ¨¡å‹åˆ†æ"></a>æ¨¡å‹åˆ†æ</h3><h4 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100055121.png" alt=""></p>
<h4 id="éšæœºæ¸¸èµ°"><a href="#éšæœºæ¸¸èµ°" class="headerlink" title="éšæœºæ¸¸èµ°"></a>éšæœºæ¸¸èµ°</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100430936.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100449376.png" alt=""></p>
<h4 id="è®¡ç®—å¤æ‚åº¦"><a href="#è®¡ç®—å¤æ‚åº¦" class="headerlink" title="è®¡ç®—å¤æ‚åº¦"></a>è®¡ç®—å¤æ‚åº¦</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100524586.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100607915.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100631909.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903100647155.png" alt=""></p>
<h4 id="ä¸åŠ¨ç‚¹"><a href="#ä¸åŠ¨ç‚¹" class="headerlink" title="ä¸åŠ¨ç‚¹"></a>ä¸åŠ¨ç‚¹</h4><p><code>GNN</code> çš„æ ¸å¿ƒæ˜¯ä¸åŠ¨ç‚¹ç†è®ºï¼Œé€šè¿‡é¡¶ç‚¹çš„æ¶ˆæ¯ä¼ æ’­ä½¿å¾—æ•´å¼ å›¾çš„æ¯ä¸ªé¡¶ç‚¹çš„çŠ¶æ€æ”¶æ•›ï¼Œç„¶ååœ¨æ”¶æ•›çš„çŠ¶æ€åŸºç¡€ä¸Šé¢„æµ‹ã€‚</p>
<p>è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªå±€é™ï¼š</p>
<ul>
<li><p><code>GNN</code> å°†é¡¶ç‚¹ä¹‹é—´çš„è¾¹ä»…ä»…è§†ä¸ºä¸€ç§æ¶ˆæ¯ä¼ æ’­æ‰‹æ®µï¼Œå¹¶æœªåŒºåˆ†è¾¹çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p>åŸºäºä¸åŠ¨ç‚¹çš„æ”¶æ•›ä¼šå¯¼è‡´é¡¶ç‚¹ä¹‹é—´çš„çŠ¶æ€å­˜åœ¨è¾ƒå¤šçš„æ¶ˆæ¯å…±äº«ï¼Œä»è€Œå¯¼è‡´é¡¶ç‚¹çŠ¶æ€ä¹‹é—´è¿‡äºå…‰æ»‘ <code>over smooth</code> ï¼Œè¿™å°†ä½¿å¾—é¡¶ç‚¹ä¹‹é—´ç¼ºå°‘åŒºåˆ†åº¦ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªåƒç´ ç‚¹å’Œå®ƒçš„ä¸Šä¸‹å·¦å³ã€ä»¥åŠæ–œä¸Šä¸‹å·¦å³å…«ä¸ªåƒç´ ç‚¹ç›¸é‚»ã€‚åˆå§‹æ—¶åˆ»è“è‰²æ²¡æœ‰ä¿¡æ¯é‡ï¼Œç»¿è‰²ã€é»„è‰²ã€çº¢è‰²å„æœ‰ä¸€éƒ¨åˆ†ä¿¡æ¯ã€‚</p>
<p>å¼€å§‹æ—¶åˆ»ï¼Œä¸åŒåƒç´ ç‚¹çš„åŒºåˆ†éå¸¸æ˜æ˜¾ï¼›åœ¨ä¸åŠ¨ç‚¹çš„æ”¶æ•›è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰åƒç´ ç‚¹éƒ½è¶‹å‘äºä¸€è‡´ï¼Œæœ€ç»ˆæ•´ä¸ªç³»ç»Ÿçš„ä¿¡æ¯åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ã€‚æœ€ç»ˆï¼Œè™½ç„¶æ¯ä¸ªåƒç´ ç‚¹éƒ½æ„ŸçŸ¥åˆ°äº†å…¨å±€ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æ— æ³•æ ¹æ®æ¯ä¸ªåƒç´ ç‚¹çš„æœ€ç»ˆçŠ¶æ€æ¥åŒºåˆ†å®ƒä»¬ã€‚</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/ML/e67a79049891e9b69335cb4527c0c47b.gif" alt=""></p>
<h2 id="GCN-1"><a href="#GCN-1" class="headerlink" title="GCN"></a>GCN</h2><p>åŸè®ºæ–‡ï¼šSpectral Networks and Deep Locally Connected Networks on Graphs</p>
<ol>
<li><p>å·ç§¯ç¥ç»ç½‘ç»œ <code>CNN</code> è¦æ±‚è¾“å…¥æ•°æ®ä¸ºç½‘æ ¼ç»“æ„ï¼Œå¹¶ä¸”è¦æ±‚æ•°æ®åœ¨ç½‘æ ¼ä¸­å…·æœ‰å¹³ç§»ä¸å˜æ€§ï¼Œå¦‚ä¸€ç»´è¯­éŸ³ã€äºŒç»´å›¾åƒã€ä¸‰ç»´è§†é¢‘éƒ½æ˜¯è¿™ç±»æ•°æ®çš„å…¸å‹ä»£è¡¨ã€‚<code>CNN</code> å……åˆ†åˆ©ç”¨äº†ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹æ¥å¤§å¹…åº¦é™ä½æ¨¡å‹çš„å‚æ•°æ•°é‡ï¼š</p>
<ul>
<li>æƒé‡å…±äº«ï¼šåŒä¸€ä¸ªå·ç§¯æ ¸å¯ä»¥åº”ç”¨äºä¸åŒçš„ä½ç½®ã€‚</li>
<li>ç©ºé—´å±€éƒ¨æ€§ï¼šå·ç§¯æ ¸çš„å¤§å°é€šå¸¸éƒ½è¿œè¿œå°äºè¾“å…¥ä¿¡å·çš„å°ºå¯¸ã€‚</li>
<li>å¤šå°ºåº¦ï¼šé€šè¿‡æ­¥é•¿å¤§äºä¸€çš„å·ç§¯æˆ–è€…æ± åŒ–æ“ä½œæ¥å‡å°‘å‚æ•°ï¼Œå¹¶è·å¾—æ›´å¤§çš„æ„Ÿå—é‡ <code>receptive field</code> ã€‚</li>
</ul>
<p>åœ¨ç½‘æ ¼æ•°æ®ç»“æ„ä¸­ï¼Œé¡¶ç‚¹çš„é‚»å±…æ•°é‡éƒ½æ˜¯å›ºå®šçš„ã€‚ä½†æ˜¯åœ¨å¾ˆå¤šä»»åŠ¡ä¸­ï¼Œæ•°æ®å¹¶ä¸æ˜¯ç½‘æ ¼ç»“æ„ï¼Œå¦‚ç¤¾äº¤ç½‘ç»œæ•°æ®ã€‚åœ¨è¿™äº›å›¾æ•°æ®ç»“æ„ä¸­ï¼Œé¡¶ç‚¹çš„é‚»å±…æ•°é‡æ˜¯ä¸å›ºå®šçš„ã€‚</p>
<p>å›¾ç»“æ„æ˜¯ä¸€ç§æ¯”ç½‘æ ¼ç»“æ„æ›´é€šç”¨çš„ç»“æ„ï¼Œè®ºæ–‡ <code>ã€ŠSpectral Networks and Deep Locally Connected Networks on Graphsã€‹</code> åœ¨å›¾ç»“æ„ä¸Šæ‰©å±•äº†å·ç§¯çš„æ¦‚å¿µï¼Œå¹¶æå‡ºäº†ä¸¤ç§æ„å»ºæ–¹å¼ï¼š</p>
<ul>
<li>åŸºäºç©ºåŸŸçš„å·ç§¯æ„å»º<code>Spatial Construction</code> ï¼šç›´æ¥åœ¨åŸå§‹å›¾ç»“æ„ä¸Šæ‰§è¡Œå·ç§¯ã€‚</li>
<li>åŸºäºè°±åŸŸçš„å·ç§¯æ„å»º<code>Spectral Construction</code> ï¼šå¯¹å›¾ç»“æ„è¿›è¡Œå‚…é‡Œå¶å˜æ¢ä¹‹åï¼Œåœ¨è°±åŸŸè¿›è¡Œå·ç§¯ã€‚</li>
</ul>
</li>
<li><p>åœ¨ç½‘æ ¼æ•°æ®ä¸­çš„å·ç§¯å¯ä»¥é‡‡ç”¨å›ºå®šå¤§å°çš„å·ç§¯æ ¸æ¥æŠ½å–ç‰¹å¾ï¼›ä½†æ˜¯åœ¨å›¾æ•°æ®ä¸­ï¼Œä¼ ç»Ÿçš„å·ç§¯æ ¸æ— èƒ½ä¸ºåŠ›ã€‚å›¾å·ç§¯çš„æœ¬è´¨æ˜¯æ‰¾åˆ°é€‚åˆäºå›¾ç»“æ„çš„å¯å­¦ä¹ çš„å·ç§¯æ ¸ã€‚</p>
</li>
</ol>
<h3 id="ç©ºåŸŸæ„å»º"><a href="#ç©ºåŸŸæ„å»º" class="headerlink" title="ç©ºåŸŸæ„å»º"></a>ç©ºåŸŸæ„å»º</h3><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101049350.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/1ac74457e5080fdbff591c9ff2b485cc.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101125182.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101145142.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101209271.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101237066.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101254895.png" alt=""></p>
<h3 id="å›¾å·ç§¯"><a href="#å›¾å·ç§¯" class="headerlink" title="å›¾å·ç§¯"></a>å›¾å·ç§¯</h3><h4 id="æ‹‰æ™®æ‹‰æ–¯ç®—å­"><a href="#æ‹‰æ™®æ‹‰æ–¯ç®—å­" class="headerlink" title="æ‹‰æ™®æ‹‰æ–¯ç®—å­"></a>æ‹‰æ™®æ‹‰æ–¯ç®—å­</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101327520.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101349178.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101408237.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101427245.png" alt=""></p>
<h4 id="å·ç§¯"><a href="#å·ç§¯" class="headerlink" title="å·ç§¯"></a>å·ç§¯</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101501142.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101531862.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101550937.png" alt=""></p>
<h3 id="é¢‘åŸŸæ„å»º"><a href="#é¢‘åŸŸæ„å»º" class="headerlink" title="é¢‘åŸŸæ„å»º"></a>é¢‘åŸŸæ„å»º</h3><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101613969.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101635435.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101654905.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101726283.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101753772.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101821939.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101847390.png" alt=""></p>
<h2 id="Fast-GCN"><a href="#Fast-GCN" class="headerlink" title="Fast GCN"></a>Fast GCN</h2><p>åŸè®ºæ–‡ï¼š<a href="https://proceedings.neurips.cc/paper/2016/file/04df4d434d481c5bb723be1b6df1ee65-Paper.pdf" target="_blank" rel="noopener">Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering</a></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903101930702.png" alt=""></p>
<h3 id="æ¨¡å‹-1"><a href="#æ¨¡å‹-1" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102114370.png" alt=""></p>
<h4 id="å·ç§¯æ ¸"><a href="#å·ç§¯æ ¸" class="headerlink" title="å·ç§¯æ ¸"></a>å·ç§¯æ ¸</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102217719.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102313023.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102333120.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102356106.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102420802.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102439023.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102457809.png" alt=""></p>
<h4 id="å›¾ç²—åŒ–"><a href="#å›¾ç²—åŒ–" class="headerlink" title="å›¾ç²—åŒ–"></a>å›¾ç²—åŒ–</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102522322.png" alt=""></p>
<h4 id="æ± åŒ–"><a href="#æ± åŒ–" class="headerlink" title="æ± åŒ–"></a>æ± åŒ–</h4><p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102553485.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102621045.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20210903102649676.png" alt=""></p>
<h2 id="Semi-Supervised-GCN"><a href="#Semi-Supervised-GCN" class="headerlink" title="Semi-Supervised GCN"></a>Semi-Supervised GCN</h2><p>åŸè®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1609.02907.pdf?fbclid=IwAR0BgJeoKHIAvPuSE9fJ0_IQOEu5l75yxyNo7PUC08RTOFlm_IIo5YmcnQM" target="_blank" rel="noopener">SEMI-SUPERVISED CLASSIFICATION WITH GRAPH CONVOLUTIONAL NETWORKS</a></p>
<p>å›¾çš„åŠç›‘ç£å­¦ä¹ æ–¹æ³•å¤§è‡´åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li><p>åŸºäºå›¾çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ­£åˆ™åŒ–çš„æ–¹æ³•ï¼Œ åŒ…æ‹¬æ ‡ç­¾ä¼ æ’­ç®—æ³•<code>label propagation</code>ã€æµè¡Œæ­£åˆ™åŒ–ç®—æ³•<code>manifold regularization</code> ã€‚</p>
</li>
<li><p>åŸºäºå›¾åµŒå…¥çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ <code>DeepWalkã€LINE</code> ç­‰ã€‚</p>
<p>ä½†æ˜¯åŸºäºå›¾åµŒå…¥çš„æ–¹æ³•éœ€è¦ä¸€ä¸ª<code>pipeline</code>ï¼Œå…¶ä¸­åŒ…æ‹¬ç”Ÿæˆéšæœºæ¸¸èµ°åºåˆ—ã€æ‰§è¡ŒåŠç›‘ç£è®­ç»ƒç­‰å¤šä¸ªæ­¥éª¤ï¼Œè€Œæ¯ä¸ªæ­¥éª¤éƒ½éœ€è¦åˆ†åˆ«è¿›è¡Œä¼˜åŒ–ã€‚</p>
</li>
</ul>
<p>è®ºæ–‡<code>ã€Š SEMI-SUPERVISED CLASSIFICATION WITH GRAPH CONVOLUTIONAL NETWORKSã€‹</code> æå‡ºäº†ä¸€ç§å¯æ‰©å±•çš„ã€åŸºäº<code>Graph</code> çš„åŠç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŸºäºä¸€ä¸ªæœ‰æ•ˆçš„ã€èƒ½ç›´æ¥å¯¹<code>Graph</code> è¿›è¡Œæ“ä½œçš„å·ç§¯ç¥ç»ç½‘ç»œå˜ç§ã€‚</p>
<p>è¯¥æ¨¡å‹åŸºäºé¢‘åŸŸå·ç§¯çš„å±€éƒ¨ä¸€é˜¶è¿‘ä¼¼æ¥é€‰æ‹©å·ç§¯ç½‘ç»œç»“æ„ï¼Œå…¶è®¡ç®—å¤æ‚åº¦ä¸º <img src="/images/loading.gif" data-original="https://static.sitestack.cn/projects/huaxiaozhuan-ai/72fefaa1d0ea1670a551ea3407087d62.svg" alt="å››ã€Semi-Supervised GCN - å›¾1"> ï¼Œå…¶ä¸­ <img src="/images/loading.gif" data-original="https://static.sitestack.cn/projects/huaxiaozhuan-ai/4365d8a30ced9f1330d84230f785e7cd.svg" alt="å››ã€Semi-Supervised GCN - å›¾2"> ä¸ºè¾¹çš„æ•°é‡ã€‚</p>
<p>è¯¥æ¨¡å‹å­¦åˆ°çš„éšå±‚<code>representation</code> æ—¢èƒ½å¤Ÿç¼–ç å›¾çš„å±€éƒ¨ç»“æ„ï¼Œåˆèƒ½å¤Ÿç¼–ç é¡¶ç‚¹çš„ç‰¹å¾ã€‚</p>
<h2 id="åˆ†å­æŒ‡çº¹GCN"><a href="#åˆ†å­æŒ‡çº¹GCN" class="headerlink" title="åˆ†å­æŒ‡çº¹GCN"></a>åˆ†å­æŒ‡çº¹GCN</h2><p>åŸè®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1509.09292.pdf" target="_blank" rel="noopener">Convolutional Networks on Graphs for Learning Molecular Fingerprints</a></p>
<p>åœ¨ææ–™è®¾è®¡é¢†åŸŸçš„æœ€æ–°å·¥ä½œå·²ç»å°†ç¥ç»ç½‘ç»œç”¨äºææ–™ç­›é€‰ï¼Œå…¶ä»»åŠ¡æ˜¯é€šè¿‡å­¦ä¹ æ ·æœ¬æ¥é¢„æµ‹æ–°å‹åˆ†å­çš„ç‰¹æ€§ã€‚é¢„æµ‹åˆ†å­ç‰¹æ€§é€šå¸¸éœ€è¦å°†åˆ†å­å›¾ä½œä¸ºè¾“å…¥ï¼Œç„¶åæ„å»ºæ¨¡å‹æ¥é¢„æµ‹ã€‚åœ¨åˆ†å­å›¾ä¸­é¡¶ç‚¹è¡¨ç¤ºåŸå­ï¼Œè¾¹è¡¨ç¤ºåŒ–å­¦é”®ã€‚</p>
<p>è¿™ä¸ªä»»åŠ¡çš„ä¸€ä¸ªéš¾ç‚¹åœ¨äºï¼šè¾“å…¥çš„åˆ†å­å›¾å¯ä»¥å…·æœ‰ä»»æ„å¤§å°å’Œä»»æ„å½¢çŠ¶ï¼Œè€Œå¤§å¤šæ•°æœºå™¨å­¦ä¹ æ¨¡å‹åªèƒ½å¤Ÿå¤„ç†å›ºå®šå¤§å°ã€å›ºå®šå½¢çŠ¶çš„è¾“å…¥ã€‚</p>
<p>ç›®å‰ä¸»æµçš„æ–¹æ³•æ˜¯é€šè¿‡<code>hash</code> å‡½æ•°å¯¹åˆ†å­å›¾è¿›è¡Œé¢„å¤„ç†ä»è€Œç”Ÿæˆå›ºå®šå¤§å°çš„æŒ‡çº¹å‘é‡<code>fingerprint vector</code>ï¼Œè¯¥æŒ‡çº¹å‘é‡ä½œä¸ºåˆ†å­çš„ç‰¹å¾çŒå…¥åç»­çš„æ¨¡å‹ä¸­ã€‚</p>
<p>è®ºæ–‡<code>ã€ŠConvolutional Networks on Graphs for Learning Molecular Fingerprintsã€‹</code> æå‡ºäº†åˆ†å­æŒ‡çº¹<code>GCN</code> æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ç”¨ä¸€ä¸ªå¯å¾®çš„ç¥ç»ç½‘ç»œä»£æ›¿äº†åˆ†å­æŒ‡çº¹éƒ¨åˆ†ã€‚</p>
<p>ç¥ç»ç½‘ç»œä»¥åŸå§‹çš„åˆ†å­å›¾ä½œä¸ºè¾“å…¥ï¼Œé‡‡ç”¨å·ç§¯å±‚æ¥æŠ½å–ç‰¹å¾ï¼Œç„¶åé€šè¿‡å…¨å±€æ± åŒ–æ¥ç»“åˆæ‰€æœ‰åŸå­çš„ç‰¹å¾ã€‚è¿™ç§æ–¹å¼ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç«¯åˆ°ç«¯çš„è¿›è¡Œåˆ†å­é¢„æµ‹ã€‚</p>
<p>ç›¸æ¯”è¾ƒä¼ ç»Ÿçš„æŒ‡çº¹å‘é‡çš„æ–¹å¼ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><p>é¢„æµ‹èƒ½åŠ›å¼ºï¼šé€šè¿‡å®éªŒæ¯”è¾ƒå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬çš„æ¨¡å‹æ¯”ä¼ ç»Ÿçš„æŒ‡çº¹å‘é‡èƒ½å¤Ÿæä¾›æ›´å¥½çš„é¢„æµ‹èƒ½åŠ›ã€‚</p>
</li>
<li><p>æ¨¡å‹ç®€æ´ï¼šä¸ºäº†å¯¹æ‰€æœ‰å¯èƒ½çš„å­ç»“æ„è¿›è¡Œç¼–ç ï¼Œä¼ ç»Ÿçš„æŒ‡çº¹å‘é‡å¿…é¡»ç»´åº¦éå¸¸é«˜ã€‚è€Œæˆ‘ä»¬çš„æ¨¡å‹åªéœ€è¦å¯¹ç›¸å…³ç‰¹å¾è¿›è¡Œç¼–ç ï¼Œæ¨¡å‹çš„ç»´åº¦ç›¸å¯¹è€Œè¨€ä½å¾—å¤šï¼Œè¿™é™ä½äº†ä¸‹æ¸¸çš„è®¡ç®—é‡ã€‚</p>
</li>
<li><p>å¯è§£é‡Šæ€§ï¼šä¼ ç»Ÿçš„æŒ‡çº¹å‘é‡å¯¹æ¯ä¸ªç‰‡æ®µ<code>fragment</code> è¿›è¡Œä¸åŒçš„ç¼–ç ï¼Œç‰‡æ®µä¹‹é—´æ²¡æœ‰ç›¸ä¼¼çš„æ¦‚å¿µã€‚å³ï¼šç›¸ä¼¼çš„ç‰‡æ®µä¸ä¸€å®šæœ‰ç›¸ä¼¼çš„ç¼–ç ï¼›ç›¸ä¼¼çš„ç¼–ç ä¹Ÿä¸ä¸€å®šä»£è¡¨äº†ç›¸ä¼¼çš„ç‰‡æ®µã€‚</p>
<p>æˆ‘ä»¬çš„æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªç‰¹å¾éƒ½å¯ä»¥ç”±ç›¸ä¼¼ä½†æ˜¯ä¸åŒçš„åˆ†å­ç‰‡æ®µæ¿€æ´»ï¼Œå› æ­¤ç›¸ä¼¼çš„ç‰‡æ®µå…·æœ‰ç›¸ä¼¼çš„ç‰¹å¾ï¼Œç›¸ä¼¼çš„ç‰¹å¾ä¹Ÿä»£è¡¨äº†ç›¸ä¼¼çš„ç‰‡æ®µã€‚è¿™ä½¿å¾—ç‰¹å¾çš„<code>representation</code> æ›´å…·æœ‰æ„ä¹‰ã€‚</p>
</li>
</ul>
<h2 id="GGS-NN"><a href="#GGS-NN" class="headerlink" title="GGS-NN"></a>GGS-NN</h2><p>åŸè®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1511.05493.pdf" target="_blank" rel="noopener">GATED GRAPH SEQUENCE NEURAL NETWORKS</a></p>
<ol>
<li><p>ç›®å‰å…³äºå›¾ç¥ç»ç½‘ç»œæ¨¡å‹çš„å·¥ä½œä¸»è¦é›†ä¸­åœ¨å•è¾“å‡ºæ¨¡å‹ä¸Šï¼Œå¦‚<code>graph-level</code> çš„åˆ†ç±»ã€‚å®é™…ä¸Šæœ‰ä¸€äº›å›¾ä»»åŠ¡éœ€è¦è¾“å‡ºåºåˆ—ï¼Œå¦‚ï¼šè¾“å‡ºä¸€æ¡åŒ…å«ç‰¹å®šå±æ€§çš„é¡¶ç‚¹ç»„æˆçš„è·¯å¾„ã€‚</p>
<p>è®ºæ–‡<code>ã€ŠGATED GRAPH SEQUENCE NEURAL NETWORKSã€‹</code> åŸºäº <code>GNN</code> æ¨¡å‹è¿›è¡Œä¿®æ”¹ï¼Œå®ƒä½¿ç”¨é—¨æ§å¾ªç¯å•å…ƒ <code>gated recurrent units</code> ä»¥åŠç°ä»£çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¹¶æ‰©å±•åˆ°åºåˆ—è¾“å‡ºçš„å½¢å¼ã€‚è¿™ç§æ¨¡å‹è¢«ç§°ä½œé—¨æ§å›¾åºåˆ—ç¥ç»ç½‘ç»œ<code>Gated Graph Sequence Neural Networks:GGS-NNs</code> ã€‚</p>
<p>åœ¨<code>Graph</code> æ•°æ®ç»“æ„ä¸Šï¼Œ<code>GGS-NNs</code> ç›¸æ¯”äºå•çº¯çš„åŸºäºåºåˆ—çš„æ¨¡å‹ï¼ˆå¦‚<code>LSTM</code>ï¼‰å…·æœ‰æœ‰åˆ©çš„å½’çº³åç½®<code>inductive biases</code> ã€‚</p>
<blockquote>
<p>å½’çº³åç½®ï¼šç®—æ³•å¯¹äºå­¦ä¹ çš„é—®é¢˜åšçš„ä¸€äº›å‡è®¾ï¼Œè¿™äº›å‡è®¾å°±ç§°ä½œå½’çº³åç½®ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºè´å¶æ–¯å­¦ä¹ ä¸­çš„â€œå…ˆéªŒ<code>prior</code>â€ï¼Œå³å¯¹æ¨¡å‹çš„åå¥½ã€‚</p>
<ul>
<li><code>CNN</code> çš„å½’çº³åç½®ä¸ºï¼šå±€éƒ¨æ€§<code>locality</code>å’Œå¹³ç§»ä¸å˜æ€§<code>spatial invariance</code>ã€‚å³ï¼šç©ºé—´ç›¸è¿‘çš„å…ƒç´ ä¹‹é—´è”ç³»è¾ƒç´§ã€ç©ºé—´è¾ƒè¿œçš„å…ƒç´ ä¹‹é—´æ²¡æœ‰è”ç³»ï¼›å·ç§¯æ ¸æƒé‡å…±äº«ã€‚</li>
<li><code>RNN</code> çš„å½’çº³åç½®ä¸ºï¼šåºåˆ—æ€§<code>sequentiality</code> å’Œæ—¶é—´ä¸å˜æ€§ <code>time invariance</code>ã€‚å³ï¼šåºåˆ—é¡ºåºä¸Šçš„ <code>timestep</code> ä¹‹é—´æœ‰è”ç³»ï¼›<code>RNN</code> æƒé‡å…±äº«ã€‚</li>
</ul>
</blockquote>
</li>
<li><p>åœ¨å›¾ä¸Šå­¦ä¹ <code>representation</code> æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>å­¦ä¹ è¾“å…¥å›¾çš„ <code>representation</code> ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰å¤§å¤šæ•°æ¨¡å‹çš„å¤„ç†æ–¹å¼ã€‚</li>
<li>åœ¨ç”Ÿæˆä¸€ç³»åˆ—è¾“å‡ºçš„è¿‡ç¨‹ä¸­å­¦ä¹ å†…éƒ¨çŠ¶æ€çš„ <code>representation</code>ï¼Œå…¶ä¸­çš„æŒ‘æˆ˜åœ¨äºï¼šå¦‚ä½•å­¦ä¹  <code>representation</code>ï¼Œå®ƒæ—¢èƒ½å¯¹å·²ç»ç”Ÿæˆçš„éƒ¨åˆ†è¾“å‡ºåºåˆ—è¿›è¡Œç¼–ç ï¼ˆå¦‚è·¯å¾„è¾“å‡ºä»»åŠ¡ä¸­ï¼Œå·²ç»äº§ç”Ÿçš„è·¯å¾„ï¼‰ï¼Œåˆèƒ½å¯¹åç»­å¾…ç”Ÿæˆçš„éƒ¨åˆ†è¾“å‡ºåºåˆ—è¿›è¡Œç¼–ç ï¼ˆå¦‚è·¯å¾„è¾“å‡ºä»»åŠ¡ä¸­ï¼Œå‰©ä½™è·¯å¾„ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h2 id="PATCHY-SAN"><a href="#PATCHY-SAN" class="headerlink" title="PATCHY-SAN"></a>PATCHY-SAN</h2><p>åŸè®ºæ–‡ï¼š<a href="http://proceedings.mlr.press/v48/niepert16.pdf" target="_blank" rel="noopener">Learning Convolutional Neural Networks for Graphs</a></p>
<ol>
<li><p>å¾ˆå¤šé‡è¦é—®é¢˜éƒ½å¯ä»¥è§†ä¸ºå›¾æ•°æ®å¾—å­¦ä¹ é—®é¢˜ã€‚è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ç»™å®šä¸€ç»„å›¾ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œå­¦ä¹ ä¸€ä¸ªç”¨äºå¯¹æœªè§è¿‡çš„å›¾ï¼ˆå³æµ‹è¯•å›¾ï¼‰è¿›è¡Œåˆ†ç±»æˆ–è€…å›å½’çš„å‡½æ•°ã€‚å…¶ä¸­è®­ç»ƒé›†ä¸­ä»»æ„ä¸¤ä¸ªå›¾çš„ç»“æ„ä¸ä¸€å®šæ˜¯ç›¸åŒçš„ã€‚ä¾‹å¦‚ï¼šç»™å®šä¸€ç»„åŒ–åˆç‰©ä»¥åŠå®ƒä»¬å¯¹äºç™Œç»†èƒæ´»æ€§æŠ‘åˆ¶æ•ˆæœï¼Œç”¨äºé¢„æµ‹æ–°çš„åŒ–åˆç‰©å¯¹äºç™Œç»†èƒæ´»æ€§æŠ‘åˆ¶çš„ç»“æœã€‚</li>
<li>ç»™å®šä¸€å¼ å¤§å›¾ï¼Œå­¦ä¹ è¯¥å›¾çš„<code>representation</code> ä»è€Œå¯ä»¥æ¨æ–­æœªè§è¿‡çš„å›¾å±æ€§ï¼Œå¦‚é¡¶ç‚¹ç±»å‹ï¼ˆå³é¡¶ç‚¹åˆ†ç±»ï¼‰ã€ç¼ºå¤±è¾¹ï¼ˆå³é“¾æ¥é¢„æµ‹ï¼‰ã€‚</li>
</ul>
</li>
<li><p>å·ç§¯ç¥ç»ç½‘ç»œ<code>CNN</code> åœ¨å›¾åƒé¢†åŸŸä¸­å¤§è·æˆåŠŸã€‚å›¾åƒ<code>image</code> ä¹Ÿæ˜¯ä¸€ç§å›¾<code>graph</code> ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ­£æ–¹å½¢çš„ç½‘æ ¼å›¾ï¼Œå…¶ä¸­é¡¶ç‚¹è¡¨ç¤ºåƒç´ ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé»‘è‰²/ç™½è‰²é¡¶ç‚¹è¡¨ç¤ºåƒç´ çš„ä¸åŒå–å€¼ï¼ˆé»‘è‰²å–å€¼ä¸º<code>1</code>ã€ç™½è‰²å–å€¼ä¸º<code>0</code> ï¼‰ï¼Œçº¢è‰²é¡¶ç‚¹è¡¨ç¤ºå½“å‰å·ç§¯æ ¸çš„ä¸­å¿ƒä½ç½®ã€‚<code>(a)</code> å›¾ç»™å‡ºäº†ä¸€ä¸ª <code>3x3</code> å·ç§¯æ ¸åœ¨ä¸€ä¸ª <code>4x4</code> å›¾åƒä¸Šçš„å·ç§¯è¿‡ç¨‹ï¼Œå…¶ä¸­æ­¥å¹…ä¸º<code>1</code>ã€é‡‡ç”¨éé›¶å¡«å……ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°† <code>CNN</code> è§†ä¸ºéå†ä¸€ä¸ªé¡¶ç‚¹åºåˆ—ï¼ˆå³å›¾<code>(a)</code> ä¸­çš„çº¢è‰²é¡¶ç‚¹ <code>1,2,3,4</code> ï¼‰ã€ç„¶åä¸ºè¯¥åºåˆ—ä¸­çš„æ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆå›ºå®šå¤§å°çš„é‚»åŸŸå­å›¾ï¼ˆå³å›¾<code>(b)</code> ä¸­çš„ <code>3x3</code> ç½‘æ ¼ï¼‰ çš„è¿‡ç¨‹ã€‚å…¶ä¸­é‚»åŸŸå­å›¾ä½œä¸ºæ„Ÿå—é‡<code>receptive field</code>ï¼Œç”¨äºç‰¹å¾æŠ½å–ï¼ˆæŠ½å–æ„Ÿå—é‡ä¸­é¡¶ç‚¹çš„ç‰¹å¾ï¼‰ã€‚</p>
<p><img src="/images/loading.gif" data-original="../images/ML/760e39197c2dd0004b571d76b2d285df.png" alt=""></p>
<p>ç”±äºåƒç´ ç‚¹çš„éšå¼ç©ºé—´é¡ºåºï¼Œä»å·¦åˆ°å³ä»¥åŠä»ä¸Šåˆ°ä¸‹å”¯ä¸€ç¡®å®šäº†è¿™ä¸ªé¡¶ç‚¹åºåˆ—ã€‚åœ¨<code>NLP</code> é—®é¢˜ä¸­ï¼Œå¥å­ä¹Ÿéšå¼çš„ä»å·¦åˆ°å³ç¡®å®šäº†å•è¯çš„é¡ºåºã€‚ä½†æ˜¯å¯¹äºå›¾<code>graph</code> é—®é¢˜ï¼Œéš¾ä»¥é’ˆå¯¹ä¸åŒçš„é—®é¢˜ç»™äºˆä¸€ä¸ªåˆé€‚çš„é¡¶ç‚¹é¡ºåºã€‚åŒæ—¶æ•°æ®é›†ä¸­ä¸åŒå›¾çš„ç»“æ„ä¸åŒï¼Œä¸åŒå›¾çš„é¡¶ç‚¹ä¹‹é—´éƒ½æ— æ³•å¯¹åº”ã€‚</p>
<p>å› æ­¤å¦‚æœå¸Œæœ›å°†å·ç§¯ç¥ç»ç½‘ç»œåº”ç”¨åˆ°å›¾ç»“æ„ä¸Šï¼Œå¿…é¡»è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸ºå›¾ç¡®å®šä¸€ä¸ªé¡¶ç‚¹åºåˆ—ï¼Œå…¶ä¸­æˆ‘ä»¬ä¸ºåºåˆ—ä¸­çš„æ¯ä¸ªé¡¶ç‚¹åˆ›å»ºé‚»åŸŸå­å›¾ã€‚</li>
<li>é‚»åŸŸå›¾çš„å½’ä¸€åŒ–ï¼Œå³å°†é‚»åŸŸå­å›¾æ˜ å°„åˆ°å‘é‡ç©ºé—´ï¼Œä»è€Œæ–¹ä¾¿åç»­çš„å·ç§¯è¿ç®—ï¼ˆå› ä¸ºå·ç§¯æ ¸æ— æ³•ä½œç”¨äºå­å›¾ä¸Šï¼‰ã€‚</li>
</ul>
<p>è®ºæ–‡<code>ã€ŠLearning Convolutional Neural Networks for Graphsã€‹</code> æå‡ºäº†ä¸€ç§å­¦ä¹ ä»»æ„å›¾çš„å·ç§¯ç¥ç»ç½‘ç»œæ¡†æ¶ <code>PATCHY-SAN</code> ï¼Œè¯¥æ¡†æ¶è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚<code>PATCHY-SAN</code> é€‚ç”¨äºæ— å‘å›¾/æœ‰å‘å›¾ï¼Œå¯ä»¥å¤„ç†è¿ç»­/ç¦»æ•£çš„é¡¶ç‚¹å’Œè¾¹çš„å±æ€§ï¼Œä¹Ÿæ”¯æŒå¤šç§ç±»å‹çš„è¾¹ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè¾“å…¥çš„<code>graph</code>ï¼Œ<code>PATCHY-SAN</code> æ–¹æ³•é¦–å…ˆç¡®å®šäº†ä¸€ä¸ªé¡¶ç‚¹åºåˆ—ï¼›ç„¶åï¼Œå¯¹åºåˆ—ä¸­æ¯ä¸ªé¡¶ç‚¹æå–ä¸€ä¸ªæ­£å¥½ç”± <img src="/images/loading.gif" data-original="https://static.sitestack.cn/projects/huaxiaozhuan-ai/cc2f295f0763f0ecede26c79e869fe9a.svg" alt="ä¸ƒã€PATCHY-SAN - å›¾2"> ä¸ªé¡¶ç‚¹ç»„æˆçš„é‚»åŸŸå¹¶å½’ä¸€åŒ–é‚»åŸŸï¼Œå½’ä¸€åŒ–çš„é‚»åŸŸå°†ä½œä¸ºå½“å‰é¡¶ç‚¹çš„æ„Ÿå—é‡ï¼›æœ€åï¼Œå°±åƒ <code>CNN</code> çš„æ„Ÿå—é‡ä¸€æ ·ï¼Œå¯ä»¥å°†ä¸€äº›ç‰¹å¾å­¦ä¹ ç»„ä»¶ï¼ˆå¦‚å·ç§¯å±‚ã€<code>dense</code> å±‚)ä½œç”¨åˆ°å½’ä¸€åŒ–é‚»åŸŸä¸Šã€‚å…¶æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­çº¢è‰²é¡¶ç‚¹è¡¨ç¤ºé¡¶ç‚¹åºåˆ—ä¸­çš„é¡¶ç‚¹ã€‚</p>
<p><img src="/images/loading.gif" data-original="../images/ML/074c89685c6e42200fc84ba04d19cc73.png" alt=""></p>
</li>
<li><p><code>PATCHY-SAN</code> æ–¹æ³•å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è®¡ç®—é«˜æ•ˆï¼ŒåŸç”Ÿæ”¯æŒå¹¶è¡Œè®¡ç®—ï¼Œå¹¶ä¸”å¯ç”¨äºå¤§å‹å›¾ã€‚</li>
<li>æ”¯æŒç‰¹å¾å¯è§†åŒ–ï¼Œå¯ä»¥æ·±å…¥äº†è§£å›¾çš„ç»“æ„å±æ€§ã€‚</li>
<li>ç›¸æ¯”è¾ƒä¸ <code>graph kernel</code> æ–¹æ³•ï¼Œ<code>PATCHY-SAN</code> æ— éœ€ä¾èµ–ä»»ä½•ç‰¹å¾å·¥ç¨‹å°±å¯ä»¥å­¦åˆ°å…·ä½“ä»»åŠ¡çš„ç‰¹å¾ã€‚</li>
</ul>
</li>
</ol>
<h2 id="GraphSage"><a href="#GraphSage" class="headerlink" title="GraphSage"></a>GraphSage</h2><p>åŸè®ºæ–‡ï¼š<a href="https://proceedings.neurips.cc/paper/2017/file/5dd9db5e033da9c6fb5ba83c7a7ebea9-Paper.pdf" target="_blank" rel="noopener">Inductive Representation Learning on Large Graphs</a></p>
<ol>
<li><p>åœ¨å¤§å‹<code>Graph</code> ä¸­ï¼Œé¡¶ç‚¹çš„ä½ç»´<code>embedding</code> åœ¨ä»å†…å®¹æ¨èåˆ°è›‹ç™½è´¨åŠŸèƒ½è¯†åˆ«ç­‰å„é¡¹ä»»åŠ¡ä¸­éƒ½éå¸¸æœ‰æ•ˆã€‚</p>
<p>ä¹‹å‰çš„å·¥ä½œéƒ½é›†ä¸­åœ¨ä»å•ä¸ªæŒ‡å®šçš„å›¾æ¥å­¦ä¹ é¡¶ç‚¹ <code>embedding</code>ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯ <code>transductive</code> çš„ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šå®é™…åº”ç”¨éœ€è¦ä¸ºä»æœªè§è¿‡çš„é¡¶ç‚¹æˆ–è€…å…¨æ–°çš„å›¾æ¥å¿«é€Ÿç”Ÿæˆ <code>embedding</code> ï¼Œå³éœ€è¦ <code>inductive</code> èƒ½åŠ›ã€‚è¿™ç§ <code>inductive</code> èƒ½åŠ›å¯¹äºç”Ÿäº§ä¸­çš„æœºå™¨å­¦ä¹ ç³»ç»Ÿè‡³å…³é‡è¦ï¼Œè¿™äº›æœºå™¨å­¦ä¹ ç³»ç»Ÿéœ€è¦åœ¨ä¸æ–­å˜åŒ–çš„å›¾ä¸Šè¿è¡Œï¼Œå¹¶ä¸æ–­é‡åˆ°ä»æœªè§è¿‡çš„é¡¶ç‚¹ï¼ˆå¦‚ <code>Youtube</code> ä¸Šçš„æ–°ç”¨æˆ·ã€æ–°è§†é¢‘ï¼‰ã€‚ å¦å¤–è¿™ç§ <code>inductive</code> èƒ½åŠ›è¿˜å¯ä»¥ä¿ƒè¿›å›¾çš„æ³›åŒ–ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨å·²çŸ¥çš„åˆ†å­ç»“æ„å›¾ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œç„¶åè¯¥æ¨¡å‹å¯ä»¥ä¸ºæ–°çš„åˆ†å­å›¾äº§ç”Ÿé¡¶ç‚¹ <code>embedding</code> ã€‚</p>
<ul>
<li><p>ä¸ <code>transductiv</code> ç›¸æ¯”ï¼Œ<code>inductive</code> çš„é¡¶ç‚¹ <code>embedding</code> æ›´ä¸ºå›°éš¾ï¼Œå› ä¸ºè¿™éœ€è¦æ³›åŒ–åˆ°ä»æœªå°±æŒ‰è¿‡çš„é¡¶ç‚¹ã€‚è€Œè¿™éœ€è¦å°†æ–°è§‚å¯Ÿåˆ°çš„å­å›¾ â€œå¯¹é½â€ åˆ°æ¨¡å‹å·²ç»è®­ç»ƒè¿‡çš„æ—§çš„å­å›¾ã€‚<code>inductive</code> æ¡†æ¶å¿…é¡»å­¦ä¼šè¯†åˆ«é¡¶ç‚¹é‚»åŸŸçš„ç»“æ„å±æ€§ï¼Œä»è€Œè¯†åˆ«æ¯ä¸ªé¡¶ç‚¹ï¼ˆåŒ…æ‹¬æ–°å‘ç°çš„é¡¶ç‚¹ï¼‰åœ¨å›¾çš„å±€éƒ¨è§’è‰²ä»¥åŠå…¨å±€ä½ç½®ã€‚</p>
</li>
<li><p>å¤§å¤šæ•°ç°æœ‰çš„é¡¶ç‚¹<code>embedding</code> æ–¹æ³•æœ¬è´¨éƒ½æ˜¯ <code>transductive</code> çš„ã€‚è¿™äº›æ–¹æ³•éƒ½ä½¿ç”¨åŸºäºçŸ©é˜µåˆ†è§£æ¥ç›´æ¥ä¼˜åŒ–æ¯ä¸ªé¡¶ç‚¹çš„ <code>embedding</code> ã€‚å› ä¸ºå®ƒä»¬æ˜¯åœ¨å•ä¸ªå›ºå®šçš„å›¾ä¸Šå¯¹é¡¶ç‚¹è¿›è¡Œè®­ç»ƒå’Œé¢„æµ‹ï¼Œå› æ­¤å¤©ç„¶åœ°æ— æ³•æ¨å¹¿åˆ°æœªè§è¿‡çš„é¡¶ç‚¹ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä¿®æ”¹è¿™äº›æ–¹æ³•æ¥æ»¡è¶³<code>inductinve</code> çš„è¦æ±‚ï¼Œ å¦‚é’ˆå¯¹æ–°çš„æœªè§è¿‡çš„é¡¶ç‚¹è¿›è¡Œè‹¥å¹²è½®é¢å¤–çš„æ¢¯åº¦ä¸‹é™ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼çš„è®¡ç®—ä»£ä»·è¾ƒé«˜ï¼Œä¹Ÿå®¹æ˜“å¯¼è‡´é¡¶ç‚¹ <code>embedding</code> åœ¨é‡æ–°è®­ç»ƒæœŸé—´å‘ç”Ÿæ¼‚ç§»ã€‚</p>
</li>
</ul>
<p>æœ€è¿‘ä¹Ÿæœ‰é€šè¿‡å›¾å·ç§¯ï¼ˆå¦‚<code>Semi-Supervised GCN</code> ï¼‰æ¥å­¦ä¹ å›¾ç»“æ„çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•ä¹Ÿæ˜¯ä»¥ <code>transductive</code> çš„æ–¹å¼åœ¨ä½¿ç”¨ã€‚è®ºæ–‡<code>ã€ŠInductive Representation Learning on Large Graphsã€‹</code> æå‡ºäº†ä¸€ä¸ªé€šç”¨çš„ã€ç§°ä½œ <code>Graph Sample and Aggregage:GraphSAGE</code> çš„å­¦ä¹ æ¡†æ¶ï¼Œè¯¥æ¡†æ¶å°†å›¾å·ç§¯æ¨å¹¿åˆ° <code>inductinve</code> æ— ç›‘ç£å­¦ä¹ ã€‚</p>
</li>
<li><p><code>GraphSage</code> æ˜¯ä¸€ç§<code>inductive</code> çš„é¡¶ç‚¹ <code>embedding</code> æ–¹æ³•ã€‚ä¸åŸºäºçŸ©é˜µåˆ†è§£çš„<code>embedding</code> æ–¹æ³•ä¸åŒï¼Œ<code>GraphSage</code> åˆ©ç”¨é¡¶ç‚¹ç‰¹å¾ï¼ˆå¦‚æ–‡æœ¬å±æ€§ã€é¡¶ç‚¹ç”»åƒä¿¡æ¯ã€é¡¶ç‚¹çš„<code>degree</code> ç­‰ï¼‰æ¥å­¦ä¹ ï¼Œå¹¶æ³›åŒ–åˆ°ä»æœªè§è¿‡çš„é¡¶ç‚¹ã€‚</p>
<ul>
<li>é€šè¿‡å°†é¡¶ç‚¹ç‰¹å¾èåˆåˆ°å­¦ä¹ ç®—æ³•ä¸­ï¼Œ<code>GraphSage</code> å¯ä»¥åŒæ—¶å­¦ä¹ æ¯ä¸ªé¡¶ç‚¹çš„é‚»åŸŸæ‹“æ‰‘ç»“æ„ï¼Œä»¥åŠé¡¶ç‚¹ç‰¹å¾åœ¨é‚»åŸŸä¸­çš„åˆ†å¸ƒã€‚<code>GraphSage</code> ä¸ä»…å¯ä»¥åº”ç”¨äºé¡¶ç‚¹ç‰¹å¾ä¸°å¯Œçš„å›¾ï¼ˆå¦‚å¼•æ–‡ç½‘ç»œã€ç”Ÿç‰©åˆ†å­ç½‘ç»œï¼‰ï¼Œè¿˜å¯ä»¥åº”ç”¨åˆ°æ²¡æœ‰ä»»ä½•é¡¶ç‚¹ç‰¹å¾çš„ç®€å•çš„å›¾ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨é¡¶ç‚¹çš„ç»“æ„å±æ€§æ¥ä½œä¸ºé¡¶ç‚¹ç‰¹å¾ï¼ˆå¦‚é¡¶ç‚¹<code>degree</code> ï¼‰ã€‚</li>
<li><code>GraphSage</code> å¹¶æ²¡æœ‰ä¸ºæ¯ä¸ªé¡¶ç‚¹è®­ç»ƒä¸€ä¸ª <code>embedding</code>ï¼Œè€Œæ˜¯è®­ç»ƒäº†ä¸€ç»„èšåˆå‡½æ•°ï¼Œè¿™äº›èšåˆå‡½æ•°ç”¨äºä»é¡¶ç‚¹çš„å±€éƒ¨é‚»åŸŸä¸­èšåˆä¿¡æ¯ç‰¹å¾ã€‚åœ¨æµ‹è¯•æœŸé—´ï¼Œæˆ‘ä»¬ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹çš„èšåˆå‡½æ•°æ¥ä¸ºä»æœªè§è¿‡çš„é¡¶ç‚¹ç”Ÿæˆ <code>embedding</code> ã€‚</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/ML/d7b0083456e9d0a24f6fa2460514e6dd.png" alt=""></p>
</li>
<li><p>å’Œä¹‹å‰çš„ <code>embedding</code> æ–¹æ³•ç±»ä¼¼ï¼Œ<code>GraphSage</code> è®¾è®¡äº†ä¸€ä¸ªæ— ç›‘ç£æŸå¤±å‡½æ•°ã€‚è¯¥æŸå¤±å‡½æ•°å…è®¸å¯¹<code>GraphSage</code> è¿›è¡Œæ— ç›‘ç£è®­ç»ƒï¼Œè€Œæ— éœ€ä»»ä½•ç‰¹å®šäºå…·ä½“ä»»åŠ¡ç›‘ç£ä¿¡æ¯ã€‚è®ºæ–‡è¿˜å±•ç¤ºäº†ä»¥ç›‘ç£æ–¹å¼æ¥è®­ç»ƒ <code>GraphSage</code> ã€‚</p>
<p>è®ºæ–‡åœ¨ä¸‰ä¸ªé¡¶ç‚¹åˆ†ç±» <code>benchmark</code> ä¸Šè¯„ä¼°äº†<code>GraphSave</code> æ–¹æ³•ï¼Œä»è€ŒéªŒè¯äº†<code>GraphSage</code> åœ¨ä»æœªè§è¿‡çš„æ•°æ®ä¸Šå…·æœ‰ä¼˜ç§€çš„é¡¶ç‚¹ <code>embedding</code> èƒ½åŠ›ã€‚</p>
<p>æœ€åè®ºæ–‡ç ”ç©¶äº† <code>GraphSave</code> çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¹¶é€šè¿‡ç†è®ºåˆ†æè¯æ˜äº†ï¼šè™½ç„¶<code>GraphSage</code> æ˜¯åŸºäºé¡¶ç‚¹ç‰¹å¾çš„ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿå­¦å¾—é¡¶ç‚¹åœ¨å›¾ä¸­è§’è‰²çš„ç»“æ„ä¿¡æ¯ã€‚</p>
</li>
<li><p><code>GraphSave</code> æ–¹æ³•å’Œ <code>Semi-Supervised GCN</code> å¯†åˆ‡ç›¸å…³ã€‚åŸå§‹çš„ <code>Semi-Supervised GCN</code> ä»¥ <code>transductive</code> çš„æ–¹å¼è¿›è¡ŒåŠç›‘ç£å­¦ä¹ ï¼Œè¿™è¦æ±‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å·²çŸ¥å®Œæ•´çš„å›¾æ‹‰æ™®æ‹‰æ–¯ç®—å­ã€‚<code>GraphSage</code> çš„ä¸€ä¸ªç®€å•å˜ç§å¯ä»¥è§†ä¸º <code>Semi-Supervised GCN</code> æ¡†æ¶ä»¥ <code>inductive</code> æ–¹å¼çš„æ‰©å±•ã€‚</p>
</li>
</ol>
<h2 id="GAT-1"><a href="#GAT-1" class="headerlink" title="GAT"></a>GAT</h2><p>åŸè®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1710.10903.pdf" target="_blank" rel="noopener">GRAPH ATTENTION NETWORKS</a></p>
<ol>
<li><p>å·ç§¯ç¥ç»ç½‘ç»œ<code>CNN</code> å·²ç»æˆåŠŸåº”ç”¨äºå›¾åƒåˆ†ç±»ã€è¯­ä¹‰åˆ†å‰²ä»¥åŠæœºå™¨ç¿»è¯‘ä¹‹ç±»çš„é—®é¢˜ï¼Œå…¶åº•å±‚æ•°æ®ç»“æ„ä¸ºç½‘æ ¼çŠ¶ç»“æ„<code>grid-like structure</code> ã€‚ä½†å¾ˆå¤šä»»åŠ¡æ¶‰åŠåˆ°æ— æ³•ä»¥ç½‘çŠ¶ç»“æ„è¡¨ç¤ºçš„æ•°æ®ï¼Œå¦‚ï¼šç¤¾äº¤ç½‘ç»œã€ç”µä¿¡ç½‘ç»œç­‰ï¼Œè€Œè¿™äº›æ•°æ®é€šå¸¸å¯ä»¥ç”¨å›¾çš„æ–¹å¼æ¥ç»„ç»‡ã€‚</p>
<ul>
<li><p>æ—©æœŸå›¾é¢†åŸŸä»»åŠ¡é€šå¸¸ä½œä¸ºæœ‰å‘æ— ç¯å›¾ï¼Œé‡‡ç”¨å¾ªç¯ç¥ç»ç½‘ç»œ<code>RNN</code> æ¥å¤„ç†ã€‚åæ¥å‘å±•å‡ºå›¾ç¥ç»ç½‘ç»œ<code>GNN</code> ä½œä¸º <code>RNN</code> çš„æ³›åŒ–æ¥ç›´æ¥å¤„ç†æ›´é€šç”¨çš„å›¾ï¼Œå¦‚å¾ªç¯å›¾ã€æœ‰å‘å›¾ã€æ— ç¯å›¾ã€‚</p>
<p><code>GNN</code> åŒ…å«ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹æ¥ä¼ æ’­é¡¶ç‚¹çŠ¶æ€ç›´è‡³è¾¾åˆ°çŠ¶æ€å¹³è¡¡ï¼Œå³ä¸åŠ¨ç‚¹ï¼›ç„¶åå†æ ¹æ®é¡¶ç‚¹çŠ¶æ€ä¸ºæ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆè¾“å‡ºã€‚<code>GG-NN</code> é€šè¿‡åœ¨é¡¶ç‚¹çŠ¶æ€ä¼ æ’­è¿‡ç¨‹ä¸­ä½¿ç”¨é—¨æ§å¾ªç¯å•å…ƒæ¥æ”¹è¿›è¿™ä¸€æ–¹æ³•ã€‚</p>
</li>
<li><p>å¦ä¸€ä¸ªæ–¹å‘æ˜¯å°†å·ç§¯æ¨å¹¿åˆ°å›¾é¢†åŸŸï¼Œæœ‰ä¸¤ç§æ¨å¹¿æ€è·¯ï¼šè°±æ–¹æ³•<code>spectral approach</code> ã€éè°±æ–¹æ³•<code>non-spectral approach</code> ã€‚</p>
<ul>
<li><p>è°±æ–¹æ³•é€šå¸¸å’Œå›¾çš„è°±è¡¨è¾¾<code>spectral representation</code> é…åˆä½¿ç”¨ï¼Œå¹¶å·²æˆåŠŸåº”ç”¨äºé¡¶ç‚¹åˆ†ç±»ã€‚</p>
<p>ä½†æ˜¯è¿™äº›è°±æ–¹æ³•ä¸­ï¼Œå­¦ä¹ çš„<code>filter</code> éƒ½ä¾èµ–äºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µåˆ†è§£åçš„ç‰¹å¾å‘é‡ã€‚è¿™ç§åˆ†è§£ä¾èµ–äºå…·ä½“çš„å›¾ç»“æ„ï¼Œå› æ­¤åœ¨ä¸€ç§å›¾ç»“æ„ä¸Šè®­ç»ƒçš„æ¨¡å‹æ— æ³•ç›´æ¥åº”ç”¨åˆ°å…·æœ‰ä¸åŒç»“æ„çš„å›¾ä¸Šã€‚</p>
<p>å¦å¤–ï¼Œè¯¥æ–¹æ³•æ— æ³•åº”ç”¨äº <code>graph-level</code> ä»»åŠ¡ï¼Œå› ä¸ºä¸åŒå›¾çš„ç»“æ„é€šå¸¸ä¸åŒï¼Œå› æ­¤æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µä¹Ÿä¸åŒã€‚</p>
</li>
<li><p>éè°±æ–¹æ³•å¯ä»¥ç›´æ¥åœ¨å›¾ä¸Šå®šä¹‰å·ç§¯ï¼Œä»è€Œå¯¹ç©ºé—´ç›¸é‚»çš„é‚»åŸŸé¡¶ç‚¹è¿›è¡Œè¿ç®—ã€‚</p>
<p>ä½†æ˜¯å¦‚ä½•å®šä¹‰ä¸€ç§å¯ä»¥å¤„ç†ä¸åŒæ•°é‡é‚»å±…é¡¶ç‚¹ã€ä¸”èƒ½ä¿æŒ <code>CNN</code> æƒé‡å…±äº«çš„å·ç§¯æ“ä½œæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚<code>PATCHY-SAN</code> é€šè¿‡å½’ä¸€åŒ–é‚»åŸŸå¾—åˆ°å›ºå®šå¤§å°çš„é‚»åŸŸã€‚</p>
</li>
</ul>
</li>
<li><p><code>attention</code> æœºåˆ¶åœ¨å¾ˆå¤šåŸºäºåºåˆ—çš„ä»»åŠ¡ä¸­å·²ç»ç§°ä¸ºæ ‡é…ã€‚æ³¨æ„åŠ›æœºåˆ¶çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å¤„ç†å˜é•¿è¾“å…¥ï¼Œå¹¶èšç„¦äºè¾“å…¥ä¸­æœ€ç›¸å…³çš„éƒ¨åˆ†æ¥åšå†³ç­–ã€‚å½“æ³¨æ„åŠ›æœºåˆ¶ä½œç”¨äºå•ä¸ªåºåˆ—çš„<code>representation</code> æ—¶ï¼Œé€šå¸¸ç§°ä½œ<code>self-attention</code> æˆ–è€… <code>intra-attention</code> ã€‚</p>
<p>å—æ­¤å¯å‘ï¼Œè®ºæ–‡ <code>ã€ŠGRAPH ATTENTION NETWORKSã€‹</code> æå‡ºäº†ä¸€ç§åŸºäºæ³¨æ„åŠ›çš„æ¶æ„ <code>Graph attention network:GAT</code> æ¥å¯¹å›¾ç»“æ„æ•°æ®è¿›è¡Œé¡¶ç‚¹åˆ†ç±»ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šé€šè¿‡<code>self-attention</code> ç­–ç•¥æ¥â€œæ³¨æ„â€é‚»å±…é¡¶ç‚¹ï¼Œä»è€Œè®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„ <code>representation</code> ã€‚</p>
<p><code>GAT</code> å †å äº†ä¸€äº› <code>masked self-attention layer</code> ï¼Œè¿™äº›å±‚ä¸­çš„é¡¶ç‚¹èƒ½å¤Ÿæ³¨æ„åˆ°é‚»å±…é¡¶ç‚¹çš„ç‰¹å¾ï¼Œå¹¶ç»™é‚»åŸŸä¸­ä¸åŒçš„é¡¶ç‚¹èµ‹äºˆä¸åŒæƒé‡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸éœ€è¦è¿›è¡Œä»»ä½•å¤æ‚çš„çŸ©é˜µæ“ä½œï¼ˆå¦‚çŸ©é˜µæ±‚é€†æˆ–è€…çŸ©é˜µåˆ†è§£ï¼‰ï¼Œä¹Ÿä¸éœ€è¦ä»»ä½•ä¾èµ–äºå›¾ç»“æ„çš„å…ˆéªŒçŸ¥è¯†ã€‚</p>
<p><code>GAT</code> æ¨¡å‹å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è®¡ç®—é«˜æ•ˆï¼Œå› ä¸º<code>GAT</code> å¯ä»¥åœ¨é¡¶ç‚¹é‚»å±…<code>pair</code> å¯¹ä¹‹é—´å¹¶è¡Œæ‰§è¡Œã€‚</li>
<li>é€šè¿‡å¯¹é‚»å±…é¡¶ç‚¹èµ‹äºˆä»»æ„æƒé‡ï¼Œå®ƒå¯ä»¥åº”ç”¨åˆ°ä»»æ„<code>degree</code> çš„é¡¶ç‚¹ï¼Œå¯¹ç½‘ç»œç»“æ„çš„æ™®é€‚æ€§æ›´å¼ºã€‚</li>
<li>è¯¥æ¨¡å‹å¯ä»¥ç›´æ¥åº”ç”¨äºå½’çº³å­¦ä¹ <code>inductive learning</code> é—®é¢˜ï¼ŒåŒ…æ‹¬å°†æ¨¡å‹æ¨å¹¿åˆ°ä»æœªè§è¿‡çš„å›¾ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p><code>inductive learning</code> å’Œ <code>transductive learning</code>çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p><code>inductive learning</code> æ˜¯ä»å…·ä½“æ ·æœ¬ä¸­æ€»ç»“æ™®é€‚æ€§è§„å¾‹ï¼Œç„¶åæ³›åŒ–åˆ°è®­ç»ƒä¸­ä»æœªè§è¿‡çš„æ ·æœ¬ã€‚</p>
</li>
<li><p><code>transductive learning</code> æ˜¯ä»å…·ä½“æ ·æœ¬ä¸­æ€»ç»“å…·ä½“æ€§è§„å¾‹ï¼Œå®ƒç”¨äºé¢„æµ‹è®­ç»ƒé›†ä¸­å·²ç»å‡ºç°è¿‡çš„<code>unlabelled</code> æ ·æœ¬ï¼Œå¸¸ç”¨äºåŠç›‘ç£å­¦ä¹ ã€‚</p>
<blockquote>
<p>åŠç›‘ç£å­¦ä¹ ä¸ä¸€å®šæ˜¯ <code>transductive</code>ï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯ <code>inductive</code> ã€‚å¦‚ï¼šè®­ç»ƒæ—¶ä»…è€ƒè™‘ <code>labelled</code> æ ·æœ¬ï¼Œä¸ä½¿ç”¨ä»»ä½• <code>unlabelled</code> æ ·æœ¬çš„ä¿¡æ¯ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">æ°å…‹æˆ</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/gnn.html">https://jackhcc.github.io/posts/gnn.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="https://jackhcc.github.io" target="_blank">æ°å…‹æˆ</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/GNN/">
                                    <span class="chip bg-color">GNN</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>è¯„è®º</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-08-24T21-32-27',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/posts/Database-Sqlite.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/7.jpg" class="responsive-img" alt="SQLiteè¯¦è§£">
                        
                        <span class="card-title">SQLiteè¯¦è§£</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            SQLiteæ•°æ®åº“è¯¦è§£
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-25
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Database/" class="post-category">
                                    Database
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/SQLite/">
                        <span class="chip bg-color">SQLite</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/gan.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/17.jpg" class="responsive-img" alt="GANè¯¦è§£">
                        
                        <span class="card-title">GANè¯¦è§£</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            GAN å­¦ä¹ çºªå½•
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-08-23
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/GAN/">
                        <span class="chip bg-color">GAN</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- ä»£ç å—æŠ˜è¡Œ -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>


    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">æ°å…‹æˆ</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;å­—
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;æ¬¡
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;äºº
            </span>
            
            <br>
            
            <span id="sitetime">è½½å…¥è¿è¡Œæ—¶é—´...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffDays + " å¤© " + diffHours +
                            " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffYears + " å¹´ " + diffDays +
                            " å¤© " + diffHours + " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„å¾®åš: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„çŸ¥ä¹: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">çŸ¥</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //åªåœ¨æ¡Œé¢ç‰ˆç½‘é¡µå¯ç”¨ç‰¹æ•ˆ
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

