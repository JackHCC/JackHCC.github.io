<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Python Module, JackHCC">
    <meta name="description" content="Python好用的小众模块">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Python Module | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Python Module</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Python/" class="post-category">
                                Python
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-10-03
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-12-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    22.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    92 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="PySnooper-不要使用print进行调试"><a href="#PySnooper-不要使用print进行调试" class="headerlink" title="PySnooper - 不要使用print进行调试"></a>PySnooper - 不要使用print进行调试</h1><p><a href="https://github.com/cool-RR/pysnooper" target="_blank" rel="noopener">Pysnooper API</a></p>
<p><strong>PySnooper</strong> 是一个非常方便的调试器。如果您正在试图弄清楚为什么您的Python代码没有按照您的预期去做，您会希望使用具有断点和监视功能的成熟Debug工具，但是许多Debug工具配置起来非常麻烦。</p>
<p>现在，有了PySnooper，您并不需要配置那么复杂的Debug工具，就能够完成对整个代码的分析。它能告诉您哪些代码正在运行，以及局部变量的值是什么。</p>
<p>其实，PySnooper 就是替代了一行一行print的重复性工作，给你的代码一个pysnooper装饰器，它能自动识别到语句和变量并将其值print出来：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pysnooper

@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">number_to_bits</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> number<span class="token punctuation">:</span>
        bits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">while</span> number<span class="token punctuation">:</span>
            number<span class="token punctuation">,</span> remainder <span class="token operator">=</span> divmod<span class="token punctuation">(</span>number<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            bits<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> remainder<span class="token punctuation">)</span>
        <span class="token keyword">return</span> bits
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

number_to_bits<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>效果如下：</p>
<pre><code>Source path:... 1.py
Starting var:.. number = 6
23:03:35.990701 call         4 def number_to_bits(number):
23:03:35.991699 line 5     if number:
23:03:35.991699 line 6         bits = []
New var:....... bits = []
23:03:35.991699 line 7         while number:
23:03:35.991699 line 8             number, remainder = divmod(number, 2)
Modified var:.. number = 3
New var:....... remainder = 0
23:03:35.991699 line 9             bits.insert(0, remainder)
Modified var:.. bits = [0]
23:03:36.004664 line 7         while number:
23:03:36.005661 line 8             number, remainder = divmod(number, 2)
Modified var:.. number = 1
Modified var:.. remainder = 1
23:03:36.005661 line 9             bits.insert(0, remainder)
Modified var:.. bits = [1, 0]
23:03:36.007657 line 7         while number:
23:03:36.007657 line 8             number, remainder = divmod(number, 2)
Modified var:.. number = 0
23:03:36.008655 line 9             bits.insert(0, remainder)
Modified var:.. bits = [1, 1, 0]
23:03:36.008655 line 7         while number:
23:03:36.009651 line 10         return bits
23:03:36.009651 return      10         return bits
Return value:.. [1, 1, 0]
Elapsed time: 00:00:00.020945</code></pre><p>可以看到，它将每一行变量的值都输出到屏幕上，方便你调试代码。</p>
<p>仅仅需要写一行代码—使用装饰器就可以实现这个方便的调试功能，比起一行行写print，这可方便多了。</p>
<h3 id="0-安装模块"><a href="#0-安装模块" class="headerlink" title="0. 安装模块"></a><strong>0. 安装模块</strong></h3><p>使用这个模块，你只需要使用Pip安装PySnooper：</p>
<pre><code>pip install pysnooper</code></pre><p>接下来讲讲这个模块其他好用的功能：</p>
<h3 id="1-支持日志文件"><a href="#1-支持日志文件" class="headerlink" title="1. 支持日志文件"></a><strong>1. 支持日志文件</strong></h3><p>如果你觉得print到屏幕上不方便，还可以将其输出到log文件中，你只需要将装饰器那一行改为：</p>
<pre class="line-numbers language-python"><code class="language-python">@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token string">'/my/log/file.log'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-读取局外变量或其他表达式"><a href="#2-读取局外变量或其他表达式" class="headerlink" title="2. 读取局外变量或其他表达式"></a><strong>2. 读取局外变量或其他表达式</strong></h3><p>如果你想读取在装饰器作用范围以外的变量或者表达式的值，还可以使用watch参数：</p>
<pre class="line-numbers language-python"><code class="language-python">@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span>watch<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'foo.bar'</span><span class="token punctuation">,</span> <span class="token string">'self.x["whatever"]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="3-如果你不想用装饰器，也可以用上下文的形式调试"><a href="#3-如果你不想用装饰器，也可以用上下文的形式调试" class="headerlink" title="3. 如果你不想用装饰器，也可以用上下文的形式调试"></a><strong>3. 如果你不想用装饰器，也可以用上下文的形式调试</strong></h3><p>没错，装饰器有限定的使用条件，使用起来比较局限，因此pysnooper还支持使用 with 的上下文形式：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pysnooper
<span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lower <span class="token operator">=</span> min<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>
        upper <span class="token operator">=</span> max<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>lower <span class="token operator">+</span> upper<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> upper<span class="token punctuation">)</span>

foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>效果如下，只有上下文里的代码才会被调试出来：</p>
<pre><code>New var:....... i = 9
New var:....... lst = [681, 267, 74, 832, 284, 678, ...]
09:37:35.881721 line 10         lower = min(lst)
New var:....... lower = 74
09:37:35.882137 line 11         upper = max(lst)
New var:....... upper = 832
09:37:35.882304 line 12         mid = (lower + upper) / 2
74 453.0 832
New var:....... mid = 453.0
09:37:35.882486 line 13         print(lower, mid, upper)
Elapsed time: 00:00:00.000344</code></pre><p>当我们只需要调试部分代码的时候，这个上下文形式的调试方法非常方便。</p>
<p>此外，PySnooper还有许多更强大的用法，大家可以看他们的高级使用文档：</p>
<p><a href="https://github.com/cool-RR/PySnooper/blob/master/ADVANCED_USAGE.md" target="_blank" rel="noopener">https://github.com/cool-RR/PySnooper/blob/master/ADVANCED_USAGE.md</a></p>
<h3 id="4-参数介绍"><a href="#4-参数介绍" class="headerlink" title="4. 参数介绍"></a>4. 参数介绍</h3><p>以装饰器的形式使用该工具，其包含了四个参数，参数包括output, variables, depth, prefix。</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022085544163.png" alt=""></p>
<p>1、output参数。该参数指定函数运行过程中产生的中间结果的保存位置，若该值为空，则将中间结果输出到控制台。</p>
<p>2、variables参数。该参数是vector类型, 因为在默认情况下，装饰器只跟踪局部变量，要跟踪非局部变量，则可以通过该字段来指定。默认值为空vector。</p>
<p>3、depth参数。该参数表示需要追踪的函数调用的深度。在很多时候，我们在函数中会调用其他函数，通过该参数就可以指定跟踪调用函数的深度。默认值为1。</p>
<p>4、prefix参数。该参数用于指定该函数接口的中间结果前缀。当多个函数都使用的该装饰器后，会将这些函数调用的中间结果保存到一个文件中，此时就可以通过前缀过滤不同函数调用的中间结果。默认值为空字符串。</p>
<h3 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h3><p><strong>1. output 参数使用</strong></p>
<p>若使用默认参数，则将中间结果输出到控制台，若填写该参数，则将中间结果写入到该参数指定的目录下，如运行以下代码，其中间结果会保存在装饰器snoop中设置日志保存的路径中，注意这里不会自动创建目录，所以需要事先创建目录，如测试代码中填写路径后需要创建log目录。</p>
<p>测试代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pysnooper

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2

@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token string">"./log/debug.log"</span><span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"--*--"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">multiplication</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sum_value <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sum_value <span class="token operator">=</span> add<span class="token punctuation">(</span>sum_value<span class="token punctuation">,</span> num2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sum_value

value <span class="token operator">=</span> multiplication<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行该代码后，在./log/debug.log的内容如下：</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022085750491.png" alt=""></p>
<p>从运行代码的中间结果中可以看出，文件中记录了各行代码的执行过程及局部变量的变化。在debug时，通过分析该文件，就可以跟踪每一步的执行过程及局部变量的变化，这样就能快速的定位问题所在；由于运行的中间结果保存在文件中，方便随时分析其运行的中间结果，也便于共享。</p>
<p><strong>2. variables参数使用</strong></p>
<p>在默认参数的情况下，使用该工具只能查看局变量的变化过程，当需要查看局部变量以外变量时，则可以通过variables参数进行设置，比如下方代码，在Foo类型，需要查看类实例的变量self.num1, self.num2, self.sum_value,则可以看将该变量设置当参数传入snoop的装饰器中。</p>
<p>测试代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pysnooper

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>num1 <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>num2 <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>sum_value <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
    @pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span>output<span class="token operator">=</span><span class="token string">"./log/debug.log"</span><span class="token punctuation">,</span> variables<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"self.num1"</span><span class="token punctuation">,</span> <span class="token string">"self.num2"</span><span class="token punctuation">,</span> <span class="token string">"self.sum_value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">multiplication</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>num1 <span class="token operator">=</span> num1
        self<span class="token punctuation">.</span>num2 <span class="token operator">=</span> num2
        sum_value <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">:</span>
            sum_value <span class="token operator">=</span> self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>sum_value<span class="token punctuation">,</span> num2<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sum_value <span class="token operator">=</span> sum_value
        <span class="token keyword">return</span> sum_value

foo <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
foo<span class="token punctuation">.</span>multiplication<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到的结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022085926269.png" alt=""></p>
<p>从两个中间结果中可以看出，若变量不是局部变量，哪怕在函数中使用了该变量，如果不显示设置打印该变量的中间结果，则不会将该变量的中间结果打印到文件中。</p>
<p><strong>3. depth参数使用</strong></p>
<p>该参数用来指定记录函数调用层数的结果，默认值为1，若要查看多层函数调用的中间结果，则可将该参数设置为&gt;=2。</p>
<p>测试代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pysnooper

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2

@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token string">"./log/debug.log"</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">multiplication</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sum_value <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sum_value <span class="token operator">=</span> add<span class="token punctuation">(</span>sum_value<span class="token punctuation">,</span> num2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sum_value

value <span class="token operator">=</span> multiplication<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022090058500.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022090112215.png" alt=""></p>
<p>从上述结果中可以看出，若要查看更深层次函数调用的情况，则可以通过设置depth值进行查看。这样方便用户有选择性的查看函数的调用情况。</p>
<p><strong>4. prefix参数使用</strong></p>
<p>该参数主要用于设置中间结果的前缀，这样就可以区分不同的函数调用的中间结果，默认参数为””。</p>
<p>测试代码：</p>
<pre class="line-numbers language-python"><code class="language-python">
<span class="token keyword">import</span> pysnooper

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2

@pysnooper<span class="token punctuation">.</span>snoop<span class="token punctuation">(</span><span class="token string">"./log/debug.log"</span><span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"--*--"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">multiplication</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sum_value <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sum_value <span class="token operator">=</span> add<span class="token punctuation">(</span>sum_value<span class="token punctuation">,</span> num2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sum_value

value <span class="token operator">=</span> multiplication<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行代码后的中间结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/ML/image-20211022090155260.png" alt=""></p>
<p>从结果中可以看到，中间结果的每一行都包含了prefix设置的前缀，这样便于区分不同的函数调用的中间结果。</p>
<p>上述的介绍为了将注意力集中到具体的参数，采取设置单一参数的形式进行介绍（output+其他单个参数）。在实际使用时，可以同时设置多个参数。使用PySnooper工具来记录函数运行的中间结果，比起传统的使用断点+单步调试，pdb等调试方法，PySnooper工具有着巨大的优势。</p>
<p><strong>该工具的不足之处</strong></p>
<p>虽然使用debug在使用PySnooper很方便，但还是存在一些问题（以4月26号拉取代码为依据），比如：</p>
<p>1、无法很好的支持递归调用。</p>
<p>2、调用每个函数的中间结果只能保存在一个文件中，如果需要区分不同文件的结果，需要使用prefix来进行前缀标识。</p>
<p>3、对于跨文件函数调用，不支持记录调用函数所在的文件名。</p>
<p>当然PySnooper是最近在github上火起来的项目，还不够完善是正常的，相信这些不足之处后续也会得到完善，期待一个更好的PySnooper。</p>
<h1 id="Itertools-迭代器（生成器）"><a href="#Itertools-迭代器（生成器）" class="headerlink" title="Itertools - 迭代器（生成器）"></a>Itertools - 迭代器（生成器）</h1><p><a href="https://docs.python.org/3/library/itertools.html" target="_blank" rel="noopener">Itertools API</a></p>
<p>很多人都致力于把Python代码写得更Pythonic，一来更符合规范且容易阅读，二来一般Pythonic的代码在执行上也更有效率。</p>
<h3 id="itertools库"><a href="#itertools库" class="headerlink" title="itertools库"></a><strong>itertools库</strong></h3><p>迭代器（生成器）在Python中是一种很常用也很好用的数据结构，比起列表(list)来说，迭代器最大的优势就是延迟计算，按需使用，从而提高开发体验和运行效率，以至于在Python 3中map,filter等操作返回的不再是列表而是迭代器。</p>
<p>话虽这么说但大家平时用到的迭代器大概只有range了，而通过iter函数把列表对象转化为迭代器对象又有点多此一举，这时候我们今天的主角itertools就该上场了。</p>
<h3 id="使用itertools"><a href="#使用itertools" class="headerlink" title="使用itertools"></a><strong>使用itertools</strong></h3><p>itertools中的函数大多是返回各种迭代器对象，其中很多函数的作用我们平时要写很多代码才能达到，而在运行效率上反而更低，毕竟人家是系统库。</p>
<h3 id="itertools-accumulate"><a href="#itertools-accumulate" class="headerlink" title="itertools.accumulate"></a><strong>itertools.accumulate</strong></h3><p>简单来说就是累加。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> itertools
<span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-chain"><a href="#itertools-chain" class="headerlink" title="itertools.chain"></a><strong>itertools.chain</strong></h3><p>连接多个列表或者迭代器。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-combinations"><a href="#itertools-combinations" class="headerlink" title="itertools.combinations"></a><strong>itertools.combinations</strong></h3><p>求列表或生成器中指定数目的元素不重复的所有组合</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>combinations<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-combinations-with-replacement"><a href="#itertools-combinations-with-replacement" class="headerlink" title="itertools.combinations_with_replacement"></a><strong>itertools.combinations_with_replacement</strong></h3><p>允许重复元素的组合</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>combinations_with_replacement<span class="token punctuation">(</span> ABC <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span> A <span class="token punctuation">,</span>  A <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> A <span class="token punctuation">,</span>  B <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> A <span class="token punctuation">,</span>  C <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> B <span class="token punctuation">,</span>  B <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> B <span class="token punctuation">,</span>  C <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> C <span class="token punctuation">,</span>  C <span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-compress"><a href="#itertools-compress" class="headerlink" title="itertools.compress"></a><strong>itertools.compress</strong></h3><p>按照真值表筛选元素</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-count"><a href="#itertools-count" class="headerlink" title="itertools.count"></a><strong>itertools.count</strong></h3><p>就是一个计数器,可以指定起始位置和步长</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-cycle"><a href="#itertools-cycle" class="headerlink" title="itertools.cycle"></a><strong>itertools.cycle</strong></h3><p>循环指定的列表和迭代器</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>cycle<span class="token punctuation">(</span> ABC <span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> A <span class="token punctuation">,</span>  B <span class="token punctuation">,</span>  C <span class="token punctuation">,</span>  A <span class="token punctuation">,</span>  B <span class="token punctuation">,</span>  C <span class="token punctuation">,</span>  A <span class="token punctuation">,</span>  B <span class="token punctuation">,</span>  C <span class="token punctuation">,</span>  A <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-dropwhile"><a href="#itertools-dropwhile" class="headerlink" title="itertools.dropwhile"></a><strong>itertools.dropwhile</strong></h3><p>按照真值函数丢弃掉列表和迭代器前面的元素</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>dropwhile<span class="token punctuation">(</span><span class="token keyword">lambda</span> e<span class="token punctuation">:</span> e <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-filterfalse"><a href="#itertools-filterfalse" class="headerlink" title="itertools.filterfalse"></a><strong>itertools.filterfalse</strong></h3><p>保留对应真值为False的元素</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>filterfalse<span class="token punctuation">(</span><span class="token keyword">lambda</span> e<span class="token punctuation">:</span> e <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-groupby"><a href="#itertools-groupby" class="headerlink" title="itertools.groupby"></a><strong>itertools.groupby</strong></h3><p>按照分组函数的值对元素进行分组</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">or</span> x <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span>                                                                                                
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> condition<span class="token punctuation">,</span> numbers <span class="token keyword">in</span> x<span class="token punctuation">:</span>                                                  
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> list<span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">)</span>                                                                                                        
<span class="token boolean">True</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                                                              
<span class="token boolean">False</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>                                                                
<span class="token boolean">True</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-islice"><a href="#itertools-islice" class="headerlink" title="itertools.islice"></a><strong>itertools.islice</strong></h3><p>上文使用过的函数，对迭代器进行切片</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>islice<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-permutations"><a href="#itertools-permutations" class="headerlink" title="itertools.permutations"></a><strong>itertools.permutations</strong></h3><p>产生指定数目的元素的所有排列(顺序有关)</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-product"><a href="#itertools-product" class="headerlink" title="itertools.product"></a><strong>itertools.product</strong></h3><p>产生多个列表和迭代器的(积)</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span> ABC <span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span> A <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> A <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> A <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> B <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> B <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> B <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> C <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> C <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> C <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-repeat"><a href="#itertools-repeat" class="headerlink" title="itertools.repeat"></a><strong>itertools.repeat</strong></h3><p>简单的生成一个拥有指定数目元素的迭代器</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-starmap"><a href="#itertools-starmap" class="headerlink" title="itertools.starmap"></a><strong>itertools.starmap</strong></h3><p>类似map</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>starmap<span class="token punctuation">(</span>str<span class="token punctuation">.</span>islower<span class="token punctuation">,</span>  aBCDefGhI <span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-takewhile"><a href="#itertools-takewhile" class="headerlink" title="itertools.takewhile"></a><strong>itertools.takewhile</strong></h3><p>与dropwhile相反，保留元素直至真值函数值为假。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>takewhile<span class="token punctuation">(</span><span class="token keyword">lambda</span> e<span class="token punctuation">:</span> e <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-tee"><a href="#itertools-tee" class="headerlink" title="itertools.tee"></a><strong>itertools.tee</strong></h3><p>生成指定数目的迭代器</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>tee<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> letters <span class="token keyword">in</span> x<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>letters<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="itertools-zip-longest"><a href="#itertools-zip-longest" class="headerlink" title="itertools.zip_longest"></a><strong>itertools.zip_longest</strong></h3><p>类似于zip，不过已较长的列表和迭代器的长度为准</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> itertools<span class="token punctuation">.</span>zip_longest<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> zip<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>None<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>None<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Asyncio-异步-IO"><a href="#Asyncio-异步-IO" class="headerlink" title="Asyncio - 异步 IO"></a>Asyncio - 异步 IO</h1><p><a href="https://docs.python.org/3/library/asyncio.html" target="_blank" rel="noopener">Asyncio API</a></p>
<p>所谓「异步 IO」，就是你发起一个 IO 操作，却不用等它结束，你可以继续做其他事情，当它结束时，你会得到通知。</p>
<p>Asyncio 是并发（concurrency）的一种方式。对 Python 来说，并发还可以通过线程（threading）和多进程（multiprocessing）来实现。</p>
<p>Asyncio 并不能带来真正的并行（parallelism）。当然，因为 GIL（全局解释器锁）的存在，Python 的多线程也不能带来真正的并行。</p>
<p>可交给 asyncio 执行的任务，称为协程（coroutine）。一个协程可以放弃执行，把机会让给其它协程（即 <code>yield from</code> 或 <code>await</code>）。</p>
<h2 id="1-定义协程"><a href="#1-定义协程" class="headerlink" title="1. 定义协程"></a>1. 定义协程</h2><p>协程的定义，需要使用 <code>async def</code> 语句。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>do_some_work</code> 便是一个协程。<br>准确来说，<code>do_some_work</code> 是一个协程函数，可以通过 <code>asyncio.iscoroutinefunction</code> 来验证：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>iscoroutinefunction<span class="token punctuation">(</span>do_some_work<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个协程什么都没做，我们让它睡眠几秒，以模拟实际的工作量 ：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting "</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在解释 <code>await</code> 之前，有必要说明一下协程可以做哪些事。协程可以：</p>
<ul>
<li>等待一个 future 结束</li>
<li>等待另一个协程（产生一个结果，或引发一个异常）</li>
<li>产生一个结果给正在等它的协程</li>
<li>引发一个异常给正在等它的协程</li>
</ul>
<p><code>asyncio.sleep</code> 也是一个协程，所以 <code>await asyncio.sleep(x)</code> 就是等待另一个协程。可参见 <code>asyncio.sleep</code> 的文档：</p>
<pre class="line-numbers language-python"><code class="language-python">sleep<span class="token punctuation">(</span>delay<span class="token punctuation">,</span> result<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> loop<span class="token operator">=</span>None<span class="token punctuation">)</span>
Coroutine that completes after a given time <span class="token punctuation">(</span><span class="token keyword">in</span> seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="2-运行协程"><a href="#2-运行协程" class="headerlink" title="2. 运行协程"></a>2. 运行协程</h2><p>调用协程函数，协程并不会开始运行，只是返回一个协程对象，可以通过 <code>asyncio.iscoroutine</code> 来验证：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>iscoroutine<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此处还会引发一条警告：</p>
<pre><code>async1.py:16: RuntimeWarning: coroutine 'do_some_work' was never awaited
  print(asyncio.iscoroutine(do_some_work(3)))</code></pre><p>要让这个协程对象运行的话，有两种方式：</p>
<ul>
<li>在另一个已经运行的协程中用 <code>await</code> 等待它</li>
<li>通过 <code>ensure_future</code> 函数计划它的执行</li>
</ul>
<p>简单来说，只有 loop 运行了，协程才可能运行。<br>下面先拿到当前线程缺省的 loop ，然后把协程对象交给 <code>loop.run_until_complete</code>，协程对象随后会在 loop 里得到运行。</p>
<pre class="line-numbers language-python"><code class="language-python">loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>run_until_complete</code> 是一个阻塞（blocking）调用，直到协程运行结束，它才返回。这一点从函数名不难看出。<br><code>run_until_complete</code> 的参数是一个 future，但是我们这里传给它的却是协程对象，之所以能这样，是因为它在内部做了检查，通过 <code>ensure_future</code> 函数把协程对象包装（wrap）成了 future。所以，我们可以写得更明显一些：</p>
<pre class="line-numbers language-python"><code class="language-python">loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>完整代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting "</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行结果：</p>
<pre><code>Waiting 3
&lt;三秒钟后程序结束&gt;</code></pre><h2 id="3-回调函数"><a href="#3-回调函数" class="headerlink" title="3. 回调函数"></a>3. 回调函数</h2><p>假如协程是一个 IO 的读操作，等它读完数据后，我们希望得到通知，以便下一步数据的处理。这一需求可以通过往 future 添加回调来实现。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">done_callback</span><span class="token punctuation">(</span>futu<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>

futu <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
futu<span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>done_callback<span class="token punctuation">)</span>

loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>futu<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-多个协程"><a href="#4-多个协程" class="headerlink" title="4. 多个协程"></a>4. 多个协程</h2><p>实际项目中，往往有多个协程，同时在一个 loop 里运行。为了把多个协程交给 loop，需要借助 <code>asyncio.gather</code> 函数。</p>
<pre class="line-numbers language-python"><code class="language-python">loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者先把协程存在列表里：</p>
<pre class="line-numbers language-python"><code class="language-python">coros <span class="token operator">=</span> <span class="token punctuation">[</span>do_some_work<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>coros<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>运行结果：</p>
<pre><code>Waiting 3
Waiting 1
&lt;等待三秒钟&gt;
Done</code></pre><p>这两个协程是并发运行的，所以等待的时间不是 1 + 3 = 4 秒，而是以耗时较长的那个协程为准。</p>
<p>参考函数 <code>gather</code> 的文档：</p>
<blockquote>
<p>gather(*coros_or_futures, loop=None, return_exceptions=False)<br>Return a future aggregating results from the given coroutines or futures.</p>
</blockquote>
<p>发现也可以传 futures 给它：</p>
<pre class="line-numbers language-python"><code class="language-python">futus <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>futus<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>gather</code> 起聚合的作用，把多个 futures 包装成单个 future，因为 <code>loop.run_until_complete</code> 只接受单个 future。</p>
<h2 id="5-run-until-complete和run-forever"><a href="#5-run-until-complete和run-forever" class="headerlink" title="5. run_until_complete和run_forever"></a>5. run_until_complete和run_forever</h2><p>我们一直通过 <code>run_until_complete</code> 来运行 loop ，等到 future 完成，<code>run_until_complete</code> 也就返回了。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

coro <span class="token operator">=</span> do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>coro<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：</p>
<pre><code>Waiting 3
&lt;等待三秒钟&gt;
Done
&lt;程序退出&gt;</code></pre><p>现在改用 <code>run_forever</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

coro <span class="token operator">=</span> do_some_work<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>coro<span class="token punctuation">)</span>

loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：</p>
<pre><code>Waiting 3
&lt;等待三秒钟&gt;
Done
&lt;程序没有退出&gt;</code></pre><p>三秒钟过后，future 结束，但是程序并不会退出。<code>run_forever</code> 会一直运行，直到 <code>stop</code> 被调用，但是你不能像下面这样调 <code>stop</code>：</p>
<pre class="line-numbers language-python"><code class="language-python">loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>run_forever</code> 不返回，<code>stop</code> 永远也不会被调用。所以，只能在协程中调 <code>stop</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>
    loop<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样并非没有问题，假如有多个协程在 loop 里运行：</p>
<pre class="line-numbers language-python"><code class="language-python">asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>第二个协程没结束，loop 就停止了——被先结束的那个协程给停掉的。<br>要解决这个问题，可以用 <code>gather</code> 把多个协程合并成一个 future，并添加回调，然后在回调里再去停止 loop。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_some_work</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">done_callback</span><span class="token punctuation">(</span>loop<span class="token punctuation">,</span> futu<span class="token punctuation">)</span><span class="token punctuation">:</span>
    loop<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

futus <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
futus<span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>done_callback<span class="token punctuation">,</span> loop<span class="token punctuation">)</span><span class="token punctuation">)</span>

loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其实这基本上就是 <code>run_until_complete</code> 的实现了，<code>run_until_complete</code> 在内部也是调用 <code>run_forever</code>。</p>
<h2 id="6-Close-Loop"><a href="#6-Close-Loop" class="headerlink" title="6. Close Loop?"></a>6. Close Loop?</h2><p>以上示例都没有调用 <code>loop.close</code>，好像也没有什么问题。所以到底要不要调 <code>loop.close</code> 呢？<br>简单来说，loop 只要不关闭，就还可以再运行。：</p>
<pre class="line-numbers language-python"><code class="language-python">loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>但是如果关闭了，就不能再运行了：</p>
<pre class="line-numbers language-python"><code class="language-python">loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 此处异常</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>建议调用 <code>loop.close</code>，以彻底清理 loop 对象防止误用。</p>
<h2 id="7-gather-和-wait"><a href="#7-gather-和-wait" class="headerlink" title="7. gather 和 wait"></a>7. gather 和 wait</h2><p><code>asyncio.gather</code> 和 <code>asyncio.wait</code> 功能相似。</p>
<pre class="line-numbers language-python"><code class="language-python">coros <span class="token operator">=</span> <span class="token punctuation">[</span>do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> do_some_work<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>coros<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>具体差别可请参见 StackOverflow 的讨论：Asyncio.gather vs asyncio.wait。</p>
<h2 id="8-Timer"><a href="#8-Timer" class="headerlink" title="8. Timer"></a>8. Timer</h2><p>C++ Boost.Asio 提供了 IO 对象 timer，但是 Python 并没有原生支持 timer，不过可以用 <code>asyncio.sleep</code> 模拟。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">:</span>
    futu <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    futu<span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
    <span class="token keyword">await</span> futu

t <span class="token operator">=</span> timer<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> futu<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Done'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="FuzzyWuzzy-模糊字符串匹配"><a href="#FuzzyWuzzy-模糊字符串匹配" class="headerlink" title="FuzzyWuzzy - 模糊字符串匹配"></a>FuzzyWuzzy - 模糊字符串匹配</h1><p><a href="https://www.geeksforgeeks.org/fuzzywuzzy-python-library/#:~:text=FuzzyWuzzy%20is%20a%20library%20of%20Python%20which%20is,a%20service%20to%20find%20sport%20and%20concert%20tickets." target="_blank" rel="noopener">FuzzyWuzzy API</a></p>
<h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h2><p>最常见的一个例子就是：在进行地理可视化中，自己收集的数据只保留的缩写，比如北京，广西，新疆，西藏等，但是待匹配的字段数据却是北京市，广西壮族自治区，新疆维吾尔自治区，西藏自治区等，如下。因此就需要有没有一种方式可以很快速便捷的直接进行对应字段的匹配并将结果单独生成一列，就可以用到 <strong>FuzzyWuzzy</strong> 库。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104111011944.png" alt=""></p>
<h2 id="2-FuzzyWuzzy库介绍"><a href="#2-FuzzyWuzzy库介绍" class="headerlink" title="2. FuzzyWuzzy库介绍"></a>2. FuzzyWuzzy库介绍</h2><p>FuzzyWuzzy 是一个简单易用的模糊字符串匹配工具包。它依据 Levenshtein Distance 算法，计算两个序列之间的差异。</p>
<p>Levenshtein Distance算法，又叫 Edit Distance算法，是指两个字符串之间，由一个转成另一个所需的最少编辑操作次数。许可的编辑操作包括将一个字符替换成另一个字符，插入一个字符，删除一个字符。一般来说，编辑距离越小，两个串的相似度越大。</p>
<p>这里使用的是Anaconda下的jupyter notebook编程环境，因此在Anaconda的命令行中输入一下指令进行第三方库安装。</p>
<pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple FuzzyWuzzy</code></pre><h3 id="fuzz模块"><a href="#fuzz模块" class="headerlink" title="fuzz模块"></a>fuzz模块</h3><p>该模块下主要介绍四个函数（方法），分别为：简单匹配（Ratio）、非完全匹配（Partial Ratio）、忽略顺序匹配（Token Sort Ratio）和去重子集匹配（Token Set Ratio）</p>
<p>注意： 如果直接导入这个模块的话，系统会提示warning，当然这不代表报错，程序依旧可以运行（使用的默认算法，执行速度较慢），可以按照系统的提示安装python-Levenshtein库进行辅助，这有利于提高计算的速度。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104111224743.png" alt=""></p>
<h4 id="简单匹配（Ratio）"><a href="#简单匹配（Ratio）" class="headerlink" title="简单匹配（Ratio）"></a>简单匹配（Ratio）</h4><p>简单的了解一下就行，这个不怎么精确，也不常用</p>
<pre><code>fuzz.ratio("河南省", "河南省")&gt;&gt;&gt; 100&gt;fuzz.ratio("河南", "河南省")&gt;&gt;&gt; 80</code></pre><h4 id="非完全匹配（Partial-Ratio）"><a href="#非完全匹配（Partial-Ratio）" class="headerlink" title="非完全匹配（Partial Ratio）"></a><strong>非完全匹配（Partial Ratio）</strong></h4><p>尽量使用非完全匹配，精度较高</p>
<pre class="line-numbers language-python"><code class="language-python">fuzz<span class="token punctuation">.</span>partial_ratio<span class="token punctuation">(</span><span class="token string">"河南省"</span><span class="token punctuation">,</span> <span class="token string">"河南省"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span>

fuzz<span class="token punctuation">.</span>partial_ratio<span class="token punctuation">(</span><span class="token string">"河南"</span><span class="token punctuation">,</span> <span class="token string">"河南省"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="忽略顺序匹配（Token-Sort-Ratio）"><a href="#忽略顺序匹配（Token-Sort-Ratio）" class="headerlink" title="忽略顺序匹配（Token Sort Ratio）"></a><strong>忽略顺序匹配（Token Sort Ratio）</strong></h4><p>原理在于：以 空格 为分隔符，小写 化所有字母，无视空格外的其它标点符号</p>
<pre class="line-numbers language-python"><code class="language-python">fuzz<span class="token punctuation">.</span>ratio<span class="token punctuation">(</span><span class="token string">"西藏 自治区"</span><span class="token punctuation">,</span> <span class="token string">"自治区 西藏"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">50</span>
fuzz<span class="token punctuation">.</span>ratio<span class="token punctuation">(</span><span class="token string">'I love YOU'</span><span class="token punctuation">,</span><span class="token string">'YOU LOVE I'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">30</span>

fuzz<span class="token punctuation">.</span>token_sort_ratio<span class="token punctuation">(</span><span class="token string">"西藏 自治区"</span><span class="token punctuation">,</span> <span class="token string">"自治区 西藏"</span><span class="token punctuation">)</span> 
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span>
fuzz<span class="token punctuation">.</span>token_sort_ratio<span class="token punctuation">(</span><span class="token string">'I love YOU'</span><span class="token punctuation">,</span><span class="token string">'YOU LOVE I'</span><span class="token punctuation">)</span> 
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="去重子集匹配（Token-Set-Ratio）"><a href="#去重子集匹配（Token-Set-Ratio）" class="headerlink" title="去重子集匹配（Token Set Ratio）"></a><strong>去重子集匹配（Token Set Ratio）</strong></h4><p>相当于比对之前有一个集合去重的过程，注意最后两个，可理解为该方法是在token_sort_ratio方法的基础上添加了集合去重的功能，下面三个匹配的都是倒序。</p>
<pre class="line-numbers language-python"><code class="language-python">fuzz<span class="token punctuation">.</span>ratio<span class="token punctuation">(</span><span class="token string">"西藏 西藏 自治区"</span><span class="token punctuation">,</span> <span class="token string">"自治区 西藏"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">40</span>

fuzz<span class="token punctuation">.</span>token_sort_ratio<span class="token punctuation">(</span><span class="token string">"西藏 西藏 自治区"</span><span class="token punctuation">,</span> <span class="token string">"自治区 西藏"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">80</span>

fuzz<span class="token punctuation">.</span>token_set_ratio<span class="token punctuation">(</span><span class="token string">"西藏 西藏 自治区"</span><span class="token punctuation">,</span> <span class="token string">"自治区 西藏"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>fuzz这几个ratio()函数（方法）最后得到的结果都是数字，如果需要获得匹配度最高的字符串结果，还需要依旧自己的数据类型选择不同的函数，然后再进行结果提取，如果但看文本数据的匹配程度使用这种方式是可以量化的，但是对于我们要提取匹配的结果来说就不是很方便了，因此就有了process模块。</p>
<h3 id="process模块"><a href="#process模块" class="headerlink" title="process模块"></a><strong>process模块</strong></h3><p>用于处理备选答案有限的情况，返回模糊匹配的字符串和相似度。</p>
<h4 id="extract提取多条数据"><a href="#extract提取多条数据" class="headerlink" title="extract提取多条数据"></a><strong>extract提取多条数据</strong></h4><p>类似于爬虫中select，返回的是列表，其中会包含很多匹配的数据</p>
<pre class="line-numbers language-python"><code class="language-python">choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"河南省"</span><span class="token punctuation">,</span> <span class="token string">"郑州市"</span><span class="token punctuation">,</span> <span class="token string">"湖北省"</span><span class="token punctuation">,</span> <span class="token string">"武汉市"</span><span class="token punctuation">]</span>
process<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token string">"郑州"</span><span class="token punctuation">,</span> choices<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'郑州市'</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'河南省'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># extract之后的数据类型是列表，即使limit=1，最后还是列表，注意和下面extractOne的区别</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="extractOne提取一条数据"><a href="#extractOne提取一条数据" class="headerlink" title="extractOne提取一条数据"></a><strong>extractOne提取一条数据</strong></h4><p>如果要提取匹配度最大的结果，可以使用extractOne，注意这里返回的是 元组 类型， 还有就是匹配度最大的结果不一定是我们想要的数据，可以通过下面的示例和两个实战应用体会一下。</p>
<pre class="line-numbers language-python"><code class="language-python">process<span class="token punctuation">.</span>extractOne<span class="token punctuation">(</span><span class="token string">"郑州"</span><span class="token punctuation">,</span> choices<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">'郑州市'</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span>extractOne<span class="token punctuation">(</span><span class="token string">"北京"</span><span class="token punctuation">,</span> choices<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">'湖北省'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-实战应用"><a href="#3-实战应用" class="headerlink" title="3. 实战应用"></a>3. <strong>实战应用</strong></h2><p>这里举两个实战应用的小例子，第一个是公司名称字段的模糊匹配，第二个是省市字段的模糊匹配</p>
<h3 id="公司名称字段模糊匹配"><a href="#公司名称字段模糊匹配" class="headerlink" title="公司名称字段模糊匹配"></a><strong>公司名称字段模糊匹配</strong></h3><p>数据及待匹配的数据样式如下：自己获取到的数据字段的名称很简洁，并不是公司的全称，因此需要进行两个字段的合并</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104111716442.png" alt=""></p>
<p>直接将代码封装为函数，主要是为了方便日后的调用，这里参数设置的比较详细，执行结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104111745993.png" alt=""></p>
<h4 id="参数讲解："><a href="#参数讲解：" class="headerlink" title="参数讲解："></a><strong>参数讲解：</strong></h4><p>① 第一个参数df_1是自己获取的欲合并的左侧数据（这里是data变量）；</p>
<p>② 第二个参数df_2是待匹配的欲合并的右侧数据（这里是company变量）；</p>
<p>③ 第三个参数key1是df_1中要处理的字段名称（这里是data变量里的‘公司名称’字段）</p>
<p>④ 第四个参数key2是df_2中要匹配的字段名称（这里是company变量里的‘公司名称’字段）</p>
<p>⑤ 第五个参数threshold是设定提取结果匹配度的标准。注意这里就是对extractOne方法的完善，提取到的最大匹配度的结果并不一定是我们需要的，所以需要设定一个阈值来评判，这个值就为90，只有是大于等于90，这个匹配结果我们才可以接受</p>
<p>⑥ 第六个参数，默认参数就是只返回两个匹配成功的结果</p>
<p>⑦ 返回值：为df_1添加‘matches’字段后的新的DataFrame数据</p>
<h4 id="核心代码讲解"><a href="#核心代码讲解" class="headerlink" title="核心代码讲解"></a><strong>核心代码讲解</strong></h4><p>第一部分代码如下，可以参考上面讲解process.extract方法，这里就是直接使用，所以返回的结果m就是列表中嵌套元祖的数据格式，样式为: [(‘郑州市’, 90), (‘河南省’, 0)]，因此第一次写入到’matches’字段中的数据也就是这种格式</p>
<p>注意，注意： 元祖中的第一个是匹配成功的字符串，第二个就是设置的threshold参数比对的数字对象</p>
<pre class="line-numbers language-python"><code class="language-python">s <span class="token operator">=</span> df_2<span class="token punctuation">[</span>key2<span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> df_1<span class="token punctuation">[</span>key1<span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> process<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>x<span class="token punctuation">,</span> s<span class="token punctuation">,</span> limit<span class="token operator">=</span>limit<span class="token punctuation">)</span><span class="token punctuation">)</span>    
df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span> <span class="token operator">=</span> m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>第二部分的核心代码如下，有了上面的梳理，明确了‘matches’字段中的数据类型，然后就是进行数据的提取了，需要处理的部分有两点需要注意的：</p>
<p>① 提取匹配成功的字符串，并对阈值小于90的数据填充空值</p>
<p>② 最后把数据添加到‘matches’字段</p>
<pre class="line-numbers language-python"><code class="language-python">
m2 <span class="token operator">=</span> df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> threshold<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> len<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> threshold<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#要理解第一个‘matches’字段返回的数据类型是什么样子的，就不难理解这行代码了</span>
<span class="token comment" spellcheck="true">#参考一下这个格式：[('郑州市', 90), ('河南省', 0)]</span>
df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span> <span class="token operator">=</span> m2

<span class="token keyword">return</span> df_1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="省份字段模糊匹配"><a href="#省份字段模糊匹配" class="headerlink" title="省份字段模糊匹配"></a><strong>省份字段模糊匹配</strong></h3><p>自己的数据和待匹配的数据背景介绍中已经有图片显示了，上面也已经封装了模糊匹配的函数，这里直接调用上面的函数，输入相应的参数即可，代码以及执行结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211104112057594.png" alt=""></p>
<p>数据处理完成，经过封装后的函数可以直接放在自己自定义的模块名文件下面，以后可以方便直接导入函数名即可，可以参考将自定义常用的一些函数封装成可以直接调用的模块方法。</p>
<h2 id="4-全部函数代码"><a href="#4-全部函数代码" class="headerlink" title="4. 全部函数代码"></a><strong>4. 全部函数代码</strong></h2><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#模糊匹配</span>

<span class="token keyword">def</span> <span class="token function">fuzzy_merge</span><span class="token punctuation">(</span>df_1<span class="token punctuation">,</span> df_2<span class="token punctuation">,</span> key1<span class="token punctuation">,</span> key2<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param df_1: the left table to join
    :param df_2: the right table to join
    :param key1: key column of the left table
    :param key2: key column of the right table
    :param threshold: how close the matches should be to return a match, based on Levenshtein distance
    :param limit: the amount of matches that will get returned, these are sorted high to low
    :return: dataframe with boths keys and matches
    """</span>
    s <span class="token operator">=</span> df_2<span class="token punctuation">[</span>key2<span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

    m <span class="token operator">=</span> df_1<span class="token punctuation">[</span>key1<span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> process<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>x<span class="token punctuation">,</span> s<span class="token punctuation">,</span> limit<span class="token operator">=</span>limit<span class="token punctuation">)</span><span class="token punctuation">)</span>    
    df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span> <span class="token operator">=</span> m

    m2 <span class="token operator">=</span> df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> threshold<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> len<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> threshold<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">)</span>
    df_1<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span> <span class="token operator">=</span> m2

    <span class="token keyword">return</span> df_1

<span class="token keyword">from</span> fuzzywuzzy <span class="token keyword">import</span> fuzz
<span class="token keyword">from</span> fuzzywuzzy <span class="token keyword">import</span> process

df <span class="token operator">=</span> fuzzy_merge<span class="token punctuation">(</span>data<span class="token punctuation">,</span> company<span class="token punctuation">,</span> <span class="token string">'公司名称'</span><span class="token punctuation">,</span> <span class="token string">'公司名称'</span><span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
df<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="PIL-图像处理开发极简教程"><a href="#PIL-图像处理开发极简教程" class="headerlink" title="PIL - 图像处理开发极简教程"></a>PIL - 图像处理开发极简教程</h1><p><a href="https://pillow-cn.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">Pillow API</a></p>
<h2 id="PIL安装与介绍"><a href="#PIL安装与介绍" class="headerlink" title="PIL安装与介绍"></a><strong>PIL安装与介绍</strong></h2><p>PIL是python image libaray缩写，是python语言的图像处理库，很多时候对于一些简单的图像处理，我们经常使用的是其中一个fork项目pillow，它的github地址如下:</p>
<pre><code>https://github.com/python-pillow/Pillow</code></pre><p>安装pillow只需要执行如下命令行即可</p>
<pre><code>pip install Pillow</code></pre><h2 id="常见操作代码"><a href="#常见操作代码" class="headerlink" title="常见操作代码"></a><strong>常见操作代码</strong></h2><ul>
<li>导入开发包</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageFilter<span class="token punctuation">,</span> ImageOps
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>读取与显示图像</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">im <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'D:/images/flower.png'</span><span class="token punctuation">)</span>
im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106172928338.png" style="zoom:67%;">

<ul>
<li>获取图像基本属性</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>im<span class="token punctuation">.</span>format<span class="token punctuation">,</span> im<span class="token punctuation">.</span>size<span class="token punctuation">,</span> im<span class="token punctuation">.</span>mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>访问像素</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>im<span class="token punctuation">.</span>getpixel<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>转为灰度图像</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">new_im <span class="token operator">=</span> im<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
new_im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>高斯模糊图像</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">new_im <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
new_im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>保存图像</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">new_im<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/my_test.jpg'</span><span class="token punctuation">,</span> quality<span class="token operator">=</span><span class="token number">95</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>创建512x512大小，蓝色图像</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">im <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>填充直线、长方形与椭圆</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> im<span class="token punctuation">.</span>height<span class="token punctuation">,</span> im<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
draw<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
draw<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>像素取反操作</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">im <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'D:/images/flower.png'</span><span class="token punctuation">)</span>
im_invert <span class="token operator">=</span> ImageOps<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>im<span class="token punctuation">)</span>
im_invert<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/flower_invert.png'</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>图像旋转操作</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">im <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'D:/images/flower.png'</span><span class="token punctuation">)</span>
im_rotate <span class="token operator">=</span> im<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span>
im_rotate <span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/flower_rotate.png'</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173012130.png" style="zoom:67%;">

<ul>
<li>模糊</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">im <span class="token operator">=</span> Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'D:/images/master.jpg'</span><span class="token punctuation">)</span>
blur <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>BLUR<span class="token punctuation">)</span>
blur<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>轮廓提取</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">contour <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>CONTOUR<span class="token punctuation">)</span>
contour<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173112128.png" style="zoom:50%;">

<ul>
<li>轧花效果</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">emboss <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>EMBOSS<span class="token punctuation">)</span>
emboss<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/emboss.png'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173143817.png" style="zoom:50%;">

<ul>
<li>边缘查找</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">edges <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>FIND_EDGES<span class="token punctuation">)</span>
edges<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/edges.png'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173205508.png" style="zoom:50%;">

<ul>
<li>图像边缘增强</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">edges_enhance <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>EDGE_ENHANCE<span class="token punctuation">)</span>
edges_enhance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/edges_enhance.png'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173224986.png" style="zoom:50%;">

<ul>
<li>图像锐化增强</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">sharpen <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>SHARPEN<span class="token punctuation">)</span>
sharpen<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/sharpen.png'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173243324.png" style="zoom:50%;">

<ul>
<li>USM锐化增强</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">usm <span class="token operator">=</span> im<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>UnsharpMask<span class="token punctuation">)</span>
usm<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'D:/usm.png'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211106173301227.png" style="zoom:50%;">

<h1 id="Python-docx-读写Word文档入门"><a href="#Python-docx-读写Word文档入门" class="headerlink" title="Python-docx - 读写Word文档入门"></a>Python-docx - 读写Word文档入门</h1><p><a href="https://python-docx.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">Python-docx API</a></p>
<h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><p>这里我们用到的是<code>python-docx</code>模块，读写<code>Word</code>文档的操作均有它完成！</p>
<pre><code># 安装该模块，在命令行键入以下命令
pip install python-docx</code></pre><p>在进行后续介绍前，我们先简单了解一下<code>Word</code>文档。和纯文本（比如<code>txt</code>）相比， <code>.docx</code>文件有很多种结构，这些结构在<code>python-docx</code>中用3种不同的类型来表示：最高一层是<code>Document</code>对象表示文档，每个<code>Document</code>对象包含一个<code>Paragraph</code> 对象也就是段落组成的列表，而每个Paragraph对象则包含一个<code>Run</code>对象的列表，至于<code>Run</code>对象大家可以通过下面的段落<code>Paragraph</code>来了解。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106180635745.png" alt="多个Run对象组成的Paragraph"></p>
<p>我们知道<strong>Word</strong>里的文本包含有很多格式，比如字体、字号、粗体/斜体、颜色等等。一个<code>Run</code>对象是<strong>具有相同格式的文本</strong>，当发生变化的时候就需要一个新的<code>Run</code>对象，这也就是上图中1个Paragraph对象有4个Run对象的原因。</p>
<h2 id="读取Word文档"><a href="#读取Word文档" class="headerlink" title="读取Word文档"></a>读取Word文档</h2><p>我们本地创建一个案例文档，用于演示读取Word，案例文档内容如下：</p>
<img src="/images/loading.gif" data-original="../images/language/image-20211106180729873.png" style="zoom: 67%;">

<p>可以看到文档一共有四行，两行标题以及两行正文。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx
<span class="token comment" spellcheck="true"># 读取Word文档</span>
doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span>r<span class="token string">'案例.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106180858668.png" alt=""></p>
<p>我们知道了读取Word每个paragraph段落和Run，那么如何读取完整的Word文本内容呢？这里，自定义一个函数将全部的paragraph段落内容存起来，每个paragraph段落之间用换行符<code>\n</code>隔开即可。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

<span class="token keyword">def</span> <span class="token function">getText</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">:</span>
    doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>
    TextList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> paragraph <span class="token keyword">in</span> doc<span class="token punctuation">.</span>paragraphs<span class="token punctuation">:</span>
        TextList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>paragraph<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>TextList<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们调用该函数，可以得到：</p>
<pre class="line-numbers language-python"><code class="language-python">fileName <span class="token operator">=</span> r<span class="token string">'案例.docx'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>getText<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span>标题<span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span>这是一个段落，有粗体和斜体
<span class="token operator">>></span><span class="token operator">></span>大家好，我是才哥。
<span class="token operator">>></span><span class="token operator">></span>标题<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然了，这里读取后输出显示的文本不带有格式属性。</p>
<h2 id="写入Word文档"><a href="#写入Word文档" class="headerlink" title="写入Word文档"></a>写入Word文档</h2><p>在写入Word之前，我们先简单了解下Word的一些格式规则。</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181015979.png" alt=""></p>
<p>比如，我们可以设置正文样式为 微软雅黑字体，字号12，缩进，间距等等；设置标题样式为 微软雅黑字体，字号14，删除段落后间距等等。</p>
<blockquote>
<p>在我们Python处理Word的时候，段落样式可以应用于 <code>Paragraph</code> 对象，字符样式可以应用于 <code>Run</code> 对象，链接的样式可以应用于这两种对象。可以将 <code>Paragraph</code> 和<code>Run</code> 对象的 <code>style</code> 属性设置为一个字符串，从而设置样式。这个字符串应该是一种样式的名称。如果 <code>style</code> 被设置为 <code>None</code>，就没有样式与 <code>Paragraph</code> 或 <code>Run</code> 对象关联。</p>
</blockquote>
<p>当然，这里我们不展开介绍，就简单介绍<code>Run</code>对象上的<strong>字符属性</strong>。</p>
<p>对于<code>Run</code>对象的字符<code>text</code>属性，都有3个状态：<code>True</code>（启用）、<code>False</code>（禁用）和<code>None</code>（默认）。</p>
<p><code>text</code><strong>属性</strong>有哪些？看下表：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bold</td>
<td align="left">文本以粗体出现</td>
</tr>
<tr>
<td align="left">italic</td>
<td align="left">文本以斜体出现</td>
</tr>
<tr>
<td align="left">underline</td>
<td align="left">文本带下划线</td>
</tr>
<tr>
<td align="left">strike</td>
<td align="left">文本带删除线</td>
</tr>
<tr>
<td align="left">double_strike</td>
<td align="left">文本带双删除线</td>
</tr>
<tr>
<td align="left">all_caps</td>
<td align="left">文本以大写首字母出现</td>
</tr>
<tr>
<td align="left">small_caps</td>
<td align="left">文本以大写首字母出现，小写字母小两个点</td>
</tr>
<tr>
<td align="left">shadow</td>
<td align="left">文本带阴影</td>
</tr>
<tr>
<td align="left">outline</td>
<td align="left">文本以轮廓线出现，而不是实心</td>
</tr>
<tr>
<td align="left">rtl</td>
<td align="left">文本从右至左书写</td>
</tr>
<tr>
<td align="left">imprint</td>
<td align="left">文本以刻入页面的方式出现</td>
</tr>
<tr>
<td align="left">emboss</td>
<td align="left">文本以凸出页面的方式出现</td>
</tr>
</tbody></table>
<p>我们演示一下：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181104470.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181115752.png" alt=""></p>
<p>以上就是对段落的一些简单介绍及演示，接下来，我们来看看怎么<strong>创建并写入Word</strong>。</p>
<p>要创建自己的<code>.docx</code> 文件，就调用 <code>docx.Document()</code>，返回一个新的、空白的 <code>Word Document</code> 对象  。<code>Document</code> 对象的 <code>add_paragraph()</code>方法将一段新文本添加到文档中，并返回添加的 Paragraph 对象的引用。在添加完文本之后，向 Document 对象的 <code>save()</code>方法传入一个文件名字符串，将 Document 对象保存到文件。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是一个段落'</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'写入word.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181150040.png" alt=""></p>
<p>我们可以<strong>添加段落、设置段落文本样式</strong>等等，比如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
p1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是一个段落'</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span>add_run<span class="token punctuation">(</span><span class="token string">'加粗的一句话'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bold <span class="token operator">=</span> <span class="token boolean">True</span>
doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是第二个段落'</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'多段落.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181214781.png" alt=""></p>
<p>我们还可以添加一个段位，这个段落为<strong>标题样式</strong>，这里需要用到<code>add_heading()</code>。它有两个参数，字符串表示文本内容，后面数字是标题层级。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_heading<span class="token punctuation">(</span><span class="token string">'标题'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_heading<span class="token punctuation">(</span><span class="token string">'标题1'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_heading<span class="token punctuation">(</span><span class="token string">'标题2'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_heading<span class="token punctuation">(</span><span class="token string">'标题3'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_heading<span class="token punctuation">(</span><span class="token string">'标题4'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'标题.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181307431.png" alt=""></p>
<p>同样，我们还可<strong>换行与换页</strong>操作。</p>
<p>要添加换行符（而不是开始一个新的段落），可以在 Run 对象上调用 <code>add_break()</code>方法，换行符将出现在它后面。如果希望添加换页符，可以将 <code>docx.text.WD_BREAK.PAGE</code>作为唯一的参数，传递给 <code>add_break()</code> 。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
p1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是一个段落'</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span>add_run<span class="token punctuation">(</span><span class="token string">'加粗的一句话'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bold <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token comment" spellcheck="true"># 换行</span>
doc<span class="token punctuation">.</span>paragraphs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>runs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>add_break<span class="token punctuation">(</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'换行.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181336291.png" alt=""></p>
<p>有人会说，一般word里还有图片嘛，当然咱们也能搞定<strong>添加图片</strong>。</p>
<p>有一个 <code>add_picture()</code>方法，可以在段落末尾添加图像 。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> docx

doc <span class="token operator">=</span> docx<span class="token punctuation">.</span>Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是一个段落，后面带图片'</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_picture<span class="token punctuation">(</span><span class="token string">'图片.png'</span><span class="token punctuation">,</span> 
                width<span class="token operator">=</span>docx<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>Inches<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                height<span class="token operator">=</span>docx<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>Cm<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span><span class="token string">'这是第二个段落'</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'图片.docx'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211106181406775.png" alt=""></p>
<h1 id="Scrapy-爬虫框架"><a href="#Scrapy-爬虫框架" class="headerlink" title="Scrapy - 爬虫框架"></a>Scrapy - 爬虫框架</h1><p><a href="https://www.osgeo.cn/scrapy/" target="_blank" rel="noopener">Scrapy API</a></p>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>使用pip对Scrapy进行安装，代码如下：</p>
<pre><code>pip install scrapy</code></pre><h2 id="2-创建项目"><a href="#2-创建项目" class="headerlink" title="2. 创建项目"></a>2. 创建项目</h2><p>安装好Scrapy框架之后，我们需要通过终端，来创建一个Scrapy项目，命令如下：</p>
<pre><code>scrapy startproject weibo</code></pre><p>创建好后的项目结构，如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108115848430.png" alt=""></p>
<blockquote>
<p>spiders是存放爬虫程序的文件夹，将写好的爬虫程序放到该文件夹中。items用来定义数据，类似于字典的功能。settings是设置文件，包含爬虫项目的设置信息。pipelines用来对items中的数据进行进一步处理，如：清洗、存储等。</p>
</blockquote>
<h2 id="3-数据采集"><a href="#3-数据采集" class="headerlink" title="3. 数据采集"></a>3. 数据采集</h2><p>经过上面的简单介绍，我们现在对Scrapy框架有了简单的了解，下面我们开始写数据采集部分的代码。</p>
<h3 id="定义数据"><a href="#定义数据" class="headerlink" title="定义数据"></a>定义数据</h3><p>首先，我们对数据存储的网页进行观察，方便我们对获取数据进行定义</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108115954219.png" alt=""></p>
<p>通过对网页中数据存储的形式进行观察后，items.py中对数据的定义方式为：</p>
<pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="编辑爬虫"><a href="#编辑爬虫" class="headerlink" title="编辑爬虫"></a>编辑爬虫</h3><p>接下来我们在spiders文件夹里面创建一个weibo.py爬虫程序用以书写请求的爬虫代码</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108120034735.png" alt=""></p>
<p>代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">class</span> <span class="token class-name">WeiboSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
   name <span class="token operator">=</span> <span class="token string">'weibo'</span><span class="token comment" spellcheck="true">#用于启动微博程序</span>
   allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'m.weibo.cn'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#定义爬虫爬取网站的域名</span>
   start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://m.weibo.cn/comments/hotflow?id=4700480024348767&amp;mid=4700480024348767&amp;max_id_type=0'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#定义起始网页的网址</span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> res<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
     weibo_item <span class="token operator">=</span> WeiboItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
     weibo_item<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'&lt;[^>]*>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token comment" spellcheck="true"># start_url = ['https://m.weibo.cn/comments/hotflow?id=4700480024348767&amp;mid=4700480024348767&amp;'+str(max_id)+'&amp;max_id_type=0']</span>
     <span class="token keyword">yield</span> weibo_item  <span class="token comment" spellcheck="true">#将数据回传给items</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="遍历爬取"><a href="#遍历爬取" class="headerlink" title="遍历爬取"></a>遍历爬取</h3><p>构造代码：</p>
<pre class="line-numbers language-python"><code class="language-python">max_id_type <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'max_id_type'</span><span class="token punctuation">]</span>
<span class="token keyword">if</span> int<span class="token punctuation">(</span>max_id_type<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
   new_url <span class="token operator">=</span> <span class="token string">'https://m.weibo.cn/comments/hotflow?id=4700480024348767&amp;mid=4700480024348767&amp;max_id='</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>
       max_id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;max_id_type=1'</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
   new_url <span class="token operator">=</span> <span class="token string">'https://m.weibo.cn/comments/hotflow?id=4700480024348767&amp;mid=4700480024348767&amp;max_id='</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>
       max_id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;max_id_type=0'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-数据存储"><a href="#4-数据存储" class="headerlink" title="4. 数据存储"></a>4. 数据存储</h2><p>光爬取下来数据是不行的，我们还需要对数据进行存储，这里采用的是csv文件，来对评论数据进行存储，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">CsvItemExporterPipeline</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token comment" spellcheck="true"># 创建接收文件,初始化exporter属性</span>
       self<span class="token punctuation">.</span>file <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'text.csv'</span><span class="token punctuation">,</span><span class="token string">'ab'</span><span class="token punctuation">)</span>
       self<span class="token punctuation">.</span>exporter <span class="token operator">=</span> CsvItemExporter<span class="token punctuation">(</span>self<span class="token punctuation">.</span>file<span class="token punctuation">,</span>fields_to_export<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       self<span class="token punctuation">.</span>exporter<span class="token punctuation">.</span>start_exporting<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-程序配置"><a href="#5-程序配置" class="headerlink" title="5. 程序配置"></a>5. 程序配置</h2><p>光写上面的代码是无法爬取到评论的，因为我们还没有对整个程序进行有效的配置，下面我们就在settings.py里面进行配置。</p>
<h3 id="不遵循robots协议"><a href="#不遵循robots协议" class="headerlink" title="不遵循robots协议"></a>不遵循robots协议</h3><p>需要对robts协议的遵守进行修改，如果我们遵循网页的robots协议的话，那无法进行爬取，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Obey robots.txt rules</span>
ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="使用自定义cookie"><a href="#使用自定义cookie" class="headerlink" title="使用自定义cookie"></a>使用自定义cookie</h3><p>我们知道，想要爬取微博评论，需要带上自己的cookie用以信息校验，因为我们的cookie是在headers中包裹着的，所以我们需要将COOKIES_ENABLED改为False，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Disable cookies (enabled by default)</span>
COOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="打开管道"><a href="#打开管道" class="headerlink" title="打开管道"></a>打开管道</h3><p>想要进行数据存储，还需要在配置中，打开通道，用以数据传输，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Configure item pipelines</span>
<span class="token comment" spellcheck="true"># See https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'weibo.pipelines.CsvItemExporterPipeline'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">'weibo.pipelines.WeiboPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="启动程序"><a href="#启动程序" class="headerlink" title="启动程序"></a>启动程序</h3><p>我们在spiders同级的的目录下创建一个wb_main.py文件，便于我们在编辑器中启动程序，代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> cmdline
<span class="token comment" spellcheck="true">#导入cmdline模块,可以实现控制终端命令行。</span>
cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'scrapy'</span><span class="token punctuation">,</span><span class="token string">'crawl'</span><span class="token punctuation">,</span><span class="token string">'weibo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#用execute（）方法，输入运行scrapy的命令。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Shodan-互联网上最可怕的搜索引擎"><a href="#Shodan-互联网上最可怕的搜索引擎" class="headerlink" title="Shodan - 互联网上最可怕的搜索引擎"></a>Shodan - 互联网上最可怕的搜索引擎</h1><p><a href="https://developer.shodan.io/api" target="_blank" rel="noopener">Shodan API</a></p>
<p>Shodan 在百度百科里被给出了这么一句话介绍：Shodan是互联网上最可怕的搜索引擎。</p>
<p>为什么呢？与谷歌、百度等搜索引擎爬取网页信息不同，Shodan爬取的是互联网上所有设备的IP地址及其端口号。</p>
<p>而随着智能家电的普及，家家户户都有许多电器连接到互联网，这些设备存在被入侵的可能性，这是十分危险的。打开 shodan.io，在搜索框输入 <strong><code>Hikvision-Webs</code></strong> :</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121013282.png" alt=""></p>
<p>你会搜素到这个品牌的摄像头设备遍及全球的IP及其暴露的端口号：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121045875.png" alt=""></p>
<p>可以看到，这台机器暴露了17、80、111、995、3128、5000、6000、20547端口，黑客可以根据这些端口进行针对性的攻击。</p>
<p>不过也不需要过于担心，如果你的服务不存在漏洞，一般是无法攻入的。但有些端口号会暴露摄像头的web管理端，如下：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121110619.png" alt=""></p>
<p>那么黑客可能可以用暴力破解的方式，强行进入摄像头后台管理端，获取到实时的录像。</p>
<p>谨记这会侵犯别人的隐私权，是违法的行为，我们是遵纪守法的好公民所以知道它的原理和危害就足够。我们的目的是运用技术保护好个人隐私，如非必要不将摄像头接入互联网，一定要接入的话，不能使用容易被破解的弱口令。</p>
<p>Shodan Web端非常好用，但如果我们有从 Python 搜索的需求怎么办？</p>
<p>没关系，Shodan 官方也提供了 Python SDK 包，下面就来讲讲这个 SDK 包的使用。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>请选择以下任一种方式输入命令安装依赖</strong>：</p>
<ol>
<li>Windows 环境 打开 Cmd (开始-运行-CMD)。</li>
<li>MacOS 环境 打开 Terminal (command+空格输入Terminal)。</li>
<li>如果你用的是 VSCode编辑器 或 Pycharm，可以直接使用界面下方的Terminal.</li>
</ol>
<pre><code>pip install shodan</code></pre><h2 id="注册账号获取API"><a href="#注册账号获取API" class="headerlink" title="注册账号获取API"></a>注册账号获取API</h2><p>使用 Shodan 必须注册账号，注册网址：<a href="https://account.shodan.io/register" target="_blank" rel="noopener">https://account.shodan.io/register</a></p>
<p>输入完相关信息，点击 CREATE 会跳转到个人账户页：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121250133.png" alt=""></p>
<p>此时 API Key 会显示你的API秘钥，请记录这个秘钥，后续会使用到这个秘钥去请求接口。</p>
<h2 id="Shodan-基本调用"><a href="#Shodan-基本调用" class="headerlink" title="Shodan 基本调用"></a>Shodan 基本调用</h2><p>Shodan 本质上就是一个搜索引擎，你只需要输入搜索的关键词：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> shodan <span class="token keyword">import</span> Shodan

api <span class="token operator">=</span> Shodan<span class="token punctuation">(</span><span class="token string">'你的API KEY'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">search_shodan</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 调用搜索接口</span>
    result <span class="token operator">=</span> api<span class="token punctuation">.</span>search<span class="token punctuation">(</span>keyword<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># 显示所有IP</span>
    <span class="token keyword">for</span> service <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'matches'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>service<span class="token punctuation">[</span><span class="token string">'ip_str'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

search_shodan<span class="token punctuation">(</span><span class="token string">"Hikvision-Webs"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121351150.png" alt=""></p>
<p>可惜的是，普通API只能像这样搜索关键字，无法使用过滤条件如： <strong><code>Hikvision-Webs country:"US"</code></strong> 搜索美国境内的所有 Hikvision 网站管理端。</p>
<p>如果你想要使用过滤条件，Shodan 需要你升级API权限：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121418728.png" alt=""></p>
<h2 id="Shodan-高级使用"><a href="#Shodan-高级使用" class="headerlink" title="Shodan 高级使用"></a>Shodan 高级使用</h2><p>Shodan 的用处当然不仅仅是在黑客攻防中，它还能用于统计。如果你想要了解哪些国家的使用这款摄像头的数量最多，可以使用 Facets 特性。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> shodan <span class="token keyword">import</span> Shodan

api <span class="token operator">=</span> Shodan<span class="token punctuation">(</span><span class="token string">'你的API KEY'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">try_facets</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    FACETS <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'org'</span><span class="token punctuation">,</span>
        <span class="token string">'domain'</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span><span class="token punctuation">,</span>
        <span class="token string">'asn'</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'country'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    FACET_TITLES <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'org'</span><span class="token punctuation">:</span> <span class="token string">'Top 5 Organizations'</span><span class="token punctuation">,</span>
        <span class="token string">'domain'</span><span class="token punctuation">:</span> <span class="token string">'Top 5 Domains'</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token string">'Top 5 Ports'</span><span class="token punctuation">,</span>
        <span class="token string">'asn'</span><span class="token punctuation">:</span> <span class="token string">'Top 5 Autonomous Systems'</span><span class="token punctuation">,</span>
        <span class="token string">'country'</span><span class="token punctuation">:</span> <span class="token string">'Top 3 Countries'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 使用 count() 方法可以不需要升级API，且比 search 方法更快。</span>
        result <span class="token operator">=</span> api<span class="token punctuation">.</span>count<span class="token punctuation">(</span>query<span class="token punctuation">,</span> facets<span class="token operator">=</span>FACETS<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Shodan Summary Information'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Query: %s'</span> <span class="token operator">%</span> query<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Total Results: %s\n'</span> <span class="token operator">%</span> result<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 显示每个要素的摘要</span>
        <span class="token keyword">for</span> facet <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'facets'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>FACET_TITLES<span class="token punctuation">[</span>facet<span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token keyword">for</span> term <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'facets'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>facet<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>term<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> term<span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error: %s'</span> <span class="token operator">%</span> e<span class="token punctuation">)</span>

try_facets<span class="token punctuation">(</span><span class="token string">"Hikvision-Webs"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到结果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/language/image-20211108121508542.png" alt=""></p>
<p>从 Top 3 Countries 中可以看到，这款摄像头使用数量排名前三的国家分别是：美国、日本和德国。</p>
<p>没想到吧，Shodan 居然还能用于产品分析。同样地原理，如果你把关键词改为 <strong><code>apache</code></strong> ，你可以知道目前哪些国家使用apache服务器数量最多，最普遍被使用的版本号是什么。</p>
<p>为了避免受到不必要的攻击，请大家及时检查所有联网设备的管理端的密码，如果有使用默认密码及弱口令，立即进行密码的更改，以保证服务的安全。</p>
<h1 id="Gooey-GUI神器"><a href="#Gooey-GUI神器" class="headerlink" title="Gooey - GUI神器"></a>Gooey - GUI神器</h1><p><a href="https://github.com/chriskiehl/Gooey" target="_blank" rel="noopener">Gooey API</a></p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>安装方法毫无新意，跟以前我们安装其他库一样：</p>
<blockquote>
<p>pip install Gooey</p>
</blockquote>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> gooey <span class="token keyword">import</span> Gooey<span class="token punctuation">,</span> GooeyParser


@Gooey<span class="token punctuation">(</span>program_name<span class="token operator">=</span><span class="token string">"简单的实例"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> GooeyParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"第一个示例!"</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'文件路径'</span><span class="token punctuation">,</span> widget<span class="token operator">=</span><span class="token string">"FileChooser"</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 文件选择框</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'日期'</span><span class="token punctuation">,</span> widget<span class="token operator">=</span><span class="token string">"DateChooser"</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 日期选择框</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>                                 <span class="token comment" spellcheck="true"># 接收界面传递的参数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>


<span class="token keyword">if</span>   __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里看代码应该大致知道界面有些什么控件：文件选择框、日期选择框。</p>
<p>运行之后的效果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111103928913.png" alt=""></p>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>GUI 界面都是由一个个组件排列组成的，上面的例子中我们使用了 FileChooser 和 DateChooser 这两个组件，使用起来是不是很简单？我们来看看 Gooey 还有哪些组件。</p>
<table>
<thead>
<tr>
<th align="center">控件名</th>
<th align="center">控件类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FileChooser</td>
<td align="center">文件选择器</td>
</tr>
<tr>
<td align="center">MultiFileChooser</td>
<td align="center">文件多选器</td>
</tr>
<tr>
<td align="center">DirChooser</td>
<td align="center">目录选择器</td>
</tr>
<tr>
<td align="center">MultiDirChooser</td>
<td align="center">目录多选器</td>
</tr>
<tr>
<td align="center">FileSaver</td>
<td align="center">文件保存</td>
</tr>
<tr>
<td align="center">DateChooser</td>
<td align="center">日期选择</td>
</tr>
<tr>
<td align="center">TextField</td>
<td align="center">文本输入框</td>
</tr>
<tr>
<td align="center">Dropdown</td>
<td align="center">下拉列表</td>
</tr>
<tr>
<td align="center">Counter</td>
<td align="center">计数器</td>
</tr>
<tr>
<td align="center">CheckBox</td>
<td align="center">复选框</td>
</tr>
<tr>
<td align="center">RadioGroup</td>
<td align="center">单选框</td>
</tr>
</tbody></table>
<p>这些组件基本上看名称就知道是什么样子的了，都是我们平时常用的页面组件。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>配置参数主要是对Gooey界面做全局配置，配置方法如下：</p>
<pre class="line-numbers language-python"><code class="language-python">@Gooey<span class="token punctuation">(</span>program_name<span class="token operator">=</span><span class="token string">'全局配置Demo'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这里就使用了 program_name 这个配置，主要是配置显示程序的名称。</p>
<p>除此之外，Gooey 还有好多其他的配置参数：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">advanced</td>
<td align="center">Boolean</td>
<td align="center">切换显示全部设置还是仅仅是简化版本</td>
</tr>
<tr>
<td align="center">show_config</td>
<td align="center">Boolean</td>
<td align="center">跳过所有配置并立即运行程序</td>
</tr>
<tr>
<td align="center">language</td>
<td align="center">str</td>
<td align="center">指定从 gooey/languages 目录读取哪个语言包</td>
</tr>
<tr>
<td align="center">program_name</td>
<td align="center">str</td>
<td align="center">GUI 窗口显示的程序名。默认会显 sys.argv[0]。</td>
</tr>
<tr>
<td align="center">program_description</td>
<td align="center">str</td>
<td align="center">Settings 窗口顶栏显示的描述性文字。默认值从 ArgumentParser 中获取。</td>
</tr>
<tr>
<td align="center">default_size</td>
<td align="center">tuple</td>
<td align="center">窗口默认大小，(600,400)</td>
</tr>
<tr>
<td align="center">required_cols</td>
<td align="center">int</td>
<td align="center">设置必选参数行数。</td>
</tr>
<tr>
<td align="center">optional_cols</td>
<td align="center">int</td>
<td align="center">设置可选参数行数。</td>
</tr>
<tr>
<td align="center">dump_build_config</td>
<td align="center">Boolean</td>
<td align="center">将设置以 JSON 格式保存在硬盘中以供编辑/重用。</td>
</tr>
<tr>
<td align="center">richtext_controls</td>
<td align="center">Boolean</td>
<td align="center">打开/关闭控制台对终端控制序列的支持（对字体粗细和颜色的有限支持）</td>
</tr>
</tbody></table>
<p>比如我们上面的例子中除了我们自己设置的，其他的控件例如选择按钮、确定按钮等默认都是英文的，我们可以通过 language 参数来设置语言。语言包在 Gooey 的 GitHub 源码中有：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104136580.png" alt=""></p>
<p>我们使用语言配置：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> gooey <span class="token keyword">import</span> Gooey<span class="token punctuation">,</span> GooeyParser


@Gooey<span class="token punctuation">(</span>program_name<span class="token operator">=</span><span class="token string">"简单的实例"</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">'chinese'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> GooeyParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"第一个示例!"</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'文件路径'</span><span class="token punctuation">,</span> widget<span class="token operator">=</span><span class="token string">"FileChooser"</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 文件选择框</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'日期'</span><span class="token punctuation">,</span> widget<span class="token operator">=</span><span class="token string">"DateChooser"</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true"># 日期选择框</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>                                 <span class="token comment" spellcheck="true"># 接收界面传递的参数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>


<span class="token keyword">if</span>   __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里加了一个 language 参数，我们看看运行后效果：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104200074.png" alt=""></p>
<h3 id="结构布局"><a href="#结构布局" class="headerlink" title="结构布局"></a>结构布局</h3><p>通过使用一些简单的自定义，您可以使用Gooey实现相当灵活的布局。我们可以通过Gooey装饰器的各种参数来控制总体布局选项。</p>
<ul>
<li>show_sidebar=True</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104221628.png" alt=""></p>
<ul>
<li>show_sidebar=False</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104246516.png" alt=""></p>
<ul>
<li>navigation=’TABBED’</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104303470.png" alt=""></p>
<ul>
<li>tabbed_groups=True</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104318191.png" alt=""></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>我们通过一个小栗子来看看运行的效果吧。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> gooey <span class="token keyword">import</span> Gooey<span class="token punctuation">,</span> GooeyParser


@Gooey<span class="token punctuation">(</span>
    richtext_controls<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 <span class="token comment" spellcheck="true"># 打开终端对颜色支持</span>
    program_name<span class="token operator">=</span><span class="token string">"MQTT连接订阅小工具"</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 程序名称</span>
    encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span>                       <span class="token comment" spellcheck="true"># 设置编码格式，打包的时候遇到问题</span>
    progress_regex<span class="token operator">=</span>r<span class="token string">"^progress: (\d+)%$"</span>    <span class="token comment" spellcheck="true"># 正则，用于模式化运行时进度信息</span>
<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    settings_msg <span class="token operator">=</span> <span class="token string">'MQTT device activation information subscription'</span>
    parser <span class="token operator">=</span> GooeyParser<span class="token punctuation">(</span>description<span class="token operator">=</span>settings_msg<span class="token punctuation">)</span>

    subs <span class="token operator">=</span> parser<span class="token punctuation">.</span>add_subparsers<span class="token punctuation">(</span>help<span class="token operator">=</span><span class="token string">'commands'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'command'</span><span class="token punctuation">)</span>

    my_parser <span class="token operator">=</span> subs<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'MQTT消息订阅'</span><span class="token punctuation">)</span>
    my_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"connect"</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'运行环境'</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"请选择开发环境"</span><span class="token punctuation">,</span>choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'dev环境'</span><span class="token punctuation">,</span><span class="token string">'staging环境'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'dev环境'</span><span class="token punctuation">)</span>
    my_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"device_type"</span><span class="token punctuation">,</span>metavar<span class="token operator">=</span><span class="token string">'设备类型'</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"请选择设备类型"</span><span class="token punctuation">,</span>choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'H1'</span><span class="token punctuation">,</span><span class="token string">'H3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token string">'H1'</span><span class="token punctuation">)</span>
    my_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"serialNumber"</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'设备SN号'</span><span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token string">'LKVC19060047'</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">'多个请用逗号或空格隔开'</span><span class="token punctuation">)</span>

    siege_parser <span class="token operator">=</span> subs<span class="token punctuation">.</span>add_parser<span class="token punctuation">(</span><span class="token string">'进度条控制'</span><span class="token punctuation">)</span>
    siege_parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">'请输入数字'</span><span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> flush<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># flush=True在打包的时候会用到</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个例子运行的效果如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/llllllzzzz.gif" alt=""></p>
<h3 id="打包成应用程序"><a href="#打包成应用程序" class="headerlink" title="打包成应用程序"></a>打包成应用程序</h3><p>第一步，先安装我们的打包库：</p>
<blockquote>
<p>pip install pyinstaller</p>
</blockquote>
<p>第二步，执行打包命令：</p>
<blockquote>
<p>pyinstaller -F gooeydemo.py -w</p>
</blockquote>
<p>等待执行完成，我们就可以在代码目录下看到这样的结构：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211111104450242.png" alt=""></p>
<p>我们的 exe 可执行文件就在 dist 文件夹下。</p>
<h1 id="Prettytable-输出好看的表格"><a href="#Prettytable-输出好看的表格" class="headerlink" title="Prettytable - 输出好看的表格"></a>Prettytable - 输出好看的表格</h1><p><a href="https://github.com/jazzband/prettytable" target="_blank" rel="noopener">Prettytable API</a></p>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>最近在用 Python 写一个小工具，这个工具主要就是用来管理各种资源的信息，比如阿里云的 ECS 等信息，因为我工作的电脑使用的是 LINUX，所以就想着用 python 写一个命令行的管理工具，基本的功能就是同步阿里云的资源的信息到数据库，然后可以使用命令行查询。</p>
<p>因为信息是展现在命令行中的，众所周知，命令行展现复杂的文本看起来着实累人，于是就想着能像表格那样展示，那看起来就舒服多了。</p>
<p><strong>prettytable</strong> 库就是这么一个工具，prettytable 可以打印出美观的表格，并且对中文支持相当好（如果有试图自己实现打印表格，你就应该知道处理中文是多么的麻烦）</p>
<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h2><p>prettytable 并非 python 的内置库，通过 <code>pip install prettytable</code>即可安装。</p>
<h2 id="3-示例"><a href="#3-示例" class="headerlink" title="3. 示例"></a>3. 示例</h2><p>我们先来看一个示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span><span class="token string">'云编号'</span><span class="token punctuation">,</span><span class="token string">'名称'</span><span class="token punctuation">,</span><span class="token string">'IP地址'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'server01'</span><span class="token punctuation">,</span><span class="token string">'服务器01'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'server02'</span><span class="token punctuation">,</span><span class="token string">'服务器02'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'server03'</span><span class="token punctuation">,</span><span class="token string">'服务器03'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'server04'</span><span class="token punctuation">,</span><span class="token string">'服务器04'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'server05'</span><span class="token punctuation">,</span><span class="token string">'服务器05'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'server06'</span><span class="token punctuation">,</span><span class="token string">'服务器06'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.6'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'server07'</span><span class="token punctuation">,</span><span class="token string">'服务器07'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.7'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'server08'</span><span class="token punctuation">,</span><span class="token string">'服务器08'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.8'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'9'</span><span class="token punctuation">,</span><span class="token string">'server09'</span><span class="token punctuation">,</span><span class="token string">'服务器09'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.9'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上示例运行结果如下：</p>
<pre><code>linuxops@deepin:~$ python p.py
+------+----------+----------+------------+
| 编号 |  云编号  |   名称   |   IP地址   |
+------+----------+----------+------------+
|  1   | server01 | 服务器01 | 172.16.0.1 |
|  2   | server02 | 服务器02 | 172.16.0.2 |
|  3   | server03 | 服务器03 | 172.16.0.3 |
|  4   | server04 | 服务器04 | 172.16.0.4 |
|  5   | server05 | 服务器05 | 172.16.0.5 |
|  6   | server06 | 服务器06 | 172.16.0.6 |
|  7   | server07 | 服务器07 | 172.16.0.7 |
|  8   | server08 | 服务器08 | 172.16.0.8 |
|  9   | server09 | 服务器09 | 172.16.0.9 |
+------+----------+----------+------------+</code></pre><p>在以上的示例中，我们通过<code>form</code>导入了表格库。<code>table</code>实例化了一个表格库，并且添加了<code>['编号','云编号','名称','IP地址']</code>为表头，如果没有添加表头，那么会以默认的Field+编号显示，例如：</p>
<pre><code>+---------+----------+----------+------------+
| Field 1 | Field 2  | Field 3  |  Field 4   |
+---------+----------+----------+------------+</code></pre><p>所以为更直观看出每一列的意义，还是要添加表头的。</p>
<h2 id="4-添加数据"><a href="#4-添加数据" class="headerlink" title="4. 添加数据"></a>4. 添加数据</h2><p>prettytable提供了多种的添加数据的方式，最常用的应该就是按行按列添加数据了。</p>
<h3 id="按行添加数据-table-add-row"><a href="#按行添加数据-table-add-row" class="headerlink" title="按行添加数据 table.add_row"></a>按行添加数据 table.add_row</h3><p>在上面简单的示例中，我们就是按行添加数据的。</p>
<p>添加的数据必须要是列表的形式，而且数据的列表长度要和表头的长度一样。在实际的使用中，我们应该要关注到添加的数据是否和表头对应，这一点很重要。</p>
<h3 id="按列添加数据-table-add-column"><a href="#按列添加数据-table-add-column" class="headerlink" title="按列添加数据 table.add_column()"></a>按列添加数据 table.add_column()</h3><p>看下面的示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">'项目'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span><span class="token string">'云编号'</span><span class="token punctuation">,</span><span class="token string">'名称'</span><span class="token punctuation">,</span><span class="token string">'IP地址'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">'值'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'server01'</span><span class="token punctuation">,</span><span class="token string">'服务器01'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行结果如下：</p>
<pre><code>+-------+--------+------------+
| index | 项目 |    值     |
+-------+--------+------------+
|   1   |  编号  |     1      |
|   2   | 云编号 |  server01  |
|   3   |  名称  |  服务器01   |
|   4   | IP地址 | 172.16.0.1 |
+-------+--------+------------+</code></pre><p>以上示例中，我们通过<code>add_column</code>来按列添加数据，按列添加数据不需要在实例化表格的时候制定表头，它的表头是在添加列的时候指定的。</p>
<p><code>table.add_column('项目', ['编号','云编号','名称','IP地址'])</code> 这一行代码为例，<code>项目</code>指定了这个列的表头名为”项目”，<code>['编号','云编号','名称','IP地址']</code>为列的值，同样为列表。</p>
<h3 id="从csv文件添加数据"><a href="#从csv文件添加数据" class="headerlink" title="从csv文件添加数据"></a>从csv文件添加数据</h3><p>PrettyTable不仅提供了手动按行按列添加数据，也支持直接从csv文件中读取数据。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> from_csv
reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
fp <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"res.csv"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
table <span class="token operator">=</span> from_csv<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果要读取cvs文件数据，必须要先导入<code>from_csv</code>，否则无法运行。上面的示例运行结果如下：</p>
<p>PS：csv 文件不能通过 xls 直接重命名得到，会报错。如果是 xls 文件，请用另存为 csv 获得 csv 文件</p>
<h3 id="从sql查询值添加"><a href="#从sql查询值添加" class="headerlink" title="从sql查询值添加"></a>从sql查询值添加</h3><p>从数据库查询出来的数据可以直接导入到表格打印，下面的例子使用了<code>sqlite3</code>,如果使用的是mysql也是一样的，只要能查询到数据就能导入到表格中。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> from_db_cursor
<span class="token keyword">import</span> sqlite3
reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"/tmp/aliyun.db"</span><span class="token punctuation">)</span>
cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT * FROM res"</span><span class="token punctuation">)</span>
table <span class="token operator">=</span> from_db_cursor<span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行结果如下：</p>
<pre><code>+------+----------+----------+------------+
| 编号 |  云编号  |   名称   |   IP地址   |
+------+----------+----------+------------+
|  1   | server01 | 服务器01 | 172.16.0.1 |
|  2   | server02 | 服务器02 | 172.16.0.2 |
|  3   | server03 | 服务器03 | 172.16.0.3 |
|  4   | server04 | 服务器04 | 172.16.0.4 |
|  5   | server05 | 服务器05 | 172.16.0.5 |
|  6   | server06 | 服务器06 | 172.16.0.6 |
|  7   | server07 | 服务器07 | 172.16.0.7 |
|  8   | server08 | 服务器08 | 172.16.0.8 |
|  9   | server09 | 服务器09 | 172.16.0.9 |
+------+----------+----------+------------+</code></pre><h3 id="从HTML导入数据"><a href="#从HTML导入数据" class="headerlink" title="从HTML导入数据"></a>从HTML导入数据</h3><p>支持从html的表格中导入，请看下面这个例子：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> from_html
reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

html_string<span class="token operator">=</span><span class="token triple-quoted-string string">'''&lt;table>
&lt;tr>
&lt;th>编号&lt;/th>
&lt;th>云编号&lt;/th>
&lt;th>名称&lt;/th>
&lt;th>IP地址&lt;/th>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>server01&lt;/td>
&lt;td>服务器01&lt;/td>
&lt;td>172.16.0.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>server02&lt;/td>
&lt;td>服务器02&lt;/td>
&lt;td>172.16.0.2&lt;/td>
&lt;/tr>
&lt;/table>'''</span>

table <span class="token operator">=</span> from_html<span class="token punctuation">(</span>html_string<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行结果如下：</p>
<pre><code>+------+----------+----------+------------+
| 编号 |  云编号  |   名称   |   IP地址   |
+------+----------+----------+------------+
|  1   | server01 | 服务器01 | 172.16.0.1 |
|  2   | server02 | 服务器02 | 172.16.0.2 |
+------+----------+----------+------------+</code></pre><p>如上示例中，我们可以导入html的表格，但是不一样的地方是<code>print</code>语句，使用html表格导入数据的时候print的必须是列表中的第一个元素，否则有可能会报<code>[&lt;prettytable.PrettyTable object at 0x7fa87feba590&gt;]</code>这样的错误。</p>
<p>这是因为<code>table</code>并不是PrettyTable对象，而是包含单个PrettyTable对象的列表，它通过解析html而来，所以无法直接打印<code>table</code>，而需要打印<code>table[0]</code></p>
<h2 id="5-表格输出格式"><a href="#5-表格输出格式" class="headerlink" title="5. 表格输出格式"></a>5. 表格输出格式</h2><p>正如支持多种输入一样，表格的输出也支持多种格式，我们在上面中的例子中已经使用了print的方式输出，这是一种常用的输出方式。</p>
<h3 id="print"><a href="#print" class="headerlink" title="print"></a>print</h3><p>直接通过<code>print</code>打印出表格。这种方式打印出的表格会带边框。</p>
<h3 id="输出HTML格式的表格"><a href="#输出HTML格式的表格" class="headerlink" title="输出HTML格式的表格"></a>输出HTML格式的表格</h3><p><code>print(table.get_html_string())</code>可以打印出html标签的表格。</p>
<p>在上面的例子中，使用<code>print(table.get_html_string())</code>会打印出如下结果：</p>
<pre><code>&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;编号&lt;/th&gt;
        &lt;th&gt;云编号&lt;/th&gt;
        &lt;th&gt;名称&lt;/th&gt;
        &lt;th&gt;IP地址&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;1&lt;/td&gt;
        &lt;td&gt;server01&lt;/td&gt;
        &lt;td&gt;服务器01&lt;/td&gt;
        &lt;td&gt;172.16.0.1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;2&lt;/td&gt;
        &lt;td&gt;server02&lt;/td&gt;
        &lt;td&gt;服务器02&lt;/td&gt;
        &lt;td&gt;172.16.0.2&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;</code></pre><h2 id="6-选择性输出"><a href="#6-选择性输出" class="headerlink" title="6. 选择性输出"></a>6. 选择性输出</h2><p>prettytable在创建表格之后，你依然可以有选择的输出某些特定的行.</p>
<h3 id="输出指定的列"><a href="#输出指定的列" class="headerlink" title="输出指定的列"></a>输出指定的列</h3><p><code>print table.get_string(fields=["编号", "IP地址"])</code>可以输出指定的列</p>
<h3 id="输出前两行"><a href="#输出前两行" class="headerlink" title="输出前两行"></a>输出前两行</h3><p>通过<code>print(table.get_string(start = 0, end = 2))</code>的可以打印出指定的列，当然<code>start</code>和<code>end</code>参数让我可以自由控制显示区间。当然区间中包含<code>start</code>不包含<code>end</code>，是不是很熟悉这样的用法？</p>
<blockquote>
<p>根据输出指定行列的功能，我们可以同时指定行和列来输出，这里就不说明了。</p>
</blockquote>
<h3 id="将表格切片"><a href="#将表格切片" class="headerlink" title="将表格切片"></a>将表格切片</h3><p>从上面的输出区间，我们做一个大胆的假设，既然区间包含<code>start</code>不包含<code>end</code>这种规则和切片的一样，我们可以不可通过切片来生成一个新的表格然后将其打印。</p>
<p>事实上是可以的。</p>
<pre><code>new_table = table[0:2]
print(new_table)</code></pre><p>如上代码段中，我们就可以打印出0到1行共2行的表格，python的切片功能异常强大，配合切片我们可以自由的输入任意的行。</p>
<h3 id="输出排序"><a href="#输出排序" class="headerlink" title="输出排序"></a>输出排序</h3><p>有时候我们需要对输出的表格进行排序，使用<code>print table.get_string(sortby="编号", reversesort=True)</code>就可以对表格进行排序，其中<code>reversesort</code>指定了是否倒序排序,默认为<code>False</code>，即默认正序列排序。</p>
<p><code>sortby</code>指定了排序的字段。</p>
<h2 id="7-表格的样式"><a href="#7-表格的样式" class="headerlink" title="7. 表格的样式"></a>7. 表格的样式</h2><h3 id="内置样式"><a href="#内置样式" class="headerlink" title="内置样式"></a>内置样式</h3><p>通过<code>set_style()</code>可以设置表格样式，prettytable内置了多种的样式个人觉得<code>MSWORD_FRIENDLY</code>，<code>PLAIN_COLUMNS</code>，<code>DEFAULT</code> 这三种样式看起来比较清爽，在终端下显示表格本来看起就很累，再加上一下花里胡哨的东西看起来就更累。</p>
<p>除了以上推荐的三种样式以外，还有一种样式不得不说，那就是<code>RANDOM</code>，这是一种随机的样式，每一次打印都会在内置的样式中随机选择一个，比较好玩。</p>
<p>具体内置了几种样式，请各位参考官网完整自己尝试输出看看。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> MSWORD_FRIENDLY
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PLAIN_COLUMNS
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> RANDOM
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> DEFAULT

reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span><span class="token string">'云编号'</span><span class="token punctuation">,</span><span class="token string">'名称'</span><span class="token punctuation">,</span><span class="token string">'IP地址'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'server01'</span><span class="token punctuation">,</span><span class="token string">'服务器01'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'server03'</span><span class="token punctuation">,</span><span class="token string">'服务器03'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'server02'</span><span class="token punctuation">,</span><span class="token string">'服务器02'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'9'</span><span class="token punctuation">,</span><span class="token string">'server09'</span><span class="token punctuation">,</span><span class="token string">'服务器09'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.9'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'server04'</span><span class="token punctuation">,</span><span class="token string">'服务器04'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'server05'</span><span class="token punctuation">,</span><span class="token string">'服务器05'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'server06'</span><span class="token punctuation">,</span><span class="token string">'服务器06'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.6'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'server08'</span><span class="token punctuation">,</span><span class="token string">'服务器08'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.8'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'server07'</span><span class="token punctuation">,</span><span class="token string">'服务器07'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.7'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>set_style<span class="token punctuation">(</span>DEFAULT<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a>自定义样式</h3><p>除了内置的样式以外，PrettyTable也提供了用户自定义，例如对齐方式，数字输出格式，边框连接符等等</p>
<h3 id="设置对齐方式"><a href="#设置对齐方式" class="headerlink" title="设置对齐方式"></a>设置对齐方式</h3><p><code>align</code>提供了用户设置对齐的方式，值有<code>l</code>，<code>r</code>，<code>c</code>方便代表左对齐，右对齐和居中 如果不设置，默认居中对齐。</p>
<h3 id="控制边框样式"><a href="#控制边框样式" class="headerlink" title="控制边框样式"></a>控制边框样式</h3><p>在PrettyTable中，边框由三个部分组成，横边框，竖边框，和边框连接符（横竖交叉的链接符号）</p>
<p>如下示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span>
<span class="token comment" spellcheck="true">#**coding:utf-8**</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> prettytable <span class="token keyword">import</span> PrettyTable

reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> PrettyTable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'编号'</span><span class="token punctuation">,</span><span class="token string">'云编号'</span><span class="token punctuation">,</span><span class="token string">'名称'</span><span class="token punctuation">,</span><span class="token string">'IP地址'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'server01'</span><span class="token punctuation">,</span><span class="token string">'服务器01'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'server03'</span><span class="token punctuation">,</span><span class="token string">'服务器03'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'server02'</span><span class="token punctuation">,</span><span class="token string">'服务器02'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'9'</span><span class="token punctuation">,</span><span class="token string">'server09'</span><span class="token punctuation">,</span><span class="token string">'服务器09'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.9'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'server04'</span><span class="token punctuation">,</span><span class="token string">'服务器04'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'server05'</span><span class="token punctuation">,</span><span class="token string">'服务器05'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'server06'</span><span class="token punctuation">,</span><span class="token string">'服务器06'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.6'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'server08'</span><span class="token punctuation">,</span><span class="token string">'服务器08'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.8'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'server07'</span><span class="token punctuation">,</span><span class="token string">'服务器07'</span><span class="token punctuation">,</span><span class="token string">'172.16.0.7'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>align<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'l'</span>

table<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token boolean">True</span>
table<span class="token punctuation">.</span>junction_char<span class="token operator">=</span><span class="token string">'$'</span>
table<span class="token punctuation">.</span>horizontal_char <span class="token operator">=</span> <span class="token string">'+'</span>
table<span class="token punctuation">.</span>vertical_char <span class="token operator">=</span> <span class="token string">'%'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>table.border</code>控制是否显示边框，默认是`True</p>
<p><code>table.junction_char</code>控制边框连接符</p>
<p><code>table.horizontal_char</code>控制横边框符号</p>
<p><code>table.vertical_char</code>控制竖边框符号</p>
<p>上例运行如下：</p>
<pre><code>$++++++$++++++++++$++++++++++$++++++++++++$
% 编号 %  云编号  %   名称   %   IP地址   %
$++++++$++++++++++$++++++++++$++++++++++++$
%  1   % server01 % 服务器01 % 172.16.0.1 %
%  3   % server03 % 服务器03 % 172.16.0.3 %
%  2   % server02 % 服务器02 % 172.16.0.2 %
%  9   % server09 % 服务器09 % 172.16.0.9 %
%  4   % server04 % 服务器04 % 172.16.0.4 %
%  5   % server05 % 服务器05 % 172.16.0.5 %
%  6   % server06 % 服务器06 % 172.16.0.6 %
%  8   % server08 % 服务器08 % 172.16.0.8 %
%  7   % server07 % 服务器07 % 172.16.0.7 %
$++++++$++++++++++$++++++++++$++++++++++++$</code></pre><p>以上简单介绍了表格常用的一些样式设置。更具体的方法可参数请参考官方网站：</p>
<p><a href="https://github.com/jazzband/prettytable" target="_blank" rel="noopener">https://github.com/jazzband/prettytable</a></p>
<h1 id="Munch-字典黑魔法库"><a href="#Munch-字典黑魔法库" class="headerlink" title="Munch - 字典黑魔法库"></a>Munch - 字典黑魔法库</h1><p><a href="https://pypi.org/project/munch/" target="_blank" rel="noopener">Munch API</a></p>
<p>当你想访问字典中的某个 key 时，你需要使用字典特定的访问方式，而这种方式需要你键入 一对中括号 还有 一对引号</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> dict<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"iswbm"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> profile
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
<span class="token string">'iswbm'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>是不是开始觉得忍无可忍了？</p>
<p>如果可以像调用对象属性一样使用 <code>.</code> 去访问 key 就好了，可以省去很多多余的键盘击入，就像这样子</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>name
<span class="token string">'iswbm'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="1-安装方法"><a href="#1-安装方法" class="headerlink" title="1. 安装方法"></a>1. 安装方法</h2><p>使用如下命令进行安装</p>
<pre><code>$ python -m pip install munch</code></pre><h2 id="2-简单示例"><a href="#2-简单示例" class="headerlink" title="2. 简单示例"></a>2. 简单示例</h2><p>munch 有一个 Munch 类，它继承自原生字典，使用 isinstance 可以验证</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> munch <span class="token keyword">import</span> Munch
<span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> Munch<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> isinstance<span class="token punctuation">(</span>profile<span class="token punctuation">,</span> dict<span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>并实现了点式赋值与访问，<code>profile.name</code> 与 <code>profile['name']</code> 是等价的</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"iswbm"</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>name
<span class="token string">'iswbm'</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
<span class="token string">'iswbm'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-兼容字典的所有操作"><a href="#3-兼容字典的所有操作" class="headerlink" title="3. 兼容字典的所有操作"></a>3. 兼容字典的所有操作</h2><p>本身 Munch 继承自 dict，dict 的操作也同样适用于 Munch 对象，不妨再来验证下</p>
<p>首先是：增删改查</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 新增元素</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">[</span><span class="token string">"gender"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"male"</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 修改元素</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">[</span><span class="token string">"gender"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"female"</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'female'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 删除元素</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>
<span class="token string">'female'</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">del</span> profile<span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再者是：一些常用方法</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
dict_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'iswbm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token string">'iswbm'</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>
<span class="token string">'male'</span>
<span class="token operator">>></span><span class="token operator">></span> profile
Munch<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-设置返回默认值"><a href="#4-设置返回默认值" class="headerlink" title="4. 设置返回默认值"></a>4. 设置返回默认值</h2><p>当访问一个字典中不存在的 key 时，会报 KeyError 的错误</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
KeyError<span class="token punctuation">:</span> <span class="token string">'name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于这种情况，通常我们会使用 get 来规避</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span>
<span class="token string">'undefined'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>当然你在 munch 中仍然可以这么用，不过还有一种更好的方法：使用 DefaultMunch，它会在你访问不存在的 key 时，给你返回一个设定好的默认值</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> munch <span class="token keyword">import</span> DefaultMunch
<span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> DefaultMunch<span class="token punctuation">(</span><span class="token string">"undefined"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"iswbm"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> profile
DefaultMunch<span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>age
<span class="token string">'undefined'</span>
<span class="token operator">>></span><span class="token operator">></span> profile
DefaultMunch<span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-工厂函数自动创建key"><a href="#5-工厂函数自动创建key" class="headerlink" title="5. 工厂函数自动创建key"></a>5. 工厂函数自动创建key</h2><p>上面使用 <code>DefaultMunch</code> 仅当你访问不存在的 key 是返回一个默认值，但这个行为并不会修改原 munch 对象的任何内容。</p>
<p>若你想访问不存在的 key 时，自动触发给原 munch 中新增你想要访问的 key ，并为其设置一个默认值，可以试一下 <code>DefaultFactoryMunch</code> 传入一个工厂函数。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> munch <span class="token keyword">import</span> DefaultFactoryMunch
<span class="token operator">>></span><span class="token operator">></span> profile <span class="token operator">=</span> DefaultFactoryMunch<span class="token punctuation">(</span>list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'iswbm'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> profile
DefaultFactoryMunch<span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> profile<span class="token punctuation">.</span>brothers
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> profile
DefaultFactoryMunch<span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'iswbm'</span><span class="token punctuation">,</span> <span class="token string">'brothers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-序列化的支持"><a href="#6-序列化的支持" class="headerlink" title="6. 序列化的支持"></a>6. 序列化的支持</h2><p>Munch 支持序列化为 JSON 或者 YAML 格式的字符串对象</p>
<p><strong>转换成 JSON</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> munch <span class="token keyword">import</span> Munch
<span class="token operator">>></span><span class="token operator">></span> munch_obj <span class="token operator">=</span> Munch<span class="token punctuation">(</span>foo<span class="token operator">=</span>Munch<span class="token punctuation">(</span>lol<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> msg<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> json
<span class="token operator">>></span><span class="token operator">></span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>munch_obj<span class="token punctuation">)</span>
<span class="token string">'{"foo": {"lol": true}, "bar": 100, "msg": "hello"}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>转换成 YAML</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> munch <span class="token keyword">import</span> Munch
<span class="token operator">>></span><span class="token operator">></span> munch_obj <span class="token operator">=</span> Munch<span class="token punctuation">(</span>foo<span class="token operator">=</span>Munch<span class="token punctuation">(</span>lol<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> msg<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> yaml
<span class="token operator">>></span><span class="token operator">></span> yaml<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>munch_obj<span class="token punctuation">)</span>
<span class="token string">'!munch.Munch\nbar: 100\nfoo: !munch.Munch\n  lol: true\nmsg: hello\n'</span>
<span class="token operator">>></span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>yaml<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>munch_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
!munch<span class="token punctuation">.</span>Munch
bar<span class="token punctuation">:</span> <span class="token number">100</span>
foo<span class="token punctuation">:</span> !munch<span class="token punctuation">.</span>Munch
  lol<span class="token punctuation">:</span> true
msg<span class="token punctuation">:</span> hello

<span class="token operator">>></span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>建议使用 <code>safe_dump</code> 去掉 <code>!munch.Munch</code></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>yaml<span class="token punctuation">.</span>safe_dump<span class="token punctuation">(</span>munch_obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
bar<span class="token punctuation">:</span> <span class="token number">100</span>
foo<span class="token punctuation">:</span>
  lol<span class="token punctuation">:</span> true
msg<span class="token punctuation">:</span> hello<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Rich-完美终端工具"><a href="#Rich-完美终端工具" class="headerlink" title="Rich - 完美终端工具"></a>Rich - 完美终端工具</h1><p><a href="https://github.com/willmcgugan/rich" target="_blank" rel="noopener">Rich API</a></p>
<p>Rich 是一个 Python 库，可以为你在终端中提供富文本和漂亮、精美的格式。</p>
<p>使用 Rich API 可以很容易的在终端输出添加各种颜色和不同风格。它可以绘制漂亮的表格，进度条，markdown，突出显示语法的源代码及回溯等等，优秀的功能不胜枚举。</p>
<h2 id="1-Rich-兼容性"><a href="#1-Rich-兼容性" class="headerlink" title="1.Rich 兼容性"></a>1.Rich 兼容性</h2><p>Rich 适用于 Linux，OSX 和 Windows。可与新的 Windows 终端一起使用，Windows 的经典终端仅限 8 种颜色。</p>
<p>Rich 还可以与 <strong><code>Jupyter NoteBook</code></strong> 一起使用，而无需其他配置。</p>
<h2 id="2-Rich-安装说明"><a href="#2-Rich-安装说明" class="headerlink" title="2.Rich 安装说明"></a>2.Rich 安装说明</h2><p><strong>请选择以下任一种方式输入命令安装依赖</strong>：</p>
<ol>
<li>Windows 环境 打开 Cmd (开始-运行-CMD)。</li>
<li>MacOS 环境 打开 Terminal (command+空格输入Terminal)。</li>
<li>如果你用的是 VSCode编辑器 或 Pycharm，可以直接使用界面下方的Terminal.</li>
</ol>
<pre><code>pip install rich</code></pre><h2 id="3-Rich-的-Print-功能"><a href="#3-Rich-的-Print-功能" class="headerlink" title="3.Rich 的 Print 功能"></a>3.Rich 的 Print 功能</h2><p>想毫不费力地将 Rich 的输出功能添加到你的Python脚本程序中，你只需导入 rich print 方法，该方法和其他 Python 的自带功能的参数类似。你可以试试：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich <span class="token keyword">import</span> <span class="token keyword">print</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, [bold magenta]World[/bold magenta]!"</span><span class="token punctuation">,</span> <span class="token string">":vampire:"</span><span class="token punctuation">,</span> locals<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118123853228.png" alt=""></p>
<p>可以看到，基于 rich 的 print 方法输出的内容都是带颜色、带重点的，相比于Python自带的 print 有明显的优势。</p>
<h2 id="4-自定义-Console-控制台输出"><a href="#4-自定义-Console-控制台输出" class="headerlink" title="4.自定义 Console 控制台输出"></a>4.自定义 Console 控制台输出</h2><p>想要对 Rich 终端内容进行更多的自定义设置，你需要导入并构造一个控制台对象：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console

console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Console 对象含有一个 print 方法，它的界面与 python 内置的 print 功能相似。你可以试试：</p>
<pre class="line-numbers language-python"><code class="language-python">console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"World!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>你可能已经料到，这时终端上会显示“ Hello World！”，请注意，与内置的“打印”功能不同，Rich 会将文字自动换行以适合终端宽度。</p>
<p>有几种方法可以为输出添加自定义颜色和样式。你可以通过添加 style 关键字参数来为整个输出设置样式。例子如下：</p>
<pre class="line-numbers language-python"><code class="language-python">console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"World!"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"bold red"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>输出如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118123919190.png" alt=""></p>
<p>这个范例一次只设置了一行文字的样式。如果想获得更细腻更复杂的样式，Rich 可以渲染一个特殊的标记，其语法类似于 bbcode。示例如下：</p>
<pre class="line-numbers language-python"><code class="language-python">console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Where there is a [bold cyan]Will[/bold cyan] there [u]is[/u] a [i]way[/i]."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124012077.png" alt=""></p>
<h2 id="5-Console-控制台记录"><a href="#5-Console-控制台记录" class="headerlink" title="5.Console 控制台记录"></a>5.Console 控制台记录</h2><p>Console 对象具有一个 log() 方法，该方法具有与 print() 类似的界面，除此之外，还能显示当前时间以及被调用的文件和行。</p>
<p>默认情况下，Rich 将针对 Python 结构和 repr 字符串进行语法突出显示。如果你记录一个集合（如字典或列表），Rich 会把它漂亮地打印出来，使其切合可用空间。下面是其中一些功能的示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console
console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>

test_data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span> <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"sum"</span><span class="token punctuation">,</span> <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span> <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"notify_hello"</span><span class="token punctuation">,</span> <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span> <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"subtract"</span><span class="token punctuation">,</span> <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">test_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    enabled <span class="token operator">=</span> <span class="token boolean">False</span>
    context <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"foo"</span><span class="token punctuation">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    movies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Deadpool"</span><span class="token punctuation">,</span> <span class="token string">"Rise of the Skywalker"</span><span class="token punctuation">]</span>
    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"Hello from"</span><span class="token punctuation">,</span> console<span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> log_locals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


test_log<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上范例的输出如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124041071.png" alt=""></p>
<p>注意其中的 log_locals 参数会输出一个表格，该表格包含调用 log 方法的局部变量。</p>
<p>log 方法既可用于将长时间运行应用程序（例如服务器）的日志记录到终端，也可用于辅助调试。</p>
<p><strong>Logging 处理程序</strong></p>
<p>你还可以使用内置的处理类来对 Python 日志记录模块的输出进行格式化和着色。下面是输出示例：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124104218.png" alt=""></p>
<h2 id="6-表情符号"><a href="#6-表情符号" class="headerlink" title="6. 表情符号"></a>6. 表情符号</h2><p>将名称放在两个冒号之间即可在控制台输出中插入表情符号。示例如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">":smiley: :vampire: :pile_of_poo: :thumbs_up: :raccoon:"</span><span class="token punctuation">)</span>
😃 🧛 💩 👍 🦝<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>请谨慎地使用此功能。</p>
<h2 id="7-表格"><a href="#7-表格" class="headerlink" title="7.表格"></a>7.表格</h2><p>Rich 包含多种边框，样式，单元格对齐等格式设置的选项。下面是一个简单的示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console
<span class="token keyword">from</span> rich<span class="token punctuation">.</span>table <span class="token keyword">import</span> Column<span class="token punctuation">,</span> Table

console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> Table<span class="token punctuation">(</span>show_header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> header_style<span class="token operator">=</span><span class="token string">"bold magenta"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"Date"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"dim"</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"Title"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"Production Budget"</span><span class="token punctuation">,</span> justify<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_column<span class="token punctuation">(</span><span class="token string">"Box Office"</span><span class="token punctuation">,</span> justify<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>
    <span class="token string">"Dev 20, 2019"</span><span class="token punctuation">,</span> <span class="token string">"Star Wars: The Rise of Skywalker"</span><span class="token punctuation">,</span> <span class="token string">"$275,000,000"</span><span class="token punctuation">,</span> <span class="token string">"$375,126,118"</span>
<span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>
    <span class="token string">"May 25, 2018"</span><span class="token punctuation">,</span>
    <span class="token string">"[red]Solo[/red]: A Star Wars Story"</span><span class="token punctuation">,</span>
    <span class="token string">"$275,000,000"</span><span class="token punctuation">,</span>
    <span class="token string">"$393,151,347"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
table<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>
    <span class="token string">"Dec 15, 2017"</span><span class="token punctuation">,</span>
    <span class="token string">"Star Wars Ep. VIII: The Last Jedi"</span><span class="token punctuation">,</span>
    <span class="token string">"$262,000,000"</span><span class="token punctuation">,</span>
    <span class="token string">"[bold]$1,332,539,889[/bold]"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该示例的输出如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124208244.png" alt=""></p>
<p>请注意，控制台标记的呈现方式与 print() 和 log() 相同。实际上，由 Rich 渲染的任何内容都可以添加到标题/行（甚至其他表格）中。</p>
<p>Table 类很聪明，可以调整列的大小以适合终端的可用宽度，并能根据需要做文本环绕的处理。下面是相同的示例，输出与比上表小的终端上：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124221644.png" alt=""></p>
<h2 id="8-进度条"><a href="#8-进度条" class="headerlink" title="8.进度条"></a>8.进度条</h2><p>Rich 可以渲染多个不闪烁的进度条形图，以跟踪长时间运行的任务。</p>
<p>基本用法：用 track 函数调用程序并迭代结果。下面是一个例子：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>progress <span class="token keyword">import</span> track

<span class="token keyword">for</span> step <span class="token keyword">in</span> track<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    do_step<span class="token punctuation">(</span>step<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>添加多个进度条并不难。以下是效果示例：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124256100.png" alt=""></p>
<p>这些列可以配置为显示你所需的任何详细信息。</p>
<p>内置列包括完成百分比，文件大小，文件速度和剩余时间。下面是显示正在进行的下载的示例：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124332727.png" alt=""></p>
<p>它可以在显示进度的同时下载多个 URL。要自己尝试一下，请参阅示例文件中的 <strong>examples/downloader.py</strong> ，在Python实用宝典公众号后台回复 <strong>rich示例</strong> 下载全部示例。</p>
<h2 id="9-按列输出数据"><a href="#9-按列输出数据" class="headerlink" title="9.按列输出数据"></a>9.按列输出数据</h2><p>Rich 可以将内容通过排列整齐的，具有相等或最佳的宽度的列来呈现。下面是（macOS / Linux） ls 命令的一个非常基本的克隆，用列来显示目录列表：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">from</span> rich <span class="token keyword">import</span> <span class="token keyword">print</span>
<span class="token keyword">from</span> rich<span class="token punctuation">.</span>columns <span class="token keyword">import</span> Columns

directory <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Columns<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下屏幕截图是列示例的输出，该列显示了从 API 提取的数据：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124359880.png" alt=""></p>
<h2 id="10-Markdown"><a href="#10-Markdown" class="headerlink" title="10.Markdown"></a>10.Markdown</h2><p>Rich 可以呈现markdown，相当不错的将其格式显示到终端。</p>
<p>为了渲染 markdown，请导入 Markdown 类，将其打印到控制台。例子如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console
<span class="token keyword">from</span> rich<span class="token punctuation">.</span>markdown <span class="token keyword">import</span> Markdown

console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"README.md"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> readme<span class="token punctuation">:</span>
    markdown <span class="token operator">=</span> Markdown<span class="token punctuation">(</span>readme<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>markdown<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该例子的输出如下图：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124425033.png" alt=""></p>
<h2 id="11-语法突出显示"><a href="#11-语法突出显示" class="headerlink" title="11.语法突出显示"></a>11.语法突出显示</h2><p>Rich 使用 pygments 库来实现语法高亮显示。用法类似于渲染 markdown。构造一个 Syntax 对象并将其打印到控制台。下面是一个例子：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> rich<span class="token punctuation">.</span>console <span class="token keyword">import</span> Console
<span class="token keyword">from</span> rich<span class="token punctuation">.</span>syntax <span class="token keyword">import</span> Syntax

my_code <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
def iter_first_last(values: Iterable[T]) -&amp;gt; Iterable[Tuple[bool, bool, T]]:
    """Iterate and generate a tuple with a flag for first and last value."""
    iter_values = iter(values)
    try:
        previous_value = next(iter_values)
    except StopIteration:
        return
    first = True
    for value in iter_values:
        yield first, False, previous_value
        first = False
        previous_value = value
    yield first, True, previous_value
'''</span>
syntax <span class="token operator">=</span> Syntax<span class="token punctuation">(</span>my_code<span class="token punctuation">,</span> <span class="token string">"python"</span><span class="token punctuation">,</span> theme<span class="token operator">=</span><span class="token string">"monokai"</span><span class="token punctuation">,</span> line_numbers<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
console <span class="token operator">=</span> Console<span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span>syntax<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出如下：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124453657.png" alt=""></p>
<h2 id="12-错误回溯-traceback"><a href="#12-错误回溯-traceback" class="headerlink" title="12.错误回溯(traceback)"></a>12.错误回溯(traceback)</h2><p>Rich 可以渲染漂亮的错误回溯日志，比标准的 Python 回溯更容易阅读，并能显示更多代码。</p>
<p>你可以将 Rich 设置为默认的回溯处理程序，这样所有异常都将由 Rich 为你呈现。</p>
<p>下面是在 OSX（与 Linux 类似）上的外观：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118124518923.png" alt=""></p>
<h1 id="lxml-网页解析库Xpath"><a href="#lxml-网页解析库Xpath" class="headerlink" title="lxml - 网页解析库Xpath"></a>lxml - 网页解析库Xpath</h1><p><a href="https://lxml.de/" target="_blank" rel="noopener">LXML API</a></p>
<h2 id="lxml的安装"><a href="#lxml的安装" class="headerlink" title="lxml的安装"></a>lxml的安装</h2><p>在使用lxml解析库之前，先简单介绍一下lxml的概念，并讲解如何安装lxml库。</p>
<p><strong>lxml的基本概念</strong></p>
<p>lxml是Python的一个解析库，支持html和xml的解析，其解析的效率极快。xpath全称为Xml Path Language，顾名思义，即一种在xml中查找信息的语言。lxml主要是用xpath模块去解析html或者xml等文档内容。</p>
<p><strong>安装lxml</strong></p>
<p>lxml的安装其实很简单，下面介绍两种不同的安装方式（适用不同的操作系统）。</p>
<pre><code>#方式一：pip安装
pip install lxml

#方式二：wheel安装
#下载对应系统版本的wheel文件:http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml
pip install lxml-4.6.3-cp39-cp39-win_amd64.whl</code></pre><p>方式一，通过pip install lxml 命令就可以直接安装；</p>
<p>方式二，需要通过下载whl文件，再去安装。whl文件的下载链接为：<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml，进入这个链接后选择下载自己python版本和系统版本(32位/64位)对应的whl文件即可；" target="_blank" rel="noopener">http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml，进入这个链接后选择下载自己python版本和系统版本(32位/64位)对应的whl文件即可；</a></p>
<h2 id="Xpath的常用规则"><a href="#Xpath的常用规则" class="headerlink" title="Xpath的常用规则"></a>Xpath的常用规则</h2><p>规则具体见表所示。</p>
<table>
<thead>
<tr>
<th><strong>表达式</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>nodename</strong></td>
<td>选取此节点的所有子节点</td>
</tr>
<tr>
<td><strong>/</strong></td>
<td>从当前节点选取直接子节点</td>
</tr>
<tr>
<td><strong>//</strong></td>
<td>从当前节点选择子孙节点</td>
</tr>
<tr>
<td><strong>.</strong></td>
<td>选取当前节点</td>
</tr>
<tr>
<td><strong>..</strong></td>
<td>选择当前节点的父节点</td>
</tr>
<tr>
<td><strong>@</strong></td>
<td>选取属性</td>
</tr>
<tr>
<td>*****</td>
<td>通配符，选择所有元素节点与元素名</td>
</tr>
<tr>
<td><strong>@*</strong></td>
<td>选取所有属性</td>
</tr>
<tr>
<td><strong>node</strong></td>
<td>匹配任何类型的节点</td>
</tr>
</tbody></table>
<p>举例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
test_html <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
&lt;html>
    &lt;h4>学号&lt;/h4>
    &lt;ul>
       &lt;li>2112001&lt;/li>
       &lt;li>2112002&lt;/li>
       &lt;li class='blank'>2112003&lt;/li>
       &lt;li>2112004&lt;/li>
    &lt;/ul>
    &lt;h4>姓名&lt;/h4>
    &lt;ul class="ul" style="color:red">
        &lt;li>张三&lt;/li>
        &lt;li>李四&lt;/li>
        &lt;li>王五&lt;/li>
        &lt;li>老六&lt;/li>
    &lt;/ul>
&lt;/html>
'''</span>
<span class="token comment" spellcheck="true">#将html网页源码加入带etree中</span>
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>StringIO<span class="token punctuation">(</span>test_html<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>

结果：
<span class="token operator">&lt;</span>lxml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>_ElementTree object at <span class="token number">0x00000283496436C8</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上述代码中，先是随机构造了部分html源码，并将其放入lxml的etree对象中。然后待解析的html就可以通过lxml去进行操作。最后对这段html进行不同的提取操作。</p>
<p>获取所有li标签下的数据，并提取其内容： </p>
<pre class="line-numbers language-python"><code class="language-python">list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> list<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据："</span> <span class="token operator">+</span> i<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

结果：
数据：<span class="token number">2112001</span>
数据：<span class="token number">2112002</span>
数据：<span class="token number">2112003</span>
数据：<span class="token number">2112004</span>
数据：张三
数据：李四
数据：王五
数据：老六<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过属性class获取值</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取class为blank的所有li标签，并提取其内容</span>
blank_li_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[@class="blank"]'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> l <span class="token keyword">in</span> blank_li_list<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据："</span> <span class="token operator">+</span> l<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

结果：
数据：<span class="token number">2112003</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>删除子元素</p>
<p>比如要删除第一个ul下的第一个li元素</p>
<pre class="line-numbers language-python"><code class="language-python">获取html中的所有ul标签
first_ul <span class="token operator">=</span> html<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"//ul"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#获取first_ul下的所有li标签</span>
ul_li <span class="token operator">=</span> first_ul<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#打印长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>ul_li<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 删除操作</span>
ul_li<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>ul_li<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#打印长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>ul_li<span class="token punctuation">)</span><span class="token punctuation">)</span>

结果：
<span class="token number">4</span>
<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到获取第一个ul标签，接着取出第一个ul下的所有li标签。输出其长度为4，删除第一个li之后，还是剩下3个li，因此输出3。</p>
<p>获取最后一个ul标签下的所有li数据</p>
<pre class="line-numbers language-python"><code class="language-python">last_ul_li <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul[last()]/li'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> l <span class="token keyword">in</span> last_ul_li<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据："</span> <span class="token operator">+</span> l<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

结果：
数据：张三
数据：李四
数据：王五
数据：老六<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="实战-提取小说所有章节"><a href="#实战-提取小说所有章节" class="headerlink" title="实战:提取小说所有章节"></a>实战:提取小说所有章节</h2><p>现在我们来获取《大主宰》整本小说的所有章节，包括<strong>章节名称</strong>和<strong>章节链接</strong>。 </p>
<p>目标：《大主宰》整本小说的所有章节</p>
<p>链接：<a href="http://book.chenlove.cn/novel/36.html#catalog" target="_blank" rel="noopener">http://book.chenlove.cn/novel/36.html#catalog</a></p>
<p>思路：先获取网页源码，接着通过lxml的xpath模块去解析网页源码，并提取出所有章节的标题和章节链接，最后打印输出。</p>
<p>在开始之前，先预览一下网页页面：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118125202160.png" alt=""></p>
<p>通过按F12，点击elements/元素查看网页源代码：</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211118125215653.png" alt=""></p>
<p>通过查看源代码，我们可以知道所有章节标签内容都在class为cate-list的div标签中，ul下的所有li对应网页中每三章为一行。因此获取到li之后，再解析li标签下的三个a标签。完整代码如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment" spellcheck="true"># 设置代理服务器</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User_Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">#请求链接</span>
url <span class="token operator">=</span> <span class="token string">"http://book.chenlove.cn/novel/36.html#catalog"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 转化为utf-8格式，不加这条语句，输出爬取的信息为乱码</span>
    response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf8'</span>
    <span class="token comment" spellcheck="true">#获取到源码</span>
    html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    ul_li_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@class="cate-list"]/ul/li'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过发送requests请求获取网页源码，并提取出所有小说章节，即class为cate-list的div标签下的所有li标签。接着从li标签中提取出章节标题和章节链接。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">for</span> l <span class="token keyword">in</span> ul_li_list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
     <span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">:</span>
          href <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//@href'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          title <span class="token operator">=</span> i<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//span[@class="chapter_name"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>href<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>集合ul_li_list中存储着所有的li标签，从第五个li开始才是第一章（前面4行是最新章节），因此我们需要从第5行开始，然后通过xpath提取出li中的含有的章节标题和章节链接。</p>
<p>输出：</p>
<blockquote>
<p>第一章 北灵院 /book/12242/39a44ff6dd27f.html</p>
<p>第二章 被踢出灵路的少年 /book/12242/a85e3aae465a4.html</p>
<p>第三章 牧域 /book/12242/820e56c8bc179.html</p>
<p>第四章 大浮屠诀 /book/12242/9b0a211891e10.html</p>
<p>第五章 大千世界 /book/12242/e6fadddc7bf29.html</p>
<p>第六章 灵力增幅 /book/12242/6a3c53c1cf3cb.html</p>
<p>第七章 慕元 /book/12242/7717207387f31.html</p>
<p>……..</p>
</blockquote>
<h1 id="Tiler-将图片转成像素风"><a href="#Tiler-将图片转成像素风" class="headerlink" title="Tiler - 将图片转成像素风"></a>Tiler - 将图片转成像素风</h1><p><a href="https://github.com/nuno-faria/tiler" target="_blank" rel="noopener">Tiler</a></p>
<h2 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h2><p>将项目克隆下载，再安装<code>requirements.txt</code>中的依赖。</p>
<pre><code>git clone https://github.com/nuno-faria/tiler.git

pip install -r requirements.txt</code></pre><h2 id="转换像素图"><a href="#转换像素图" class="headerlink" title="转换像素图"></a>转换像素图</h2><p>现在演示如何利用<code>Tiler</code>，将普通表情包转换成像素风。</p>
<p>经过前文的操作，可以在本地看到已经下载好了文件和配置。</p>
<p>其中，文件夹<code>images</code>里放的是项目示例图片，文件夹<code>tiles</code>里是图块目录，另外<code>conf.py</code>里是配置文件。</p>
<pre><code>C:\Users\Administrator\tiler</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211121114759837.png" alt=""></p>
<p>添加了一个待转换图片——<code>333.png</code>，其实放在其他目录下也不影响，只需要下一步指定好即可。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121114824622.png" alt=""></p>
<p>除了待转换图片，还需要选择像素图块，自带的像素图块中只有line比较合适，我们就先拿它来演示。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121114908942.png" alt=""></p>
<p>其中<code>gen_line_h</code>放置的都是横向的线段图。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121114927450.png" alt=""></p>
<p>生成像素图，在 tiler 目录中执行以下命令：</p>
<pre><code>python tiler.py ./images/333.png ./tiles/lines/gen_line_h/</code></pre><p>执行过程中，有进度条提醒。待转换图片较小，几秒钟就完成了。</p>
<p>此时在 tiler 目录中，已经生成了一个新图片——<code>out.png</code>。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121114954641.png" alt=""></p>
<h2 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h2><p>我猜测是像素图块的问题，上图使用的是长方形的图块。但在自带目录里，未发现有正方形，这样我们就需要<strong>自定义像素块</strong>了。</p>
<p>想要更好的像素风转换效果，最好再调整一下<strong>参数配置</strong>。</p>
<p>先说自定义像素块。</p>
<h3 id="自定义图案"><a href="#自定义图案" class="headerlink" title="自定义图案"></a>自定义图案</h3><p>首先，要在目录<code>tiles</code>内新建一个文件夹<code>square2</code>。</p>
<p>在其中放入一个自定义的像素图块，我准备的是正方形（50x50像素）。</p>
<p>建议颜色为<code>#F0F0F0</code>。</p>
<pre><code>C:\Users\Administrator\tiler\tiles\square2</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211121115038747.png" alt=""></p>
<p>光有一个图块还不行，需要利用脚本<code>gen_tiles.py</code> 生成一系列多颜色图块。</p>
<h3 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h3><p>在生成像素图块前，还可以自定义参数。</p>
<p>通过更改<code>conf.py</code>中的代码，我调整了<code>DEPTH</code>等值。</p>
<ul>
<li>DEPTH：每种颜色的分区数，默认值 4。</li>
<li>COLOR_DEPTH：图片包含颜色的数量，默认值 32。</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121115100102.png" alt=""></p>
<p>作者在<code>conf.py</code>里对每项配置参数都作了注释，大家在使用时可以自行调整。</p>
<h3 id="自定义效果"><a href="#自定义效果" class="headerlink" title="自定义效果"></a>自定义效果</h3><p>接下来生成新的像素图块。</p>
<p>在 tiler 目录下执行命令：</p>
<pre><code>python gen_tiles.py ./tiles/square2/square2.png</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211121115123413.png" alt=""></p>
<p>打开文件夹<code>gen_square2</code>，各种颜色的像素图块已经被生成好了。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121115136808.png" alt=""></p>
<p>接下来，就是使用新图块，重新制作像素图：</p>
<pre><code>python tiler.py ./images/333.png ./tiles/square2/gen_square2/</code></pre><p>生成👇</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211121115155982.png" alt=""></p>
<h1 id="Polars-加速版pandas"><a href="#Polars-加速版pandas" class="headerlink" title="Polars - 加速版pandas"></a>Polars - 加速版pandas</h1><p><a href="https://github.com/ritchie46/polars" target="_blank" rel="noopener">Polars API</a></p>
<p><a href="https://ritchie46.github.io/polars-book/" target="_blank" rel="noopener">Document</a></p>
<p>Polars是通过Rust编写的一个库，Polars的内存模型是基于Apache Arrow。</p>
<p>Polars存在两种API，一种是Eager API，另一种则是Lazy API。</p>
<p>其中Eager API和Pandas的使用类似，语法差不太多，立即执行就能产生结果。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211201120913389.png" alt=""></p>
<p>而Lazy API就像Spark，首先将查询转换为逻辑计划，然后对计划进行重组优化，以减少执行时间和内存使用。</p>
<p>安装Polars，使用百度pip源。</p>
<pre><code># 安装polars
pip install polars -i https://mirror.baidu.com/pypi/simple/</code></pre><p>安装成功后，开始测试，比较Pandas和Polars处理数据的情况。</p>
<p>使用某网站注册用户的用户名数据进行分析，包含约2600万个用户名的CSV文件。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'users.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>数据情况如下。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211201121000610.png" alt=""></p>
<p>此外还使用了一个自己创建的CSV文件，用以数据整合测试。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'fake_user.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到结果如下。</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211201121025149.png" alt=""></p>
<p>首先比较一下两个库的排序算法耗时。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> timeit
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

start <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'users.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
stop <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Time: '</span><span class="token punctuation">,</span> stop <span class="token operator">-</span> start<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Time<span class="token punctuation">:</span>  <span class="token number">27.555776743218303</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到使用Pandas对数据进行排序，花费了大约28s。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> timeit
<span class="token keyword">import</span> polars <span class="token keyword">as</span> pl

start <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> pl<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'users.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>by_column<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
stop <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Time: '</span><span class="token punctuation">,</span> stop <span class="token operator">-</span> start<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Time<span class="token punctuation">:</span>  <span class="token number">9.924110282212496</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Polars只花费了约10s，这意味着Polars比Pandas快了2.7倍。</p>
<p>下面，我们来试试数据整合的效果，纵向连接。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> timeit
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

start <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

df_users <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'users.csv'</span><span class="token punctuation">)</span>
df_fake <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'fake_user.csv'</span><span class="token punctuation">)</span>
df_users<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df_fake<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
stop <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Time: '</span><span class="token punctuation">,</span> stop <span class="token operator">-</span> start<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Time<span class="token punctuation">:</span>  <span class="token number">15.556222308427095</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用Pandas耗时15s。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> timeit
<span class="token keyword">import</span> polars <span class="token keyword">as</span> pl

start <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

df_users <span class="token operator">=</span> pl<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'users.csv'</span><span class="token punctuation">)</span>
df_fake <span class="token operator">=</span> pl<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'fake_user.csv'</span><span class="token punctuation">)</span>
df_users<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>df_fake<span class="token punctuation">)</span>
stop <span class="token operator">=</span> timeit<span class="token punctuation">.</span>default_timer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Time: '</span><span class="token punctuation">,</span> stop <span class="token operator">-</span> start<span class="token punctuation">)</span>

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Time<span class="token punctuation">:</span>  <span class="token number">3.475433263927698</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Polars居然最使用了约3.5s，这里Polars比Pandas快了4.5倍。</p>
<h1 id="ChatterBot-聊天机器人"><a href="#ChatterBot-聊天机器人" class="headerlink" title="ChatterBot - 聊天机器人"></a>ChatterBot - 聊天机器人</h1><p><a href="https://chatterbot.readthedocs.io/en/stable/" target="_blank" rel="noopener">ChatterBot API</a></p>
<h2 id="什么是聊天机器人"><a href="#什么是聊天机器人" class="headerlink" title="什么是聊天机器人"></a>什么是聊天机器人</h2><p>聊天机器人也称为聊天机器人、机器人、人工代理等，基本上是由人工智能驱动的软件程序，其目的是通过文本或语音与用户进行对话。我们日常接触的比较著名的例子包括 Siri、Alexa 等</p>
<p>这些聊天机器人倾向于为用户执行特定任务，聊天机器人经常执行诸如进行交易、预订酒店、提交表格等任务。随着人工智能领域的技术进步，聊天机器人的可能性也是无穷无尽的</p>
<p>当然了，在当前技术下，聊天机器人还是有很多局限性的</p>
<ul>
<li>领域知识 —— 由于真正的人工智能仍然遥不可及，任何聊天机器人在与人类对话时都很难完全理解对话含义</li>
<li>个性 —— 无法正确响应和相当差的理解能力比任何聊天机器人的常见错误更重要，为聊天机器人添加个性仍然是很遥远和困难的事情</li>
</ul>
<p>我们可以将聊天机器人定义为两类</p>
<ul>
<li><p>基于特定规则 —— 在这种方法中，机器人是根据规则进行训练的。基于此，机器人可以回答简单的查询，但有时无法回答复杂的对话</p>
</li>
<li><p>自学 —— 这些机器人遵循机器学习方法，效率更高，并进一步分为另外两类</p>
</li>
<li><ul>
<li>基于检索模型 —— 在这种方法中，机器人根据用户输入从响应列表中检索最佳响应</li>
<li>生成模型 —— 这些模型通常会给出答案，而不是从一组答案中进行搜索，这也使它们成为智能机器人</li>
</ul>
</li>
</ul>
<p>好了，高大上的聊天机器人知识就先介绍到这里，下面我们就通过 chatterbot 来构建一个简单的在线聊天机器人</p>
<h2 id="ChatterBot-库简介"><a href="#ChatterBot-库简介" class="headerlink" title="ChatterBot 库简介"></a>ChatterBot 库简介</h2><p>ChatterBot 是 Python 中的一个库，它生成对用户输入的响应，使用多种机器学习算法来产生各种响应。用户可以更轻松地使用 ChatterBot 库制作具有更准确响应的聊天机器人</p>
<p>ChatterBot 的设计允许机器人接受多种语言的训练，最重要的是，机器学习算法使机器人更容易使用用户的输入自行改进</p>
<p>ChatterBot 可以轻松创建参与对话的软件，每次聊天机器人从用户那里获得输入时，它都会保存输入和响应，这有助于没有初始知识的聊天机器人使用收集到的响应进行自我进化</p>
<p>随着响应的增加，聊天机器人的准确性也会提高。程序从与输入匹配的最接近匹配语句中选择最接近匹配的响应，然后从该响应的已知语句选择中选择响应</p>
<p>安装 ChatterBot 也非常简单</p>
<pre><code>pip install chatterbot</code></pre><h2 id="构建聊天机器人"><a href="#构建聊天机器人" class="headerlink" title="构建聊天机器人"></a>构建聊天机器人</h2><h3 id="机器人训练"><a href="#机器人训练" class="headerlink" title="机器人训练"></a>机器人训练</h3><p>Chatterbot 带有一个数据实用程序模块，可用于训练聊天机器人。目前该模块中有十多种语言的训练数据，我们可以拿来直接使用</p>
<blockquote>
<p><a href="https://github.com/gunthercox/chatterbot-corpus" target="_blank" rel="noopener">https://github.com/gunthercox/chatterbot-corpus</a></p>
</blockquote>
<p>下面是在 python 中开始使用 ChatterBot 的简单示例</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> chatterbot <span class="token keyword">import</span> chatbot
<span class="token keyword">from</span> chatterbot<span class="token punctuation">.</span>trainers <span class="token keyword">import</span> ListTrainer

chatbot <span class="token operator">=</span> Chatbot<span class="token punctuation">(</span><span class="token string">'Edureka'</span><span class="token punctuation">)</span>
trainer <span class="token operator">=</span> ListTrainer<span class="token punctuation">(</span>chatbot<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'hi, can I help you find a course'</span><span class="token punctuation">,</span> <span class="token string">'sure I'</span>d love to find you a course<span class="token string">', '</span>your course have been selected'<span class="token punctuation">]</span><span class="token punctuation">)</span>

response <span class="token operator">=</span> chatbot<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span><span class="token string">"I want a course"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在例子中，我们根据提供的输入从聊天机器人获得响应</p>
<h3 id="构建-flask-app"><a href="#构建-flask-app" class="headerlink" title="构建 flask app"></a>构建 flask app</h3><p>对于基本的 flask 结构，我们直接使用 GitHub 上的一个脚手架，这个是专门用来开发 ChatterBot 应用的</p>
<blockquote>
<p><a href="https://github.com/chamkank/flask-chatterbot" target="_blank" rel="noopener">https://github.com/chamkank/flask-chatterbot</a></p>
</blockquote>
<p>我们直接克隆项目就好</p>
<p>把项目下载到本地之后，我们进行一些修改</p>
<p>我们需要为 HTML 和 CSS 文件添加另外两个目录 static 和模板</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211201121416619.png" alt=""></p>
<p>修改 App.py 文件</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request
<span class="token keyword">from</span> chatterbot <span class="token keyword">import</span> ChatBot
<span class="token keyword">from</span> chatterbot<span class="token punctuation">.</span>trainers <span class="token keyword">import</span> ChatterBotCorpusTrainer

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

english_bot <span class="token operator">=</span> ChatBot<span class="token punctuation">(</span><span class="token string">"Chatterbot"</span><span class="token punctuation">,</span> storage_adapter<span class="token operator">=</span><span class="token string">"chatterbot.storage.SQLStorageAdapter"</span><span class="token punctuation">)</span>
trainer <span class="token operator">=</span> ChatterBotCorpusTrainer<span class="token punctuation">(</span>english_bot<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token string">"chatterbot.corpus.english"</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_bot_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    userText <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> str<span class="token punctuation">(</span>english_bot<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span>userText<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>index.html 文件</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/static/style.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Flask Chatterbot Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chatbox<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>botText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>Hi! I'm Chatterbot.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userInput<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>textInput<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>buttonInput<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Send<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">function</span> <span class="token function">getBotResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> rawText <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#textInput"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> userHtml <span class="token operator">=</span> <span class="token string">'&lt;p class="userText">&lt;span>'</span> <span class="token operator">+</span> rawText <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#textInput"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#chatbox"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>userHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'userInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>block<span class="token punctuation">:</span> <span class="token string">'start'</span><span class="token punctuation">,</span> behavior<span class="token punctuation">:</span> <span class="token string">'smooth'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> msg<span class="token punctuation">:</span> rawText <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> botHtml <span class="token operator">=</span> <span class="token string">'&lt;p class="botText">&lt;span>'</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#chatbox"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>botHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'userInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>block<span class="token punctuation">:</span> <span class="token string">'start'</span><span class="token punctuation">,</span> behavior<span class="token punctuation">:</span> <span class="token string">'smooth'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#textInput"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keypress</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>which <span class="token operator">==</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">getBotResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#buttonInput"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">getBotResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>index.html 文件将包含应用程序的模板，而 style.css 将包含带有 CSS 代码的样式表。执行上述程序后，我们将得到如下图所示的输出</p>
<p>Style.css 文件</p>
<pre class="line-numbers language-css"><code class="language-css"><span class="token selector">body
</span><span class="token punctuation">{</span>
<span class="token property">font-family</span><span class="token punctuation">:</span> Garamond<span class="token punctuation">;</span>
<span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">h1
</span><span class="token punctuation">{</span>
<span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">40</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">h3
</span><span class="token punctuation">{</span>
<span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
<span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">3</span>px<span class="token punctuation">;</span>
<span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#chatbox</span>
</span><span class="token punctuation">{</span>
<span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token property">margin-left</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">margin-right</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">40%</span><span class="token punctuation">;</span>
<span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">60</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#userInput</span> </span><span class="token punctuation">{</span>
<span class="token property">margin-left</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">margin-right</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">40%</span><span class="token punctuation">;</span>
<span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">60</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#textInput</span> </span><span class="token punctuation">{</span>
<span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">87%</span><span class="token punctuation">;</span>
<span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token property">border-bottom</span><span class="token punctuation">:</span> <span class="token number">3</span>px solid <span class="token hexcode">#009688</span><span class="token punctuation">;</span>
<span class="token property">font-family</span><span class="token punctuation">:</span> monospace<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">17</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#buttonInput</span> </span><span class="token punctuation">{</span>
<span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">3</span>px<span class="token punctuation">;</span>
<span class="token property">font-family</span><span class="token punctuation">:</span> monospace<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">17</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.userText</span> </span><span class="token punctuation">{</span>
<span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token property">font-family</span><span class="token punctuation">:</span> monospace<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">17</span>px<span class="token punctuation">;</span>
<span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
<span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.userText</span> span </span><span class="token punctuation">{</span>
<span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#009688</span><span class="token punctuation">;</span>
<span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>
<span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">2</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.botText</span> </span><span class="token punctuation">{</span>
<span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token property">font-family</span><span class="token punctuation">:</span> monospace<span class="token punctuation">;</span>
<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">17</span>px<span class="token punctuation">;</span>
<span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.botText</span> span </span><span class="token punctuation">{</span>
<span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#EF5350</span><span class="token punctuation">;</span>
<span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>
<span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">2</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#tidbit</span> </span><span class="token punctuation">{</span>
<span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span>
<span class="token property">bottom</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token property">right</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来我们打开网页，就可以看到聊天页面啦</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211201121511916.png" alt=""></p>
<p>有一个文本框，我们可以在其中提供用户输入，机器人将为该语句生成相应的响应消息，当我们输入的消息越多，机器人就会越智能！</p>
<h1 id="Pynput-监控键盘和鼠标"><a href="#Pynput-监控键盘和鼠标" class="headerlink" title="Pynput - 监控键盘和鼠标"></a>Pynput - 监控键盘和鼠标</h1><h2 id="使用pynput库"><a href="#使用pynput库" class="headerlink" title="使用pynput库"></a>使用pynput库</h2><p>pynput 可以监控我们的键盘和鼠标。目前具有此类功能的库有很多，比如 pygame 等游戏库，但是当我们只需要监控键盘和鼠标时，它们就显得过于笨重了。</p>
<h2 id="对键盘监控"><a href="#对键盘监控" class="headerlink" title="对键盘监控"></a>对键盘监控</h2><p>在他的电脑常驻一个后台进程去实现监控键盘输入并记录下来，代码大概可以这样：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> pynput <span class="token keyword">import</span> keyboard
<span class="token keyword">def</span> <span class="token function">on_press</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{key} :pushed'</span><span class="token punctuation">)</span>
 <span class="token keyword">def</span> <span class="token function">on_release</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#print(f'{key} released')</span>
    <span class="token keyword">if</span> key <span class="token operator">==</span> keyboard<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>esc<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Stop listener</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token keyword">with</span> keyboard<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_press<span class="token operator">=</span>on_press<span class="token punctuation">,</span>on_release<span class="token operator">=</span>on_release<span class="token punctuation">)</span> <span class="token keyword">as</span> lsn<span class="token punctuation">:</span>
    lsn<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="对鼠标监控"><a href="#对鼠标监控" class="headerlink" title="对鼠标监控"></a>对鼠标监控</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> pynput <span class="token keyword">import</span> mouse

<span class="token keyword">def</span> <span class="token function">on_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> button<span class="token punctuation">,</span> pressed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> button <span class="token operator">==</span> mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'left was pressed!'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> button <span class="token operator">==</span> mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'right was pressed!'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'mid was pressed!'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Collect events until released</span>
<span class="token keyword">with</span> mouse<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_click<span class="token operator">=</span>on_click<span class="token punctuation">)</span> <span class="token keyword">as</span> listener<span class="token punctuation">:</span>
    listener<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>你会发现，每条打印都被打印了两次，这是因为按下去和抬起来都会触发鼠标事件。</p>
<h2 id="监控并记录到日志文件"><a href="#监控并记录到日志文件" class="headerlink" title="监控并记录到日志文件"></a>监控并记录到日志文件</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> pynput <span class="token keyword">import</span> keyboard<span class="token punctuation">,</span>mouse
<span class="token keyword">from</span> loguru <span class="token keyword">import</span> logger
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token comment" spellcheck="true"># 定义日志文件</span>
logger<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'demo.log'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">on_press</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>f<span class="token string">'{key} :pushed'</span><span class="token punctuation">)</span> 
<span class="token keyword">def</span> <span class="token function">on_release</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#print(f'{key} released')</span>
    <span class="token keyword">if</span> key <span class="token operator">==</span> keyboard<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>esc<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Stop listener</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token comment" spellcheck="true"># 定义f1用于线程1</span>
<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> keyboard<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_press<span class="token operator">=</span>on_press<span class="token punctuation">,</span>on_release<span class="token operator">=</span>on_release<span class="token punctuation">)</span> <span class="token keyword">as</span> lsn<span class="token punctuation">:</span>
        lsn<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">on_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> button<span class="token punctuation">,</span> pressed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> button <span class="token operator">==</span> mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'left was pressed!'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> button <span class="token operator">==</span> mouse<span class="token punctuation">.</span>Button<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'right was pressed!'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'mid was pressed!'</span><span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true"># 定义f2用于线程2</span>
<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Collect events until released</span>
    <span class="token keyword">with</span> mouse<span class="token punctuation">.</span>Listener<span class="token punctuation">(</span>on_click<span class="token operator">=</span>on_click<span class="token punctuation">)</span> <span class="token keyword">as</span> listener<span class="token punctuation">:</span>
        listener<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 起两个线程分别监控键盘和鼠标</span>
    t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>f1<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>f2<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样键盘操作已经全部被记录，通过对这个日志文件进行简单的 <code>NLTK</code> 语言处理，就能复原聊天记录。</p>
<h1 id="图像处理库合集"><a href="#图像处理库合集" class="headerlink" title="图像处理库合集"></a>图像处理库合集</h1><h2 id="SimpleCV"><a href="#SimpleCV" class="headerlink" title="SimpleCV"></a>SimpleCV</h2><ul>
<li>SimpleCV也是广泛被使用的构建计算机视觉应用程序的开源框架。手握SimpleCV，你可以访问几个高性能的视觉库，而无需先了解图像色深（bit depth）、文件格式、色彩空间等。SimpleCV拥护者的支持理由有两个，一是初学者也可以借此编写简单的视觉任务，二是无论是相机、视频文件、图像和视频流可互相操作。</li>
</ul>
<p>用户指南：<a href="https://simplecv.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://simplecv.readthedocs.io/en/latest/</a></p>
<h2 id="Mahotas"><a href="#Mahotas" class="headerlink" title="Mahotas"></a>Mahotas</h2><ul>
<li><p>Mahotas包含传统的图像处理功能，如滤波和图像形态学处理，以及用于特征计算，比如兴趣点检测和局部描述子等。</p>
<p>这个库适用于快速开发，算法是用C++实现的，并且针对速度进行了调整。</p>
</li>
</ul>
<p>官方地址：<br><a href="https://mahotas.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://mahotas.readthedocs.io/en/latest/</a></p>
<p>用户指南：<br><a href="https://mahotas.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">https://mahotas.readthedocs.io/en/latest/index.html</a></p>
<h2 id="SimpleITK"><a href="#SimpleITK" class="headerlink" title="SimpleITK"></a><strong>SimpleITK</strong></h2><ul>
<li>ITK是一个开源的跨平台系统，提供一整套用于图像分析的软件工具。其中，SimpleITK是一个建立在ITK之上的简化层，促进其在简化原型、教育和解释语言中的应用。SimpleITK是一个图像分析工具包，内含大量组件，支持一般滤波操作、图像分割和图形配准。SimpleITK本身是用C++编写的，但也适用于包括Python在内的大量编程语言。</li>
</ul>
<p>官方地址：<br><a href="https://itk.org/" target="_blank" rel="noopener">https://itk.org/</a></p>
<p>学习资料：<br><a href="http://insightsoftwareconsortium.github.io/SimpleITK-Notebooks/" target="_blank" rel="noopener">http://insightsoftwareconsortium.github.io/SimpleITK-Notebooks/</a></p>
<h2 id="GraphicsMagick"><a href="#GraphicsMagick" class="headerlink" title="GraphicsMagick"></a><strong>GraphicsMagick</strong></h2><ul>
<li>GraphicsMagick号称图像处理领域的瑞士军刀。代码短小却提供了一个鲁棒、高效的工具和库集合，可用来处理图像的读取、写入和操作。支持超过88种图像格式，包括重要的DPX、GIF、JPEG、JPEG-2000、PNG、PDF、PNM和TIFF。</li>
</ul>
<p>官方资料：<br><a href="https://pypi.org/project/pgmagick/" target="_blank" rel="noopener">https://pypi.org/project/pgmagick/</a></p>
<p>相关资源：<br><a href="https://github.com/hhatto/pgmagick" target="_blank" rel="noopener">https://github.com/hhatto/pgmagick</a></p>
<h2 id="Pycairo"><a href="#Pycairo" class="headerlink" title="Pycairo"></a><strong>Pycairo</strong></h2><ul>
<li>pyCairo是一个Python的2D图形渲染库，可用于绘制矢量图形的2D图形，在调整大小或变换时不会丢失清晰度。下面这个用例是用Pycairo绘制线条、基本形状和径向梯度。</li>
</ul>
<p>官方介绍：<br><a href="https://cairographics.org/" target="_blank" rel="noopener">https://cairographics.org/</a></p>
<p>相关资源：<br><a href="https://github.com/pygobject/pycairo" target="_blank" rel="noopener">https://github.com/pygobject/pycairo</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/blog-python24.html">https://jackhcc.github.io/posts/blog-python24.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-10-03T12-36-58',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/dl-series1.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/5.jpg" class="responsive-img" alt="DL专栏1-PyTorch Tricks">
                        
                        <span class="card-title">DL专栏1-PyTorch Tricks</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            PyTorch使用及技巧
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-10-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/PyTorch/">
                        <span class="chip bg-color">PyTorch</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/blog-python23.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/18.jpg" class="responsive-img" alt="Python Skills">
                        
                        <span class="card-title">Python Skills</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Python实用技巧
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-10-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

