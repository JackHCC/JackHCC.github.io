<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Embedded Assembly Languages, JackHCC">
    <meta name="description" content="ARM嵌入式汇编">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Embedded Assembly Languages | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/15.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Embedded Assembly Languages</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Assembly/">
                                <span class="chip bg-color">Assembly</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Embedded/" class="post-category">
                                Embedded
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-10-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-11-08
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    44 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><h2 id="Translating-languages"><a href="#Translating-languages" class="headerlink" title="Translating languages"></a>Translating languages</h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211019232747241.png" alt=""></p>
<h2 id="Virtual-machines"><a href="#Virtual-machines" class="headerlink" title="Virtual machines"></a><strong>Virtual machines</strong></h2><p><strong>Abstractions for computers</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211019235840026.png" alt=""></p>
<h3 id="High-level-language"><a href="#High-level-language" class="headerlink" title="High-level language"></a><strong>High-level language</strong></h3><ul>
<li><p>Level 5</p>
</li>
<li><p>Application-oriented languages</p>
</li>
<li><p>Programs compile into assembly language (Level 4) </p>
</li>
</ul>
<h3 id="Assembly-language"><a href="#Assembly-language" class="headerlink" title="Assembly language"></a><strong>Assembly language</strong></h3><ul>
<li><p>Level 4</p>
</li>
<li><p>Instruction mnemonics that have a one-to-one correspondence to machine language</p>
</li>
<li><p>Calls functions written at the operating system level (Level 3)</p>
</li>
<li><p>Programs are translated into machine language (Level 2)</p>
</li>
</ul>
<h3 id="Operating-system"><a href="#Operating-system" class="headerlink" title="Operating system"></a><strong>Operating system</strong></h3><ul>
<li><p>Level 3</p>
</li>
<li><p>Provides services</p>
</li>
<li><p>Programs translated and run at the instruction set architecture level (Level 2)</p>
</li>
</ul>
<h3 id="Instruction-set-architecture"><a href="#Instruction-set-architecture" class="headerlink" title="Instruction set architecture"></a><strong>Instruction set architecture</strong></h3><ul>
<li><p>Level 2</p>
</li>
<li><p>Also known as conventional machine language</p>
</li>
<li><p>Executed by Level 1 program (microarchitecture, Level 1)</p>
</li>
</ul>
<h3 id="Microarchitecture"><a href="#Microarchitecture" class="headerlink" title="Microarchitecture"></a><strong>Microarchitecture</strong></h3><ul>
<li><p>Level 1</p>
</li>
<li><p>Interprets conventional machine instructions (Level 2)</p>
</li>
<li><p>Executed by digital hardware (Level 0)</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000050883.png" alt=""></p>
<h3 id="Digital-logic"><a href="#Digital-logic" class="headerlink" title="Digital logic"></a><strong>Digital logic</strong></h3><ul>
<li><p>Level 0</p>
</li>
<li><p>CPU, constructed from digital logic gates</p>
</li>
<li><p>System bus</p>
</li>
<li><p>Memory</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000123867.png" alt=""></p>
<h2 id="Data-representation"><a href="#Data-representation" class="headerlink" title="Data representation"></a><strong>Data representation</strong></h2><ul>
<li><p>Computer is a construction of digital circuits with two states: <em>on</em> and <em>off</em> </p>
</li>
<li><p>You need to have the ability to translate between different representations to examine the content of the machine </p>
</li>
<li><p>Common number systems: binary, octal, decimal and hexadecimal </p>
</li>
</ul>
<h2 id="Binary-representations"><a href="#Binary-representations" class="headerlink" title="Binary representations"></a><strong>Binary representations</strong></h2><ul>
<li>Electronic Implementation<ul>
<li>Easy to store with bistable elements</li>
<li>Reliably transmitted on noisy and inaccurate wires </li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000223942.png" alt=""></p>
<ul>
<li><p>Digits are 1 and 0  (a binary digit is called a bit) </p>
<p>  1 = true </p>
<p>  0 = false </p>
</li>
<li><p>MSB –most significant bit </p>
</li>
<li><p>LSB –least significant bit </p>
</li>
<li><p>Bit numbering: </p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000313114.png" alt=""></p>
</li>
<li><p>A bit string could have different interpretations </p>
</li>
</ul>
<h2 id="Unsigned-binary-integers"><a href="#Unsigned-binary-integers" class="headerlink" title="Unsigned binary integers"></a><strong>Unsigned binary integers</strong></h2><ul>
<li><p>Each digit (bit) is either 1 or 0 </p>
</li>
<li><p>Each bit represents a power of 2:</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000347718.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000353180.png" alt=""></p>
<h2 id="Integer-storage-sizes"><a href="#Integer-storage-sizes" class="headerlink" title="Integer storage sizes"></a><strong>Integer storage sizes</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000438467.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000445662.png" alt=""></p>
<h3 id="Large-measurements"><a href="#Large-measurements" class="headerlink" title="Large measurements"></a><strong>Large measurements</strong></h3><p>•Kilobyte (KB), 210 bytes</p>
<p>•Megabyte (MB), 220 bytes</p>
<p>•Gigabyte (GB), 230 bytes</p>
<p>•Terabyte (TB), 240 bytes</p>
<p>•Petabyte</p>
<p>•Exabyte</p>
<p>•Zettabyte</p>
<p>•Yottabyte</p>
<h3 id="Signed-integers"><a href="#Signed-integers" class="headerlink" title="Signed integers"></a><strong>Signed integers</strong></h3><p>The highest bit indicates the sign. 1 = negative,  0 = positive</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000600796.png" alt=""></p>
<p>If the highest digit of a hexadecmal integer is &gt; 7, the value is negative. Examples: 8A, C5, A2, 9D</p>
<h3 id="Two’s-complement-notation"><a href="#Two’s-complement-notation" class="headerlink" title="Two’s complement notation"></a><strong>Two’s complement notation</strong></h3><p>Steps:</p>
<ul>
<li><p>Complement (reverse) each bit</p>
</li>
<li><p>Add 1</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000646880.png" alt=""></p>
<h3 id="Ranges-of-signed-integers"><a href="#Ranges-of-signed-integers" class="headerlink" title="Ranges of signed integers"></a><strong>Ranges of signed integers</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000707479.png" alt=""></p>
<h2 id="Character"><a href="#Character" class="headerlink" title="Character"></a><strong>Character</strong></h2><ul>
<li><p>Character sets</p>
<ul>
<li>Standard ASCII (0 – 127)</li>
<li>Extended ASCII (0 – 255)</li>
<li>ANSI (0 – 255)</li>
<li>Unicode (0 – 65,535)</li>
</ul>
</li>
<li><p>Null-terminated String</p>
<ul>
<li>Array of characters followed by a <em>null byte</em></li>
</ul>
</li>
<li><p>Using the ASCII table</p>
<ul>
<li>back inside cover of book</li>
</ul>
</li>
</ul>
<h2 id="Representing-Instructions"><a href="#Representing-Instructions" class="headerlink" title="Representing Instructions"></a><strong>Representing Instructions</strong></h2><pre><code>int sum(int x, int y)
{
   return x+y;
}</code></pre><ul>
<li><p>For this example, Alpha &amp; Sun use two 4-byte instructions</p>
<ul>
<li>Use differing numbers of instructions in other cases</li>
</ul>
</li>
<li><p>PC uses 7 instructions with lengths 1, 2, and 3 bytes</p>
<ul>
<li>Same for NT and for Linux</li>
<li>NT / Linux not fully binary compatible</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000855579.png" alt=""></p>
<h2 id="Boolean-algebra"><a href="#Boolean-algebra" class="headerlink" title="Boolean algebra"></a><strong>Boolean algebra</strong></h2><ul>
<li>Boolean expressions created from:<ul>
<li>NOT, AND, OR</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020000941029.png" alt=""></p>
<h3 id="Implementation-of-gates"><a href="#Implementation-of-gates" class="headerlink" title="Implementation of gates"></a><strong>Implementation of gates</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020001012456.png" alt=""></p>
<h1 id="Advanced-Architecture"><a href="#Advanced-Architecture" class="headerlink" title="Advanced Architecture"></a>Advanced Architecture</h1><h2 id="Basic-architecture"><a href="#Basic-architecture" class="headerlink" title="Basic architecture"></a><strong>Basic architecture</strong></h2><h3 id="Basic-microcomputer-design"><a href="#Basic-microcomputer-design" class="headerlink" title="Basic microcomputer design"></a><strong>Basic microcomputer design</strong></h3><ul>
<li><p>clock synchronizes CPU operations</p>
</li>
<li><p>control unit (CU) coordinates sequence of execution steps</p>
</li>
<li><p>ALU performs arithmetic and logic operations</p>
</li>
<li><p>The memory storage unit holds instructions and data for a running program</p>
</li>
<li><p>A bus is a group of wires that transfer data from one part to another (data, address, control)</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020122711512.png" alt=""></p>
<h3 id="Clock"><a href="#Clock" class="headerlink" title="Clock"></a><strong>Clock</strong></h3><ul>
<li><p>synchronizes all CPU and BUS operations</p>
</li>
<li><p>machine (clock) cycle measures time of a single operation</p>
</li>
<li><p>clock is used to trigger events</p>
</li>
<li><p>Basic unit of time, 1GHz→clock cycle=1ns</p>
</li>
<li><p>An instruction could take multiple cycles to complete, e.g. multiply in 8088 takes 50 cycles</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020122810882.png" alt=""></p>
<h3 id="Instruction-execution-cycle"><a href="#Instruction-execution-cycle" class="headerlink" title="Instruction execution cycle"></a><strong>Instruction execution cycle</strong></h3><ul>
<li><p>Fetch</p>
</li>
<li><p>Decode</p>
</li>
<li><p>Fetch operands</p>
</li>
<li><p>Execute</p>
</li>
<li><p>Store output</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020122854819.png" alt=""></p>
<h2 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a><strong>Pipeline</strong></h2><h3 id="Multi-stage-pipeline"><a href="#Multi-stage-pipeline" class="headerlink" title="Multi-stage pipeline"></a><strong>Multi-stage pipeline</strong></h3><ul>
<li><p>Pipelining makes it possible for processor to execute instructions in parallel</p>
</li>
<li><p>Instruction execution divided into discrete stages</p>
</li>
</ul>
<p>Example of a non-pipelined processor. For example, 80386. Many wasted cycles.</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123015666.png" alt=""></p>
<h3 id="Pipelined-execution"><a href="#Pipelined-execution" class="headerlink" title="Pipelined execution"></a><strong>Pipelined execution</strong></h3><ul>
<li><p>More efficient use of cycles, greater throughput of instructions: (80486 started to use pipelining)</p>
<p>For <em>k</em> stages and <em>n</em> instructions, the number of required cycles is: <em>k</em> + (<em>n</em> – 1) compared to k*n</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123109343.png" alt=""></p>
<ul>
<li>Pipelining requires buffers<ul>
<li>Each buffer holds a single value</li>
<li>Ideal scenario: equal work for each stage<ul>
<li>Sometimes it is not possible</li>
<li>Slowest stage determines the flow rate in the entire pipeline</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123145190.png" alt=""></p>
<ul>
<li><p>Some reasons for unequal work stages</p>
<ul>
<li>A complex step cannot be subdivided conveniently</li>
<li>An operation takes variable amount of time to execute, e.g. operand fetch time depends on where the operands are located<ul>
<li>Registers </li>
<li>Cache </li>
<li>Memory</li>
</ul>
</li>
<li>Complexity of operation depends on the type of operation<ul>
<li>Add: may take one cycle</li>
<li>Multiply: may take several cycles</li>
</ul>
</li>
</ul>
</li>
<li><p>Operand fetch of I2 takes three cycles</p>
<ul>
<li>Pipeline <strong>stalls</strong> for two cycles<ul>
<li>Caused by hazards</li>
</ul>
</li>
<li>Pipeline stalls reduce overall throughput</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123306627.png" alt=""></p>
<h3 id="Wasted-cycles-pipelined"><a href="#Wasted-cycles-pipelined" class="headerlink" title="Wasted cycles (pipelined)"></a><strong>Wasted cycles (pipelined)</strong></h3><ul>
<li><p>When one of the stages requires two or more clock cycles, clock cycles are again wasted.</p>
<p>For <em>k</em> stages and <em>n</em> instructions, the number of required cycles is:  <em>k</em> + (2<em>n</em> – 1)</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123344243.png" alt=""></p>
<h3 id="Superscalar"><a href="#Superscalar" class="headerlink" title="Superscalar"></a><strong>Superscalar</strong></h3><ul>
<li><p>A superscalar processor has multiple execution pipelines. In the following, note that Stage S4 has left and right pipelines (u and v).</p>
<p>For <em>k</em> states and <em>n</em> instructions, the number of required cycles is:    <em>k</em> + <em>n</em></p>
</li>
<li><p>Pentium: 2 pipelines</p>
</li>
<li><p>Pentium Pro: 3</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123431844.png" alt=""></p>
<h3 id="Pipeline-stages"><a href="#Pipeline-stages" class="headerlink" title="Pipeline stages"></a><strong>Pipeline stages</strong></h3><ul>
<li><p>Pentium 3: 10</p>
</li>
<li><p>Pentium 4: 20~31</p>
</li>
<li><p>Next-generation micro-architecture: 14</p>
</li>
<li><p>ARM7: 3</p>
</li>
</ul>
<h3 id="Hazards-危害"><a href="#Hazards-危害" class="headerlink" title="Hazards(危害)"></a><strong>Hazards(危害)</strong></h3><ul>
<li>Three types of hazards<ul>
<li>Resource hazards<ul>
<li>Occurs when two or more instructions use the same resource, also called <strong>structural hazards</strong></li>
</ul>
</li>
<li>Data hazards<ul>
<li>Caused by data dependencies between instructions, e.g. result produced by I1 is read by I2</li>
</ul>
</li>
<li>Control hazards<ul>
<li>Default: sequential execution suits pipelining</li>
<li>Altering control flow (e.g., branching) causes problems, introducing control dependencies</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Data-hazards"><a href="#Data-hazards" class="headerlink" title="Data hazards"></a><strong>Data hazards</strong></h4><pre><code>add r1, r2, #10        ; write r1
sub r3, r1, #20        ; read r1</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123720411.png" alt=""></p>
<ul>
<li>Forwarding: provides output result as soon as possible</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123804251.png" alt=""></p>
<h4 id="Control-hazards"><a href="#Control-hazards" class="headerlink" title="Control hazards"></a><strong>Control hazards</strong></h4><pre><code>            bz  r1, target        
            add r2, r4, 0
            ...
target:    add r2, r3, 0</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123834578.png" alt=""></p>
<ul>
<li><p>Braches alter control flow</p>
<ul>
<li>Require special attention in pipelining</li>
<li>Need to throw away some instructions in the pipeline<ul>
<li>Depends on when we know the branch is taken</li>
<li>Pipeline wastes three clock cycles<ul>
<li>Called <strong>branch penalty</strong></li>
</ul>
</li>
</ul>
</li>
<li>Reducing branch penalty<ul>
<li>Determine branch decision early</li>
</ul>
</li>
</ul>
</li>
<li><p>Delayed branch execution</p>
<ul>
<li>Effectively reduces the branch penalty</li>
<li>We always fetch the instruction following the branch<ul>
<li>Why throw it away?</li>
<li>Place a useful instruction to execute</li>
<li>This is called <strong>delay slot</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020123955259.png" alt=""></p>
<h3 id="Branch-prediction"><a href="#Branch-prediction" class="headerlink" title="Branch prediction"></a><strong>Branch prediction</strong></h3><ul>
<li><p>Three prediction strategies</p>
<ul>
<li><p>Fixed</p>
<ul>
<li><p>Prediction is fixed</p>
<ul>
<li><p>Example: <strong>branch-never-taken</strong></p>
<p>»Not proper for loop structures</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Static</p>
<ul>
<li>Strategy depends on the branch type<ul>
<li>Conditional branch: always not taken</li>
<li>Loop: always taken</li>
</ul>
</li>
</ul>
</li>
<li><p>Dynamic</p>
<ul>
<li>Takes run-time history to make more accurate predictions</li>
</ul>
</li>
</ul>
</li>
<li><p>Static prediction</p>
<ul>
<li>Improves prediction accuracy over Fixed</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124227086.png" alt=""></p>
<ul>
<li><p>Dynamic branch prediction</p>
<ul>
<li>Uses runtime history<ul>
<li>Takes the past <strong>n</strong> branch executions of the branch type and makes the prediction</li>
</ul>
</li>
<li>Simple strategy<ul>
<li>Prediction of the next branch is the <strong>majority</strong> of the previous <strong>n</strong> branch executions</li>
<li>Example<strong>: n</strong> = 3<ul>
<li>If two or more of the last three branches were taken, the prediction is “branch taken”</li>
</ul>
</li>
<li>Depending on the type of mix, we get more than 90% prediction accuracy</li>
</ul>
</li>
</ul>
</li>
<li><p>Impact of past <strong>n</strong> branches on prediction accuracy</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124338380.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124349674.png" alt=""></p>
<h3 id="Multitasking"><a href="#Multitasking" class="headerlink" title="Multitasking"></a><strong>Multitasking</strong></h3><ul>
<li><p>OS can run multiple programs at the same time.</p>
</li>
<li><p>Multiple threads of execution within the same program.</p>
</li>
<li><p>Scheduler utility assigns a given amount of CPU time to each running program.</p>
</li>
<li><p>Rapid switching of tasks</p>
<ul>
<li>gives illusion that all programs are running at once</li>
<li>the processor must support task switching</li>
<li>scheduling policy, round-robin, priority</li>
</ul>
</li>
</ul>
<h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a><strong>Cache</strong></h2><h3 id="SRAM-vs-DRAM"><a href="#SRAM-vs-DRAM" class="headerlink" title="SRAM vs DRAM"></a><strong>SRAM vs DRAM</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124505680.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124517411.png" alt=""></p>
<h3 id="The-CPU-Memory-gap"><a href="#The-CPU-Memory-gap" class="headerlink" title="The CPU-Memory gap"></a><strong>The CPU-Memory gap</strong></h3><p>The gap widens between DRAM, disk, and CPU speeds. </p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124556062.png" alt=""></p>
<h3 id="Memory-hierarchies-等级"><a href="#Memory-hierarchies-等级" class="headerlink" title="Memory hierarchies(等级)"></a><strong>Memory hierarchies(等级)</strong></h3><ul>
<li><p>Some fundamental and enduring properties of hardware and software:</p>
<ul>
<li>Fast storage technologies cost more per byte, have less capacity, and require more power (heat!). </li>
<li>The gap between CPU and main memory speed is widening.</li>
<li>Well-written programs tend to exhibit good locality.</li>
</ul>
</li>
<li><p>They suggest an approach for organizing memory and storage systems known as a memory hierarchy.</p>
</li>
</ul>
<h3 id="Memory-system-in-practice"><a href="#Memory-system-in-practice" class="headerlink" title="Memory system in practice"></a><strong>Memory system in practice</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124720787.png" alt=""></p>
<h3 id="Reading-from-memory"><a href="#Reading-from-memory" class="headerlink" title="Reading from memory"></a><strong>Reading from memory</strong></h3><ul>
<li>Multiple machine cycles are required when reading from memory, because it responds much more slowly than the CPU (e.g.33 MHz). The wasted clock cycles are called wait states.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124759709.png" alt=""></p>
<h3 id="Cache-memory"><a href="#Cache-memory" class="headerlink" title="Cache memory"></a><strong>Cache memory</strong></h3><ul>
<li><p>High-speed expensive static RAM both inside and outside the CPU.</p>
<ul>
<li>Level-1 cache: inside the CPU</li>
<li>Level-2 cache: outside the CPU</li>
</ul>
</li>
<li><p>Cache hit: when data to be read is already in cache memory</p>
</li>
<li><p>Cache miss: when data to be read is not in cache memory. When? compulsory, capacity and conflict.</p>
</li>
<li><p>Cache design: cache size, n-way, block size, replacement policy</p>
</li>
</ul>
<h3 id="Caching-in-a-memory-hierarchy"><a href="#Caching-in-a-memory-hierarchy" class="headerlink" title="Caching in a memory hierarchy"></a><strong>Caching in a memory hierarchy</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020124901219.png" alt=""></p>
<h3 id="General-caching-concepts"><a href="#General-caching-concepts" class="headerlink" title="General caching concepts"></a><strong>General caching concepts</strong></h3><ul>
<li>Program needs object d, which is stored in some block b.<ul>
<li><strong>Cache hit</strong><ul>
<li>Program finds b in the cache at level k. E.g., block 14.</li>
</ul>
</li>
<li><strong>Cache miss</strong><ul>
<li>b is not at level k, so level k cache must fetch it from level k+1.       E.g., block 12.</li>
<li>If level k cache is full, then some current block must be replaced (evicted). Which one is the “victim”? <ul>
<li><strong>Placement policy</strong>: where can the new block go? E.g., b mod 4</li>
<li><strong>Replacement policy</strong>: which block should be evicted? E.g., LRU</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Locality"><a href="#Locality" class="headerlink" title="Locality"></a><strong>Locality</strong></h3><ul>
<li><p>Principle of Locality: programs tend to reuse data and instructions near those they have used recently, or that were recently referenced themselves.</p>
<ul>
<li><strong>Temporal locality(时域)</strong>: recently referenced items are likely to be referenced in the near future.</li>
<li><strong>Spatial locality(空间域)</strong>: items with nearby addresses tend to be referenced close together in time.</li>
</ul>
</li>
<li><p>In general, <em>programs with good locality run faster then programs with poor locality</em></p>
</li>
<li><p>Locality is the reason why cache and virtual memory are designed in architecture and operating system. Another example is web browser caches recently visited webpages.</p>
</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c">sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    sum <span class="token operator">+</span><span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> sum<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020125255173.png" style="zoom:67%;">

<ul>
<li>Being able to look at code and get a qualitative sense of its locality is important. Does this function have good locality?</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum_array_rows</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            sum <span class="token operator">+</span><span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>stride-1 reference pattern</strong></p>
<ul>
<li>Does this function have good locality?</li>
</ul>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum_array_cols</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            sum <span class="token operator">+</span><span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>stride-N reference pattern</strong></p>
<h3 id="Blocked-matrix-multiply-performance"><a href="#Blocked-matrix-multiply-performance" class="headerlink" title="Blocked matrix multiply performance"></a><strong>Blocked matrix multiply performance</strong></h3><ul>
<li>Blocking (bijk and bikj) improves performance by a factor of two over unblocked versions (ijk and jik)<ul>
<li>relatively insensitive to array size.</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020125500660.png" alt=""></p>
<h3 id="Cache-conscious-programming"><a href="#Cache-conscious-programming" class="headerlink" title="Cache-conscious programming"></a><strong>Cache-conscious programming</strong></h3><ul>
<li>make sure that memory is cache-aligned</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020125559418.png" alt=""></p>
<ul>
<li>Split data into hot and cold (list example)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020125606031.png" alt=""></p>
<ul>
<li>Use union and bitfields to reduce size and increase locality</li>
</ul>
<h2 id="RISC-v-s-CISC"><a href="#RISC-v-s-CISC" class="headerlink" title="RISC v.s. CISC"></a><strong>RISC v.s. CISC</strong></h2><h3 id="Trade-offs-of-instruction-sets"><a href="#Trade-offs-of-instruction-sets" class="headerlink" title="Trade-offs of instruction sets"></a><strong>Trade-offs of instruction sets</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020125653081.png" alt=""></p>
<ul>
<li><p>Before 1980, the trend is to increase instruction complexity (one-to-one mapping if possible) to bridge the gap. Reduce fetch from memory. Selling point: number of instructions, addressing modes. (CISC)</p>
</li>
<li><p>1980, RISC. Simplify and regularize instructions to introduce advanced architecture for better performance, pipeline, cache, superscalar.</p>
</li>
</ul>
<h3 id="RISC"><a href="#RISC" class="headerlink" title="RISC"></a><strong>RISC</strong></h3><ul>
<li><p>1980, Patternson and Ditzel (Berkeley),RISC</p>
</li>
<li><p>Features</p>
<ul>
<li>Fixed-length instructions</li>
<li>Load-store architecture</li>
<li>Register file</li>
</ul>
</li>
<li><p>Organization</p>
<ul>
<li>Hard-wired logic</li>
<li>Single-cycle instruction</li>
<li>Pipeline</li>
</ul>
</li>
<li><p>Pros: small die size, short development time, high performance</p>
</li>
<li><p>Cons: low code density, not x86 compatible </p>
</li>
</ul>
<h3 id="RISC-Design-Principles"><a href="#RISC-Design-Principles" class="headerlink" title="RISC Design Principles"></a><strong>RISC Design Principles</strong></h3><ul>
<li><p>Simple operations</p>
<ul>
<li>Simple instructions that can execute in one cycle</li>
</ul>
</li>
<li><p>Register-to-register operations</p>
<ul>
<li>Only load and store operations access memory</li>
<li>Rest of the operations on a register-to-register basis</li>
</ul>
</li>
<li><p>Simple addressing modes</p>
<ul>
<li>A few addressing modes (1 or 2)</li>
</ul>
</li>
<li><p>Large number of registers</p>
<ul>
<li>Needed to support register-to-register operations</li>
<li>Minimize the procedure call and return overhead</li>
</ul>
</li>
<li><p>Fixed-length instructions</p>
<ul>
<li>Facilitates efficient instruction execution</li>
</ul>
</li>
<li><p>Simple instruction format</p>
<ul>
<li>Fixed boundaries for various fields <ul>
<li>opcode, source operands,…</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="CISC-and-RISC"><a href="#CISC-and-RISC" class="headerlink" title="CISC and RISC"></a><strong>CISC and RISC</strong></h3><ul>
<li><p>CISC – complex instruction set</p>
<ul>
<li>large instruction set</li>
<li>high-level operations (simpler for compiler?)</li>
<li>requires microcode interpreter (could take a long time)</li>
<li>examples: Intel 80x86 family</li>
</ul>
</li>
<li><p>RISC – reduced instruction set</p>
<ul>
<li>small instruction set</li>
<li>simple, atomic instructions</li>
<li>directly executed by hardware very quickly</li>
<li>easier to incorporate advanced architecture design</li>
<li>examples: ARM (Advanced RISC Machines) and DEC Alpha (now Compaq), PowerPC, MIPS</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th><strong>CISC</strong>  <strong>(Intel 486)</strong></th>
<th><strong>RISC</strong>  <strong>(MIPS</strong> R4000)</th>
</tr>
</thead>
<tbody><tr>
<td>#instructions</td>
<td>235</td>
<td>94</td>
</tr>
<tr>
<td>Addr. modes</td>
<td>11</td>
<td>1</td>
</tr>
<tr>
<td>Inst.  Size (bytes)</td>
<td>1-12</td>
<td>4</td>
</tr>
<tr>
<td>GP  registers</td>
<td>8</td>
<td>32</td>
</tr>
</tbody></table>
<h3 id="Why-RISC"><a href="#Why-RISC" class="headerlink" title="Why RISC?"></a><strong>Why RISC?</strong></h3><ul>
<li><p>Simple instructions are preferred</p>
<ul>
<li>Complex instructions are mostly ignored by compilers<ul>
<li>Due to semantic gap</li>
</ul>
</li>
</ul>
</li>
<li><p>Simple data structures</p>
<ul>
<li>Complex data structures are used relatively infrequently</li>
<li>Better to support a few simple data types efficiently<ul>
<li>Synthesize complex ones</li>
</ul>
</li>
</ul>
</li>
<li><p>Simple addressing modes</p>
<ul>
<li>Complex addressing modes lead to variable length instructions<ul>
<li>Lead to inefficient instruction decoding and scheduling</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Large register set</p>
<ul>
<li><p>Efficient support for procedure calls and returns</p>
<ul>
<li><p>Patterson and Sequin’s study</p>
<ul>
<li><p>Procedure call/return: 12-15% of HLL statements</p>
<p>»Constitute 31-33% of machine language instructions</p>
<p>»Generate nearly half (45%) of memory references</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Small activation record</p>
<ul>
<li>Tanenbaum’s study<ul>
<li>Only 1.25% of the calls have more than 6 arguments</li>
<li>More than 93% have less than 6 local scalar variables</li>
<li>Large register set can avoid memory references </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ISA-design-issues"><a href="#ISA-design-issues" class="headerlink" title="ISA design issues"></a><strong>ISA design issues</strong></h2><p>ISA：Instruction Set Architecture</p>
<h3 id="Instruction-set-design"><a href="#Instruction-set-design" class="headerlink" title="Instruction set design"></a><strong>Instruction set design</strong></h3><ul>
<li>Issues when determining ISA<ul>
<li>Instruction types</li>
<li>Number of addresses</li>
<li>Addressing modes</li>
</ul>
</li>
</ul>
<h4 id="Instruction-types"><a href="#Instruction-types" class="headerlink" title="Instruction types"></a><strong>Instruction types</strong></h4><ul>
<li><p>Arithmetic and logic</p>
</li>
<li><p>Data movement</p>
</li>
<li><p>I/O (memory-mapped, isolated I/O) </p>
</li>
<li><p>Flow control</p>
<ul>
<li>Branches (unconditional, conditional)<ul>
<li>set-then-jump (<strong>cmp</strong> <strong>AX, BX; je target</strong>)</li>
<li>Test-and-jump (<strong>beq</strong> <strong>r1, r2, target</strong>)</li>
</ul>
</li>
<li>Procedure calls (register-based, stack-based)<ul>
<li>Pentium: <strong>ret</strong>; MIPS: <strong>jr</strong></li>
<li>Register: faster but limited number of parameters</li>
<li>Stack: slower but more general</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Operand-types"><a href="#Operand-types" class="headerlink" title="Operand types"></a><strong>Operand types</strong></h4><ul>
<li><p>Instructions support basic data types</p>
<ul>
<li>Characters</li>
<li>Integers</li>
<li>Floating-point</li>
</ul>
</li>
<li><p>Instruction overload</p>
<ul>
<li><p>Same instruction for different data types</p>
</li>
<li><p>Example: Pentium</p>
<p><strong>mov</strong>  <strong>AL,address</strong>  <strong>;loads an 8-bit value</strong></p>
<p><strong>mov</strong>  <strong>AX,address</strong>  <strong>;loads a 16-bit value</strong></p>
<p><strong>mov</strong>  <strong>EAX,address</strong> <strong>;loads a 32-bit value</strong></p>
</li>
</ul>
</li>
<li><p>Separate instructions</p>
<ul>
<li>Instructions specify the operand size</li>
<li>Example: MIPS</li>
</ul>
</li>
</ul>
<pre><code>lb    Rdest,address   ;loads a byte
lh    Rdest,address   ;loads a halfword 
                      ;(16 bits) 
lw    Rdest,address   ;loads a word 
                      ;(32 bits) 
ld    Rdest,address   ;loads a doubleword 
                      ;(64 bits)</code></pre><h2 id="Number-of-addresses"><a href="#Number-of-addresses" class="headerlink" title="Number of addresses"></a><strong>Number of addresses</strong></h2><ul>
<li>Four categories<ul>
<li>3-address machines<ul>
<li>two for the source operands and one for the result</li>
</ul>
</li>
<li>2-address machines<ul>
<li>One address doubles as source and result</li>
</ul>
</li>
<li>1-address machine<ul>
<li>Accumulator machines</li>
<li>Accumulator is used for one source and result</li>
</ul>
</li>
<li>0-address machines<ul>
<li>Stack machines</li>
<li>Operands are taken from the stack</li>
<li>Result goes onto the stack</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Number  of addresses</th>
<th>instruction</th>
<th>operation</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>OP  A, B, C</td>
<td>A ←  B OP C</td>
</tr>
<tr>
<td>2</td>
<td>OP  A, B</td>
<td>A ←  A OP B</td>
</tr>
<tr>
<td>1</td>
<td>OP  A</td>
<td>AC  ← AC OP A</td>
</tr>
<tr>
<td>0</td>
<td>OP</td>
<td>T ←  (T-1) OP T</td>
</tr>
</tbody></table>
<ul>
<li>A, B, C: memory or register locations</li>
<li>AC: accumulator</li>
<li>T: top of stack</li>
<li>T-1: second element of stack</li>
</ul>
<h3 id="3-address"><a href="#3-address" class="headerlink" title="3-address"></a><strong>3-address</strong></h3><p>Example: RISC machines, TOY</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020130901868.png" alt=""></p>
<pre><code>SUB Y, A, B    ; Y = A - B
MUL T, D, E    ; T = D × E
ADD T, T, C    ; T = T + C
DIV Y, Y, T    ; Y = Y / T</code></pre><h3 id="2-address"><a href="#2-address" class="headerlink" title="2-address"></a><strong>2-address</strong></h3><p>Example: IA32</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020130915481.png" alt=""></p>
<pre><code>MOV Y, A        ; Y = A
SUB Y, B        ; Y = Y - B
MOV T, D        ; T = D
MUL T, E        ; T = T × E
ADD T, C        ; T = T + C
DIV Y, T        ; Y = Y / T</code></pre><h3 id="1-address"><a href="#1-address" class="headerlink" title="1-address"></a><strong>1-address</strong></h3><p>Example: IA32’s MUL (EAX)</p>
<pre><code>LD     D        ; AC = D
MUL    E        ; AC = AC × E
ADD    C        ; AC = AC + C
ST    Y        ; Y = AC
LD    A        ; AC = A
SUB    B        ; AC = AC – B
DIV     Y        ; AC = AC / Y
ST    Y        ; Y = AC</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020130946241.png" alt=""></p>
<h3 id="0-address"><a href="#0-address" class="headerlink" title="0-address"></a><strong>0-address</strong></h3><p>Example: IA32’s FPU, HP3000 </p>
<pre><code>PUSH     A        ; A
PUSH B        ; A, B
SUB            ; A-B
PUSH C        ; A-B, C
PUSH    D        ; A-B, C, D
PUSH E        ; A-B, C, D, E
MUL            ; A-B, C, D× E
ADD            ; A-B, C+(D× E)
DIV             ; (A-B) / (C+(D× E))
POP    Y</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131023289.png" alt=""></p>
<ul>
<li><p>A basic design decision; could be mixed</p>
</li>
<li><p>Fewer addresses per instruction results in</p>
<ul>
<li>a less complex processor</li>
<li>shorter instructions</li>
<li>longer and more complex programs</li>
<li>longer execution time</li>
</ul>
</li>
<li><p>The decision has impacts on register usage policy as well</p>
<ul>
<li>3-address usually means more general-purpose registers</li>
<li>1-address usually means less</li>
</ul>
</li>
</ul>
<h2 id="Addressing-modes"><a href="#Addressing-modes" class="headerlink" title="Addressing modes"></a><strong>Addressing modes</strong></h2><ul>
<li><p>How to specify location of operands? Trade-off for address range, address flexibility, number of memory references, calculation of addresses</p>
</li>
<li><p>Operands can be in three places</p>
<ul>
<li>Registers<ul>
<li>Register addressing mode</li>
</ul>
</li>
<li>Part of instruction<ul>
<li>Constant</li>
<li>Immediate addressing mode</li>
<li>All processors support these two addressing modes</li>
</ul>
</li>
<li>Memory<ul>
<li>Difference between RISC and CISC</li>
<li>CISC supports a large variety of addressing modes</li>
<li>RISC follows load/store architecture</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Common addressing modes<ul>
<li>Implied </li>
<li>Immediate (<strong>lda</strong> <strong>R1, 1</strong>)</li>
<li>Direct (<strong>st</strong> <strong>R1, A</strong>)</li>
<li>Indirect</li>
<li>Register (<strong>add R1, R2, R3</strong>)</li>
<li>Register indirect (<strong>sti</strong> <strong>R1, R2</strong>)</li>
<li>Displacement</li>
<li>Stack</li>
</ul>
</li>
</ul>
<h3 id="Implied-addressing"><a href="#Implied-addressing" class="headerlink" title="Implied addressing"></a><strong>Implied addressing</strong></h3><ul>
<li><p>No address field; operand is implied by the instruction </p>
<p><strong>CLC ; clear carry</strong></p>
</li>
<li><p>A fixed and unvarying address</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131303082.png" alt=""></p>
<h3 id="Immediate-addressing"><a href="#Immediate-addressing" class="headerlink" title="Immediate addressing"></a><strong>Immediate addressing</strong></h3><ul>
<li><p>Address field contains the operand value </p>
<p>  <strong>ADD 5; AC=AC+5</strong></p>
</li>
<li><p>Pros: no extra memory reference; faster</p>
</li>
<li><p>Cons: limited range</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131344287.png" alt=""></p>
<h3 id="Direct-addressing"><a href="#Direct-addressing" class="headerlink" title="Direct addressing"></a><strong>Direct addressing</strong></h3><ul>
<li><p>Address field contains the effective address of the operand</p>
<p> <strong>ADD A; AC=AC+[A]</strong></p>
</li>
<li><p>single memory reference</p>
</li>
<li><p>Pros: no additional address calculation</p>
</li>
<li><p>Cons: limited address space</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131416941.png" alt=""></p>
<h3 id="Indirect-addressing"><a href="#Indirect-addressing" class="headerlink" title="Indirect addressing"></a><strong>Indirect addressing</strong></h3><ul>
<li><p>Address field contains the address of a pointer to the operand</p>
<p> <strong>ADD [A]; AC=AC+[[A]]</strong></p>
</li>
<li><p>multiple memory references</p>
</li>
<li><p>Pros: large address space</p>
</li>
<li><p>Cons: slower</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131451386.png" alt=""></p>
<h3 id="Register-addressing"><a href="#Register-addressing" class="headerlink" title="Register addressing"></a><strong>Register addressing</strong></h3><ul>
<li><p>Address field contains the address of a register</p>
<p> <strong>ADD R; AC=AC+R</strong></p>
</li>
<li><p>Pros: only need a small address field; shorter instruction and faster fetch; no memory reference</p>
</li>
<li><p>Cons: limited address space</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131521777.png" alt=""></p>
<h3 id="Register-indirect-addressing"><a href="#Register-indirect-addressing" class="headerlink" title="Register indirect addressing"></a><strong>Register indirect addressing</strong></h3><ul>
<li><p>Address field contains the address of the register containing a pointer to the operand</p>
<p> <strong>ADD [R]; AC=AC+[R]</strong></p>
</li>
<li><p>Pros: large address space</p>
</li>
<li><p>Cons: extra memory reference</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131551038.png" alt=""></p>
<h3 id="Displacement-addressing"><a href="#Displacement-addressing" class="headerlink" title="Displacement addressing"></a><strong>Displacement addressing</strong></h3><ul>
<li><p>Address field could contain a register address and an address</p>
<p> <strong>MOV EAX, [A+ESI*4]</strong></p>
</li>
<li><p>EA=A+[R×S] or vice versa</p>
</li>
<li><p>Several variants</p>
<ul>
<li>Base-offset: <strong>[EBP+8]</strong></li>
<li>Base-index: <strong>[EBX+ESI]</strong></li>
<li>Scaled: <strong>[T+ESI*4]</strong></li>
</ul>
</li>
<li><p>Pros: flexible</p>
</li>
<li><p>Cons: complex</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131635397.png" alt=""></p>
<p>​        <strong>MOV EAX, [A+ESI*4]</strong></p>
<ul>
<li><p>Often, register, called indexing register, is used for displacement.</p>
</li>
<li><p>Usually, a mechanism is provided to efficiently increase the indexing register.</p>
</li>
</ul>
<h3 id="Stack-addressing"><a href="#Stack-addressing" class="headerlink" title="Stack addressing"></a><strong>Stack addressing</strong></h3><ul>
<li><p>Operand is on top of the stack</p>
<p> <strong>ADD [R]; AC=AC+[R]</strong></p>
</li>
<li><p>Pros: large address space</p>
</li>
<li><p>Pros: short and fast fetch</p>
</li>
<li><p>Cons: limited by FILO order</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131745019.png" alt=""></p>
<table>
<thead>
<tr>
<th><strong>Mode</strong></th>
<th><strong>Meaning</strong></th>
<th><strong>Pros</strong></th>
<th><strong>Cons</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Implied</td>
<td></td>
<td>Fast  fetch</td>
<td>Limited  instructions</td>
</tr>
<tr>
<td>Immediate</td>
<td>Operand=A</td>
<td>No  memory ref</td>
<td>Limited  operand</td>
</tr>
<tr>
<td>Direct</td>
<td>EA=A</td>
<td>Simple</td>
<td>Limited  address space</td>
</tr>
<tr>
<td>Indirect</td>
<td>EA=[A]</td>
<td>Large  address space</td>
<td>Multiple  memory ref</td>
</tr>
<tr>
<td>Register</td>
<td>EA=R</td>
<td>No  memory ref</td>
<td>Limited  address space</td>
</tr>
<tr>
<td>Register  indirect</td>
<td>EA=[R]</td>
<td>Large  address space</td>
<td>Extra  memory ref</td>
</tr>
<tr>
<td>Displacement</td>
<td>EA=A+[R]</td>
<td>Flexibility</td>
<td>Complexity</td>
</tr>
<tr>
<td>stack</td>
<td>EA=stack  top</td>
<td>No  memory ref</td>
<td>Limited  applicability</td>
</tr>
</tbody></table>
<h3 id="IA32-addressing-modes"><a href="#IA32-addressing-modes" class="headerlink" title="IA32 addressing modes"></a><strong>IA32 addressing modes</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131815465.png" alt=""></p>
<h3 id="Effective-address-calculation-IA32"><a href="#Effective-address-calculation-IA32" class="headerlink" title="Effective address calculation (IA32)"></a><strong>Effective address calculation (IA32)</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020131843864.png" alt=""></p>
<h3 id="Based-Addressing"><a href="#Based-Addressing" class="headerlink" title="Based Addressing"></a><strong>Based Addressing</strong></h3><ul>
<li><p>Effective address is computed as base + signed displacement</p>
<ul>
<li>Displacement:<ul>
<li>16-bit addresses: 8- or 16-bit number</li>
<li>32-bit addresses: 8- or 32-bit number</li>
</ul>
</li>
</ul>
</li>
<li><p>Useful to access fields of a structure or record</p>
<ul>
<li>Base register -&gt; points to the base address of the structure</li>
<li>Displacement -&gt; relative offset within the structure</li>
</ul>
</li>
<li><p>Useful to access arrays whose element size is not 2, 4, or 8 bytes</p>
<ul>
<li>Displacement -&gt; points to the beginning of the array</li>
<li>Base register -&gt; relative offset of an element within the array</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020132012170.png" alt=""></p>
<h3 id="Indexed-Addressing"><a href="#Indexed-Addressing" class="headerlink" title="Indexed Addressing"></a><strong>Indexed Addressing</strong></h3><ul>
<li><p>Effective address is computed as (index * scale factor) + signed displacement</p>
<ul>
<li>16-bit addresses:<ul>
<li>displacement: 8- or 16-bit number</li>
<li>scale factor: none (i.e., 1)</li>
</ul>
</li>
<li>32-bit addresses:<ul>
<li>displacement: 8- or 32-bit number</li>
<li>scale factor: 2, 4, or 8</li>
</ul>
</li>
</ul>
</li>
<li><p>Useful to access elements of an array (particularly if the element size is 2, 4, or 8 bytes)</p>
<ul>
<li>Displacement  -&gt; points to the beginning of the array</li>
<li>Index register  -&gt; selects an element of the array (array index)</li>
<li>Scaling factor  -&gt; size of the array element</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020132148592.png" alt=""></p>
<h3 id="Based-Indexed-Addressing"><a href="#Based-Indexed-Addressing" class="headerlink" title="Based-Indexed Addressing"></a><strong>Based-Indexed Addressing</strong></h3><p><strong>Based-indexed addressing with no scale factor</strong></p>
<ul>
<li><p>Effective address is computed as    <strong>base + index + signed displacement</strong></p>
</li>
<li><p>Useful in accessing two-dimensional arrays</p>
<ul>
<li>Displacement -&gt; points to the beginning of the array</li>
<li>Base and index registers point to a row and an element within that row</li>
</ul>
</li>
<li><p>Useful in accessing arrays of records</p>
<ul>
<li>Displacement -&gt; represents the offset of a field in a record</li>
<li>Base and index registers hold a pointer to the base of the array and the offset of an element relative to the base of the array</li>
</ul>
</li>
<li><p>Useful in accessing arrays passed on to a procedure</p>
<ul>
<li>Base register -&gt; points to the beginning of the array</li>
<li>Index register -&gt; represents the offset of an element relative to the base of the array </li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<p> Assuming BX points to <strong>table1</strong></p>
<pre><code> **mov AX,[BX+SI]**

 **cmp** **AX,[BX+SI+2]** </code></pre><p> compares two successive elements of <strong>table1</strong></p>
<p><strong>Based-indexed addressing with scale factor</strong></p>
<ul>
<li><p>Effective address is computed as  <strong>base + (index * scale factor) + signed displacement</strong></p>
</li>
<li><p>Useful in accessing two-dimensional arrays when the element size is 2, 4, or 8 bytes</p>
<ul>
<li>Displacement ==&gt; points to the beginning of the array</li>
<li>Base register ==&gt; holds offset to a row (relative to start of array)</li>
<li>Index register ==&gt; selects an element of the row</li>
<li>Scaling factor ==&gt; size of the array element</li>
</ul>
</li>
</ul>
<h1 id="ARM-Architecture"><a href="#ARM-Architecture" class="headerlink" title="ARM Architecture"></a>ARM Architecture</h1><h2 id="ARM-history"><a href="#ARM-history" class="headerlink" title="ARM history"></a><strong>ARM history</strong></h2><ul>
<li><p>1983 developed by Acorn computers</p>
<ul>
<li>To replace 6502 in BBC computers </li>
<li>4-man VLSI design team</li>
<li>Its simplicity comes from the inexperience team</li>
<li>Match the needs for generalized SoC for reasonable power, performance and die size</li>
<li>The first commercial RISC implemenation</li>
</ul>
</li>
<li><p>1990 ARM (Advanced RISC Machine), owned by Acorn, Apple and VLSI</p>
</li>
</ul>
<p>Design and license ARM core design but not fabricate</p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020132525345.png" alt=""></p>
<h2 id="Why-ARM"><a href="#Why-ARM" class="headerlink" title="Why ARM?"></a><strong>Why ARM?</strong></h2><ul>
<li><p>One of the most licensed and thus widespread processor cores in the world</p>
<ul>
<li>Used in PDA, cell phones, multimedia players, handheld game console, digital TV and cameras</li>
<li>ARM7: GBA, iPod</li>
<li>ARM9: NDS, PSP, Sony Ericsson, BenQ</li>
<li>ARM11: Apple iPhone, Nokia N93, N800</li>
<li>90% of 32-bit embedded RISC processors till 2009</li>
</ul>
</li>
<li><p>Used especially in portable devices due to its low power consumption and reasonable performance</p>
</li>
</ul>
<h2 id="ARM-processors"><a href="#ARM-processors" class="headerlink" title="ARM processors"></a><strong>ARM processors</strong></h2><ul>
<li><p>A simple but powerful design</p>
</li>
<li><p>A whole family of designs sharing similar design principles and a common instruction set</p>
</li>
</ul>
<h3 id="Naming-ARM"><a href="#Naming-ARM" class="headerlink" title="Naming ARM"></a><strong>Naming ARM</strong></h3><ul>
<li>ARMxyzTDMIEJFS<ul>
<li>x: series</li>
<li>y: MMU</li>
<li>z: cache</li>
<li>T: Thumb</li>
<li>D: debugger</li>
<li>M: Multiplier</li>
<li>I: EmbeddedICE (built-in debugger hardware)</li>
<li>E: Enhanced instruction</li>
<li>J: Jazelle (JVM)</li>
<li>F: Floating-point</li>
<li>S: Synthesizible version (source code version for EDA tools)</li>
</ul>
</li>
</ul>
<h3 id="Popular-ARM-architectures"><a href="#Popular-ARM-architectures" class="headerlink" title="Popular ARM architectures"></a><strong>Popular ARM architectures</strong></h3><ul>
<li><p>ARM7TDMI</p>
<ul>
<li>3 pipeline stages (fetch/decode/execute)</li>
<li>High code density/low power consumption</li>
<li>One of the most used ARM-version (for low-end systems)</li>
<li>All ARM cores after ARM7TDMI include TDMI even if they do not include TDMI in their labels</li>
</ul>
</li>
<li><p>ARM9TDMI</p>
<ul>
<li>Compatible with ARM7</li>
<li>5 stages (fetch/decode/execute/memory/write)</li>
<li>Separate instruction and data cache</li>
</ul>
</li>
<li><p>ARM11</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020132807608.png" alt=""></p>
<h3 id="ARM-is-a-RISC"><a href="#ARM-is-a-RISC" class="headerlink" title="ARM is a RISC"></a><strong>ARM is a RISC</strong></h3><ul>
<li><p>RISC: simple but powerful instructions that execute within a single cycle at high clock speed.</p>
</li>
<li><p>Four major design rules:</p>
<ul>
<li>Instructions: reduced set/single cycle/fixed length</li>
<li>Pipeline: decode in one stage/no need for microcode</li>
<li>Registers: a large set of general-purpose registers</li>
<li>Load/store architecture: data processing instructions apply to registers only; load/store to transfer data from memory</li>
</ul>
</li>
<li><p>Results in simple design and fast clock rate</p>
</li>
<li><p>The distinction blurs because CISC implements RISC concepts</p>
</li>
</ul>
<h3 id="ARM-design-philosophy-哲学"><a href="#ARM-design-philosophy-哲学" class="headerlink" title="ARM design philosophy(哲学)"></a><strong>ARM design philosophy(哲学)</strong></h3><ul>
<li>Small processor for lower power consumption (for embedded system)</li>
<li>High code density for limited memory and physical size restrictions</li>
<li>The ability to use slow and low-cost memory</li>
<li>Reduced die size for reducing manufacture cost and accommodating more peripherals</li>
</ul>
<h3 id="ARM-features"><a href="#ARM-features" class="headerlink" title="ARM features"></a><strong>ARM features</strong></h3><ul>
<li>Different from pure RISC in several ways:<ul>
<li>Variable cycle execution for certain instructions: multiple-register load/store (faster/higher code density)</li>
<li>Inline barrel shifter leading to more complex instructions: improves performance and code density</li>
<li>Thumb 16-bit instruction set: 30% code density improvement</li>
<li>Conditional execution: improve performance and code density by reducing branch</li>
<li>Enhanced instructions: DSP instructions</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133002604.png" alt=""></p>
<ul>
<li>Load/store architecture</li>
<li>A large array of uniform registers</li>
<li>Fixed-length 32-bit instructions</li>
<li>3-address instructions </li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133028213.png" alt=""></p>
<h2 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a><strong>Registers</strong></h2><ul>
<li>Only 16 registers are visible to a specific mode. A mode could access<ul>
<li>A particular set of r0-r12</li>
<li>r13 (sp, stack pointer)</li>
<li>r14 (lr, link register)</li>
<li>r15 (pc, program counter)</li>
<li>Current program status register (cpsr)</li>
<li>The uses of r0-r13 are orthogonal</li>
</ul>
</li>
</ul>
<h3 id="General-purpose-registers"><a href="#General-purpose-registers" class="headerlink" title="General-purpose registers"></a><strong>General-purpose registers</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133136255.png" alt=""></p>
<ul>
<li>6 data types (signed/unsigned)</li>
<li>All ARM operations are 32-bit. Shorter data types are only supported by data transfer operations.</li>
</ul>
<h3 id="Program-counter"><a href="#Program-counter" class="headerlink" title="Program counter"></a><strong>Program counter</strong></h3><ul>
<li>Store the address of the instruction to be executed</li>
<li>All instructions are 32-bit wide and word-aligned</li>
<li>Thus, the last two bits of pc are undefined.</li>
</ul>
<h3 id="Program-status-register-CPSR"><a href="#Program-status-register-CPSR" class="headerlink" title="Program status register (CPSR)"></a><strong>Program status register (CPSR)</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133223655.png" alt=""></p>
<h3 id="Processor-modes"><a href="#Processor-modes" class="headerlink" title="Processor modes"></a><strong>Processor modes</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133300337.png" alt=""></p>
<h3 id="Register-organization"><a href="#Register-organization" class="headerlink" title="Register organization"></a><strong>Register organization</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133314269.png" alt=""></p>
<h2 id="Instruction-sets"><a href="#Instruction-sets" class="headerlink" title="Instruction sets"></a><strong>Instruction sets</strong></h2><ul>
<li>ARM/Thumb/Jazelle</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133412508.png" alt=""></p>
<h2 id="Pipeline-1"><a href="#Pipeline-1" class="headerlink" title="Pipeline"></a><strong>Pipeline</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133440224.png" alt=""></p>
<ul>
<li>Execution of a branch or direct modification of pc causes ARM core to flush its pipeline</li>
<li>ARM10 starts to use branch prediction</li>
<li>An instruction in the execution stage will complete even though an interrupt has been raised. Other instructions in the pipeline are abondond. </li>
</ul>
<h2 id="Interrupts"><a href="#Interrupts" class="headerlink" title="Interrupts"></a><strong>Interrupts</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133522303.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133531872.png" alt=""></p>
<h1 id="ARM-Instruction-Set"><a href="#ARM-Instruction-Set" class="headerlink" title="ARM Instruction Set"></a>ARM Instruction Set</h1><h2 id="ARM-programmer-model"><a href="#ARM-programmer-model" class="headerlink" title="ARM programmer model"></a><strong>ARM programmer model</strong></h2><ul>
<li>The state of an ARM system is determined by the content of visible registers and memory.</li>
<li>A user-mode program can see 15 32-bit general-purpose registers (R0-R14), program counter (PC) and CPSR.</li>
<li>Instruction set defines the operations that can change the state.</li>
</ul>
<h3 id="Memory-system"><a href="#Memory-system" class="headerlink" title="Memory system"></a><strong>Memory system</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133707488.png" alt=""></p>
<h3 id="Byte-ordering"><a href="#Byte-ordering" class="headerlink" title="Byte ordering"></a><strong>Byte ordering</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133727556.png" alt=""></p>
<h3 id="ARM-programmer-model-1"><a href="#ARM-programmer-model-1" class="headerlink" title="ARM programmer model"></a><strong>ARM programmer model</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133800727.png" alt=""></p>
<h2 id="Instruction-set"><a href="#Instruction-set" class="headerlink" title="Instruction set"></a><strong>Instruction set</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020133838705.png" alt=""></p>
<h3 id="Features-of-ARM-instruction-set"><a href="#Features-of-ARM-instruction-set" class="headerlink" title="Features of ARM instruction set"></a><strong>Features of ARM instruction set</strong></h3><ul>
<li><p>Load-store architecture</p>
</li>
<li><p>3-address instructions</p>
</li>
<li><p>Conditional execution of every instruction</p>
</li>
<li><p>Possible to load/store multiple registers at once</p>
</li>
<li><p>Possible to combine shift and ALU operations in a single instruction</p>
</li>
</ul>
<h3 id="Data-processing"><a href="#Data-processing" class="headerlink" title="Data processing"></a><strong>Data processing</strong></h3><ul>
<li><p>They are move, arithmetic, logical, comparison and multiply instructions.</p>
</li>
<li><p>Most data processing instructions can process one of their operands using the barrel shifter. </p>
</li>
<li><p>General rules:</p>
<ul>
<li>All operands are 32-bit, coming from registers or literals.</li>
<li>The result, if any, is 32-bit and placed in a register (with the exception for long multiply which produces a 64-bit result)</li>
<li>3-address format</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143130971.png" alt=""></p>
<pre><code>MOV&lt;cc&gt;&lt;S&gt;  Rd, &lt;operands&gt;

MOVCS R0, R1 @ if carry is set
             @ then R0:=R1

MOVS  R0, #0 @ R0:=0
             @ Z=1, N=0
             @ C, V unaffected</code></pre><h3 id="Conditional-execution"><a href="#Conditional-execution" class="headerlink" title="Conditional execution"></a><strong>Conditional execution</strong></h3><ul>
<li>Almost all ARM instructions have a condition field which allows it to be executed conditionally.</li>
</ul>
<p>​       <strong>movcs</strong> <strong>R0, R1</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143347846.png" alt=""></p>
<h3 id="Register-movement"><a href="#Register-movement" class="headerlink" title="Register movement"></a><strong>Register movement</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143423045.png" alt=""></p>
<h3 id="Addressing-modes-1"><a href="#Addressing-modes-1" class="headerlink" title="Addressing modes"></a><strong>Addressing modes</strong></h3><ul>
<li><p>Register operands</p>
<p> <strong>ADD R0, R1, R2</strong></p>
</li>
<li><p>Immediate operands</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143616785.png" alt=""></p>
<h3 id="Shifted-register-operands"><a href="#Shifted-register-operands" class="headerlink" title="Shifted register operands"></a><strong>Shifted register operands</strong></h3><ul>
<li>One operand to ALU is routed through the Barrel shifter. Thus, the operand can be modified before it is used. Useful for fast multipliation and dealing with lists, table and other complex data structure. (similar to the displacement addressing mode in CISC.)</li>
<li>Some instructions (e.g. <strong>MUL, CLZ, QADD</strong>) do not read barrel shifter.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143906361.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020143924291.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020144154387.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020144205254.png" alt=""></p>
<ul>
<li>It is possible to use a register to specify the number of bits to be shifted; only the bottom 8 bits of the register are significant.</li>
</ul>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020144424941.png" style="zoom:67%;">

<h3 id="Multiplication"><a href="#Multiplication" class="headerlink" title="Multiplication"></a><strong>Multiplication</strong></h3><pre><code>MOV  R1, #35
 MUL  R2, R0, R1
         or
 ADD  R0, R0, R0, LSL #2  @ R0’=5xR0
 RSB  R2, R0, R0, LSL #3  @ R2 =7xR0’</code></pre><h3 id="Shifted-register-operands-1"><a href="#Shifted-register-operands-1" class="headerlink" title="Shifted register operands"></a><strong>Shifted register operands</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020144833822.png" alt=""></p>
<h3 id="Encoding-data-processing-instructions"><a href="#Encoding-data-processing-instructions" class="headerlink" title="Encoding data processing instructions"></a><strong>Encoding data processing instructions</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020145018620.png" alt=""></p>
<h3 id="Arithmetic"><a href="#Arithmetic" class="headerlink" title="Arithmetic"></a><strong>Arithmetic</strong></h3><ul>
<li>Add and subtraction</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020145828174.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020145858344.png" alt=""></p>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020145945971.png" style="zoom:67%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020150811353.png" style="zoom:67%;">

<h3 id="Setting-the-condition-codes"><a href="#Setting-the-condition-codes" class="headerlink" title="Setting the condition codes"></a><strong>Setting the condition codes</strong></h3><ul>
<li>Any data processing instruction can set the condition codes if the programmers wish it to</li>
</ul>
<p>64-bit addition</p>
<p><strong>ADDS</strong> <strong>R2, R2, R0</strong></p>
<p><strong>ADC  R3, R3, R1</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020151019939.png" alt=""></p>
<h3 id="Logical"><a href="#Logical" class="headerlink" title="Logical"></a><strong>Logical</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020151223703.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020151236922.png" alt=""></p>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020151723203.png" style="zoom:67%;">

<h3 id="Comparison"><a href="#Comparison" class="headerlink" title="Comparison"></a><strong>Comparison</strong></h3><ul>
<li>These instructions do not generate a result, but set condition code bits (N, Z, C, V) in CPSR. Often, a branch operation follows to change the program flow.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020153047493.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020153218646.png" alt=""></p>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020153459028.png" style="zoom:67%;">

<h3 id="Multiplication-1"><a href="#Multiplication-1" class="headerlink" title="Multiplication"></a><strong>Multiplication</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020153745768.png" alt=""></p>
<ul>
<li><p>MUL R0, R1, R2  @ R0 = (R1xR2)[31:0]</p>
</li>
<li><p>Features:</p>
<ul>
<li>Second operand can’t be immediate</li>
<li>The result register must be different from the first operand</li>
<li>Cycles depends on core type</li>
<li>If S bit is set, C flag is meaningless </li>
</ul>
</li>
<li><p>See the reference manual</p>
</li>
</ul>
<ul>
<li><p>Multiply-accumulate (2D array indexing)</p>
<p> <strong>MLA R4, R3, R2, R1 @ R4 = R3xR2+R1</strong></p>
</li>
<li><p>Multiply with a constant can often be more efficiently implemented using shifted register operand </p>
<p> <strong>MOV R1, #35</strong></p>
<p> <strong>MUL R2, R0, R1</strong></p>
</li>
</ul>
<p>​     or</p>
<p>​     <strong>ADD R0, R0, R0, LSL #2 @ R0’=5xR0</strong></p>
<pre><code> **RSB R2, R0, R0, LSL #3 @ R2 =7xR0’**</code></pre><img src="/images/loading.gif" data-original="../images/basic/image-20211020160155242.png" style="zoom:67%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020160430329.png" style="zoom:67%;">

<h3 id="Flow-control-instructions"><a href="#Flow-control-instructions" class="headerlink" title="Flow control instructions"></a><strong>Flow control instructions</strong></h3><ul>
<li>Determine the instruction to be executed next</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020160732890.png" alt=""></p>
<ul>
<li>Branch instruction</li>
</ul>
<pre><code>B  label    
            …
label:    …</code></pre><ul>
<li>Conditional branches</li>
</ul>
<pre><code>MOV  R0, #0    
loop:        …
            ADD  R0, R0, #1
            CMP  R0, #10
            BNE  loop</code></pre><h3 id="Branch-conditions"><a href="#Branch-conditions" class="headerlink" title="Branch conditions"></a><strong>Branch conditions</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020161140852.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020161406673.png" alt=""></p>
<h3 id="Branch-and-link"><a href="#Branch-and-link" class="headerlink" title="Branch and link"></a><strong>Branch and link</strong></h3><ul>
<li><strong>BL</strong> instruction saves the return address to <strong>R14</strong> (lr)</li>
</ul>
<pre><code>        BL    sub     @ call sub
          CMP   R1, #5  @ return to here
          MOVEQ R1, #0
          …
sub:    …            @ sub entry point
        …
        MOV   PC, LR    @ return 
</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020161644414.png" alt=""></p>
<h3 id="Conditional-execution-1"><a href="#Conditional-execution-1" class="headerlink" title="Conditional execution"></a><strong>Conditional execution</strong></h3><pre><code>CMP  R0, #5    
            BEQ  bypass     @ if (R0!=5) {
            ADD  R1, R1, R0 @  R1=R1+R0-R2 
            SUB  R1, R1, R2 @ }
bypass:    …
----------------------------------------------------
            CMP   R0, #5
            ADDNE R1, R1, R0
            SUBNE R1, R1, R2    //smaller and faster
</code></pre><p>Rule of thumb: if the conditional sequence is three instructions or less, it is better to use conditional execution than a branch.</p>
<pre><code>if ((R0==R1) &amp;&amp; (R2==R3)) R4++
-----------------------------------------------------
          CMP   R0, R1
          BNE   skip
          CMP   R2, R3
          BNE   skip
          ADD   R4, R4, #1
skip:    …  
-----------------------------------------------------
          CMP   R0, R1
          CMPEQ R2, R3
          ADDEQ R4, R4, #1</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020162827431.png" alt=""></p>
<h3 id="Data-transfer-instructions"><a href="#Data-transfer-instructions" class="headerlink" title="Data transfer instructions"></a><strong>Data transfer instructions</strong></h3><ul>
<li><p>Move data between registers and memory</p>
</li>
<li><p>Three basic forms</p>
<ul>
<li>Single register load/store</li>
<li>Multiple register load/store</li>
<li>Single register swap: <strong>SWP(B),</strong> atomic instruction for semaphore</li>
</ul>
</li>
</ul>
<h4 id="Single-register-load-store"><a href="#Single-register-load-store" class="headerlink" title="Single register load/store"></a><strong>Single register load/store</strong></h4><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020162940247.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020163139453.png" alt=""></p>
<p>No <strong>STRSB/STRSH</strong> since <strong>STRB/STRH</strong> stores both </p>
<p>signed/unsigned ones</p>
<ul>
<li>The data items can be a 8-bit byte, 16-bit half-word or 32-bit word. Addresses must be boundary aligned. (e.g. 4’s multiple for <strong>LDR/STR</strong>)</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020163249750.png" alt=""></p>
<h4 id="Addressing-modes-2"><a href="#Addressing-modes-2" class="headerlink" title="Addressing modes"></a><strong>Addressing modes</strong></h4><ul>
<li><p>Memory is addressed by a register and an offset.</p>
<p>  <strong>LDR R0, [R1] @ mem[R1]</strong></p>
</li>
<li><p>Three ways to specify offsets:</p>
<ul>
<li><p>Immediate</p>
<p><strong>LDR R0, [R1, #4] @ mem[R1+4]</strong></p>
</li>
<li><p>Register</p>
<p><strong>LDR R0, [R1, R2] @ mem[R1+R2]</strong></p>
</li>
<li><p>Scaled register         <strong>@ mem[R1+4*R2]</strong></p>
<p><strong>LDR R0, [R1, R2, LSL #2]</strong></p>
</li>
</ul>
</li>
<li><p>Pre-index addressing (<strong>LDR R0,</strong> <strong>[R1, #4]</strong>) without a writeback</p>
</li>
<li><p>Auto-indexing addressing (<strong>LDR R0,</strong> <strong>[R1, #4]!</strong>) </p>
<p>Pre-index with writeback</p>
<p>calculation before accessing with a writeback </p>
</li>
<li><p>Post-index addressing (<strong>LDR R0,</strong> <strong>[R1], #4</strong>)</p>
<p>calculation after accessing with a writeback </p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020164023854.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020164358704.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020164945641.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020165121518.png" alt=""></p>
<h4 id="Comparisons"><a href="#Comparisons" class="headerlink" title="Comparisons"></a><strong>Comparisons</strong></h4><ul>
<li>Pre-indexed addressing</li>
</ul>
<p><strong>LDR R0,</strong> <strong>[R1, R2]</strong> <strong>@ R0=mem[R1+R2]</strong></p>
<p>​          <strong>@ R1 unchanged</strong></p>
<ul>
<li>Auto-indexing addressing</li>
</ul>
<p><strong>LDR R0,</strong> <strong>[R1, R2]!</strong> <strong>@ R0=mem[R1+R2]</strong></p>
<p>​          <strong>@ R1=R1+R2</strong></p>
<ul>
<li>Post-indexed addressing</li>
</ul>
<p><strong>LDR R0,</strong> <strong>[R1], R2</strong> <strong>@ R0=mem[R1]</strong></p>
<p>​          <strong>@ R1=R1+R2</strong></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020175558968.png" alt=""></p>
<h4 id="Summary-of-addressing-modes"><a href="#Summary-of-addressing-modes" class="headerlink" title="Summary of addressing modes"></a><strong>Summary of addressing modes</strong></h4><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020175723165.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020175907480.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020180738552.png" alt=""></p>
<h4 id="Load-an-address-into-a-register"><a href="#Load-an-address-into-a-register" class="headerlink" title="Load an address into a register"></a><strong>Load an address into a register</strong></h4><ul>
<li>Note that all addressing modes are register-offseted. Can we issue <strong>LDR R0, Table</strong>? The pseudo instruction <strong>ADR</strong> loads a register with an address </li>
</ul>
<pre><code>table:     .word    10
…
            ADR  R0, table</code></pre><ul>
<li><p>Assembler transfer pseudo instruction into a sequence of appropriate instructions </p>
<p> <strong>sub r0, pc, #12</strong></p>
</li>
</ul>
<h4 id="Application"><a href="#Application" class="headerlink" title="Application"></a><strong>Application</strong></h4><pre><code>            ADR R1, table
loop:     LDR R0, [R1]
            ADD R1, R1, #4
            @ operations on R0
            …
--------------------------------------------
            ADR R1, table
loop:     LDR R0, [R1], #4

            @ operations on R0
            …</code></pre><h4 id="Multiple-register-load-store"><a href="#Multiple-register-load-store" class="headerlink" title="Multiple register load/store"></a><strong>Multiple register load/store</strong></h4><ul>
<li><p>Transfer a block of data more efficiently.</p>
</li>
<li><p>Used for procedure entry and exit for saving and restoring workspace registers and the return address</p>
</li>
<li><p>For ARM7, <em>2+Nt</em> cycles (<em>N</em>:#words, <em>t</em>:time for a word for sequential access). Increase interrupt latency since it can’t be interrupted.</p>
</li>
<li><p>registers are arranged an in increasing order; see manual</p>
</li>
</ul>
<pre><code>LDMIA  R1, {R0, R2, R5} @ R0 = mem[R1]
                         @ R2 = mem[r1+4]
                         @ R5 = mem[r1+8]</code></pre><ul>
<li><p><strong>LDM  load multiple registers</strong></p>
</li>
<li><p><strong>STM  store multiple registers</strong></p>
</li>
</ul>
<p><strong>suffix   meaning</strong></p>
<ul>
<li><p><strong>IA  increase after</strong></p>
</li>
<li><p><strong>IB  increase before</strong></p>
</li>
<li><p><strong>DA  decrease after</strong></p>
</li>
<li><p><strong>DB  decrease before</strong></p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020182521982.png" alt=""></p>
<pre><code>LDM&lt;mode&gt; Rn, {&lt;registers&gt;}
IA: addr:=Rn    //1
IB: addr:=Rn+4    //2
DA: addr:=Rn-#&lt;registers&gt;*4+4    //3
DB: addr:=Rn-#&lt;registers&gt;*4        //4
For each Ri in &lt;registers&gt; 
  IB: addr:=addr+4
  DB: addr:=addr-4
  Ri:=M[addr]
  IA: addr:=addr+4
  DA: addr:=addr-4
&lt;!&gt;: Rn:=addr</code></pre><img src="/images/loading.gif" data-original="../images/basic/image-20211020183221150.png" alt="1" style="zoom: 67%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020183742746.png" alt="2" style="zoom:67%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020183853698.png" alt="3" style="zoom:67%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020183920576.png" alt="4" style="zoom:67%;">

<pre><code>LDMIA R0, {R1,R2,R3}
  or
LDMIA R0, {R1-R3}


R1: 10
R2: 20
R3: 30
R0: 0x10</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020184030634.png" alt=""></p>
<pre><code>LDMIA R0!, {R1,R2,R3}

R1: 10
R2: 20
R3: 30
R0: 0x01C</code></pre><pre><code>LDMIB R0!, {R1,R2,R3}

R1: 20
R2: 30
R3: 40
R0: 0x01C</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020184714632.png" alt=""></p>
<pre><code>LDMDA R0!, {R1,R2,R3}

R1: 40
R2: 50
R3: 60
R0: 0x018</code></pre><pre><code>LDMDB R0!, {R1,R2,R3}

R1: 30
R2: 40
R3: 50
R0: 0x018</code></pre><img src="/images/loading.gif" data-original="../images/basic/image-20211020184805755.png" style="zoom:67%;">

<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020184938531.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020185014382.png" alt=""></p>
<ul>
<li>Copy a block of memory<ul>
<li>R9: address of the source</li>
<li>R10: address of the destination</li>
<li>R11: end address of the source</li>
</ul>
</li>
</ul>
<pre><code>loop: LDMIA R9!, {R0-R7}
         STMIA R10!, {R0-R7}
         CMP   R9, R11    
          BNE   loop</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020185108235.png" alt=""></p>
<ul>
<li>Stack (full: pointing to the last used; ascending: grow towards increasing memory addresses)</li>
</ul>
<table>
<thead>
<tr>
<th>mode</th>
<th><strong>POP</strong></th>
<th><strong>=LDM</strong></th>
<th><strong>PUSH</strong></th>
<th><strong>=STM</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Full  ascending (<strong>FA</strong>)</td>
<td><strong>LDMFA</strong></td>
<td><strong>LDMDA</strong></td>
<td><strong>STMFA</strong></td>
<td><strong>STMIB</strong></td>
</tr>
<tr>
<td>Full descending (<strong>FD</strong>)</td>
<td><strong>LDMFD</strong></td>
<td><strong>LDMIA</strong></td>
<td><strong>STMFD</strong></td>
<td><strong>STMDB</strong></td>
</tr>
<tr>
<td>Empty  ascending (<strong>EA</strong>)</td>
<td><strong>LDMEA</strong></td>
<td><strong>LDMDB</strong></td>
<td><strong>STMEA</strong></td>
<td><strong>STMIA</strong></td>
</tr>
<tr>
<td>Empty  descending (<strong>ED</strong>)</td>
<td><strong>LDMED</strong></td>
<td><strong>LDMIB</strong></td>
<td><strong>STMED</strong></td>
<td><strong>STMDA</strong></td>
</tr>
</tbody></table>
<pre><code>STMFD R13!, {R2-R9} @ used for ATPCS
… @ modify R2-R9
LDMFD R13!, {R2-R9}</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020185147208.png" alt=""></p>
<h3 id="Swap-instruction"><a href="#Swap-instruction" class="headerlink" title="Swap instruction"></a><strong>Swap instruction</strong></h3><ul>
<li>Swap between memory and register. Atomic operation preventing any other instruction from reading/writing to that location until it completes</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020185321016.png" alt=""></p>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020185350512.png" style="zoom:67%;">

<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020185410201.png" alt=""></p>
<h3 id="Software-interrupt"><a href="#Software-interrupt" class="headerlink" title="Software interrupt"></a><strong>Software interrupt</strong></h3><ul>
<li>A software interrupt instruction causes a software interrupt exception, which provides a mechanism for applications to call OS routines.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020191502847.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020192007849.png" alt=""></p>
<h3 id="Load-constants"><a href="#Load-constants" class="headerlink" title="Load constants"></a><strong>Load constants</strong></h3><ul>
<li>No ARM instruction loads a 32-bit constant into a register because ARM instructions are 32-bit long. There is a pseudo code for this.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020193452131.png" alt=""></p>
<h3 id="Immediate-numbers"><a href="#Immediate-numbers" class="headerlink" title="Immediate numbers"></a><strong>Immediate numbers</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020193520484.png" alt=""></p>
<ul>
<li>Assemblers implement this usually with two options depending on the number you try to load.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020193622856.png" alt=""></p>
<ul>
<li><p>Assume that you want to load 511 into R0</p>
<ul>
<li><p>Construct in multiple instructions</p>
<p><strong>mov r0, #256</strong></p>
<p><strong>add r0, #255</strong></p>
</li>
<li><p>Load from memory; declare <strong>L511 .word 511</strong></p>
<p><strong>ldr</strong> <strong>r0, L511</strong>  <strong>ldr</strong> <strong>r0, [pc, #0]</strong></p>
</li>
</ul>
</li>
<li><p>Guideline: if you can construct it in two instructions, do it; otherwise, load it.</p>
</li>
<li><p>The assembler decides for you </p>
<p>  <strong>ldr</strong> <strong>r0, =255   mov r0, 255</strong></p>
<p>  <strong>ldr</strong> <strong>r0, =511</strong>   <strong>ldr</strong> <strong>r0, [pc, #4]</strong></p>
</li>
</ul>
<h3 id="PC-relative-modes"><a href="#PC-relative-modes" class="headerlink" title="PC-relative modes"></a><strong>PC-relative modes</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020194048493.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020194114250.png" alt=""></p>
<h3 id="Instruction-set-1"><a href="#Instruction-set-1" class="headerlink" title="Instruction set"></a><strong>Instruction set</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020194153460.png" alt=""></p>
<h1 id="ARM-Assembly-Programming"><a href="#ARM-Assembly-Programming" class="headerlink" title="ARM Assembly Programming"></a>ARM Assembly Programming</h1><h2 id="GNU-compiler-and-binutils"><a href="#GNU-compiler-and-binutils" class="headerlink" title="GNU compiler and binutils"></a>GNU compiler and binutils</h2><ul>
<li><p>GNU compiler and binutils </p>
</li>
<li><p>gcc: GNU C compiler</p>
</li>
<li><p>as: GNU assembler</p>
</li>
<li><p>ld: GNU linker</p>
</li>
<li><p>gdb: GNU project debugger</p>
</li>
<li><p>insight: a (Tcl/Tk) graphic interface to gdb </p>
</li>
</ul>
<h2 id="Pipeline-2"><a href="#Pipeline-2" class="headerlink" title="Pipeline"></a><strong>Pipeline</strong></h2><ul>
<li><p>COFF (common object file format)</p>
</li>
<li><p>ELF (extended linker format)</p>
</li>
<li><p>Segments in the object file</p>
<ul>
<li>Text: code</li>
<li>Data: initialized global variables</li>
<li>BSS: uninitialized global variables</li>
</ul>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020195333050.png" alt=""></p>
<h2 id="GAS-program-format"><a href="#GAS-program-format" class="headerlink" title="GAS program format"></a><strong>GAS program format</strong></h2><pre><code>            .file “test.s”
            .text
            .global main
            .type main, %function
main:
            MOV R0, #100
            ADD R0, R0, R0
            SWI #11
            .end</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020195557523.png" alt=""></p>
<h2 id="ARM-assembly-program"><a href="#ARM-assembly-program" class="headerlink" title="ARM assembly program"></a><strong>ARM assembly program</strong></h2><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020195746550.png" alt=""></p>
<h2 id="Control-structures"><a href="#Control-structures" class="headerlink" title="Control structures"></a><strong>Control structures</strong></h2><ul>
<li><p>Program is to implement algorithms to solve problems. Program decomposition and flow of control are important concepts to express algorithms.</p>
</li>
<li><p>Flow of control:</p>
<ul>
<li>Sequence.</li>
<li>Decision: if-then-else, switch</li>
<li>Iteration: repeat-until, do-while, for</li>
</ul>
</li>
<li><p>Decomposition: split a problem into several smaller and manageable ones and solve them independently. (subroutines/functions/procedures)</p>
</li>
</ul>
<h2 id="Decision"><a href="#Decision" class="headerlink" title="Decision"></a><strong>Decision</strong></h2><h3 id="If-statements"><a href="#If-statements" class="headerlink" title="If statements"></a><strong>If statements</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020200133590.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020200225381.png" alt=""></p>
<pre><code>if (R1==1 || R1==5 || R1==12) R0=1;

TEQ   R1, #1        ...
TEQNE R1, #5        ...
TEQNE R1, #12        ...
MOVEQ R0, #1        BNE fail</code></pre><pre><code>if (R1==0) zero
else if (R1&gt;0) plus
else if (R1&lt;0) neg

      CMP   R1, #0        
      BMI   neg
      BEQ   zero
      BPL   plus
neg:  ...
      B exit
Zero: ...
      B exit
      ...</code></pre><pre><code>R0=abs(R0)

CMP    R0, #0
RSBMI  R0, R0, #0</code></pre><h3 id="Multi-way-branches"><a href="#Multi-way-branches" class="headerlink" title="Multi-way branches"></a><strong>Multi-way branches</strong></h3><pre><code>CMP R0, #`0’
        BCC other    @ less than ‘0’
        CMP R0, #`9’
        BLS digit   @ between ‘0’ and ‘9’
        ------------------------------------
        CMP R0, #`A’
        BCC other
        CMP R0, #`Z’
        BLS letter  @ between ‘A’ and ‘Z’
        ------------------------------------
        CMP R0, #`a’
        BCC other
        CMP R0, #`z’
        BHI other  @ not between ‘a’ and ‘z’  
        ------------------------------------
letter: ... </code></pre><h3 id="Switch-statements"><a href="#Switch-statements" class="headerlink" title="Switch statements"></a><strong>Switch statements</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201438471.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201454894.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201509820.png" alt=""></p>
<h2 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a><strong>Iteration</strong></h2><h3 id="repeat-loops"><a href="#repeat-loops" class="headerlink" title="repeat loops"></a><strong>repeat loops</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201720273.png" alt=""></p>
<h3 id="while-loops"><a href="#while-loops" class="headerlink" title="while loops"></a><strong>while loops</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201743788.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201842118.png" alt=""></p>
<h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a><strong>GCD</strong></h3><pre><code>int gcd (int i, int j)
{
    while (i!=j)
    {
      if (i&gt;j)
        i -= j;
      else
        j -= i;
    }
}</code></pre><pre><code>Loop:  CMP   R1, R2
       SUBGT R1, R1, R2
       SUBLT R2, R2, R1
       BNE   loop</code></pre><h3 id="for-loops"><a href="#for-loops" class="headerlink" title="for loops"></a><strong>for loops</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020201944797.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202006017.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202037000.png" alt=""></p>
<h2 id="Procedures"><a href="#Procedures" class="headerlink" title="Procedures"></a><strong>Procedures</strong></h2><ul>
<li><p>Arguments: expressions passed into a function</p>
</li>
<li><p>Parameters: values received by the function</p>
</li>
<li><p>Caller and callee</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202153179.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202206143.png" alt=""></p>
<ul>
<li>How to pass arguments? By registers? By stack? By memory? In what order?</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202345795.png" alt=""></p>
<ul>
<li>Who should save R5? Caller? Callee?</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020202414680.png" alt=""></p>
<ul>
<li>We need a protocol for these. </li>
</ul>
<h3 id="ARM-Procedure-Call-Standard-APCS"><a href="#ARM-Procedure-Call-Standard-APCS" class="headerlink" title="ARM Procedure Call Standard (APCS)"></a><strong>ARM Procedure Call Standard (APCS)</strong></h3><ul>
<li><p>ARM Ltd. defines a set of rules for procedure entry and exit so that </p>
<ul>
<li>Object codes generated by different compilers can be linked together</li>
<li>Procedures can be called between high-level languages and assembly </li>
</ul>
</li>
<li><p>APCS defines</p>
<ul>
<li>Use of registers</li>
<li>Use of stack</li>
<li>Format of stack-based data structure</li>
<li>Mechanism for argument passing </li>
</ul>
</li>
</ul>
<h3 id="APCS-register-usage-convention"><a href="#APCS-register-usage-convention" class="headerlink" title="APCS register usage convention"></a><strong>APCS register usage convention</strong></h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020203556082.png" alt=""></p>
<ul>
<li><p>0-4:</p>
<ul>
<li><p>Used to pass the first 4 parameters</p>
</li>
<li><p>Caller-saved if necessary</p>
</li>
</ul>
</li>
<li><p>4-11:</p>
<ul>
<li><p>Register variables, must return unchanged</p>
</li>
<li><p>Callee-saved</p>
</li>
</ul>
</li>
<li><p>9-15</p>
<ul>
<li>Registers for special purposes</li>
<li>Could be used as temporary variables if saved properly.</li>
</ul>
</li>
</ul>
<h3 id="Argument-passing"><a href="#Argument-passing" class="headerlink" title="Argument passing"></a><strong>Argument passing</strong></h3><ul>
<li><p>The first four word arguments are passed through R0 to R3.</p>
</li>
<li><p>Remaining parameters are pushed into stack in the reverse order.</p>
</li>
<li><p>Procedures with less than four parameters are more effective.</p>
</li>
</ul>
<h3 id="Return-value"><a href="#Return-value" class="headerlink" title="Return value"></a><strong>Return value</strong></h3><ul>
<li><p>One word value in R0</p>
</li>
<li><p>A value of length 2~4 words (R0-R1, R0-R2, R0-R3)</p>
</li>
</ul>
<h3 id="Function-entry-exit"><a href="#Function-entry-exit" class="headerlink" title="Function entry/exit"></a><strong>Function entry/exit</strong></h3><ul>
<li>A simple leaf function with less than four parameters has the minimal overhead. 50% of calls are to leaf functions</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020204244934.png" alt=""></p>
<ul>
<li>Save a minimal set of temporary variables</li>
</ul>
<pre><code>BL leaf2
       ...

leaf2: STMFD sp!, {regs, lr} @ save
       ...
       LDMFD sp!, {regs, pc} @ restore and
                               @ return</code></pre><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020204553224.png" alt=""></p>
<h3 id="Accessing-operands"><a href="#Accessing-operands" class="headerlink" title="Accessing operands"></a><strong>Accessing operands</strong></h3><ul>
<li>A procedure often accesses operands in the following ways<ul>
<li>An argument passed on a register: no further work</li>
<li>An argument passed on the stack: use stack pointer (R13) relative addressing with an immediate offset known at compiling time</li>
<li>A constant: PC-relative addressing, offset known at compiling time</li>
<li>A local variable: allocate on the stack and access through stack pointer relative addressing</li>
<li>A global variable: allocated in the static area and can be accessed by the static base relative (R9) addressing</li>
</ul>
</li>
</ul>
<pre><code>main:
        LDR   R0, #0
        ...
        BL    func
        ...</code></pre><pre><code>func:   STMFD SP!, {R4-R6, LR}
        SUB   SP, SP, #0xC
        ...
        STR   R0, [SP, #0] @ v1=a1

        ...
        ADD   SP, SP, #0xC
        LDMFD SP!, {R4-R6, PC}</code></pre><img src="/images/loading.gif" data-original="../images/basic/image-20211020204850149.png" style="zoom:67%;">

<h1 id="Optimizing-ARM-Assembly"><a href="#Optimizing-ARM-Assembly" class="headerlink" title="Optimizing ARM Assembly"></a>Optimizing ARM Assembly</h1><h2 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a><strong>Optimization</strong></h2><ul>
<li><p>Compilers do perform optimization, but they have blind sites. There are some optimization tools that you can’t explicitly use by writing C, for example.</p>
<ul>
<li>Instruction scheduling </li>
<li>Register allocation </li>
<li>Conditional execution</li>
</ul>
<p>You have to use hand-written assembly to optimize critical routines.</p>
</li>
<li><p>Use ARM9TDMI as the example, but the rules apply to all ARM cores. </p>
</li>
<li><p>Note that the codes are sometimes in <em>armasm</em> format, not <em>gas</em>.</p>
</li>
</ul>
<h2 id="ARM-optimization"><a href="#ARM-optimization" class="headerlink" title="ARM optimization"></a><strong>ARM optimization</strong></h2><ul>
<li>Utilize ARM ISA’s features<ul>
<li>Conditional execution</li>
<li>Multiple register load/store</li>
<li>Scaled register operand</li>
<li>Addressing modes</li>
</ul>
</li>
</ul>
<h2 id="Instruction-scheduling"><a href="#Instruction-scheduling" class="headerlink" title="Instruction scheduling"></a><strong>Instruction scheduling</strong></h2><ul>
<li>ARM9 pipeline</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020210832052.png" alt=""></p>
<ul>
<li><p>Hazard/Interlock: If the required data is the unavailable result from the previous instruction, then the process stalls. </p>
</li>
<li><p>No hazard, 2 cycles</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020210903827.png" alt=""></p>
<ul>
<li>One-cycle interlock</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020210917393.png" alt=""></p>
<ul>
<li>One-cycle interlock, 4 cycles</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020210956480.png" alt=""></p>
<ul>
<li>Brach takes 3 cycles due to stalls</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211013899.png" alt=""></p>
<h3 id="Scheduling-of-load-instructions"><a href="#Scheduling-of-load-instructions" class="headerlink" title="Scheduling of load instructions"></a><strong>Scheduling of load instructions</strong></h3><ul>
<li>Load occurs frequently in the compiled code, taking approximately 1/3 of all instructions. Careful scheduling of loads can avoid stalls.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211045144.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211120606.png" alt=""></p>
<ul>
<li>2-cycle stall. Total 11 cycles for a character. </li>
<li>It can be avoided by preloading and unrolling.</li>
<li>The key is to do some work when awaiting data</li>
</ul>
<h3 id="Load-scheduling-by-preloading"><a href="#Load-scheduling-by-preloading" class="headerlink" title="Load scheduling by preloading"></a><strong>Load scheduling by preloading</strong></h3><ul>
<li><p>Preloading: loads the data required for the loop at the end of the previous loop, rather than at the beginning of the current loop.</p>
</li>
<li><p>Since loop i is loading data for loop i+1, there is always a problem with the first and last loops. For the first loop, insert an extra load outside the loop. For the last loop, be careful not to read any data. This can be effectively done by conditional execution. </p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211329723.png" alt=""></p>
<h3 id="Load-scheduling-by-unrolling"><a href="#Load-scheduling-by-unrolling" class="headerlink" title="Load scheduling by unrolling"></a><strong>Load scheduling by unrolling</strong></h3><ul>
<li>Unroll and interleave the body of the loop. For example, we can perform three loops together. When the result of an operation from loop i is not ready, we can perform an operation from loop i+1 that avoids waiting for the loop i result.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211414709.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211517364.png" alt=""></p>
<h2 id="Register-allocation"><a href="#Register-allocation" class="headerlink" title="Register allocation"></a><strong>Register allocation</strong></h2><ul>
<li>APCS requires callee to save R4~R11 and to keep the stack 8-byte aligned.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211701929.png" alt=""></p>
<ul>
<li>We stack R12 only for making the stack 8-byte aligned. </li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211721414.png" alt=""></p>
<ul>
<li>Unroll the loop to handle 8 words at a time and to use multiple load/store</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020211910907.png" alt=""></p>
<ul>
<li>What variables do we have?</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213003479.png" alt=""></p>
<ul>
<li><p>We still need to assign <strong>carry</strong> and <strong>kr</strong>, but we have used 13 registers and only one remains.</p>
<ul>
<li>Work on 4 words instead</li>
<li>Use stack to save least-used variable, here N</li>
<li>Alter the code</li>
</ul>
</li>
<li><p>We notice that <strong>carry</strong> does not need to stay in the same register. Thus, we can use yi for it.</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213418308.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213427930.png" alt=""></p>
<h2 id="More-than-14-local-variables"><a href="#More-than-14-local-variables" class="headerlink" title="More than 14 local variables"></a><strong>More than 14 local variables</strong></h2><ul>
<li><p>If you need more than 14 local variables, then you store some on the stack.</p>
</li>
<li><p>Work outwards from the inner loops since they have more performance impact.</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213525016.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213534277.png" alt=""></p>
<h2 id="Packing"><a href="#Packing" class="headerlink" title="Packing"></a><strong>Packing</strong></h2><ul>
<li>Pack multiple (sub-32bit) variables into a single register.</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213601169.png" alt=""></p>
<ul>
<li><p>When shifting by a register amount, ARM uses bits 0~7 and ignores others.</p>
</li>
<li><p>Shift an array of 40 entries by shift bits.</p>
</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213630658.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213639404.png" alt=""></p>
<ul>
<li><p>Simulate SIMD (single instruction multiple data).</p>
</li>
<li><p>Assume that we want to merge two images X and Y to produce Z by</p>
</li>
</ul>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020213703254.png" style="zoom:50%;">

<ul>
<li>Load 4 bytes at a time</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213843280.png" alt=""></p>
<ul>
<li>Unpack it and promote to 16-bit data</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213850838.png" alt=""></p>
<ul>
<li>Work on 176x144 images</li>
</ul>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213857951.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213904195.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020213910091.png" alt=""></p>
<h2 id="Conditional-execution-2"><a href="#Conditional-execution-2" class="headerlink" title="Conditional execution"></a><strong>Conditional execution</strong></h2><ul>
<li><p>By combining conditional execution and conditional setting of the flags, you can implement simple if statements without any need of branches. </p>
</li>
<li><p>This improves efficiency since branches can take many cycles and also reduces code size.</p>
</li>
</ul>
<img src="/images/loading.gif" data-original="../images/basic/image-20211020213937611.png" style="zoom:50%;">

<img src="/images/loading.gif" data-original="../images/basic/image-20211020214042578.png" style="zoom:50%;">

<h2 id="Block-copy-example"><a href="#Block-copy-example" class="headerlink" title="Block copy example"></a><strong>Block copy example</strong></h2><pre><code>void bcopy(char *to, char *from, int n)
{
  while (n--)
    *to++ = *from++;
}</code></pre><pre><code>@ arguments: R0: to, R1: from, R2: n
bcopy:  TEQ  R2, #0
        BEQ  end
loop:   SUB  R2, R2, #1
        LDRB R3, [R1], #1
        STRB R3, [R0], #1
        B    bcopy
end:    MOV  PC, LR</code></pre><pre><code>@ arguments: R0: to, R1: from, R2: n
@ rewrite “n–-” as “-–n&gt;=0”
bcopy:  SUBS   R2, R2, #1
        LDRPLB R3, [R1], #1
        STRPLB R3, [R0], #1
        BPL    bcopy
        MOV    PC, LR</code></pre><pre><code>@ arguments: R0: to, R1: from, R2: n
@ assume n is a multiple of 4; loop unrolling
bcopy:  SUBS   R2, R2, #4
        LDRPLB R3, [R1], #1
        STRPLB R3, [R0], #1
        LDRPLB R3, [R1], #1
        STRPLB R3, [R0], #1
        LDRPLB R3, [R1], #1
        STRPLB R3, [R0], #1
        LDRPLB R3, [R1], #1
        STRPLB R3, [R0], #1
        BPL    bcopy
        MOV    PC, LR</code></pre><pre><code>@ arguments: R0: to, R1: from, R2: n
@ n is a multiple of 16; 
bcopy:  SUBS   R2, R2, #16
        LDRPL R3, [R1], #4
        STRPL R3, [R0], #4
        LDRPL R3, [R1], #4
        STRPL R3, [R0], #4
        LDRPL R3, [R1], #4
        STRPL R3, [R0], #4
        LDRPL R3, [R1], #4
        STRPL R3, [R0], #4
        BPL   bcopy
        MOV   PC, LR</code></pre><pre><code>@ arguments: R0: to, R1: from, R2: n
@ n is a multiple of 16; 
bcopy:  SUBS   R2, R2, #16
        LDMPL  R1!, {R3-R6} 
        STMPL  R0!, {R3-R6}
        BPL    bcopy
        MOV    PC, LR

@ could be extend to copy 40 byte at a time
@ if not multiple of 40, add a copy_rest loop</code></pre><h2 id="Search-example"><a href="#Search-example" class="headerlink" title="Search example"></a><strong>Search example</strong></h2><pre><code>int main(void)
{
  int a[10]={7,6,4,5,5,1,3,2,9,8};
  int i;
  int s=4;

  for (i=0; i&lt;10; i++)
    if (s==a[i]) break;
  if (i&gt;=10) return -1;
  else return i;
}</code></pre><h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a><strong>Search</strong></h3><pre><code>           .section     .rodata
.LC0:
       .word      7
       .word      6
       .word      4
     .word      5
       .word  5
       .word      1
       .word      3
       .word      2
       .word      9
       .word      8</code></pre><pre><code>           .text
           .global    main
        .type    main, %function
main: sub   sp, sp, #48
      adr   r4, L9 @ =.LC0
      add   r5, sp, #8
      ldmia r4!, {r0, r1, r2, r3} 
      stmia r5!, {r0, r1, r2, r3} 
      ldmia r4!, {r0, r1, r2, r3} 
      stmia r5!, {r0, r1, r2, r3} 
      ldmia r4!, {r0, r1} 
      stmia r5!, {r0, r1} </code></pre><img src="/images/loading.gif" data-original="../images/basic/image-20211020214305532.png" style="zoom:67%;">

<pre><code>mov  r3, #4
      str  r3, [sp, #0] @ s=4
      mov  r3, #0
      str  r3, [sp, #4] @ i=0

loop: ldr  r0, [sp, #4] @ r0=i
      cmp  r0, #10      @ i&lt;10?
      bge  end
      ldr  r1, [sp, #0] @ r1=s
      mov  r2, #4
      mul  r3, r0, r2
      add  r3, r3, #8
      ldr  r4, [sp, r3] @ r4=a[i]</code></pre><pre><code>teq  r1, r4  @ test if s==a[i]
     beq  end  

     add  r0, r0, #1   @ i++
     str  r0, [sp, #4] @ update i
     b    loop  

end: str   r0, [sp, #4]
     cmp   r0, #10
     movge r0, #-1
     add   sp, sp, #48
     mov   pc, lr </code></pre><h2 id="Optimization-1"><a href="#Optimization-1" class="headerlink" title="Optimization"></a><strong>Optimization</strong></h2><ul>
<li>Remove unnecessary load/store</li>
<li>Remove loop invariant</li>
<li>Use addressing mode</li>
<li>Use conditional execution</li>
</ul>
<h3 id="Search-remove-load-store"><a href="#Search-remove-load-store" class="headerlink" title="Search (remove load/store)"></a>Search (remove load/store)</h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020214737969.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020214854264.png" alt=""></p>
<h3 id="Search-loop-invariant-addressing-mode"><a href="#Search-loop-invariant-addressing-mode" class="headerlink" title="Search (loop invariant/addressing mode)"></a>Search (loop invariant/addressing mode)</h3><p><img src="/images/loading.gif" data-original="../images/basic/image-20211020215421578.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/basic/image-20211020215431501.png" alt=""></p>
<ul>
<li>Remove unnecessary load/store</li>
<li>Remove loop invariant</li>
<li>Use addressing mode</li>
<li>Use conditional execution</li>
<li>From 22 words to 13 words and execution time is greatly reduced.</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/Embedded-Assembly-Languages.html">https://jackhcc.github.io/posts/Embedded-Assembly-Languages.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Assembly/">
                                    <span class="chip bg-color">Assembly</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-10-21T23-22-44',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/dl-series14.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/7.jpg" class="responsive-img" alt="DL专栏14-DL环境搭建指南">
                        
                        <span class="card-title">DL专栏14-DL环境搭建指南</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Deep Learning环境配置保姆教程
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-10-22
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Environment/">
                        <span class="chip bg-color">Environment</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/dl-series13.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/19.jpg" class="responsive-img" alt="DL专栏13-Attention机制总结">
                        
                        <span class="card-title">DL专栏13-Attention机制总结</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            各类Attention原理与实现
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-10-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Attention/">
                        <span class="chip bg-color">Attention</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

