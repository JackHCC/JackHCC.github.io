<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Python-Standard Library, JackHCC">
    <meta name="description" content="Python标准库详解【4】">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Python-Standard Library | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Python-Standard Library</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Python/" class="post-category">
                                Python
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-14
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-11-20
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    136k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    632 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Python-标准库"><a href="#Python-标准库" class="headerlink" title="Python 标准库"></a>Python 标准库</h1><ul>
<li>多媒体服务<ul>
<li><code>audioop</code> —- 处理原始音频数据</li>
<li><code>aifc</code> —- 读写 AIFF 和 AIFC 文件</li>
<li><code>sunau</code> —- 读写 Sun AU 文件</li>
<li><code>wave</code> —- 读写WAV格式文件</li>
<li><code>chunk</code> —- 读取 IFF 分块数据</li>
<li><code>colorsys</code> —- 颜色系统间的转换</li>
<li><code>imghdr</code> —- 推测图像类型</li>
<li><code>sndhdr</code> —- 推测声音文件的类型</li>
<li><code>ossaudiodev</code> —- 访问兼容OSS的音频设备</li>
</ul>
</li>
<li>国际化<ul>
<li><code>gettext</code> —- 多语种国际化服务</li>
<li><code>locale</code> —- 国际化服务</li>
</ul>
</li>
<li>程序框架<ul>
<li><code>turtle</code> —- 海龟绘图</li>
<li><code>cmd</code> —- 支持面向行的命令解释器</li>
<li><code>shlex</code> —— 简单的词法分析</li>
</ul>
</li>
<li>Tk图形用户界面(GUI)<ul>
<li><code>tkinter</code> —- Tcl/Tk的Python接口</li>
<li><code>tkinter.colorchooser</code> —- 颜色选择对话框</li>
<li><code>tkinter.font</code> —- Tkinter 字体封装</li>
<li>Tkinter 对话框</li>
<li><code>tkinter.messagebox</code> —- Tkinter 消息提示</li>
<li><code>tkinter.scrolledtext</code> —- 滚动文字控件</li>
<li><code>tkinter.dnd</code> —- 拖放操作支持</li>
<li><code>tkinter.ttk</code> —- Tk主题部件</li>
<li><code>tkinter.tix</code> —- TK扩展包</li>
<li>IDLE</li>
</ul>
</li>
<li>开发工具<ul>
<li><code>typing</code> —- 类型提示支持</li>
<li><code>pydoc</code> —- 文档生成器和在线帮助系统</li>
<li>Python Development Mode</li>
<li>Effects of the Python Development Mode</li>
<li>ResourceWarning Example</li>
<li>Bad file descriptor error example</li>
<li><code>doctest</code> —- 测试交互性的Python示例</li>
<li><code>unittest</code> —- 单元测试框架</li>
<li><code>unittest.mock</code> —- 模拟对象库</li>
<li><code>unittest.mock</code> 上手指南</li>
<li>2to3 - 自动将 Python 2 代码转为 Python 3 代码</li>
<li><code>test</code> —- Python回归测试包</li>
<li><code>test.support</code> —- Utilities for the Python test suite</li>
<li><code>test.support.socket_helper</code> —- Utilities for socket tests</li>
<li><code>test.support.script_helper</code> —- Utilities for the Python execution tests</li>
<li><code>test.support.bytecode_helper</code> —- Support tools for testing correct bytecode generation</li>
<li><code>test.support.threading_helper</code> —- Utilities for threading tests</li>
<li><code>test.support.os_helper</code> —- Utilities for os tests</li>
<li><code>test.support.import_helper</code> —- Utilities for import tests</li>
<li><code>test.support.warnings_helper</code> —- Utilities for warnings tests</li>
</ul>
</li>
<li>调试和分析<ul>
<li>审计事件表</li>
<li><code>bdb</code> —- Debugger framework</li>
<li><code>faulthandler</code> —- Dump the Python traceback</li>
<li><code>pdb</code> —- Python 的调试器</li>
<li>Python Profilers 分析器</li>
<li><code>timeit</code> —- 测量小代码片段的执行时间</li>
<li><code>trace</code> —- 跟踪Python语句的执行</li>
<li><code>tracemalloc</code> —- 跟踪内存分配</li>
</ul>
</li>
<li>软件打包和分发<ul>
<li><code>distutils</code> —- 构建和安装 Python 模块</li>
<li><code>ensurepip</code> —- Bootstrapping the <code>pip</code> installer</li>
<li><code>venv</code> —- 创建虚拟环境</li>
<li><code>zipapp</code> —- Manage executable Python zip archives</li>
</ul>
</li>
<li>Python运行时服务<ul>
<li><code>sys</code> —- 系统相关的参数和函数</li>
<li><code>sysconfig</code> —- Provide access to Python’s configuration information</li>
<li><code>builtins</code> —- 内建对象</li>
<li><code>__main__</code> —- Top-level code environment</li>
<li><code>warnings</code> —— 警告信息的控制</li>
<li><code>dataclasses</code> —- 数据类</li>
<li><code>contextlib</code> —- 为 <code>with</code>语句上下文提供的工具</li>
<li><code>abc</code> —- 抽象基类</li>
<li><code>atexit</code> —- 退出处理器</li>
<li><code>traceback</code> —- 打印或检索堆栈回溯</li>
<li><code>__future__</code> —- Future 语句定义</li>
<li><code>gc</code> —- 垃圾回收器接口</li>
<li><code>inspect</code> —- 检查对象</li>
<li><code>site</code> —— 指定域的配置钩子</li>
</ul>
</li>
<li>自定义 Python 解释器<ul>
<li><code>code</code> —- 解释器基类</li>
<li><code>codeop</code> —- 编译Python代码</li>
</ul>
</li>
<li>导入模块<ul>
<li><code>zipimport</code> —- 从 Zip 存档中导入模块</li>
<li><code>pkgutil</code> —- 包扩展工具</li>
<li><code>modulefinder</code> —- 查找脚本使用的模块</li>
<li><code>runpy</code> ——查找并执行 Python 模块</li>
<li><code>importlib</code> —- <code>import</code> 的实现</li>
<li>Using <code>importlib.metadata</code></li>
</ul>
</li>
<li>Python 语言服务<ul>
<li><code>ast</code> —- 抽象语法树</li>
<li><code>symtable</code> —- Access to the compiler’s symbol tables</li>
<li><code>token</code> —- 与Python解析树一起使用的常量</li>
<li><code>keyword</code> —- 检验Python关键字</li>
<li><code>tokenize</code> —- 对 Python 代码使用的标记解析器</li>
<li><code>tabnanny</code> —- 模糊缩进检测</li>
<li><code>pyclbr</code> —- Python 模块浏览器支持</li>
<li><code>py_compile</code> —- 编译 Python 源文件</li>
<li><code>compileall</code> —- Byte-compile Python libraries</li>
<li><code>dis</code> —- Python 字节码反汇编器</li>
<li><code>pickletools</code> —- pickle 开发者工具集</li>
</ul>
</li>
<li>Windows系统相关模块<ul>
<li><code>msilib</code> —- Read and write Microsoft Installer files</li>
<li><code>msvcrt</code> —- 来自 MS VC++ 运行时的有用例程</li>
<li><code>winreg</code> —- 访问 Windows 注册表</li>
<li><code>winsound</code> —— Windows 系统的音频播放接口</li>
</ul>
</li>
<li>Unix 专有服务<ul>
<li><code>posix</code> —- 最常见的 POSIX 系统调用</li>
<li><code>pwd</code> —- 用户密码数据库</li>
<li><code>spwd</code> —- The shadow password database</li>
<li><code>grp</code> —- 组数据库</li>
<li><code>crypt</code> —— 验证 Unix 口令的函数</li>
<li><code>termios</code> —- POSIX 风格的 tty 控制</li>
<li><code>tty</code> —- 终端控制功能</li>
<li><code>pty</code> —- 伪终端工具</li>
<li><code>fcntl</code> —— 系统调用 <code>fcntl</code> 和 <code>ioctl</code></li>
<li><code>pipes</code> —- 终端管道接口</li>
<li><code>resource</code> —- Resource usage information</li>
<li><code>nis</code> —- Sun 的 NIS (黄页) 接口</li>
<li>Unix syslog 库例程</li>
</ul>
</li>
<li>被取代的模块<ul>
<li><code>optparse</code> —- 解析器的命令行选项</li>
<li><code>imp</code> —- Access the import internals</li>
</ul>
</li>
<li>未创建文档的模块<ul>
<li>平台特定模块</li>
</ul>
</li>
<li>Security Considerations</li>
</ul>
<h1 id="多媒体服务"><a href="#多媒体服务" class="headerlink" title="多媒体服务"></a>多媒体服务</h1><p>本章描述的模块实现了主要用于多媒体应用的各种算法或接口。 它们可在安装时自行决定。 这是一个概述：</p>
<ul>
<li><code>audioop</code> —- 处理原始音频数据</li>
<li><code>aifc</code> —- 读写 AIFF 和 AIFC 文件</li>
<li><code>sunau</code> —- 读写 Sun AU 文件<ul>
<li>AU_read 对象</li>
<li>AU_write 对象</li>
</ul>
</li>
<li><code>wave</code> —- 读写WAV格式文件<ul>
<li>Wave_read对象</li>
<li>Wave_write 对象</li>
</ul>
</li>
<li><code>chunk</code> —- 读取 IFF 分块数据</li>
<li><code>colorsys</code> —- 颜色系统间的转换</li>
<li><code>imghdr</code> —- 推测图像类型</li>
<li><code>sndhdr</code> —- 推测声音文件的类型</li>
<li><code>ossaudiodev</code> —- 访问兼容OSS的音频设备<ul>
<li>Audio Device Objects</li>
<li>Mixer Device Objects</li>
</ul>
</li>
</ul>
<h2 id="audioop-—-处理原始音频数据"><a href="#audioop-—-处理原始音频数据" class="headerlink" title="audioop —- 处理原始音频数据"></a><code>audioop</code> —- 处理原始音频数据</h2><p><code>audioop</code> 模块包含针对声音片段的一些有用操作。它操作的声音片段由 8、16、24 或 32 位宽的有符号整型采样值组成，存储在 类字节串对象 中。除非特别说明，否则所有标量项目均为整数。</p>
<p>在 3.4 版更改: 增加了对 24 位采样的支持。现在，所有函数都接受任何 类字节串对象。而传入字符串会立即导致错误。</p>
<p>本模块提供对 a-LAW、u-LAW 和 Intel/DVI ADPCM 编码的支持。</p>
<p>部分更复杂的操作仅接受 16 位采样，而其他操作始终需要采样大小（以字节为单位）作为该操作的参数。</p>
<p>此模块定义了下列变量和函数：</p>
<p><em>exception</em><code>audioop.error</code></p>
<p>所有错误都会抛出此异常，比如采样值的字节数未知等等。</p>
<p><code>audioop.add</code>(<em>fragment1</em>, <em>fragment2</em>, <em>width</em>)</p>
<p>两个采样作为参数传入，返回一个片段，该片段是两个采样的和。<em>width</em> 是采样位宽（以字节为单位），可以取 <code>1</code>, <code>2</code>, <code>3</code> 或 <code>4</code>。两个片段的长度应相同。如果发生溢出，较长的采样将被截断。</p>
<p><code>audioop.adpcm2lin</code>(<em>adpcmfragment</em>, <em>width</em>, <em>state</em>)</p>
<p>将 Intel/DVI ADPCM 编码的片段解码为线性片段。关于 ADPCM 编码的详情请参阅 <code>lin2adpcm()</code> 的描述。返回一个元组 <code>(sample, newstate)</code>，其中 sample 的位宽由 <em>width</em> 指定。</p>
<p><code>audioop.alaw2lin</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将 a-LAW 编码的声音片段转换为线性编码声音片段。由于 a-LAW 编码采样值始终为 8 位，因此这里的 <em>width</em> 仅指输出片段的采样位宽。</p>
<p><code>audioop.avg</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回片段中所有采样值的平均值。</p>
<p><code>audioop.avgpp</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回片段中所有采样值的平均峰峰值。由于没有进行过滤，因此该例程的实用性尚存疑。</p>
<p><code>audioop.bias</code>(<em>fragment</em>, <em>width</em>, <em>bias</em>)</p>
<p>返回一个片段，该片段由原始片段中的每个采样值加上偏差组成。在溢出时采样值会回卷 (wrap around)。</p>
<p><code>audioop.byteswap</code>(<em>fragment</em>, <em>width</em>)</p>
<p>“按字节交换”片段中的所有采样值，返回修改后的片段。将大端序采样转换为小端序采样，反之亦然。</p>
<p>3.4 新版功能.</p>
<p><code>audioop.cross</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将片段作为参数传入，返回其中过零点的数量。</p>
<p><code>audioop.findfactor</code>(<em>fragment</em>, <em>reference</em>)</p>
<p>返回一个系数 <em>F</em> 使得 <code>rms(add(fragment, mul(reference, -F)))</code> 最小，即返回的系数乘以 <em>reference</em> 后与 <em>fragment</em> 最匹配。两个片段都应包含 2 字节宽的采样。</p>
<p>本例程所需的时间与 <code>len(fragment)</code> 成正比。</p>
<p><code>audioop.findfit</code>(<em>fragment</em>, <em>reference</em>)</p>
<p>尽可能尝试让 <em>reference</em> 匹配 <em>fragment</em> 的一部分（<em>fragment</em> 应较长）。从概念上讲，完成这些靠从 <em>fragment</em> 中取出切片，使用 <code>findfactor()</code> 计算最佳匹配，并最小化结果。两个片段都应包含 2 字节宽的采样。返回一个元组 <code>(offset, factor)</code>，其中 <em>offset</em> 是在 <em>fragment</em> 中的偏移量（整数），表示从此处开始最佳匹配，而 <em>factor</em> 是由 <code>findfactor()</code> 定义的因数（浮点数）。</p>
<p><code>audioop.findmax</code>(<em>fragment</em>, <em>length</em>)</p>
<p>在 <em>fragment</em> 中搜索所有长度为 <em>length</em> 的采样切片（不是字节！）中，能量最大的那一个切片，即返回 <em>i</em> 使得 <code>rms(fragment[i*2:(i+length)*2])</code> 最大。两个片段都应包含 2 字节宽的采样。</p>
<p>本例程所需的时间与 <code>len(fragment)</code> 成正比。</p>
<p><code>audioop.getsample</code>(<em>fragment</em>, <em>width</em>, <em>index</em>)</p>
<p>返回片段中采样值索引 <em>index</em> 的值。</p>
<p><code>audioop.lin2adpcm</code>(<em>fragment</em>, <em>width</em>, <em>state</em>)</p>
<p>将采样转换为 4 位 Intel/DVI ADPCM 编码。ADPCM 编码是一种自适应编码方案，其中每个 4 比特数字是一个采样值与下一个采样值之间的差除以（不定的）步长。IMA 已选择使用 Intel/DVI ADPCM 算法，因此它很可能成为标准。</p>
<p><em>state</em> 是一个表示编码器状态的元组。编码器返回一个元组 <code>(adpcmfrag, newstate)</code>，而 <em>newstate</em> 要在下一次调用 <code>lin2adpcm()</code> 时传入。在初始调用中，可以将 <code>None</code> 作为 state 传递。<em>adpcmfrag</em> 是 ADPCM 编码的片段，每个字节打包了 2 个 4 比特值。</p>
<p><code>audioop.lin2alaw</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将音频片段中的采样值转换为 a-LAW 编码，并将其作为字节对象返回。a-LAW 是一种音频编码格式，仅使用 8 位采样即可获得大约 13 位的动态范围。Sun 音频硬件等使用该编码。</p>
<p><code>audioop.lin2lin</code>(<em>fragment</em>, <em>width</em>, <em>newwidth</em>)</p>
<p>将采样在 1、2、3 和 4 字节格式之间转换。</p>
<p>注解</p>
<p>在某些音频格式（如 .WAV 文件）中，16、24 和 32 位采样是有符号的，但 8 位采样是无符号的。因此，当将这些格式转换为 8 位宽采样时，还需使结果加上 128:</p>
<pre class="line-numbers language-python"><code class="language-python">new_frames <span class="token operator">=</span> audioop<span class="token punctuation">.</span>lin2lin<span class="token punctuation">(</span>frames<span class="token punctuation">,</span> old_width<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
new_frames <span class="token operator">=</span> audioop<span class="token punctuation">.</span>bias<span class="token punctuation">(</span>new_frames<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>反之，将 8 位宽的采样转换为 16、24 或 32 位时，必须采用相同的处理。</p>
<p><code>audioop.lin2ulaw</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将音频片段中的采样值转换为 u-LAW 编码，并将其作为字节对象返回。u-LAW 是一种音频编码格式，仅使用 8 位采样即可获得大约 14 位的动态范围。Sun 音频硬件等使用该编码。</p>
<p><code>audioop.max</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回片段中所有采样值的最大 <em>绝对值</em>。</p>
<p><code>audioop.maxpp</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回声音片段中的最大峰峰值。</p>
<p><code>audioop.minmax</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回声音片段中所有采样值的最小值和最大值组成的元组。</p>
<p><code>audioop.mul</code>(<em>fragment</em>, <em>width</em>, <em>factor</em>)</p>
<p>返回一个片段，该片段由原始片段中的每个采样值乘以浮点值 <em>factor</em> 组成。如果发生溢出，采样将被截断。</p>
<p><code>audioop.ratecv</code>(<em>fragment</em>, <em>width</em>, <em>nchannels</em>, <em>inrate</em>, <em>outrate</em>, <em>state</em>[, <em>weightA</em>[, <em>weightB</em>]])</p>
<p>转换输入片段的帧速率。</p>
<p><em>state</em> 是一个表示转换器状态的元组。转换器返回一个元组 <code>(newfragment, newstate)</code>，而 <em>newstate</em> 要在下一次调用 <code>ratecv()</code> 时传入。初始调用应传入 <code>None</code> 作为 state。</p>
<p>参数 <em>weightA</em> 和 <em>weightB</em> 是简单数字滤波器的参数，默认分别为 <code>1</code> 和 <code>0</code>。</p>
<p><code>audioop.reverse</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将片段中的采样值反转，返回修改后的片段。</p>
<p><code>audioop.rms</code>(<em>fragment</em>, <em>width</em>)</p>
<p>返回片段的均方根值，即 <code>sqrt(sum(S_i^2)/n)</code>。</p>
<p>测量音频信号的能量。</p>
<p><code>audioop.tomono</code>(<em>fragment</em>, <em>width</em>, <em>lfactor</em>, <em>rfactor</em>)</p>
<p>将立体声片段转换为单声道片段。左通道乘以 <em>lfactor</em>，右通道乘以 <em>rfactor</em>，然后两个通道相加得到单声道信号。</p>
<p><code>audioop.tostereo</code>(<em>fragment</em>, <em>width</em>, <em>lfactor</em>, <em>rfactor</em>)</p>
<p>由单声道片段生成立体声片段。立体声片段中的两对采样都是从单声道计算而来的，即左声道是乘以 <em>lfactor</em>，右声道是乘以 <em>rfactor</em>。</p>
<p><code>audioop.ulaw2lin</code>(<em>fragment</em>, <em>width</em>)</p>
<p>将 u-LAW 编码的声音片段转换为线性编码声音片段。由于 u-LAW 编码采样值始终为 8 位，因此这里的 <em>width</em> 仅指输出片段的采样位宽。</p>
<p>请注意，诸如 <code>mul()</code> 或 <code>max()</code> 之类的操作在单声道和立体声间没有区别，即所有采样都作相同处理。如果出现问题，应先将立体声片段拆分为两个单声道片段，之后再重组。以下是如何进行该操作的示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">mul_stereo</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> width<span class="token punctuation">,</span> lfactor<span class="token punctuation">,</span> rfactor<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>tomono<span class="token punctuation">(</span>sample<span class="token punctuation">,</span> width<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    rsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>tomono<span class="token punctuation">(</span>sample<span class="token punctuation">,</span> width<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    lsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>lsample<span class="token punctuation">,</span> width<span class="token punctuation">,</span> lfactor<span class="token punctuation">)</span>
    rsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>rsample<span class="token punctuation">,</span> width<span class="token punctuation">,</span> rfactor<span class="token punctuation">)</span>
    lsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>tostereo<span class="token punctuation">(</span>lsample<span class="token punctuation">,</span> width<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    rsample <span class="token operator">=</span> audioop<span class="token punctuation">.</span>tostereo<span class="token punctuation">(</span>rsample<span class="token punctuation">,</span> width<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> audioop<span class="token punctuation">.</span>add<span class="token punctuation">(</span>lsample<span class="token punctuation">,</span> rsample<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果使用 ADPCM 编码器构造网络数据包，并且希望协议是无状态的（即能够容忍数据包丢失），则不仅需要传输数据，还应该传输状态。请注意，必须将<em>初始</em>状态（传入 <code>lin2adpcm()</code> 的状态）发送给解码器，不能发送最终状态（编码器返回的状态）。如果要使用 <code>struct.Struct</code> 以二进制保存状态，可以将第一个元素（预测值）用 16 位编码，将第二个元素（增量索引）用 8 位编码。</p>
<p>本 ADPCM 编码器从不与其他 ADPCM 编码器对立，仅针对自身。本开发者可能会误读标准，这种情况下它们将无法与相应标准互操作。</p>
<p>乍看之下 <code>find*()</code> 例程可能有些可笑。它们主要是用于回声消除，一种快速有效的方法是选取输出样本中能量最高的片段，在输入样本中定位该片段，然后从输入样本中减去整个输出样本:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">echocancel</span><span class="token punctuation">(</span>outputdata<span class="token punctuation">,</span> inputdata<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pos <span class="token operator">=</span> audioop<span class="token punctuation">.</span>findmax<span class="token punctuation">(</span>outputdata<span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># one tenth second</span>
    out_test <span class="token operator">=</span> outputdata<span class="token punctuation">[</span>pos<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    in_test <span class="token operator">=</span> inputdata<span class="token punctuation">[</span>pos<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    ipos<span class="token punctuation">,</span> factor <span class="token operator">=</span> audioop<span class="token punctuation">.</span>findfit<span class="token punctuation">(</span>in_test<span class="token punctuation">,</span> out_test<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Optional (for better cancellation):</span>
<span class="token comment" spellcheck="true"># factor = audioop.findfactor(in_test[ipos*2:ipos*2+len(out_test)],</span>
<span class="token comment" spellcheck="true">#              out_test)</span>
    prefill <span class="token operator">=</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token punctuation">(</span>pos<span class="token operator">+</span>ipos<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>
    postfill <span class="token operator">=</span><span class="token string">'\0'</span><span class="token operator">*</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>inputdata<span class="token punctuation">)</span><span class="token operator">-</span>len<span class="token punctuation">(</span>prefill<span class="token punctuation">)</span><span class="token operator">-</span>len<span class="token punctuation">(</span>outputdata<span class="token punctuation">)</span><span class="token punctuation">)</span>
    outputdata <span class="token operator">=</span> prefill <span class="token operator">+</span> audioop<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>outputdata<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span>factor<span class="token punctuation">)</span><span class="token operator">+</span> postfill
<span class="token keyword">return</span> audioop<span class="token punctuation">.</span>add<span class="token punctuation">(</span>inputdata<span class="token punctuation">,</span> outputdata<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="aifc-—-读写-AIFF-和-AIFC-文件"><a href="#aifc-—-读写-AIFF-和-AIFC-文件" class="headerlink" title="aifc —- 读写 AIFF 和 AIFC 文件"></a><code>aifc</code> —- 读写 AIFF 和 AIFC 文件</h2><p>源代码： <a href="https://github.com/python/cpython/tree/3.10/Lib/aifc.py" target="_blank" rel="noopener">Lib/aifc.py</a></p>
<hr>
<p>本模块提供读写 AIFF 和 AIFF-C 文件的支持。AIFF 是音频交换文件格式 (Audio Interchange File Format)，一种用于在文件中存储数字音频采样的格式。AIFF-C 是该格式的更新版本，其中包括压缩音频数据的功能。</p>
<p>音频文件内有许多参数，用于描述音频数据。采样率或帧率是每秒对声音采样的次数。通道数表示音频是单声道，双声道还是四声道。每个通道的每个帧包含一次采样。采样大小是以字节表示的每次采样的大小。因此，一帧由 <code>nchannels * samplesize</code> （通道数<em>采样大小）字节组成，而一秒钟的音频包含 <code>nchannels * samplesize * framerate</code> （通道数</em>采样大小*帧率）字节。</p>
<p>例如，CD 质量的音频采样大小为 2 字节（16位），使用 2 个声道（立体声），且帧速率为 44,100 帧/秒。这表示帧大小为 4 字节 (2<em>2)，一秒钟占用 2</em>2*44100 字节（176,400 字节）。</p>
<p><code>aifc</code> 模块定义了以下函数：</p>
<p><code>aifc.open</code>(<em>file</em>, <em>mode=None</em>)</p>
<p>打开一个 AIFF 或 AIFF-C 文件并返回一个对象实例，该实例具有下方描述的方法。参数 <em>file</em> 是文件名称字符串或 文件对象。当打开文件用于读取时，<em>mode</em> 必须为 <code>'r'</code> 或 <code>'rb'</code>，当打开文件用于写入时，<em>mode</em> 必须为 <code>'w'</code> 或 <code>'wb'</code>。如果该参数省略，则使用 <code>file.mode</code> 的值（如果有），否则使用 <code>'rb'</code>。当文件用于写入时，文件对象应该支持 seek 操作，除非提前获知写入的采样总数，并使用 <code>writeframesraw()</code> 和 <code>setnframes()</code>。<code>open()</code> 函数可以在 <code>with</code> 语句中使用。当 <code>with</code> 块执行完毕，将调用 <code>close()</code> 方法。</p>
<p>在 3.4 版更改: 添加了对 <code>with</code> 语句的支持。</p>
<p>当打开文件用于读取时，由 <code>open()</code> 返回的对象具有以下几种方法：</p>
<p><code>aifc.getnchannels</code>()</p>
<p>返回音频的通道数（单声道为 1，立体声为 2）。</p>
<p><code>aifc.getsampwidth</code>()</p>
<p>返回以字节表示的单个采样的大小。</p>
<p><code>aifc.getframerate</code>()</p>
<p>返回采样率（每秒的音频帧数）。</p>
<p><code>aifc.getnframes</code>()</p>
<p>返回文件中的音频帧总数。</p>
<p><code>aifc.getcomptype</code>()</p>
<p>返回一个长度为 4 的字节数组，描述了音频文件中使用的压缩类型。对于 AIFF 文件，返回值为 <code>b'NONE'</code>。</p>
<p><code>aifc.getcompname</code>()</p>
<p>返回一个字节数组，可转换为人类可读的描述，描述的是音频文件中使用的压缩类型。对于 AIFF 文件，返回值为 <code>b'not compressed'</code>。</p>
<p><code>aifc.getparams</code>()</p>
<p>返回一个 <code>namedtuple()</code> <code>(nchannels, sampwidth, framerate, nframes, comptype, compname)</code>，与 <code>get*()</code> 方法的输出相同。</p>
<p><code>aifc.getmarkers</code>()</p>
<p>返回一个列表，包含音频文件中的所有标记。标记由一个 3 元素的元组组成。第一个元素是标记 ID（整数），第二个是标记位置，从数据开头算起的帧数（整数），第三个是标记的名称（字符串）。</p>
<p><code>aifc.getmark</code>(<em>id</em>)</p>
<p>根据传入的标记 <em>id</em> 返回元组，元组与 <code>getmarkers()</code> 中描述的一致。</p>
<p><code>aifc.readframes</code>(<em>nframes</em>)</p>
<p>从音频文件读取并返回后续 <em>nframes</em> 个帧。返回的数据是一个字符串，包含每个帧所有通道的未压缩采样值。</p>
<p><code>aifc.rewind</code>()</p>
<p>倒回读取指针。下一次 <code>readframes()</code> 将从头开始。</p>
<p><code>aifc.setpos</code>(<em>pos</em>)</p>
<p>移动读取指针到指定的帧上。</p>
<p><code>aifc.tell</code>()</p>
<p>返回当前的帧号。</p>
<p><code>aifc.close</code>()</p>
<p>关闭 AIFF 文件。调用此方法后，对象将无法再使用。</p>
<p>打开文件用于写入时，<code>open()</code> 返回的对象具有上述所有方法，但 <code>readframes()</code> 和 <code>setpos()</code> 除外，并额外具备了以下方法。只有调用了 <code>set*()</code> 方法之后，才能调用相应的 <code>get*()</code> 方法。在首次调用 <code>writeframes()</code> 或 <code>writeframesraw()</code> 之前，必须填写除帧数以外的所有参数。</p>
<p><code>aifc.aiff</code>()</p>
<p>创建一个 AIFF 文件，默认创建 AIFF-C 文件，除非文件名以 <code>'.aiff'</code> 为后缀，在此情况下默认创建 AIFF 文件。</p>
<p><code>aifc.aifc</code>()</p>
<p>创建一个 AIFF-C 文件。 默认创建 AIFF-C 文件，除非文件名以 <code>'.aiff'</code> 为后缀，在此情况下默认创建 AIFF 文件。</p>
<p><code>aifc.setnchannels</code>(<em>nchannels</em>)</p>
<p>指明音频文件中的通道数。</p>
<p><code>aifc.setsampwidth</code>(<em>width</em>)</p>
<p>指明以字节为单位的音频采样大小。</p>
<p><code>aifc.setframerate</code>(<em>rate</em>)</p>
<p>指明以每秒帧数表示的采样频率。</p>
<p><code>aifc.setnframes</code>(<em>nframes</em>)</p>
<p>指明要写入到音频文件的帧数。 如果未设定此形参或者未正确设定，则文件需要支持位置查找。</p>
<p><code>aifc.setcomptype</code>(<em>type</em>, <em>name</em>)</p>
<p>指明压缩类型。 如果未指明，则音频数据将不会被压缩。 在 AIFF 文件中，压缩是无法实现的。 name 形参应当为以字节数组表示的人类可读的压缩类型描述，type 形参应当为长度为 4 的字节数组。 目前支持的压缩类型如下: <code>b'NONE'</code>, <code>b'ULAW'</code>, <code>b'ALAW'</code>, <code>b'G722'</code>。</p>
<p><code>aifc.setparams</code>(<em>nchannels</em>, <em>sampwidth</em>, <em>framerate</em>, <em>comptype</em>, <em>compname</em>)</p>
<p>一次性设置上述所有参数。 该参数是由多个形参组成的元组。 这意味着可以使用 <code>getparams()</code> 调用的结果作为 <code>setparams()</code> 的参数。</p>
<p><code>aifc.setmark</code>(<em>id</em>, <em>pos</em>, <em>name</em>)</p>
<p>添加具有给定 id (大于 0)，以及在给定位置上给定名称的标记。 此方法可在 <code>close()</code> 之前的任何时候被调用。</p>
<p><code>aifc.tell</code>()</p>
<p>返回输出文件中的当前写入位置。 适用于与 <code>setmark()</code> 进行协同配合。</p>
<p><code>aifc.writeframes</code>(<em>data</em>)</p>
<p>将数据写入到输出文件。 此方法只能在设置了音频文件形参之后被调用。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p><code>aifc.writeframesraw</code>(<em>data</em>)</p>
<p>类似于 <code>writeframes()</code>，不同之处在于音频文件的标头不会被更新。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p><code>aifc.close</code>()</p>
<p>关闭 AIFF 文件。 文件的标头会被更新以反映音频数据的实际大小。 在调用此方法之后，对象将无法再被使用。</p>
<h2 id="sunau-—-读写-Sun-AU-文件"><a href="#sunau-—-读写-Sun-AU-文件" class="headerlink" title="sunau —- 读写 Sun AU 文件"></a><code>sunau</code> —- 读写 Sun AU 文件</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/sunau.py" target="_blank" rel="noopener">Lib/sunau.py</a></p>
<hr>
<p><code>sunau</code> 模拟提供了一个处理 Sun AU 声音格式的便利接口。请注意此模块与 <code>aifc</code> 和 <code>wave</code> 是兼容接口的。</p>
<p>音频文件由标头和数据组成。标头的字段为：</p>
<table>
<thead>
<tr>
<th align="left">域</th>
<th align="left">目录</th>
</tr>
</thead>
<tbody><tr>
<td align="left">magic word</td>
<td align="left">四个字节 <code>.snd</code></td>
</tr>
<tr>
<td align="left">header size</td>
<td align="left">标头的大小，包括信息，以字节为单位。</td>
</tr>
<tr>
<td align="left">data size</td>
<td align="left">数据的物理大小，以字节为单位。</td>
</tr>
<tr>
<td align="left">编码</td>
<td align="left">指示音频样本的编码方式。</td>
</tr>
<tr>
<td align="left">sample rate</td>
<td align="left">采样率</td>
</tr>
<tr>
<td align="left"># of channels</td>
<td align="left">采样中的通道数。</td>
</tr>
<tr>
<td align="left">info</td>
<td align="left">提供音频文件描述的ASCII字符串（用空字节填充）。</td>
</tr>
</tbody></table>
<p>Apart from the info field, all header fields are 4 bytes in size. They are all 32-bit unsigned integers encoded in big-endian byte order.</p>
<p>The <code>sunau</code> module defines the following functions:</p>
<p><code>sunau.open</code>(<em>file</em>, <em>mode</em>)</p>
<p>If <em>file</em> is a string, open the file by that name, otherwise treat it as a seekable file-like object. <em>mode</em> can be any of</p>
<ul>
<li><p><code>'r'</code></p>
<p>只读模式。</p>
<p><code>'w'</code></p>
<p>只写模式。</p>
</li>
</ul>
<p>Note that it does not allow read/write files.</p>
<p>A <em>mode</em> of <code>'r'</code> returns an <code>AU_read</code> object, while a <em>mode</em> of <code>'w'</code> or <code>'wb'</code> returns an <code>AU_write</code> object.</p>
<p>The <code>sunau</code> module defines the following exception:</p>
<p><em>exception</em> <code>sunau.Error</code></p>
<p>An error raised when something is impossible because of Sun AU specs or implementation deficiency.</p>
<p>The <code>sunau</code> module defines the following data items:</p>
<pre><code>sunau.AUDIO_FILE_MAGIC</code></pre><p>An integer every valid Sun AU file begins with, stored in big-endian form. This is the string <code>.snd</code> interpreted as an integer.</p>
<pre><code>sunau.AUDIO_FILE_ENCODING_MULAW_8
sunau.AUDIO_FILE_ENCODING_LINEAR_8
sunau.AUDIO_FILE_ENCODING_LINEAR_16
sunau.AUDIO_FILE_ENCODING_LINEAR_24
sunau.AUDIO_FILE_ENCODING_LINEAR_32
sunau.AUDIO_FILE_ENCODING_ALAW_8</code></pre><p>Values of the encoding field from the AU header which are supported by this module.</p>
<pre><code>sunau.AUDIO_FILE_ENCODING_FLOAT
sunau.AUDIO_FILE_ENCODING_DOUBLE
sunau.AUDIO_FILE_ENCODING_ADPCM_G721
sunau.AUDIO_FILE_ENCODING_ADPCM_G722
sunau.AUDIO_FILE_ENCODING_ADPCM_G723_3
sunau.AUDIO_FILE_ENCODING_ADPCM_G723_5</code></pre><p>Additional known values of the encoding field from the AU header, but which are not supported by this module.</p>
<h3 id="AU-read-对象"><a href="#AU-read-对象" class="headerlink" title="AU_read 对象"></a>AU_read 对象</h3><p>AU_read objects, as returned by <code>open()</code> above, have the following methods:</p>
<p><code>AU_read.close</code>()</p>
<p>Close the stream, and make the instance unusable. (This is called automatically on deletion.)</p>
<p><code>AU_read.getnchannels</code>()</p>
<p>Returns number of audio channels (1 for mono, 2 for stereo).</p>
<p><code>AU_read.getsampwidth</code>()</p>
<p>返回采样字节长度。</p>
<p><code>AU_read.getframerate</code>()</p>
<p>返回采样频率。</p>
<p><code>AU_read.getnframes</code>()</p>
<p>返回音频总帧数。</p>
<p><code>AU_read.getcomptype</code>()</p>
<p>Returns compression type. Supported compression types are <code>'ULAW'</code>, <code>'ALAW'</code> and <code>'NONE'</code>.</p>
<p><code>AU_read.getcompname</code>()</p>
<p>Human-readable version of <code>getcomptype()</code>. The supported types have the respective names <code>'CCITT G.711 u-law'</code>, <code>'CCITT G.711 A-law'</code> and <code>'not compressed'</code>.</p>
<p><code>AU_read.getparams</code>()</p>
<p>返回一个 <code>namedtuple()</code> <code>(nchannels, sampwidth, framerate, nframes, comptype, compname)</code>，与 <code>get*()</code> 方法的输出相同。</p>
<p><code>AU_read.readframes</code>(<em>n</em>)</p>
<p>Reads and returns at most <em>n</em> frames of audio, as a <code>bytes</code> object. The data will be returned in linear format. If the original data is in u-LAW format, it will be converted.</p>
<p><code>AU_read.rewind</code>()</p>
<p>重置文件指针至音频开头.</p>
<p>以下两个方法都使用指针，具体实现由其底层决定。</p>
<p><code>AU_read.setpos</code>(<em>pos</em>)</p>
<p>Set the file pointer to the specified position. Only values returned from <code>tell()</code> should be used for <em>pos</em>.</p>
<p><code>AU_read.tell</code>()</p>
<p>Return current file pointer position. Note that the returned value has nothing to do with the actual position in the file.</p>
<p>The following two functions are defined for compatibility with the <code>aifc</code>, and don’t do anything interesting.</p>
<p><code>AU_read.getmarkers</code>()</p>
<p>返回 <code>None</code>。</p>
<p><code>AU_read.getmark</code>(<em>id</em>)</p>
<p>引发错误异常。</p>
<h3 id="AU-write-对象"><a href="#AU-write-对象" class="headerlink" title="AU_write 对象"></a>AU_write 对象</h3><p>AU_write objects, as returned by <code>open()</code> above, have the following methods:</p>
<p><code>AU_write.setnchannels</code>(<em>n</em>)</p>
<p>设置声道数。</p>
<p><code>AU_write.setsampwidth</code>(<em>n</em>)</p>
<p>Set the sample width (in bytes.)</p>
<p>在 3.4 版更改: Added support for 24-bit samples.</p>
<p><code>AU_write.setframerate</code>(<em>n</em>)</p>
<p>Set the frame rate.</p>
<p><code>AU_write.setnframes</code>(<em>n</em>)</p>
<p>Set the number of frames. This can be later changed, when and if more frames are written.</p>
<p><code>AU_write.setcomptype</code>(<em>type</em>, <em>name</em>)</p>
<p>Set the compression type and description. Only <code>'NONE'</code> and <code>'ULAW'</code> are supported on output.</p>
<p><code>AU_write.setparams</code>(<em>tuple</em>)</p>
<p>The <em>tuple</em> should be <code>(nchannels, sampwidth, framerate, nframes, comptype, compname)</code>, with values valid for the <code>set*()</code> methods. Set all parameters.</p>
<p><code>AU_write.tell</code>()</p>
<p>Return current position in the file, with the same disclaimer for the <code>AU_read.tell()</code> and <code>AU_read.setpos()</code> methods.</p>
<p><code>AU_write.writeframesraw</code>(<em>data</em>)</p>
<p>写入音频数据但不更新 <em>nframes</em>。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p><code>AU_write.writeframes</code>(<em>data</em>)</p>
<p>写入音频数据并更新 <em>nframes</em>。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p><code>AU_write.close</code>()</p>
<p>Make sure <em>nframes</em> is correct, and close the file.</p>
<p>This method is called upon deletion.</p>
<p>Note that it is invalid to set any parameters after calling <code>writeframes()</code> or <code>writeframesraw()</code>.</p>
<h2 id="wave-—-读写WAV格式文件"><a href="#wave-—-读写WAV格式文件" class="headerlink" title="wave —- 读写WAV格式文件"></a><code>wave</code> —- 读写WAV格式文件</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/wave.py" target="_blank" rel="noopener">Lib/wave.py</a></p>
<hr>
<p><code>wave</code> 模块提供了一个处理 WAV 声音格式的便利接口。它不支持压缩/解压，但是支持单声道/立体声。</p>
<p><code>wave</code> 模块定义了以下函数和异常:</p>
<p><code>wave.open</code>(<em>file</em>, <em>mode=None</em>)</p>
<p>如果 <em>file</em> 是一个字符串，打开对应文件名的文件。否则就把它作为文件类对象来处理。<em>mode</em> 可以为以下值：</p>
<ul>
<li><p><code>'rb'</code></p>
<p>只读模式。</p>
<p><code>'wb'</code></p>
<p>只写模式。</p>
</li>
</ul>
<p>注意不支持同时读写WAV文件。</p>
<p><em>mode</em> 设为 <code>'rb'</code> 时返回一个 <code>Wave_read</code> 对象，而 <em>mode</em> 设为 <code>'wb'</code> 时返回一个 <code>Wave_write</code> 对象。如果省略 <em>mode</em> 并指定 <em>file</em> 来传入一个文件类对象，则 <code>file.mode</code> 会被用作 <em>mode</em> 的默认值。</p>
<p>如果操作的是文件对象，当使用 wave 对象的 <code>close()</code> 方法时，并不会真正关闭文件对象，这需要调用者负责来关闭文件对象。</p>
<p><code>open()</code> 函数可以在 <code>with</code> 语句中使用。 当 <code>with</code> 阻塞结束时，<code>Wave_read.close()</code> 或 <code>Wave_write.close()</code> 方法会被调用。</p>
<p>在 3.4 版更改: 添加了对不可搜索文件的支持。</p>
<p><em>exception</em> <code>wave.Error</code></p>
<p>当不符合WAV格式或无法操作时引发的错误。</p>
<h3 id="Wave-read对象"><a href="#Wave-read对象" class="headerlink" title="Wave_read对象"></a>Wave_read对象</h3><p>由 <code>open()</code> 返回的 Wave_read 对象，有以下几种方法:</p>
<p><code>Wave_read.close</code>()</p>
<p>关闭 <code>wave</code> 打开的数据流并使对象不可用。当对象销毁时会自动调用。</p>
<p><code>Wave_read.getnchannels</code>()</p>
<p>返回声道数量（<code>1</code> 为单声道，<code>2</code> 为立体声）</p>
<p><code>Wave_read.getsampwidth</code>()</p>
<p>返回采样字节长度。</p>
<p><code>Wave_read.getframerate</code>()</p>
<p>返回采样频率。</p>
<p><code>Wave_read.getnframes</code>()</p>
<p>返回音频总帧数。</p>
<p><code>Wave_read.getcomptype</code>()</p>
<p>返回压缩类型（只支持 <code>'NONE'</code> 类型）</p>
<p><code>Wave_read.getcompname</code>()</p>
<p><code>getcomptype()</code> 的通俗版本。使用 <code>'not compressed'</code> 代替 <code>'NONE'</code>。</p>
<p><code>Wave_read.getparams</code>()</p>
<p>返回一个 <code>namedtuple()</code> <code>(nchannels, sampwidth, framerate, nframes, comptype, compname)</code>，与 <code>get*()</code> 方法的输出相同。</p>
<p><code>Wave_read.readframes</code>(<em>n</em>)</p>
<p>读取并返回以 <code>bytes</code> 对象表示的最多 <em>n</em> 帧音频。</p>
<p><code>Wave_read.rewind</code>()</p>
<p>重置文件指针至音频开头.</p>
<p>后面两个方法是为了和 <code>aifc</code> 保持兼容，实际不做任何事情。</p>
<p><code>Wave_read.getmarkers</code>()</p>
<p>返回 <code>None</code>。</p>
<p><code>Wave_read.getmark</code>(<em>id</em>)</p>
<p>引发错误异常。</p>
<p>以下两个方法都使用指针，具体实现由其底层决定。</p>
<p><code>Wave_read.setpos</code>(<em>pos</em>)</p>
<p>设置文件指针到指定位置。</p>
<p><code>Wave_read.tell</code>()</p>
<p>返回当前文件指针位置。</p>
<h3 id="Wave-write-对象"><a href="#Wave-write-对象" class="headerlink" title="Wave_write 对象"></a>Wave_write 对象</h3><p>对于可查找的输出流，<code>wave</code> 头将自动更新以反映实际写入的帧数。 对于不可查找的流，当写入第一帧时 <em>nframes</em> 值必须准确。 获取准确的 <em>nframes</em> 值可以通过调用 <code>setnframes()</code> 或 <code>setparams()</code> 并附带 <code>close()</code> 被调用之前将要写入的帧数，然后使用 <code>writeframesraw()</code> 来写入帧数据，或者通过调用 <code>writeframes()</code> 并附带所有要写入的帧。 在后一种情况下 <code>writeframes()</code> 将计算数据中的帧数并在写入帧数据之前相应地设置 <em>nframes</em>。</p>
<p>由 <code>open()</code> 返回的 Wave_write 对象，有以下几种方法:</p>
<p>在 3.4 版更改: 添加了对不可搜索文件的支持。</p>
<p><code>Wave_write.close</code>()</p>
<p>确保 <em>nframes</em> 是正确的，并在文件被 <code>wave</code> 打开时关闭它。 此方法会在对象收集时被调用。 如果输出流不可查找且 <em>nframes</em> 与实际写入的帧数不匹配时引发异常。</p>
<p><code>Wave_write.setnchannels</code>(<em>n</em>)</p>
<p>设置声道数。</p>
<p><code>Wave_write.setsampwidth</code>(<em>n</em>)</p>
<p>设置采样字节长度为 <em>n</em>。</p>
<p><code>Wave_write.setframerate</code>(<em>n</em>)</p>
<p>设置采样频率为 <em>n</em>。</p>
<p>在 3.2 版更改: 对此方法的非整数输入会被舍入到最接近的整数。</p>
<p><code>Wave_write.setnframes</code>(<em>n</em>)</p>
<p>设置总帧数为 <em>n</em>。 如果与之后实际写入的帧数不一致此值将会被更改（ 如果输出流不可查找则此更改尝试将引发错误）。</p>
<p><code>Wave_write.setcomptype</code>(<em>type</em>, <em>name</em>)</p>
<p>设置压缩格式。目前只支持 <code>NONE</code> 即无压缩格式。</p>
<p><code>Wave_write.setparams</code>(<em>tuple</em>)</p>
<p><em>tuple</em> 应该是 <code>(nchannels, sampwidth, framerate, nframes, comptype, compname)</code>，每项的值应可用于 <code>set*()</code> 方法。设置所有形参。</p>
<p><code>Wave_write.tell</code>()</p>
<p>返回当前文件指针，其指针含义和 <code>Wave_read.tell()</code> 以及 <code>Wave_read.setpos()</code> 是一致的。</p>
<p><code>Wave_write.writeframesraw</code>(<em>data</em>)</p>
<p>写入音频数据但不更新 <em>nframes</em>。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p><code>Wave_write.writeframes</code>(<em>data</em>)</p>
<p>写入音频帧并确保 <em>nframes</em> 是正确的。 如果输出流不可查找且在 <em>data</em> 被写入之后写入的总帧数与之前设定的has been written does not match the previously set value for <em>nframes</em> 值不匹配将会引发错误。</p>
<p>在 3.4 版更改: 现在可接受任意 bytes-like object。</p>
<p>注意在调用 <code>writeframes()</code> 或 <code>writeframesraw()</code> 之后再设置任何格式参数是无效的，而且任何这样的尝试将引发 <code>wave.Error</code>。</p>
<h2 id="chunk-—-读取-IFF-分块数据"><a href="#chunk-—-读取-IFF-分块数据" class="headerlink" title="chunk —- 读取 IFF 分块数据"></a><code>chunk</code> —- 读取 IFF 分块数据</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/chunk.py" target="_blank" rel="noopener">Lib/chunk.py</a></p>
<hr>
<p>本模块提供了一个读取使用 EA IFF 85 分块的数据的接口chunks. <a href="https://www.bookstack.cn/read/python-3.10.0-zh/5408c4395dda8f4b.md#id2" target="_blank" rel="noopener">1</a> 这种格式使用的场合有 Audio Interchange File Format (AIFF/AIFF-C) 和 Real Media File Format (RMFF) 等。 与它们密切相关的 WAVE 音频文件也可使用此模块来读取。</p>
<p>一个分块具有以下结构:</p>
<table>
<thead>
<tr>
<th align="left">偏移</th>
<th align="left">长度</th>
<th align="left">目录</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">4</td>
<td align="left">区块ID</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">4</td>
<td align="left">大端字节顺序的块大小，不包括头</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><em>n</em></td>
<td align="left">数据字节，其中 <em>n</em> 是前一字段中给出的大小</td>
</tr>
<tr>
<td align="left">8 + <em>n</em></td>
<td align="left">0 或 1</td>
<td align="left">如果 <em>n</em> 为奇数且使用块对齐，则需要填充字节</td>
</tr>
</tbody></table>
<p>ID是一个4字节的字符串，用于标识块的类型。</p>
<p>大小字段（32 位的值，使用大端字节序编码）给出分块数据的大小，不包括 8 字节的标头。</p>
<p>使用由一个或更多分块组成的 IFF 类型文件。 此处定义的 <code>Chunk</code> 类的建议使用方式是在每个分块开始时实例化一个实例并从实例读取直到其末尾，在那之后可以再实例化新的实例。 到达文件末尾时，创建新实例将会失败并引发 <code>EOFError</code> 异常。</p>
<p><em>class</em> <code>chunk.Chunk</code>(<em>file</em>, <em>align=True</em>, <em>bigendian=True</em>, <em>inclheader=False</em>)</p>
<p>代表一个分块的类。 <em>file</em> 参数预期为一个文件类对象。 特别地也允许该类的实例。 唯一必需的方法是 <code>read()</code>。 如果存在 <code>seek()</code> 和 <code>tell()</code> 方法并且没有引发异常，它们也会被使用。 如果存在这些方法并且引发了异常，则它们不应改变目标对象。 如果可选参数 <em>align</em> 为真值，则分块应当以 2 字节边界对齐。 如果 <em>align</em> 为假值，则不使用对齐。 此参数默认为真值。 如果可选参数 <em>bigendian</em> 为假值，分块大小应当为小端序。 这对于 WAVE 音频文件是必须的。 此参数默认为真值。 如果可选参数 <em>inclheader</em> 为真值，则分块标头中给出的大小将包括标头的大小。 此参数默认为假值。</p>
<p><code>Chunk</code> 对象支持下列方法：</p>
<ul>
<li><p><code>getname</code>()</p>
<p>返回分块的名称（ID）。 这是分块的头 4 个字节。</p>
</li>
<li><p><code>getsize</code>()</p>
<p>返回分块的大小。</p>
</li>
<li><p><code>close</code>()</p>
<p>关闭并跳转到分块的末尾。 这不会关闭下层的文件。</p>
</li>
</ul>
<p>在 <code>close()</code> 方法已被调用后其余方法将会引发 <code>OSError</code>。 在 Python 3.3 之前，它们曾会引发 <code>IOError</code>，现在这是 <code>OSError</code> 的一个别名。</p>
<ul>
<li><p><code>isatty</code>()</p>
<p>返回 <code>False</code>。</p>
</li>
<li><p><code>seek</code>(<em>pos</em>, <em>whence=0</em>)</p>
<p>设置分块的当前位置。 <em>whence</em> 参数为可选项并且默认为 <code>0</code> (绝对文件定位)；其他值还有 <code>1</code> (相对当前位置查找) 和 <code>2</code> (相对文件末尾查找)。 没有返回值。 如果下层文件不支持查找，则只允许向前查找。</p>
</li>
<li><p><code>tell</code>()</p>
<p>将当前位置返回到分块。</p>
</li>
<li><p><code>read</code>(<em>size=- 1</em>)</p>
<p>从分块读取至多 <em>size</em> 个字节（如果在获得 <em>size</em> 个字节之前已到达分块末尾则读取的字节会少于此数量）。 如果 <em>size</em> 参数为负值或被省略，则读取所有字节直到分块末尾。 当立即遇到分块末尾则返回空字节串对象。</p>
</li>
<li><p><code>skip</code>()</p>
<p>跳到分块末尾。此后对分块再次调用 <code>read()</code> 将返回 <code>b''</code>。 如果你对分块的内容不感兴趣，则应当调用此方法以使文件指向下一分块的开头。</p>
</li>
</ul>
<h2 id="colorsys-—-颜色系统间的转换"><a href="#colorsys-—-颜色系统间的转换" class="headerlink" title="colorsys —- 颜色系统间的转换"></a><code>colorsys</code> —- 颜色系统间的转换</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/colorsys.py" target="_blank" rel="noopener">Lib/colorsys.py</a></p>
<hr>
<p><code>colorsys</code> 模块定义了计算机显示器所用的 RGB (Red Green Blue) 色彩空间与三种其他色彩坐标系统 YIQ, HLS (Hue Lightness Saturation) 和 HSV (Hue Saturation Value) 表示的颜色值之间的双向转换。 所有这些色彩空间的坐标都使用浮点数值来表示。 在 YIQ 空间中，Y 坐标取值为 0 和 1 之间，而 I 和 Q 坐标均可以为正数或负数。 在所有其他空间中，坐标取值均为 0 和 1 之间。</p>
<p>参见</p>
<p>有关色彩空间的更多信息可访问 <a href="https://poynton.ca/ColorFAQ.html" target="_blank" rel="noopener">https://poynton.ca/ColorFAQ.html</a> 和 <a href="https://www.cambridgeincolour.com/tutorials/color-spaces.htm。" target="_blank" rel="noopener">https://www.cambridgeincolour.com/tutorials/color-spaces.htm。</a></p>
<p><code>colorsys</code> 模块定义了如下函数：</p>
<p><code>colorsys.rgb_to_yiq</code>(<em>r</em>, <em>g</em>, <em>b</em>)</p>
<p>把颜色从RGB值转为YIQ值。</p>
<p><code>colorsys.yiq_to_rgb</code>(<em>y</em>, <em>i</em>, <em>q</em>)</p>
<p>把颜色从YIQ值转为RGB值。</p>
<p><code>colorsys.rgb_to_hls</code>(<em>r</em>, <em>g</em>, <em>b</em>)</p>
<p>把颜色从RGB值转为HLS值。</p>
<p><code>colorsys.hls_to_rgb</code>(<em>h</em>, <em>l</em>, <em>s</em>)</p>
<p>把颜色从HLS值转为RGB值。</p>
<p><code>colorsys.rgb_to_hsv</code>(<em>r</em>, <em>g</em>, <em>b</em>)</p>
<p>把颜色从RGB值转为HSV值。</p>
<p><code>colorsys.hsv_to_rgb</code>(<em>h</em>, <em>s</em>, <em>v</em>)</p>
<p>把颜色从HSV值转为RGB值。</p>
<p>示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> colorsys
<span class="token operator">>></span><span class="token operator">></span> colorsys<span class="token punctuation">.</span>rgb_to_hsv<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> colorsys<span class="token punctuation">.</span>hsv_to_rgb<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="imghdr-—-推测图像类型"><a href="#imghdr-—-推测图像类型" class="headerlink" title="imghdr —- 推测图像类型"></a><code>imghdr</code> —- 推测图像类型</h2><p><strong>源代码</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/imghdr.py" target="_blank" rel="noopener">Lib/imghdr.py</a></p>
<hr>
<p><code>imghdr</code> 模块推测文件或字节流中的图像的类型。</p>
<p><code>imghdr</code> 模块定义了以下类型：</p>
<p><code>imghdr.what</code>(<em>file</em>, <em>h=None</em>)</p>
<p>测试包含在名为 <em>file</em> 的文件中的图像数据，并返回描述该图像类型的字符串。 如果提供了可选的 <em>h</em>，则 <em>file</em> 参数会被忽略并且 <em>h</em> 会被视为包含要测试的字节流。</p>
<p>在 3.6 版更改: 接受一个 path-like object。</p>
<p>接下来的图像类型是可识别的，返回值来自 <code>what()</code>：</p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">图像格式</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>‘rgb’</code></td>
<td align="left">SGI 图像库文件</td>
</tr>
<tr>
<td align="left"><code>‘gif’</code></td>
<td align="left">GIF 87a 和 89a 文件</td>
</tr>
<tr>
<td align="left"><code>‘pbm’</code></td>
<td align="left">便携式位图文件</td>
</tr>
<tr>
<td align="left"><code>‘pgm’</code></td>
<td align="left">便携式灰度图文件</td>
</tr>
<tr>
<td align="left"><code>‘ppm’</code></td>
<td align="left">便携式像素表文件</td>
</tr>
<tr>
<td align="left"><code>‘tiff’</code></td>
<td align="left">TIFF 文件</td>
</tr>
<tr>
<td align="left"><code>‘rast’</code></td>
<td align="left">Sun 光栅文件</td>
</tr>
<tr>
<td align="left"><code>‘xbm’</code></td>
<td align="left">X 位图文件</td>
</tr>
<tr>
<td align="left"><code>‘jpeg’</code></td>
<td align="left">JFIF 或 Exif 格式的 JPEG 数据</td>
</tr>
<tr>
<td align="left"><code>‘bmp’</code></td>
<td align="left">BMP 文件</td>
</tr>
<tr>
<td align="left"><code>‘png’</code></td>
<td align="left">便携式网络图像</td>
</tr>
<tr>
<td align="left"><code>‘webp’</code></td>
<td align="left">WebP 文件</td>
</tr>
<tr>
<td align="left"><code>‘exr’</code></td>
<td align="left">OpenEXR 文件</td>
</tr>
</tbody></table>
<p>3.5 新版功能: <em>exr</em> 和 <em>webp</em> 格式被添加。</p>
<p>你可以扩展此 <code>imghdr</code> 可以被追加的这个变量识别的文件格式的列表：</p>
<pre><code>imghdr.tests</code></pre><p>执行单个测试的函数列表。每个函数都有两个参数：字节流和类似开放文件的对象。当 <code>what()</code> 用字节流调用时，类文件对象将是 <code>None</code>。</p>
<p>如果测试成功，这个测试函数应当返回一个描述图像类型的字符串，否则返回 <code>None</code>。</p>
<p>示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> imghdr
<span class="token operator">>></span><span class="token operator">></span> imghdr<span class="token punctuation">.</span>what<span class="token punctuation">(</span><span class="token string">'bass.gif'</span><span class="token punctuation">)</span>
<span class="token string">'gif'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="sndhdr-—-推测声音文件的类型"><a href="#sndhdr-—-推测声音文件的类型" class="headerlink" title="sndhdr —- 推测声音文件的类型"></a><code>sndhdr</code> —- 推测声音文件的类型</h2><p><strong>源代码</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/sndhdr.py" target="_blank" rel="noopener">Lib/sndhdr.py</a></p>
<hr>
<p><code>sndhdr</code> 提供了企图猜测文件中的声音数据类型的功能函数。当这些函数可以推测出存储在文件中的声音数据的类型是，它们返回一个 <code>collections.namedtuple()</code>，包含了五种属性：（<code>filetype</code>, <code>framerate</code>, <code>nchannels</code>, <code>nframes</code>, <code>sampwidth</code>）。这些 <em>type</em> 的值表示数据的类型，会是以下字符串之一： <code>'aifc'</code>, <code>'aiff'</code>, <code>'au'</code>, <code>'hcom'</code>, <code>'sndr'</code>, <code>'sndt'</code>, <code>'voc'</code>, <code>'wav'</code>, <code>'8svx'</code>, <code>'sb'</code>, <code>'ub'</code>, or <code>'ul'</code> 。 <em>sampling_rate</em> 可能是实际值或者当未知或者难以解码时的 <code>0</code>。类似的， <em>channels</em> 也会返回实际值或者在无法推测或者难以解码时返回 <code>0</code>。 <em>frames</em> 则是实际值或 <code>-1</code>。 元组的最后一项， <em>bits_per_sample</em> 将会为比特表示的 sample 大小或者 A-LAW 时为 <code>'A'</code>， u-LAW 时为 <code>'U'</code>。</p>
<p><code>sndhdr.what</code>(<em>filename</em>)</p>
<p>使用 <code>whathdr()</code> 推测存储在 <em>filename</em> 文件中的声音数据的类型。如果成功，返回上述的命名元组，否则返回 <code>None</code>。</p>
<p>在 3.5 版更改: 将结果从元组改为命名元组。</p>
<p><code>sndhdr.whathdr</code>(<em>filename</em>)</p>
<p>基于文件头推测存储在文件中的声音数据类型。文件名由 <em>filename</em> 给出。这个函数在成功时返回上述命名元组，或者在失败时返回 <code>None</code>。</p>
<p>在 3.5 版更改: 将结果从元组改为命名元组。</p>
<h2 id="ossaudiodev-—-访问兼容OSS的音频设备"><a href="#ossaudiodev-—-访问兼容OSS的音频设备" class="headerlink" title="ossaudiodev —- 访问兼容OSS的音频设备"></a><code>ossaudiodev</code> —- 访问兼容OSS的音频设备</h2><p>该模块允许您访问 OSS（开放式音响系统）音频接口。 OSS 可用于广泛的开源和商业 Unices，并且是 Linux 和最新版本的 FreeBSD 的标准音频接口。</p>
<p>在 3.3 版更改: 此模块中过去会引发 <code>IOError</code> 的操作现在将引发 <code>OSError</code>。</p>
<p>参见</p>
<p><a href="http://www.opensound.com/pguide/oss.pdf" target="_blank" rel="noopener">开放之声系统程序员手册</a></p>
<p>OSS C API 的官方文档</p>
<p>该模块定义了大量由OSS设备驱动提供的常量； 请参阅<code>&lt;sys/soundcard.h&gt;</code> Linux 或 FreeBSD 上的列表。</p>
<p><code>ossaudiodev</code> defines the following variables and functions:</p>
<p><em>exception</em> <code>ossaudiodev.OSSAudioError</code></p>
<p>This exception is raised on certain errors. The argument is a string describing what went wrong.</p>
<p>(If <code>ossaudiodev</code> receives an error from a system call such as <code>open()</code>, <code>write()</code>, or <code>ioctl()</code>, it raises <code>OSError</code>. Errors detected directly by <code>ossaudiodev</code> result in <code>OSSAudioError</code>.)</p>
<p>(For backwards compatibility, the exception class is also available as <code>ossaudiodev.error</code>.)</p>
<p><code>ossaudiodev.open</code>(<em>mode</em>)</p>
<p><code>ossaudiodev.open</code>(<em>device</em>, <em>mode</em>)</p>
<p>Open an audio device and return an OSS audio device object. This object supports many file-like methods, such as <code>read()</code>, <code>write()</code>, and <code>fileno()</code> (although there are subtle differences between conventional Unix read/write semantics and those of OSS audio devices). It also supports a number of audio-specific methods; see below for the complete list of methods.</p>
<p><em>device</em> is the audio device filename to use. If it is not specified, this module first looks in the environment variable <code>AUDIODEV</code> for a device to use. If not found, it falls back to <code>/dev/dsp</code>.</p>
<p><em>mode</em> is one of <code>'r'</code> for read-only (record) access, <code>'w'</code> for write-only (playback) access and <code>'rw'</code> for both. Since many sound cards only allow one process to have the recorder or player open at a time, it is a good idea to open the device only for the activity needed. Further, some sound cards are half-duplex: they can be opened for reading or writing, but not both at once.</p>
<p>Note the unusual calling syntax: the <em>first</em> argument is optional, and the second is required. This is a historical artifact for compatibility with the older <code>linuxaudiodev</code> module which <code>ossaudiodev</code> supersedes.</p>
<p><code>ossaudiodev.openmixer</code>([<em>device</em>])</p>
<p>Open a mixer device and return an OSS mixer device object. <em>device</em> is the mixer device filename to use. If it is not specified, this module first looks in the environment variable <code>MIXERDEV</code> for a device to use. If not found, it falls back to <code>/dev/mixer</code>.</p>
<h3 id="Audio-Device-Objects"><a href="#Audio-Device-Objects" class="headerlink" title="Audio Device Objects"></a>Audio Device Objects</h3><p>Before you can write to or read from an audio device, you must call three methods in the correct order:</p>
<ol>
<li><code>setfmt()</code> to set the output format</li>
<li><code>channels()</code> to set the number of channels</li>
<li><code>speed()</code> to set the sample rate</li>
</ol>
<p>Alternately, you can use the <code>setparameters()</code> method to set all three audio parameters at once. This is more convenient, but may not be as flexible in all cases.</p>
<p>The audio device objects returned by <code>open()</code> define the following methods and (read-only) attributes:</p>
<p><code>oss_audio_device.close</code>()</p>
<p>Explicitly close the audio device. When you are done writing to or reading from an audio device, you should explicitly close it. A closed device cannot be used again.</p>
<p><code>oss_audio_device.fileno</code>()</p>
<p>Return the file descriptor associated with the device.</p>
<p><code>oss_audio_device.read</code>(<em>size</em>)</p>
<p>Read <em>size</em> bytes from the audio input and return them as a Python string. Unlike most Unix device drivers, OSS audio devices in blocking mode (the default) will block <code>read()</code> until the entire requested amount of data is available.</p>
<p><code>oss_audio_device.write</code>(<em>data</em>)</p>
<p>Write a bytes-like object <em>data</em> to the audio device and return the number of bytes written. If the audio device is in blocking mode (the default), the entire data is always written (again, this is different from usual Unix device semantics). If the device is in non-blocking mode, some data may not be written—-see <code>writeall()</code>.</p>
<p>在 3.5 版更改: 现在接受可写的 字节类对象。</p>
<p><code>oss_audio_device.writeall</code>(<em>data</em>)</p>
<p>Write a bytes-like object <em>data</em> to the audio device: waits until the audio device is able to accept data, writes as much data as it will accept, and repeats until <em>data</em> has been completely written. If the device is in blocking mode (the default), this has the same effect as <code>write()</code>; <code>writeall()</code> is only useful in non-blocking mode. Has no return value, since the amount of data written is always equal to the amount of data supplied.</p>
<p>在 3.5 版更改: 现在接受可写的 字节类对象。</p>
<p>在 3.2 版更改: Audio device objects also support the context management protocol, i.e. they can be used in a <code>with</code> statement.</p>
<p>The following methods each map to exactly one <code>ioctl()</code> system call. The correspondence is obvious: for example, <code>setfmt()</code> corresponds to the <code>SNDCTL_DSP_SETFMT</code> ioctl, and <code>sync()</code> to <code>SNDCTL_DSP_SYNC</code> (this can be useful when consulting the OSS documentation). If the underlying <code>ioctl()</code> fails, they all raise <code>OSError</code>.</p>
<p><code>oss_audio_device.nonblock</code>()</p>
<p>Put the device into non-blocking mode. Once in non-blocking mode, there is no way to return it to blocking mode.</p>
<p><code>oss_audio_device.getfmts</code>()</p>
<p>Return a bitmask of the audio output formats supported by the soundcard. Some of the formats supported by OSS are:</p>
<table>
<thead>
<tr>
<th align="left">格式</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>AFMT_MU_LAW</code></td>
<td align="left">a logarithmic encoding (used by Sun <code>.au</code> files and <code>/dev/audio</code>)</td>
</tr>
<tr>
<td align="left"><code>AFMT_A_LAW</code></td>
<td align="left">a logarithmic encoding</td>
</tr>
<tr>
<td align="left"><code>AFMT_IMA_ADPCM</code></td>
<td align="left">a 4:1 compressed format defined by the Interactive Multimedia Association</td>
</tr>
<tr>
<td align="left"><code>AFMT_U8</code></td>
<td align="left">Unsigned, 8-bit audio</td>
</tr>
<tr>
<td align="left"><code>AFMT_S16_LE</code></td>
<td align="left">Signed, 16-bit audio, little-endian byte order (as used by Intel processors)</td>
</tr>
<tr>
<td align="left"><code>AFMT_S16_BE</code></td>
<td align="left">Signed, 16-bit audio, big-endian byte order (as used by 68k, PowerPC, Sparc)</td>
</tr>
<tr>
<td align="left"><code>AFMT_S8</code></td>
<td align="left">Signed, 8 bit audio</td>
</tr>
<tr>
<td align="left"><code>AFMT_U16_LE</code></td>
<td align="left">Unsigned, 16-bit little-endian audio</td>
</tr>
<tr>
<td align="left"><code>AFMT_U16_BE</code></td>
<td align="left">Unsigned, 16-bit big-endian audio</td>
</tr>
</tbody></table>
<p>Consult the OSS documentation for a full list of audio formats, and note that most devices support only a subset of these formats. Some older devices only support <code>AFMT_U8</code>; the most common format used today is <code>AFMT_S16_LE</code>.</p>
<p><code>oss_audio_device.setfmt</code>(<em>format</em>)</p>
<p>Try to set the current audio format to <em>format</em>-—see <code>getfmts()</code> for a list. Returns the audio format that the device was set to, which may not be the requested format. May also be used to return the current audio format—-do this by passing an “audio format” of <code>AFMT_QUERY</code>.</p>
<p><code>oss_audio_device.channels</code>(<em>nchannels</em>)</p>
<p>Set the number of output channels to <em>nchannels</em>. A value of 1 indicates monophonic sound, 2 stereophonic. Some devices may have more than 2 channels, and some high-end devices may not support mono. Returns the number of channels the device was set to.</p>
<p><code>oss_audio_device.speed</code>(<em>samplerate</em>)</p>
<p>Try to set the audio sampling rate to <em>samplerate</em> samples per second. Returns the rate actually set. Most sound devices don’t support arbitrary sampling rates. Common rates are:</p>
<table>
<thead>
<tr>
<th align="left">采样率</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">8000</td>
<td align="left"><code>/dev/audio</code> 的默认采样率</td>
</tr>
<tr>
<td align="left">11025</td>
<td align="left">语音录音</td>
</tr>
<tr>
<td align="left">22050</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">44100</td>
<td align="left">CD品质的音频（16位采样和2通道）</td>
</tr>
<tr>
<td align="left">96000</td>
<td align="left">DVD品质的音频（24位采样）</td>
</tr>
</tbody></table>
<p><code>oss_audio_device.sync</code>()</p>
<p>Wait until the sound device has played every byte in its buffer. (This happens implicitly when the device is closed.) The OSS documentation recommends closing and re-opening the device rather than using <code>sync()</code>.</p>
<p><code>oss_audio_device.reset</code>()</p>
<p>Immediately stop playing or recording and return the device to a state where it can accept commands. The OSS documentation recommends closing and re-opening the device after calling <code>reset()</code>.</p>
<p><code>oss_audio_device.post</code>()</p>
<p>Tell the driver that there is likely to be a pause in the output, making it possible for the device to handle the pause more intelligently. You might use this after playing a spot sound effect, before waiting for user input, or before doing disk I/O.</p>
<p>The following convenience methods combine several ioctls, or one ioctl and some simple calculations.</p>
<p><code>oss_audio_device.setparameters</code>(<em>format</em>, <em>nchannels</em>, <em>samplerate</em>[, <em>strict=False</em>])</p>
<p>Set the key audio sampling parameters—-sample format, number of channels, and sampling rate—-in one method call. <em>format</em>, <em>nchannels</em>, and <em>samplerate</em> should be as specified in the <code>setfmt()</code>, <code>channels()</code>, and <code>speed()</code> methods. If <em>strict</em> is true, <code>setparameters()</code> checks to see if each parameter was actually set to the requested value, and raises <code>OSSAudioError</code> if not. Returns a tuple (<em>format</em>, <em>nchannels</em>, <em>samplerate</em>) indicating the parameter values that were actually set by the device driver (i.e., the same as the return values of <code>setfmt()</code>, <code>channels()</code>, and <code>speed()</code>).</p>
<p>For example,</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> channels<span class="token punctuation">,</span> rate<span class="token punctuation">)</span> <span class="token operator">=</span> dsp<span class="token punctuation">.</span>setparameters<span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> channels<span class="token punctuation">,</span> rate<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>is equivalent to</p>
<pre class="line-numbers language-python"><code class="language-python">fmt <span class="token operator">=</span> dsp<span class="token punctuation">.</span>setfmt<span class="token punctuation">(</span>fmt<span class="token punctuation">)</span>
channels <span class="token operator">=</span> dsp<span class="token punctuation">.</span>channels<span class="token punctuation">(</span>channels<span class="token punctuation">)</span>
rate <span class="token operator">=</span> dsp<span class="token punctuation">.</span>rate<span class="token punctuation">(</span>rate<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>oss_audio_device.bufsize</code>()</p>
<p>Returns the size of the hardware buffer, in samples.</p>
<p><code>oss_audio_device.obufcount</code>()</p>
<p>Returns the number of samples that are in the hardware buffer yet to be played.</p>
<p><code>oss_audio_device.obuffree</code>()</p>
<p>Returns the number of samples that could be queued into the hardware buffer to be played without blocking.</p>
<p>Audio device objects also support several read-only attributes:</p>
<pre><code>oss_audio_device.closed</code></pre><p>Boolean indicating whether the device has been closed.</p>
<pre><code>oss_audio_device.name</code></pre><p>String containing the name of the device file.</p>
<pre><code>oss_audio_device.mode</code></pre><p>The I/O mode for the file, either <code>"r"</code>, <code>"rw"</code>, or <code>"w"</code>.</p>
<h3 id="Mixer-Device-Objects"><a href="#Mixer-Device-Objects" class="headerlink" title="Mixer Device Objects"></a>Mixer Device Objects</h3><p>The mixer object provides two file-like methods:</p>
<p><code>oss_mixer_device.close</code>()</p>
<p>This method closes the open mixer device file. Any further attempts to use the mixer after this file is closed will raise an <code>OSError</code>.</p>
<p><code>oss_mixer_device.fileno</code>()</p>
<p>Returns the file handle number of the open mixer device file.</p>
<p>在 3.2 版更改: Mixer objects also support the context management protocol.</p>
<p>The remaining methods are specific to audio mixing:</p>
<p><code>oss_mixer_device.controls</code>()</p>
<p>This method returns a bitmask specifying the available mixer controls (“Control” being a specific mixable “channel”, such as <code>SOUND_MIXER_PCM</code> or <code>SOUND_MIXER_SYNTH</code>). This bitmask indicates a subset of all available mixer controls—-the <code>SOUND_MIXER_*</code> constants defined at module level. To determine if, for example, the current mixer object supports a PCM mixer, use the following Python code:</p>
<pre class="line-numbers language-python"><code class="language-python">mixer<span class="token operator">=</span>ossaudiodev<span class="token punctuation">.</span>openmixer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> mixer<span class="token punctuation">.</span>controls<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ossaudiodev<span class="token punctuation">.</span>SOUND_MIXER_PCM<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># PCM is supported</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> code <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>For most purposes, the <code>SOUND_MIXER_VOLUME</code> (master volume) and <code>SOUND_MIXER_PCM</code> controls should suffice—-but code that uses the mixer should be flexible when it comes to choosing mixer controls. On the Gravis Ultrasound, for example, <code>SOUND_MIXER_VOLUME</code> does not exist.</p>
<p><code>oss_mixer_device.stereocontrols</code>()</p>
<p>Returns a bitmask indicating stereo mixer controls. If a bit is set, the corresponding control is stereo; if it is unset, the control is either monophonic or not supported by the mixer (use in combination with <code>controls()</code> to determine which).</p>
<p>See the code example for the <code>controls()</code> function for an example of getting data from a bitmask.</p>
<p><code>oss_mixer_device.reccontrols</code>()</p>
<p>Returns a bitmask specifying the mixer controls that may be used to record. See the code example for <code>controls()</code> for an example of reading from a bitmask.</p>
<p><code>oss_mixer_device.get</code>(<em>control</em>)</p>
<p>Returns the volume of a given mixer control. The returned volume is a 2-tuple <code>(left_volume,right_volume)</code>. Volumes are specified as numbers from 0 (silent) to 100 (full volume). If the control is monophonic, a 2-tuple is still returned, but both volumes are the same.</p>
<p>Raises <code>OSSAudioError</code> if an invalid control is specified, or <code>OSError</code> if an unsupported control is specified.</p>
<p><code>oss_mixer_device.set</code>(<em>control</em>, <em>(left</em>, <em>right)</em>)</p>
<p>Sets the volume for a given mixer control to <code>(left,right)</code>. <code>left</code> and <code>right</code> must be ints and between 0 (silent) and 100 (full volume). On success, the new volume is returned as a 2-tuple. Note that this may not be exactly the same as the volume specified, because of the limited resolution of some soundcard’s mixers.</p>
<p>Raises <code>OSSAudioError</code> if an invalid mixer control was specified, or if the specified volumes were out-of-range.</p>
<p><code>oss_mixer_device.get_recsrc</code>()</p>
<p>This method returns a bitmask indicating which control(s) are currently being used as a recording source.</p>
<p><code>oss_mixer_device.set_recsrc</code>(<em>bitmask</em>)</p>
<p>Call this function to specify a recording source. Returns a bitmask indicating the new recording source (or sources) if successful; raises <code>OSError</code> if an invalid source was specified. To set the current recording source to the microphone input:</p>
<pre class="line-numbers language-python"><code class="language-python">mixer<span class="token punctuation">.</span>setrecsrc <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ossaudiodev<span class="token punctuation">.</span>SOUND_MIXER_MIC<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h1><p>本章中描述的模块列表是：</p>
<ul>
<li><code>gettext</code> —- 多语种国际化服务<ul>
<li>GNU <strong>gettext</strong> API</li>
<li>基于类的 API<ul>
<li><code>NullTranslations</code> 类</li>
<li><code>GNUTranslations</code> 类</li>
<li>Solaris 消息编目支持</li>
<li>编目构造器</li>
</ul>
</li>
<li>国际化 (I18N) 你的程序和模块<ul>
<li>本地化你的模块</li>
<li>本地化你的应用程序</li>
<li>即时更改语言</li>
<li>延迟翻译</li>
</ul>
</li>
</ul>
</li>
<li><code>locale</code> —- 国际化服务<ul>
<li>Background, details, hints, tips and caveats</li>
<li>For extension writers and programs that embed Python</li>
<li>Access to message catalogs</li>
</ul>
</li>
</ul>
<h2 id="gettext-—-多语种国际化服务"><a href="#gettext-—-多语种国际化服务" class="headerlink" title="gettext —- 多语种国际化服务"></a><code>gettext</code> —- 多语种国际化服务</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/gettext.py" target="_blank" rel="noopener">Lib/gettext.py</a></p>
<hr>
<p><code>gettext</code> 模块为 Python 模块和应用程序提供国际化 (Internationalization, I18N) 和本地化 (Localization, L10N) 服务。它同时支持 GNU <strong>gettext</strong> 消息编目 API 和更高级的、基于类的 API，后者可能更适合于 Python 文件。下方描述的接口允许用户使用一种自然语言编写模块和应用程序消息，并提供翻译后的消息编目，以便在不同的自然语言下运行。</p>
<p>同时还给出一些本地化 Python 模块及应用程序的小技巧。</p>
<h3 id="GNU-gettext-API"><a href="#GNU-gettext-API" class="headerlink" title="GNU gettext API"></a>GNU <strong>gettext</strong> API</h3><p>模块 <code>gettext</code> 定义了下列 API，这与 <strong>gettext</strong> API 类似。如果你使用该 API，将会对整个应用程序产生全局的影响。如果你的应用程序支持多语种，而语言选择取决于用户的语言环境设置，这通常正是你所想要的。而如果你正在本地化某个 Python 模块，或者你的应用程序需要在运行时切换语言，相反你或许想用基于类的API。</p>
<p><code>gettext.bindtextdomain</code>(<em>domain</em>, <em>localedir=None</em>)</p>
<p>将 <em>domain</em> 绑定到本地目录 <em>localedir<em>。 更具体地来说，模块 <code>gettext</code> 将使用路径 (在 Unix 系统中): `</em>localedir</em>/<em>language</em>/LC_MESSAGES/<em>domain</em>.mo<code>查找二进制</code>.mo<code>文件，此处对应地查找 *language* 的位置是环境变量</code>LANGUAGE<code>,</code>LC_ALL<code>,</code>LC_MESSAGES<code>和</code>LANG` 中。</p>
<p>如果遗漏了 <em>localedir</em> 或者设置为 <code>None</code>，那么将返回当前 <em>domain</em> 所绑定的值</p>
<p><code>gettext.bind_textdomain_codeset</code>(<em>domain</em>, <em>codeset=None</em>)</p>
<p>将 <em>domain</em> 绑定到 <em>codeset</em>，修改 <code>lgettext()</code>, <code>ldgettext()</code>, <code>lngettext()</code> 和 <code>ldngettext()</code> 函数返回的字节串的字符编码。如果省略了 <em>codeset</em>，则返回当前绑定的编码集。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
<p><code>gettext.textdomain</code>(<em>domain=None</em>)</p>
<p>修改或查询当前的全局域。如果 <em>domain</em> 为 <code>None</code>，则返回当前的全局域，不为 <code>None</code> 则将全局域设置为 <em>domain</em>，并返回它。</p>
<p><code>gettext.gettext</code>(<em>message</em>)</p>
<p>返回 <em>message</em> 的本地化翻译，依据包括当前的全局域、语言和语言环境目录。本函数在本地命名空间中通常有别名 <code>_()</code> （参考下面的示例）。</p>
<p><code>gettext.dgettext</code>(<em>domain</em>, <em>message</em>)</p>
<p>与 <code>gettext()</code> 类似，但在指定的 <em>domain</em> 中查找 message。</p>
<p><code>gettext.ngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与 <code>gettext()</code> 类似，但考虑了复数形式。如果找到了翻译，则将 <em>n</em> 代入复数公式，然后返回得出的消息（某些语言具有两种以上的复数形式）。如果未找到翻译，则 <em>n</em> 为 1 时返回 <em>singular</em>，为其他数时返回 <em>plural</em>。</p>
<p>复数公式取自编目头文件。它是 C 或 Python 表达式，有一个自变量 <em>n</em>，该表达式计算的是所需复数形式在编目中的索引号。关于在 <code>.po</code> 文件中使用的确切语法和各种语言的公式。</p>
<p><code>gettext.dngettext</code>(<em>domain</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与 <code>ngettext()</code> 类似，但在指定的 <em>domain</em> 中查找 message。</p>
<p><code>gettext.pgettext</code>(<em>context</em>, <em>message</em>)</p>
<p><code>gettext.dpgettext</code>(<em>domain</em>, <em>context</em>, <em>message</em>)</p>
<p><code>gettext.npgettext</code>(<em>context</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p><code>gettext.dnpgettext</code>(<em>domain</em>, <em>context</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与前缀中没有 <code>p</code> 的相应函数类似（即 <code>gettext()</code>, <code>dgettext()</code>, <code>ngettext()</code>, <code>dngettext()</code> ），但是仅翻译给定的 message <em>context</em>。</p>
<p>3.8 新版功能.</p>
<p><code>gettext.lgettext</code>(<em>message</em>)</p>
<p><code>gettext.ldgettext</code>(<em>domain</em>, <em>message</em>)</p>
<p><code>gettext.lngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p><code>gettext.ldngettext</code>(<em>domain</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与前缀中没有 <code>l</code> 的相应函数等效（ <code>gettext()</code>, <code>dgettext()</code>, <code>ngettext()</code> 和 <code>dngettext()</code> ），但是如果没有用 <code>bind_textdomain_codeset()</code> 显式设置其他编码，则返回的翻译将以首选系统编码来编码字节串。</p>
<p>警告</p>
<p>在 Python 3 中应避免使用这些函数，因为它们返回的是编码后的字节串。最好使用返回 Unicode 字符串的其他方法，因为大多数 Python 应用程序都希望将人类可读的文本作为字符串而不是字节来处理。此外，如果翻译后的字符串存在编码问题，则可能会意外出现与 Unicode 相关的异常。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
<p>注意，GNU <strong>gettext</strong> 还定义了 <code>dcgettext()</code> 方法，但它被认为不实用，因此目前没有实现它。</p>
<p>这是该 API 的典型用法示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
gettext<span class="token punctuation">.</span>bindtextdomain<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/my/language/directory'</span><span class="token punctuation">)</span>
gettext<span class="token punctuation">.</span>textdomain<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">)</span>
_ <span class="token operator">=</span> gettext<span class="token punctuation">.</span>gettext
<span class="token comment" spellcheck="true"># ...</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">'This is a translatable string.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="基于类的-API"><a href="#基于类的-API" class="headerlink" title="基于类的 API"></a>基于类的 API</h3><p>与 GNU <strong>gettext</strong> API 相比，<code>gettext</code> 模块的基于类的 API 提供了更多的灵活性和更强的便利性。这是本地化 Python 应用程序和模块的推荐方法。<code>gettext</code> 定义了一个 <code>GNUTranslations</code> 类，该类实现了 GNU <code>.mo</code> 格式文件的解析，并且具有用于返回字符串的方法。本类的实例也可以将自身作为函数 <code>_()</code> 安装到内建命名空间中。</p>
<p><code>gettext.find</code>(<em>domain</em>, <em>localedir=None</em>, <em>languages=None</em>, <em>all=False</em>)</p>
<p>本函数实现了标准的 <code>.mo</code> 文件搜索算法。它接受一个 <em>domain*，它与 <code>textdomain()</code> 接受的域相同。可选参数 *localedir</em> 与 <code>bindtextdomain()</code> 中的相同。可选参数 <em>languages</em> 是多条字符串的列表，其中每条字符串都是一种语言代码。</p>
<p>如果没有传入 <em>localedir<em>，则使用默认的系统语言环境目录。如果没有传入 *languages</em>，则搜索以下环境变量：<code>LANGUAGE</code>、<code>LC_ALL</code>、<code>LC_MESSAGES</code> 和 <code>LANG</code>。从这些变量返回的第一个非空值将用作 *languages</em> 变量。环境变量应包含一个语言列表，由冒号分隔，该列表会被按冒号拆分，以产生所需的语言代码字符串列表。</p>
<p><code>find()</code> 将扩展并规范化 language，然后遍历它们，搜索由这些组件构建的现有文件:</p>
<pre><code>*localedir*/*language*/LC_MESSAGES/*domain*.mo</code></pre><p><code>find()</code> 返回找到类似的第一个文件名。如果找不到这样的文件，则返回 <code>None</code>。如果传入了 <em>all</em>，它将返回一个列表，包含所有文件名，并按它们在语言列表或环境变量中出现的顺序排列。</p>
<p><code>gettext.translation</code>(<em>domain</em>, <em>localedir=None</em>, <em>languages=None</em>, <em>class_=None</em>, <em>fallback=False</em>, <em>codeset=None</em>)</p>
<p>根据 <em>domain<em>、</em>localedir</em> 和 <em>languages</em>，返回 <code>*Translations</code> 实例，首先应将前述参数传入 <code>find()</code> 以获取关联的 <code>.mo</code> 文件路径的列表。名字与 <code>.mo</code> 文件名相同的实例将被缓存。如果传入 <em>class_</em>，它将是实际被实例化的类，否则实例化 <code>GNUTranslations</code>。类的构造函数必须只接受一个 文件对象 参数。如果传入 <em>codeset</em>，那么在 <code>lgettext()</code> 和 <code>lngettext()</code> 方法中，对翻译后的字符串进行编码的字符集将被改变。</p>
<p>如果找到多个文件，后找到的文件将用作先前文件的替补。为了设置替补，将使用 <code>copy.copy()</code> 从缓存中克隆每个 translation 对象。实际的实例数据仍在缓存中共享。</p>
<p>如果 <code>.mo</code> 文件未找到，且 <em>fallback</em> 为 false（默认值），则本函数引发 <code>OSError</code> 异常，如果 <em>fallback</em> 为 true，则返回一个 <code>NullTranslations</code> 实例。</p>
<p>在 3.3 版更改: 曾经是 <code>IOError</code> 被引发而不是 <code>OSError</code> 。</p>
<p>Deprecated since version 3.8, removed in version 3.10: <em>codeset</em> 参数。</p>
<p><code>gettext.install</code>(<em>domain</em>, <em>localedir=None</em>, <em>codeset=None</em>, <em>names=None</em>)</p>
<p>根据传入 <code>translation()</code> 函数的 <em>domain<em>、</em>localedir</em> 和 <em>codeset</em>，在 Python 内建命名空间中安装 <code>_()</code> 函数。</p>
<p><em>names</em> 参数的信息请参阅 translation 对象的 <code>install()</code> 方法的描述。</p>
<p>如下所示，通常将字符串包括在 <code>_()</code> 函数的调用中，以标记应用程序中待翻译的字符串，就像这样:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">'This string will be translated.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>为了方便，一般将 <code>_()</code> 函数安装在 Python 内建命名空间中，以便在应用程序的所有模块中轻松访问它。</p>
<p>Deprecated since version 3.8, removed in version 3.10: <em>codeset</em> 参数。</p>
<h4 id="NullTranslations-类"><a href="#NullTranslations-类" class="headerlink" title="NullTranslations 类"></a><code>NullTranslations</code> 类</h4><p>translation 类实际实现的是，将原始源文件消息字符串转换为已翻译的消息字符串。所有 translation 类使用的基类为 <code>NullTranslations</code>，它提供了基本的接口，可用于编写自己定制的 translation 类。以下是 <code>NullTranslations</code> 的方法：</p>
<p><em>class</em> <code>gettext.NullTranslations</code>(<em>fp=None</em>)</p>
<p>接受一个可选参数 文件对象 <em>fp*，该参数会被基类忽略。初始化由派生类设置的 “protected” （受保护的）实例变量 *_info</em> 和 <em>_charset*，与 *_fallback</em> 类似，但它是通过 <code>add_fallback()</code> 来设置的。如果 <em>fp</em> 不为 <code>None</code>，就会调用 <code>self._parse(fp)</code>。</p>
<ul>
<li><p><code>_parse</code>(<em>fp</em>)</p>
<p>在基类中没有操作，本方法接受文件对象 <em>fp</em>，从该文件读取数据，用来初始化消息编目。如果你手头的消息编目文件的格式不受支持，则应重写本方法来解析你的格式。</p>
</li>
<li><p><code>add_fallback</code>(<em>fallback</em>)</p>
<p>添加 <em>fallback</em> 为当前 translation 对象的替补对象。如果 translation 对象无法为指定消息提供翻译，则应向替补查询。</p>
</li>
<li><p><code>gettext</code>(<em>message</em>)</p>
<p>如果设置了替补，则转发 <code>gettext()</code> 给替补。否则返回 <em>message</em>。在派生类中被重写。</p>
</li>
<li><p><code>ngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>如果设置了替补，则转发 <code>ngettext()</code> 给替补。否则，<em>n</em> 为 1 时返回 <em>singular</em>，为其他时返回 <em>plural</em>。在派生类中被重写。</p>
</li>
<li><p><code>pgettext</code>(<em>context</em>, <em>message</em>)</p>
<p>如果设置了替补，则转发 <code>pgettext()</code> 给替补。否则返回已翻译的消息。在派生类中被重写。</p>
<p>3.8 新版功能.</p>
</li>
<li><p><code>npgettext</code>(<em>context</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>如果设置了替补，则转发 <code>npgettext()</code> 给替补。否则返回已翻译的消息。在派生类中被重写。</p>
<p>3.8 新版功能.</p>
</li>
<li><p><code>lgettext</code>(<em>message</em>)</p>
</li>
<li><p><code>lngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与 <code>gettext()</code> 和 <code>ngettext()</code> 等效，但是如果没有用 <code>set_output_charset()</code> 显式设置编码，则返回的翻译将以首选系统编码来编码字节串。在派生类中被重写。</p>
<p>警告</p>
<p>应避免在 Python 3 中使用这些方法。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
</li>
<li><p><code>info</code>()</p>
<p>返回 “protected”（受保护的） <code>_info</code> 变量，它是一个字典，包含在消息编目文件中找到的元数据。</p>
</li>
<li><p><code>charset</code>()</p>
<p>返回消息编目文件的编码。</p>
</li>
<li><p><code>output_charset</code>()</p>
<p>返回由 <code>lgettext()</code> 和 <code>lngettext()</code> 翻译出的消息的编码。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
</li>
<li><p><code>set_output_charset</code>(<em>charset</em>)</p>
<p>更改翻译出的消息的编码。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
</li>
<li><p><code>install</code>(<em>names=None</em>)</p>
<p>本方法将 <code>gettext()</code> 安装至内建命名空间，并绑定为 <code>_</code>。</p>
<p>如果传入 <em>names</em> 参数，该参数必须是一个序列，包含除 <code>_()</code> 外其他要安装在内建命名空间中的函数的名称。支持的名称有 <code>'gettext'</code>, <code>'ngettext'</code>, <code>'pgettext'</code>, <code>'npgettext'</code>, <code>'lgettext'</code> 和 <code>'lngettext'</code>。</p>
<p>注意，这仅仅是使 <code>_()</code> 函数在应用程序中生效的一种方法，尽管也是最方便的方法。由于它会影响整个应用程序全局，特别是内建命名空间，因此已经本地化的模块不应该安装 <code>_()</code>，而是应该用下列代码使 <code>_()</code> 在各自模块中生效:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
t <span class="token operator">=</span> gettext<span class="token punctuation">.</span>translation<span class="token punctuation">(</span><span class="token string">'mymodule'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
_ <span class="token operator">=</span> t<span class="token punctuation">.</span>gettext<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这只将 <code>_()</code> 放在其模块的全局命名空间中，所以只影响其模块内的调用。</p>
<p>在 3.8 版更改: 添加了 <code>'pgettext'</code> 和 <code>'npgettext'</code>。</p>
</li>
</ul>
<h4 id="GNUTranslations-类"><a href="#GNUTranslations-类" class="headerlink" title="GNUTranslations 类"></a><code>GNUTranslations</code> 类</h4><p><code>gettext</code> 模块提供了一个派生自 <code>NullTranslations</code> 的其他类：<code>GNUTranslations</code>。该类重写了 <code>_parse()</code>，同时能以大端序和小端序格式读取 GNU <strong>gettext</strong> 格式的 <code>.mo</code> 文件。</p>
<p><code>GNUTranslations</code> 从翻译编目中解析出可选的元数据。GNU <strong>gettext</strong> 约定，将元数据包括在空字符串的翻译中。该元数据采用 <a href="https://tools.ietf.org/html/rfc822.html" target="_blank" rel="noopener"><strong>RFC 822</strong></a> 样式的 <code>key: value</code> 键值对，且应该包含 <code>Project-Id-Version</code> 键。如果找到 <code>Content-Type</code> 键，那么将用 <code>charset</code> 属性去初始化 “protected”（受保护的） <code>_charset</code> 实例变量，而该变量在未找到键的情况下默认为 <code>None</code>。如果指定了字符编码，那么从编目中读取的所有消息 ID 和消息字符串都将使用此编码转换为 Unicode，若未指定编码，则假定编码为 ASCII。</p>
<p>由于消息 ID 也是作为 Unicode 字符串读取的，因此所有 <code>*gettext()</code> 方法都假定消息 ID 为 Unicode 字符串，而不是字节串。</p>
<p>整个键/值对集合将被放入一个字典，并设置为 “protected”（受保护的） <code>_info</code> 实例变量。</p>
<p>如果 <code>.mo</code> 文件的魔法值 (magic number) 无效，或遇到意外的主版本号，或在读取文件时发生其他问题，则实例化 <code>GNUTranslations</code> 类会引发 <code>OSError</code>。</p>
<p><em>class</em> <code>gettext.GNUTranslations</code></p>
<p>下列方法是根据基类实现重写的：</p>
<ul>
<li><p><code>gettext</code>(<em>message</em>)</p>
<p>在编目中查找 <em>message</em> ID，并以 Unicode 字符串形式返回相应的消息字符串。如果在编目中没有 <em>message</em> ID 条目，且配置了替补，则查找请求将被转发到替补的 <code>gettext()</code> 方法。否则，返回 <em>message</em> ID。</p>
</li>
<li><p><code>ngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>查找消息 ID 的复数形式。<em>singular</em> 用作消息 ID，用于在编目中查找，同时 <em>n</em> 用于确定使用哪种复数形式。返回的消息字符串是 Unicode 字符串。</p>
<p>如果在编目中没有找到消息 ID，且配置了替补，则查找请求将被转发到替补的 <code>ngettext()</code> 方法。否则，当 <em>n</em> 为 1 时返回 <em>singular</em>，其他情况返回 <em>plural</em>。</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python">n <span class="token operator">=</span> len<span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cat <span class="token operator">=</span> GNUTranslations<span class="token punctuation">(</span>somefile<span class="token punctuation">)</span>
message <span class="token operator">=</span> cat<span class="token punctuation">.</span>ngettext<span class="token punctuation">(</span>
    <span class="token string">'There is %(num)d file in this directory'</span><span class="token punctuation">,</span>
    <span class="token string">'There are %(num)d files in this directory'</span><span class="token punctuation">,</span>
    n<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">'num'</span><span class="token punctuation">:</span> n<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>pgettext</code>(<em>context</em>, <em>message</em>)</p>
<p>在编目中查找 <em>context</em> 和 <em>message</em> ID，并以 Unicode 字符串形式返回相应的消息字符串。如果在编目中没有 <em>message</em> ID 和 <em>context</em> 条目，且配置了替补，则查找请求将被转发到替补的 <code>pgettext()</code> 方法。否则，返回 <em>message</em> ID。</p>
<p>3.8 新版功能.</p>
</li>
<li><p><code>npgettext</code>(<em>context</em>, <em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>查找消息 ID 的复数形式。<em>singular</em> 用作消息 ID，用于在编目中查找，同时 <em>n</em> 用于确定使用哪种复数形式。</p>
<p>如果在编目中没有找到 <em>context</em> 对应的消息 ID，且配置了替补，则查找请求将被转发到替补的 <code>npgettext()</code> 方法。否则，当 <em>n</em> 为 1 时返回 <em>singular</em>，其他情况返回 <em>plural</em>。</p>
<p>3.8 新版功能.</p>
</li>
<li><p><code>lgettext</code>(<em>message</em>)</p>
</li>
<li><p><code>lngettext</code>(<em>singular</em>, <em>plural</em>, <em>n</em>)</p>
<p>与 <code>gettext()</code> 和 <code>ngettext()</code> 等效，但是如果没有用 <code>set_output_charset()</code> 显式设置编码，则返回的翻译将以首选系统编码来编码字节串。</p>
<p>警告</p>
<p>应避免在 Python 3 中使用这些方法。</p>
<p>Deprecated since version 3.8, removed in version 3.10.</p>
</li>
</ul>
<h4 id="Solaris-消息编目支持"><a href="#Solaris-消息编目支持" class="headerlink" title="Solaris 消息编目支持"></a>Solaris 消息编目支持</h4><p>Solaris 操作系统定义了自己的二进制 <code>.mo</code> 文件格式，但由于找不到该格式的文档，因此目前不支持该格式。</p>
<h4 id="编目构造器"><a href="#编目构造器" class="headerlink" title="编目构造器"></a>编目构造器</h4><p>GNOME 用的 <code>gettext</code> 模块是 James Henstridge 写的版本，但该版本的 API 略有不同。它文档中的用法是:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
cat <span class="token operator">=</span> gettext<span class="token punctuation">.</span>Catalog<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> localedir<span class="token punctuation">)</span>
_ <span class="token operator">=</span> cat<span class="token punctuation">.</span>gettext
<span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了与本模块的旧版本兼容，<code>Catalog()</code> 函数是上述 <code>translation()</code> 函数的别名。</p>
<p>本模块与 Henstridge 的模块有一个区别：他的编目对象支持通过映射 API 进行访问，但是该特性似乎从未使用过，因此目前不支持该特性。</p>
<h3 id="国际化-I18N-你的程序和模块"><a href="#国际化-I18N-你的程序和模块" class="headerlink" title="国际化 (I18N) 你的程序和模块"></a>国际化 (I18N) 你的程序和模块</h3><p>国际化 (I18N) 是指使程序可切换多种语言的操作。本地化 (L10N) 是指程序的适配能力，一旦程序被国际化，就能适配当地的语言和文化习惯。为了向 Python 程序提供不同语言的消息，需要执行以下步骤：</p>
<ol>
<li>准备程序或模块，将可翻译的字符串特别标记起来</li>
<li>在已标记的文件上运行一套工具，用来生成原始消息编目</li>
<li>创建消息编目的不同语言的翻译</li>
<li>使用 <code>gettext</code> 模块，以便正确翻译消息字符串</li>
</ol>
<p>为了准备代码以达成 I18N，需要巡视文件中的所有字符串。所有要翻译的字符串都应包括在 <code>_('...')</code> 内，以此打上标记——也就是调用 <code>_()</code> 函数。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">filename <span class="token operator">=</span> <span class="token string">'mylog.txt'</span>
message <span class="token operator">=</span> _<span class="token punctuation">(</span><span class="token string">'writing a log message'</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在这个例子中，字符串 <code>'writing a log message'</code> 被标记为待翻译，而字符串 <code>'mylog.txt'</code> 和 <code>'w'</code> 没有被标记。</p>
<p>有一些工具可以将待翻译的字符串提取出来。原版的 GNU <strong>gettext</strong> 仅支持 C 或 C++ 源代码，但其扩展版 <strong>xgettext</strong> 可以扫描多种语言的代码（包括 Python），来找出标记为可翻译的字符串。Babel 是一个 Python 国际化库，其中包含一个 <code>pybabel</code> 脚本，用于提取并编译消息编目。François Pinard 写的称为 <strong>xpot</strong> 的程序也能完成类似的工作，可从他的 <a href="https://github.com/pinard/po-utils" target="_blank" rel="noopener">po-utils 软件包</a> 中获取。</p>
<p>（Python 还包括了这些程序的纯 Python 版本，称为 <strong>pygettext.py</strong> 和 <strong>msgfmt.py</strong>，某些 Python 发行版已经安装了它们。<strong>pygettext.py</strong> 类似于 <strong>xgettext</strong>，但只能理解 Python 源代码，无法处理诸如 C 或 C++ 的其他编程语言。<strong>pygettext.py</strong> 支持的命令行界面类似于 <strong>xgettext</strong>，查看其详细用法请运行 <code>pygettext.py --help</code>。<strong>msgfmt.py</strong> 与 GNU <strong>msgfmt</strong> 是二进制兼容的。有了这两个程序，可以不需要 GNU <strong>gettext</strong> 包来国际化 Python 应用程序。）</p>
<p><strong>xgettext</strong>、<strong>pygettext</strong> 或类似工具生成的 <code>.po</code> 文件就是消息编目。它们是结构化的人类可读文件，包含源代码中所有被标记的字符串，以及这些字符串的翻译的占位符。</p>
<p>然后把这些 <code>.po</code> 文件的副本交给各个人工译者，他们为所支持的每种自然语言编写翻译。译者以 <code>&lt;语言名称&gt;.po</code> 文件的形式发送回翻译完的某个语言的版本，将该文件用 <strong>msgfmt</strong> 程序编译为机器可读的 <code>.mo</code> 二进制编目文件。<code>gettext</code> 模块使用 <code>.mo</code> 文件在运行时进行实际的翻译处理。</p>
<p>如何在代码中使用 <code>gettext</code> 模块取决于国际化单个模块还是整个应用程序。接下来的两节将讨论每种情况。</p>
<h4 id="本地化你的模块"><a href="#本地化你的模块" class="headerlink" title="本地化你的模块"></a>本地化你的模块</h4><p>如果要本地化模块，则切忌进行全局性的更改，如更改内建命名空间。不应使用 GNU <strong>gettext</strong> API，而应使用基于类的 API。</p>
<p>假设你的模块叫做 “spam”，并且该模块的各种自然语言翻译 <code>.mo</code> 文件存放于 <code>/usr/share/locale</code>，为 GNU <strong>gettext</strong> 格式。以下内容应放在模块顶部:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
t <span class="token operator">=</span> gettext<span class="token punctuation">.</span>translation<span class="token punctuation">(</span><span class="token string">'spam'</span><span class="token punctuation">,</span> <span class="token string">'/usr/share/locale'</span><span class="token punctuation">)</span>
_ <span class="token operator">=</span> t<span class="token punctuation">.</span>gettext<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="本地化你的应用程序"><a href="#本地化你的应用程序" class="headerlink" title="本地化你的应用程序"></a>本地化你的应用程序</h4><p>如果正在本地化应用程序，可以将 <code>_()</code> 函数全局安装到内建命名空间中，通常在应用程序的主文件中安装。这将使某个应用程序的所有文件都能使用 <code>_('...')</code>，而不必在每个文件中显式安装它。</p>
<p>最简单的情况，就只需将以下代码添加到应用程序的主程序文件中:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
gettext<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如果需要设置语言环境目录，可以将其传递给 <code>install()</code> 函数:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
gettext<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">,</span> <span class="token string">'/usr/share/locale'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="即时更改语言"><a href="#即时更改语言" class="headerlink" title="即时更改语言"></a>即时更改语言</h4><p>如果程序需要同时支持多种语言，则可能需要创建多个翻译实例，然后在它们之间进行显式切换，如下所示:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> gettext
lang1 <span class="token operator">=</span> gettext<span class="token punctuation">.</span>translation<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">,</span> languages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'en'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
lang2 <span class="token operator">=</span> gettext<span class="token punctuation">.</span>translation<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">,</span> languages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'fr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
lang3 <span class="token operator">=</span> gettext<span class="token punctuation">.</span>translation<span class="token punctuation">(</span><span class="token string">'myapplication'</span><span class="token punctuation">,</span> languages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'de'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># start by using language1</span>
lang1<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ... time goes by, user selects language 2</span>
lang2<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ... more time goes by, user selects language 3</span>
lang3<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="延迟翻译"><a href="#延迟翻译" class="headerlink" title="延迟翻译"></a>延迟翻译</h4><p>在大多数代码中，字符串会在编写位置进行翻译。但偶尔需要将字符串标记为待翻译，实际翻译却推迟到后面。一个典型的例子是:</p>
<pre class="line-numbers language-python"><code class="language-python">animals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'mollusk'</span><span class="token punctuation">,</span>
           <span class="token string">'albatross'</span><span class="token punctuation">,</span>
           <span class="token string">'rat'</span><span class="token punctuation">,</span>
           <span class="token string">'penguin'</span><span class="token punctuation">,</span>
           <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># ...</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> animals<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此处希望将 <code>animals</code> 列表中的字符串标记为可翻译，但不希望在打印之前对它们进行翻译。</p>
<p>这是处理该情况的一种方式:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> message
animals <span class="token operator">=</span> <span class="token punctuation">[</span>_<span class="token punctuation">(</span><span class="token string">'mollusk'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           _<span class="token punctuation">(</span><span class="token string">'albatross'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           _<span class="token punctuation">(</span><span class="token string">'rat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           _<span class="token punctuation">(</span><span class="token string">'penguin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           _<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
<span class="token keyword">del</span> _
<span class="token comment" spellcheck="true"># ...</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> animals<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该方法之所以可行，是因为 <code>_()</code> 的虚定义只是简单地返回了原本的字符串。并且该虚定义将临时覆盖内建命名空间中 <code>_()</code> 的定义（直到 <code>del</code> 命令）。即使先前在本地命名空间中已经有了 <code>_()</code> 的定义也请注意。</p>
<p>注意，第二次使用 <code>_()</code> 不会认为 “a” 可以传递给 <strong>gettext</strong> 程序去翻译，因为该参数不是字符串文字。</p>
<p>解决该问题的另一种方法是下面这个例子:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">N_</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> message
animals <span class="token operator">=</span> <span class="token punctuation">[</span>N_<span class="token punctuation">(</span><span class="token string">'mollusk'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           N_<span class="token punctuation">(</span><span class="token string">'albatross'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           N_<span class="token punctuation">(</span><span class="token string">'rat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           N_<span class="token punctuation">(</span><span class="token string">'penguin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           N_<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># ...</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> animals<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>_<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种情况下标记可翻译的字符串使用的是函数 <code>N_()</code>，该函数不会与 <code>_()</code> 的任何定义冲突。但是，需要教会消息提取程序去寻找用 <code>N_()</code> 标记的可翻译字符串。<strong>xgettext</strong>, <strong>pygettext</strong>, <code>pybabel extract</code> 和 <strong>xpot</strong> 都支持此功能，使用 <code>-k</code> 命令行开关即可。这里选择 <code>N_()</code> 为名称完全是任意的，它也能轻易改为 <code>MarkThisStringForTranslation()</code>。</p>
<h2 id="locale-—-国际化服务"><a href="#locale-—-国际化服务" class="headerlink" title="locale —- 国际化服务"></a><code>locale</code> —- 国际化服务</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/locale.py" target="_blank" rel="noopener">Lib/locale.py</a></p>
<hr>
<p>The <code>locale</code> module opens access to the POSIX locale database and functionality. The POSIX locale mechanism allows programmers to deal with certain cultural issues in an application, without requiring the programmer to know all the specifics of each country where the software is executed.</p>
<p>The <code>locale</code> module is implemented on top of the <code>_locale</code> module, which in turn uses an ANSI C locale implementation if available.</p>
<p>The <code>locale</code> module defines the following exception and functions:</p>
<p><em>exception</em> <code>locale.Error</code></p>
<p>Exception raised when the locale passed to <code>setlocale()</code> is not recognized.</p>
<p><code>locale.setlocale</code>(<em>category</em>, <em>locale=None</em>)</p>
<p>If <em>locale</em> is given and not <code>None</code>, <code>setlocale()</code> modifies the locale setting for the <em>category</em>. The available categories are listed in the data description below. <em>locale</em> may be a string, or an iterable of two strings (language code and encoding). If it’s an iterable, it’s converted to a locale name using the locale aliasing engine. An empty string specifies the user’s default settings. If the modification of the locale fails, the exception <code>Error</code> is raised. If successful, the new locale setting is returned.</p>
<p>If <em>locale</em> is omitted or <code>None</code>, the current setting for <em>category</em> is returned.</p>
<p><code>setlocale()</code> is not thread-safe on most systems. Applications typically start with a call of</p>
<pre><code>import localelocale.setlocale(locale.LC_ALL, '')</code></pre><p>This sets the locale for all categories to the user’s default setting (typically specified in the <code>LANG</code> environment variable). If the locale is not changed thereafter, using multithreading should not cause problems.</p>
<p><code>locale.localeconv</code>()</p>
<p>以字典的形式返回本地约定的数据库。此字典具有以下字符串作为键：</p>
<table>
<thead>
<tr>
<th align="left">类别</th>
<th align="left">键</th>
<th align="left">含意</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>LC_NUMERIC</code></td>
<td align="left"><code>‘decimal_point’</code></td>
<td align="left">小数点字符。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘grouping’</code></td>
<td align="left">Sequence of numbers specifying which relative positions the <code>‘thousands_sep’</code> is expected. If the sequence is terminated with <code>CHAR_MAX</code>, no further grouping is performed. If the sequence terminates with a <code>0</code>, the last group size is repeatedly used.</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘thousands_sep’</code></td>
<td align="left">组之间使用的字符。</td>
</tr>
<tr>
<td align="left"><code>LC_MONETARY</code></td>
<td align="left"><code>‘int_curr_symbol’</code></td>
<td align="left">国际货币符号。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘currency_symbol’</code></td>
<td align="left">当地货币符号。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘p_cs_precedes/n_cs_precedes’</code></td>
<td align="left">货币符号是否在值之前（对于正值或负值）。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘p_sep_by_space/n_sep_by_space’</code></td>
<td align="left">货币符号是否通过空格与值分隔（对于正值或负值）。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘mon_decimal_point’</code></td>
<td align="left">用于货币金额的小数点。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘frac_digits’</code></td>
<td align="left">货币值的本地格式中使用的小数位数。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘int_frac_digits’</code></td>
<td align="left">货币价值的国际格式中使用的小数位数。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘mon_thousands_sep’</code></td>
<td align="left">用于货币值的组分隔符。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘mon_grouping’</code></td>
<td align="left">相当于 <code>‘grouping’</code> ，用于货币价值。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘positive_sign’</code></td>
<td align="left">用于标注正货币价值的符号。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘negative_sign’</code></td>
<td align="left">用于注释负货币价值的符号。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>‘p_sign_posn/n_sign_posn’</code></td>
<td align="left">符号的位置（对于正值或负值），见下文。</td>
</tr>
</tbody></table>
<p>可以将所有数值设置为 <code>CHAR_MAX</code> ，以指示此语言环境中未指定任何值。</p>
<p>下面给出了 <code>'p_sign_posn'</code> 和 <code>'n_sign_posn'</code> 的可能值。</p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>0</code></td>
<td align="left">被括号括起来的货币和金额。</td>
</tr>
<tr>
<td align="left"><code>1</code></td>
<td align="left">该标志应位于值和货币符号之前。</td>
</tr>
<tr>
<td align="left"><code>2</code></td>
<td align="left">该标志应位于值和货币符号之后。</td>
</tr>
<tr>
<td align="left"><code>3</code></td>
<td align="left">标志应该紧跟在值之前。</td>
</tr>
<tr>
<td align="left"><code>4</code></td>
<td align="left">标志应该紧跟值项。</td>
</tr>
<tr>
<td align="left"><code>CHAR_MAX</code></td>
<td align="left">此语言环境中未指定任何内容。</td>
</tr>
</tbody></table>
<p>The function sets temporarily the <code>LC_CTYPE</code> locale to the <code>LC_NUMERIC</code> locale or the <code>LC_MONETARY</code> locale if locales are different and numeric or monetary strings are non-ASCII. This temporary change affects other threads.</p>
<p>在 3.7 版更改: The function now sets temporarily the <code>LC_CTYPE</code> locale to the <code>LC_NUMERIC</code> locale in some cases.</p>
<p><code>locale.nl_langinfo</code>(<em>option</em>)</p>
<p>Return some locale-specific information as a string. This function is not available on all systems, and the set of possible options might also vary across platforms. The possible argument values are numbers, for which symbolic constants are available in the locale module.</p>
<p>The <code>nl_langinfo()</code> function accepts one of the following keys. Most descriptions are taken from the corresponding description in the GNU C library.</p>
<ul>
<li><p><code>locale.CODESET</code></p>
<p>Get a string with the name of the character encoding used in the selected locale.</p>
</li>
<li><p><code>locale.D_T_FMT</code></p>
<p>Get a string that can be used as a format string for <code>time.strftime()</code> to represent date and time in a locale-specific way.</p>
</li>
<li><p><code>locale.D_FMT</code></p>
<p>Get a string that can be used as a format string for <code>time.strftime()</code> to represent a date in a locale-specific way.</p>
</li>
<li><p><code>locale.T_FMT</code></p>
<p>Get a string that can be used as a format string for <code>time.strftime()</code> to represent a time in a locale-specific way.</p>
</li>
<li><p><code>locale.T_FMT_AMPM</code></p>
<p>Get a format string for <code>time.strftime()</code> to represent time in the am/pm format.</p>
</li>
<li><p><code>DAY_1 ... DAY_7</code></p>
<p>Get the name of the n-th day of the week.</p>
<p>注解</p>
<p>This follows the US convention of <code>DAY_1</code> being Sunday, not the international convention (ISO 8601) that Monday is the first day of the week.</p>
</li>
<li><p><code>ABDAY_1 ... ABDAY_7</code></p>
<p>Get the abbreviated name of the n-th day of the week.</p>
</li>
<li><p><code>MON_1 ... MON_12</code></p>
<p>Get the name of the n-th month.</p>
</li>
<li><p><code>ABMON_1 ... ABMON_12</code></p>
<p>Get the abbreviated name of the n-th month.</p>
</li>
<li><p><code>locale.RADIXCHAR</code></p>
<p>Get the radix character (decimal dot, decimal comma, etc.).</p>
</li>
<li><p><code>locale.THOUSEP</code></p>
<p>Get the separator character for thousands (groups of three digits).</p>
</li>
<li><p><code>locale.YESEXPR</code></p>
<p>Get a regular expression that can be used with the regex function to recognize a positive response to a yes/no question.</p>
<p>注解</p>
<p>The expression is in the syntax suitable for the <code>regex()</code> function from the C library, which might differ from the syntax used in <code>re</code>.</p>
</li>
<li><p><code>locale.NOEXPR</code></p>
<p>Get a regular expression that can be used with the regex(3) function to recognize a negative response to a yes/no question.</p>
</li>
<li><p><code>locale.CRNCYSTR</code></p>
<p>Get the currency symbol, preceded by “-“ if the symbol should appear before the value, “+” if the symbol should appear after the value, or “.” if the symbol should replace the radix character.</p>
</li>
<li><p><code>locale.ERA</code></p>
<p>Get a string that represents the era used in the current locale.</p>
<p>Most locales do not define this value. An example of a locale which does define this value is the Japanese one. In Japan, the traditional representation of dates includes the name of the era corresponding to the then-emperor’s reign.</p>
<p>Normally it should not be necessary to use this value directly. Specifying the <code>E</code> modifier in their format strings causes the <code>time.strftime()</code> function to use this information. The format of the returned string is not specified, and therefore you should not assume knowledge of it on different systems.</p>
</li>
<li><p><code>locale.ERA_D_T_FMT</code></p>
<p>Get a format string for <code>time.strftime()</code> to represent date and time in a locale-specific era-based way.</p>
</li>
<li><p><code>locale.ERA_D_FMT</code></p>
<p>Get a format string for <code>time.strftime()</code> to represent a date in a locale-specific era-based way.</p>
</li>
<li><p><code>locale.ERA_T_FMT</code></p>
<p>Get a format string for <code>time.strftime()</code> to represent a time in a locale-specific era-based way.</p>
</li>
<li><p><code>locale.ALT_DIGITS</code></p>
<p>Get a representation of up to 100 values used to represent the values 0 to 99.</p>
</li>
</ul>
<p><code>locale.getdefaultlocale</code>([<em>envvars</em>])</p>
<p>Tries to determine the default locale settings and returns them as a tuple of the form <code>(language code, encoding)</code>.</p>
<p>According to POSIX, a program which has not called <code>setlocale(LC_ALL, '')</code> runs using the portable <code>'C'</code> locale. Calling <code>setlocale(LC_ALL, '')</code> lets it use the default locale as defined by the <code>LANG</code> variable. Since we do not want to interfere with the current locale setting we thus emulate the behavior in the way described above.</p>
<p>To maintain compatibility with other platforms, not only the <code>LANG</code> variable is tested, but a list of variables given as envvars parameter. The first found to be defined will be used. <em>envvars</em> defaults to the search path used in GNU gettext; it must always contain the variable name <code>'LANG'</code>. The GNU gettext search path contains <code>'LC_ALL'</code>, <code>'LC_CTYPE'</code>, <code>'LANG'</code> and <code>'LANGUAGE'</code>, in that order.</p>
<p>Except for the code <code>'C'</code>, the language code corresponds to <a href="https://tools.ietf.org/html/rfc1766.html" target="_blank" rel="noopener"><strong>RFC 1766</strong></a>. <em>language code</em> and <em>encoding</em> may be <code>None</code> if their values cannot be determined.</p>
<p><code>locale.getlocale</code>(<em>category=LC_CTYPE</em>)</p>
<p>Returns the current setting for the given locale category as sequence containing <em>language code</em>, <em>encoding</em>. <em>category</em> may be one of the <code>LC_*</code> values except <code>LC_ALL</code>. It defaults to <code>LC_CTYPE</code>.</p>
<p>Except for the code <code>'C'</code>, the language code corresponds to <a href="https://tools.ietf.org/html/rfc1766.html" target="_blank" rel="noopener"><strong>RFC 1766</strong></a>. <em>language code</em> and <em>encoding</em> may be <code>None</code> if their values cannot be determined.</p>
<p><code>locale.getpreferredencoding</code>(<em>do_setlocale=True</em>)</p>
<p>Return the locale encoding used for text data, according to user preferences. User preferences are expressed differently on different systems, and might not be available programmatically on some systems, so this function only returns a guess.</p>
<p>On some systems, it is necessary to invoke <code>setlocale()</code> to obtain the user preferences, so this function is not thread-safe. If invoking setlocale is not necessary or desired, <em>do_setlocale</em> should be set to <code>False</code>.</p>
<p>On Android or if the Python UTF-8 Mode is enabled, always return <code>'UTF-8'</code>, the locale encoding and the <em>do_setlocale</em> argument are ignored.</p>
<p>The Python preinitialization configures the LC_CTYPE locale. See also the filesystem encoding and error handler.</p>
<p>在 3.7 版更改: The function now always returns <code>UTF-8</code> on Android or if the Python UTF-8 Mode is enabled.</p>
<p><code>locale.normalize</code>(<em>localename</em>)</p>
<p>Returns a normalized locale code for the given locale name. The returned locale code is formatted for use with <code>setlocale()</code>. If normalization fails, the original name is returned unchanged.</p>
<p>If the given encoding is not known, the function defaults to the default encoding for the locale code just like <code>setlocale()</code>.</p>
<p><code>locale.resetlocale</code>(<em>category=LC_ALL</em>)</p>
<p>Sets the locale for <em>category</em> to the default setting.</p>
<p>The default setting is determined by calling <code>getdefaultlocale()</code>. <em>category</em> defaults to <code>LC_ALL</code>.</p>
<p><code>locale.strcoll</code>(<em>string1</em>, <em>string2</em>)</p>
<p>Compares two strings according to the current <code>LC_COLLATE</code> setting. As any other compare function, returns a negative, or a positive value, or <code>0</code>, depending on whether <em>string1</em> collates before or after <em>string2</em> or is equal to it.</p>
<p><code>locale.strxfrm</code>(<em>string</em>)</p>
<p>Transforms a string to one that can be used in locale-aware comparisons. For example, <code>strxfrm(s1) &lt; strxfrm(s2)</code> is equivalent to <code>strcoll(s1, s2) &lt; 0</code>. This function can be used when the same string is compared repeatedly, e.g. when collating a sequence of strings.</p>
<p><code>locale.format_string</code>(<em>format</em>, <em>val</em>, <em>grouping=False</em>, <em>monetary=False</em>)</p>
<p>Formats a number <em>val</em> according to the current <code>LC_NUMERIC</code> setting. The format follows the conventions of the <code>%</code> operator. For floating point values, the decimal point is modified if appropriate. If <em>grouping</em> is true, also takes the grouping into account.</p>
<p>If <em>monetary</em> is true, the conversion uses monetary thousands separator and grouping strings.</p>
<p>Processes formatting specifiers as in <code>format % val</code>, but takes the current locale settings into account.</p>
<p>在 3.7 版更改: The <em>monetary</em> keyword parameter was added.</p>
<p><code>locale.format</code>(<em>format</em>, <em>val</em>, <em>grouping=False</em>, <em>monetary=False</em>)</p>
<p>Please note that this function works like <code>format_string()</code> but will only work for exactly one <code>%char</code> specifier. For example, <code>'%f'</code> and <code>'%.0f'</code> are both valid specifiers, but <code>'%f KiB'</code> is not.</p>
<p>For whole format strings, use <code>format_string()</code>.</p>
<p>3.7 版后已移除: Use <code>format_string()</code> instead.</p>
<p><code>locale.currency</code>(<em>val</em>, <em>symbol=True</em>, <em>grouping=False</em>, <em>international=False</em>)</p>
<p>Formats a number <em>val</em> according to the current <code>LC_MONETARY</code> settings.</p>
<p>The returned string includes the currency symbol if <em>symbol</em> is true, which is the default. If <em>grouping</em> is true (which is not the default), grouping is done with the value. If <em>international</em> is true (which is not the default), the international currency symbol is used.</p>
<p>Note that this function will not work with the ‘C’ locale, so you have to set a locale via <code>setlocale()</code> first.</p>
<p><code>locale.str</code>(<em>float</em>)</p>
<p>Formats a floating point number using the same format as the built-in function <code>str(float)</code>, but takes the decimal point into account.</p>
<p><code>locale.delocalize</code>(<em>string</em>)</p>
<p>Converts a string into a normalized number string, following the <code>LC_NUMERIC</code> settings.</p>
<p>3.5 新版功能.</p>
<p><code>locale.localize</code>(<em>string</em>, <em>grouping=False</em>, <em>monetary=False</em>)</p>
<p>Converts a normalized number string into a formatted string following the <code>LC_NUMERIC</code> settings.</p>
<p>3.10 新版功能.</p>
<p><code>locale.atof</code>(<em>string</em>)</p>
<p>Converts a string to a floating point number, following the <code>LC_NUMERIC</code> settings.</p>
<p><code>locale.atoi</code>(<em>string</em>)</p>
<p>Converts a string to an integer, following the <code>LC_NUMERIC</code> conventions.</p>
<pre><code>locale.LC_CTYPE</code></pre><p>Locale category for the character type functions. Depending on the settings of this category, the functions of module <code>string</code> dealing with case change their behaviour.</p>
<pre><code>locale.LC_COLLATE</code></pre><p>Locale category for sorting strings. The functions <code>strcoll()</code> and <code>strxfrm()</code> of the <code>locale</code> module are affected.</p>
<pre><code>locale.LC_TIME</code></pre><p>Locale category for the formatting of time. The function <code>time.strftime()</code> follows these conventions.</p>
<pre><code>locale.LC_MONETARY</code></pre><p>Locale category for formatting of monetary values. The available options are available from the <code>localeconv()</code> function.</p>
<pre><code>locale.LC_MESSAGES</code></pre><p>Locale category for message display. Python currently does not support application specific locale-aware messages. Messages displayed by the operating system, like those returned by <code>os.strerror()</code> might be affected by this category.</p>
<pre><code>locale.LC_NUMERIC</code></pre><p>Locale category for formatting numbers. The functions <code>format()</code>, <code>atoi()</code>, <code>atof()</code> and <code>str()</code> of the <code>locale</code> module are affected by that category. All other numeric formatting operations are not affected.</p>
<pre><code>locale.LC_ALL</code></pre><p>Combination of all locale settings. If this flag is used when the locale is changed, setting the locale for all categories is attempted. If that fails for any category, no category is changed at all. When the locale is retrieved using this flag, a string indicating the setting for all categories is returned. This string can be later used to restore the settings.</p>
<pre><code>locale.CHAR_MAX</code></pre><p>This is a symbolic constant used for different values returned by <code>localeconv()</code>.</p>
<p>示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> locale
<span class="token operator">>></span><span class="token operator">></span> loc <span class="token operator">=</span> locale<span class="token punctuation">.</span>getlocale<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># get current locale</span>
<span class="token comment" spellcheck="true"># use German locale; name might vary with platform</span>
<span class="token operator">>></span><span class="token operator">></span> locale<span class="token punctuation">.</span>setlocale<span class="token punctuation">(</span>locale<span class="token punctuation">.</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">'de_DE'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> locale<span class="token punctuation">.</span>strcoll<span class="token punctuation">(</span><span class="token string">'f\xe4n'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># compare a string containing an umlaut</span>
<span class="token operator">>></span><span class="token operator">></span> locale<span class="token punctuation">.</span>setlocale<span class="token punctuation">(</span>locale<span class="token punctuation">.</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># use user's preferred locale</span>
<span class="token operator">>></span><span class="token operator">></span> locale<span class="token punctuation">.</span>setlocale<span class="token punctuation">(</span>locale<span class="token punctuation">.</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># use default (C) locale</span>
<span class="token operator">>></span><span class="token operator">></span> locale<span class="token punctuation">.</span>setlocale<span class="token punctuation">(</span>locale<span class="token punctuation">.</span>LC_ALL<span class="token punctuation">,</span> loc<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># restore saved locale</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Background-details-hints-tips-and-caveats"><a href="#Background-details-hints-tips-and-caveats" class="headerlink" title="Background, details, hints, tips and caveats"></a>Background, details, hints, tips and caveats</h3><p>The C standard defines the locale as a program-wide property that may be relatively expensive to change. On top of that, some implementations are broken in such a way that frequent locale changes may cause core dumps. This makes the locale somewhat painful to use correctly.</p>
<p>Initially, when a program is started, the locale is the <code>C</code> locale, no matter what the user’s preferred locale is. There is one exception: the <code>LC_CTYPE</code> category is changed at startup to set the current locale encoding to the user’s preferred locale encoding. The program must explicitly say that it wants the user’s preferred locale settings for other categories by calling <code>setlocale(LC_ALL, '')</code>.</p>
<p>It is generally a bad idea to call <code>setlocale()</code> in some library routine, since as a side effect it affects the entire program. Saving and restoring it is almost as bad: it is expensive and affects other threads that happen to run before the settings have been restored.</p>
<p>If, when coding a module for general use, you need a locale independent version of an operation that is affected by the locale (such as certain formats used with <code>time.strftime()</code>), you will have to find a way to do it without using the standard library routine. Even better is convincing yourself that using locale settings is okay. Only as a last resort should you document that your module is not compatible with non-<code>C</code> locale settings.</p>
<p>The only way to perform numeric operations according to the locale is to use the special functions defined by this module: <code>atof()</code>, <code>atoi()</code>, <code>format()</code>, <code>str()</code>.</p>
<p>There is no way to perform case conversions and character classifications according to the locale. For (Unicode) text strings these are done according to the character value only, while for byte strings, the conversions and classifications are done according to the ASCII value of the byte, and bytes whose high bit is set (i.e., non-ASCII bytes) are never converted or considered part of a character class such as letter or whitespace.</p>
<h3 id="For-extension-writers-and-programs-that-embed-Python"><a href="#For-extension-writers-and-programs-that-embed-Python" class="headerlink" title="For extension writers and programs that embed Python"></a>For extension writers and programs that embed Python</h3><p>Extension modules should never call <code>setlocale()</code>, except to find out what the current locale is. But since the return value can only be used portably to restore it, that is not very useful (except perhaps to find out whether or not the locale is <code>C</code>).</p>
<p>When Python code uses the <code>locale</code> module to change the locale, this also affects the embedding application. If the embedding application doesn’t want this to happen, it should remove the <code>_locale</code> extension module (which does all the work) from the table of built-in modules in the <code>config.c</code> file, and make sure that the <code>_locale</code> module is not accessible as a shared library.</p>
<h3 id="Access-to-message-catalogs"><a href="#Access-to-message-catalogs" class="headerlink" title="Access to message catalogs"></a>Access to message catalogs</h3><p><code>locale.gettext</code>(<em>msg</em>)</p>
<p><code>locale.dgettext</code>(<em>domain</em>, <em>msg</em>)</p>
<p><code>locale.dcgettext</code>(<em>domain</em>, <em>msg</em>, <em>category</em>)</p>
<p><code>locale.textdomain</code>(<em>domain</em>)</p>
<p><code>locale.bindtextdomain</code>(<em>domain</em>, <em>dir</em>)</p>
<p>The locale module exposes the C library’s gettext interface on systems that provide this interface. It consists of the functions <code>gettext()</code>, <code>dgettext()</code>, <code>dcgettext()</code>, <code>textdomain()</code>, <code>bindtextdomain()</code>, and <code>bind_textdomain_codeset()</code>. These are similar to the same functions in the <code>gettext</code> module, but use the C library’s binary format for message catalogs, and the C library’s search algorithms for locating message catalogs.</p>
<p>Python applications should normally find no need to invoke these functions, and should use <code>gettext</code> instead. A known exception to this rule are applications that link with additional C libraries which internally invoke <code>gettext()</code> or <code>dcgettext()</code>. For these applications, it may be necessary to bind the text domain, so that the libraries can properly locate their message catalogs.</p>
<h1 id="程序框架"><a href="#程序框架" class="headerlink" title="程序框架"></a>程序框架</h1><p>本章描述的完整模块列表如下：</p>
<ul>
<li><code>turtle</code> —- 海龟绘图<ul>
<li>概述</li>
<li>可用的 Turtle 和 Screen 方法概览<ul>
<li>Turtle 方法</li>
<li>TurtleScreen/Screen 方法</li>
</ul>
</li>
<li>RawTurtle/Turtle 方法和对应函数<ul>
<li>海龟动作</li>
<li>获取海龟的状态</li>
<li>度量单位设置</li>
<li>画笔控制<ul>
<li>绘图状态</li>
<li>颜色控制</li>
<li>填充</li>
<li>更多绘图控制</li>
</ul>
</li>
<li>海龟状态<ul>
<li>可见性</li>
<li>外观</li>
</ul>
</li>
<li>使用事件</li>
<li>特殊海龟方法</li>
<li>复合形状</li>
</ul>
</li>
<li>TurtleScreen/Screen 方法及对应函数<ul>
<li>窗口控制</li>
<li>动画控制</li>
<li>使用屏幕事件</li>
<li>输入方法</li>
<li>设置与特殊方法</li>
<li>Screen 专有方法, 而非继承自 TurtleScreen</li>
</ul>
</li>
<li>公共类</li>
<li>帮助与配置<ul>
<li>如何使用帮助</li>
<li>文档字符串翻译为不同的语言</li>
<li>如何配置 Screen 和 Turtle</li>
</ul>
</li>
<li><code>turtledemo</code> —- 演示脚本集</li>
<li>Python 2.6 之后的变化</li>
<li>Python 3.0 之后的变化</li>
</ul>
</li>
<li><code>cmd</code> —- 支持面向行的命令解释器<ul>
<li>Cmd 对象</li>
<li>Cmd 例子</li>
</ul>
</li>
<li><code>shlex</code> —— 简单的词法分析<ul>
<li>shlex 对象</li>
<li>解析规则</li>
<li>改进的 shell 兼容性</li>
</ul>
</li>
</ul>
<h2 id="turtle-—-海龟绘图"><a href="#turtle-—-海龟绘图" class="headerlink" title="turtle —- 海龟绘图"></a><code>turtle</code> —- 海龟绘图</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/turtle.py" target="_blank" rel="noopener">Lib/turtle.py</a></p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>海龟绘图很适合用来引导孩子学习编程。 最初来自于 Wally Feurzeig, Seymour Papert 和 Cynthia Solomon 于 1967 年所创造的 Logo 编程语言。</p>
<p>请想象绘图区有一只机器海龟，起始位置在 x-y 平面的 (0, 0) 点。先执行 <code>import turtle</code>，再执行 <code>turtle.forward(15)</code>，它将(在屏幕上)朝所面对的 x 轴正方向前进 15 像素，随着它的移动画出一条线段。再执行 <code>turtle.right(25)</code>，它将原地右转 25 度。</p>
<p>Turtle star</p>
<p>使用海龟绘图可以编写重复执行简单动作的程序画出精细复杂的形状。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> turtle <span class="token keyword">import</span> <span class="token operator">*</span>
color<span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span>
begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    forward<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    left<span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> abs<span class="token punctuation">(</span>pos<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span>
done<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过组合使用此类命令，可以轻松地绘制出精美的形状和图案。</p>
<p><a href="https://docs.python.org/zh-cn/3.10/library/turtle.html#module-turtle" target="_blank" rel="noopener"><code>turtle</code></a> 模块是基于 Python 标准发行版 2.5 以来的同名模块重新编写并进行了功能扩展。</p>
<p>新模块尽量保持了原模块的特点，并且(几乎)100%与其兼容。这就意味着初学编程者能够以交互方式使用模块的所有命令、类和方法——运行 IDLE 时注意加 <code>-n</code> 参数。</p>
<p>turtle 模块提供面向对象和面向过程两种形式的海龟绘图基本组件。由于它使用 <code>tkinter</code> 实现基本图形界面，因此需要安装了 Tk 支持的 Python 版本。</p>
<p>面向对象的接口主要使用“2+2”个类：</p>
<ol>
<li><p><code>TurtleScreen</code> 类定义图形窗口作为绘图海龟的运动场。它的构造器需要一个 <code>tkinter.Canvas</code> 或 <code>ScrolledCanvas</code> 作为参数。应在 <code>turtle</code> 作为某个程序的一部分的时候使用。</p>
<p><code>Screen()</code> 函数返回一个 <code>TurtleScreen</code> 子类的单例对象。此函数应在 <code>turtle</code> 作为独立绘图工具时使用。作为一个单例对象，其所属的类是不可被继承的。</p>
<p>TurtleScreen/Screen 的所有方法还存在对应的函数，即作为面向过程的接口组成部分。</p>
</li>
<li><p><code>RawTurtle</code> (别名: <code>RawPen</code>) 类定义海龟对象在 <code>TurtleScreen</code> 上绘图。它的构造器需要一个 Canvas, ScrolledCanvas 或 TurtleScreen 作为参数，以指定 RawTurtle 对象在哪里绘图。</p>
<p>从 RawTurtle 派生出子类 <code>Turtle</code> (别名: <code>Pen</code>)，该类对象在 <code>Screen</code> 实例上绘图，如果实例不存在则会自动创建。</p>
<p>RawTurtle/Turtle 的所有方法也存在对应的函数，即作为面向过程的接口组成部分。</p>
</li>
</ol>
<p>过程式接口提供与 <code>Screen</code> 和 <code>Turtle</code> 类的方法相对应的函数。函数名与对应的方法名相同。当 Screen 类的方法对应函数被调用时会自动创建一个 Screen 对象。当 Turtle 类的方法对应函数被调用时会自动创建一个 (匿名的) Turtle 对象。</p>
<p>如果屏幕上需要有多个海龟，就必须使用面向对象的接口。</p>
<p><a href="https://blog.creativecc.cn/posts/blog-python02.html" target="_blank" rel="noopener">turtle简易教程</a></p>
<h2 id="shlex-——-简单的词法分析"><a href="#shlex-——-简单的词法分析" class="headerlink" title="shlex —— 简单的词法分析"></a><code>shlex</code> —— 简单的词法分析</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/shlex.py" target="_blank" rel="noopener">Lib/shlex.py</a></p>
<hr>
<p><code>shlex</code> 类可用于编写类似 Unix shell 的简单词法分析程序。通常可用于编写“迷你语言”（如 Python 应用程序的运行控制文件）或解析带引号的字符串。</p>
<p><code>shlex</code> 模块中定义了以下函数：</p>
<p><code>shlex.split</code>(<em>s</em>, <em>comments=False</em>, <em>posix=True</em>)</p>
<p>用类似 shell 的语法拆分字符串 <em>s</em>。如果 <em>comments</em> 为 <code>False</code> (默认值)，则不会解析给定字符串中的注释 (<code>commenters</code> 属性的 <code>shlex</code> 实例设为空字符串)。 本函数默认工作于 POSIX 模式下，但若 <em>posix</em> 参数为 False，则采用非 POSIX 模式。</p>
<p>注解</p>
<p>Since the <code>split()</code> function instantiates a <code>shlex</code> instance, passing <code>None</code> for <em>s</em> will read the string to split from standard input.</p>
<p>3.9 版后已移除: 在以后的 Python 版本中，给 <em>s</em> 传入 <code>None</code> 将触发异常。</p>
<p><code>shlex.join</code>(<em>split_command</em>)</p>
<p>将列表 <em>split_command</em> 中的词法单元（token）串联起来，返回一个字符串。本函数是 <code>split()</code> 的逆运算。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> shlex <span class="token keyword">import</span> join
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'echo'</span><span class="token punctuation">,</span> <span class="token string">'-n'</span><span class="token punctuation">,</span> <span class="token string">'Multiple words'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
echo <span class="token operator">-</span>n <span class="token string">'Multiple words'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>为防止注入漏洞，返回值是经过 shell 转义的。</p>
<p>3.8 新版功能.</p>
<p><code>shlex.quote</code>(<em>s</em>)</p>
<p>返回经过 shell 转义的字符串 <em>s</em> 。返回值为字符串，可以安全地用作 shell 命令行中的词法单元，可用于不能使用列表的场合。</p>
<p>警告</p>
<p><code>shlex</code> 模块 <strong>仅适用于 Unix shell</strong>。</p>
<p>在不兼容 POSIX 的 shell 或其他操作系统（如Windows）的shell上，并不保证 <code>quote()</code> 函数能够正常使用。在这种 shell 中执行用本模块包装过的命令，有可能会存在命令注入漏洞。</p>
<p>请考虑采用命令参数以列表形式给出的函数，比如带了 <code>shell=False</code> 参数的 <code>subprocess.run()</code> 。</p>
<p>以下用法是不安全的：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> filename <span class="token operator">=</span> <span class="token string">'somefile; rm -rf ~'</span>
<span class="token operator">>></span><span class="token operator">></span> command <span class="token operator">=</span> <span class="token string">'ls -l {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># executed by a shell: boom!</span>
ls <span class="token operator">-</span>l somefile<span class="token punctuation">;</span> rm <span class="token operator">-</span>rf <span class="token operator">~</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>用 <code>quote()</code> 可以堵住这种安全漏洞：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> shlex <span class="token keyword">import</span> quote
<span class="token operator">>></span><span class="token operator">></span> command <span class="token operator">=</span> <span class="token string">'ls -l {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>quote<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
ls <span class="token operator">-</span>l <span class="token string">'somefile; rm -rf ~'</span>
<span class="token operator">>></span><span class="token operator">></span> remote_command <span class="token operator">=</span> <span class="token string">'ssh home {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>quote<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>remote_command<span class="token punctuation">)</span>
ssh home <span class="token string">'ls -l '</span><span class="token string">"'"</span><span class="token string">'somefile; rm -rf ~'</span><span class="token string">"'"</span><span class="token string">''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种包装方式兼容于 UNIX shell 和 <code>split()</code> 。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> shlex <span class="token keyword">import</span> split
<span class="token operator">>></span><span class="token operator">></span> remote_command <span class="token operator">=</span> split<span class="token punctuation">(</span>remote_command<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> remote_command
<span class="token punctuation">[</span><span class="token string">'ssh'</span><span class="token punctuation">,</span> <span class="token string">'home'</span><span class="token punctuation">,</span> <span class="token string">"ls -l 'somefile; rm -rf ~'"</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> command <span class="token operator">=</span> split<span class="token punctuation">(</span>remote_command<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> command
<span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">,</span> <span class="token string">'somefile; rm -rf ~'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.3 新版功能.</p>
<p><code>shlex</code> 模块中定义了以下类：</p>
<p><em>class</em> <code>shlex.shlex</code>(<em>instream=None</em>, <em>infile=None</em>, <em>posix=False</em>, <em>punctuation_chars=False</em>)</p>
<p><code>shlex</code> 及其子类的实例是一种词义分析器对象。 利用初始化参数可指定从哪里读取字符。 初始化参数必须是具备 <code>read()</code> 和 <code>readline()</code> 方法的文件/流对象，或者是一个字符串。 如果没有给出初始化参数，则会从 <code>sys.stdin</code> 获取输入。 第二个可选参数是个文件名字符串，用于设置 <code>infile</code> 属性的初始值。 如果 <em>instream</em> 参数被省略或等于 <code>sys.stdin</code>，则第二个参数默认为 “stdin”。 <em>posix</em> 参数定义了操作的模式：若 <em>posix</em> 不为真值（默认），则 <code>shlex</code> 实例将工作于兼容模式。 若运行于 POSIX 模式下，则 <code>shlex</code> 会尽可能地应用 POSIX shell 解析规则。 <em>punctuation_chars</em> 参数提供了一种使行为更接近于真正的 shell 解析的方式。 该参数可接受多种值：默认值、<code>False</code>、保持 Python 3.5 及更早版本的行为。 如果设为 <code>True</code>，则会改变对字符 <code>();&lt;&gt;|&amp;</code> 的解析方式：这些字符将作为独立的词法单元被返回（视作标点符号）。 如果设为非空字符串，则这些字符将被用作标点符号。 出现在 <em>punctuation_chars</em> 中的 <code>wordchars</code> 属性中的任何字符都会从 <code>wordchars</code> 中被删除。 <em>punctuation_chars</em> 只能在创建 <code>shlex</code> 实例时设置，以后不能再作修改。</p>
<p>在 3.6 版更改: 加入 <em>punctuation_chars</em> 参数。</p>
<p>配置文件解析器，类似于 Windows 的 <code>.ini</code> 文件。</p>
<h3 id="shlex-对象"><a href="#shlex-对象" class="headerlink" title="shlex 对象"></a>shlex 对象</h3><p><code>shlex</code> 实例具备以下方法：</p>
<p><code>shlex.get_token</code>()</p>
<p>返回一个词法单元。如果所有单词已用 <code>push_token()</code> 堆叠在一起了，则从堆栈中弹出一个词法单元。否则就从输入流中读取一个。如果读取时遇到文件结束符，则会返回 <code>eof</code>（在非 POSIX 模式下为空字符串 <code></code>‘’<code>，在 POSIX 模式下为 ``None</code>）。</p>
<p><code>shlex.push_token</code>(<em>str</em>)</p>
<p>将参数值压入词法单元堆栈。</p>
<p><code>shlex.read_token</code>()</p>
<p>读取一个原始词法单元。忽略堆栈，且不解释源请求。（通常没什么用，只是为了完整起见。）</p>
<p><code>shlex.sourcehook</code>(<em>filename</em>)</p>
<p>当 <code>shlex</code> 检测到源请求，以下词法单元可作为参数，并应返回一个由文件名和打开的文件对象组成的元组。</p>
<p>通常本方法会先移除参数中的引号。如果结果为绝对路径名，或者之前没有有效的源请求，或者之前的源请求是一个流对象（比如 <code>sys.stdin</code>），那么结果将不做处理。否则，如果结果是相对路径名，那么前面将会加上目录部分，目录名来自于源堆栈中前一个文件名（类似于 C 预处理器对 <code>#include "file.h"</code> 的处理方式）。</p>
<p>结果被视为一个文件名，并作为元组的第一部分返回，元组的第二部分以此为基础调用 <code>open()</code> 获得。（注意：这与实例初始化过程中的参数顺序相反！)</p>
<p>此钩子函数是公开的，可用于实现路径搜索、添加文件扩展名或黑入其他命名空间。没有对应的“关闭”钩子函数，但 shlex 实例在返回 EOF 时会调用源输入流的 <code>close()</code> 方法。</p>
<p>若要更明确地控制源堆栈，请采用 <code>push_source()</code> 和 <code>pop_source()</code> 方法。</p>
<p><code>shlex.push_source</code>(<em>newstream</em>, <em>newfile=None</em>)</p>
<p>将输入源流压入输入堆栈。如果指定了文件名参数，以后错误信息中将会用到。<code>sourcehook()</code> 内部同样使用了本方法。</p>
<p><code>shlex.pop_source</code>()</p>
<p>从输入堆栈中弹出最后一条输入源。当遇到输入流的 EOF 时，内部也使用同一方法。</p>
<p><code>shlex.error_leader</code>(<em>infile=None</em>, <em>lineno=None</em>)</p>
<p>本方法生成一条错误信息的首部，以 Unix C 编译器错误标签的形式；格式为<code>‘“%s”, line %d: ‘`，其中</code>%s<code>被替换为当前源文件的名称，</code>%d` 被替换为当前输入行号（可用可选参数覆盖）。</p>
<p>这是个快捷函数，旨在鼓励 <code>shlex</code> 用户以标准的、可解析的格式生成错误信息，以便 Emacs 和其他 Unix 工具理解。</p>
<p><code>shlex</code> 子类的实例有一些公共实例变量，这些变量可以控制词义分析，也可用于调试。</p>
<pre><code>shlex.commenters</code></pre><p>将被视为注释起始字符串。从注释起始字符串到行尾的所有字符都将被忽略。默认情况下只包括 <code>'#'</code>。</p>
<pre><code>shlex.wordchars</code></pre><p>可连成多字符词法单元的字符串。默认包含所有 ASCII 字母数字和下划线。在 POSIX 模式下，Latin-1 字符集的重音字符也被包括在内。如果 <code>punctuation_chars</code> 不为空，则可出现在文件名规范和命令行参数中的 <code>~-./*?=</code> 字符也将包含在内，任何 <code>punctuation_chars</code> 中的字符将从 <code>wordchars</code> 中移除。如果 <code>whitespace_split</code> 设为 <code>True</code>，则本规则无效。</p>
<pre><code>shlex.whitespace</code></pre><p>将被视为空白符并跳过的字符。空白符是词法单元的边界。默认包含空格、制表符、换行符和回车符。</p>
<pre><code>shlex.escape</code></pre><p>将视为转义字符。仅适用于 POSIX 模式，默认只包含 <code>'\'</code>。</p>
<pre><code>shlex.quotes</code></pre><p>将视为引号的字符。词法单元中的字符将会累至再次遇到同样的引号（因此，不同的引号会像在 shell 中一样相互包含。）默认包含 ASCII 单引号和双引号。</p>
<pre><code>shlex.escapedquotes</code></pre><p><code>quotes</code> 中的字符将会解析 <code>escape</code> 定义的转义字符。这只在 POSIX 模式下使用，默认只包含 <code>'"'</code>。</p>
<pre><code>shlex.whitespace_split</code></pre><p>若为 <code>True</code>，则只根据空白符拆分词法单元。这很有用，比如用 <code>shlex</code> 解析命令行，用类似 shell 参数的方式读取各个词法单元。当与 <code>punctuation_chars</code> 一起使用时，将根据空白符和这些字符拆分词法单元。</p>
<p>在 3.8 版更改: <code>punctuation_chars</code> 属性已与 <code>whitespace_split</code> 属性兼容。</p>
<pre><code>shlex.infile</code></pre><p>当前输入的文件名，可能是在类实例化时设置的，或者是由后来的源请求堆栈生成的。在构建错误信息时可能会用到本属性。</p>
<pre><code>shlex.instream</code></pre><p><code>shlex</code> 实例正从中读取字符的输入流。</p>
<pre><code>shlex.source</code></pre><p>本属性默认值为 <code>None</code>。 如果给定一个字符串，则会识别为包含请求，类似于各种 shell 中的 <code>source</code> 关键字。 也就是说，紧随其后的词法单元将作为文件名打开，作为输入流，直至遇到 EOF 后调用流的 <code>close()</code> 方法，然后原输入流仍变回输入源。Source 请求可以在词义堆栈中嵌套任意深度。</p>
<pre><code>shlex.debug</code></pre><p>如果本属性为大于 <code>1</code> 的数字，则 <code>shlex</code> 实例会把动作进度详细地输出出来。若需用到本属性，可阅读源代码来了解细节。</p>
<pre><code>shlex.lineno</code></pre><p>源的行数（到目前为止读到的换行符数量加 1）。</p>
<pre><code>shlex.token</code></pre><p>词法单元的缓冲区。在捕获异常时可能会用到。</p>
<pre><code>shlex.eof</code></pre><p>用于确定文件结束的词法单元。在非 POSIX 模式下，将设为空字符串 <code>''</code>，在 POSIX 模式下被设为 <code>None</code>。</p>
<pre><code>shlex.punctuation_chars</code></pre><p>只读属性。表示应视作标点符号的字符。标点符号将作为单个词法单元返回。然而，请注意不会进行语义有效性检查：比如 “&gt;&gt;&gt;” 可能会作为一个词法单元返回，虽然 shell 可能无法识别。</p>
<p>3.6 新版功能.</p>
<h3 id="解析规则"><a href="#解析规则" class="headerlink" title="解析规则"></a>解析规则</h3><p>在非 POSIX 模式下时，<code>shlex</code> 会试图遵守以下规则：</p>
<ul>
<li>不识别单词中的引号（<code>Do"Not"Separate</code> 解析为一个单词 <code>Do"Not"Separate</code>）；</li>
<li>不识别转义字符；</li>
<li>引号包裹的字符保留字面意思；</li>
<li>成对的引号会将单词分离（<code>"Do"Separate</code> 解析为 <code>"Do"</code> 和 <code>Separate</code>）；</li>
<li>如果 <code>whitespace_split</code> 为 <code>False</code>，则未声明为单词字符、空白或引号的字符将作为单字符的词法单元返回。若为 <code>True</code>， 则 <code>shlex</code> 只根据空白符拆分单词。</li>
<li>EOF 用空字符串（<code>''</code>）表示；</li>
<li>空字符串无法解析，即便是加了引号。</li>
</ul>
<p>在 POSIX 模式时，<code>shlex</code> 将尝试遵守以下解析规则：</p>
<ul>
<li>引号会被剔除，且不会拆分单词（ <code>"Do"Not"Separate"</code> 将解析为单个单词 <code>DoNotSeparate</code>）；</li>
<li>未加引号包裹的转义字符（如 <code>'\'</code> ）保留后一个字符的字面意思；</li>
<li>引号中的字符不属于 <code>escapedquotes</code> （例如，<code>"'"</code>），则保留引号中所有字符的字面值；</li>
<li>若引号包裹的字符属于 <code>escapedquotes</code> （例如 <code>'"'</code>），则保留引号中所有字符的字面意思，属于 <code>escape</code> 中的字符除外。仅当后跟后半个引号或转义字符本身时，转义字符才保留其特殊含义。否则，转义字符将视作普通字符；</li>
<li>EOF 用 <code>None</code> 表示；</li>
<li>允许出现引号包裹的空字符串（<code>''</code>）。</li>
</ul>
<h3 id="改进的-shell-兼容性"><a href="#改进的-shell-兼容性" class="headerlink" title="改进的 shell 兼容性"></a>改进的 shell 兼容性</h3><p>3.6 新版功能.</p>
<p><code>shlex</code> 类提供了与常见 Unix shell（如 <code>bash</code>、<code>dash</code> 和<code>sh</code>）的解析兼容性。为了充分利用这种兼容性，请在构造函数中设定 <code>punctuation_chars</code> 参数。该参数默认为 <code>False</code>，维持 3.6 以下版本的行为。如果设为 <code>True</code>，则会改变对 <code>();&lt;&gt;|&amp;</code> 字符的解析方式：这些字符都将视为单个的词法单元返回。虽然不算是完整的 shell 解析程序（考虑到 shell 的多样性，超出了标准库的范围），但确实能比其他方式更容易进行命令行的处理。以下代码段演示了两者的差异：</p>
<pre class="line-numbers language-python"><code class="language-python"> <span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> shlex
 <span class="token operator">>></span><span class="token operator">></span> text <span class="token operator">=</span> <span class="token string">"a &amp;&amp; b; c &amp;&amp; d || e; f >'abc'; (def \"ghi\")"</span>
 <span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> shlex<span class="token punctuation">.</span>shlex<span class="token punctuation">(</span>text<span class="token punctuation">,</span> posix<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 <span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>whitespace_split <span class="token operator">=</span> <span class="token boolean">True</span>
 <span class="token operator">>></span><span class="token operator">></span> list<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
 <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'b;'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'e;'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'>abc;'</span><span class="token punctuation">,</span> <span class="token string">'(def'</span><span class="token punctuation">,</span> <span class="token string">'ghi)'</span><span class="token punctuation">]</span>
 <span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> shlex<span class="token punctuation">.</span>shlex<span class="token punctuation">(</span>text<span class="token punctuation">,</span> posix<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> punctuation_chars<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 <span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>whitespace_split <span class="token operator">=</span> <span class="token boolean">True</span>
 <span class="token operator">>></span><span class="token operator">></span> list<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
 <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span>
 <span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">'def'</span><span class="token punctuation">,</span> <span class="token string">'ghi'</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然，返回的词法单元对 shell 无效，需要对返回的词法单元自行进行错误检查。</p>
<p>punctuation_chars 参数可以不传入 <code>True</code> ，而是传入包含特定字符的字符串，用于确定由哪些字符构成标点符号。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> shlex
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> shlex<span class="token punctuation">.</span>shlex<span class="token punctuation">(</span><span class="token string">"a &amp;&amp; b || c"</span><span class="token punctuation">,</span> punctuation_chars<span class="token operator">=</span><span class="token string">"|"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> list<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p>如果指定了 <code>punctuation_chars</code>，则 <code>wordchars</code> 属性的参数会是 <code>~-./*?=</code>。因为这些字符可以出现在文件名（包括通配符）和命令行参数中（如 <code>--color=auto</code>）。因此：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> shlex
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> shlex<span class="token punctuation">.</span>shlex<span class="token punctuation">(</span><span class="token string">'~/a &amp;&amp; b-c --color=auto || d *.py?'</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 punctuation_chars<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> list<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'~/a'</span><span class="token punctuation">,</span> <span class="token string">'&amp;&amp;'</span><span class="token punctuation">,</span> <span class="token string">'b-c'</span><span class="token punctuation">,</span> <span class="token string">'--color=auto'</span><span class="token punctuation">,</span> <span class="token string">'||'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'*.py?'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不过为了尽可能接近于 shell ，建议在使用 <code>punctuation_chars</code> 时始终使用 <code>posix</code> 和 <code>whitespace_split</code> ，这将完全否定 <code>wordchars</code> 。</p>
<p>为了达到最佳效果，<code>punctuation_chars</code> 应与 <code>posix=True</code> 一起设置。（注意 <code>posix=False</code> 是 <code>shlex</code> 的默认设置)。</p>
<h2 id="cmd-—-支持面向行的命令解释器"><a href="#cmd-—-支持面向行的命令解释器" class="headerlink" title="cmd —- 支持面向行的命令解释器"></a><code>cmd</code> —- 支持面向行的命令解释器</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/cmd.py" target="_blank" rel="noopener">Lib/cmd.py</a></p>
<hr>
<p><code>Cmd</code> 类提供简单框架用于编写面向行的命令解释器。 这些通常对测试工具，管理工具和原型有用，这些工具随后将被包含在更复杂的接口中。</p>
<p><em>class</em> <code>cmd.Cmd</code>(<em>completekey=’tab’</em>, <em>stdin=None</em>, <em>stdout=None</em>)</p>
<p>一个 <code>Cmd</code> 实例或子类实例是面向行的解释器框架结构。 实例化 <code>Cmd</code> 本身是没有充分理由的， 它作为自定义解释器类的超类是非常有用的为了继承 <code>Cmd</code> 的方法并且封装动作方法。</p>
<p>可选参数 <em>completekey</em> 是完成键的 <code>readline</code> 名称；默认是 Tab 。如果 <em>completekey</em> 不是 <code>None</code> 并且 <code>readline</code> 是可用的， 命令完成会自动完成。</p>
<p>可选参数 <em>stdin</em> 和 <em>stdout</em> 指定了Cmd实例或子类实例将用于输入和输出的输入和输出文件对象。如果没有指定，他们将默认为 <code>sys.stdin</code> 和 <code>sys.stdout</code> 。</p>
<p>如果你想要使用一个给定的 <em>stdin</em> ，确保将实例的 <code>use_rawinput</code> 属性设置为 <code>False</code> ，否则 <em>stdin</em> 将被忽略。</p>
<h3 id="Cmd-对象"><a href="#Cmd-对象" class="headerlink" title="Cmd 对象"></a>Cmd 对象</h3><p><code>Cmd</code> 实例有下列方法：</p>
<p><code>Cmd.cmdloop</code>(<em>intro=None</em>)</p>
<p>反复发出提示，接受输入，从收到的输入中解析出一个初始前缀，并分派给操作方法，将其余的行作为参数传递给它们。</p>
<p>可选参数是在第一个提示之前发布的横幅或介绍字符串（这将覆盖 <code>intro</code> 类属性）。</p>
<p>如果 <code>readline</code> 继承模块被加载，输入将自动继承类似 <strong>bash</strong>的历史列表编辑（例如， Control-P 滚动回到最后一个命令， Control-N 转到下一个命令，以 Control-F 非破坏性的方式向右 Control-B 移动光标，破坏性地等）。</p>
<p>输入的文件结束符被作为字符串传回 <code>'EOF'</code> 。</p>
<p>解释器实例将会识别命令名称 <code>foo</code> 当且仅当它有方法 <code>do_foo()</code> 。有一个特殊情况，分派始于字符 <code>'?'</code> 的行到方法 <code>do_help()</code> 。另一种特殊情况，分派始于字符 <code>'!'</code> 的行到方法 <code>do_shell()</code> （如果定义了这个方法）</p>
<p>这个方法将返回当 <code>postcmd()</code> 方法返回一个真值 。参数 <em>stop</em> 到 <code>postcmd()</code> 是命令对应的返回值 <code>do_*()</code> 的方法。</p>
<p>如果激活了完成，全部命令将会自动完成，并且通过调用 <code>complete_foo()</code> 参数 <em>text</em> , <em>line</em>, <em>begidx</em> ,和 <em>endidx</em> 完成全部命令参数。 <em>text</em> 是我们试图匹配的字符串前缀，所有返回的匹配项必须以它为开头。 <em>line</em> 是删除了前导空格的当前的输入行， <em>begidx</em> 和 <em>endidx</em> 是前缀文本的开始和结束索引。，可以用于根据参数位置提供不同的完成。</p>
<p>所有 <code>Cmd</code> 的子类继承一个预定义 <code>do_help()</code> 。 这个方法使用参数 <code>'bar'</code> 调用， 调用对应的方法 <code>help_bar()</code> ，如果不存在，打印 <code>do_bar()</code> 的文档字符串，如果可用。没有参数的情况下， <code>do_help()</code> 方法会列出所有可用的帮助主题 （即所有具有相应的 <code>help_*()</code> 方法或命令的 文档字符串），也会列举所有未被记录的命令。</p>
<p><code>Cmd.onecmd</code>(<em>str</em>)</p>
<p>解释该参数，就好像它是为响应提示而键入的一样。 这可能会被覆盖，但通常不应该被覆盖; 用于执行有用的挂钩。 返回值是一个标志，指示解释器对命令的解释是否应该停止。 如果命令 <em>str</em> 有一个 <code>do_*()</code> 方法，则返回该方法的返回值，否则返回 <code>default()</code> 方法的返回值。</p>
<p><code>Cmd.emptyline</code>()</p>
<p>在响应提示输入空行时调用的方法。如果此方法未被覆盖，则重复输入的最后一个非空命令。</p>
<p><code>Cmd.default</code>(<em>line</em>)</p>
<p>当命令前缀不能被识别的时候在输入行调用的方法。如果此方法未被覆盖，它将输出一个错误信息并返回。</p>
<p><code>Cmd.completedefault</code>(<em>text</em>, <em>line</em>, <em>begidx</em>, <em>endidx</em>)</p>
<p>当没有特定于命令的 <code>complete_*()</code> 方法可用时，调用此方法完成输入行。默认情况下，它返回一个空列表。</p>
<p><code>Cmd.precmd</code>(<em>line</em>)</p>
<p>钩方法在命令行 <em>line</em> 被解释之前执行，但是在输入提示被生成和发出后。这个方法是一个在 <code>Cmd</code> 中的存根；它的存在是为了被子类覆盖。返回值被用作 <code>onecmd()</code> 方法执行的命令； <code>precmd()</code> 的实现或许会重写命令或者简单的返回 <em>line</em> 不变。</p>
<p><code>Cmd.postcmd</code>(<em>stop</em>, <em>line</em>)</p>
<p>钩方法只在命令调度完成后执行。这个方法是一个在 <code>Cmd</code> 中的存根；它的存在是为了子类被覆盖。 <em>line</em> 是被执行的命令行， <em>stop</em> 是一个表示在调用 <code>postcmd()</code> 之后是否终止执行的标志；这将作为 <code>onecmd()</code> 方法的返回值。这个方法的返回值被用作与 <em>stop</em> 相关联的内部标志的新值；返回 false 将导致解释继续。</p>
<p><code>Cmd.preloop</code>()</p>
<p>钩方法当 <code>cmdloop()</code> 被调用时执行一次。方法是一个在 <code>Cmd</code> 中的存根；它的存在是为了被子类覆盖。</p>
<p><code>Cmd.postloop</code>()</p>
<p>钩方法在 <code>cmdloop()</code> 即将返回时执行一次。这个方法是一个在 <code>Cmd</code> 中的存根；它的存在是为了被子类覆盖。</p>
<p>Instances of <code>Cmd</code> subclasses have some public instance variables:</p>
<pre><code>Cmd.prompt</code></pre><p>发出提示以请求输入。</p>
<pre><code>Cmd.identchars</code></pre><p>接受命令前缀的字符串。</p>
<pre><code>Cmd.lastcmd</code></pre><p>看到最后一个非空命令前缀。</p>
<pre><code>Cmd.cmdqueue</code></pre><p>排队的输入行列表。当需要新的输入时，在 <code>cmdloop()</code> 中检查 cmdqueue 列表；如果它不是空的，它的元素将被按顺序处理，就像在提示符处输入一样。</p>
<pre><code>Cmd.intro</code></pre><p>要作为简介或横幅发出的字符串。 可以通过给 <code>cmdloop()</code> 方法一个参数来覆盖它。</p>
<pre><code>Cmd.doc_header</code></pre><p>如果帮助输出具有记录命令的段落，则发出头文件。</p>
<pre><code>Cmd.misc_header</code></pre><p>如果帮助输出其他帮助主题的部分（即与 <code>do_*()</code> 方法没有关联的 <code>help_*()</code> 方法），则发出头文件。</p>
<pre><code>Cmd.undoc_header</code></pre><p>如果帮助输出未被记录命令的部分（即与 <code>help_*()</code> 方法没有关联的 <code>do_*()</code> 方法），则发出头文件。</p>
<pre><code>Cmd.ruler</code></pre><p>用于在帮助信息标题的下方绘制分隔符的字符，如果为空，则不绘制标尺线。这个字符默认是 <code>'='</code> 。</p>
<pre><code>Cmd.use_rawinput</code></pre><p>这是一个标志，默认为 true 。如果为 true ，, <code>cmdloop()</code> 使用 <code>input()</code> 先是提示并且阅读下一个命令；如果为 false ， <code>sys.stdout.write()</code> 和 <code>sys.stdin.readline()</code> 被使用。（这意味着解释器将会自动支持类似于 <strong>Emacs</strong>的行编辑和命令历史记录按键操作，通过导入 <code>readline</code> 在支持它的系统上。）</p>
<h3 id="Cmd-例子"><a href="#Cmd-例子" class="headerlink" title="Cmd 例子"></a>Cmd 例子</h3><p>The <code>cmd</code> module is mainly useful for building custom shells that let a user work with a program interactively.</p>
<p>这部分提供了一个简单的例子来介绍如何使用一部分在 <code>turtle</code> 模块中的命令构建一个 shell 。</p>
<p>基础的 turtle 命令比如 <code>forward()</code> 被添加进一个 <code>Cmd</code> 子类，方法名为 <code>do_forward()</code> 。参数被转换成数字并且分发至 turtle 模块中。 docstring 是 shell 提供的帮助实用程序。</p>
<p>例子也包含使用 <code>precmd()</code> 方法实现基础的记录和回放的功能，这个方法负责将输入转换为小写并且将命令写入文件。 <code>do_playback()</code> 方法读取文件并添加记录命令至 <code>cmdqueue</code> 用于即时回放:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> cmd<span class="token punctuation">,</span> sys
<span class="token keyword">from</span> turtle <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">class</span> <span class="token class-name">TurtleShell</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>Cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    intro <span class="token operator">=</span> <span class="token string">'Welcome to the turtle shell.   Type help or ? to list commands.\n'</span>
    prompt <span class="token operator">=</span> <span class="token string">'(turtle) '</span>
    file <span class="token operator">=</span> None
    <span class="token comment" spellcheck="true"># ----- basic turtle commands -----</span>
    <span class="token keyword">def</span> <span class="token function">do_forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Move the turtle forward by the specified distance:  FORWARD 10'</span>
        forward<span class="token punctuation">(</span><span class="token operator">*</span>parse<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_right</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Turn turtle right by given number of degrees:  RIGHT 20'</span>
        right<span class="token punctuation">(</span><span class="token operator">*</span>parse<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_left</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Turn turtle left by given number of degrees:  LEFT 90'</span>
        left<span class="token punctuation">(</span><span class="token operator">*</span>parse<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_goto</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Move turtle to an absolute position with changing orientation.  GOTO 100 200'</span>
        goto<span class="token punctuation">(</span><span class="token operator">*</span>parse<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_home</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Return turtle to the home position:  HOME'</span>
        home<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_circle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Draw circle with given radius an options extent and steps:  CIRCLE 50'</span>
        circle<span class="token punctuation">(</span><span class="token operator">*</span>parse<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_position</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Print the current turtle position:  POSITION'</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Current position is %d %d\n'</span> <span class="token operator">%</span> position<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_heading</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Print the current turtle heading in degrees:  HEADING'</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Current heading is %d\n'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>heading<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_color</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Set the color:  COLOR BLUE'</span>
        color<span class="token punctuation">(</span>arg<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_undo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Undo (repeatedly) the last turtle action(s):  UNDO'</span>
    <span class="token keyword">def</span> <span class="token function">do_reset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Clear the screen and return turtle to center:  RESET'</span>
        reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_bye</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Stop recording, close the turtle window, and exit:  BYE'</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Thank you for using Turtle'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        bye<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token comment" spellcheck="true"># ----- record and playback -----</span>
    <span class="token keyword">def</span> <span class="token function">do_record</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Save future commands to filename:  RECORD rose.cmd'</span>
        self<span class="token punctuation">.</span>file <span class="token operator">=</span> open<span class="token punctuation">(</span>arg<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">do_playback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">'Playback commands from a file:  PLAYBACK rose.cmd'</span>
        self<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>cmdqueue<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">precmd</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> line<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>file <span class="token operator">and</span> <span class="token string">'playback'</span> <span class="token operator">not</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> file<span class="token operator">=</span>self<span class="token punctuation">.</span>file<span class="token punctuation">)</span>
        <span class="token keyword">return</span> line
    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>file<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>file <span class="token operator">=</span> None
<span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">'Convert a series of zero or more numbers to an argument tuple'</span>
    <span class="token keyword">return</span> tuple<span class="token punctuation">(</span>map<span class="token punctuation">(</span>int<span class="token punctuation">,</span> arg<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    TurtleShell<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cmdloop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这是一个示例会话，其中 turtle shell 显示帮助功能，使用空行重复命令，以及简单的记录和回放功能：</p>
<pre class="line-numbers language-python"><code class="language-python">Welcome to the turtle shell<span class="token punctuation">.</span>   Type help <span class="token operator">or</span> ? to list commands<span class="token punctuation">.</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> ?
Documented commands <span class="token punctuation">(</span>type help <span class="token operator">&lt;</span>topic<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
bye     color    goto     home  playback  record  right
circle  forward  heading  left  position  reset   undo
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> help forward
Move the turtle forward by the specified distance<span class="token punctuation">:</span>  FORWARD <span class="token number">10</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> record spiral<span class="token punctuation">.</span>cmd
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> position
Current position <span class="token keyword">is</span> <span class="token number">0</span> <span class="token number">0</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> heading
Current heading <span class="token keyword">is</span> <span class="token number">0</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> reset
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">20</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">40</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">60</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">80</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">100</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">120</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">30</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> circle <span class="token number">120</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> heading
Current heading <span class="token keyword">is</span> <span class="token number">180</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">100</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">90</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">100</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">90</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">400</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">90</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">500</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">90</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">400</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> right <span class="token number">90</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> forward <span class="token number">300</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> playback spiral<span class="token punctuation">.</span>cmd
Current position <span class="token keyword">is</span> <span class="token number">0</span> <span class="token number">0</span>
Current heading <span class="token keyword">is</span> <span class="token number">0</span>
Current heading <span class="token keyword">is</span> <span class="token number">180</span>
<span class="token punctuation">(</span>turtle<span class="token punctuation">)</span> bye
Thank you <span class="token keyword">for</span> using Turtle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Tk图形用户界面-GUI"><a href="#Tk图形用户界面-GUI" class="headerlink" title="Tk图形用户界面(GUI)"></a>Tk图形用户界面(GUI)</h1><p>Tcl/Tk集成到Python中已经有一些年头了。Python程序员可以通过 <code>tkinter</code> 包和它的扩展， <code>tkinter.tix</code> 模块和 <code>tkinter.ttk</code> 模块，来使用这套鲁棒的、平台无关的窗口工具集。</p>
<p><code>tkinter</code> 包是使用面向对象方式对 Tcl/Tk 进行的一层薄包装。 使用 <code>tkinter</code>，你不需要写 Tcl 代码，但你将需要参阅 Tk 文档，有时还需要参阅 Tcl 文档。 <code>tkinter</code> 是一组包装器，它将 Tk 的可视化部件实现为相应的 Python 类。</p>
<p><code>tkinter</code> 的主要特点是速度很快，并且通常直接附带在 Python 中。 虽然它的官方文档做得不好，但还是有许多可用的资源，包括：在线参考、教程、入门书等等。 <code>tkinter</code> 还有众所周知的较过时的外观界面，这在 Tk 8.5 中已得到很大改进。 无论如何，你还可以考虑许多其他的 GUI 库。 Python wiki 例出了一些替代性的 <a href="https://wiki.python.org/moin/GuiProgramming" target="_blank" rel="noopener">GUI 框架和工具</a>。</p>
<ul>
<li><code>tkinter</code> — Tcl/Tk的Python接口<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#architecture" target="_blank" rel="noopener">Architecture</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#tkinter-modules" target="_blank" rel="noopener">Tkinter 模块</a></li>
<li>Tkinter Life Preserver<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#a-hello-world-program" target="_blank" rel="noopener">A Hello World Program</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#important-tk-concepts" target="_blank" rel="noopener">Important Tk Concepts</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#understanding-how-tkinter-wraps-tcl-tk" target="_blank" rel="noopener">Understanding How Tkinter Wraps Tcl/Tk</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#how-do-i-what-option-does" target="_blank" rel="noopener">How do I…? What option does…?</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#navigating-the-tcl-tk-reference-manual" target="_blank" rel="noopener">Navigating the Tcl/Tk Reference Manual</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#threading-model" target="_blank" rel="noopener">Threading model</a></li>
<li>Handy Reference<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#setting-options" target="_blank" rel="noopener">Setting Options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#the-packer" target="_blank" rel="noopener">The Packer</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#packer-options" target="_blank" rel="noopener">Packer Options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#coupling-widget-variables" target="_blank" rel="noopener">Coupling Widget Variables</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#the-window-manager" target="_blank" rel="noopener">The Window Manager</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#tk-option-data-types" target="_blank" rel="noopener">Tk Option Data Types</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#bindings-and-events" target="_blank" rel="noopener">Bindings and Events</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#the-index-parameter" target="_blank" rel="noopener">The index Parameter</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#images" target="_blank" rel="noopener">Images</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.html#file-handlers" target="_blank" rel="noopener">File Handlers</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.colorchooser.html" target="_blank" rel="noopener"><code>tkinter.colorchooser</code> — 颜色选择对话框</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.font.html" target="_blank" rel="noopener"><code>tkinter.font</code> — Tkinter 字体封装</a></li>
<li>Tkinter 对话框<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/dialog.html#module-tkinter.simpledialog" target="_blank" rel="noopener"><code>tkinter.simpledialog</code> — 标准 Tkinter 输入对话框</a></li>
<li><code>tkinter.filedialog</code> — 文件选择对话框.<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/dialog.html#native-load-save-dialogs" target="_blank" rel="noopener">原生的载入/保存对话框.</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/dialog.html#module-tkinter.commondialog" target="_blank" rel="noopener"><code>tkinter.commondialog</code> — 对话窗口模板</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.messagebox.html" target="_blank" rel="noopener"><code>tkinter.messagebox</code> — Tkinter 消息提示</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.scrolledtext.html" target="_blank" rel="noopener"><code>tkinter.scrolledtext</code> — 滚动文字控件</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.dnd.html" target="_blank" rel="noopener"><code>tkinter.dnd</code> — 拖放操作支持</a></li>
<li><code>tkinter.ttk</code> — Tk主题部件<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#using-ttk" target="_blank" rel="noopener">使用 Ttk</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-widgets" target="_blank" rel="noopener">Ttk 控件</a></li>
<li>控件<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#standard-options" target="_blank" rel="noopener">标准选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#scrollable-widget-options" target="_blank" rel="noopener">可滚动控件选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#label-options" target="_blank" rel="noopener">标签选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#compatibility-options" target="_blank" rel="noopener">兼容性选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#widget-states" target="_blank" rel="noopener">控件状态</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-widget" target="_blank" rel="noopener">ttk.Widget</a></li>
</ul>
</li>
<li>组合框<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#options" target="_blank" rel="noopener">选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#virtual-events" target="_blank" rel="noopener">虚拟事件</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-combobox" target="_blank" rel="noopener">ttk.Combobox</a></li>
</ul>
</li>
<li>Spinbox<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id1" target="_blank" rel="noopener">选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id2" target="_blank" rel="noopener">虚拟事件</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-spinbox" target="_blank" rel="noopener">ttk.Spinbox</a></li>
</ul>
</li>
<li>笔记本<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id3" target="_blank" rel="noopener">选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#tab-options" target="_blank" rel="noopener">Tab 选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#tab-identifiers" target="_blank" rel="noopener">Tab Identifiers</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id4" target="_blank" rel="noopener">Virtual Events</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-notebook" target="_blank" rel="noopener">ttk.Notebook</a></li>
</ul>
</li>
<li>Progressbar<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id5" target="_blank" rel="noopener">选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-progressbar" target="_blank" rel="noopener">ttk.Progressbar</a></li>
</ul>
</li>
<li>Separator<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id6" target="_blank" rel="noopener">选项</a></li>
</ul>
</li>
<li>Sizegrip<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#platform-specific-notes" target="_blank" rel="noopener">Platform-specific notes</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#bugs" target="_blank" rel="noopener">Bugs</a></li>
</ul>
</li>
<li>Treeview<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id7" target="_blank" rel="noopener">选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#item-options" target="_blank" rel="noopener">Item Options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#tag-options" target="_blank" rel="noopener">Tag Options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#column-identifiers" target="_blank" rel="noopener">Column Identifiers</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#id8" target="_blank" rel="noopener">Virtual Events</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#ttk-treeview" target="_blank" rel="noopener">ttk.Treeview</a></li>
</ul>
</li>
<li>Ttk Styling<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.ttk.html#layouts" target="_blank" rel="noopener">Layouts</a></li>
</ul>
</li>
</ul>
</li>
<li><code>tkinter.tix</code> — TK扩展包<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#using-tix" target="_blank" rel="noopener">Using Tix</a></li>
<li>Tix Widgets<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#basic-widgets" target="_blank" rel="noopener">Basic Widgets</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#file-selectors" target="_blank" rel="noopener">File Selectors</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#hierarchical-listbox" target="_blank" rel="noopener">Hierarchical ListBox</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#tabular-listbox" target="_blank" rel="noopener">Tabular ListBox</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#manager-widgets" target="_blank" rel="noopener">Manager Widgets</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#image-types" target="_blank" rel="noopener">Image Types</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#miscellaneous-widgets" target="_blank" rel="noopener">Miscellaneous Widgets</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#form-geometry-manager" target="_blank" rel="noopener">Form Geometry Manager</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tkinter.tix.html#tix-commands" target="_blank" rel="noopener">Tix Commands</a></li>
</ul>
</li>
<li>IDLE<ul>
<li>目录<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#file-menu-shell-and-editor" target="_blank" rel="noopener">文件菜单 （命令行和编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#edit-menu-shell-and-editor" target="_blank" rel="noopener">编辑菜单（命令行和编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#format-menu-editor-window-only" target="_blank" rel="noopener">格式菜单（仅 window 编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#run-menu-editor-window-only" target="_blank" rel="noopener">运行菜单（仅 window 编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#shell-menu-shell-window-only" target="_blank" rel="noopener">Shell 菜单（仅 window 编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#debug-menu-shell-window-only" target="_blank" rel="noopener">调试菜单（仅 window 编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#options-menu-shell-and-editor" target="_blank" rel="noopener">选项菜单（命令行和编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#window-menu-shell-and-editor" target="_blank" rel="noopener">Window 菜单（命令行和编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#help-menu-shell-and-editor" target="_blank" rel="noopener">帮助菜单（命令行和编辑器）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#context-menus" target="_blank" rel="noopener">上下文菜单</a></li>
</ul>
</li>
<li>编辑和导航<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#editor-windows" target="_blank" rel="noopener">编辑窗口</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#key-bindings" target="_blank" rel="noopener">按键绑定</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#automatic-indentation" target="_blank" rel="noopener">自动缩进</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#completions" target="_blank" rel="noopener">完成</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#calltips" target="_blank" rel="noopener">提示</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#code-context" target="_blank" rel="noopener">代码上下文</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#python-shell-window" target="_blank" rel="noopener">Python Shell 窗口</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#text-colors" target="_blank" rel="noopener">文本颜色</a></li>
</ul>
</li>
<li>启动和代码执行<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#command-line-usage" target="_blank" rel="noopener">命令行语法</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#startup-failure" target="_blank" rel="noopener">启动失败</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#running-user-code" target="_blank" rel="noopener">运行用户代码</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#user-output-in-shell" target="_blank" rel="noopener">Shell中的用户输出</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#developing-tkinter-applications" target="_blank" rel="noopener">开发 tkinter 应用程序</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#running-without-a-subprocess" target="_blank" rel="noopener">在没有子进程的情况下运行</a></li>
</ul>
</li>
<li>帮助和偏好<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#help-sources" target="_blank" rel="noopener">帮助源</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#setting-preferences" target="_blank" rel="noopener">首选项设置</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#idle-on-macos" target="_blank" rel="noopener">macOS 上的IDLE</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/idle.html#extensions" target="_blank" rel="noopener">扩展</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><p>本章中描述的各模块可帮你编写 Python 程序。例如，<code>pydoc</code> 模块接受一个模块并根据该模块的内容来生成文档。<code>doctest</code> 和 <code>unittest</code> 这两个模块包含了用于编写单元测试的框架，并可用于自动测试所编写的代码，验证预期的输出是否产生。<strong>2to3</strong> 程序能够将 Python 2.x 源代码翻译成有效的 Python 3.x 源代码。</p>
<p>本章中描述的模块列表是：</p>
<ul>
<li><code>typing</code> —- 类型提示支持<ul>
<li>类型别名</li>
<li>NewType</li>
<li>可调对象（Callable）</li>
<li>泛型（Generic）</li>
<li>用户定义的泛型类型</li>
<li><code>Any</code> 类型</li>
<li>名义子类型 vs 结构子类型</li>
<li>模块内容<ul>
<li>特殊类型原语<ul>
<li>特殊类型</li>
<li>特殊形式</li>
<li>构建泛型类型</li>
<li>其他特殊指令</li>
</ul>
</li>
<li>泛型具象容器<ul>
<li>对应的内置类型</li>
<li><code>collections</code> 对应类型</li>
<li>其他具象类型</li>
</ul>
</li>
<li>抽象基类<ul>
<li><code>collections.abc</code> 对应的容器</li>
<li><code>collections.abc</code> 对应的其他类型</li>
<li>异步编程</li>
<li>上下文管理器类型</li>
</ul>
</li>
<li>协议</li>
<li>函数与装饰器</li>
<li>内省辅助器</li>
<li>常量</li>
</ul>
</li>
</ul>
</li>
<li><code>pydoc</code> —- 文档生成器和在线帮助系统</li>
<li>Python Development Mode</li>
<li>Effects of the Python Development Mode</li>
<li>ResourceWarning Example</li>
<li>Bad file descriptor error example</li>
<li><code>doctest</code> —- 测试交互性的Python示例<ul>
<li>简单用法：检查Docstrings中的示例</li>
<li>Simple Usage: Checking Examples in a Text File</li>
<li>How It Works<ul>
<li>Which Docstrings Are Examined?</li>
<li>How are Docstring Examples Recognized?</li>
<li>What’s the Execution Context?</li>
<li>What About Exceptions?</li>
<li>Option Flags</li>
<li>Directives</li>
<li>警告</li>
</ul>
</li>
<li>Basic API</li>
<li>Unittest API</li>
<li>Advanced API<ul>
<li>DocTest 对象</li>
<li>Example Objects</li>
<li>DocTestFinder 对象</li>
<li>DocTestParser 对象</li>
<li>DocTestRunner 对象</li>
<li>OutputChecker 对象</li>
</ul>
</li>
<li>调试</li>
<li>Soapbox</li>
</ul>
</li>
<li><code>unittest</code> —- 单元测试框架<ul>
<li>基本实例</li>
<li>命令行接口<ul>
<li>命令行选项</li>
</ul>
</li>
<li>探索性测试</li>
<li>组织你的测试代码</li>
<li>复用已有的测试代码</li>
<li>跳过测试与预计的失败</li>
<li>Distinguishing test iterations using subtests</li>
<li>类与函数<ul>
<li>测试用例<ul>
<li>Deprecated aliases</li>
</ul>
</li>
<li>Grouping tests</li>
<li>Loading and running tests<ul>
<li>load_tests Protocol</li>
</ul>
</li>
</ul>
</li>
<li>Class and Module Fixtures<ul>
<li>setUpClass and tearDownClass</li>
<li>setUpModule and tearDownModule</li>
</ul>
</li>
<li>信号处理</li>
</ul>
</li>
<li><code>unittest.mock</code> —- 模拟对象库<ul>
<li>快速上手</li>
<li>Mock 类<ul>
<li>Calling</li>
<li>Deleting Attributes</li>
<li>Mock names and the name attribute</li>
<li>Attaching Mocks as Attributes</li>
</ul>
</li>
<li>The patchers<ul>
<li>patch</li>
<li>patch.object</li>
<li>patch.dict</li>
<li>patch.multiple</li>
<li>patch methods: start and stop</li>
<li>patch builtins</li>
<li>TEST_PREFIX</li>
<li>Nesting Patch Decorators</li>
<li>Where to patch</li>
<li>Patching Descriptors and Proxy Objects</li>
</ul>
</li>
<li>MagicMock and magic method support<ul>
<li>Mocking Magic Methods</li>
<li>Magic Mock</li>
</ul>
</li>
<li>Helpers<ul>
<li>sentinel</li>
<li>DEFAULT</li>
<li>call</li>
<li>create_autospec</li>
<li>ANY</li>
<li>FILTER_DIR</li>
<li>mock_open</li>
<li>Autospeccing</li>
<li>Sealing mocks</li>
</ul>
</li>
</ul>
</li>
<li><code>unittest.mock</code> 上手指南<ul>
<li>使用 mock<ul>
<li>模拟方法调用</li>
<li>对象上的方法调用的 mock</li>
<li>Mocking Classes</li>
<li>Naming your mocks</li>
<li>Tracking all Calls</li>
<li>Setting Return Values and Attributes</li>
<li>Raising exceptions with mocks</li>
<li>Side effect functions and iterables</li>
<li>Mocking asynchronous iterators</li>
<li>Mocking asynchronous context manager</li>
<li>Creating a Mock from an Existing Object</li>
</ul>
</li>
<li>Patch Decorators</li>
<li>Further Examples<ul>
<li>Mocking chained calls</li>
<li>Partial mocking</li>
<li>Mocking a Generator Method</li>
<li>Applying the same patch to every test method</li>
<li>Mocking Unbound Methods</li>
<li>Checking multiple calls with mock</li>
<li>Coping with mutable arguments</li>
<li>Nesting Patches</li>
<li>Mocking a dictionary with MagicMock</li>
<li>Mock subclasses and their attributes</li>
<li>Mocking imports with patch.dict</li>
<li>Tracking order of calls and less verbose call assertions</li>
<li>More complex argument matching</li>
</ul>
</li>
</ul>
</li>
<li>2to3 - 自动将 Python 2 代码转为 Python 3 代码<ul>
<li>使用 2to3</li>
<li>修复器</li>
<li><code>lib2to3</code> —— 2to3 支持库</li>
</ul>
</li>
<li><code>test</code> —- Python回归测试包<ul>
<li>Writing Unit Tests for the <code>test</code> package</li>
<li>Running tests using the command-line interface</li>
</ul>
</li>
<li><code>test.support</code> —- Utilities for the Python test suite</li>
<li><code>test.support.socket_helper</code> —- Utilities for socket tests</li>
<li><code>test.support.script_helper</code> —- Utilities for the Python execution tests</li>
<li><code>test.support.bytecode_helper</code> —- Support tools for testing correct bytecode generation</li>
<li><code>test.support.threading_helper</code> —- Utilities for threading tests</li>
<li><code>test.support.os_helper</code> —- Utilities for os tests</li>
<li><code>test.support.import_helper</code> —- Utilities for import tests</li>
<li><code>test.support.warnings_helper</code> —- Utilities for warnings tests</li>
</ul>
<h2 id="typing-—-类型提示支持"><a href="#typing-—-类型提示支持" class="headerlink" title="typing —- 类型提示支持"></a><code>typing</code> —- 类型提示支持</h2><p>3.5 新版功能.</p>
<p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/typing.py" target="_blank" rel="noopener">Lib/typing.py</a></p>
<p>注解</p>
<p>Python 运行时不强制执行函数和变量类型注解，但这些注解可用于类型检查器、IDE、静态检查器等第三方工具。</p>
<hr>
<p>This module provides runtime support for type hints as specified by <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>, <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a>, <a href="https://www.python.org/dev/peps/pep-0544" target="_blank" rel="noopener"><strong>PEP 544</strong></a>, <a href="https://www.python.org/dev/peps/pep-0586" target="_blank" rel="noopener"><strong>PEP 586</strong></a>, <a href="https://www.python.org/dev/peps/pep-0589" target="_blank" rel="noopener"><strong>PEP 589</strong></a>, <a href="https://www.python.org/dev/peps/pep-0591" target="_blank" rel="noopener"><strong>PEP 591</strong></a>, <a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> and <a href="https://www.python.org/dev/peps/pep-0613" target="_blank" rel="noopener"><strong>PEP 613</strong></a>. The most fundamental support consists of the types <code>Any</code>, <code>Union</code>, <code>Tuple</code>, <code>Callable</code>, <code>TypeVar</code>, and <code>Generic</code>. For full specification please see <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>. For a simplified introduction to type hints see <a href="https://www.python.org/dev/peps/pep-0483" target="_blank" rel="noopener"><strong>PEP 483</strong></a>.</p>
<p>下面的函数接收与返回的都是字符串，注解方式如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">greeting</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>greeting</code> 函数中，参数 <code>name</code> 的类型是 <code>str</code>，返回类型也是 <code>str</code>。子类型也可以当作参数。</p>
<h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><p>把类型赋给别名，就可以定义类型别名。本例中，<code>Vector</code> 和 <code>list[float]</code> 相同，可互换：</p>
<pre class="line-numbers language-python"><code class="language-python">Vector <span class="token operator">=</span> list<span class="token punctuation">[</span>float<span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">scale</span><span class="token punctuation">(</span>scalar<span class="token punctuation">:</span> float<span class="token punctuation">,</span> vector<span class="token punctuation">:</span> Vector<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Vector<span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>scalar <span class="token operator">*</span> num <span class="token keyword">for</span> num <span class="token keyword">in</span> vector<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># typechecks; a list of floats qualifies as a Vector.</span>
new_vector <span class="token operator">=</span> scale<span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">5.4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>类型别名适用于简化复杂的类型签名。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sequence
ConnectionOptions <span class="token operator">=</span> dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> str<span class="token punctuation">]</span>
Address <span class="token operator">=</span> tuple<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span>
Server <span class="token operator">=</span> tuple<span class="token punctuation">[</span>Address<span class="token punctuation">,</span> ConnectionOptions<span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">broadcast_message</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> str<span class="token punctuation">,</span> servers<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>Server<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true"># The static type checker will treat the previous type signature as</span>
<span class="token comment" spellcheck="true"># being exactly equivalent to this one.</span>
<span class="token keyword">def</span> <span class="token function">broadcast_message</span><span class="token punctuation">(</span>
        message<span class="token punctuation">:</span> str<span class="token punctuation">,</span>
        servers<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>tuple<span class="token punctuation">[</span>tuple<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">,</span> dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，<code>None</code> 是一种类型提示特例，已被 <code>type(None)</code> 取代。</p>
<h3 id="NewType"><a href="#NewType" class="headerlink" title="NewType"></a>NewType</h3><p>Use the <code>NewType</code> helper class to create distinct types:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NewType
UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span>
some_id <span class="token operator">=</span> UserId<span class="token punctuation">(</span><span class="token number">524313</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>静态类型检查器把新类型当作原始类型的子类，这种方式适用于捕捉逻辑错误：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_user_name</span><span class="token punctuation">(</span>user_id<span class="token punctuation">:</span> UserId<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true"># typechecks</span>
user_a <span class="token operator">=</span> get_user_name<span class="token punctuation">(</span>UserId<span class="token punctuation">(</span><span class="token number">42351</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># does not typecheck; an int is not a UserId</span>
user_b <span class="token operator">=</span> get_user_name<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>UserId</code> 类型的变量可执行所有 <code>int</code> 操作，但返回结果都是 <code>int</code> 类型。这种方式允许在预期 <code>int</code> 时传入 <code>UserId</code>，还能防止意外创建无效的 <code>UserId</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 'output' is of type 'int', not 'UserId'</span>
output <span class="token operator">=</span> UserId<span class="token punctuation">(</span><span class="token number">23413</span><span class="token punctuation">)</span> <span class="token operator">+</span> UserId<span class="token punctuation">(</span><span class="token number">54341</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Note that these checks are enforced only by the static type checker. At runtime, the statement <code>Derived = NewType('Derived', Base)</code> will make <code>Derived</code> a class that immediately returns whatever parameter you pass it. That means the expression <code>Derived(some_value)</code> does not create a new class or introduce much overhead beyond that of a regular function call.</p>
<p>更确切地说，在运行时，<code>some_value is Derived(some_value)</code> 表达式总为 True。</p>
<p>It is invalid to create a subtype of <code>Derived</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NewType
UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Fails at runtime and does not typecheck</span>
<span class="token keyword">class</span> <span class="token class-name">AdminUserId</span><span class="token punctuation">(</span>UserId<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>However, it is possible to create a <code>NewType</code> based on a ‘derived’ <code>NewType</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NewType
UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span>
ProUserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'ProUserId'</span><span class="token punctuation">,</span> UserId<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>同时，<code>ProUserId</code> 的类型检查也可以按预期执行。</p>
<p>详见 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>。</p>
<p>注解</p>
<p>回顾上文，类型别名声明了两种彼此 <em>等价</em> 的类型。 <code>Alias = Original</code> 时，静态类型检查器认为 <code>Alias</code> 与 <code>Original</code> <em>完全等价</em>。 这种方式适用于简化复杂类型签名。</p>
<p>反之，<code>NewType</code> 声明把一种类型当作另一种类型的 <em>子类型*。<code>Derived = NewType('Derived', Original)</code> 时，静态类型检查器把 <code>Derived</code> 当作 <code>Original</code> 的 *子类</em> ，即，<code>Original</code> 类型的值不能用在预期 <code>Derived</code> 类型的位置。这种方式适用于以最小运行时成本防止逻辑错误。</p>
<p>3.5.2 新版功能.</p>
<p>在 3.10 版更改: <code>NewType</code> is now a class rather than a function. There is some additional runtime cost when calling <code>NewType</code> over a regular function. However, this cost will be reduced in 3.11.0.</p>
<h3 id="可调对象（Callable）"><a href="#可调对象（Callable）" class="headerlink" title="可调对象（Callable）"></a>可调对象（Callable）</h3><p>预期特定签名回调函数的框架可以用 <code>Callable[[Arg1Type, Arg2Type], ReturnType]</code> 实现类型提示。</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Callable
<span class="token keyword">def</span> <span class="token function">feeder</span><span class="token punctuation">(</span>get_next_item<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Body</span>
<span class="token keyword">def</span> <span class="token function">async_query</span><span class="token punctuation">(</span>on_success<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">,</span>
                on_error<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span><span class="token punctuation">[</span>int<span class="token punctuation">,</span> Exception<span class="token punctuation">]</span><span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Body</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>无需指定调用签名，用省略号字面量替换类型提示里的参数列表： <code>Callable[..., ReturnType]</code>，就可以声明可调对象的返回类型。</p>
<p>Callables which take other callables as arguments may indicate that their parameter types are dependent on each other using <code>ParamSpec</code>. Additionally, if that callable adds or removes arguments from other callables, the <code>Concatenate</code> operator may be used. They take the form <code>Callable[ParamSpecVariable, ReturnType]</code> and <code>Callable[Concatenate[Arg1Type, Arg2Type, ..., ParamSpecVariable], ReturnType]</code> respectively.</p>
<p>在 3.10 版更改: <code>Callable</code> now supports <code>ParamSpec</code> and <code>Concatenate</code>. See <a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> for more information.</p>
<p>参见</p>
<p>The documentation for <code>ParamSpec</code> and <code>Concatenate</code> provide examples of usage in <code>Callable</code>.</p>
<h3 id="泛型（Generic）"><a href="#泛型（Generic）" class="headerlink" title="泛型（Generic）"></a>泛型（Generic）</h3><p>容器中，对象的类型信息不能以泛型方式静态推断，因此，抽象基类扩展支持下标，用于表示容器元素的预期类型。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Mapping<span class="token punctuation">,</span> Sequence
<span class="token keyword">def</span> <span class="token function">notify_by_email</span><span class="token punctuation">(</span>employees<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>Employee<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    overrides<span class="token punctuation">:</span> Mapping<span class="token punctuation">[</span>str<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>typing 模块中新推出的 <code>TypeVar</code> 工厂函数实现泛型参数化。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sequence
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># Declare type variable</span>
<span class="token keyword">def</span> <span class="token function">first</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> T<span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># Generic function</span>
    <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="用户定义的泛型类型"><a href="#用户定义的泛型类型" class="headerlink" title="用户定义的泛型类型"></a>用户定义的泛型类型</h3><p>用户定义的类可以定义为泛型类。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
<span class="token keyword">from</span> logging <span class="token keyword">import</span> Logger
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">LoggedVar</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> T<span class="token punctuation">,</span> name<span class="token punctuation">:</span> str<span class="token punctuation">,</span> logger<span class="token punctuation">:</span> Logger<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>logger <span class="token operator">=</span> logger
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">'Set '</span> <span class="token operator">+</span> repr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> new
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> T<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">'Get '</span> <span class="token operator">+</span> repr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>value
    <span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'%s: %s'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Generic[T]</code> 是定义类 <code>LoggedVar</code> 的基类，该类使用单类型参数 <code>T</code>。在该类体内，<code>T</code> 是有效的类型。</p>
<p><code>Generic</code> 基类定义了 <code>__class_getitem__()</code> ，因此，<code>LoggedVar[t]</code> 也是有效类型：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable
<span class="token keyword">def</span> <span class="token function">zero_all_vars</span><span class="token punctuation">(</span>vars<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span>LoggedVar<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token keyword">for</span> var <span class="token keyword">in</span> vars<span class="token punctuation">:</span>
        var<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>泛型类型支持多个类型变量，不过，类型变量可能会受到限制：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
S <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span> int<span class="token punctuation">,</span> str<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">StrangePair</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">,</span> S<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Generic</code> 类型变量的参数应各不相同。下列代码就是无效的：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Pair</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># INVALID</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Generic</code> 支持多重继承：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sized
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span>Sized<span class="token punctuation">,</span> Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继承自泛型类时，可以修正某些类型变量：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Mapping
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyDict</span><span class="token punctuation">(</span>Mapping<span class="token punctuation">[</span>str<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>比如，本例中 <code>MyDict</code> 调用的单参数，<code>T</code>。</p>
<p>未指定泛型类的类型参数时，每个位置的类型都预设为 <code>Any</code>。下例中，<code>MyIterable</code> 不是泛型，但却隐式继承了 <code>Iterable[Any]</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable
<span class="token keyword">class</span> <span class="token class-name">MyIterable</span><span class="token punctuation">(</span>Iterable<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># Same as Iterable[Any]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>还支持用户定义的泛型类型别名。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar
S <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">)</span>
Response <span class="token operator">=</span> Iterable<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">|</span> int
<span class="token comment" spellcheck="true"># Return type here is same as Iterable[str] | int</span>
<span class="token keyword">def</span> <span class="token function">response</span><span class="token punctuation">(</span>query<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Response<span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">,</span> int<span class="token punctuation">,</span> float<span class="token punctuation">,</span> complex<span class="token punctuation">)</span>
Vec <span class="token operator">=</span> Iterable<span class="token punctuation">[</span>tuple<span class="token punctuation">[</span>T<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">inproduct</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> Vec<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> T<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># Same as Iterable[tuple[T, T]]</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">(</span>x<span class="token operator">*</span>y <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> v<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 3.7 版更改: <code>Generic</code> 不再支持自定义元类。</p>
<p>User-defined generics for parameter expressions are also supported via parameter specification variables in the form <code>Generic[P]</code>. The behavior is consistent with type variables’ described above as parameter specification variables are treated by the typing module as a specialized type variable. The one exception to this is that a list of types can be used to substitute a <code>ParamSpec</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> typing <span class="token keyword">import</span> Generic<span class="token punctuation">,</span> ParamSpec<span class="token punctuation">,</span> TypeVar
<span class="token operator">>></span><span class="token operator">></span> T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> P <span class="token operator">=</span> ParamSpec<span class="token punctuation">(</span><span class="token string">'P'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Z</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">,</span> P<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> Z<span class="token punctuation">[</span>int<span class="token punctuation">,</span> <span class="token punctuation">[</span>dict<span class="token punctuation">,</span> float<span class="token punctuation">]</span><span class="token punctuation">]</span>
__main__<span class="token punctuation">.</span>Z<span class="token punctuation">[</span>int<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Furthermore, a generic with only one parameter specification variable will accept parameter lists in the forms <code>X[[Type1, Type2, ...]]</code> and also <code>X[Type1, Type2, ...]</code> for aesthetic reasons. Internally, the latter is converted to the former and are thus equivalent:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">X</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>P<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span>
__main__<span class="token punctuation">.</span>X<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">[</span><span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">]</span>
__main__<span class="token punctuation">.</span>X<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Do note that generics with <code>ParamSpec</code> may not have correct <code>__parameters__</code> after substitution in some cases because they are intended primarily for static type checking.</p>
<p>在 3.10 版更改: <code>Generic</code> can now be parameterized over parameter expressions. See <code>ParamSpec</code> and <a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> for more details.</p>
<p>抽象基类可作为用户定义的泛型类的基类，且不会与元类冲突。现已不再支持泛型元类。参数化泛型的输出结果会被缓存，typing 模块的大多数类型都可哈希、可进行等价对比。</p>
<h3 id="Any-类型"><a href="#Any-类型" class="headerlink" title="Any 类型"></a><code>Any</code> 类型</h3><p><code>Any</code> 是一种特殊的类型。静态类型检查器认为所有类型均与 <code>Any</code> 兼容，同样，<code>Any</code> 也与所有类型兼容。</p>
<p>也就是说，可对 <code>Any</code> 类型的值执行任何操作或方法调用，并赋值给任意变量：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Any
a <span class="token operator">=</span> None    <span class="token comment" spellcheck="true"># type: Any</span>
a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment" spellcheck="true"># OK</span>
a <span class="token operator">=</span> <span class="token number">2</span>       <span class="token comment" spellcheck="true"># OK</span>
s <span class="token operator">=</span> <span class="token string">''</span>      <span class="token comment" spellcheck="true"># type: str</span>
s <span class="token operator">=</span> a       <span class="token comment" spellcheck="true"># OK</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Typechecks; 'item' could be any type,</span>
    <span class="token comment" spellcheck="true"># and that type might have a 'bar' method</span>
    item<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，<code>Any</code> 类型的值赋给更精确的类型时，不执行类型检查。例如，把 <code>a</code> 赋给 <code>s</code>，在运行时，即便 <code>s</code> 已声明为 <code>str</code> 类型，但接收 <code>int</code> 值时，静态类型检查器也不会报错。</p>
<p>此外，未指定返回值与参数类型的函数，都隐式地默认使用 <code>Any</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">legacy_parser</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> data
<span class="token comment" spellcheck="true"># A static type checker will treat the above</span>
<span class="token comment" spellcheck="true"># as having the same signature as:</span>
<span class="token keyword">def</span> <span class="token function">legacy_parser</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要混用动态与静态类型代码时，此操作把 <code>Any</code> 当作 <em>应急出口</em>。</p>
<p><code>Any</code> 和 <code>object</code> 的区别。与 <code>Any</code> 相似，所有类型都是 <code>object</code> 的子类型。然而，与 <code>Any</code> 不同，object 不可逆：<code>object</code> <em>不是</em> 其它类型的子类型。</p>
<p>就是说，值的类型是 <code>object</code> 时，类型检查器几乎会拒绝所有对它的操作，并且，把它赋给更精确的类型变量（或返回值）属于类型错误。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">hash_a</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> object<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Fails; an object does not have a 'magic' method.</span>
    item<span class="token punctuation">.</span>magic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">hash_b</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Typechecks</span>
    item<span class="token punctuation">.</span>magic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true"># Typechecks, since ints and strs are subclasses of object</span>
hash_a<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
hash_a<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Typechecks, since Any is compatible with all types</span>
hash_b<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
hash_b<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>object</code>，说明值能以类型安全的方式转为任何类型。使用 <code>Any</code>，说明值是动态类型。</p>
<h3 id="名义子类型-vs-结构子类型"><a href="#名义子类型-vs-结构子类型" class="headerlink" title="名义子类型 vs 结构子类型"></a>名义子类型 vs 结构子类型</h3><p><a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> 最初只是把 Python 静态类型系统定义为应用 <em>名义子类型</em>。即，当且仅当 <code>A</code> 是 <code>B</code> 的子类时，才能在预期 <code>B</code> 类时应用 <code>A</code> 类。</p>
<p>此项要求以前也适用于抽象基类，例如，<code>Iterable</code> 。这种方式的问题在于，定义类时必须显式说明，既不 Pythonic，也不是动态类型式 Python 代码的惯用写法。例如，下列代码就遵从了 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> 的规范：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Sized<span class="token punctuation">,</span> Iterable<span class="token punctuation">,</span> Iterator
<span class="token keyword">class</span> <span class="token class-name">Bucket</span><span class="token punctuation">(</span>Sized<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Iterator<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="https://www.python.org/dev/peps/pep-0544" target="_blank" rel="noopener"><strong>PEP 544</strong></a> 允许用户在类定义时不显式说明基类，从而解决了这一问题，静态类型检查器隐式认为 <code>Bucket</code> 既是 <code>Sized</code> 的子类型，又是 <code>Iterable[int]</code> 的子类型。这就是 <em>结构子类型</em> （又称为静态鸭子类型）：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterator<span class="token punctuation">,</span> Iterable
<span class="token keyword">class</span> <span class="token class-name">Bucket</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># Note: no base classes</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Iterator<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">collect</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
result <span class="token operator">=</span> collect<span class="token punctuation">(</span>Bucket<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Passes type check</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此外，结构子类型的优势在于，通过继承特殊类 <code>Protocol</code> ，用户可以定义新的自定义协议（见下文中的例子）。</p>
<h3 id="模块内容"><a href="#模块内容" class="headerlink" title="模块内容"></a>模块内容</h3><p>本模块定义了下列类、函数和修饰器。</p>
<p>注解</p>
<p>本模块定义了一些类型，作为标准库中已有的类的子类，从而可以让 <code>Generic</code> 支持 <code>[]</code> 中的类型变量。Python 3.9 中，这些标准库的类已支持 <code>[]</code> ，因此，这些类型就变得冗余了。</p>
<p>Python 3.9 弃用了这些冗余类型，但解释器并未提供相应的弃用警告。标记弃用类型的工作留待支持 Python 3.9 及以上版本的类型检查器实现。</p>
<p>Python 3.9.0 发布五年后的首个 Python 发行版将从 <code>typing</code> 模块中移除这些弃用类型。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 《<em>标准集合的类型提示泛型</em>》。</p>
<h4 id="特殊类型原语"><a href="#特殊类型原语" class="headerlink" title="特殊类型原语"></a>特殊类型原语</h4><h5 id="特殊类型"><a href="#特殊类型" class="headerlink" title="特殊类型"></a>特殊类型</h5><p>这些类型可用于类型注解，但不支持 <code>[]</code>。</p>
<pre><code>typing.Any</code></pre><p>不受限的特殊类型。</p>
<ul>
<li>所有类型都与 <code>Any</code> 兼容。</li>
<li><code>Any</code> 与所有类型都兼容。</li>
</ul>
<pre><code>typing.NoReturn</code></pre><p>标记没有返回值的函数的特殊类型。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NoReturn
<span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> NoReturn<span class="token punctuation">:</span>
    <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'no way'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.5.4 新版功能.</p>
<p>3.6.2 新版功能.</p>
<pre><code>typing.TypeAlias</code></pre><p>Special annotation for explicitly declaring a type alias. For example:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeAlias
Factors<span class="token punctuation">:</span> TypeAlias <span class="token operator">=</span> list<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>See <a href="https://www.python.org/dev/peps/pep-0613" target="_blank" rel="noopener"><strong>PEP 613</strong></a> for more details about explicit type aliases.</p>
<p>3.10 新版功能.</p>
<h5 id="特殊形式"><a href="#特殊形式" class="headerlink" title="特殊形式"></a>特殊形式</h5><p>可用于类型注解，且支持 <code>[]</code> ，每种形式都有其独特的句法。</p>
<pre><code>typing.Tuple</code></pre><p>元组类型； <code>Tuple[X, Y]</code> 是二项元组类型，第一个元素的类型是 X，第二个元素的类型是 Y。空元组的类型可写为 <code>Tuple[()]</code>。</p>
<p>例：<code>Tuple[T1, T2]</code> 是二项元组，类型变量分别为 T1 和 T2。<code>Tuple[int, float, str]</code> 是由整数、浮点数、字符串组成的三项元组。</p>
<p>可用省略号字面量指定同质变长元组，例如，<code>Tuple[int, ...]</code> 。<code>Tuple</code> 与 <code>Tuple[Any, ...]</code> 等价，也与 <code>tuple</code> 等价。</p>
<p>3.9 版后已移除: <code>builtins.tuple</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<pre><code>typing.Union</code></pre><p>Union type; <code>Union[X, Y]</code> is equivalent to <code>X | Y</code> and means either X or Y.</p>
<p>To define a union, use e.g. <code>Union[int, str]</code> or the shorthand <code>int | str</code>. Details:</p>
<ul>
<li><p>参数必须是某种类型，且至少有一个。</p>
</li>
<li><p>联合类型之联合类型会被展平，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">Union<span class="token punctuation">[</span>Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">,</span> float<span class="token punctuation">]</span> <span class="token operator">==</span> Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">,</span> float<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>单参数之联合类型就是该参数自身，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">Union<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">==</span> int  <span class="token comment" spellcheck="true"># The constructor actually returns int</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>冗余的参数会被跳过，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">,</span> int<span class="token punctuation">]</span> <span class="token operator">==</span> Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span> <span class="token operator">==</span> int <span class="token operator">|</span> str<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>比较联合类型，不涉及参数顺序，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span> <span class="token operator">==</span> Union<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>You cannot subclass or instantiate a <code>Union</code>.</p>
</li>
<li><p>不支持 <code>Union[X][Y]</code> 这种写法。</p>
</li>
</ul>
<p>在 3.7 版更改: 在运行时，不要移除联合类型中的显式子类。</p>
<p>在 3.10 版更改: Unions can now be written as <code>X | Y</code>. See union type expressions.</p>
<pre><code>typing.Optional</code></pre><p>可选类型。</p>
<p><code>Optional[X]</code> is equivalent to <code>X | None</code> (or <code>Union[X, None]</code>).</p>
<p>注意，可选类型与含默认值的可选参数不同。含默认值的可选参数不需要在类型注解上添加 <code>Optional</code> 限定符，因为它仅是可选的。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>另一方面，显式应用 <code>None</code> 值时，不管该参数是否可选， <code>Optional</code> 都适用。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在 3.10 版更改: Optional can now be written as <code>X | None</code>. See union type expressions.</p>
<pre><code>typing.Callable</code></pre><p>可调类型； <code>Callable[[int], str]</code> 是把（int）转为 str 的函数。</p>
<p>下标句法必须与参数列表和返回类型这两个值一起使用。参数列表只能是类型列表或省略号；返回类型只能是单一类型。</p>
<p>没有说明可选参数或关键字参数的句法；这类函数类型很少用作回调类型。<code>Callable[..., ReturnType]</code> （省略号字面量）可用于为接受任意数量参数，并返回 <code>ReturnType</code> 的可调对象提供类型提示。纯 <code>Callable</code> 等价于 <code>Callable[..., Any]</code>，进而等价于 <code>collections.abc.Callable</code> 。</p>
<p>Callables which take other callables as arguments may indicate that their parameter types are dependent on each other using <code>ParamSpec</code>. Additionally, if that callable adds or removes arguments from other callables, the <code>Concatenate</code> operator may be used. They take the form <code>Callable[ParamSpecVariable, ReturnType]</code> and <code>Callable[Concatenate[Arg1Type, Arg2Type, ..., ParamSpecVariable], ReturnType]</code> respectively.</p>
<p>3.9 版后已移除: <code>collections.abc.Callable</code> 现已支持 <code>[]</code>。 详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p>在 3.10 版更改: <code>Callable</code> now supports <code>ParamSpec</code> and <code>Concatenate</code>. See <a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> for more information.</p>
<p>参见</p>
<p>The documentation for <code>ParamSpec</code> and <code>Concatenate</code> provide examples of usage with <code>Callable</code>.</p>
<pre><code>typing.Concatenate</code></pre><p>Used with <code>Callable</code> and <code>ParamSpec</code> to type annotate a higher order callable which adds, removes, or transforms parameters of another callable. Usage is in the form <code>Concatenate[Arg1Type, Arg2Type, ..., ParamSpecVariable]</code>. <code>Concatenate</code> is currently only valid when used as the first argument to a <code>Callable</code>. The last parameter to <code>Concatenate</code> must be a <code>ParamSpec</code>.</p>
<p>For example, to annotate a decorator <code>with_lock</code> which provides a <code>threading.Lock</code> to the decorated function, <code>Concatenate</code> can be used to indicate that <code>with_lock</code> expects a callable which takes in a <code>Lock</code> as the first argument, and returns a callable with a different type signature. In this case, the <code>ParamSpec</code> indicates that the returned callable’s parameter types are dependent on the parameter types of the callable being passed in:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Callable
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Any<span class="token punctuation">,</span> Concatenate<span class="token punctuation">,</span> ParamSpec<span class="token punctuation">,</span> TypeVar
P <span class="token operator">=</span> ParamSpec<span class="token punctuation">(</span><span class="token string">'P'</span><span class="token punctuation">)</span>
R <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'R'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Use this lock to ensure that only one thread is executing a function</span>
<span class="token comment" spellcheck="true"># at any time.</span>
my_lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">with_lock</span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span>Concatenate<span class="token punctuation">[</span>Lock<span class="token punctuation">,</span> P<span class="token punctuation">]</span><span class="token punctuation">,</span> R<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">[</span>P<span class="token punctuation">,</span> R<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''A type-safe decorator which provides a lock.'''</span>
    <span class="token keyword">global</span> my_lock
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">:</span> P<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> P<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> R<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Provide the lock as the first argument.</span>
        <span class="token keyword">return</span> f<span class="token punctuation">(</span>my_lock<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> inner
@with_lock
<span class="token keyword">def</span> <span class="token function">sum_threadsafe</span><span class="token punctuation">(</span>lock<span class="token punctuation">:</span> Lock<span class="token punctuation">,</span> numbers<span class="token punctuation">:</span> list<span class="token punctuation">[</span>float<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> float<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Add a list of numbers together in a thread-safe manner.'''</span>
    <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># We don't need to pass in the lock ourselves thanks to the decorator.</span>
sum_threadsafe<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">3.3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.10 新版功能.</p>
<p>参见</p>
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> — Parameter Specification Variables (the PEP which introduced <code>ParamSpec</code> and <code>Concatenate</code>).</li>
<li><code>ParamSpec</code> and <code>Callable</code>.</li>
</ul>
<p><em>class</em> <code>typing.Type</code>(<em>Generic[CT_co]</em>)</p>
<p>用 <code>C</code> 注解的变量可以接受类型 <code>C</code> 的值。反之，用 <code>Type[C]</code> 注解的变量可以接受类自身的值 — 准确地说，是接受 <code>C</code> 的 <em>类对象</em>，例如：</p>
<pre class="line-numbers language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">3</span>         <span class="token comment" spellcheck="true"># Has type 'int'</span>
b <span class="token operator">=</span> int       <span class="token comment" spellcheck="true"># Has type 'Type[int]'</span>
c <span class="token operator">=</span> type<span class="token punctuation">(</span>a<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># Also has type 'Type[int]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意，<code>Type[C]</code> 为协变量：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">BasicUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">ProUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">TeamUser</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true"># Accepts User, BasicUser, ProUser, TeamUser, ...</span>
<span class="token keyword">def</span> <span class="token function">make_new_user</span><span class="token punctuation">(</span>user_class<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> User<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># ...</span>
    <span class="token keyword">return</span> user_class<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Type[C]</code> 为协变量的意思是指， <code>C</code> 的所有子类都应使用与 <code>C</code> 相同的构造器签名及类方法签名。类型检查器应标记违反此项规定的内容，但也应允许符合指定基类构造器调用的子类进行构造器调用。<a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> 修订版将来可能会调整类型检查器对这种特例的处理方式。</p>
<p><code>Type</code> 合法的参数仅有类、<code>Any</code> 、类型变量 以及上述类型的联合类型。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">new_non_team_user</span><span class="token punctuation">(</span>user_class<span class="token punctuation">:</span> Type<span class="token punctuation">[</span>BasicUser <span class="token operator">|</span> ProUser<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>Type[Any]</code> 等价于 <code>Type</code>，进而等价于 Python 元类架构的根基，<code>type</code>。</p>
<p>3.5.2 新版功能.</p>
<p>3.9 版后已移除: <code>builtins.type</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<pre><code>typing.Literal</code></pre><p>表示类型检查器对应变量或函数参数的值等价于给定字面量（或多个字面量之一）的类型。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">validate_simple</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Literal<span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># always returns True</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
MODE <span class="token operator">=</span> Literal<span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">open_helper</span><span class="token punctuation">(</span>file<span class="token punctuation">:</span> str<span class="token punctuation">,</span> mode<span class="token punctuation">:</span> MODE<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
open_helper<span class="token punctuation">(</span><span class="token string">'/some/path'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Passes type check</span>
open_helper<span class="token punctuation">(</span><span class="token string">'/other/path'</span><span class="token punctuation">,</span> <span class="token string">'typo'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Error in type checker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Literal[...]</code> 不能创建子类。在运行时，任意值均可作为 <code>Literal[...]</code> 的类型参数，但类型检查器可以对此加以限制。字面量类型详见 <a href="https://www.python.org/dev/peps/pep-0586" target="_blank" rel="noopener"><strong>PEP 586</strong></a> 。</p>
<p>3.8 新版功能.</p>
<p>在 3.9.1 版更改: <code>Literal</code> 现在能去除形参的重复。 <code>Literal</code> 对象的相等性比较不再依赖顺序。 现在如果有某个参数不为 hashable，<code>Literal</code> 对象在相等性比较期间将引发 <code>TypeError</code>。</p>
<pre><code>typing.ClassVar</code></pre><p>标记类变量的特殊类型构造器。</p>
<p>如 <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a> 所述，打包在 ClassVar 内的变量注解是指，给定属性应当用作类变量，而不应设置在类实例上。用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Starship</span><span class="token punctuation">:</span>
    stats<span class="token punctuation">:</span> ClassVar<span class="token punctuation">[</span>dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true"># class variable</span>
    damage<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span>                     <span class="token comment" spellcheck="true"># instance variable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>ClassVar</code> 仅接受类型，也不能使用下标。</p>
<p><code>ClassVar</code> 本身不是类，不应用于 <code>isinstance()</code> 或 <code>issubclass()</code>。<code>ClassVar</code> 不改变 Python 运行时行为，但可以用于第三方类型检查器。例如，类型检查器会认为以下代码有错：</p>
<pre class="line-numbers language-python"><code class="language-python">enterprise_d <span class="token operator">=</span> Starship<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
enterprise_d<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true"># Error, setting class variable on instance</span>
Starship<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>     <span class="token comment" spellcheck="true"># This is OK</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.5.3 新版功能.</p>
<pre><code>typing.Final</code></pre><p>告知类型检查器某名称不能再次赋值或在子类中重写的特殊类型构造器。例如：</p>
<pre class="line-numbers language-python"><code class="language-python">MAX_SIZE<span class="token punctuation">:</span> Final <span class="token operator">=</span> <span class="token number">9000</span>
MAX_SIZE <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># Error reported by type checker</span>
<span class="token keyword">class</span> <span class="token class-name">Connection</span><span class="token punctuation">:</span>
    TIMEOUT<span class="token punctuation">:</span> Final<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">class</span> <span class="token class-name">FastConnector</span><span class="token punctuation">(</span>Connection<span class="token punctuation">)</span><span class="token punctuation">:</span>
    TIMEOUT <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># Error reported by type checker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这些属性没有运行时检查。详见 <a href="https://www.python.org/dev/peps/pep-0591" target="_blank" rel="noopener"><strong>PEP 591</strong></a>。</p>
<p>3.8 新版功能.</p>
<pre><code>typing.Annotated</code></pre><p><a href="https://www.python.org/dev/peps/pep-0593" target="_blank" rel="noopener"><strong>PEP 593</strong></a> （<code>灵活函数和变量注解</code>）里引入的类型，可以用上下文特定元数据（<code>Annotated</code> 的参数可变，也可能用它的多个组成部分）装饰现有的类型。具体来说，就是类型提示 <code>Annotated[T, x]</code> 用元数据 <code>x</code> 注解类型 <code>T</code>。静态分析或运行时都能使用该元数据。库（或工具）处理类型提示 <code>Annotated[T, x]</code> 时，在元数据 <code>x</code> 不涉及特殊逻辑的情况下，可忽略该类型提示，仅把它当作类型 <code>T</code>。与 <code>typing</code> 模块中现有的 <code>no_type_check</code> 功能不同，该功能完全禁用了函数或类的类型检查注解，而 <code>Annotated</code> 类型则允许对 <code>T</code> 进行静态类型检查（例如，通过 mypy 或 Pyre，可安全地忽略 <code>x</code>），也可以在特定应用程序中实现 <code>x</code> 的运行时访问。</p>
<p>毕竟，如何解释注解（如有）由处理 <code>Annotated</code> 类型的工具/库负责。工具/库处理 <code>Annotated</code> 类型时，扫描所有注解以确定是否需要进行处理（例如，使用 <code>isinstance()</code>）。</p>
<p>工具/库不支持注解，或遇到未知注解时，应忽略注解，并把注解类型当作底层类型。</p>
<p>是否允许客户端在一个类型上使用多个注解，以及如何合并这些注解，由处理注解的工具决定。</p>
<p><code>Annotated</code> 类型支持把多个相同（或不同）的单个（或多个）类型注解置于任意节点。因此，使用这些注解的工具/库要负责处理潜在的重复项。例如，执行值范围分析时，应允许以下操作：</p>
<pre class="line-numbers language-python"><code class="language-python">T1 <span class="token operator">=</span> Annotated<span class="token punctuation">[</span>int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
T2 <span class="token operator">=</span> Annotated<span class="token punctuation">[</span>T1<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>传递 <code>include_extras=True</code> 至 <code>get_type_hints()</code> ，即可在运行时访问额外的注解。</p>
<p>语义详情：</p>
<ul>
<li><p><code>Annotated</code> 的第一个参数必须是有效类型。</p>
</li>
<li><p>支持多个类型标注（<code>Annotated</code> 支持可变参数）：</p>
<pre><code>Annotated[int, ValueRange(3, 10), ctype("char")]</code></pre></li>
<li><p>调用 <code>Annotated</code> 至少要有两个参数（<code>Annotated[int]</code> 是无效的）</p>
</li>
<li><p>注解的顺序会被保留，且影响等价检查：</p>
<pre class="line-numbers language-python"><code class="language-python">Annotated<span class="token punctuation">[</span>int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctype<span class="token punctuation">(</span><span class="token string">"char"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!=</span> Annotated<span class="token punctuation">[</span>
    int<span class="token punctuation">,</span> ctype<span class="token punctuation">(</span><span class="token string">"char"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>嵌套 <code>Annotated</code> 类型会被展平，元数据从最内层注解依序展开：</p>
<pre class="line-numbers language-python"><code class="language-python">Annotated<span class="token punctuation">[</span>Annotated<span class="token punctuation">[</span>int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctype<span class="token punctuation">(</span><span class="token string">"char"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> Annotated<span class="token punctuation">[</span>
    int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctype<span class="token punctuation">(</span><span class="token string">"char"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>不移除注解重复项：</p>
<pre class="line-numbers language-python"><code class="language-python">Annotated<span class="token punctuation">[</span>int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">!=</span> Annotated<span class="token punctuation">[</span>
    int<span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ValueRange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>Annotated</code> 可用于嵌套或泛型别名：</p>
<pre class="line-numbers language-python"><code class="language-python">T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
Vec <span class="token operator">=</span> Annotated<span class="token punctuation">[</span>list<span class="token punctuation">[</span>tuple<span class="token punctuation">[</span>T<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> MaxLen<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
V <span class="token operator">=</span> Vec<span class="token punctuation">[</span>int<span class="token punctuation">]</span>
V <span class="token operator">==</span> Annotated<span class="token punctuation">[</span>list<span class="token punctuation">[</span>tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> MaxLen<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>3.9 新版功能.</p>
<pre><code>typing.TypeGuard</code></pre><p>Special typing form used to annotate the return type of a user-defined type guard function. <code>TypeGuard</code> only accepts a single type argument. At runtime, functions marked this way should return a boolean.</p>
<p><code>TypeGuard</code> aims to benefit <em>type narrowing</em> — a technique used by static type checkers to determine a more precise type of an expression within a program’s code flow. Usually type narrowing is done by analyzing conditional code flow and applying the narrowing to a block of code. The conditional expression here is sometimes referred to as a “type guard”:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">is_str</span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> str <span class="token operator">|</span> float<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># "isinstance" type guard</span>
    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>val<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Type of ``val`` is narrowed to ``str``</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Else, type of ``val`` is narrowed to ``float``.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Sometimes it would be convenient to use a user-defined boolean function as a type guard. Such a function should use <code>TypeGuard[...]</code> as its return type to alert static type checkers to this intention.</p>
<p>Using <code>-&gt; TypeGuard</code> tells the static type checker that for a given function:</p>
<ol>
<li><p>The return value is a boolean.</p>
</li>
<li><p>If the return value is <code>True</code>, the type of its argument is the type inside <code>TypeGuard</code>.</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">is_str_list</span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> List<span class="token punctuation">[</span>object<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> TypeGuard<span class="token punctuation">[</span>List<span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Determines whether all objects in the list are strings'''</span>
    <span class="token keyword">return</span> all<span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>x<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> val<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">func1</span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> List<span class="token punctuation">[</span>object<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_str_list<span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Type of ``val`` is narrowed to ``List[str]``.</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Type of ``val`` remains as ``List[object]``.</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Not a list of strings!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<p>If <code>is_str_list</code> is a class or instance method, then the type in <code>TypeGuard</code> maps to the type of the second parameter after <code>cls</code> or <code>self</code>.</p>
<p>In short, the form <code>def foo(arg: TypeA) -&gt; TypeGuard[TypeB]: ...</code>, means that if <code>foo(arg)</code> returns <code>True</code>, then <code>arg</code> narrows from <code>TypeA</code> to <code>TypeB</code>.</p>
<p>注解</p>
<p><code>TypeB</code> need not be a narrower form of <code>TypeA</code> — it can even be a wider form. The main reason is to allow for things like narrowing <code>List[object]</code> to <code>List[str]</code> even though the latter is not a subtype of the former, since <code>List</code> is invariant. The responsibility of writing type-safe type guards is left to the user.</p>
<p><code>TypeGuard</code> also works with type variables. For more information, see <a href="https://www.python.org/dev/peps/pep-0647" target="_blank" rel="noopener"><strong>PEP 647</strong></a> (User-Defined Type Guards).</p>
<p>3.10 新版功能.</p>
<h5 id="构建泛型类型"><a href="#构建泛型类型" class="headerlink" title="构建泛型类型"></a>构建泛型类型</h5><p>以下内容是创建泛型类型的基石，但不在注解内使用。</p>
<p><em>class</em> <code>typing.Generic</code></p>
<p>用于泛型类型的抽象基类。</p>
<p>泛型类型一般通过继承含一个或多个类型变量的类实例进行声明。例如，泛型映射类型定义如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Mapping</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>KT<span class="token punctuation">,</span> VT<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">:</span> KT<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> VT<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment" spellcheck="true"># Etc.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>该类的用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python">X <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">)</span>
Y <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">lookup_name</span><span class="token punctuation">(</span>mapping<span class="token punctuation">:</span> Mapping<span class="token punctuation">[</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> X<span class="token punctuation">,</span> default<span class="token punctuation">:</span> Y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Y<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> mapping<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        <span class="token keyword">return</span> default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>typing.TypeVar</code></p>
<p>类型变量。</p>
<p>用法：</p>
<pre class="line-numbers language-python"><code class="language-python">T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Can be anything</span>
A <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Must be str or bytes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>类型变量主要是为静态类型检查器提供支持，用于泛型类型与泛型函数定义的参数。有关泛型类型。泛型函数的写法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">repeat</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> n<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Sequence<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Return a list containing n references to x."""</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">*</span>n
<span class="token keyword">def</span> <span class="token function">longest</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> A<span class="token punctuation">,</span> y<span class="token punctuation">:</span> A<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> A<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Return the longest of two strings."""</span>
    <span class="token keyword">return</span> x <span class="token keyword">if</span> len<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">>=</span> len<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token keyword">else</span> y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本质上，后例的签名重载了 <code>(str, str) -&gt; str</code> 与 <code>(bytes, bytes) -&gt; bytes</code>。注意，参数是 <code>str</code> 子类的实例时，返回类型仍是纯 <code>str</code>。</p>
<p>在运行时，<code>isinstance(x, T)</code> 会触发 <code>TypeError</code> 异常。一般而言，<code>isinstance()</code> 和 <code>issubclass()</code> 不应与类型搭配使用。</p>
<p>通过 <code>covariant=True</code> 或 <code>contravariant=True</code> 可以把类型变量标记为协变量或逆变量。详见 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>。默认情况下，类型变量是不变量。类型变量还可以用 <code>bound=&lt;type&gt;</code> 指定上限。这里的意思是，（显式或隐式地）取代类型变量的实际类型必须是限定类型的子类，详见 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>。</p>
<p><em>class</em> <code>typing.ParamSpec</code>(<em>name</em>, <em>**,</em> bound=None<em>,</em> covariant=False<em>,</em> contravariant=False*)</p>
<p>Parameter specification variable. A specialized version of <code>type variables</code>.</p>
<p>用法：</p>
<pre><code>P = ParamSpec('P')</code></pre><p>Parameter specification variables exist primarily for the benefit of static type checkers. They are used to forward the parameter types of one callable to another callable — a pattern commonly found in higher order functions and decorators. They are only valid when used in <code>Concatenate</code>, or as the first argument to <code>Callable</code>, or as parameters for user-defined Generics. See <code>Generic</code> for more information on generic types.</p>
<p>For example, to add basic logging to a function, one can create a decorator <code>add_logging</code> to log function calls. The parameter specification variable tells the type checker that the callable passed into the decorator and the new callable returned by it have inter-dependent type parameters:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Callable
<span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> ParamSpec
<span class="token keyword">import</span> logging
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
P <span class="token operator">=</span> ParamSpec<span class="token punctuation">(</span><span class="token string">'P'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_logging</span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> Callable<span class="token punctuation">[</span>P<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">[</span>P<span class="token punctuation">,</span> T<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''A type-safe decorator to add logging to a function.'''</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">:</span> P<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> P<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> T<span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span>f<span class="token string">'{f.__name__} was called'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> inner
@add_logging
<span class="token keyword">def</span> <span class="token function">add_two</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> float<span class="token punctuation">,</span> y<span class="token punctuation">:</span> float<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> float<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Add two numbers together.'''</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Without <code>ParamSpec</code>, the simplest way to annotate this previously was to use a <code>TypeVar</code> with bound <code>Callable[..., Any]</code>. However this causes two problems:</p>
<blockquote>
<ol>
<li>The type checker can’t type check the <code>inner</code> function because <code>*args</code> and <code>**kwargs</code> have to be typed <code>Any</code>.</li>
<li><code>cast()</code> may be required in the body of the <code>add_logging</code> decorator when returning the <code>inner</code> function, or the static type checker must be told to ignore the <code>return inner</code>.</li>
</ol>
</blockquote>
<ul>
<li><p><code>args</code></p>
</li>
<li><p><code>kwargs</code></p>
<p>Since <code>ParamSpec</code> captures both positional and keyword parameters, <code>P.args</code> and <code>P.kwargs</code> can be used to split a <code>ParamSpec</code> into its components. <code>P.args</code> represents the tuple of positional parameters in a given call and should only be used to annotate <code>*args</code>. <code>P.kwargs</code> represents the mapping of keyword parameters to their values in a given call, and should be only be used to annotate <code>**kwargs</code>. Both attributes require the annotated parameter to be in scope. At runtime, <code>P.args</code> and <code>P.kwargs</code> are instances respectively of <code>ParamSpecArgs</code> and <code>ParamSpecKwargs</code>.</p>
</li>
</ul>
<p>Parameter specification variables created with <code>covariant=True</code> or <code>contravariant=True</code> can be used to declare covariant or contravariant generic types. The <code>bound</code> argument is also accepted, similar to <code>TypeVar</code>. However the actual semantics of these keywords are yet to be decided.</p>
<p>3.10 新版功能.</p>
<p>注解</p>
<p>Only parameter specification variables defined in global scope can be pickled.</p>
<p>参见</p>
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0612" target="_blank" rel="noopener"><strong>PEP 612</strong></a> — Parameter Specification Variables (the PEP which introduced <code>ParamSpec</code> and <code>Concatenate</code>).</li>
<li><code>Callable</code> and <code>Concatenate</code>.</li>
</ul>
<pre><code>typing.ParamSpecArgs
typing.ParamSpecKwargs</code></pre><p>Arguments and keyword arguments attributes of a <code>ParamSpec</code>. The <code>P.args</code> attribute of a <code>ParamSpec</code> is an instance of <code>ParamSpecArgs</code>, and <code>P.kwargs</code> is an instance of <code>ParamSpecKwargs</code>. They are intended for runtime introspection and have no special meaning to static type checkers.</p>
<p>Calling <code>get_origin()</code> on either of these objects will return the original <code>ParamSpec</code>:</p>
<pre class="line-numbers language-python"><code class="language-python">P <span class="token operator">=</span> ParamSpec<span class="token punctuation">(</span><span class="token string">"P"</span><span class="token punctuation">)</span>
get_origin<span class="token punctuation">(</span>P<span class="token punctuation">.</span>args<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># returns P</span>
get_origin<span class="token punctuation">(</span>P<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># returns P</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.10 新版功能.</p>
<pre><code>typing.AnyStr</code></pre><p><code>AnyStr</code> 类型变量的定义为 <code>AnyStr = TypeVar('AnyStr', str, bytes)</code>。</p>
<p>这里指的是，它可以接受任意同类字符串，但不支持混用不同类别的字符串。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> AnyStr<span class="token punctuation">,</span> b<span class="token punctuation">:</span> AnyStr<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AnyStr<span class="token punctuation">:</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
concat<span class="token punctuation">(</span>u<span class="token string">"foo"</span><span class="token punctuation">,</span> u<span class="token string">"bar"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ok, output has type 'unicode'</span>
concat<span class="token punctuation">(</span>b<span class="token string">"foo"</span><span class="token punctuation">,</span> b<span class="token string">"bar"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Ok, output has type 'bytes'</span>
concat<span class="token punctuation">(</span>u<span class="token string">"foo"</span><span class="token punctuation">,</span> b<span class="token string">"bar"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Error, cannot mix unicode and bytes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>typing.Protocol</code>(<em>Generic</em>)</p>
<p>Protocol 类的基类。Protocol 类的定义如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Proto</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">meth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这些类主要与静态类型检查器搭配使用，用来识别结构子类型（静态鸭子类型），例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">meth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Proto<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span>meth<span class="token punctuation">(</span><span class="token punctuation">)</span>
func<span class="token punctuation">(</span>C<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Passes static type check</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>详见 <a href="https://www.python.org/dev/peps/pep-0544" target="_blank" rel="noopener"><strong>PEP 544</strong></a>。Protocol 类用 <code>runtime_checkable()</code> （见下文）装饰，忽略类型签名，仅检查给定属性是否存在，充当简要的运行时协议。</p>
<p>Protocol 类可以是泛型，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GenProto</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">meth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> T<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.8 新版功能.</p>
<pre><code>@``typing.runtime_checkable</code></pre><p>用于把 Protocol 类标记为运行时协议。</p>
<p>该协议可以与 <code>isinstance()</code> 和 <code>issubclass()</code> 一起使用。应用于非协议的类时，会触发 <code>TypeError</code>。该指令支持简易结构检查，与 <code>collections.abc</code> 的 <code>Iterable</code> 非常类似，只擅长做一件事。 例如：</p>
<pre class="line-numbers language-python"><code class="language-python">@runtime_checkable
<span class="token keyword">class</span> <span class="token class-name">Closable</span><span class="token punctuation">(</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">assert</span> isinstance<span class="token punctuation">(</span>open<span class="token punctuation">(</span><span class="token string">'/some/file'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Closable<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p><code>runtime_checkable()</code> will check only the presence of the required methods, not their type signatures. For example, <code>ssl.SSLObject</code> is a class, therefore it passes an <code>issubclass()</code> check against <code>Callable</code>. However, the <code>ssl.SSLObject.__init__()</code> method exists only to raise a <code>TypeError</code> with a more informative message, therefore making it impossible to call (instantiate) <code>ssl.SSLObject</code>.</p>
<p>3.8 新版功能.</p>
<h5 id="其他特殊指令"><a href="#其他特殊指令" class="headerlink" title="其他特殊指令"></a>其他特殊指令</h5><p>这些特殊指令是声明类型的基石，但不在注解内使用。</p>
<p><em>class</em> <code>typing.NamedTuple</code></p>
<p><code>collections.namedtuple()</code> 的类型版本。</p>
<p>用法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> str
    id<span class="token punctuation">:</span> int<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这相当于：</p>
<pre class="line-numbers language-python"><code class="language-python">Employee <span class="token operator">=</span> collections<span class="token punctuation">.</span>namedtuple<span class="token punctuation">(</span><span class="token string">'Employee'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>为字段提供默认值，要在类体内赋值：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> str
    id<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">3</span>
employee <span class="token operator">=</span> Employee<span class="token punctuation">(</span><span class="token string">'Guido'</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> employee<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>带默认值的字段必须在不带默认值的字段后面。</p>
<p>生成的类具有 <code>__annotations__</code> 这个附加属性，提供了映射字段名与字段类型的字典。（字段名在 <code>_fields</code> 属性内，默认值在 <code>_field_defaults</code> 属性内，这两项都是命名元组 API 的组成部分。）</p>
<p><code>NamedTuple</code> 子类也支持文档字符串与方法：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Represents an employee."""</span>
    name<span class="token punctuation">:</span> str
    id<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token string">'&lt;Employee {self.name}, id={self.id}>'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>反向兼容用法：</p>
<pre class="line-numbers language-python"><code class="language-python">Employee <span class="token operator">=</span> NamedTuple<span class="token punctuation">(</span><span class="token string">'Employee'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在 3.6 版更改: 添加了对 <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a> 中变量注解句法的支持。</p>
<p>在 3.6.1 版更改: 添加了对默认值、方法、文档字符串的支持。</p>
<p>在 3.8 版更改: <code>_field_types</code> 和 <code>__annotations__</code> 属性现已使用常规字典，不再使用 <code>OrderedDict</code> 实例。</p>
<p>在 3.9 版更改: 移除了 <code>_field_types</code> 属性， 改用具有相同信息，但更标准的 <code>__annotations__</code> 属性。</p>
<p><em>class</em> <code>typing.NewType</code>(<em>name</em>, <em>tp</em>)</p>
<p>A helper class to indicate a distinct type to a typechecker, see NewType. At runtime it returns an object that returns its argument when called. Usage:</p>
<pre class="line-numbers language-python"><code class="language-python">UserId <span class="token operator">=</span> NewType<span class="token punctuation">(</span><span class="token string">'UserId'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span>
first_user <span class="token operator">=</span> UserId<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3.5.2 新版功能.</p>
<p>在 3.10 版更改: <code>NewType</code> is now a class rather than a function.</p>
<p><em>class</em> <code>typing.TypedDict</code>(<em>dict</em>)</p>
<p>把类型提示添加至字典的特殊构造器。在运行时，它是纯 <code>dict</code>。</p>
<p><code>TypedDict</code> 声明一个字典类型，该类型预期所有实例都具有一组键集，其中，每个键都与对应类型的值关联。运行时不检查此预期，而是由类型检查器强制执行。用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Point2D</span><span class="token punctuation">(</span>TypedDict<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> int
    y<span class="token punctuation">:</span> int
    label<span class="token punctuation">:</span> str
a<span class="token punctuation">:</span> Point2D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'good'</span><span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># OK</span>
b<span class="token punctuation">:</span> Point2D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">'bad'</span><span class="token punctuation">}</span>           <span class="token comment" spellcheck="true"># Fails type check</span>
<span class="token keyword">assert</span> Point2D<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span> <span class="token operator">==</span> dict<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The type info for introspection can be accessed via <code>Point2D.__annotations__</code>, <code>Point2D.__total__</code>, <code>Point2D.__required_keys__</code>, and <code>Point2D.__optional_keys__</code>. To allow using this feature with older versions of Python that do not support <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a>, <code>TypedDict</code> supports two additional equivalent syntactic forms:</p>
<pre class="line-numbers language-python"><code class="language-python">Point2D <span class="token operator">=</span> TypedDict<span class="token punctuation">(</span><span class="token string">'Point2D'</span><span class="token punctuation">,</span> x<span class="token operator">=</span>int<span class="token punctuation">,</span> y<span class="token operator">=</span>int<span class="token punctuation">,</span> label<span class="token operator">=</span>str<span class="token punctuation">)</span>
Point2D <span class="token operator">=</span> TypedDict<span class="token punctuation">(</span><span class="token string">'Point2D'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> int<span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">:</span> str<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>By default, all keys must be present in a <code>TypedDict</code>. It is possible to override this by specifying totality. Usage:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Point2D</span><span class="token punctuation">(</span>TypedDict<span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> int
    y<span class="token punctuation">:</span> int<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>This means that a <code>Point2D</code> <code>TypedDict</code> can have any of the keys omitted. A type checker is only expected to support a literal <code>False</code> or <code>True</code> as the value of the <code>total</code> argument. <code>True</code> is the default, and makes all items defined in the class body required.</p>
<p>更多示例与 <code>TypedDict</code> 的详细规则，详见 <a href="https://www.python.org/dev/peps/pep-0589" target="_blank" rel="noopener"><strong>PEP 589</strong></a>。</p>
<p>3.8 新版功能.</p>
<h4 id="泛型具象容器"><a href="#泛型具象容器" class="headerlink" title="泛型具象容器"></a>泛型具象容器</h4><h5 id="对应的内置类型"><a href="#对应的内置类型" class="headerlink" title="对应的内置类型"></a>对应的内置类型</h5><p><em>class</em> <code>typing.Dict</code>(<em>dict, MutableMapping[KT, VT]</em>)</p>
<p><code>dict</code> 的泛型版本。适用于注解返回类型。注解参数时，最好使用 <code>Mapping</code> 等抽象容器类型。</p>
<p>该类型用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">count_words</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3.9 版后已移除: <code>builtins.dict</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.List</code>(<em>list, MutableSequence[T]</em>)</p>
<p><code>list</code> 的泛型版本。适用于注解返回类型。注解参数时，最好使用 <code>Sequence</code> 或 <code>Iterable</code> 等抽象容器类型。</p>
<p>该类型用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python">T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">,</span> int<span class="token punctuation">,</span> float<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">vec2</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">keep_positives</span><span class="token punctuation">(</span>vector<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>item <span class="token keyword">for</span> item <span class="token keyword">in</span> vector <span class="token keyword">if</span> item <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.9 版后已移除: <code>builtins.list</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Set</code>(<em>set, MutableSet[T]</em>)</p>
<p><code>builtins.set</code> 的泛型版本。适用于注解返回类型。注解参数时，最好使用 <code>AbstractSet</code> 等抽象容器类型。</p>
<p>3.9 版后已移除: <code>builtins.set</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.FrozenSet</code>(<em>frozenset, AbstractSet[T_co]</em>)</p>
<p><code>builtins.frozenset</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>builtins.frozenset</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p>注解</p>
<p><code>Tuple</code> 是一种特殊形式。</p>
<h5 id="collections-对应类型"><a href="#collections-对应类型" class="headerlink" title="collections 对应类型"></a><code>collections</code> 对应类型</h5><p><em>class</em> <code>typing.DefaultDict</code>(<em>collections.defaultdict, MutableMapping[KT, VT]</em>)</p>
<p><code>collections.defaultdict</code> 的泛型版本。</p>
<p>3.5.2 新版功能.</p>
<p>3.9 版后已移除: <code>collections.defaultdict</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.OrderedDict</code>(<em>collections.OrderedDict, MutableMapping[KT, VT]</em>)</p>
<p><code>collections.OrderedDict</code> 的泛型版本。</p>
<p>3.7.2 新版功能.</p>
<p>3.9 版后已移除: <code>collections.OrderedDict</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.ChainMap</code>(<em>collections.ChainMap, MutableMapping[KT, VT]</em>)</p>
<p><code>collections.ChainMap</code> 的泛型版本。</p>
<p>3.5.4 新版功能.</p>
<p>3.6.1 新版功能.</p>
<p>3.9 版后已移除: <code>collections.ChainMap</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Counter</code>(<em>collections.Counter, Dict[T, int]</em>)</p>
<p><code>collections.Counter</code> 的泛型版本。</p>
<p>3.5.4 新版功能.</p>
<p>3.6.1 新版功能.</p>
<p>3.9 版后已移除: <code>collections.Counter</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Deque</code>(<em>deque, MutableSequence[T]</em>)</p>
<p><code>collections.deque</code> 的泛型版本。</p>
<p>3.5.4 新版功能.</p>
<p>3.6.1 新版功能.</p>
<p>3.9 版后已移除: <code>collections.deque</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<h5 id="其他具象类型"><a href="#其他具象类型" class="headerlink" title="其他具象类型"></a>其他具象类型</h5><p><em>class</em> <code>typing.IO</code></p>
<p><em>class</em> <code>typing.TextIO</code></p>
<p><em>class</em> <code>typing.BinaryIO</code></p>
<p>泛型类型 <code>IO[AnyStr]</code> 及其子类 <code>TextIO(IO[str])</code> 与 <code>BinaryIO(IO[bytes])</code> 表示 I/O 流的类型，例如 <code>open()</code> 所返回的对象。</p>
<p>Deprecated since version 3.8, will be removed in version 3.12: The <code>typing.io</code> namespace is deprecated and will be removed. These types should be directly imported from <code>typing</code> instead.</p>
<p><em>class</em> <code>typing.Pattern</code></p>
<p><em>class</em> <code>typing.Match</code></p>
<p>这些类型对应的是从 <code>re.compile()</code> 和 <code>re.match()</code> 返回的类型。 这些类型（及相应的函数）是 <code>AnyStr</code> 中的泛型并可通过编写 <code>Pattern[str]</code>, <code>Pattern[bytes]</code>, <code>Match[str]</code> 或 <code>Match[bytes]</code> 来具体指定。</p>
<p>Deprecated since version 3.8, will be removed in version 3.12: The <code>typing.re</code> namespace is deprecated and will be removed. These types should be directly imported from <code>typing</code> instead.</p>
<p>3.9 版后已移除: <code>re</code> 模块中的 <code>Pattern</code> 与 <code>Match</code> 类现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Text</code></p>
<p><code>Text</code> 是 <code>str</code> 的别名。提供了对 Python 2 代码的向下兼容：Python 2 中，<code>Text</code> 是 <code>unicode</code> 的别名。</p>
<p>使用 <code>Text</code> 时，值中必须包含 unicode 字符串，以兼容 Python 2 和 Python 3：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">add_unicode_checkmark</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> Text<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
    <span class="token keyword">return</span> text <span class="token operator">+</span> u<span class="token string">' \u2713'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3.5.2 新版功能.</p>
<h4 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h4><h5 id="collections-abc-对应的容器"><a href="#collections-abc-对应的容器" class="headerlink" title="collections.abc 对应的容器"></a><code>collections.abc</code> 对应的容器</h5><p><em>class</em> <code>typing.AbstractSet</code>(<em>Sized, Collection[T_co]</em>)</p>
<p><code>collections.abc.Set</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Set</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.ByteString</code>(<em>Sequence[int]</em>)</p>
<p><code>collections.abc.ByteString</code> 的泛型版本。</p>
<p>该类型代表了 <code>bytes</code>、<code>bytearray</code>、<code>memoryview</code> 等字节序列类型。</p>
<p>作为该类型的简称，<code>bytes</code> 可用于标注上述任意类型的参数。</p>
<p>3.9 版后已移除: <code>collections.abc.ByteString</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Collection</code>(<em>Sized, Iterable[T_co], Container[T_co]</em>)</p>
<p><code>collections.abc.Collection</code> 的泛型版本。</p>
<p>3.6.0 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.Collection</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 与 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Container</code>(<em>Generic[T_co]</em>)</p>
<p><code>collections.abc.Container</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Container</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.ItemsView</code>(<em>MappingView, Generic[KT_co, VT_co]</em>)</p>
<p><code>collections.abc.ItemsView</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.ItemsView</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.KeysView</code>(<em>MappingView[KT_co], AbstractSet[KT_co]</em>)</p>
<p><code>collections.abc.KeysView</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.KeysView</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Mapping</code>(<em>Sized, Collection[KT], Generic[VT_co]</em>)</p>
<p><code>collections.abc.Mapping</code> 的泛型版本。用法如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_position_in_index</span><span class="token punctuation">(</span>word_list<span class="token punctuation">:</span> Mapping<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">,</span> word<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token keyword">return</span> word_list<span class="token punctuation">[</span>word<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3.9 版后已移除: <code>collections.abc.Mapping</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.MappingView</code>(<em>Sized, Iterable[T_co]</em>)</p>
<p><code>collections.abc.MappingView</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.MappingView</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.MutableMapping</code>(<em>Mapping[KT, VT]</em>)</p>
<p><code>collections.abc.MutableMapping</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.MutableMapping</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.MutableSequence</code>(<em>Sequence[T]</em>)</p>
<p><code>collections.abc.MutableSequence</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.MutableSequence</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.MutableSet</code>(<em>AbstractSet[T]</em>)</p>
<p><code>collections.abc.MutableSet</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.MutableSet</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Sequence</code>(<em>Reversible[T_co], Collection[T_co]</em>)</p>
<p><code>collections.abc.Sequence</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Sequence</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.ValuesView</code>(<em>MappingView[VT_co]</em>)</p>
<p><code>collections.abc.ValuesView</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.ValuesView</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<h5 id="collections-abc-对应的其他类型"><a href="#collections-abc-对应的其他类型" class="headerlink" title="collections.abc 对应的其他类型"></a><code>collections.abc</code> 对应的其他类型</h5><p><em>class</em> <code>typing.Iterable</code>(<em>Generic[T_co]</em>)</p>
<p><code>collections.abc.Iterable</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Iterable</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Iterator</code>(<em>Iterable[T_co]</em>)</p>
<p><code>collections.abc.Iterator</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Iterator</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Generator</code>(<em>Iterator[T_co], Generic[T_co, T_contra, V_co]</em>)</p>
<p>生成器可以由泛型类型 <code>Generator[YieldType, SendType, ReturnType]</code> 注解。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">echo_round</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Generator<span class="token punctuation">[</span>int<span class="token punctuation">,</span> float<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">:</span>
    sent <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">0</span>
    <span class="token keyword">while</span> sent <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        sent <span class="token operator">=</span> <span class="token keyword">yield</span> round<span class="token punctuation">(</span>sent<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Done'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，与 typing 模块里的其他泛型不同， <code>Generator</code> 的 <code>SendType</code> 属于逆变行为，不是协变行为，也是不变行为。</p>
<p>如果生成器只产生值，可将 <code>SendType</code> 与 <code>ReturnType</code> 设为 <code>None</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">infinite_stream</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Generator<span class="token punctuation">[</span>int<span class="token punctuation">,</span> None<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> start
        start <span class="token operator">+=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>此外，还可以把生成器的返回类型注解为 <code>Iterable[YieldType]</code> 或 <code>Iterator[YieldType]</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">infinite_stream</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Iterator<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> start
        start <span class="token operator">+=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.9 版后已移除: <code>collections.abc.Generator</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Hashable</code></p>
<p><code>collections.abc.Hashable</code> 的别名。</p>
<p><em>class</em> <code>typing.Reversible</code>(<em>Iterable[T_co]</em>)</p>
<p><code>collections.abc.Reversible</code> 的泛型版本。</p>
<p>3.9 版后已移除: <code>collections.abc.Reversible</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Sized</code></p>
<p><code>collections.abc.Sized</code> 的别名。</p>
<h5 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h5><p><em>class</em> <code>typing.Coroutine</code>(<em>Awaitable[V_co], Generic[T_co, T_contra, V_co]</em>)</p>
<p><code>collections.abc.Coroutine</code> 的泛型版本。类型变量的差异和顺序与 <code>Generator</code> 的内容相对应，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Coroutine
c <span class="token operator">=</span> None <span class="token comment" spellcheck="true"># type: Coroutine[list[str], str, int]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
x <span class="token operator">=</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># type: list[str]</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token keyword">await</span> c <span class="token comment" spellcheck="true"># type: int</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.5.3 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.Coroutine</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.AsyncGenerator</code>(<em>AsyncIterator[T_co], Generic[T_co, T_contra]</em>)</p>
<p>异步生成器可由泛型类型 <code>AsyncGenerator[YieldType, SendType]</code> 注解。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">echo_round</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AsyncGenerator<span class="token punctuation">[</span>int<span class="token punctuation">,</span> float<span class="token punctuation">]</span><span class="token punctuation">:</span>
    sent <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">0</span>
    <span class="token keyword">while</span> sent <span class="token operator">>=</span> <span class="token number">0.0</span><span class="token punctuation">:</span>
        rounded <span class="token operator">=</span> <span class="token keyword">await</span> round<span class="token punctuation">(</span>sent<span class="token punctuation">)</span>
        sent <span class="token operator">=</span> <span class="token keyword">yield</span> rounded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>与常规生成器不同，异步生成器不能返回值，因此没有 <code>ReturnType</code> 类型参数。 与 <code>Generator</code> 类似，<code>SendType</code> 也属于逆变行为。</p>
<p>如果生成器只产生值，可将 <code>SendType</code> 设置为 <code>None</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">infinite_stream</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AsyncGenerator<span class="token punctuation">[</span>int<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> start
        start <span class="token operator">=</span> <span class="token keyword">await</span> increment<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>此外，可用 <code>AsyncIterable[YieldType]</code> 或 <code>AsyncIterator[YieldType]</code> 注解生成器的返回类型：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">infinite_stream</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> AsyncIterator<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> start
        start <span class="token operator">=</span> <span class="token keyword">await</span> increment<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.6.1 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.AsyncGenerator</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.AsyncIterable</code>(<em>Generic[T_co]</em>)</p>
<p><code>collections.abc.AsyncIterable</code> 的泛型版本。</p>
<p>3.5.2 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.AsyncIterable</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.AsyncIterator</code>(<em>AsyncIterable[T_co]</em>)</p>
<p><code>collections.abc.AsyncIterator</code> 的泛型版本。</p>
<p>3.5.2 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.AsyncIterator</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.Awaitable</code>(<em>Generic[T_co]</em>)</p>
<p><code>collections.abc.Awaitable</code> 的泛型版本。</p>
<p>3.5.2 新版功能.</p>
<p>3.9 版后已移除: <code>collections.abc.Awaitable</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<h5 id="上下文管理器类型"><a href="#上下文管理器类型" class="headerlink" title="上下文管理器类型"></a>上下文管理器类型</h5><p><em>class</em> <code>typing.ContextManager</code>(<em>Generic[T_co]</em>)</p>
<p><code>contextlib.AbstractContextManager</code> 的泛型版本。</p>
<p>3.5.4 新版功能.</p>
<p>3.6.0 新版功能.</p>
<p>3.9 版后已移除: <code>contextlib.AbstractContextManager</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<p><em>class</em> <code>typing.AsyncContextManager</code>(<em>Generic[T_co]</em>)</p>
<p><code>contextlib.AbstractAsyncContextManager</code> 的泛型版本。</p>
<p>3.5.4 新版功能.</p>
<p>3.6.2 新版功能.</p>
<p>3.9 版后已移除: <code>contextlib.AbstractAsyncContextManager</code> 现已支持 <code>[]</code>。详见 <a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 和 Generic Alias Type。</p>
<h4 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h4><p>这些协议由 <code>runtime_checkable()</code> 装饰。</p>
<p><em>class</em> <code>typing.SupportsAbs</code></p>
<p>含抽象方法 <code>__abs__</code> 的抽象基类，是其返回类型里的协变量。</p>
<p><em>class</em> <code>typing.SupportsBytes</code></p>
<p>含抽象方法 <code>__bytes__</code> 的抽象基类。</p>
<p><em>class</em> <code>typing.SupportsComplex</code></p>
<p>含抽象方法 <code>__complex__</code> 的抽象基类。</p>
<p><em>class</em> <code>typing.SupportsFloat</code></p>
<p>含抽象方法 <code>__float__</code> 的抽象基类。</p>
<p><em>class</em> <code>typing.SupportsIndex</code></p>
<p>含抽象方法 <code>__index__</code> 的抽象基类。</p>
<p>3.8 新版功能.</p>
<p><em>class</em> <code>typing.SupportsInt</code></p>
<p>含抽象方法 <code>__int__</code> 的抽象基类。</p>
<p><em>class</em> <code>typing.SupportsRound</code></p>
<p>含抽象方法 <code>__round__</code> 的抽象基类，是其返回类型的协变量。</p>
<h4 id="函数与装饰器"><a href="#函数与装饰器" class="headerlink" title="函数与装饰器"></a>函数与装饰器</h4><p><code>typing.cast</code>(<em>typ</em>, <em>val</em>)</p>
<p>把值强制转换为类型。</p>
<p>不变更返回值。对类型检查器而言，代表了返回值具有指定的类型，但运行时故意不做任何检查（以便让检查速度尽量快）。</p>
<pre><code>@``typing.overload</code></pre><p><code>@overload</code> 装饰器可以修饰支持多个不同参数类型组合的函数或方法。<code>@overload</code> - 装饰定义的系列必须紧跟一个非 <code>@overload</code>-装饰定义（用于同一个函数/方法）。<code>@overload</code>-装饰定义仅是为了协助类型检查器， 因为该装饰器会被非 <code>@overload</code>-装饰定义覆盖，后者用于运行时，而且会被类型检查器忽略。在运行时直接调用 <code>@overload</code> 装饰的函数会触发 <code>NotImplementedError</code>。下面的重载示例给出了比联合类型或类型变量更精准的类型：</p>
<pre class="line-numbers language-python"><code class="language-python">@overload
<span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
@overload
<span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
@overload
<span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> bytes<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>actual implementation<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>详见 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a>，与其他类型语义进行对比。</p>
<pre><code>@``typing.final</code></pre><p>告知类型检查器被装饰的方法不能被覆盖，且被装饰的类不能作为子类的装饰器，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">:</span>
    @final
    <span class="token keyword">def</span> <span class="token function">done</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">done</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># Error reported by type checker</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
@final
<span class="token keyword">class</span> <span class="token class-name">Leaf</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Other</span><span class="token punctuation">(</span>Leaf<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># Error reported by type checker</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这些属性没有运行时检查。详见 <a href="https://www.python.org/dev/peps/pep-0591" target="_blank" rel="noopener"><strong>PEP 591</strong></a>。</p>
<p>3.8 新版功能.</p>
<pre><code>@``typing.no_type_check</code></pre><p>标明注解不是类型提示的装饰器。</p>
<p>用作类或函数的 decorator。用于类时，递归地应用于该类中定义的所有方法，（但不影响超类或子类中定义的方法）。</p>
<p>本方法可直接修改函数。</p>
<pre><code>@``typing.no_type_check_decorator</code></pre><p>让其他装饰器具有 <code>no_type_check()</code> 效果的装饰器。</p>
<p>本装饰器用 <code>no_type_check()</code> 里的装饰函数打包其他装饰器。</p>
<pre><code>@``typing.type_check_only</code></pre><p>标记类或函数内不可用于运行时的装饰器。</p>
<p>在运行时，该装饰器本身不可用。实现返回的是私有类实例时，它主要是用于标记在类型存根文件中定义的类。</p>
<pre class="line-numbers language-python"><code class="language-python">@type_check_only
<span class="token keyword">class</span> <span class="token class-name">Response</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># private or not available at runtime</span>
    code<span class="token punctuation">:</span> int
    <span class="token keyword">def</span> <span class="token function">get_header</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">fetch_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Response<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，建议不要返回私有类实例，最好将之设为公共类。</p>
<h4 id="内省辅助器"><a href="#内省辅助器" class="headerlink" title="内省辅助器"></a>内省辅助器</h4><p><code>typing.get_type_hints</code>(<em>obj</em>, <em>globalns=None</em>, <em>localns=None</em>, <em>include_extras=False</em>)</p>
<p>返回函数、方法、模块、类对象的类型提示的字典。</p>
<p>一般情况下，与 <code>obj.__annotations__</code> 相同。此外，可通过在 <code>globals</code> 与 <code>locals</code> 命名空间里进行评估，以此来处理编码为字符串字面量的前向引用。如有需要，在默认值设置为 <code>None</code> 时，可为函数或方法注解添加 <code>Optional[t]</code>。对于类 <code>C</code>，则返回由所有 <code>__annotations__</code> 与 <code>C.__mro__</code> 逆序合并而成的字典。</p>
<p>本函数以递归地方式用 <code>T</code> 替换所有 <code>Annotated[T, ...]</code>， 除非将 <code>include_extras</code> 的值设置为 <code>True</code> 。例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span>str<span class="token punctuation">,</span> <span class="token string">'some marker'</span><span class="token punctuation">]</span>
get_type_hints<span class="token punctuation">(</span>Student<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> str<span class="token punctuation">}</span>
get_type_hints<span class="token punctuation">(</span>Student<span class="token punctuation">,</span> include_extras<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> str<span class="token punctuation">}</span>
get_type_hints<span class="token punctuation">(</span>Student<span class="token punctuation">,</span> include_extras<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span>str<span class="token punctuation">,</span> <span class="token string">'some marker'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p><code>get_type_hints()</code> does not work with imported type aliases that include forward references. Enabling postponed evaluation of annotations (<a href="https://www.python.org/dev/peps/pep-0563" target="_blank" rel="noopener"><strong>PEP 563</strong></a>) may remove the need for most forward references.</p>
<p>在 3.9 版更改: <a href="https://www.python.org/dev/peps/pep-0593" target="_blank" rel="noopener"><strong>PEP 593</strong></a> 的组成部分，添加了 <code>include_extras</code> 参数。</p>
<p><code>typing.get_args</code>(<em>tp</em>)</p>
<p><code>typing.get_origin</code>(<em>tp</em>)</p>
<p>为泛型类型与特殊类型形式提供了基本的内省功能。</p>
<p>For a typing object of the form <code>X[Y, Z, ...]</code> these functions return <code>X</code> and <code>(Y, Z, ...)</code>. If <code>X</code> is a generic alias for a builtin or <code>collections</code> class, it gets normalized to the original class. If <code>X</code> is a union or <code>Literal</code> contained in another generic type, the order of <code>(Y, Z, ...)</code> may be different from the order of the original arguments <code>[Y, Z, ...]</code> due to type caching. For unsupported objects return <code>None</code> and <code>()</code> correspondingly. Examples:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">assert</span> get_origin<span class="token punctuation">(</span>Dict<span class="token punctuation">[</span>str<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> dict
<span class="token keyword">assert</span> get_args<span class="token punctuation">(</span>Dict<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>int<span class="token punctuation">,</span> str<span class="token punctuation">)</span>
<span class="token keyword">assert</span> get_origin<span class="token punctuation">(</span>Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> Union
<span class="token keyword">assert</span> get_args<span class="token punctuation">(</span>Union<span class="token punctuation">[</span>int<span class="token punctuation">,</span> str<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>int<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.8 新版功能.</p>
<p><code>typing.is_typeddict</code>(<em>tp</em>)</p>
<p>Check if a type is a <code>TypedDict</code>.</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Film</span><span class="token punctuation">(</span>TypedDict<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title<span class="token punctuation">:</span> str
    year<span class="token punctuation">:</span> int
is_typeddict<span class="token punctuation">(</span>Film<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># => True</span>
is_typeddict<span class="token punctuation">(</span>list <span class="token operator">|</span> str<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># => False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.10 新版功能.</p>
<p><em>class</em> <code>typing.ForwardRef</code></p>
<p>用于字符串前向引用的内部类型表示的类。 例如，<code>List["SomeClass"]</code> 会被隐式转换为 <code>List[ForwardRef("SomeClass")]</code>。 这个类不应由用户来实例化，但可以由内省工具使用。</p>
<p>注解</p>
<p><a href="https://www.python.org/dev/peps/pep-0585" target="_blank" rel="noopener"><strong>PEP 585</strong></a> 泛型类型例如 <code>list["SomeClass"]</code> 将不会被隐式地转换为 <code>list[ForwardRef("SomeClass")]</code> 因而将不会自动解析为 <code>list[SomeClass]</code>。</p>
<p>3.7.4 新版功能.</p>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><pre><code>typing.TYPE_CHECKING</code></pre><p>被第三方静态类型检查器假定为 <code>True</code> 的特殊常量。 在运行时为 <code>False</code>。 用法如下:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> TYPE_CHECKING<span class="token punctuation">:</span>
    <span class="token keyword">import</span> expensive_mod
<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token string">'expensive_mod.SomeType'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
    local_var<span class="token punctuation">:</span> expensive_mod<span class="token punctuation">.</span>AnotherType <span class="token operator">=</span> other_fun<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>第一个类型注解必须用引号标注，才能把它当作“前向引用”，从而在解释器运行时中隐藏 <code>expensive_mod</code> 引用。局部变量的类型注释不会被评估，因此，第二个注解不需要用引号引起来。</p>
<p>注解</p>
<p>Python 3.7 或更高版本中使用 <code>from __future__ import</code> 时，函数定义时不处理注解， 而是把注解当作字符串存在 <code>__annotations__</code> 里，这样就不必为注解使用引号。（详见 <a href="https://www.python.org/dev/peps/pep-0563" target="_blank" rel="noopener"><strong>PEP 563</strong></a>）。</p>
<p>3.5.2 新版功能.</p>
<h2 id="pydoc-—-文档生成器和在线帮助系统"><a href="#pydoc-—-文档生成器和在线帮助系统" class="headerlink" title="pydoc —- 文档生成器和在线帮助系统"></a><code>pydoc</code> —- 文档生成器和在线帮助系统</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/pydoc.py" target="_blank" rel="noopener">Lib/pydoc.py</a></p>
<hr>
<p><code>pydoc</code> 模块会根据 Python 模块来自动生成文档。 生成的文档可在控制台中显示为文本页面，提供给 Web 浏览器访问或者保存为 HTML 文件。</p>
<p>对于模块、类、函数和方法，显示的文档内容取自文档字符串（即 <code>__doc__</code> 属性），并会递归地从其带文档的成员中获取。 如果没有文档字符串，<code>pydoc</code> 会尝试从类、函数或方法定义上方，或是模块顶部的注释行段落获取 </p>
<p>内置函数 <code>help()</code> 会发起调用交互式解释器的在线帮助系统，该系统使用 <code>pydoc</code> 在终端上生成文本形式的文档内容。 同样的文本文档也可以在 Python 解释器以外通过在操作系统的命令提示符下以脚本方式运行 <strong>pydoc</strong> 来查看。 例如，运行</p>
<pre><code>pydoc sys</code></pre><p>在终端提示符下将通过 <code>sys</code> 模块显示文档内容，其样式类似于 Unix <strong>man</strong> 命令所显示的指南页面。 <strong>pydoc</strong> 的参数可以为函数、模块、包，或带点号的对模块中的类、方法或函数以及包中的模块的引用。 如果传给 <strong>pydoc</strong> 的参数像是一个路径（即包含所在操作系统的路径分隔符，例如 Unix 的正斜杠），并且其指向一个现有的 Python 源文件，则会为该文件生成文档内容。</p>
<p>注解</p>
<p>为了找到对象及其文档内容，<code>pydoc</code> 会导入文档所在的模块。 因此，任何模块层级的代码都将被执行。 请使用 <code>if __name__ == '__main__':</code> 语句来确保一个文件的特定代码仅在作为脚本被发起调用时执行而不是在被导入时执行。</p>
<p>当打印输出到控制台时，<strong>pydoc</strong> 会尝试对输出进行分页以方便阅读。 如果设置了 <code>PAGER</code> 环境变量，<strong>pydoc</strong> 将使用该变量值作为分页程序。</p>
<p>在参数前指定 <code>-w</code> 旗标将把 HTML 文档写入到当前目录下的一个文件中，而不是在控制台中显示文本。</p>
<p>在参数前指定 <code>-k</code> 旗标将在全部可用模块的提要行中搜索参数所给定的关键字，具体方式同样类似于 Unix <strong>man</strong> 命令。 模块的提要行就是其文档字符串的第一行。</p>
<p>你还可以使用 <strong>pydoc</strong> 在本机上启动一个 HTTP 服务器并向来访的 Web 浏览器展示文档。 <strong>pydoc -p 1234</strong> 将在 1234 端口上启动 HTTP 服务器，允许在你使用 Web 浏览器通过 <code>http://localhost:1234/</code> 来浏览文档内容。 指定 <code>0</code> 作为端口号将任意选择一个未使用的端口。</p>
<p><strong>pydoc -n <hostname></hostname></strong> 将启动在给定主机名上执行监听的服务。 默认主机名为 ‘localhost’ 但如果你希望能从其他机器搜索该服务器，你可能会想要改变服务器所响应的主机名。 在开发阶段此特性会特别有用，因为这样你将能在一个容器中运行 pydoc。</p>
<p><strong>pydoc -b</strong> 将启动服务并额外打开一个 Web 浏览器访问模块索引页。 所发布的每个页面顶端都带有导航栏，你可以点击 <em>Get</em> 获取特定条目的帮助，点击 <em>Search</em> 在所有模块的提要行中搜索特定关键词，或是点击 <em>Module index</em>, <em>Topics</em> 和 <em>Keywords</em> 前往相应的页面。</p>
<p>当 <strong>pydoc</strong> 生成文档内容时，它会使用当前环境和路径来定位模块。 因此，发起调用 <strong>pydoc spam</strong> 得到的文档版本会与你启动 Python 解释器并输入 <code>import spam</code> 时得到的模块版本完全相同。</p>
<p>核心模块的模块文档位置对应于 <code>https://docs.python.org/X.Y/library/</code> 其中 <code>X</code> 和 <code>Y</code> 是 Python 解释器的主要版本号和小版本号。 这可通过设置 <code>PYTHONDOCS</code> 环境变量来重载为指向不同的 URL 或包含 Library Reference Manual 页面的本地目录。</p>
<p>在 3.2 版更改: 添加 <code>-b</code> 选项。</p>
<p>在 3.3 版更改: 命令行选项 <code>-g</code> 已经移除。</p>
<p>在 3.4 版更改: <code>pydoc</code> 现在会使用 <code>inspect.signature()</code> 而非 <code>inspect.getfullargspec()</code> 来从可调用对象中提取签名信息。</p>
<p>在 3.7 版更改: 添加 <code>-n</code> 选项。</p>
<h2 id="Python-开发模式"><a href="#Python-开发模式" class="headerlink" title="Python 开发模式"></a>Python 开发模式</h2><ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/devmode.html" target="_blank" rel="noopener">Python 开发模式</a></li>
</ul>
<h2 id="doctest-—-测试交互性的Python示例"><a href="#doctest-—-测试交互性的Python示例" class="headerlink" title="doctest —- 测试交互性的Python示例"></a><code>doctest</code> —- 测试交互性的Python示例</h2><p>源代码  <a href="https://github.com/python/cpython/tree/3.10/Lib/doctest.py" target="_blank" rel="noopener">Lib/doctest.py</a></p>
<hr>
<p><code>doctest</code> 模块寻找像Python交互式代码的文本，然后执行这些代码来确保它们的确就像展示的那样正确运行，有许多方法来使用doctest：</p>
<ul>
<li>通过验证所有交互式示例仍然按照记录的方式工作，以此来检查模块的文档字符串是否是最新的。</li>
<li>通过验证来自一个测试文件或一个测试对象的交互式示例按预期工作，来进行回归测试。</li>
<li>To write tutorial documentation for a package, liberally illustrated with input-output examples. Depending on whether the examples or the expository text are emphasized, this has the flavor of “literate testing” or “executable documentation”.</li>
</ul>
<p><a href="https://docs.python.org/zh-cn/3.10/library/doctest.html#module-doctest" target="_blank" rel="noopener"><code>doctest</code></a></p>
<h2 id="unittest-—-单元测试框架"><a href="#unittest-—-单元测试框架" class="headerlink" title="unittest —- 单元测试框架"></a><code>unittest</code> —- 单元测试框架</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/unittest/__init__.py" target="_blank" rel="noopener">Lib/unittest/<strong>init</strong>.py</a></p>
<ul>
<li><p><a href="https://docs.python.org/zh-cn/3.10/library/unittest.html" target="_blank" rel="noopener"><code>unittest</code> — 单元测试框架</a></p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.10/library/unittest.mock.html" target="_blank" rel="noopener"><code>unittest.mock</code> — 模拟对象库</a></p>
</li>
<li><p><a href="https://docs.python.org/zh-cn/3.10/library/unittest.mock-examples.html" target="_blank" rel="noopener"><code>unittest.mock</code> 上手指南</a></p>
</li>
</ul>
<h2 id="2to3-自动将-Python-2-代码转为-Python-3-代码"><a href="#2to3-自动将-Python-2-代码转为-Python-3-代码" class="headerlink" title="2to3 - 自动将 Python 2 代码转为 Python 3 代码"></a>2to3 - 自动将 Python 2 代码转为 Python 3 代码</h2><p>2to3 是一个 Python 程序，它可以读取 Python 2.x 的源代码并使用一系列的 <em>修复器</em> 来将其转换为合法的 Python 3.x 代码。 标准库已包含了丰富的修复器，这足以处理几乎所有代码。 不过 2to3 的支持库 <code>lib2to3</code> 是一个很灵活通用的库，所以还可以编写你自己的 2to3 修复器。</p>
<h3 id="使用-2to3"><a href="#使用-2to3" class="headerlink" title="使用 2to3"></a>使用 2to3</h3><p>2to3 通常会作为脚本和 Python 解释器一起安装，你可以在 Python 根目录的 <code>Tools/scripts</code> 文件夹下找到它。</p>
<p>2to3 的基本调用参数是一个需要转换的文件或目录列表。对于目录，会递归地寻找其中的 Python 源码。</p>
<p>这里有一个 Python 2.x 的源码文件，<code>example.py</code>：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">greet</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">"Hello, {0}!"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">"What's your name?"</span>
name <span class="token operator">=</span> raw_input<span class="token punctuation">(</span><span class="token punctuation">)</span>
greet<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>它可以在命令行中使用 2to3 转换成 Python 3.x 版本的代码：</p>
<pre><code>$ 2to3 example.py</code></pre><p>这个命令会打印出和源文件的区别。通过传入 <code>-w</code> 参数，2to3 也可以把需要的修改写回到原文件中（除非传入了 <code>-n</code> 参数，否则会为原始文件创建一个副本）：</p>
<pre><code>$ 2to3 -w example.py</code></pre><p>在转换完成后，<code>example.py</code> 看起来像是这样：</p>
<pre><code>def greet(name):
    print("Hello, {0}!".format(name))
print("What's your name?")
name = input()
greet(name)</code></pre><p>注释和缩进都会在转换过程中保持不变。</p>
<p>默认情况下，2to3 会执行 预定义修复器 的集合。使用 <code>-l</code> 参数可以列出所有可用的修复器。使用 <code>-f</code> 参数可以明确指定需要使用的修复器集合。而使用 <code>-x</code> 参数则可以明确指定不使用的修复器。下面的例子会只使用 <code>imports</code> 和 <code>has_key</code> 修复器运行：</p>
<pre><code>$ 2to3 -f imports -f has_key example.py</code></pre><p>这个命令会执行除了 <code>apply</code> 之外的所有修复器：</p>
<pre><code>$ 2to3 -x apply example.py</code></pre><p>有一些修复器是需要 <em>显式指定</em> 的，它们默认不会执行，必须在命令行中列出才会执行。比如下面的例子，除了默认的修复器以外，还会执行 <code>idioms</code> 修复器：</p>
<pre><code>$ 2to3 -f all -f idioms example.py</code></pre><p>注意这里使用 <code>all</code> 来启用所有默认的修复器。</p>
<p>有些情况下 2to3 会找到源码中有一些需要修改，但是无法自动处理的代码。在这种情况下，2to3 会在差异处下面打印一个警告信息。你应该定位到相应的代码并对其进行修改，以使其兼容 Python 3.x。</p>
<p>2to3 也可以重构 doctests。使用 <code>-d</code> 开启这个模式。需要注意<em>只有</em> doctests 会被重构。这种模式下不需要文件是合法的 Python 代码。举例来说，reST 文档中类似 doctests 的示例也可以使用这个选项进行重构。</p>
<p><code>-v</code> 选项可以输出更多转换程序的详细信息。</p>
<p>由于某些 print 语句可被解读为函数调用或是语句，2to3 并不总能读取包含 print 函数的文件。 当 2to3 检测到存在 <code>from __future__ import print_function</code> 编译器指令时，会修改其内部语法将 <code>print()</code> 解读为函数。 这一变动也可以使用 <code>-p</code> 旗标手动开启。 使用 <code>-p</code> 来为已转换过 print 语句的代码运行修复器。 也可以使用 <code>-e</code> 将 <code>exec()</code> 解读为函数。</p>
<p><code>-o</code> 或 <code>--output-dir</code> 选项可以指定将转换后的文件写入其他目录中。由于这种情况下不会覆写原始文件，所以创建副本文件毫无意义，因此也需要使用 <code>-n</code> 选项来禁用创建副本。</p>
<p>3.2.3 新版功能: 增加了 <code>-o</code> 选项。</p>
<p><code>-W</code> 或 <code>--write-unchanged-files</code> 选项用来告诉 2to3 始终需要输出文件，即使没有任何改动。这在使用 <code>-o</code> 参数时十分有用，这样就可以将整个 Python 源码包完整地转换到另一个目录。这个选项隐含了 <code>-w</code> 选项，否则等于没有作用。</p>
<p>3.2.3 新版功能: 增加了 <code>-W</code> 选项。</p>
<p><code>--add-suffix</code> 选项接受一个字符串，用来作为后缀附加在输出文件名后面的后面。由于写入的文件名与原始文件不同，所以没有必要创建副本，因此 <code>-n</code> 选项也是必要的。举个例子：</p>
<pre><code>$ 2to3 -n -W --add-suffix=3 example.py</code></pre><p>这样会把转换后的文件写入 <code>example.py3</code> 文件。</p>
<p>3.2.3 新版功能: 增加了 <code>--add-suffix</code> 选项。</p>
<p>将整个项目从一个目录转换到另一个目录可以用这样的命令：</p>
<pre><code>$ 2to3 --output-dir=python3-version/mycode -W -n python2-version/mycode</code></pre><h3 id="修复器"><a href="#修复器" class="headerlink" title="修复器"></a>修复器</h3><p>转换代码的每一个步骤都封装在修复器中。可以使用 <code>2to3 -l</code> 来列出可用的修复器。之前已经提到，每个修复器都可以独立地打开或是关闭。下面会对各个修复器做更详细的描述。</p>
<pre><code>apply</code></pre><p>移除对 <code>apply()</code> 的使用，举例来说，<code>apply(function, *args, **kwargs)</code> 会被转换成 <code>function(*args, **kwargs)</code>。</p>
<pre><code>asserts</code></pre><p>将已弃用的 <code>unittest</code> 方法替换为正确的。</p>
<table>
<thead>
<tr>
<th align="left">从</th>
<th align="left">到</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>failUnlessEqual(a, b)</code></td>
<td align="left"><code>assertEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>assertEquals(a, b)</code></td>
<td align="left"><code>assertEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>failIfEqual(a, b)</code></td>
<td align="left"><code>assertNotEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>assertNotEquals(a, b)</code></td>
<td align="left"><code>assertNotEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>failUnless(a)</code></td>
<td align="left"><code>assertTrue(a)</code></td>
</tr>
<tr>
<td align="left"><code>assert_(a)</code></td>
<td align="left"><code>assertTrue(a)</code></td>
</tr>
<tr>
<td align="left"><code>failIf(a)</code></td>
<td align="left"><code>assertFalse(a)</code></td>
</tr>
<tr>
<td align="left"><code>failUnlessRaises(exc, cal)</code></td>
<td align="left"><code>assertRaises(exc, cal)</code></td>
</tr>
<tr>
<td align="left"><code>failUnlessAlmostEqual(a, b)</code></td>
<td align="left"><code>assertAlmostEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>assertAlmostEquals(a, b)</code></td>
<td align="left"><code>assertAlmostEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>failIfAlmostEqual(a, b)</code></td>
<td align="left"><code>assertNotAlmostEqual(a, b)</code></td>
</tr>
<tr>
<td align="left"><code>assertNotAlmostEquals(a, b)</code></td>
<td align="left"><code>assertNotAlmostEqual(a, b)</code></td>
</tr>
</tbody></table>
<pre><code>basestring</code></pre><p>将 <code>basestring</code> 转换为 <code>str</code>。</p>
<pre><code>buffer</code></pre><p>将 <code>buffer</code> 转换为 <code>memoryview</code>。这个修复器是可选的，因为 <code>memoryview</code> API 和 <code>buffer</code> 很相似，但不完全一样。</p>
<pre><code>dict</code></pre><p>修复字典迭代方法。<code>dict.iteritems()</code> 会转换成 <code>dict.items()</code>，<code>dict.iterkeys()</code> 会转换成 <code>dict.keys()</code>，<code>dict.itervalues()</code> 会转换成 <code>dict.values()</code>。类似的，<code>dict.viewitems()</code>，<code>dict.viewkeys()</code> 和 <code>dict.viewvalues()</code> 会分别转换成 <code>dict.items()</code>，<code>dict.keys()</code> 和 <code>dict.values()</code>。另外也会将原有的 <code>dict.items()</code>，<code>dict.keys()</code> 和 <code>dict.values()</code> 方法调用用 <code>list</code> 包装一层。</p>
<pre><code>except</code></pre><p>将 <code>except X, T</code> 转换为 <code>except X as T</code>。</p>
<pre><code>exec</code></pre><p>将 <code>exec</code> 语句转换为 <code>exec()</code> 函数调用。</p>
<pre><code>execfile</code></pre><p>移除 <code>execfile()</code> 的使用。<code>execfile()</code> 的实参会使用 <code>open()</code>，<code>compile()</code> 和 <code>exec()</code> 包装。</p>
<pre><code>exitfunc</code></pre><p>将对 <code>sys.exitfunc</code> 的赋值改为使用 <code>atexit</code> 模块代替。</p>
<pre><code>filter</code></pre><p>将 <code>filter()</code> 函数用 <code>list</code> 包装一层。</p>
<pre><code>funcattrs</code></pre><p>修复已经重命名的函数属性。比如 <code>my_function.func_closure</code> 会被转换为 <code>my_function.__closure__</code>。</p>
<pre><code>future</code></pre><p>移除 <code>from __future__ import new_feature</code> 语句。</p>
<pre><code>getcwdu</code></pre><p>将 <code>os.getcwdu()</code> 重命名为 <code>os.getcwd()</code>。</p>
<pre><code>has_key</code></pre><p>将 <code>dict.has_key(key)</code> 转换为 <code>key in dict</code>。</p>
<pre><code>idioms</code></pre><p>这是一个可选的修复器，会进行多种转换，将 Python 代码变成更加常见的写法。类似 <code>type(x) is SomeClass</code> 和 <code>type(x) == SomeClass</code> 的类型对比会被转换成 <code>isinstance(x, SomeClass)</code>。<code>while 1</code> 转换成 <code>while True</code>。这个修复器还会在合适的地方使用 <code>sorted()</code> 函数。举个例子，这样的代码块：</p>
<pre><code>L = list(some_iterable)L.sort()</code></pre><p>会被转换为：</p>
<pre><code>L = sorted(some_iterable)
import</code></pre><p>检测 sibling imports，并将其转换成相对 import。</p>
<pre><code>imports</code></pre><p>处理标准库模块的重命名。</p>
<pre><code>imports2</code></pre><p>处理标准库中其他模块的重命名。这个修复器由于一些技术上的限制，因此和 <code>imports</code> 拆分开了。</p>
<pre><code>input</code></pre><p>将 <code>input(prompt)</code> 转换为 <code>eval(input(prompt))</code>。</p>
<pre><code>intern</code></pre><p>将 <code>intern()</code> 转换为 <code>sys.intern()</code>。</p>
<pre><code>isinstance</code></pre><p>修复 <code>isinstance()</code> 函数第二个实参中重复的类型。举例来说，<code>isinstance(x, (int, int))</code> 会转换为 <code>isinstance(x, int)</code>, <code>isinstance(x, (int, float, int))</code> 会转换为 <code>isinstance(x, (int, float))</code>。</p>
<pre><code>itertools_imports</code></pre><p>移除 <code>itertools.ifilter()</code>，<code>itertools.izip()</code> 以及 <code>itertools.imap()</code> 的 import。对 <code>itertools.ifilterfalse()</code> 的 import 也会替换成 <code>itertools.filterfalse()</code>。</p>
<pre><code>itertools</code></pre><p>修改 <code>itertools.ifilter()</code>，<code>itertools.izip()</code> 和 <code>itertools.imap()</code> 的调用为对应的内建实现。<code>itertools.ifilterfalse()</code> 会替换成 <code>itertools.filterfalse()</code>。</p>
<pre><code>long</code></pre><p>将 <code>long</code> 重命名为 <code>int</code>。</p>
<pre><code>map</code></pre><p>用 <code>list</code> 包装 <code>map()</code>。同时也会将 <code>map(None, x)</code> 替换为 <code>list(x)</code>。使用 <code>from future_builtins import map</code> 禁用这个修复器。</p>
<pre><code>metaclass</code></pre><p>将老的元类语法（类体中的 <code>__metaclass__ = Meta</code>）替换为新的（<code>class X(metaclass=Meta)</code>）。</p>
<pre><code>methodattrs</code></pre><p>修复老的方法属性名。例如 <code>meth.im_func</code> 会被转换为 <code>meth.__func__</code>。</p>
<pre><code>ne</code></pre><p>转换老的不等语法，将 <code>&lt;&gt;</code> 转为 <code>!=</code>。</p>
<pre><code>next</code></pre><p>将迭代器的 <code>next()</code> 方法调用转为 <code>next()</code> 函数。也会将 <code>next()</code> 方法重命名为 <code>__next__()</code>。</p>
<pre><code>nonzero</code></pre><p>将 <code>__nonzero__()</code> 转换为 <code>__bool__()</code>。</p>
<pre><code>numliterals</code></pre><p>将八进制字面量转为新的语法。</p>
<pre><code>operator</code></pre><p>将 <code>operator</code> 模块中的许多方法调用转为其他的等效函数调用。如果有需要，会添加适当的 <code>import</code> 语句，比如 <code>import collections.abc</code>。有以下转换映射：</p>
<table>
<thead>
<tr>
<th align="left">从</th>
<th align="left">到</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>operator.isCallable(obj)</code></td>
<td align="left"><code>callable(obj)</code></td>
</tr>
<tr>
<td align="left"><code>operator.sequenceIncludes(obj)</code></td>
<td align="left"><code>operator.contains(obj)</code></td>
</tr>
<tr>
<td align="left"><code>operator.isSequenceType(obj)</code></td>
<td align="left"><code>isinstance(obj, collections.abc.Sequence)</code></td>
</tr>
<tr>
<td align="left"><code>operator.isMappingType(obj)</code></td>
<td align="left"><code>isinstance(obj, collections.abc.Mapping)</code></td>
</tr>
<tr>
<td align="left"><code>operator.isNumberType(obj)</code></td>
<td align="left"><code>isinstance(obj, numbers.Number)</code></td>
</tr>
<tr>
<td align="left"><code>operator.repeat(obj, n)</code></td>
<td align="left"><code>operator.mul(obj, n)</code></td>
</tr>
<tr>
<td align="left"><code>operator.irepeat(obj, n)</code></td>
<td align="left"><code>operator.imul(obj, n)</code></td>
</tr>
</tbody></table>
<pre><code>paren</code></pre><p>在列表生成式中增加必须的括号。例如将 <code>[x for x in 1, 2]</code> 转换为 <code>[x for x in (1, 2)]</code>。</p>
<pre><code>print</code></pre><p>将 <code>print</code> 语句转换为 <code>print()</code> 函数。</p>
<pre><code>raise</code></pre><p>将 <code>raise E, V</code> 转换为 <code>raise E(V)</code>，将 <code>raise E, V, T</code> 转换为 <code>raise E(V).with_traceback(T)</code>。如果 <code>E</code> 是元组，这样的转换是不正确的，因为用元组代替异常的做法在 3.0 中已经移除了。</p>
<pre><code>raw_input</code></pre><p>将 <code>raw_input()</code> 转换为 <code>input()</code>。</p>
<pre><code>reduce</code></pre><p>将 <code>reduce()</code> 转换为 <code>functools.reduce()</code>。</p>
<pre><code>reload</code></pre><p>将 <code>reload()</code> 转换为 <code>importlib.reload()</code>。</p>
<pre><code>renames</code></pre><p>将 <code>sys.maxint</code> 转换为 <code>sys.maxsize</code>。</p>
<pre><code>repr</code></pre><p>将反引号 repr 表达式替换为 <code>repr()</code> 函数。</p>
<pre><code>set_literal</code></pre><p>将 <code>set</code> 构造函数替换为 set literals 写法。这个修复器是可选的。</p>
<pre><code>standarderror</code></pre><p>将 <code>StandardError</code> 重命名为 <code>Exception</code>。</p>
<pre><code>sys_exc</code></pre><p>将弃用的 <code>sys.exc_value</code>，<code>sys.exc_type</code>，<code>sys.exc_traceback</code> 替换为 <code>sys.exc_info()</code> 的用法。</p>
<pre><code>throw</code></pre><p>修复生成器的 <code>throw()</code> 方法的 API 变更。</p>
<pre><code>tuple_params</code></pre><p>移除隐式的元组参数解包。这个修复器会插入临时变量。</p>
<pre><code>types</code></pre><p>修复 <code>type</code> 模块中一些成员的移除引起的代码问题。</p>
<pre><code>unicode</code></pre><p>将 <code>unicode</code> 重命名为 <code>str</code>。</p>
<pre><code>urllib</code></pre><p>将 <code>urllib</code> 和 <code>urllib2</code> 重命名为 <code>urllib</code> 包。</p>
<pre><code>ws_comma</code></pre><p>移除逗号分隔的元素之间多余的空白。这个修复器是可选的。</p>
<pre><code>xrange</code></pre><p>将 <code>xrange()</code> 重命名为 <code>range()</code>，并用 <code>list</code> 包装原有的 <code>range()</code>。</p>
<pre><code>xreadlines</code></pre><p>将 <code>for x in file.xreadlines()</code> 转换为 <code>for x in file</code>。</p>
<pre><code>zip</code></pre><p>用 <code>list</code> 包装 <code>zip()</code>。如果使用了 <code>from future_builtins import zip</code> 的话会禁用。</p>
<h3 id="lib2to3-——-2to3-支持库"><a href="#lib2to3-——-2to3-支持库" class="headerlink" title="lib2to3 —— 2to3 支持库"></a><code>lib2to3</code> —— 2to3 支持库</h3><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/lib2to3/" target="_blank" rel="noopener">Lib/lib2to3/</a></p>
<hr>
<p>Deprecated since version 3.11, will be removed in version 3.13: Python 3.9 switched to a PEG parser (see <a href="https://www.python.org/dev/peps/pep-0617" target="_blank" rel="noopener"><strong>PEP 617</strong></a>) while lib2to3 is using a less flexible LL(1) parser. Python 3.10 includes new language syntax that is not parsable by lib2to3’s LL(1) parser (see <a href="https://www.python.org/dev/peps/pep-0634" target="_blank" rel="noopener"><strong>PEP 634</strong></a>). The <code>lib2to3</code> module was marked pending for deprecation in Python 3.9 (raising <code>PendingDeprecationWarning</code> on import) and fully deprecated in Python 3.11 (raising <code>DeprecationWarning</code>). It will be removed from the standard library in Python 3.13. Consider third-party alternatives such as LibCST or parso.</p>
<p>注解</p>
<p><code>lib2to3</code> API 并不稳定，并可能在未来大幅修改。</p>
<h2 id="test-—-Python回归测试包"><a href="#test-—-Python回归测试包" class="headerlink" title="test —- Python回归测试包"></a><code>test</code> —- Python回归测试包</h2><ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html" target="_blank" rel="noopener"><code>test</code> — Python回归测试包</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support" target="_blank" rel="noopener"><code>test.support</code> — Utilities for the Python test suite</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.socket_helper" target="_blank" rel="noopener"><code>test.support.socket_helper</code> — Utilities for socket tests</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.script_helper" target="_blank" rel="noopener"><code>test.support.script_helper</code> — Utilities for the Python execution tests</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.bytecode_helper" target="_blank" rel="noopener"><code>test.support.bytecode_helper</code> — Support tools for testing correct bytecode generation</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.threading_helper" target="_blank" rel="noopener"><code>test.support.threading_helper</code> — Utilities for threading tests</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.os_helper" target="_blank" rel="noopener"><code>test.support.os_helper</code> — Utilities for os tests</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.import_helper" target="_blank" rel="noopener"><code>test.support.import_helper</code> — Utilities for import tests</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/test.html#module-test.support.warnings_helper" target="_blank" rel="noopener"><code>test.support.warnings_helper</code> — Utilities for warnings tests</a></li>
</ul>
<h1 id="调试和分析"><a href="#调试和分析" class="headerlink" title="调试和分析"></a>调试和分析</h1><p>这些库可以帮助你进行 Python 开发：调试器使你能够逐步执行代码，分析堆栈帧并设置中断点等等，性能分析器可以运行代码并为你提供执行时间的详细数据，使你能够找出你的程序中的瓶颈。 审计事件提供运行时行为的可见性，如果没有此工具则需要进行侵入式调试或修补。</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/audit_events.html" target="_blank" rel="noopener">审计事件表</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/bdb.html" target="_blank" rel="noopener"><code>bdb</code> — Debugger framework</a></li>
<li><code>faulthandler</code> —— 转储 Python 的跟踪信息<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#dumping-the-traceback" target="_blank" rel="noopener">转储跟踪信息</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#fault-handler-state" target="_blank" rel="noopener">故障处理程序的状态</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#dumping-the-tracebacks-after-a-timeout" target="_blank" rel="noopener">一定时间后转储跟踪数据。</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#dumping-the-traceback-on-a-user-signal" target="_blank" rel="noopener">转储用户信号的跟踪信息。</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#issue-with-file-descriptors" target="_blank" rel="noopener">文件描述符相关话题</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/faulthandler.html#example" target="_blank" rel="noopener">示例</a></li>
</ul>
</li>
<li><code>pdb</code> — Python 的调试器<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/pdb.html#debugger-commands" target="_blank" rel="noopener">调试器命令</a></li>
</ul>
</li>
<li>Python Profilers 分析器<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#introduction-to-the-profilers" target="_blank" rel="noopener">profile分析器简介</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#instant-user-s-manual" target="_blank" rel="noopener">实时用户手册</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#module-cProfile" target="_blank" rel="noopener"><code>profile</code> 和 <code>cProfile</code> 模块参考</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#the-stats-class" target="_blank" rel="noopener"><code>Stats</code> 类</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#what-is-deterministic-profiling" target="_blank" rel="noopener">什么是确定性性能分析？</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#limitations" target="_blank" rel="noopener">局限性</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#calibration" target="_blank" rel="noopener">准确估量</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/profile.html#using-a-custom-timer" target="_blank" rel="noopener">使用自定义计时器</a></li>
</ul>
</li>
<li><code>timeit</code> — 测量小代码片段的执行时间<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/timeit.html#basic-examples" target="_blank" rel="noopener">基本示例</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/timeit.html#python-interface" target="_blank" rel="noopener">Python 接口</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/timeit.html#command-line-interface" target="_blank" rel="noopener">命令行接口</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/timeit.html#examples" target="_blank" rel="noopener">例子</a></li>
</ul>
</li>
<li><code>trace</code> —— 跟踪 Python 语句的执行<ul>
<li>命令行用法<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/trace.html#main-options" target="_blank" rel="noopener">主要的可选参数</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/trace.html#modifiers" target="_blank" rel="noopener">修饰器</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/trace.html#filters" target="_blank" rel="noopener">过滤器</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/trace.html#programmatic-interface" target="_blank" rel="noopener">编程接口</a></li>
</ul>
</li>
<li><code>tracemalloc</code> — 跟踪内存分配<ul>
<li>例子<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#display-the-top-10" target="_blank" rel="noopener">显示前10项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#compute-differences" target="_blank" rel="noopener">计算差异</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#get-the-traceback-of-a-memory-block" target="_blank" rel="noopener">Get the traceback of a memory block</a></li>
<li>Pretty top<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#record-the-current-and-peak-size-of-all-traced-memory-blocks" target="_blank" rel="noopener">Record the current and peak size of all traced memory blocks</a></li>
</ul>
</li>
</ul>
</li>
<li>API<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#functions" target="_blank" rel="noopener">函数</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#domainfilter" target="_blank" rel="noopener">域过滤器</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#filter" target="_blank" rel="noopener">过滤器</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#frame" target="_blank" rel="noopener">Frame</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#snapshot" target="_blank" rel="noopener">快照</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#statistic" target="_blank" rel="noopener">统计</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#statisticdiff" target="_blank" rel="noopener">StatisticDiff</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#trace" target="_blank" rel="noopener">跟踪</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tracemalloc.html#traceback" target="_blank" rel="noopener">回溯</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="审计事件表"><a href="#审计事件表" class="headerlink" title="审计事件表"></a>审计事件表</h2><p>下表包含了在整个 CPython 运行时和标准库中由 <code>sys.audit()</code> 或 <code>PySys_Audit()</code> 调用所引发的全部事件。 这些调用是在 3.8.0 或更高版本中添加了 (参见 <a href="https://www.python.org/dev/peps/pep-0578" target="_blank" rel="noopener"><strong>PEP 578</strong></a>)。</p>
<p>请参阅 <code>sys.addaudithook()</code> 和 <code>PySys_AddAuditHook()</code> 了解有关处理这些事件的详细信息。</p>
<p><strong>CPython implementation detail:</strong> 此表是根据 CPython 文档生成的，可能无法表示其他实现所引发的事件。 请参阅你的运行时专属的文档了解实际引发的事件。</p>
<table>
<thead>
<tr>
<th align="left">Audit event</th>
<th align="left">Arguments</th>
<th align="left">References</th>
</tr>
</thead>
<tbody><tr>
<td align="left">array.<strong>new</strong></td>
<td align="left"><code>typecode</code>, <code>initializer</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/array.html#array.array" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">builtins.breakpoint</td>
<td align="left"><code>breakpointhook</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#breakpoint" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">builtins.id</td>
<td align="left"><code>id</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#id" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">builtins.input</td>
<td align="left"><code>prompt</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#input" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">builtins.input/result</td>
<td align="left"><code>result</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#input" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">code.<strong>new</strong></td>
<td align="left"><code>code</code>, <code>filename</code>, <code>name</code>, <code>argcount</code>, <code>posonlyargcount</code>, <code>kwonlyargcount</code>, <code>nlocals</code>, <code>stacksize</code>, <code>flags</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/types.html#types.CodeType" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">compile</td>
<td align="left"><code>source</code>, <code>filename</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#compile" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.PyInterpreterState_Clear</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/c-api/init.html#c.PyInterpreterState_Clear" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.PyInterpreterState_New</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/c-api/init.html#c.PyInterpreterState_New" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython._PySys_ClearAuditHooks</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/c-api/init.html#c.Py_FinalizeEx" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_command</td>
<td align="left"><code>command</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/using/cmdline.html#cmdoption-c" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_file</td>
<td align="left"><code>filename</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/using/cmdline.html#audit_event_cpython_run_file_0" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_interactivehook</td>
<td align="left"><code>hook</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.__interactivehook__" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_module</td>
<td align="left"><code>module-name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/using/cmdline.html#cmdoption-m" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_startup</td>
<td align="left"><code>filename</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/using/cmdline.html#envvar-PYTHONSTARTUP" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">cpython.run_stdin</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/using/cmdline.html#audit_event_cpython_run_stdin_0" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.addressof</td>
<td align="left"><code>obj</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.addressof" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.call_function</td>
<td align="left"><code>func_pointer</code>, <code>arguments</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#foreign-functions" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.cdata</td>
<td align="left"><code>address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes._CData.from_address" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.cdata/buffer</td>
<td align="left"><code>pointer</code>, <code>size</code>, <code>offset</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes._CData.from_buffer" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes._CData.from_buffer_copy" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">ctypes.create_string_buffer</td>
<td align="left"><code>init</code>, <code>size</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.create_string_buffer" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.create_unicode_buffer</td>
<td align="left"><code>init</code>, <code>size</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.create_unicode_buffer" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.dlopen</td>
<td align="left"><code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.LibraryLoader" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.dlsym</td>
<td align="left"><code>library</code>, <code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.LibraryLoader" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.dlsym/handle</td>
<td align="left"><code>handle</code>, <code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.LibraryLoader" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.get_errno</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.get_errno" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.get_last_error</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.get_last_error" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.seh_exception</td>
<td align="left"><code>code</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#foreign-functions" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.set_errno</td>
<td align="left"><code>errno</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.set_errno" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.set_last_error</td>
<td align="left"><code>error</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.set_last_error" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.string_at</td>
<td align="left"><code>address</code>, <code>size</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.string_at" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ctypes.wstring_at</td>
<td align="left"><code>address</code>, <code>size</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ctypes.html#ctypes.wstring_at" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ensurepip.bootstrap</td>
<td align="left"><code>root</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ensurepip.html#ensurepip.bootstrap" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">exec</td>
<td align="left"><code>code_object</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#eval" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#exec" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">fcntl.fcntl</td>
<td align="left"><code>fd</code>, <code>cmd</code>, <code>arg</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/fcntl.html#fcntl.fcntl" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">fcntl.flock</td>
<td align="left"><code>fd</code>, <code>operation</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/fcntl.html#fcntl.flock" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">fcntl.ioctl</td>
<td align="left"><code>fd</code>, <code>request</code>, <code>arg</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/fcntl.html#fcntl.ioctl" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">fcntl.lockf</td>
<td align="left"><code>fd</code>, <code>cmd</code>, <code>len</code>, <code>start</code>, <code>whence</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/fcntl.html#fcntl.lockf" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ftplib.connect</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ftplib.html#ftplib.FTP.connect" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">ftplib.sendcmd</td>
<td align="left"><code>self</code>, <code>cmd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/ftplib.html#ftplib.FTP.sendcmd" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/ftplib.html#ftplib.FTP.voidcmd" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">function.<strong>new</strong></td>
<td align="left"><code>code</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/types.html#types.FunctionType" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">gc.get_objects</td>
<td align="left"><code>generation</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/gc.html#gc.get_objects" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">gc.get_referents</td>
<td align="left"><code>objs</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/gc.html#gc.get_referents" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">gc.get_referrers</td>
<td align="left"><code>objs</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/gc.html#gc.get_referrers" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">glob.glob</td>
<td align="left"><code>pathname</code>, <code>recursive</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/glob.html#glob.glob" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/glob.html#glob.iglob" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">glob.glob/2</td>
<td align="left"><code>pathname</code>, <code>recursive</code>, <code>root_dir</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/glob.html#glob.glob" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/glob.html#glob.iglob" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">http.client.connect</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/http.client.html#http.client.HTTPConnection.connect" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">http.client.send</td>
<td align="left"><code>self</code>, <code>data</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/http.client.html#http.client.HTTPConnection.send" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">imaplib.open</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/imaplib.html#imaplib.IMAP4.open" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">imaplib.send</td>
<td align="left"><code>self</code>, <code>data</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/imaplib.html#imaplib.IMAP4.send" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">import</td>
<td align="left"><code>module</code>, <code>filename</code>, <code>sys.path</code>, <code>sys.meta_path</code>, <code>sys.path_hooks</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/reference/simple_stmts.html#import" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">marshal.dumps</td>
<td align="left"><code>value</code>, <code>version</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/marshal.html#marshal.dump" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">marshal.load</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/marshal.html#marshal.load" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">marshal.loads</td>
<td align="left"><code>bytes</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/marshal.html#marshal.load" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">mmap.<strong>new</strong></td>
<td align="left"><code>fileno</code>, <code>length</code>, <code>access</code>, <code>offset</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/mmap.html#mmap.mmap" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">msvcrt.get_osfhandle</td>
<td align="left"><code>fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#msvcrt.get_osfhandle" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">msvcrt.locking</td>
<td align="left"><code>fd</code>, <code>mode</code>, <code>nbytes</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#msvcrt.locking" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">msvcrt.open_osfhandle</td>
<td align="left"><code>handle</code>, <code>flags</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#msvcrt.open_osfhandle" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">nntplib.connect</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/nntplib.html#nntplib.NNTP" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/nntplib.html#nntplib.NNTP_SSL" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">nntplib.putline</td>
<td align="left"><code>self</code>, <code>line</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/nntplib.html#nntplib.NNTP" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/nntplib.html#nntplib.NNTP_SSL" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">object.<strong>delattr</strong></td>
<td align="left"><code>obj</code>, <code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__delattr__" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">object.<strong>getattr</strong></td>
<td align="left"><code>obj</code>, <code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__getattribute__" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">object.<strong>setattr</strong></td>
<td align="left"><code>obj</code>, <code>name</code>, <code>value</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__setattr__" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">open</td>
<td align="left"><code>path</code>, <code>mode</code>, <code>flags</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/functions.html#open" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/io.html#io.open" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.open" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">os.add_dll_directory</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.add_dll_directory" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.chdir</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.chdir" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.fchdir" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">os.chflags</td>
<td align="left"><code>path</code>, <code>flags</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.chflags" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.lchflags" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">os.chmod</td>
<td align="left"><code>path</code>, <code>mode</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.chmod" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.fchmod" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.lchmod" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">os.chown</td>
<td align="left"><code>path</code>, <code>uid</code>, <code>gid</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.chown" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.fchown" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.lchown" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">os.exec</td>
<td align="left"><code>path</code>, <code>args</code>, <code>env</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.execl" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.fork</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.fork" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.forkpty</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.forkpty" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.fwalk</td>
<td align="left"><code>top</code>, <code>topdown</code>, <code>onerror</code>, <code>follow_symlinks</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.fwalk" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.getxattr</td>
<td align="left"><code>path</code>, <code>attribute</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.getxattr" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.kill</td>
<td align="left"><code>pid</code>, <code>sig</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.kill" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.killpg</td>
<td align="left"><code>pgid</code>, <code>sig</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.killpg" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.link</td>
<td align="left"><code>src</code>, <code>dst</code>, <code>src_dir_fd</code>, <code>dst_dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.link" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.listdir</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.listdir" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.listxattr</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.listxattr" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.lockf</td>
<td align="left"><code>fd</code>, <code>cmd</code>, <code>len</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.lockf" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.mkdir</td>
<td align="left"><code>path</code>, <code>mode</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.makedirs" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.mkdir" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">os.posix_spawn</td>
<td align="left"><code>path</code>, <code>argv</code>, <code>env</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.posix_spawn" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.posix_spawnp" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">os.putenv</td>
<td align="left"><code>key</code>, <code>value</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.putenv" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.remove</td>
<td align="left"><code>path</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.remove" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.removedirs" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.unlink" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">os.removexattr</td>
<td align="left"><code>path</code>, <code>attribute</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.removexattr" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.rename</td>
<td align="left"><code>src</code>, <code>dst</code>, <code>src_dir_fd</code>, <code>dst_dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.rename" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.renames" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.replace" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">os.rmdir</td>
<td align="left"><code>path</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.rmdir" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.scandir</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.scandir" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.setxattr</td>
<td align="left"><code>path</code>, <code>attribute</code>, <code>value</code>, <code>flags</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.setxattr" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.spawn</td>
<td align="left"><code>mode</code>, <code>path</code>, <code>args</code>, <code>env</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.spawnl" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.startfile</td>
<td align="left"><code>path</code>, <code>operation</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.startfile" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.startfile/2</td>
<td align="left"><code>path</code>, <code>operation</code>, <code>arguments</code>, <code>cwd</code>, <code>show_cmd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.startfile" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.symlink</td>
<td align="left"><code>src</code>, <code>dst</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.symlink" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.system</td>
<td align="left"><code>command</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.system" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.truncate</td>
<td align="left"><code>fd</code>, <code>length</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.ftruncate" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.truncate" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">os.unsetenv</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.unsetenv" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.utime</td>
<td align="left"><code>path</code>, <code>times</code>, <code>ns</code>, <code>dir_fd</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.utime" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">os.walk</td>
<td align="left"><code>top</code>, <code>topdown</code>, <code>onerror</code>, <code>followlinks</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/os.html#os.walk" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">pathlib.Path.glob</td>
<td align="left"><code>self</code>, <code>pattern</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/pathlib.html#pathlib.Path.glob" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">pathlib.Path.rglob</td>
<td align="left"><code>self</code>, <code>pattern</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/pathlib.html#pathlib.Path.rglob" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">pdb.Pdb</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/pdb.html#pdb.Pdb" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">pickle.find_class</td>
<td align="left"><code>module</code>, <code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/pickle.html#pickle.Unpickler.find_class" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">poplib.connect</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/poplib.html#poplib.POP3" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/poplib.html#poplib.POP3_SSL" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">poplib.putline</td>
<td align="left"><code>self</code>, <code>line</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/poplib.html#poplib.POP3" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/poplib.html#poplib.POP3_SSL" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">pty.spawn</td>
<td align="left"><code>argv</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/pty.html#pty.spawn" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">resource.prlimit</td>
<td align="left"><code>pid</code>, <code>resource</code>, <code>limits</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/resource.html#resource.prlimit" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">resource.setrlimit</td>
<td align="left"><code>resource</code>, <code>limits</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/resource.html#resource.setrlimit" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">setopencodehook</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/c-api/file.html#c.PyFile_SetOpenCodeHook" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.chown</td>
<td align="left"><code>path</code>, <code>user</code>, <code>group</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.chown" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.copyfile</td>
<td align="left"><code>src</code>, <code>dst</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copy" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copy2" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copyfile" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">shutil.copymode</td>
<td align="left"><code>src</code>, <code>dst</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copy" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copymode" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">shutil.copystat</td>
<td align="left"><code>src</code>, <code>dst</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copy2" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copystat" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">shutil.copytree</td>
<td align="left"><code>src</code>, <code>dst</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.copytree" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.make_archive</td>
<td align="left"><code>base_name</code>, <code>format</code>, <code>root_dir</code>, <code>base_dir</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.make_archive" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.move</td>
<td align="left"><code>src</code>, <code>dst</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.move" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.rmtree</td>
<td align="left"><code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.rmtree" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">shutil.unpack_archive</td>
<td align="left"><code>filename</code>, <code>extract_dir</code>, <code>format</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/shutil.html#shutil.unpack_archive" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">signal.pthread_kill</td>
<td align="left"><code>thread_id</code>, <code>signalnum</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/signal.html#signal.pthread_kill" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">smtplib.connect</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/smtplib.html#smtplib.SMTP.connect" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">smtplib.send</td>
<td align="left"><code>self</code>, <code>data</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/smtplib.html#smtplib.SMTP" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.<strong>new</strong></td>
<td align="left"><code>self</code>, <code>family</code>, <code>type</code>, <code>protocol</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.bind</td>
<td align="left"><code>self</code>, <code>address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket.bind" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.connect</td>
<td align="left"><code>self</code>, <code>address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket.connect" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket.connect_ex" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">socket.getaddrinfo</td>
<td align="left"><code>host</code>, <code>port</code>, <code>family</code>, <code>type</code>, <code>protocol</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.getaddrinfo" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.gethostbyaddr</td>
<td align="left"><code>ip_address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.gethostbyaddr" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.gethostbyname</td>
<td align="left"><code>hostname</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.gethostbyname" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.gethostbyname_ex" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">socket.gethostname</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.gethostname" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.getnameinfo</td>
<td align="left"><code>sockaddr</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.getnameinfo" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.getservbyname</td>
<td align="left"><code>servicename</code>, <code>protocolname</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.getservbyname" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.getservbyport</td>
<td align="left"><code>port</code>, <code>protocolname</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.getservbyport" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.sendmsg</td>
<td align="left"><code>self</code>, <code>address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket.sendmsg" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.sendto</td>
<td align="left"><code>self</code>, <code>address</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.socket.sendto" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">socket.sethostname</td>
<td align="left"><code>name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/socket.html#socket.sethostname" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sqlite3.connect</td>
<td align="left"><code>database</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sqlite3.html#sqlite3.connect" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sqlite3.connect/handle</td>
<td align="left"><code>connection_handle</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sqlite3.html#sqlite3.connect" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sqlite3.enable_load_extension</td>
<td align="left"><code>connection</code>, <code>enabled</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sqlite3.html#sqlite3.enable_load_extension" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sqlite3.load_extension</td>
<td align="left"><code>connection</code>, <code>path</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sqlite3.html#sqlite3.load_extension" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">subprocess.Popen</td>
<td align="left"><code>executable</code>, <code>args</code>, <code>cwd</code>, <code>env</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/subprocess.html#subprocess.Popen" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys._current_exceptions</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys._current_exceptions" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys._current_frames</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys._current_frames" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys._getframe</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys._getframe" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.addaudithook</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/c-api/sys.html#c.PySys_AddAuditHook" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.addaudithook" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">sys.excepthook</td>
<td align="left"><code>hook</code>, <code>type</code>, <code>value</code>, <code>traceback</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.excepthook" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.set_asyncgen_hooks_finalizer</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.set_asyncgen_hooks" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.set_asyncgen_hooks_firstiter</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.set_asyncgen_hooks" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.setprofile</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.setprofile" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.settrace</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.settrace" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">sys.unraisablehook</td>
<td align="left"><code>hook</code>, <code>unraisable</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/sys.html#sys.unraisablehook" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">syslog.closelog</td>
<td align="left"></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/syslog.html#syslog.closelog" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">syslog.openlog</td>
<td align="left"><code>ident</code>, <code>logoption</code>, <code>facility</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/syslog.html#syslog.openlog" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">syslog.setlogmask</td>
<td align="left"><code>maskpri</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/syslog.html#syslog.setlogmask" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">syslog.syslog</td>
<td align="left"><code>priority</code>, <code>message</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/syslog.html#syslog.syslog" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">telnetlib.Telnet.open</td>
<td align="left"><code>self</code>, <code>host</code>, <code>port</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/telnetlib.html#telnetlib.Telnet.open" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">telnetlib.Telnet.write</td>
<td align="left"><code>self</code>, <code>buffer</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/telnetlib.html#telnetlib.Telnet.write" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">tempfile.mkdtemp</td>
<td align="left"><code>fullpath</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile.TemporaryDirectory" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile.mkdtemp" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">tempfile.mkstemp</td>
<td align="left"><code>fullpath</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile.NamedTemporaryFile" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile.TemporaryFile" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile.mkstemp" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">urllib.Request</td>
<td align="left"><code>fullurl</code>, <code>data</code>, <code>headers</code>, <code>method</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/urllib.request.html#urllib.request.urlopen" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">webbrowser.open</td>
<td align="left"><code>url</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/webbrowser.html#webbrowser.open" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.ConnectRegistry</td>
<td align="left"><code>computer_name</code>, <code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.ConnectRegistry" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.CreateKey</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>access</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.CreateKey" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.CreateKeyEx" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">winreg.DeleteKey</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>access</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.DeleteKey" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.DeleteKeyEx" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">winreg.DeleteValue</td>
<td align="left"><code>key</code>, <code>value</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.DeleteValue" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.DisableReflectionKey</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.DisableReflectionKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.EnableReflectionKey</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.EnableReflectionKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.EnumKey</td>
<td align="left"><code>key</code>, <code>index</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.EnumKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.EnumValue</td>
<td align="left"><code>key</code>, <code>index</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.EnumValue" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.ExpandEnvironmentStrings</td>
<td align="left"><code>str</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.ExpandEnvironmentStrings" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.LoadKey</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>file_name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.LoadKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.OpenKey</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>access</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.OpenKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.OpenKey/result</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.CreateKey" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.CreateKeyEx" target="_blank" rel="noopener">[2]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.OpenKey" target="_blank" rel="noopener">[3]</a></td>
</tr>
<tr>
<td align="left">winreg.PyHKEY.Detach</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.PyHKEY.Detach" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.QueryInfoKey</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.QueryInfoKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.QueryReflectionKey</td>
<td align="left"><code>key</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.QueryReflectionKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.QueryValue</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>value_name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.QueryValue" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.QueryValueEx" target="_blank" rel="noopener">[2]</a></td>
</tr>
<tr>
<td align="left">winreg.SaveKey</td>
<td align="left"><code>key</code>, <code>file_name</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.SaveKey" target="_blank" rel="noopener">[1]</a></td>
</tr>
<tr>
<td align="left">winreg.SetValue</td>
<td align="left"><code>key</code>, <code>sub_key</code>, <code>type</code>, <code>value</code></td>
<td align="left"><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.SetValue" target="_blank" rel="noopener">[1]</a><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#winreg.SetValueEx" target="_blank" rel="noopener">[2]</a></td>
</tr>
</tbody></table>
<p>下列事件只在内部被引发，而不会回应任何 CPython 公共 API:</p>
<table>
<thead>
<tr>
<th align="left">审计事件</th>
<th align="left">实参</th>
</tr>
</thead>
<tbody><tr>
<td align="left">_winapi.CreateFile</td>
<td align="left"><code>file_name</code>, <code>desired_access</code>, <code>share_mode</code>, <code>creation_disposition</code>, <code>flags_and_attributes</code></td>
</tr>
<tr>
<td align="left">_winapi.CreateJunction</td>
<td align="left"><code>src_path</code>, <code>dst_path</code></td>
</tr>
<tr>
<td align="left">_winapi.CreateNamedPipe</td>
<td align="left"><code>name</code>, <code>open_mode</code>, <code>pipe_mode</code></td>
</tr>
<tr>
<td align="left">_winapi.CreatePipe</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">_winapi.CreateProcess</td>
<td align="left"><code>application_name</code>, <code>command_line</code>, <code>current_directory</code></td>
</tr>
<tr>
<td align="left">_winapi.OpenProcess</td>
<td align="left"><code>process_id</code>, <code>desired_access</code></td>
</tr>
<tr>
<td align="left">_winapi.TerminateProcess</td>
<td align="left"><code>handle</code>, <code>exit_code</code></td>
</tr>
<tr>
<td align="left">ctypes.PyObj_FromPtr</td>
<td align="left"><code>obj</code></td>
</tr>
</tbody></table>
<h1 id="软件打包和分发"><a href="#软件打包和分发" class="headerlink" title="软件打包和分发"></a>软件打包和分发</h1><p>这些库可帮助你发布和安装 Python 软件。 虽然这些模块设计为与<code>Python 包索引 &lt;[https://pypi.org](https://pypi.org/)&gt;</code>__结合使用，但它们也可以与本地索引服务器一起使用，或者根本不使用任何索引服务器。</p>
<ul>
<li><code>distutils</code> —- 构建和安装 Python 模块</li>
<li><code>ensurepip</code> —- Bootstrapping the <code>pip</code> installer<ul>
<li>Command line interface</li>
<li>Module API</li>
</ul>
</li>
<li><code>venv</code> —- 创建虚拟环境<ul>
<li>创建虚拟环境</li>
<li>API</li>
<li>一个扩展 <code>EnvBuilder</code> 的例子</li>
</ul>
</li>
<li><code>zipapp</code> —- Manage executable Python zip archives<ul>
<li>Basic Example</li>
<li>命令行接口</li>
<li>Python API</li>
<li>例子</li>
<li>Specifying the Interpreter</li>
<li>Creating Standalone Applications with zipapp<ul>
<li>Making a Windows executable</li>
<li>Caveats</li>
</ul>
</li>
<li>The Python Zip Application Archive Format</li>
</ul>
</li>
</ul>
<h2 id="distutils-—-构建和安装-Python-模块"><a href="#distutils-—-构建和安装-Python-模块" class="headerlink" title="distutils —- 构建和安装 Python 模块"></a><code>distutils</code> —- 构建和安装 Python 模块</h2><p><code>distutils</code> 已被弃用并计划在 Python 3.12 中移除。 </p>
<hr>
<p><code>distutils</code> 包为将待构建和安装的额外的模块，打包成 Python 安装包提供支持。新模块既可以是百分百的纯 Python，也可以是用 C 写的扩展模块，或者可以是一组包含了同时用 Python 和 C 编码的 Python 包。</p>
<p>大多数 Python 用户 <em>不会</em> 想要直接使用这个包，而是使用 Python 包官方维护的跨版本工具。特别地， setuptools 是一个对于 <code>distutils</code> 的增强选项，它能提供：</p>
<ul>
<li>对声明项目依赖的支持</li>
<li>额外的用于配置哪些文件包含在源代码发布中的机制（包括与版本控制系统集成需要的插件）</li>
<li>生成项目“进入点”的能力，进入点可用作应用插件系统的基础</li>
<li>自动在安装时间生成 Windows 命令行可执行文件的能力，而不是需要预编译它们</li>
<li>跨所有受支持的 Python 版本上的一致的表现</li>
</ul>
<p>推荐的 pip 安装器用 <code>setuptools</code> 运行所有的 <code>setup.py</code> 脚本，即使脚本本身只引了 <code>distutils</code> 包。</p>
<p>为了打包工具的作者和用户能更好理解当前的打包和分发系统，遗留的基于 <code>distutils</code> 的用户文档和 API 参考保持可用：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/install/index.html#install-index" target="_blank" rel="noopener">安装Python模块（旧版）</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/distutils/index.html#distutils-index" target="_blank" rel="noopener">分发 Python 模块（遗留版本）</a></li>
</ul>
<h2 id="ensurepip-—-Bootstrapping-the-pip-installer"><a href="#ensurepip-—-Bootstrapping-the-pip-installer" class="headerlink" title="ensurepip —- Bootstrapping the pip installer"></a><code>ensurepip</code> —- Bootstrapping the <code>pip</code> installer</h2><p>3.4 新版功能.</p>
<hr>
<p>The <code>ensurepip</code> package provides support for bootstrapping the <code>pip</code> installer into an existing Python installation or virtual environment. This bootstrapping approach reflects the fact that <code>pip</code> is an independent project with its own release cycle, and the latest available stable version is bundled with maintenance and feature releases of the CPython reference interpreter.</p>
<p>In most cases, end users of Python shouldn’t need to invoke this module directly (as <code>pip</code> should be bootstrapped by default), but it may be needed if installing <code>pip</code> was skipped when installing Python (or when creating a virtual environment) or after explicitly uninstalling <code>pip</code>.</p>
<p>注解</p>
<p>This module <em>does not</em> access the internet. All of the components needed to bootstrap <code>pip</code> are included as internal parts of the package.</p>
<h3 id="Command-line-interface"><a href="#Command-line-interface" class="headerlink" title="Command line interface"></a>Command line interface</h3><p>The command line interface is invoked using the interpreter’s <code>-m</code> switch.</p>
<p>The simplest possible invocation is:</p>
<pre><code>python -m ensurepip</code></pre><p>This invocation will install <code>pip</code> if it is not already installed, but otherwise does nothing. To ensure the installed version of <code>pip</code> is at least as recent as the one available in <code>ensurepip</code>, pass the <code>--upgrade</code> option:</p>
<pre><code>python -m ensurepip --upgrade</code></pre><p>By default, <code>pip</code> is installed into the current virtual environment (if one is active) or into the system site packages (if there is no active virtual environment). The installation location can be controlled through two additional command line options:</p>
<ul>
<li><code>--root &lt;dir&gt;</code>: Installs <code>pip</code> relative to the given root directory rather than the root of the currently active virtual environment (if any) or the default root for the current Python installation.</li>
<li><code>--user</code>: Installs <code>pip</code> into the user site packages directory rather than globally for the current Python installation (this option is not permitted inside an active virtual environment).</li>
</ul>
<p>By default, the scripts <code>pipX</code> and <code>pipX.Y</code> will be installed (where X.Y stands for the version of Python used to invoke <code>ensurepip</code>). The scripts installed can be controlled through two additional command line options:</p>
<ul>
<li><code>--altinstall</code>: if an alternate installation is requested, the <code>pipX</code> script will <em>not</em> be installed.</li>
<li><code>--default-pip</code>: if a “default pip” installation is requested, the <code>pip</code> script will be installed in addition to the two regular scripts.</li>
</ul>
<p>Providing both of the script selection options will trigger an exception.</p>
<h3 id="Module-API"><a href="#Module-API" class="headerlink" title="Module API"></a>Module API</h3><p><code>ensurepip</code> exposes two functions for programmatic use:</p>
<p><code>ensurepip.version</code>()</p>
<p>Returns a string specifying the available version of pip that will be installed when bootstrapping an environment.</p>
<p><code>ensurepip.bootstrap</code>(<em>root=None</em>, <em>upgrade=False</em>, <em>user=False</em>, <em>altinstall=False</em>, <em>default_pip=False</em>, <em>verbosity=0</em>)</p>
<p>Bootstraps <code>pip</code> into the current or designated environment.</p>
<p><em>root</em> specifies an alternative root directory to install relative to. If <em>root</em> is <code>None</code>, then installation uses the default install location for the current environment.</p>
<p><em>upgrade</em> indicates whether or not to upgrade an existing installation of an earlier version of <code>pip</code> to the available version.</p>
<p><em>user</em> indicates whether to use the user scheme rather than installing globally.</p>
<p>By default, the scripts <code>pipX</code> and <code>pipX.Y</code> will be installed (where X.Y stands for the current version of Python).</p>
<p>If <em>altinstall</em> is set, then <code>pipX</code> will <em>not</em> be installed.</p>
<p>If <em>default_pip</em> is set, then <code>pip</code> will be installed in addition to the two regular scripts.</p>
<p>Setting both <em>altinstall</em> and <em>default_pip</em> will trigger <code>ValueError</code>.</p>
<p><em>verbosity</em> controls the level of output to <code>sys.stdout</code> from the bootstrapping operation.</p>
<p>Raises an auditing event <code>ensurepip.bootstrap</code> with argument <code>root</code>.</p>
<p>注解</p>
<p>The bootstrapping process has side effects on both <code>sys.path</code> and <code>os.environ</code>. Invoking the command line interface in a subprocess instead allows these side effects to be avoided.</p>
<p>注解</p>
<p>The bootstrapping process may install additional modules required by <code>pip</code>, but other software should not assume those dependencies will always be present by default (as the dependencies may be removed in a future version of <code>pip</code>).</p>
<h2 id="venv-—-创建虚拟环境"><a href="#venv-—-创建虚拟环境" class="headerlink" title="venv —- 创建虚拟环境"></a><code>venv</code> —- 创建虚拟环境</h2><p>3.3 新版功能.</p>
<p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/venv/" target="_blank" rel="noopener">Lib/venv/</a></p>
<hr>
<p><code>venv</code> 模块支持使用自己的站点目录创建轻量级“虚拟环境”，可选择与系统站点目录隔离。每个虚拟环境都有自己的 Python 二进制文件（与用于创建此环境的二进制文件的版本相匹配），并且可以在其站点目录中拥有自己独立的已安装 Python 软件包集。</p>
<p>有关 Python 虚拟环境的更多信息，请参阅 <a href="https://www.python.org/dev/peps/pep-0405" target="_blank" rel="noopener"><strong>PEP 405</strong></a> 。</p>
<p>参见</p>
<p><a href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment" target="_blank" rel="noopener">Python 打包用户指南：创建和使用虚拟环境</a></p>
<h3 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><p>通过执行 <code>venv</code> 指令来创建一个 虚拟环境:</p>
<pre><code>python3 -m venv /path/to/new/virtual/environment</code></pre><p>运行此命令将创建目标目录（父目录若不存在也将创建），并放置一个 <code>pyvenv.cfg</code> 文件在其中，文件中有一个 <code>home</code> 键，它的值指向运行此命令的 Python 安装（目标目录的常用名称是 <code>.venv</code>）。它还会创建一个 <code>bin</code> 子目录（在 Windows 上是 <code>Scripts</code>），其中包含 Python 二进制文件的副本或符号链接（视创建环境时使用的平台或参数而定）。它还会创建一个（初始为空的） <code>lib/pythonX.Y/site-packages</code> 子目录（在 Windows 上是 <code>Lib\site-packages</code>）。如果指定了一个现有的目录，这个目录就将被重新使用。</p>
<p>3.6 版后已移除: <code>pyvenv</code> 是 Python 3.3 和 3.4 中创建虚拟环境的推荐工具，不过 <a href="https://docs.python.org/dev/whatsnew/3.6.html#deprecated-features" target="_blank" rel="noopener">在 Python 3.6 中已弃用</a>。</p>
<p>在 3.5 版更改: 现在推荐使用 <code>venv</code> 来创建虚拟环境。</p>
<p>在 Windows 上，调用 <code>venv</code> 命令如下:</p>
<pre><code>c:\&gt;c:\Python35\python -m venv c:\path\to\myenv</code></pre><p>或者，如果已经为 Python 安装 配置好 <code>PATH</code> 和 <code>PATHEXT</code> 变量:</p>
<pre><code>c:\&gt;python -m venv c:\path\to\myenv</code></pre><p>本命令如果以 <code>-h</code> 参数运行，将显示可用的选项:</p>
<pre><code>usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]
            [--upgrade] [--without-pip] [--prompt PROMPT] [--upgrade-deps]
            ENV_DIR [ENV_DIR ...]
Creates virtual Python environments in one or more target directories.
positional arguments:
  ENV_DIR               A directory to create the environment in.
optional arguments:
  -h, --help            show this help message and exit
  --system-site-packages
                        Give the virtual environment access to the system
                        site-packages dir.
  --symlinks            Try to use symlinks rather than copies, when symlinks
                        are not the default for the platform.
  --copies              Try to use copies rather than symlinks, even when
                        symlinks are the default for the platform.
  --clear               Delete the contents of the environment directory if it
                        already exists, before environment creation.
  --upgrade             Upgrade the environment directory to use this version
                        of Python, assuming Python has been upgraded in-place.
  --without-pip         Skips installing or upgrading pip in the virtual
                        environment (pip is bootstrapped by default)
  --prompt PROMPT       Provides an alternative prompt prefix for this
                        environment.
  --upgrade-deps        Upgrade core dependencies: pip setuptools to the
                        latest version in PyPI
Once an environment has been created, you may wish to activate it, e.g. by
sourcing an activate script in its bin directory.</code></pre><p>在 3.9 版更改: 添加 <code>--upgrade-deps</code> 选项，用于将 pip + setuptools 升级到 PyPI 上的最新版本</p>
<p>在 3.4 版更改: 默认安装 pip，并添加 <code>--without-pip</code> 和 <code>--copies</code> 选项</p>
<p>在 3.4 版更改: 在早期版本中，如果目标目录已存在，将引发错误，除非使用了 <code>--clear</code> 或 <code>--upgrade</code> 选项。</p>
<p>注解</p>
<p>虽然 Windows 支持符号链接，但不推荐使用它们。特别注意，在文件资源管理器中双击 <code>python.exe</code> 将立即解析符号链接，并忽略虚拟环境。</p>
<p>注解</p>
<p>在 Microsoft Windows 上，为了启用 <code>Activate.ps1</code> 脚本，可能需要修改用户的执行策略。可以运行以下 PowerShell 命令来执行此操作：</p>
<p>PS C:&gt; Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</p>
<p>参阅 <a href="https://go.microsoft.com/fwlink/?LinkID=135170" target="_blank" rel="noopener">About Execution Policies</a> 以获取更多信息。</p>
<p>生成的 <code>pyvenv.cfg</code> 文件还包括 <code>include-system-site-packages</code> 键，如果运行 <code>venv</code> 时带有 <code>--system-site-packages</code> 选项，则键值为 <code>true</code>，否则为 <code>false</code>。</p>
<p>除非采用 <code>--without-pip</code> 选项，否则将会调用 <code>ensurepip</code> 将 <code>pip</code> 引导到虚拟环境中。</p>
<p>可以向 <code>venv</code> 传入多个路径，此时将根据给定的选项，在所给的每个路径上创建相同的虚拟环境。</p>
<p>创建虚拟环境后，可以使用虚拟环境的二进制目录中的脚本来“激活”该环境。不同平台调用的脚本是不同的（须将 <venv> 替换为包含虚拟环境的目录路径）：</venv></p>
<table>
<thead>
<tr>
<th align="left">平台</th>
<th align="left">Shell</th>
<th align="left">用于激活虚拟环境的命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">POSIX</td>
<td align="left">bash/zsh</td>
<td align="left">$ source &lt;venv&gt;/bin/activate</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">fish</td>
<td align="left">$ source &lt;venv&gt;/bin/activate.fish</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">csh/tcsh</td>
<td align="left">$ source &lt;venv&gt;/bin/activate.csh</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">PowerShell Core</td>
<td align="left">$ &lt;venv&gt;/bin/Activate.ps1</td>
</tr>
<tr>
<td align="left">Windows</td>
<td align="left">cmd.exe</td>
<td align="left">C:&gt; &lt;venv&gt;\Scripts\activate.bat</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">PowerShell</td>
<td align="left">PS C:&gt; &lt;venv&gt;\Scripts\Activate.ps1</td>
</tr>
</tbody></table>
<p>当一个虚拟环境被激活时，<code>VIRTUAL_ENV</code> 环境变量会被设为该虚拟环境的路径。 这可被用来检测程序是否运行在虚拟环境中。</p>
<p>激活环境不是 <em>必须</em> 的，激活只是将虚拟环境的二进制目录添加到搜索路径中，这样 “python” 命令将调用虚拟环境的 Python 解释器，可以运行其中已安装的脚本，而不必输入其完整路径。但是，安装在虚拟环境中的所有脚本都应在不激活的情况下可运行，并自动与虚拟环境的 Python 一起运行。</p>
<p>在 shell 中输入 “deactivate” 可以退出虚拟环境。具体机制取决于不同平台，并且是内部实现（通常使用脚本或 shell 函数）。</p>
<p>3.4 新版功能: <code>fish</code> 和 <code>csh</code> 激活脚本。</p>
<p>3.8 新版功能: 在 POSIX 上安装 PowerShell 激活脚本，以支持 PowerShell Core。</p>
<p>注解</p>
<p>虚拟环境是一个 Python 环境，安装到其中的 Python 解释器、库和脚本与其他虚拟环境中的内容是隔离的，且（默认）与“系统级” Python（操作系统的一部分）中安装的库是隔离的。</p>
<p>虚拟环境是一个目录树，其中包含 Python 可执行文件和其他文件，其他文件指示了这是一个是虚拟环境。</p>
<p>常用安装工具如 setuptools 和 pip 可以在虚拟环境中按预期工作。换句话说，当虚拟环境被激活，它们就会将 Python 软件包安装到虚拟环境中，无需明确指示。</p>
<p>当虚拟环境被激活（即虚拟环境的 Python 解释器正在运行），属性 <code>sys.prefix</code> 和 <code>sys.exec_prefix</code> 指向的是虚拟环境的基础目录，而 <code>sys.base_prefix</code> 和 <code>sys.base_exec_prefix</code> 指向非虚拟环境的 Python 安装，即曾用于创建虚拟环境的那个 Python 安装。如果虚拟环境没有被激活，则 <code>sys.prefix</code> 与 <code>sys.base_prefix</code> 相同，且 <code>sys.exec_prefix</code> 与 <code>sys.base_exec_prefix</code> 相同（它们均指向非虚拟环境的 Python 安装）。</p>
<p>当虚拟环境被激活，所有 <code>distutils</code> 配置文件中更改安装路径的选项都会被忽略，以防止无意中将项目安装在虚拟环境之外。</p>
<p>在命令行 shell 中工作时，用户可以运行虚拟环境可执行文件目录中的 <code>activate</code> 脚本来激活虚拟环境（调用该文件的确切文件名和命令取决于 shell），这会将虚拟环境的可执行文件目录添加到当前 shell 的 <code>PATH</code> 环境变量。在其他情况下，无需激活虚拟环境。安装到虚拟环境中的脚本有 “shebang” 行，指向虚拟环境的 Python 解释器。这意味着无论 <code>PATH</code> 的值如何，脚本都将与该解释器一起运行。在 Windows 上，如果已安装 Python Launcher for Windows，则支持处理 “shebang” 行（此功能在 Python 3.3 中添加，详情请参阅 <a href="https://www.python.org/dev/peps/pep-0397" target="_blank" rel="noopener"><strong>PEP 397</strong></a>）。这样，在 Windows 资源管理器中双击已安装的脚本，应该会使用正确的解释器运行该脚本，而在 <code>PATH</code> 中无需指向其虚拟环境。</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>上述的高级方法使用了一个简单的 API，该 API 提供了一种机制，第三方虚拟环境创建者可以根据其需求自定义环境创建过程，该 API 为 <code>EnvBuilder</code> 类。</p>
<p><em>class</em> <code>venv.EnvBuilder</code>(<em>system_site_packages=False</em>, <em>clear=False</em>, <em>symlinks=False</em>, <em>upgrade=False</em>, <em>with_pip=False</em>, <em>prompt=None</em>, <em>upgrade_deps=False</em>)</p>
<p><code>EnvBuilder</code> 类在实例化时接受以下关键字参数：</p>
<ul>
<li><code>system_site_packages</code> — 一个布尔值，要求系统 Python 的 site-packages 对环境可用（默认为 <code>False</code>）。</li>
<li><code>clear</code> — 一个布尔值，如果为 true，则在创建环境前将删除目标目录的现有内容。</li>
<li><code>symlinks</code> — 一个布尔值，指示是否尝试符号链接 Python 二进制文件，而不是进行复制。</li>
<li><code>upgrade</code> — 一个布尔值，如果为 true，则将使用当前运行的 Python 去升级一个现有的环境，这主要在原位置的 Python 更新后使用（默认为 <code>False</code>）。</li>
<li><code>with_pip</code> — 一个布尔值，如果为 true，则确保在虚拟环境中已安装 pip。这使用的是带有 <code>--default-pip</code> 选项的 <code>ensurepip</code>。</li>
<li><code>prompt</code> — 激活虚拟环境后显示的提示符（默认为 <code>None</code>，表示使用环境所在的目录名称）。如果使用了 <code>"."</code> 这一特殊字符串，则使用当前目录的基本名称作为提示符。</li>
<li><code>upgrade_deps</code> — 将基本 venv 模块更新为 PyPI 上的最新版本。</li>
</ul>
<p>在 3.4 版更改: 添加 <code>with_pip</code> 参数</p>
<p>3.6 新版功能: 添加 <code>prompt</code> 参数</p>
<p>3.9 新版功能: 添加 <code>upgrade_deps</code> 参数</p>
<p>第三方虚拟环境工具的创建者可以自由地将此处提供的 <code>EnvBuilder</code> 类作为基类。</p>
<p>返回的 env-builder 是一个对象，包含一个 <code>create</code> 方法：</p>
<ul>
<li><p><code>create</code>(<em>env_dir</em>)</p>
<p>指定要建立虚拟环境的目标目录（绝对路径或相对于当前路径）来创建虚拟环境。<code>create</code> 方法将在指定目录中创建环境，或者引发对应的异常。</p>
<p><code>EnvBuilder</code> 类的 <code>create</code> 方法定义了可用于定制子类的钩子:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> env_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Create a virtualized Python environment in a directory.
    env_dir is the target directory to create an environment in.
    """</span>
    env_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>env_dir<span class="token punctuation">)</span>
    context <span class="token operator">=</span> self<span class="token punctuation">.</span>ensure_directories<span class="token punctuation">(</span>env_dir<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>create_configuration<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>setup_python<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>setup_scripts<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>post_setup<span class="token punctuation">(</span>context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>每个方法 <code>ensure_directories()</code>, <code>create_configuration()</code>, <code>setup_python()</code>, <code>setup_scripts()</code> 和 <code>post_setup()</code> 都可以被重写。</p>
</li>
<li><p><code>ensure_directories</code>(<em>env_dir</em>)</p>
<p>创建环境目录和所有必需的目录，并返回一个上下文对象。该对象只是一个容器，保存属性（如路径），供其他方法使用。允许目录已经存在，如果指定了 <code>clear</code> 或 <code>upgrade</code> 就允许在现有环境目录上进行操作。</p>
</li>
<li><p><code>create_configuration</code>(<em>context</em>)</p>
<p>在环境中创建 <code>pyvenv.cfg</code> 配置文件。</p>
</li>
<li><p><code>setup_python</code>(<em>context</em>)</p>
<p>在环境中创建 Python 可执行文件的拷贝或符号链接。在 POSIX 系统上，如果给定了可执行文件 <code>python3.x</code>，将创建指向该可执行文件的 <code>python</code> 和 <code>python3</code> 符号链接，除非相同名称的文件已经存在。</p>
</li>
<li><p><code>setup_scripts</code>(<em>context</em>)</p>
<p>将适用于平台的激活脚本安装到虚拟环境中。</p>
</li>
<li><p><code>upgrade_dependencies</code>(<em>context</em>)</p>
<p>升级环境中 venv 依赖的核心软件包（当前为 <code>pip</code> 和 <code>setuptools</code>）。通过在环境中使用 <code>pip</code> 可执行文件来完成。</p>
<p>3.9 新版功能.</p>
</li>
<li><p><code>post_setup</code>(<em>context</em>)</p>
<p>占位方法，可以在第三方实现中重写，用于在虚拟环境中预安装软件包，或是其他创建后要执行的步骤。</p>
</li>
</ul>
<p>在 3.7.2 版更改: Windows 现在为 <code>python[w].exe</code> 使用重定向脚本，而不是复制实际的二进制文件。仅在 3.7.2 中，除非运行的是源码树中的构建，否则 <code>setup_python()</code> 不会执行任何操作。</p>
<p>在 3.7.3 版更改: Windows 将重定向脚本复制为 <code>setup_python()</code> 的一部分而非 <code>setup_scripts()</code>。在 3.7.2 中不是这种情况。使用符号链接时，将链接至原始可执行文件。</p>
<p>此外，<code>EnvBuilder</code> 提供了如下实用方法，可以从子类的 <code>setup_scripts()</code> 或 <code>post_setup()</code> 调用，用来将自定义脚本安装到虚拟环境中。</p>
<ul>
<li><p><code>install_scripts</code>(<em>context</em>, <em>path</em>)</p>
<p><em>path</em> 是一个目录的路径，该目录应包含子目录 “common”, “posix”, “nt”，每个子目录存有发往对应环境中 bin 目录的脚本。在下列占位符替换完毕后，将复制 “common” 的内容和与 <code>os.name</code> 对应的子目录：</p>
<ul>
<li><code>__VENV_DIR__</code> 会被替换为环境目录的绝对路径。</li>
<li><code>__VENV_NAME__</code> 会被替换为环境名称（环境目录的最后一个字段）。</li>
<li><code>__VENV_PROMPT__</code> 会被替换为提示符（用括号括起来的环境名称紧跟着一个空格）。</li>
<li><code>__VENV_BIN_NAME__</code> 会被替换为 bin 目录的名称（ <code>bin</code> 或 <code>Scripts</code> ）。</li>
<li><code>__VENV_PYTHON__</code> 会被替换为环境可执行文件的绝对路径。</li>
</ul>
<p>允许目录已存在（用于升级现有环境时）。</p>
</li>
</ul>
<p>有一个方便实用的模块级别的函数:</p>
<p><code>venv.create</code>(<em>env_dir</em>, <em>system_site_packages=False</em>, <em>clear=False</em>, <em>symlinks=False</em>, <em>with_pip=False</em>, <em>prompt=None</em>, <em>upgrade_deps=False</em>)</p>
<p>通过关键词参数来创建一个 <code>EnvBuilder</code>，并且使用 <em>env_dir</em> 参数来调用它的 <code>create()</code> 方法。</p>
<p>3.3 新版功能.</p>
<p>在 3.4 版更改: 添加 <code>with_pip</code> 参数</p>
<p>在 3.6 版更改: 添加 <code>prompt</code> 参数</p>
<p>在 3.9 版更改: 添加 <code>upgrade_deps</code> 参数</p>
<h3 id="一个扩展-EnvBuilder-的例子"><a href="#一个扩展-EnvBuilder-的例子" class="headerlink" title="一个扩展 EnvBuilder 的例子"></a>一个扩展 <code>EnvBuilder</code> 的例子</h3><p>下面的脚本展示了如何通过实现一个子类来扩展 <code>EnvBuilder</code>。这个子类会安装 setuptotols 和 pip 的到被创建的虚拟环境中。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> os<span class="token punctuation">.</span>path
<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> urlretrieve
<span class="token keyword">import</span> venv
<span class="token keyword">class</span> <span class="token class-name">ExtendedEnvBuilder</span><span class="token punctuation">(</span>venv<span class="token punctuation">.</span>EnvBuilder<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    This builder installs setuptools and pip so that you can pip or
    easy_install other packages into the created virtual environment.
    :param nodist: If true, setuptools and pip are not installed into the
                   created virtual environment.
    :param nopip: If true, pip is not installed into the created
                  virtual environment.
    :param progress: If setuptools or pip are installed, the progress of the
                     installation can be monitored by passing a progress
                     callable. If specified, it is called with two
                     arguments: a string indicating some progress, and a
                     context indicating where the string is coming from.
                     The context argument can have one of three values:
                     'main', indicating that it is called from virtualize()
                     itself, and 'stdout' and 'stderr', which are obtained
                     by reading lines from the output streams of a subprocess
                     which is used to install the app.
                     If a callable is not specified, default progress
                     information is output to sys.stderr.
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodist <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'nodist'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>nopip <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'nopip'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>progress <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>verbose <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'verbose'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">post_setup</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Set up any packages which need to be pre-installed into the
        virtual environment being created.
        :param context: The information for the virtual environment
                        creation request being processed.
        """</span>
        os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'VIRTUAL_ENV'</span><span class="token punctuation">]</span> <span class="token operator">=</span> context<span class="token punctuation">.</span>env_dir
        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>nodist<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>install_setuptools<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Can't install pip without setuptools</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>nopip <span class="token operator">and</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>nodist<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>install_pip<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">reader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Read lines from a subprocess' output stream and either pass to a progress
        callable (if specified) or write progress information to sys.stderr.
        """</span>
        progress <span class="token operator">=</span> self<span class="token punctuation">.</span>progress
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> stream<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> s<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token keyword">if</span> progress <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
                progress<span class="token punctuation">(</span>s<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>verbose<span class="token punctuation">:</span>
                    sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stream<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">install_script</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> name<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> path<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _ <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        fn <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        binpath <span class="token operator">=</span> context<span class="token punctuation">.</span>bin_path
        distpath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>binpath<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Download script into the virtual environment's binaries folder</span>
        urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span> distpath<span class="token punctuation">)</span>
        progress <span class="token operator">=</span> self<span class="token punctuation">.</span>progress
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>verbose<span class="token punctuation">:</span>
            term <span class="token operator">=</span> <span class="token string">'\n'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            term <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">if</span> progress <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            progress<span class="token punctuation">(</span><span class="token string">'Installing %s ...%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> term<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Installing %s ...%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> term<span class="token punctuation">)</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Install in the virtual environment</span>
        args <span class="token operator">=</span> <span class="token punctuation">[</span>context<span class="token punctuation">.</span>env_exe<span class="token punctuation">,</span> fn<span class="token punctuation">]</span>
        p <span class="token operator">=</span> Popen<span class="token punctuation">(</span>args<span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> cwd<span class="token operator">=</span>binpath<span class="token punctuation">)</span>
        t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>reader<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> <span class="token string">'stdout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>reader<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span> <span class="token string">'stderr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> progress <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            progress<span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'done.\n'</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Clean up - no longer needed</span>
        os<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span>distpath<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">install_setuptools</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Install setuptools in the virtual environment.
        :param context: The information for the virtual environment
                        creation request being processed.
        """</span>
        url <span class="token operator">=</span> <span class="token string">'https://bitbucket.org/pypa/setuptools/downloads/ez_setup.py'</span>
        self<span class="token punctuation">.</span>install_script<span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">'setuptools'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># clear up the setuptools archive which gets downloaded</span>
        pred <span class="token operator">=</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'setuptools-'</span><span class="token punctuation">)</span> <span class="token operator">and</span> o<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.tar.gz'</span><span class="token punctuation">)</span>
        files <span class="token operator">=</span> filter<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>context<span class="token punctuation">.</span>bin_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            f <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>context<span class="token punctuation">.</span>bin_path<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
            os<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">install_pip</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Install pip in the virtual environment.
        :param context: The information for the virtual environment
                        creation request being processed.
        """</span>
        url <span class="token operator">=</span> <span class="token string">'https://bootstrap.pypa.io/get-pip.py'</span>
        self<span class="token punctuation">.</span>install_script<span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">'pip'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    compatible <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">if</span> sys<span class="token punctuation">.</span>version_info <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        compatible <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">elif</span> <span class="token operator">not</span> hasattr<span class="token punctuation">(</span>sys<span class="token punctuation">,</span> <span class="token string">'base_prefix'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        compatible <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> compatible<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'This script is only for use with '</span>
                         <span class="token string">'Python 3.3 or later'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">import</span> argparse
        parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>prog<span class="token operator">=</span>__name__<span class="token punctuation">,</span>
                                         description<span class="token operator">=</span><span class="token string">'Creates virtual Python '</span>
                                                     <span class="token string">'environments in one or '</span>
                                                     <span class="token string">'more target '</span>
                                                     <span class="token string">'directories.'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'dirs'</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'ENV_DIR'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span>
                            help<span class="token operator">=</span><span class="token string">'A directory in which to create the '</span>
                                 <span class="token string">'virtual environment.'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--no-setuptools'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'nodist'</span><span class="token punctuation">,</span>
                            help<span class="token operator">=</span><span class="token string">"Don't install setuptools or pip in the "</span>
                                 <span class="token string">"virtual environment."</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--no-pip'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'nopip'</span><span class="token punctuation">,</span>
                            help<span class="token operator">=</span><span class="token string">"Don't install pip in the virtual "</span>
                                 <span class="token string">"environment."</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--system-site-packages'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'system_site'</span><span class="token punctuation">,</span>
                            help<span class="token operator">=</span><span class="token string">'Give the virtual environment access to the '</span>
                                 <span class="token string">'system site-packages dir.'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'nt'</span><span class="token punctuation">:</span>
            use_symlinks <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            use_symlinks <span class="token operator">=</span> <span class="token boolean">True</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--symlinks'</span><span class="token punctuation">,</span> default<span class="token operator">=</span>use_symlinks<span class="token punctuation">,</span>
                            action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'symlinks'</span><span class="token punctuation">,</span>
                            help<span class="token operator">=</span><span class="token string">'Try to use symlinks rather than copies, '</span>
                                 <span class="token string">'when symlinks are not the default for '</span>
                                 <span class="token string">'the platform.'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--clear'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span>
                            dest<span class="token operator">=</span><span class="token string">'clear'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'Delete the contents of the '</span>
                                               <span class="token string">'virtual environment '</span>
                                               <span class="token string">'directory if it already '</span>
                                               <span class="token string">'exists, before virtual '</span>
                                               <span class="token string">'environment creation.'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--upgrade'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span>
                            dest<span class="token operator">=</span><span class="token string">'upgrade'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'Upgrade the virtual '</span>
                                                 <span class="token string">'environment directory to '</span>
                                                 <span class="token string">'use this version of '</span>
                                                 <span class="token string">'Python, assuming Python '</span>
                                                 <span class="token string">'has been upgraded '</span>
                                                 <span class="token string">'in-place.'</span><span class="token punctuation">)</span>
        parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--verbose'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span>
                            dest<span class="token operator">=</span><span class="token string">'verbose'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'Display the output '</span>
                                               <span class="token string">'from the scripts which '</span>
                                               <span class="token string">'install setuptools and pip.'</span><span class="token punctuation">)</span>
        options <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
        <span class="token keyword">if</span> options<span class="token punctuation">.</span>upgrade <span class="token operator">and</span> options<span class="token punctuation">.</span>clear<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'you cannot supply --upgrade and --clear together.'</span><span class="token punctuation">)</span>
        builder <span class="token operator">=</span> ExtendedEnvBuilder<span class="token punctuation">(</span>system_site_packages<span class="token operator">=</span>options<span class="token punctuation">.</span>system_site<span class="token punctuation">,</span>
                                       clear<span class="token operator">=</span>options<span class="token punctuation">.</span>clear<span class="token punctuation">,</span>
                                       symlinks<span class="token operator">=</span>options<span class="token punctuation">.</span>symlinks<span class="token punctuation">,</span>
                                       upgrade<span class="token operator">=</span>options<span class="token punctuation">.</span>upgrade<span class="token punctuation">,</span>
                                       nodist<span class="token operator">=</span>options<span class="token punctuation">.</span>nodist<span class="token punctuation">,</span>
                                       nopip<span class="token operator">=</span>options<span class="token punctuation">.</span>nopip<span class="token punctuation">,</span>
                                       verbose<span class="token operator">=</span>options<span class="token punctuation">.</span>verbose<span class="token punctuation">)</span>
        <span class="token keyword">for</span> d <span class="token keyword">in</span> options<span class="token punctuation">.</span>dirs<span class="token punctuation">:</span>
            builder<span class="token punctuation">.</span>create<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    rc <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span><span class="token punctuation">)</span>
        rc <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error: %s'</span> <span class="token operator">%</span> e<span class="token punctuation">,</span> file<span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="zipapp-—-Manage-executable-Python-zip-archives"><a href="#zipapp-—-Manage-executable-Python-zip-archives" class="headerlink" title="zipapp —- Manage executable Python zip archives"></a><code>zipapp</code> —- Manage executable Python zip archives</h2><p>3.5 新版功能.</p>
<p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/zipapp.py" target="_blank" rel="noopener">Lib/zipapp.py</a></p>
<hr>
<p>This module provides tools to manage the creation of zip files containing Python code, which can be executed directly by the Python interpreter. The module provides both a 命令行接口 and a Python API.</p>
<h3 id="Basic-Example"><a href="#Basic-Example" class="headerlink" title="Basic Example"></a>Basic Example</h3><p>The following example shows how the 命令行接口 can be used to create an executable archive from a directory containing Python code. When run, the archive will execute the <code>main</code> function from the module <code>myapp</code> in the archive.</p>
<pre><code>$ python -m zipapp myapp -m "myapp:main"
$ python myapp.pyz
&lt;output from myapp&gt;</code></pre><h3 id="命令行接口"><a href="#命令行接口" class="headerlink" title="命令行接口"></a>命令行接口</h3><p>When called as a program from the command line, the following form is used:</p>
<pre><code>$ python -m zipapp source [options]</code></pre><p>If <em>source</em> is a directory, this will create an archive from the contents of <em>source</em>. If <em>source</em> is a file, it should be an archive, and it will be copied to the target archive (or the contents of its shebang line will be displayed if the —info option is specified).</p>
<p>The following options are understood:</p>
<pre><code>-o` `&lt;output&gt;``,` `--output``=&lt;output&gt;</code></pre><p>Write the output to a file named <em>output</em>. If this option is not specified, the output filename will be the same as the input <em>source</em>, with the extension <code>.pyz</code> added. If an explicit filename is given, it is used as is (so a <code>.pyz</code> extension should be included if required).</p>
<p>An output filename must be specified if the <em>source</em> is an archive (and in that case, <em>output</em> must not be the same as <em>source</em>).</p>
<pre><code>-p` `&lt;interpreter&gt;``,` `--python``=&lt;interpreter&gt;</code></pre><p>Add a <code>#!</code> line to the archive specifying <em>interpreter</em> as the command to run. Also, on POSIX, make the archive executable. The default is to write no <code>#!</code> line, and not make the file executable.</p>
<pre><code>-m` `&lt;mainfn&gt;``,` `--main``=&lt;mainfn&gt;</code></pre><p>Write a <code>__main__.py</code> file to the archive that executes <em>mainfn</em>. The <em>mainfn</em> argument should have the form “pkg.mod:fn”, where “pkg.mod” is a package/module in the archive, and “fn” is a callable in the given module. The <code>__main__.py</code> file will execute that callable.</p>
<p><code>--main</code> cannot be specified when copying an archive.</p>
<pre><code>-c``,` `--compress</code></pre><p>Compress files with the deflate method, reducing the size of the output file. By default, files are stored uncompressed in the archive.</p>
<p><code>--compress</code> has no effect when copying an archive.</p>
<p>3.7 新版功能.</p>
<pre><code>--info</code></pre><p>Display the interpreter embedded in the archive, for diagnostic purposes. In this case, any other options are ignored and SOURCE must be an archive, not a directory.</p>
<pre><code>-h``,` `--help</code></pre><p>Print a short usage message and exit.</p>
<h3 id="Python-API"><a href="#Python-API" class="headerlink" title="Python API"></a>Python API</h3><p>The module defines two convenience functions:</p>
<p><code>zipapp.create_archive</code>(<em>source</em>, <em>target=None</em>, <em>interpreter=None</em>, <em>main=None</em>, <em>filter=None</em>, <em>compressed=False</em>)</p>
<p>Create an application archive from <em>source</em>. The source can be any of the following:</p>
<ul>
<li>The name of a directory, or a path-like object referring to a directory, in which case a new application archive will be created from the content of that directory.</li>
<li>The name of an existing application archive file, or a path-like object referring to such a file, in which case the file is copied to the target (modifying it to reflect the value given for the <em>interpreter</em> argument). The file name should include the <code>.pyz</code> extension, if required.</li>
<li>A file object open for reading in bytes mode. The content of the file should be an application archive, and the file object is assumed to be positioned at the start of the archive.</li>
</ul>
<p>The <em>target</em> argument determines where the resulting archive will be written:</p>
<ul>
<li>If it is the name of a file, or a path-like object, the archive will be written to that file.</li>
<li>If it is an open file object, the archive will be written to that file object, which must be open for writing in bytes mode.</li>
<li>If the target is omitted (or <code>None</code>), the source must be a directory and the target will be a file with the same name as the source, with a <code>.pyz</code> extension added.</li>
</ul>
<p>The <em>interpreter</em> argument specifies the name of the Python interpreter with which the archive will be executed. It is written as a “shebang” line at the start of the archive. On POSIX, this will be interpreted by the OS, and on Windows it will be handled by the Python launcher. Omitting the <em>interpreter</em> results in no shebang line being written. If an interpreter is specified, and the target is a filename, the executable bit of the target file will be set.</p>
<p>The <em>main</em> argument specifies the name of a callable which will be used as the main program for the archive. It can only be specified if the source is a directory, and the source does not already contain a <code>__main__.py</code> file. The <em>main</em> argument should take the form “pkg.module:callable” and the archive will be run by importing “pkg.module” and executing the given callable with no arguments. It is an error to omit <em>main</em> if the source is a directory and does not contain a <code>__main__.py</code> file, as otherwise the resulting archive would not be executable.</p>
<p>The optional <em>filter</em> argument specifies a callback function that is passed a Path object representing the path to the file being added (relative to the source directory). It should return <code>True</code> if the file is to be added.</p>
<p>The optional <em>compressed</em> argument determines whether files are compressed. If set to <code>True</code>, files in the archive are compressed with the deflate method; otherwise, files are stored uncompressed. This argument has no effect when copying an existing archive.</p>
<p>If a file object is specified for <em>source</em> or <em>target</em>, it is the caller’s responsibility to close it after calling create_archive.</p>
<p>When copying an existing archive, file objects supplied only need <code>read</code> and <code>readline</code>, or <code>write</code> methods. When creating an archive from a directory, if the target is a file object it will be passed to the <code>zipfile.ZipFile</code> class, and must supply the methods needed by that class.</p>
<p>3.7 新版功能: Added the <em>filter</em> and <em>compressed</em> arguments.</p>
<p><code>zipapp.get_interpreter</code>(<em>archive</em>)</p>
<p>Return the interpreter specified in the <code>#!</code> line at the start of the archive. If there is no <code>#!</code> line, return <code>None</code>. The <em>archive</em> argument can be a filename or a file-like object open for reading in bytes mode. It is assumed to be at the start of the archive.</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>Pack up a directory into an archive, and run it.</p>
<pre><code>$ python -m zipapp myapp
$ python myapp.pyz
&lt;output from myapp&gt;</code></pre><p>The same can be done using the <code>create_archive()</code> function:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> zipapp
<span class="token operator">>></span><span class="token operator">></span> zipapp<span class="token punctuation">.</span>create_archive<span class="token punctuation">(</span><span class="token string">'myapp'</span><span class="token punctuation">,</span> <span class="token string">'myapp.pyz'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>To make the application directly executable on POSIX, specify an interpreter to use.</p>
<pre class="line-numbers language-python"><code class="language-python">$ python <span class="token operator">-</span>m zipapp myapp <span class="token operator">-</span>p <span class="token string">"/usr/bin/env python"</span>
$ <span class="token punctuation">.</span><span class="token operator">/</span>myapp<span class="token punctuation">.</span>pyz
<span class="token operator">&lt;</span>output <span class="token keyword">from</span> myapp<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>To replace the shebang line on an existing archive, create a modified archive using the <code>create_archive()</code> function:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> zipapp
<span class="token operator">>></span><span class="token operator">></span> zipapp<span class="token punctuation">.</span>create_archive<span class="token punctuation">(</span><span class="token string">'old_archive.pyz'</span><span class="token punctuation">,</span> <span class="token string">'new_archive.pyz'</span><span class="token punctuation">,</span> <span class="token string">'/usr/bin/python3'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>To update the file in place, do the replacement in memory using a <code>BytesIO</code> object, and then overwrite the source afterwards. Note that there is a risk when overwriting a file in place that an error will result in the loss of the original file. This code does not protect against such errors, but production code should do so. Also, this method will only work if the archive fits in memory:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> zipapp
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> io
<span class="token operator">>></span><span class="token operator">></span> temp <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> zipapp<span class="token punctuation">.</span>create_archive<span class="token punctuation">(</span><span class="token string">'myapp.pyz'</span><span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token string">'/usr/bin/python2'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'myapp.pyz'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>     f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>temp<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Specifying-the-Interpreter"><a href="#Specifying-the-Interpreter" class="headerlink" title="Specifying the Interpreter"></a>Specifying the Interpreter</h3><p>Note that if you specify an interpreter and then distribute your application archive, you need to ensure that the interpreter used is portable. The Python launcher for Windows supports most common forms of POSIX <code>#!</code> line, but there are other issues to consider:</p>
<ul>
<li>If you use “/usr/bin/env python” (or other forms of the “python” command, such as “/usr/bin/python”), you need to consider that your users may have either Python 2 or Python 3 as their default, and write your code to work under both versions.</li>
<li>If you use an explicit version, for example “/usr/bin/env python3” your application will not work for users who do not have that version. (This may be what you want if you have not made your code Python 2 compatible).</li>
<li>There is no way to say “python X.Y or later”, so be careful of using an exact version like “/usr/bin/env python3.4” as you will need to change your shebang line for users of Python 3.5, for example.</li>
</ul>
<p>Typically, you should use an “/usr/bin/env python2” or “/usr/bin/env python3”, depending on whether your code is written for Python 2 or 3.</p>
<h3 id="Creating-Standalone-Applications-with-zipapp"><a href="#Creating-Standalone-Applications-with-zipapp" class="headerlink" title="Creating Standalone Applications with zipapp"></a>Creating Standalone Applications with zipapp</h3><p>Using the <code>zipapp</code> module, it is possible to create self-contained Python programs, which can be distributed to end users who only need to have a suitable version of Python installed on their system. The key to doing this is to bundle all of the application’s dependencies into the archive, along with the application code.</p>
<p>The steps to create a standalone archive are as follows:</p>
<ol>
<li><p>Create your application in a directory as normal, so you have a <code>myapp</code> directory containing a <code>__main__.py</code> file, and any supporting application code.</p>
</li>
<li><p>Install all of your application’s dependencies into the <code>myapp</code> directory, using pip:</p>
<pre><code>$ python -m pip install -r requirements.txt --target myapp</code></pre><p>(this assumes you have your project requirements in a <code>requirements.txt</code> file - if not, you can just list the dependencies manually on the pip command line).</p>
</li>
<li><p>Optionally, delete the <code>.dist-info</code> directories created by pip in the <code>myapp</code> directory. These hold metadata for pip to manage the packages, and as you won’t be making any further use of pip they aren’t required - although it won’t do any harm if you leave them.</p>
</li>
<li><p>Package the application using:</p>
<pre><code>$ python -m zipapp -p "interpreter" myapp</code></pre></li>
</ol>
<p>This will produce a standalone executable, which can be run on any machine with the appropriate interpreter available. See Specifying the Interpreter for details. It can be shipped to users as a single file.</p>
<p>On Unix, the <code>myapp.pyz</code> file is executable as it stands. You can rename the file to remove the <code>.pyz</code> extension if you prefer a “plain” command name. On Windows, the <code>myapp.pyz[w]</code> file is executable by virtue of the fact that the Python interpreter registers the <code>.pyz</code> and <code>.pyzw</code> file extensions when installed.</p>
<h4 id="Making-a-Windows-executable"><a href="#Making-a-Windows-executable" class="headerlink" title="Making a Windows executable"></a>Making a Windows executable</h4><p>On Windows, registration of the <code>.pyz</code> extension is optional, and furthermore, there are certain places that don’t recognise registered extensions “transparently” (the simplest example is that <code>subprocess.run(['myapp'])</code> won’t find your application - you need to explicitly specify the extension).</p>
<p>On Windows, therefore, it is often preferable to create an executable from the zipapp. This is relatively easy, although it does require a C compiler. The basic approach relies on the fact that zipfiles can have arbitrary data prepended, and Windows exe files can have arbitrary data appended. So by creating a suitable launcher and tacking the <code>.pyz</code> file onto the end of it, you end up with a single-file executable that runs your application.</p>
<p>A suitable launcher can be as simple as the following:</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> Py_LIMITED_API 1</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Python.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> WIN32_LEAN_AND_MEAN</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WINDOWS</span>
<span class="token keyword">int</span> WINAPI <span class="token function">wWinMain</span><span class="token punctuation">(</span>
    HINSTANCE hInstance<span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">/* handle to current instance */</span>
    HINSTANCE hPrevInstance<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/* handle to previous instance */</span>
    LPWSTR lpCmdLine<span class="token punctuation">,</span>         <span class="token comment" spellcheck="true">/* pointer to command line */</span>
    <span class="token keyword">int</span> nCmdShow              <span class="token comment" spellcheck="true">/* show state of window */</span>
<span class="token punctuation">)</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token keyword">int</span> <span class="token function">wmain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">{</span>
    wchar_t <span class="token operator">*</span><span class="token operator">*</span>myargv <span class="token operator">=</span> <span class="token function">_alloca</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__argc <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>wchar_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myargv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> __wargv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>myargv <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> __wargv<span class="token punctuation">,</span> __argc <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>wchar_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Py_Main</span><span class="token punctuation">(</span>__argc<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> myargv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If you define the <code>WINDOWS</code> preprocessor symbol, this will generate a GUI executable, and without it, a console executable.</p>
<p>To compile the executable, you can either just use the standard MSVC command line tools, or you can take advantage of the fact that distutils knows how to compile Python source:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> distutils<span class="token punctuation">.</span>ccompiler <span class="token keyword">import</span> new_compiler
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> distutils<span class="token punctuation">.</span>sysconfig
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">compile</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>     src <span class="token operator">=</span> Path<span class="token punctuation">(</span>src<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     cc <span class="token operator">=</span> new_compiler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     exe <span class="token operator">=</span> src<span class="token punctuation">.</span>stem
<span class="token operator">>></span><span class="token operator">></span>     cc<span class="token punctuation">.</span>add_include_dir<span class="token punctuation">(</span>distutils<span class="token punctuation">.</span>sysconfig<span class="token punctuation">.</span>get_python_inc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     cc<span class="token punctuation">.</span>add_library_dir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>base_exec_prefix<span class="token punctuation">,</span> <span class="token string">'libs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     <span class="token comment" spellcheck="true"># First the CLI executable</span>
<span class="token operator">>></span><span class="token operator">></span>     objs <span class="token operator">=</span> cc<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token punctuation">[</span>str<span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     cc<span class="token punctuation">.</span>link_executable<span class="token punctuation">(</span>objs<span class="token punctuation">,</span> exe<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     <span class="token comment" spellcheck="true"># Now the GUI executable</span>
<span class="token operator">>></span><span class="token operator">></span>     cc<span class="token punctuation">.</span>define_macro<span class="token punctuation">(</span><span class="token string">'WINDOWS'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     objs <span class="token operator">=</span> cc<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token punctuation">[</span>str<span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>     cc<span class="token punctuation">.</span>link_executable<span class="token punctuation">(</span>objs<span class="token punctuation">,</span> exe <span class="token operator">+</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
<span class="token operator">>></span><span class="token operator">></span>     compile<span class="token punctuation">(</span><span class="token string">"zastub.c"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The resulting launcher uses the “Limited ABI”, so it will run unchanged with any version of Python 3.x. All it needs is for Python (<code>python3.dll</code>) to be on the user’s <code>PATH</code>.</p>
<p>For a fully standalone distribution, you can distribute the launcher with your application appended, bundled with the Python “embedded” distribution. This will run on any PC with the appropriate architecture (32 bit or 64 bit).</p>
<h4 id="Caveats"><a href="#Caveats" class="headerlink" title="Caveats"></a>Caveats</h4><p>There are some limitations to the process of bundling your application into a single file. In most, if not all, cases they can be addressed without needing major changes to your application.</p>
<ol>
<li>If your application depends on a package that includes a C extension, that package cannot be run from a zip file (this is an OS limitation, as executable code must be present in the filesystem for the OS loader to load it). In this case, you can exclude that dependency from the zipfile, and either require your users to have it installed, or ship it alongside your zipfile and add code to your <code>__main__.py</code> to include the directory containing the unzipped module in <code>sys.path</code>. In this case, you will need to make sure to ship appropriate binaries for your target architecture(s) (and potentially pick the correct version to add to <code>sys.path</code> at runtime, based on the user’s machine).</li>
<li>If you are shipping a Windows executable as described above, you either need to ensure that your users have <code>python3.dll</code> on their PATH (which is not the default behaviour of the installer) or you should bundle your application with the embedded distribution.</li>
<li>The suggested launcher above uses the Python embedding API. This means that in your application, <code>sys.executable</code> will be your application, and <em>not</em> a conventional Python interpreter. Your code and its dependencies need to be prepared for this possibility. For example, if your application uses the <code>multiprocessing</code> module, it will need to call <code>multiprocessing.set_executable()</code> to let the module know where to find the standard Python interpreter.</li>
</ol>
<h3 id="The-Python-Zip-Application-Archive-Format"><a href="#The-Python-Zip-Application-Archive-Format" class="headerlink" title="The Python Zip Application Archive Format"></a>The Python Zip Application Archive Format</h3><p>Python has been able to execute zip files which contain a <code>__main__.py</code> file since version 2.6. In order to be executed by Python, an application archive simply has to be a standard zip file containing a <code>__main__.py</code> file which will be run as the entry point for the application. As usual for any Python script, the parent of the script (in this case the zip file) will be placed on <code>sys.path</code> and thus further modules can be imported from the zip file.</p>
<p>The zip file format allows arbitrary data to be prepended to a zip file. The zip application format uses this ability to prepend a standard POSIX “shebang” line to the file (<code>#!/path/to/interpreter</code>).</p>
<p>Formally, the Python zip application format is therefore:</p>
<ol>
<li>An optional shebang line, containing the characters <code>b'#!'</code> followed by an interpreter name, and then a newline (<code>b'\n'</code>) character. The interpreter name can be anything acceptable to the OS “shebang” processing, or the Python launcher on Windows. The interpreter should be encoded in UTF-8 on Windows, and in <code>sys.getfilesystemencoding()</code> on POSIX.</li>
<li>Standard zipfile data, as generated by the <code>zipfile</code> module. The zipfile content <em>must</em> include a file called <code>__main__.py</code> (which must be in the “root” of the zipfile - i.e., it cannot be in a subdirectory). The zipfile data can be compressed or uncompressed.</li>
</ol>
<p>If an application archive has a shebang line, it may have the executable bit set on POSIX systems, to allow it to be executed directly.</p>
<p>There is no requirement that the tools in this module are used to create application archives - the module is a convenience, but archives in the above format created by any means are acceptable to Python.</p>
<h1 id="Python运行时服务"><a href="#Python运行时服务" class="headerlink" title="Python运行时服务"></a>Python运行时服务</h1><p>本章里描述的模块提供了和Python解释器及其环境交互相关的广泛服务。以下是综述：</p>
<ul>
<li><code>sys</code> —- 系统相关的参数和函数</li>
<li><code>sysconfig</code> —- Provide access to Python’s configuration information<ul>
<li>配置变量</li>
<li>安装路径</li>
<li>其他功能</li>
<li>Using <code>sysconfig</code> as a script</li>
</ul>
</li>
<li><code>builtins</code> —- 内建对象</li>
<li><code>__main__</code> —- Top-level code environment<ul>
<li><code>__name__ == '__main__'</code><ul>
<li>What is the “top-level code environment”?</li>
<li>Idiomatic Usage</li>
<li>Packaging Considerations</li>
</ul>
</li>
<li><code>__main__.py</code> in Python Packages<ul>
<li>Idiomatic Usage</li>
</ul>
</li>
<li><code>import __main__</code></li>
</ul>
</li>
<li><code>warnings</code> —— 警告信息的控制<ul>
<li>警告类别</li>
<li>警告过滤器<ul>
<li>警告过滤器的介绍</li>
<li>默认警告过滤器</li>
<li>重写默认的过滤器</li>
</ul>
</li>
<li>暂时禁止警告</li>
<li>测试警告</li>
<li>为新版本的依赖关系更新代码</li>
<li>可用的函数</li>
<li>可用的上下文管理器</li>
</ul>
</li>
<li><code>dataclasses</code> —- 数据类<ul>
<li>模块内容</li>
<li>初始化后处理</li>
<li>类变量</li>
<li>仅初始化变量</li>
<li>冻结的实例</li>
<li>继承</li>
<li><code>__init__()</code> 中仅限关键字字段的重新排序</li>
<li>默认工厂函数</li>
<li>可变的默认值</li>
</ul>
</li>
<li><code>contextlib</code> —- 为 <code>with</code>语句上下文提供的工具<ul>
<li>工具</li>
<li>例子和配方<ul>
<li>Supporting a variable number of context managers</li>
<li>Catching exceptions from <code>__enter__</code> methods</li>
<li>Cleaning up in an <code>__enter__</code> implementation</li>
<li>Replacing any use of <code>try-finally</code> and flag variables</li>
<li>Using a context manager as a function decorator</li>
</ul>
</li>
<li>Single use, reusable and reentrant context managers<ul>
<li>Reentrant context managers</li>
<li>Reusable context managers</li>
</ul>
</li>
</ul>
</li>
<li><code>abc</code> —- 抽象基类</li>
<li><code>atexit</code> —- 退出处理器<ul>
<li><code>atexit</code> 示例</li>
</ul>
</li>
<li><code>traceback</code> —- 打印或检索堆栈回溯<ul>
<li><code>TracebackException</code> Objects</li>
<li><code>StackSummary</code> Objects</li>
<li><code>FrameSummary</code> Objects</li>
<li>Traceback Examples</li>
</ul>
</li>
<li><code>__future__</code> —- Future 语句定义</li>
<li><code>gc</code> —- 垃圾回收器接口</li>
<li><code>inspect</code> —- 检查对象<ul>
<li>类型和成员</li>
<li>Retrieving source code</li>
<li>Introspecting callables with the Signature object</li>
<li>类与函数</li>
<li>The interpreter stack</li>
<li>Fetching attributes statically</li>
<li>Current State of Generators and Coroutines</li>
<li>Code Objects Bit Flags</li>
<li>命令行界面</li>
</ul>
</li>
<li><code>site</code> —— 指定域的配置钩子<ul>
<li>Readline 配置</li>
<li>模块内容</li>
<li>命令行界面</li>
</ul>
</li>
</ul>
<h2 id="sys-—-系统相关的参数和函数"><a href="#sys-—-系统相关的参数和函数" class="headerlink" title="sys —- 系统相关的参数和函数"></a><code>sys</code> —- 系统相关的参数和函数</h2><p>该模块提供了一些变量和函数。这些变量可能被解释器使用，也可能由解释器提供。这些函数会影响解释器。本模块总是可用的。</p>
<pre><code>sys.abiflags</code></pre><p>在POSIX系统上，以标准的 <code>configure</code> 脚本构建的 Python 中，这个变量会包含 <a href="https://www.python.org/dev/peps/pep-3149" target="_blank" rel="noopener"><strong>PEP 3149</strong></a> 中定义的ABI标签。</p>
<p>在 3.8 版更改: 默认的 flags 变为了空字符串（用于 pymalloc 的 <code>m</code> 旗标已经移除）</p>
<p>3.2 新版功能.</p>
<p><code>sys.addaudithook</code>(<em>hook</em>)</p>
<p>将可调用对象 <em>hook</em> 附加到当前（子）解释器的活动的审计钩子列表中。</p>
<p>当通过 <code>sys.audit()</code> 函数引发审计事件时，每个钩子将按照其被加入的先后顺序被调用，调用时会传入事件名称和参数元组。 由 <code>PySys_AddAuditHook()</code> 添加的原生钩子会先被调用，然后是当前（子）解释器中添加的钩子。 接下来这些钩子会记录事件，引发异常来中止操作，或是完全终止进程。</p>
<p>调用 <code>sys.addaudithook()</code> 时它自身将引发一个名为 <code>sys.addaudithook</code> 的审计事件且不附带参数。 如果任何现有的钩子引发了派生自 <code>RuntimeError</code> 的异常，则新的钩子不会被添加并且该异常会被抑制。 其结果就是，调用者无法确保他们的钩子已经被添加，除非他们控制了全部现有的钩子。</p>
<p>3.8 新版功能.</p>
<p>在 3.8.1 版更改: 派生自 <code>Exception</code> （而非 <code>RuntimeError</code> ）的异常不会被抑制。</p>
<p><strong>CPython implementation detail:</strong> 启用跟踪时，仅当可调用对象（钩子）的 <code>__cantrace__</code> 成员设置为 true 时，才会跟踪该钩子。否则，跟踪功能将跳过该钩子。</p>
<pre><code>sys.argv</code></pre><p>一个列表，其中包含了被传递给 Python 脚本的命令行参数。 <code>argv[0]</code> 为脚本的名称（是否是完整的路径名取决于操作系统）。如果是通过 Python 解释器的命令行参数 <code>-c</code> 来执行的， <code>argv[0]</code> 会被设置成字符串 <code>'-c'</code> 。如果没有脚本名被传递给 Python 解释器， <code>argv[0]</code> 为空字符串。</p>
<p>注解</p>
<p>在 Unix 上，系统传递的命令行参数是字节类型的。Python 使用文件系统编码和 “surrogateescape” 错误处理方案对它们进行解码。当需要原始字节时，可以通过 <code>[os.fsencode(arg) for arg in sys.argv]</code> 来获取。</p>
<p><code>sys.audit</code>(<em>event</em>, <em>\</em>args*)</p>
<p>引发一个审计事件并触发任何激活的审计钩子。 <em>event</em> 是一个用于标识事件的字符串，<em>args</em> 会包含有关事件的更多信息的可选参数。 特定事件的参数的数量和类型会被视为是公有的稳定 API 且不应当在版本之间进行修改。</p>
<p>例如，有一个审计事件的名称为 <code>os.chdir</code>。 此事件具有一个名为 <em>path</em> 的参数，该参数将包含所请求的新工作目录。</p>
<p><code>sys.audit()</code> 将调用现有的审计钩子，传入事件名称和参数，并将重新引发来自任何钩子的第一个异常。 通常来说，如果有一个异常被引发，则它不应当被处理且其进程应当被尽可能快地终止。 这将允许钩子实现来决定对特定事件要如何反应：它们可以只是将事件写入日志或是通过引发异常来中止操作。</p>
<p>钩子程序由 <code>sys.addaudithook()</code> 或 <code>PySys_AddAuditHook()</code> 函数添加。</p>
<p>与本函数相等效的原生函数是 <code>PySys_Audit()</code>，应尽量使用原生函数。</p>
<p>3.8 新版功能.</p>
<pre><code>sys.base_exec_prefix</code></pre><p>在 <code>site.py</code> 运行之前， Python 启动的时候被设置为跟 <code>exec_prefix</code> 同样的值。如果不是运行在 虚拟环境 中，两个值会保持相同；如果 <code>site.py</code> 发现处于一个虚拟环境中， <code>prefix</code> 和 <code>exec_prefix</code> 将会指向虚拟环境。然而 <code>base_prefix</code> 和 <code>base_exec_prefix</code> 将仍然会指向基础的 Python 环境（用来创建虚拟环境的 Python 环境）</p>
<p>3.3 新版功能.</p>
<pre><code>sys.base_prefix</code></pre><p>在 <code>site.py</code> 运行之前， Python 启动的时候被设置为跟 <code>prefix</code> 同样的值。如果不是运行在 虚拟环境 中, 两个值会保持相同；如果 <code>site.py</code> 发现处于一个虚拟环境中， <code>prefix</code> 和 <code>exec_prefix</code> 将会指向虚拟环境。然而 <code>base_prefix</code> 和 <code>base_exec_prefix</code> 将仍然会指向基础的 Python 环境（用来创建虚拟环境的 Python 环境）</p>
<p>3.3 新版功能.</p>
<pre><code>sys.byteorder</code></pre><p>本地字节顺序的指示符。在大端序（最高有效位优先）操作系统上值为 <code>'big'</code> ，在小端序（最低有效位优先）操作系统上为 <code>'little'</code> 。</p>
<pre><code>sys.builtin_module_names</code></pre><p>一个包含所有被编译进 Python 解释器的模块的名称的字符串元组。 （此信息无法通过任何其他办法获取 —- <code>modules.keys()</code> 仅会列出导入的模块。）</p>
<p>另请参阅 <code>sys.stdlib_module_names</code> 列表。</p>
<p><code>sys.call_tracing</code>(<em>func</em>, <em>args</em>)</p>
<p>在启用跟踪时调用 <code>func(*args)</code> 来保存跟踪状态，然后恢复跟踪状态。这将从检查点的调试器调用，以便递归地调试其他的一些代码。</p>
<pre><code>sys.copyright</code></pre><p>一个字符串，包含了 Python 解释器有关的版权信息</p>
<p><code>sys._clear_type_cache</code>()</p>
<p>清除内部的类型缓存。类型缓存是为了加速查找方法和属性的。在调试引用泄漏的时候调用这个函数 <em>只会</em> 清除不必要的引用。</p>
<p>这个函数应该只在内部为了一些特定的目的使用。</p>
<p><code>sys._current_frames</code>()</p>
<p>返回一个字典，存放着每个线程的标识符与（调用本函数时）该线程栈顶的帧（当前活动的帧）之间的映射。注意 <code>traceback</code> 模块中的函数可以在给定某一帧的情况下构建调用堆栈。</p>
<p>这对于调试死锁最有用：本函数不需要死锁线程的配合，并且只要这些线程的调用栈保持死锁，它们就是冻结的。在调用本代码来检查栈顶的帧的那一刻，非死锁线程返回的帧可能与该线程当前活动的帧没有任何关系。</p>
<p>这个函数应该只在内部为了一些特定的目的使用。</p>
<p>引发一个 审计事件 <code>sys._current_frames</code>，没有附带参数。</p>
<p><code>sys._current_exceptions</code>()</p>
<p>返回一个字典，存放着每个线程的标识与调用此函数时该线程当前活动帧的栈顶异常之间的映射。 如果某个线程当前未在处理异常，它将不被包括在结果字典中。</p>
<p>这对于静态性能分析来说最为有用。</p>
<p>这个函数应该只在内部为了一些特定的目的使用。</p>
<p>引发一个 审计事件 <code>sys._current_exceptions</code>，不附带任何参数。</p>
<p><code>sys.breakpointhook</code>()</p>
<p>本钩子函数由内建函数 <code>breakpoint()</code> 调用。默认情况下，它将进入 <code>pdb</code> 调试器，但可以将其改为任何其他函数，以选择使用哪个调试器。</p>
<p>该函数的特征取决于其调用的函数。例如，默认绑定（即 <code>pdb.set_trace()</code> ）不要求提供参数，但可以将绑定换成要求提供附加参数（位置参数/关键字参数）的函数。内建函数 <code>breakpoint()</code> 直接将其 <code>*args</code> 和 <code>**kws</code> 传入。<code>breakpointhooks()</code> 返回的所有内容都会从 <code>breakpoint()</code> 返回。</p>
<p>默认的实现首先会查询环境变量 <code>PYTHONBREAKPOINT</code>。如果将该变量设置为 <code>"0"</code>，则本函数立即返回，表示在断点处无操作。如果未设置该环境变量或将其设置为空字符串，则调用 <code>pdb.set_trace()</code>。否则，此变量应指定要运行的函数，指定函数时应使用 Python 的点导入命名法，如 <code>package.subpackage.module.function</code>。这种情况下将导入 <code>package.subpackage.module</code>，且导入的模块必须有一个名为 <code>function()</code> 的可调用对象。该可调用对象会运行，<code>*args</code> 和 <code>**kws</code> 会传入，且无论 <code>function()</code> 返回什么，<code>sys.breakpointhook()</code> 都将返回到內建函数 <code>breakpoint()</code>。</p>
<p>请注意，如果在导入 <code>PYTHONBREAKPOINT</code> 指定的可调用对象时出错，则将报告一个 <code>RuntimeWarning</code> 并忽略断点。</p>
<p>另请注意，如果以编程方式覆盖 <code>sys.breakpointhook()</code>，则 <em>不会</em> 查询 <code>PYTHONBREAKPOINT</code>。</p>
<p>3.7 新版功能.</p>
<p><code>sys._debugmallocstats</code>()</p>
<p>将有关 CPython 内存分配器状态的底层的信息打印至 stderr。</p>
<p>如果 Python 是 以调试模式编译的 &lt;debug-build&gt; (<code>configure --with-pydebug option</code>)，它还会执行一些消耗性能的内部一致性检查。</p>
<p>3.3 新版功能.</p>
<p><strong>CPython implementation detail:</strong> 本函数仅限 CPython。此处没有定义确切的输出格式，且可能会更改。</p>
<pre><code>sys.dllhandle</code></pre><p>指向 Python DLL 句柄的整数。</p>
<p>可用性: Windows。</p>
<p><code>sys.displayhook</code>(<em>value</em>)</p>
<p>如果 <em>value</em> 不是 <code>None</code>，则本函数会将 <code>repr(value)</code> 打印至 <code>sys.stdout</code>，并将 <em>value</em> 保存在 <code>builtins._</code> 中。如果 <code>repr(value)</code> 无法用 <code>sys.stdout.errors</code> 错误处理方案（可能为 <code>'strict'</code> ）编码为 <code>sys.stdout.encoding</code>，则用 <code>'backslashreplace'</code> 错误处理方案将其编码为 <code>sys.stdout.encoding</code>。</p>
<p>在交互式 Python 会话中运行 expression 产生结果后，将在结果上调用 <code>sys.displayhook</code>。若要自定义这些 value 的显示，可以将 <code>sys.displayhook</code> 指定为另一个单参数函数。</p>
<p>伪代码:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">displayhook</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> value <span class="token keyword">is</span> None<span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token comment" spellcheck="true"># Set '_' to None to avoid recursion</span>
    builtins<span class="token punctuation">.</span>_ <span class="token operator">=</span> None
    text <span class="token operator">=</span> repr<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">except</span> UnicodeEncodeError<span class="token punctuation">:</span>
        bytes <span class="token operator">=</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>encoding<span class="token punctuation">,</span> <span class="token string">'backslashreplace'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> hasattr<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> <span class="token string">'buffer'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            text <span class="token operator">=</span> bytes<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>encoding<span class="token punctuation">,</span> <span class="token string">'strict'</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
    builtins<span class="token punctuation">.</span>_ <span class="token operator">=</span> value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 3.2 版更改: 在发生 <code>UnicodeEncodeError</code> 时使用 <code>'backslashreplace'</code> 错误处理方案。</p>
<pre><code>sys.dont_write_bytecode</code></pre><p>如果该值为 true，则 Python 在导入源码模块时将不会尝试写入 <code>.pyc</code> 文件。该值会被初始化为 <code>True</code> 或 <code>False</code>，依据是 <a href="https://www.bookstack.cn/read/python-3.10.0-zh/ec5d5b3d3a9e7fcc.md#cmdoption-B" target="_blank" rel="noopener"><code>-B</code></a> 命令行选项和 <code>PYTHONDONTWRITEBYTECODE</code> 环境变量，可以自行设置该值，来控制是否生成字节码文件。</p>
<pre><code>sys.pycache_prefix</code></pre><p>如果将该值设为某个目录（不是 <code>None</code> ），Python 会将字节码缓存文件 <code>.pyc</code> 写入到以该目录为根的并行目录树中（并从中读取），而不是在源码树中的 <code>__pycache__</code> 目录下读写。源码树中所有的 <code>__pycache__</code> 目录都将被忽略，并将在 pycache prefix 内写入新的 .pyc 文件。因此，如果使用 <code>compileall</code> 作为预构建步骤，则必须确保预构建时使用的 pycache prefix （如果有）与将来运行的时候相同。</p>
<p>相对路径将解释为相对于当前工作目录。</p>
<p>该值的初值设置，依据 <code>-X</code> <code>pycache_prefix=PATH</code> 命令行选项或 <code>PYTHONPYCACHEPREFIX</code> 环境变量的值（命令行优先）。如果两者均未设置，则为 <code>None</code>。</p>
<p>3.8 新版功能.</p>
<p><code>sys.excepthook</code>(<em>type</em>, <em>value</em>, <em>traceback</em>)</p>
<p>本函数会将所给的回溯和异常输出到 <code>sys.stderr</code> 中。</p>
<p>当抛出一个异常，且未被捕获时，解释器将调用 <code>sys.excepthook</code> 并带有三个参数：异常类、异常实例和一个回溯对象。在交互式会话中，这会在控制权返回到提示符之前发生。在 Python 程序中，这会在程序退出之前发生。如果要自定义此类顶级异常的处理过程，可以将另一个 3 个参数的函数赋给 <code>sys.excepthook</code>。</p>
<p>引发一个 审计事件 <code>sys.excepthook</code>，附带参数 <code>hook</code>, <code>type</code>, <code>value</code>, <code>traceback</code>。</p>
<p>参见</p>
<p><code>sys.unraisablehook()</code> 函数处理无法抛出的异常，<code>threading.excepthook()</code> 函数处理 <code>threading.Thread.run()</code> 抛出的异常。</p>
<pre><code>sys.__breakpointhook__
sys.__displayhook__
sys.__excepthook__
sys.__unraisablehook__</code></pre><p>程序开始时，这些对象存有 <code>breakpointhook</code>、<code>displayhook</code>、<code>excepthook</code> 和 <code>unraisablehook</code> 的初始值。保存它们是为了可以在 <code>breakpointhook</code>、<code>displayhook</code> 和 <code>excepthook</code>、<code>unraisablehook</code> 被破坏或被替换时恢复它们。</p>
<p>3.7 新版功能: <strong>breakpointhook</strong></p>
<p>3.8 新版功能: <strong>unraisablehook</strong></p>
<p><code>sys.exc_info</code>()</p>
<p>本函数返回的元组包含三个值，它们给出当前正在处理的异常的信息。返回的信息仅限于当前线程和当前堆栈帧。如果当前堆栈帧没有正在处理的异常，则信息将从下级被调用的堆栈帧或上级调用者等位置获取，依此类推，直到找到正在处理异常的堆栈帧为止。此处的“处理异常”指的是“执行 except 子句”。任何堆栈帧都只能访问当前正在处理的异常的信息。</p>
<p>如果整个堆栈都没有正在处理的异常，则返回包含三个 <code>None</code> 值的元组。否则返回值为 <code>(type, value, traceback)</code>。它们的含义是：<em>type</em> 是正在处理的异常类型（它是 <code>BaseException</code> 的子类）；<em>value</em> 是异常实例（异常类型的实例）；<em>traceback</em> 是一个 回溯对象，该对象封装了最初发生异常时的调用堆栈。</p>
<pre><code>sys.exec_prefix</code></pre><p>一个字符串，提供特定域的目录前缀，该目录中安装了与平台相关的 Python 文件，默认也是 <code>'/usr/local'</code>。该目录前缀可以在构建时使用 <strong>configure</strong> 脚本的 <code>--exec-prefix</code> 参数进行设置。具体而言，所有配置文件（如 <code>pyconfig.h</code> 头文件）都安装在目录 <code>*exec_prefix*/lib/python*X.Y*/config</code> 中，共享库模块安装在 <code>*exec_prefix*/lib/python*X.Y*/lib-dynload</code> 中，其中 <em>X.Y</em> 是 Python 的版本号，如 <code>3.2</code>。</p>
<p>注解</p>
<p>如果在一个 虚拟环境 中，那么该值将在 <code>site.py</code> 中被修改，指向虚拟环境。Python 安装位置仍然可以用 <code>base_exec_prefix</code> 来获取。</p>
<pre><code>sys.executable</code></pre><p>一个字符串，提供 Python 解释器的可执行二进制文件的绝对路径，仅在部分系统中此值有意义。如果 Python 无法获取其可执行文件的真实路径，则 <code>sys.executable</code> 将为空字符串或 <code>None</code>。</p>
<p><code>sys.exit</code>([<em>arg</em>])</p>
<p>从 Python 中退出。实现方式是抛出一个 <code>SystemExit</code> 异常，因此异常抛出后 <code>try</code> 语句的 finally 分支的清除动作将被触发，这样可能会打断外层的退出尝试。</p>
<p>可选参数 <em>arg</em> 可以是表示退出状态的整数（默认为 0），也可以是其他类型的对象。如果它是整数，则 shell 等将 0 视为“成功终止”，非零值视为“异常终止”。大多数系统要求该值的范围是 0—127，否则会产生不确定的结果。某些系统为退出代码约定了特定的含义，但通常尚不完善；Unix 程序通常用 2 表示命令行语法错误，用 1 表示所有其他类型的错误。传入其他类型的对象，如果传入 <code>None</code> 等同于传入 0，如果传入其他对象则将其打印至 <code>stderr</code>，且退出代码为 1。特别地，<code>sys.exit("some error message")</code> 可以在发生错误时快速退出程序。</p>
<p>由于 <code>exit()</code> 最终“只是”抛出一个异常，因此当从主线程调用时，只会从进程退出；而异常不会因此被打断。</p>
<p>在 3.6 版更改: 在 Python 解释器捕获 <code>SystemExit</code> 后，如果在清理中发生错误（如清除标准流中的缓冲数据时出错），则退出状态码将变为 120。</p>
<pre><code>sys.flags</code></pre><p>具名元组 <em>flags</em> 含有命令行标志的状态。这些属性是只读的。</p>
<table>
<thead>
<tr>
<th align="left">attribute — 属性</th>
<th align="left">标志</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>debug</code></td>
<td align="left"><code>-d</code></td>
</tr>
<tr>
<td align="left"><code>inspect</code></td>
<td align="left"><code>-i</code></td>
</tr>
<tr>
<td align="left"><code>interactive</code></td>
<td align="left"><code>-i</code></td>
</tr>
<tr>
<td align="left"><code>isolated</code></td>
<td align="left"><code>-I</code></td>
</tr>
<tr>
<td align="left"><code>optimize</code></td>
<td align="left"><code>-O</code> 或 <code>-OO</code></td>
</tr>
<tr>
<td align="left"><code>dont_write_bytecode</code></td>
<td align="left"><code>-B</code></td>
</tr>
<tr>
<td align="left"><code>no_user_site</code></td>
<td align="left"><code>-s</code></td>
</tr>
<tr>
<td align="left"><code>no_site</code></td>
<td align="left"><code>-S</code></td>
</tr>
<tr>
<td align="left"><code>ignore_environment</code></td>
<td align="left"><code>-E</code></td>
</tr>
<tr>
<td align="left"><code>verbose</code></td>
<td align="left"><code>-v</code></td>
</tr>
<tr>
<td align="left"><code>bytes_warning</code></td>
<td align="left"><code>-b</code></td>
</tr>
<tr>
<td align="left"><code>quiet</code></td>
<td align="left"><code>-q</code></td>
</tr>
<tr>
<td align="left"><code>hash_randomization</code></td>
<td align="left"><code>-R</code></td>
</tr>
<tr>
<td align="left"><code>dev_mode</code></td>
<td align="left"><code>-X dev</code> (Python 开发模式)</td>
</tr>
<tr>
<td align="left"><code>utf8_mode</code></td>
<td align="left"><code>-X utf8</code></td>
</tr>
</tbody></table>
<p>在 3.2 版更改: 为新的 <code>-q</code> 标志添加了 <code>quiet</code> 属性</p>
<p>3.2.3 新版功能: <code>hash_randomization</code> 属性</p>
<p>在 3.3 版更改: 删除了过时的 <code>division_warning</code> 属性</p>
<p>在 3.4 版更改: 为 <code>-I</code> <code>isolated</code> 标志添加了 <code>isolated</code> 属性。</p>
<p>在 3.7 版更改: 为新的 Python 开发模式 添加了 <code>dev_mode</code> 属性，为新的 <code>-X</code> <code>utf8</code> 标志添加了 <code>utf8_mode</code> 属性。</p>
<pre><code>sys.float_info</code></pre><p>一个 具名元组，存有浮点型的相关信息。它包含的是关于精度和内部表示的底层信息。这些值与标准头文件 <code>float.h</code> 中为 C 语言定义的各种浮点常量对应，详情请参阅 1999 ISO/IEC C 标准 [C99] 的 5.2.4.2.2 节，’Characteristics of floating types（浮点型的特性）’。</p>
<table>
<thead>
<tr>
<th align="left">attribute — 属性</th>
<th align="left">float.h 宏</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>epsilon</code></td>
<td align="left">DBL_EPSILON</td>
<td align="left">大于 1.0 的最小值和 1.0 之间的差，表示为浮点数另请参阅 <code>math.ulp()</code>。</td>
</tr>
<tr>
<td align="left"><code>dig</code></td>
<td align="left">DBL_DIG</td>
<td align="left">浮点数可以真实表示的最大十进制数字；见下文</td>
</tr>
<tr>
<td align="left"><code>mant_dig</code></td>
<td align="left">DBL_MANT_DIG</td>
<td align="left">浮点数精度：<code>radix</code> 基数下的浮点数有效位数</td>
</tr>
<tr>
<td align="left"><code>max</code></td>
<td align="left">DBL_MAX</td>
<td align="left">可表示的最大正浮点数（非无穷）</td>
</tr>
<tr>
<td align="left"><code>max_exp</code></td>
<td align="left">DBL_MAX_EXP</td>
<td align="left">使得 <code>radix**(e-1)**</code> <strong>是可表示的浮点数（非无穷）的最大整数 *e*</strong></td>
</tr>
<tr>
<td align="left"><code>max_10_exp</code></td>
<td align="left">DBL_MAX_10_EXP</td>
<td align="left">使得 <code>10e</code> 在可表示的浮点数（非无穷）范围内的最大整数 <em>e</em></td>
</tr>
<tr>
<td align="left"><code>min</code></td>
<td align="left">DBL_MIN</td>
<td align="left">可表示的最小正 <em>规格化</em> 浮点数使用 <code>math.ulp(0.0)</code> 获取可表示的最小正 <em>非规格化</em> 浮点数</td>
</tr>
<tr>
<td align="left"><code>min_exp</code></td>
<td align="left">DBL_MIN_EXP</td>
<td align="left">使得 <code>radix**(e-1)**</code> <strong>是规格化浮点数的最小整数 *e*</strong></td>
</tr>
<tr>
<td align="left"><code>min_10_exp</code></td>
<td align="left">DBL_MIN_10_EXP</td>
<td align="left">使得 <code>10e</code> 是规格化浮点数的最小整数 <em>e</em></td>
</tr>
<tr>
<td align="left"><code>radix</code></td>
<td align="left">FLT_RADIX</td>
<td align="left">指数表示法中采用的基数</td>
</tr>
<tr>
<td align="left"><code>rounds</code></td>
<td align="left">FLT_ROUNDS</td>
<td align="left">整数常数，表示算术运算中的舍入方式。它反映了解释器启动时系统的 FLT_ROUNDS 宏的值。关于可能的值及其含义的说明，请参阅 C99 标准 5.2.4.2.2 节。</td>
</tr>
</tbody></table>
<p>关于 <code>sys.float_info.dig</code> 属性的进一步说明。如果 <code>s</code> 是表示十进制数的字符串，而该数最多有 <code>sys.float_info.dig</code> 位有效数字，则将 <code>s</code> 转换为 float 再转回去将恢复原先相同十进制值的字符串:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>float_info<span class="token punctuation">.</span>dig
<span class="token number">15</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">'3.14159265358979'</span>    <span class="token comment" spellcheck="true"># decimal string with 15 significant digits</span>
<span class="token operator">>></span><span class="token operator">></span> format<span class="token punctuation">(</span>float<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'.15g'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># convert to float and back -> same value</span>
<span class="token string">'3.14159265358979'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是对于超过 <code>sys.float_info.dig</code> 位有效数字的字符串，转换前后并非总是相同:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">'9876543211234567'</span>    <span class="token comment" spellcheck="true"># 16 significant digits is too many!</span>
<span class="token operator">>></span><span class="token operator">></span> format<span class="token punctuation">(</span>float<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'.16g'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># conversion changes value</span>
<span class="token string">'9876543211234568'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>一个字符串，反映 <code>repr()</code> 函数在浮点数上的行为。如果该字符串是 <code>'short'</code>，那么对于（非无穷的）浮点数 <code>x</code>，<code>repr(x)</code> 将会生成一个短字符串，满足 <code>float(repr(x)) == x</code> 的特性。这是 Python 3.1 及更高版本中的常见行为。否则 <code>float_repr_style</code> 的值将是 <code>'legacy'</code>，此时 <code>repr(x)</code> 的行为方式将与 Python 3.1 之前的版本相同。</p>
<p>3.1 新版功能.</p>
<p><code>sys.getallocatedblocks</code>()</p>
<p>返回解释器当前已分配的内存块数，无论它们大小如何。本函数主要用于跟踪和调试内存泄漏。因为解释器有内部缓存，所以不同调用之间结果会变化。可能需要调用 <code>_clear_type_cache()</code> 和 <code>gc.collect()</code> 使结果更容易预测。</p>
<p>如果当前 Python 构建或实现无法合理地计算此信息，允许 <code>getallocatedblocks()</code> 返回 0。</p>
<p>3.4 新版功能.</p>
<p><code>sys.getandroidapilevel</code>()</p>
<p>返回一个整数，表示 Android 构建时 API 版本。</p>
<p>可用性：Android。</p>
<p>3.7 新版功能.</p>
<p><code>sys.getdefaultencoding</code>()</p>
<p>返回当前 Unicode 实现所使用的默认字符串编码名称。</p>
<p><code>sys.getdlopenflags</code>()</p>
<p>返回当前 <code>dlopen()</code> 调用所使用的标志位的值。标志值对应的符号名称可以在 <code>os</code> 模块中找到（形如 <code>RTLD_xxx</code> 的常量，如 <code>os.RTLD_LAZY</code> ）。</p>
<p>可用性: Unix。</p>
<p><code>sys.getfilesystemencoding</code>()</p>
<p>获取 文件系统编码格式: 与 文件系统错误处理句柄 一起使用以便在 Unicode 文件名和字节文件名之间进行转换。 文件系统错误处理句柄是由 <code>getfilesystemencoding()</code> 来返回的。</p>
<p>为获得最佳兼容性，在任何时候都应使用 str 来表示文件名，尽管使用 bytes 来表示文件名也是受支持的。 接受还返回文件名的函数应当支持 str 或 bytes 并在内部将其转换为系统首选的表示形式。</p>
<p>应使用 <code>os.fsencode()</code> 和 <code>os.fsdecode()</code> 来保证所采用的编码和错误处理方案都是正确的。</p>
<p>filesystem encoding and error handler 是在 Python 启动时通过 <code>PyConfig_Read()</code> 函数来配置的。</p>
<p>在 3.2 版更改: <code>getfilesystemencoding()</code> 的结果将不再有可能是 <code>None</code>。</p>
<p>在 3.6 版更改: Windows 不再保证会返回 <code>'mbcs'</code>。详情请参阅 <a href="https://www.python.org/dev/peps/pep-0529" target="_blank" rel="noopener"><strong>PEP 529</strong></a> 和 <code>_enablelegacywindowsfsencoding()</code>。</p>
<p>在 3.7 版更改: 返回 <code>'utf-8'</code>，如果启用了 Python UTF-8 模式 的话。</p>
<p><code>sys.getfilesystemencodeerrors</code>()</p>
<p>获取 文件系统错误处理句柄: 该错误处理句柄与 文件系统编码格式 一起使用以便在 Unicode 文件名和字节文件名之间进程转换。 文件系统编码格式是由 <code>getfilesystemencoding()</code> 来返回的。</p>
<p>应使用 <code>os.fsencode()</code> 和 <code>os.fsdecode()</code> 来保证所采用的编码和错误处理方案都是正确的。</p>
<p>filesystem encoding and error handler 是在 Python 启动时通过 <code>PyConfig_Read()</code> 函数来配置的：</p>
<p>3.6 新版功能.</p>
<p><code>sys.getrefcount</code>(<em>object</em>)</p>
<p>返回 <em>object</em> 的引用计数。返回的计数通常比预期的多一，因为它包括了作为 <code>getrefcount()</code> 参数的这一次（临时）引用。</p>
<p><code>sys.getrecursionlimit</code>()</p>
<p>返回当前的递归限制值，即 Python 解释器堆栈的最大深度。此限制可防止无限递归导致的 C 堆栈溢出和 Python 崩溃。该值可以通过 <code>setrecursionlimit()</code> 设置。</p>
<p><code>sys.getsizeof</code>(<em>object</em>[, <em>default</em>])</p>
<p>返回对象的大小（以字节为单位）。该对象可以是任何类型。所有内建对象返回的结果都是正确的，但对于第三方扩展不一定正确，因为这与具体实现有关。</p>
<p>只计算直接分配给对象的内存消耗，不计算它所引用的对象的内存消耗。</p>
<p>对象不提供计算大小的方法时，如果传入过 <em>default</em> 则返回它，否则抛出 <code>TypeError</code> 异常。</p>
<p>如果对象由垃圾回收器管理，则 <code>getsizeof()</code> 将调用对象的 <code>__sizeof__</code> 方法，并在上层添加额外的垃圾回收器。</p>
<p>可以参考 recursive sizeof recipe 中的示例，关于递归调用 <code>getsizeof()</code> 来得到各个容器及其所有内容物的大小。</p>
<p><code>sys.getswitchinterval</code>()</p>
<p>返回解释器的“线程切换间隔时间”，请参阅 <code>setswitchinterval()</code>。</p>
<p>3.2 新版功能.</p>
<p><code>sys._getframe</code>([<em>depth</em>])</p>
<p>返回来自调用栈的一个帧对象。如果传入可选整数 <em>depth<em>，则返回从栈顶往下相应调用层数的帧对象。如果该数比调用栈更深，则抛出 <code>ValueError</code>。</em>depth</em> 的默认值是 0，返回调用栈顶部的帧。</p>
<p>引发一个 审计事件 <code>sys._getframe</code>，没有附带参数。</p>
<p><strong>CPython implementation detail:</strong> 这个函数应该只在内部为了一些特定的目的使用。不保证它在所有 Python 实现中都存在。</p>
<p><code>sys.getprofile</code>()</p>
<p>返回由 <code>setprofile()</code> 设置的性能分析函数。</p>
<p><code>sys.gettrace</code>()</p>
<p>返回由 <code>settrace()</code> 设置的跟踪函数。</p>
<p><strong>CPython implementation detail:</strong> <code>gettrace()</code> 函数仅用于实现调试器，性能分析器，打包工具等。它的行为是实现平台的一部分，而不是语言定义的一部分，因此并非在所有 Python 实现中都可用。</p>
<p><code>sys.getwindowsversion</code>()</p>
<p>返回一个具名元组，描述当前正在运行的 Windows 版本。元素名称包括 <em>major</em>, <em>minor</em>, <em>build</em>, <em>platform</em>, <em>service_pack</em>, <em>service_pack_minor</em>, <em>service_pack_major</em>, <em>suite_mask</em>, <em>product_type</em> 和 <em>platform_version<em>。</em>service_pack</em> 包含一个字符串，<em>platform_version</em> 包含一个三元组，其他所有值都是整数。元素也可以通过名称来访问，所以 <code>sys.getwindowsversion()[0]</code> 与 <code>sys.getwindowsversion().major</code> 是等效的。为保持与旧版本的兼容性，只有前 5 个元素可以用索引检索。</p>
<p><em>platform</em> 将会是 <code>2 (VER_PLATFORM_WIN32_NT)</code>。</p>
<p><em>product_type</em> 可能是以下值之一：</p>
<table>
<thead>
<tr>
<th align="left">常量</th>
<th align="left">含意</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>1 (VER_NT_WORKSTATION)</code></td>
<td align="left">系统是工作站。</td>
</tr>
<tr>
<td align="left"><code>2 (VER_NT_DOMAIN_CONTROLLER)</code></td>
<td align="left">系统是域控制器。</td>
</tr>
<tr>
<td align="left"><code>3 (VER_NT_SERVER)</code></td>
<td align="left">系统是服务器，但不是域控制器。</td>
</tr>
</tbody></table>
<p>本函数包装了 Win32 <code>GetVersionEx()</code> 函数，参阅 Microsoft 文档有关 <code>OSVERSIONINFOEX()</code> 的内容可获取这些字段的更多信息。</p>
<p><em>platform_version</em> 返回当前操作系统的主要版本、次要版本和编译版本号，而不是为该进程所模拟的版本。 它旨在用于日志记录而非特性检测。</p>
<p>注解</p>
<p><em>platform_version</em> 会从 kernel32.dll 获取版本号，这个版本可能与 OS 版本不同。 请使用 <code>platform</code> 模块来获取准确的 OS 版本号。</p>
<p>可用性: Windows。</p>
<p>在 3.2 版更改: 更改为具名元组，添加 <em>service_pack_minor</em>, <em>service_pack_major</em>, <em>suite_mask</em> 和 <em>product_type</em>。</p>
<p>在 3.6 版更改: 添加了 <em>platform_version</em></p>
<p><code>sys.get_asyncgen_hooks</code>()</p>
<p>返回一个 <em>asyncgen_hooks</em> 对象，该对象类似于 <code>namedtuple</code>，形式为 (firstiter, finalizer)，其中 <em>firstiter</em> 和 <em>finalizer</em> 为 <code>None</code> 或函数，函数以 异步生成器迭代器 作为参数，并用于在事件循环中干预异步生成器的终结。</p>
<p>3.6 新版功能: 详情请参阅 <a href="https://www.python.org/dev/peps/pep-0525" target="_blank" rel="noopener"><strong>PEP 525</strong></a>。</p>
<p>注解</p>
<p>本函数已添加至暂定软件包（详情请参阅 <a href="https://www.python.org/dev/peps/pep-0411" target="_blank" rel="noopener"><strong>PEP 411</strong></a> ）。</p>
<p><code>sys.get_coroutine_origin_tracking_depth</code>()</p>
<p>获取由 <code>set_coroutine_origin_tracking_depth()</code> 设置的协程来源的追踪深度。</p>
<p>3.7 新版功能.</p>
<p>注解</p>
<p>本函数已添加至暂定软件包（详情请参阅 <a href="https://www.python.org/dev/peps/pep-0411" target="_blank" rel="noopener"><strong>PEP 411</strong></a> ）。仅将其用于调试目的。</p>
<pre><code>sys.hash_info</code></pre><p>一个 具名元组，给出数字类型的哈希的实现参数。</p>
<table>
<thead>
<tr>
<th align="left">attribute — 属性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>width</code></td>
<td align="left">用于哈希值的位宽度</td>
</tr>
<tr>
<td align="left"><code>modulus</code></td>
<td align="left">用于数字散列方案的素数模数P。</td>
</tr>
<tr>
<td align="left"><code>inf</code></td>
<td align="left">为正无穷大返回的哈希值</td>
</tr>
<tr>
<td align="left"><code>nan</code></td>
<td align="left">（该属性已不再被使用）</td>
</tr>
<tr>
<td align="left"><code>imag</code></td>
<td align="left">用于复数虚部的乘数</td>
</tr>
<tr>
<td align="left"><code>algorithm</code></td>
<td align="left">字符串、字节和内存视图的哈希算法的名称</td>
</tr>
<tr>
<td align="left"><code>hash_bits</code></td>
<td align="left">哈希算法的内部输出大小。</td>
</tr>
<tr>
<td align="left"><code>seed_bits</code></td>
<td align="left">散列算法的种子密钥的大小</td>
</tr>
</tbody></table>
<p>3.2 新版功能.</p>
<p>在 3.4 版更改: 添加了 <em>algorithm</em>, <em>hash_bits</em> 和 <em>seed_bits</em></p>
<pre><code>sys.hexversion</code></pre><p>编码为单个整数的版本号。该整数会确保每个版本都自增，其中适当包括了未发布版本。举例来说，要测试 Python 解释器的版本不低于 1.5.2，请使用:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> sys<span class="token punctuation">.</span>hexversion <span class="token operator">>=</span> <span class="token number">0x010502F0</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># use some advanced feature</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># use an alternative implementation or warn the user</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>之所以称它为 <code>hexversion</code>，是因为只有将它传入内置函数 <code>hex()</code> 后，其结果才看起来有意义。也可以使用 具名元组 <code>sys.version_info</code>，它对相同信息有着更人性化的编码。</p>
<p>关于 <code>hexversion</code> 的更多信息可以在 API 和 ABI 版本管理 中找到。</p>
<pre><code>sys.implementation</code></pre><p>一个对象，该对象包含当前运行的 Python 解释器的实现信息。所有 Python 实现中都必须存在下列属性。</p>
<p><em>name</em> 是当前实现的标识符，如 <code>'cpython'</code>。实际的字符串由 Python 实现定义，但保证是小写字母。</p>
<p><em>version</em> 是一个具名元组，格式与 <code>sys.version_info</code> 相同。它表示 Python <em>实现</em> 的版本。 另一个（由 <code>sys.version_info</code> 表示）是当前解释器遵循的相应 Python <em>语言</em> 的版本，两者具有不同的含义。 例如，对于 PyPy 1.8，<code>sys.implementation.version</code> 可能是 <code>sys.version_info(1, 8, 0, 'final', 0)</code>，而 <code>sys.version_info</code> 则是 <code>sys.version_info(2, 7, 2, 'final', 0)</code>。对于 CPython 而言两个值是相同的，因为它是参考实现。</p>
<p><em>hexversion</em> 是十六进制的实现版本，类似于 <code>sys.hexversion</code>。</p>
<p><em>cache_tag</em> 是导入机制使用的标记，用于已缓存模块的文件名。按照惯例，它将由实现的名称和版本组成，如 <code>'cpython-33'</code>。但如果合适，Python 实现可以使用其他值。如果 <code>cache_tag</code> 被置为 <code>None</code>，表示模块缓存已禁用。</p>
<p><code>sys.implementation</code> 可能包含相应 Python 实现的其他属性。这些非标准属性必须以下划线开头，此处不详细阐述。无论其内容如何，<code>sys.implementation</code> 在解释器运行期间或不同实现版本之间都不会更改。（但是不同 Python 语言版本间可能会不同。）详情请参阅 <a href="https://www.python.org/dev/peps/pep-0421" target="_blank" rel="noopener"><strong>PEP 421</strong></a>。</p>
<p>3.3 新版功能.</p>
<p>注解</p>
<p>新的必要属性的添加必须经过常规的 PEP 过程。详情请参阅 <a href="https://www.python.org/dev/peps/pep-0421" target="_blank" rel="noopener"><strong>PEP 421</strong></a>。</p>
<pre><code>sys.int_info</code></pre><p>一个 具名元组，包含 Python 内部整数表示形式的信息。这些属性是只读的。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>bits_per_digit</code></td>
<td align="left">每个数字占有的位数。Python 内部将整数存储在基底 <code>2**int_info.bits_per_digit</code></td>
</tr>
<tr>
<td align="left"><code>sizeof_digit</code></td>
<td align="left">用于表示数字的C类型的字节大小</td>
</tr>
</tbody></table>
<p>3.1 新版功能.</p>
<pre><code>sys.__interactivehook__</code></pre><p>当本属性存在，则以 交互模式 启动解释器时，将自动（不带参数地）调用本属性的值。该过程是在读取 <code>PYTHONSTARTUP</code> 文件之后完成的，所以可以在该文件中设置这一钩子。<code>site</code> 模块 设置了这一属性。</p>
<p>引发一个 审计事件 <code>cpython.run_interactivehook</code>，附带参数 <code>hook</code>。</p>
<p>3.4 新版功能.</p>
<p><code>sys.intern</code>(<em>string</em>)</p>
<p>将 <em>string</em> 插入 “interned” （驻留）字符串表，返回被插入的字符串 — 它是 <em>string</em> 本身或副本。驻留字符串对提高字典查找的性能很有用 — 如果字典中的键已驻留，且所查找的键也已驻留，则键（取散列后）的比较可以用指针代替字符串来比较。通常，Python 程序使用到的名称会被自动驻留，且用于保存模块、类或实例属性的字典的键也已驻留。</p>
<p>驻留字符串不是永久存在的，对 <code>intern()</code> 返回值的引用必须保留下来，才能发挥驻留字符串的优势。</p>
<p><code>sys.is_finalizing</code>()</p>
<p>如果 Python 解释器 正在关闭 则返回 <code>True</code>，否则返回 <code>False</code>。</p>
<p>3.5 新版功能.</p>
<pre><code>sys.last_type
sys.last_value
sys.last_traceback</code></pre><p>这三个变量并非总是有定义，仅当有异常未处理，且解释器打印了错误消息和堆栈回溯时，才会给它们赋值。它们的预期用途，是允许交互中的用户导入调试器模块，进行事后调试，而不必重新运行导致错误的命令。（通常使用 <code>import pdb; pdb.pm()</code> 进入事后调试器。）</p>
<p>这些变量的含义与上述 <code>exc_info()</code> 返回值的含义相同。</p>
<pre><code>sys.maxsize</code></pre><p>一个整数，表示 <code>Py_ssize_t</code> 类型的变量可以取到的最大值。在 32 位平台上通常为 <code>2**31 - 1</code>，在 64 位平台上通常为 <code>2**63 - 1</code>。</p>
<pre><code>sys.maxunicode</code></pre><p>一个整数，表示最大的 Unicode 码点值，如 <code>1114111</code> （十六进制为 <code>0x10FFFF</code> ）。</p>
<p>在 3.3 版更改: 在 <a href="https://www.python.org/dev/peps/pep-0393" target="_blank" rel="noopener"><strong>PEP 393</strong></a> 之前，<code>sys.maxunicode</code> 曾是 <code>0xFFFF</code> 或 <code>0x10FFFF</code>，具体取决于配置选项，该选项指定将 Unicode 字符存储为 UCS-2 还是 UCS-4。</p>
<pre><code>sys.meta_path</code></pre><p>一个由 元路径查找器 对象组成的列表，当查找需要导入的模块时，会调用这些对象的 <code>find_spec()</code> 方法，观察这些对象是否能找到所需模块。调用 <code>find_spec()</code> 方法最少需要传入待导入模块的绝对名称。如果待导入模块包含在一个包中，则父包的 <code>__path__</code> 属性将作为第二个参数被传入。该方法返回 模块规格，找不到模块则返回 <code>None</code>。</p>
<p>参见</p>
<ul>
<li><p><code>importlib.abc.MetaPathFinder</code></p>
<p>抽象基类，定义了 <code>meta_path</code> 内的查找器对象的接口。</p>
<p><code>importlib.machinery.+ModuleSpec</code></p>
<p><code>find_spec()</code> 返回的实例所对应的具体类。</p>
</li>
</ul>
<p>在 3.4 版更改: 在 Python 3.4 中通过 <a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a> 引入了 模块规格。早期版本的 Python 会寻找一个称为 <code>find_module()</code> 的方法。如果某个 <code>meta_path</code> 条目没有 <code>find_spec()</code> 方法，就会回退去调用前一种方法。</p>
<pre><code>sys.modules</code></pre><p>一个字典，将模块名称映射到已加载的模块。可以操作该字典来强制重新加载模块，或是实现其他技巧。但是，替换的字典不一定会按预期工作，并且从字典中删除必要的项目可能会导致 Python 崩溃。</p>
<pre><code>sys.orig_argv</code></pre><p>传给 Python 可执行文件的原始命令行参数列表。</p>
<p>3.10 新版功能.</p>
<pre><code>sys.path</code></pre><p>一个由字符串组成的列表，用于指定模块的搜索路径。初始化自环境变量 <code>PYTHONPATH</code>，再加上一条与安装有关的默认路径。</p>
<p>程序启动时将初始化本列表，列表的第一项 <code>path[0]</code> 目录含有调用 Python 解释器的脚本。如果脚本目录不可用（比如以交互方式调用了解释器，或脚本是从标准输入中读取的），则 <code>path[0]</code> 为空字符串，这将导致 Python 优先搜索当前目录中的模块。注意，脚本目录将插入在 <code>PYTHONPATH</code> 的条目<em>之前</em>。</p>
<p>程序可以随意修改本列表用于自己的目的。只能向 <code>sys.path</code> 中添加 string 和 bytes 类型，其他数据类型将在导入期间被忽略。</p>
<p>参见</p>
<p><code>site</code> 模块，该模块描述了如何使用 .pth 文件来扩展 <code>sys.path</code>。</p>
<pre><code>sys.path_hooks</code></pre><p>一个由可调用对象组成的列表，这些对象接受一个路径作为参数，并尝试为该路径创建一个 查找器。如果成功创建查找器，则可调用对象将返回它，否则将引发 <code>ImportError</code> 异常。</p>
<p>本特性最早在 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 中被提及。</p>
<pre><code>sys.path_importer_cache</code></pre><p>一个字典，作为 查找器 对象的缓存。key 是传入 <code>sys.path_hooks</code> 的路径，value 是相应已找到的查找器。如果路径是有效的文件系统路径，但在 <code>sys.path_hooks</code> 中未找到查找器，则存入 <code>None</code>。</p>
<p>本特性最早在 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 中被提及。</p>
<p>在 3.3 版更改: 未找到查找器时，改为存储 <code>None</code>，而不是 <code>imp.NullImporter</code>。</p>
<pre><code>sys.platform</code></pre><p>本字符串是一个平台标识符，举例而言，该标识符可用于将特定平台的组件追加到 <code>sys.path</code> 中。</p>
<p>对于 Unix 系统（除 Linux 和 AIX 外），该字符串是 <em>Python 构建时的</em> <code>uname -s</code> 返回的小写操作系统名称，并附加了 <code>uname -r</code> 返回的系统版本的第一部分，如 <code>'sunos5'</code> 或 <code>'freebsd8'</code>。除非需要检测特定版本的系统，否则建议使用以下习惯用法:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> sys<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'freebsd'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># FreeBSD-specific code here...</span>
<span class="token keyword">elif</span> sys<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'linux'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Linux-specific code here...</span>
<span class="token keyword">elif</span> sys<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'aix'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># AIX-specific code here...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于其他系统，值是：</p>
<table>
<thead>
<tr>
<th align="left">系统</th>
<th align="left"><code>平台</code> 值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AIX</td>
<td align="left"><code>‘aix’</code></td>
</tr>
<tr>
<td align="left">Linux</td>
<td align="left"><code>‘linux’</code></td>
</tr>
<tr>
<td align="left">Windows</td>
<td align="left"><code>‘win32’</code></td>
</tr>
<tr>
<td align="left">Windows/Cygwin</td>
<td align="left"><code>‘cygwin’</code></td>
</tr>
<tr>
<td align="left">macOS</td>
<td align="left"><code>‘darwin’</code></td>
</tr>
</tbody></table>
<p>在 3.3 版更改: 在 Linux 上，<code>sys.platform</code> 将不再包含副版本号。它将总是 <code>'linux'</code> 而不是 <code>'linux2'</code> 或 <code>'linux3'</code>。由于旧版本的 Python 会包含该版本号，因此推荐总是使用上述 <code>startswith</code> 习惯用法。</p>
<p>在 3.8 版更改: 在 AIX 上，<code>sys.platform</code> 将不再包含副版本号。它将总是 <code>'aix'</code> 而不是 <code>'aix5'</code> 或 <code>'aix7'</code>。由于旧版本的 Python 会包含该版本号，因此推荐总是使用上述 <code>startswith</code> 习惯用法。</p>
<p>参见</p>
<p><code>os.name</code> 更加简略。<code>os.uname()</code> 提供系统的版本信息。</p>
<p><code>platform</code> 模块对系统的标识有更详细的检查。</p>
<pre><code>sys.platlibdir</code></pre><p>平台专用库目录。用于构建标准库的路径和已安装扩展模块的路径。</p>
<p>在大多数平台上，它等同于 <code>"lib"</code> 。在 Fedora 和 SuSE 上，它等同于给出了以下 <code>sys.path</code> 路径的 64 位平台上的 <code>"lib64"</code> （其中 <code>X.Y</code> 是 Python 的 <code>major.minor</code> 版本）。</p>
<ul>
<li><code>/usr/lib64/pythonX.Y/</code>：标准库（如 <code>os</code> 模块的 <code>os.py</code> ）</li>
<li><code>/usr/lib64/pythonX.Y/lib-dynload/</code>：标准库的 C 扩展模块（如 <code>errno</code> 模块，确切的文件名取决于平台）</li>
<li><code>/usr/lib/pythonX.Y/site-packages/</code> (请使用 <code>lib</code>, 而非 <code>sys.platlibdir</code>): 第三方模块</li>
<li><code>/usr/lib64/pythonX.Y/site-packages/</code>: 第三方包的 C 扩展模块</li>
</ul>
<p>3.9 新版功能.</p>
<pre><code>sys.prefix</code></pre><p>一个字符串，给出特定域的目录前缀，该目录中安装了与平台不相关的 Python 文件，默认为 <code>'/usr/local'</code>。该目录前缀可以在构建时使用 <strong>configure</strong> 脚本的 <code>--prefix</code> 参数进行设置。Python 库模块的的主要集合安装在目录 <code>*prefix*/lib/python*X.Y*</code> ，而与平台无关的头文件 (除了 <code>pyconfig.h</code>) 保存在 <code>*prefix*/include/python*X.Y*</code>, 其中 <em>X.Y</em> 是 Python 的版本号, 例如 <code>3.2</code>.</p>
<p>注解</p>
<p>如果在一个 虚拟环境 中，那么该值将在 <code>site.py</code> 中被修改，指向虚拟环境。Python 安装位置仍然可以用 <code>base_prefix</code> 来获取。</p>
<pre><code>sys.ps1
sys.ps2</code></pre><p>字符串，指定解释器的首要和次要提示符。仅当解释器处于交互模式时，它们才有定义。这种情况下，它们的初值为 <code>'&gt;&gt;&gt; '</code> 和 <code>'... '</code>。如果赋给其中某个变量的是非字符串对象，则每次解释器准备读取新的交互式命令时，都会重新运行该对象的 <code>str()</code>，这可以用来实现动态的提示符。</p>
<p><code>sys.setdlopenflags</code>(<em>n</em>)</p>
<p>设置解释器在调用 <code>dlopen()</code> 时用到的标志，例如解释器在加载扩展模块时。首先，调用 <code>sys.setdlopenflags(0)</code> 将在导入模块时对符号启用惰性解析。要在扩展模块之间共享符号，请调用 <code>sys.setdlopenflags(os.RTLD_GLOBAL)</code>。标志值的符号名称可以在 <code>os</code> 模块中找到（即 <code>RTLD_xxx</code> 常量，如 <code>os.RTLD_LAZY</code> ）。</p>
<p>可用性: Unix。</p>
<p><code>sys.setprofile</code>(<em>profilefunc</em>)</p>
<p>设置系统的性能分析函数，该函数使得在 Python 中能够实现一个 Python 源代码性能分析器。性能分析函数的调用方式类似于系统的跟踪函数，但它是通过不同的事件调用的，例如，不是每执行一行代码就调用它一次（仅在调用某函数和从某函数返回时才会调用性能分析函数，但即使某函数发生异常也会算作返回事件）。该函数是特定于单个线程的，但是性能分析器无法得知线程之间的上下文切换，因此在存在多个线程的情况下使用它是没有意义的。另外，因为它的返回值不会被用到，所以可以简单地返回 <code>None</code>。性能分析函数中的错误将导致其自身被解除设置。</p>
<p>性能分析函数应接收三个参数：<em>frame<em>、</em>event</em> 和 <em>arg<em>。</em>frame</em> 是当前的堆栈帧。<em>event</em> 是一个字符串：<code>'call'</code>、<code>'return'</code>、<code>'c_call'</code>、<code>'c_return'</code> 或 <code>'c_exception'</code>。<em>arg</em> 取决于事件类型。</p>
<p>引发一个 审计事件 <code>sys.setprofile</code>，不附带任何参数。</p>
<p>这些事件具有以下含义：</p>
<ul>
<li><p><code>'call'</code></p>
<p>表示调用了某个函数（或进入了其他的代码块）。性能分析函数将被调用，<em>arg</em> 为 <code>None</code>。</p>
<p><code>'return'</code></p>
<p>表示某个函数（或别的代码块）即将返回。性能分析函数将被调用，<em>arg</em> 是即将返回的值，如果此次返回事件是由于抛出异常，<em>arg</em> 为 <code>None</code>。</p>
<p><code>'c_call'</code></p>
<p>表示即将调用某个 C 函数。它可能是扩展函数或是内建函数。<em>arg</em> 是 C 函数对象。</p>
<p><code>'c_return'</code></p>
<p>表示返回了某个 C 函数。<em>arg</em> 是 C 函数对象。</p>
<p><code>'c_exception'</code></p>
<p>表示某个 C 函数抛出了异常。<em>arg</em> 是 C 函数对象。</p>
</li>
</ul>
<p><code>sys.setrecursionlimit</code>(<em>limit</em>)</p>
<p>将 Python 解释器堆栈的最大深度设置为 <em>limit</em>。此限制可防止无限递归导致的 C 堆栈溢出和 Python 崩溃。</p>
<p>不同平台所允许的最高限值不同。当用户有需要深度递归的程序且平台支持更高的限值，可能就需要调高限值。进行该操作需要谨慎，因为过高的限值可能会导致崩溃。</p>
<p>如果新的限值低于当前的递归深度，将抛出 <code>RecursionError</code> 异常。</p>
<p>在 3.5.1 版更改: 如果新的限值低于当前的递归深度，现在将抛出 <code>RecursionError</code> 异常。</p>
<p><code>sys.setswitchinterval</code>(<em>interval</em>)</p>
<p>设置解释器的线程切换间隔时间（单位为秒）。该浮点数决定了“时间片”的理想持续时间，时间片将分配给同时运行的 Python 线程。请注意，实际值可能更高，尤其是使用了运行时间长的内部函数或方法时。同时，在时间间隔末尾调度哪个线程是操作系统的决定。解释器没有自己的调度程序。</p>
<p>3.2 新版功能.</p>
<p><code>sys.settrace</code>(<em>tracefunc</em>)</p>
<p>设置系统的跟踪函数，使得用户在 Python 中就可以实现 Python 源代码调试器。该函数是特定于单个线程的，所以要让调试器支持多线程，必须为正在调试的每个线程都用 <code>settrace()</code> 注册一个跟踪函数，或使用 <code>threading.settrace()</code>。</p>
<p>跟踪函数应接收三个参数：<em>frame<em>、</em>event</em> 和 <em>arg<em>。</em>frame</em> 是当前的堆栈帧。<em>event</em> 是一个字符串：<code>'call'</code>、<code>'line'</code>、<code>'return'</code>、<code>'exception'</code> 或 <code>'opcode'</code>。<em>arg</em> 取决于事件类型。</p>
<p>每次进入 trace 函数的新的局部作用范围，都会调用 trace 函数（ <em>event</em> 会被设置为 <code>'call'</code> ），它应该返回一个引用，指向即将用在新作用范围上的局部跟踪函数；如果不需要跟踪当前的作用范围，则返回 <code>None</code>。</p>
<p>局部跟踪函数应返回对自身的引用（或对另一个函数的引用，用来在其作用范围内进行进一步的跟踪），或者返回 <code>None</code> 来停止跟踪其作用范围。</p>
<p>如果跟踪函数出错，则该跟踪函数将被取消设置，类似于调用 <code>settrace(None)</code>。</p>
<p>这些事件具有以下含义：</p>
<ul>
<li><p><code>'call'</code></p>
<p>表示调用了某个函数（或进入了其他的代码块）。全局跟踪函数将被调用，<em>arg</em> 为 <code>None</code>。返回值将指定局部跟踪函数。</p>
<p><code>'line'</code></p>
<p>表示解释器即将执行新一行代码或重新执行循环条件。局部跟踪函数将被调用，<em>arg</em> 为 <code>None</code>，其返回值将指定新的局部跟踪函数。关于其工作原理的详细说明，请参见 <code>Objects/lnotab_notes.txt</code>。要在该堆栈帧禁用每行触发事件，可以在堆栈帧上将 <code>f_trace_lines</code> 设置为 <code>False</code>。</p>
<p><code>'return'</code></p>
<p>表示某个函数（或别的代码块）即将返回。局部跟踪函数将被调用，<em>arg</em> 是即将返回的值，如果此次返回事件是由于抛出异常，<em>arg</em> 为 <code>None</code>。跟踪函数的返回值将被忽略。</p>
<p><code>'exception'</code></p>
<p>表示发生了某个异常。局部跟踪函数将被调用，<em>arg</em> 是一个 <code>(exception, value, traceback)</code> 元组，返回值将指定新的局部跟踪函数。</p>
<p><code>'opcode'</code></p>
<p>表示解释器即将执行一个新的操作码。局部跟踪函数将被调用，<em>arg</em> 为 <code>None</code>，其返回值将指定新的局部跟踪函数。每操作码触发事件默认情况下都不发出：必须在堆栈帧上将 <code>f_trace_opcodes</code> 显式地设置为 <code>True</code> 来请求这些事件。</p>
</li>
</ul>
<p>注意，由于异常是在链式调用中传播的，所以每一级都会产生一个 <code>'exception'</code> 事件。</p>
<p>更细微的用法是，可以显式地通过赋值 <code>frame.f_trace = tracefunc</code> 来设置跟踪函数，而不是用现有跟踪函数的返回值去间接设置它。当前帧上的跟踪函数必须激活，而 <code>settrace()</code> 还没有做这件事。注意，为了使上述设置起效，必须使用 <code>settrace()</code> 来安装全局跟踪函数才能启用运行时跟踪机制，但是它不必与上述是同一个跟踪函数（它可以是一个开销很低的跟踪函数，只返回 <code>None</code>，即在各个帧上立即将其自身禁用）。</p>
<p>引发一个 审计事件 <code>sys.settrace</code>，不附带任何参数。</p>
<p><strong>CPython implementation detail:</strong> <code>settrace()</code> 函数仅用于实现调试器，性能分析器，打包工具等。它的行为是实现平台的一部分，而不是语言定义的一部分，因此并非在所有 Python 实现中都可用。</p>
<p>在 3.7 版更改: 添加了 <code>'opcode'</code> 事件类型；为帧对象添加了 <code>f_trace_lines</code> 和 <code>f_trace_opcodes</code> 属性</p>
<p><code>sys.set_asyncgen_hooks</code>(<em>firstiter</em>, <em>finalizer</em>)</p>
<p>接受两个可选的关键字参数，要求它们是可调用对象，且接受一个 异步生成器迭代器 作为参数。<em>firstiter</em> 对象将在异步生成器第一次迭代时调用。<em>finalizer</em> 将在异步生成器即将被销毁时调用。</p>
<p>引发一个 审计事件 <code>sys.set_asyncgen_hooks_firstiter</code>，不附带任何参数。</p>
<p>引发一个 审计事件 <code>sys.set_asyncgen_hooks_finalizer</code>，不附带任何参数。</p>
<p>之所以会引发两个审计事件，是因为底层的 API 由两个调用组成，每个调用都须要引发自己的事件。</p>
<p>3.6 新版功能: 更多详情请参阅 <a href="https://www.python.org/dev/peps/pep-0525" target="_blank" rel="noopener"><strong>PEP 525</strong></a>，<em>finalizer</em> 方法的参考示例可参阅 <a href="https://github.com/python/cpython/tree/3.10/Lib/asyncio/base_events.py" target="_blank" rel="noopener">Lib/asyncio/base_events.py</a> 中 <code>asyncio.Loop.shutdown_asyncgens</code> 的实现。</p>
<p>注解</p>
<p>本函数已添加至暂定软件包（详情请参阅 <a href="https://www.python.org/dev/peps/pep-0411" target="_blank" rel="noopener"><strong>PEP 411</strong></a> ）。</p>
<p><code>sys.set_coroutine_origin_tracking_depth</code>(<em>depth</em>)</p>
<p>用于启用或禁用协程溯源。启用后，协程对象上的 <code>cr_origin</code> 属性将包含一个元组，它由多个（文件名 filename，行号 line number，函数名 function name）元组组成，整个元组描述出了协程对象创建过程的回溯，元组首端是最近一次的调用。禁用后，<code>cr_origin</code> 将为 None。</p>
<p>要启用，请向 <em>depth</em> 传递一个大于零的值，它指定了有多少帧将被捕获信息。要禁用，请将 <em>depth</em> 置为零。</p>
<p>该设置是特定于单个线程的。</p>
<p>3.7 新版功能.</p>
<p>注解</p>
<p>本函数已添加至暂定软件包（详情请参阅 <a href="https://www.python.org/dev/peps/pep-0411" target="_blank" rel="noopener"><strong>PEP 411</strong></a> ）。仅将其用于调试目的。</p>
<p><code>sys._enablelegacywindowsfsencoding</code>()</p>
<p>将 filesystem encoding and error handler 分别修改为 ‘mbcs’ 和 ‘replace’，以便与 3.6 之前版本的 Python 保持一致。</p>
<p>这等同于在启动 Python 前先定义好 <code>PYTHONLEGACYWINDOWSFSENCODING</code> 环境变量。</p>
<p>另请参阅 <code>sys.getfilesystemencoding()</code> 和 <code>sys.getfilesystemencodeerrors()</code>。</p>
<p>可用性: Windows。</p>
<p>3.6 新版功能: 更多详情请参阅 <a href="https://www.python.org/dev/peps/pep-0529" target="_blank" rel="noopener"><strong>PEP 529</strong></a>。</p>
<pre><code>sys.stdin
sys.stdout
sys.stderr</code></pre><p>解释器用于标准输入、标准输出和标准错误的 文件对象：</p>
<ul>
<li><code>stdin</code> 用于所有交互式输入（包括对 <code>input()</code> 的调用）；</li>
<li><code>stdout</code> 用于 <code>print()</code> 和 expression 语句的输出，以及用于 <code>input()</code> 的提示符；</li>
<li>解释器自身的提示符和它的错误消息都发往 <code>stderr</code>。</li>
</ul>
<p>这些流都是常规 文本文件，与 <code>open()</code> 函数返回的对象一致。它们的参数选择如下：</p>
<ul>
<li><p>编码格式和错误处理句柄是由 <code>PyConfig.stdio_encoding</code> 和 <code>PyConfig.stdio_errors</code> 来初始化的。</p>
<p>在 Windows 上，控制台设备使用 UTF-8。 非字符设备如磁盘文件和管道使用系统语言区域编码格式（例如 ANSI 代码页）。 非控制台字符设备如 NUL（例如当 <code>isatty()</code> 返回 <code>True</code> 时）会在启动时分别让 stdin 和 stdout/stderr 使用控制台输入和输出代码页。 如果进程初始化时没有被附加到控制台则会使用默认的系统 locale encoding。</p>
<p>要重写控制台的特殊行为，可以在启动 Python 前设置 PYTHONLEGACYWINDOWSSTDIO 环境变量。此时，控制台代码页将用于其他字符设备。</p>
<p>在所有平台上，都可以通过在 Python 启动前设置 <code>PYTHONIOENCODING</code> 环境变量来重写字符编码，或通过新的 <code>-X</code> <code>utf8</code> 命令行选项和 <code>PYTHONUTF8</code> 环境变量来设置。但是，对 Windows 控制台来说，上述方法仅在设置了 <code>PYTHONLEGACYWINDOWSSTDIO</code> 后才起效。</p>
</li>
<li><p>交互模式下，<code>stdout</code> 流是行缓冲的。其他情况下，它像常规文本文件一样是块缓冲的。两种情况下的 <code>stderr</code> 流都是行缓冲的。要使得两个流都变成无缓冲，可以传入 <code>-u</code> 命令行选项或设置 <code>PYTHONUNBUFFERED</code> 环境变量。</p>
</li>
</ul>
<p>在 3.9 版更改: 非交互模式下，<code>stderr</code> 现在是行缓冲的，而不是全缓冲的。</p>
<p>注解</p>
<p>要从标准流写入或读取二进制数据，请使用底层二进制 <code>buffer</code> 对象。例如，要将字节写入 <code>stdout</code>，请使用 <code>sys.stdout.buffer.write(b'abc')</code>。<a href=""></a></p>
<p>但是，如果你在写一个库（并且不限制执行库代码时的上下文），那么请注意，标准流可能会被替换为文件类对象，如 <code>io.StringIO</code>，它们是不支持 <code>buffer</code> 属性的。</p>
<pre><code>sys.__stdin__
sys.__stdout__
sys.__stderr__</code></pre><p>程序开始时，这些对象存有 <code>stdin</code>、<code>stderr</code> 和 <code>stdout</code> 的初始值。它们在程序结束前都可以使用，且在需要向实际的标准流打印内容时很有用，无论 <code>sys.std*</code> 对象是否已重定向。</p>
<p>如果实际文件已经被覆盖成一个损坏的对象了，那它也可用于将实际文件还原成能正常工作的文件对象。但是，本过程的最佳方法应该是，在原来的流被替换之前就显式地保存它，并使用这一保存的对象来还原。</p>
<p>注解</p>
<p>某些情况下的 <code>stdin</code>、<code>stdout</code> 和 <code>stderr</code> 以及初始值 <code>__stdin__</code>、<code>__stdout__</code> 和 <code>__stderr__</code> 可以是 <code>None</code>。通常发生在未连接到控制台的 Windows GUI app 中，以及在用 <strong>pythonw</strong> 启动的 Python app 中。</p>
<pre><code>sys.stdlib_module_names</code></pre><p>一个包含标准库模组名称字符串的冻结集合。</p>
<p>它在所有平台上都保持一致。 在某些平台上不可用的模块和在 Python 编译时被禁用的模块也会被列出。 所有种类的模块都会被列出：纯 Python 模块、内置模块、冻结模块和扩展模块等。 测试模块则会被排除掉。</p>
<p>对于包来说，仅会列出主包：子包和子模块不会被列出。 例如，<code>email</code> 包会被列出，但 <code>email.mime</code> 子包和 <code>email.message</code> 子模块不会被列出。</p>
<p>3.10 新版功能.</p>
<pre><code>sys.thread_info</code></pre><p>一个 具名元组，包含线程实现的信息。</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>name</code></td>
<td align="left">线程实现的名称：<code>‘nt’</code>: Windows 线程<code>‘pthread’</code>: POSIX 线程<code>‘solaris’</code>: Solaris 线程</td>
</tr>
<tr>
<td align="left"><code>lock</code></td>
<td align="left">锁实现的名称：<code>‘semaphore’</code>: 锁使用信号量<code>‘mutex+cond’</code>: 锁使用互斥和条件变量<code>None</code> 如果此信息未知</td>
</tr>
<tr>
<td align="left"><code>version</code></td>
<td align="left">线程库的名称和版本。它是一个字符串，如果此信息未知，则为 <code>None</code> 。</td>
</tr>
</tbody></table>
<p>3.3 新版功能.</p>
<pre><code>sys.tracebacklimit</code></pre><p>当该变量值设置为整数，在发生未处理的异常时，它将决定打印的回溯信息的最大层级数。默认为 <code>1000</code>。当将其设置为 <code>0</code> 或小于 0，将关闭所有回溯信息，并且只打印异常类型和异常值。</p>
<p><code>sys.unraisablehook</code>(<em>unraisable</em>, <em>/</em>)</p>
<p>处理一个无法抛出的异常。</p>
<p>它会在发生了一个异常但 Python 没有办法处理时被调用。例如，当一个析构器引发了异常，或在垃圾回收 (<code>gc.collect()</code>) 期间引发了异常。</p>
<p><em>unraisable</em> 参数具有以下属性:</p>
<ul>
<li><em>exc_type</em>: 异常类型</li>
<li><em>exc_value</em>: 异常值，可以是 <code>None</code>.</li>
<li><em>exc_traceback</em>: 异常回溯，可以是 <code>None</code>.</li>
<li><em>err_msg</em>: 错误信息，可以是 <code>None</code>.</li>
<li><em>object</em>: 导致异常的对象，可以为 <code>None</code>.</li>
</ul>
<p>默认的钩子程序会将 <em>err_msg</em> 和 <em>object</em> 格式化为： <code>f'{err_msg}: {object!r}'</code>；如果 <em>err_msg</em> 为 <code>None</code> 则采用 “Exception ignored in” 错误信息。</p>
<p>要改变无法抛出的异常的处理过程，可以重写 <code>sys.unraisablehook()</code>。</p>
<p>使用定制钩子存放 <em>exc_value</em> 可能会创建引用循环。 它应当在不再需要异常时被显式地清空以打破引用循环。</p>
<p>如果一个 <em>object</em> 正在被销毁，那么使用自定义的钩子储存该对象可能会将其复活。请在自定义钩子生效后避免储存 <em>object</em>，以避免对象的复活。</p>
<p>另请参阅 <code>excepthook()</code>，它处理未捕获的异常。</p>
<p>引发一个审计事件 <code>sys.unraisablehook</code> 并附带参数 <code>hook</code>, <code>unraisable</code>。</p>
<p>3.8 新版功能.</p>
<pre><code>sys.version</code></pre><p>一个包含 Python 解释器版本号加编译版本号以及所用编译器等额外信息的字符串。 此字符串会在交互式解释器启动时显示。 请不要从中提取版本信息，而应当使用 <code>version_info</code> 以及 <code>platform</code> 模块所提供的函数。</p>
<pre><code>sys.api_version</code></pre><p>这个解释器的 C API 版本。当你在调试 Python及期扩展模板的版本冲突这个功能非常有用。</p>
<pre><code>sys.version_info</code></pre><p>一个包含版本号五部分的元组: <em>major</em>, <em>minor</em>, <em>micro</em>, <em>releaselevel</em> 和 <em>serial*。 除 *releaselevel</em> 外的所有值均为整数；发布级别值则为 <code>'alpha'</code>, <code>'beta'</code>, <code>'candidate'</code> 或 <code>'final'</code>。 对应于 Python 版本 2.0 的 <code>version_info</code> 值为 <code>(2, 0, 0, 'final', 0)</code>。 这些部分也可按名称访问，因此 <code>sys.version_info[0]</code> 就等价于 <code>sys.version_info.major</code>，依此类推。</p>
<p>在 3.1 版更改: 增加了以名称表示的各部分属性。</p>
<pre><code>sys.warnoptions</code></pre><p>这是警告框架的一个实现细节；请不要修改此值。 有关警告框架的更多信息请参阅 <code>warnings</code> 模块。</p>
<pre><code>sys.winver</code></pre><p>用于在 Windows 平台上组成注册表键的版本号。 这在 Python DLL 中存储为 1000 号字符串资源。 其值通常是 <code>version</code> 的头三个字符。 它在 <code>sys</code> 模块中提供是为了信息展示目的；修改此值不会影响 Python 所使用的注册表键。</p>
<p>可用性: Windows。</p>
<pre><code>sys._xoptions</code></pre><p>一个字典，包含通过 <code>-X</code> 命令行选项传递的旗标，这些旗标专属于各种具体实现。选项名称将会映射到对应的值（如果显式指定）或者 <code>True</code>。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">$ <span class="token punctuation">.</span><span class="token operator">/</span>python <span class="token operator">-</span>Xa<span class="token operator">=</span>b <span class="token operator">-</span>Xc
Python <span class="token number">3.</span><span class="token number">2a3</span><span class="token operator">+</span> <span class="token punctuation">(</span>py3k<span class="token punctuation">,</span> Oct <span class="token number">16</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>GCC <span class="token number">4.4</span><span class="token punctuation">.</span><span class="token number">3</span><span class="token punctuation">]</span> on linux2
Type <span class="token string">"help"</span><span class="token punctuation">,</span> <span class="token string">"copyright"</span><span class="token punctuation">,</span> <span class="token string">"credits"</span> <span class="token operator">or</span> <span class="token string">"license"</span> <span class="token keyword">for</span> more information<span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>_xoptions
<span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>CPython implementation detail:</strong> 这是 CPython 专属的访问通过 <code>-X</code> 传递的选项的方式。 其他实现可能会通过其他方式导出它们，或者完全不导出。</p>
<p>3.2 新版功能.</p>
<h2 id="sysconfig-—-Provide-access-to-Python’s-configuration-information"><a href="#sysconfig-—-Provide-access-to-Python’s-configuration-information" class="headerlink" title="sysconfig —- Provide access to Python’s configuration information"></a><code>sysconfig</code> —- Provide access to Python’s configuration information</h2><p>3.2 新版功能.</p>
<p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/sysconfig.py" target="_blank" rel="noopener">Lib/sysconfig.py</a></p>
<hr>
<p>The <code>sysconfig</code> module provides access to Python’s configuration information like the list of installation paths and the configuration variables relevant for the current platform.</p>
<h3 id="配置变量"><a href="#配置变量" class="headerlink" title="配置变量"></a>配置变量</h3><p>A Python distribution contains a <code>Makefile</code> and a <code>pyconfig.h</code> header file that are necessary to build both the Python binary itself and third-party C extensions compiled using <code>distutils</code>.</p>
<p><code>sysconfig</code> puts all variables found in these files in a dictionary that can be accessed using <code>get_config_vars()</code> or <code>get_config_var()</code>.</p>
<p>Notice that on Windows, it’s a much smaller set.</p>
<p><code>sysconfig.get_config_vars</code>(<em>\</em>args*)</p>
<p>With no arguments, return a dictionary of all configuration variables relevant for the current platform.</p>
<p>With arguments, return a list of values that result from looking up each argument in the configuration variable dictionary.</p>
<p>For each argument, if the value is not found, return <code>None</code>.</p>
<p><code>sysconfig.get_config_var</code>(<em>name</em>)</p>
<p>Return the value of a single variable <em>name</em>. Equivalent to <code>get_config_vars().get(name)</code>.</p>
<p>If <em>name</em> is not found, return <code>None</code>.</p>
<p>用法示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sysconfig
<span class="token operator">>></span><span class="token operator">></span> sysconfig<span class="token punctuation">.</span>get_config_var<span class="token punctuation">(</span><span class="token string">'Py_ENABLE_SHARED'</span><span class="token punctuation">)</span>
<span class="token number">0</span>
<span class="token operator">>></span><span class="token operator">></span> sysconfig<span class="token punctuation">.</span>get_config_var<span class="token punctuation">(</span><span class="token string">'LIBDIR'</span><span class="token punctuation">)</span>
<span class="token string">'/usr/local/lib'</span>
<span class="token operator">>></span><span class="token operator">></span> sysconfig<span class="token punctuation">.</span>get_config_vars<span class="token punctuation">(</span><span class="token string">'AR'</span><span class="token punctuation">,</span> <span class="token string">'CXX'</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'ar'</span><span class="token punctuation">,</span> <span class="token string">'g++'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="安装路径"><a href="#安装路径" class="headerlink" title="安装路径"></a>安装路径</h3><p>Python uses an installation scheme that differs depending on the platform and on the installation options. These schemes are stored in <code>sysconfig</code> under unique identifiers based on the value returned by <code>os.name</code>.</p>
<p>Every new component that is installed using <code>distutils</code> or a Distutils-based system will follow the same scheme to copy its file in the right places.</p>
<p>Python currently supports seven schemes:</p>
<ul>
<li><em>posix_prefix</em>: scheme for POSIX platforms like Linux or macOS. This is the default scheme used when Python or a component is installed.</li>
<li><em>posix_home</em>: scheme for POSIX platforms used when a <em>home</em> option is used upon installation. This scheme is used when a component is installed through Distutils with a specific home prefix.</li>
<li><em>posix_user</em>: scheme for POSIX platforms used when a component is installed through Distutils and the <em>user</em> option is used. This scheme defines paths located under the user home directory.</li>
<li><em>nt</em>: scheme for NT platforms like Windows.</li>
<li><em>nt_user</em>: scheme for NT platforms, when the <em>user</em> option is used.</li>
</ul>
<p>Each scheme is itself composed of a series of paths and each path has a unique identifier. Python currently uses eight paths:</p>
<ul>
<li><em>stdlib</em>: directory containing the standard Python library files that are not platform-specific.</li>
<li><em>platstdlib</em>: directory containing the standard Python library files that are platform-specific.</li>
<li><em>platlib</em>: directory for site-specific, platform-specific files.</li>
<li><em>purelib</em>: directory for site-specific, non-platform-specific files.</li>
<li><em>include</em>: directory for non-platform-specific header files.</li>
<li><em>platinclude</em>: directory for platform-specific header files.</li>
<li><em>scripts</em>: directory for script files.</li>
<li><em>data</em>: directory for data files.</li>
</ul>
<p><code>sysconfig</code> provides some functions to determine these paths.</p>
<p><code>sysconfig.get_scheme_names</code>()</p>
<p>Return a tuple containing all schemes currently supported in <code>sysconfig</code>.</p>
<p><code>sysconfig.get_default_scheme</code>()</p>
<p>Return the default scheme name for the current platform.</p>
<p>在 3.10 版更改: This function was previously named <code>_get_default_scheme()</code> and considered an implementation detail.</p>
<p><code>sysconfig.get_preferred_scheme</code>(<em>key</em>)</p>
<p>Return a preferred scheme name for an installation layout specified by <em>key</em>.</p>
<p><em>key</em> must be either <code>"prefix"</code>, <code>"home"</code>, or <code>"user"</code>.</p>
<p>The return value is a scheme name listed in <code>get_scheme_names()</code>. It can be passed to <code>sysconfig</code> functions that take a <em>scheme</em> argument, such as <code>get_paths()</code>.</p>
<p>3.10 新版功能.</p>
<p><code>sysconfig._get_preferred_schemes</code>()</p>
<p>Return a dict containing preferred scheme names on the current platform. Python implementers and redistributors may add their preferred schemes to the <code>_INSTALL_SCHEMES</code> module-level global value, and modify this function to return those scheme names, to e.g. provide different schemes for system and language package managers to use, so packages installed by either do not mix with those by the other.</p>
<p>End users should not use this function, but <code>get_default_scheme()</code> and <code>get_preferred_scheme()</code> instead.</p>
<p>3.10 新版功能.</p>
<p><code>sysconfig.get_path_names</code>()</p>
<p>Return a tuple containing all path names currently supported in <code>sysconfig</code>.</p>
<p><code>sysconfig.get_path</code>(<em>name</em>[, <em>scheme</em>[, <em>vars</em>[, <em>expand</em>]]])</p>
<p>Return an installation path corresponding to the path <em>name</em>, from the install scheme named <em>scheme</em>.</p>
<p><em>name</em> has to be a value from the list returned by <code>get_path_names()</code>.</p>
<p><code>sysconfig</code> stores installation paths corresponding to each path name, for each platform, with variables to be expanded. For instance the <em>stdlib</em> path for the <em>nt</em> scheme is: <code>{base}/Lib</code>.</p>
<p><code>get_path()</code> will use the variables returned by <code>get_config_vars()</code> to expand the path. All variables have default values for each platform so one may call this function and get the default value.</p>
<p>If <em>scheme</em> is provided, it must be a value from the list returned by <code>get_scheme_names()</code>. Otherwise, the default scheme for the current platform is used.</p>
<p>If <em>vars</em> is provided, it must be a dictionary of variables that will update the dictionary return by <code>get_config_vars()</code>.</p>
<p>If <em>expand</em> is set to <code>False</code>, the path will not be expanded using the variables.</p>
<p>If <em>name</em> is not found, raise a <code>KeyError</code>.</p>
<p><code>sysconfig.get_paths</code>([<em>scheme</em>[, <em>vars</em>[, <em>expand</em>]]])</p>
<p>Return a dictionary containing all installation paths corresponding to an installation scheme. See <code>get_path()</code> for more information.</p>
<p>If <em>scheme</em> is not provided, will use the default scheme for the current platform.</p>
<p>If <em>vars</em> is provided, it must be a dictionary of variables that will update the dictionary used to expand the paths.</p>
<p>If <em>expand</em> is set to false, the paths will not be expanded.</p>
<p>If <em>scheme</em> is not an existing scheme, <code>get_paths()</code> will raise a <code>KeyError</code>.</p>
<h3 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h3><p><code>sysconfig.get_python_version</code>()</p>
<p>Return the <code>MAJOR.MINOR</code> Python version number as a string. Similar to <code>'%d.%d' % sys.version_info[:2]</code>.</p>
<p><code>sysconfig.get_platform</code>()</p>
<p>Return a string that identifies the current platform.</p>
<p>This is used mainly to distinguish platform-specific build directories and platform-specific built distributions. Typically includes the OS name and version and the architecture (as supplied by ‘os.uname()’), although the exact information included depends on the OS; e.g., on Linux, the kernel version isn’t particularly important.</p>
<p>返回值的示例：</p>
<ul>
<li>linux-i586</li>
<li>linux-alpha (?)</li>
<li>solaris-2.6-sun4u</li>
</ul>
<p>Windows将返回以下之一：</p>
<ul>
<li>win-amd64 (在 AMD64, aka x86_64, Intel64, 和 EM64T上的64位 Windows )</li>
<li>win32 (all others - specifically, sys.platform is returned)</li>
</ul>
<p>macOS can return:</p>
<ul>
<li>macosx-10.6-ppc</li>
<li>macosx-10.4-ppc64</li>
<li>macosx-10.3-i386</li>
<li>macosx-10.4-fat</li>
</ul>
<p>对于其他非-POSIX 平台， 目前只是返回 <code>sys.platform</code> 。</p>
<p><code>sysconfig.is_python_build</code>()</p>
<p>Return <code>True</code> if the running Python interpreter was built from source and is being run from its built location, and not from a location resulting from e.g. running <code>make install</code> or installing via a binary installer.</p>
<p><code>sysconfig.parse_config_h</code>(<em>fp</em>[, <em>vars</em>])</p>
<p>Parse a <code>config.h</code>-style file.</p>
<p><em>fp</em> is a file-like object pointing to the <code>config.h</code>-like file.</p>
<p>A dictionary containing name/value pairs is returned. If an optional dictionary is passed in as the second argument, it is used instead of a new dictionary, and updated with the values read in the file.</p>
<p><code>sysconfig.get_config_h_filename</code>()</p>
<p>返回 <code>pyconfig.h</code> 的目录</p>
<p><code>sysconfig.get_makefile_filename</code>()</p>
<p>返回 <code>Makefile</code> 的目录</p>
<h3 id="Using-sysconfig-as-a-script"><a href="#Using-sysconfig-as-a-script" class="headerlink" title="Using sysconfig as a script"></a>Using <code>sysconfig</code> as a script</h3><p>You can use <code>sysconfig</code> as a script with Python’s <em>-m</em> option:</p>
<pre><code>$ python -m sysconfig
Platform: "macosx-10.4-i386"
Python version: "3.2"
Current installation scheme: "posix_prefix"
Paths:
        data = "/usr/local"
        include = "/Users/tarek/Dev/svn.python.org/py3k/Include"
        platinclude = "."
        platlib = "/usr/local/lib/python3.2/site-packages"
        platstdlib = "/usr/local/lib/python3.2"
        purelib = "/usr/local/lib/python3.2/site-packages"
        scripts = "/usr/local/bin"
        stdlib = "/usr/local/lib/python3.2"
Variables:
        AC_APPLE_UNIVERSAL_BUILD = "0"
        AIX_GENUINE_CPLUSPLUS = "0"
        AR = "ar"
        ARFLAGS = "rc"
        ...</code></pre><p>This call will print in the standard output the information returned by <code>get_platform()</code>, <code>get_python_version()</code>, <code>get_path()</code> and <code>get_config_vars()</code>.</p>
<h2 id="builtins-—-内建对象"><a href="#builtins-—-内建对象" class="headerlink" title="builtins —- 内建对象"></a><code>builtins</code> —- 内建对象</h2><p>该模块提供对Python的所有“内置”标识符的直接访问；例如，<code>builtins.open</code> 是内置函数的全名 <code>open()</code> 。</p>
<p>大多数应用程序通常不会显式访问此模块，但在提供与内置值同名的对象的模块中可能很有用，但其中还需要内置该名称。例如，在一个想要实现 <code>open()</code> 函数的模块中，它包装了内置的 <code>open()</code> ，这个模块可以直接使用:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> builtins
<span class="token keyword">def</span> <span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> builtins<span class="token punctuation">.</span>open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> UpperCaser<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UpperCaser</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Wrapper around a file that converts output to upper-case.'''</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_f <span class="token operator">=</span> f
    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_f<span class="token punctuation">.</span>read<span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>作为一个实现细节，大多数模块都将名称 <code>__builtins__</code> 作为其全局变量的一部分提供。 <code>__builtins__</code> 的值通常是这个模块或者这个模块的值 <code>__dict__</code> 属性。由于这是一个实现细节，因此 Python 的替代实现可能不会使用它。</p>
<h2 id="main-—-Top-level-code-environment"><a href="#main-—-Top-level-code-environment" class="headerlink" title="__main__ —- Top-level code environment"></a><code>__main__</code> —- Top-level code environment</h2><p>In Python, the special name <code>__main__</code> is used for two important constructs:</p>
<ol>
<li>the name of the top-level environment of the program, which can be checked using the <code>__name__ == '__main__'</code> expression; and</li>
<li>the <code>__main__.py</code> file in Python packages.</li>
</ol>
<p>Both of these mechanisms are related to Python modules; how users interact with them and how they interact with each other. They are explained in detail below. If you’re new to Python modules, see the tutorial section 模块 for an introduction.</p>
<h3 id="name-39-main-39"><a href="#name-39-main-39" class="headerlink" title="__name__ == '__main__'"></a><code>__name__ == '__main__'</code></h3><p>When a Python module or package is imported, <code>__name__</code> is set to the module’s name. Usually, this is the name of the Python file itself without the <code>.py</code> extension:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> configparser
<span class="token operator">>></span><span class="token operator">></span> configparser<span class="token punctuation">.</span>__name__
<span class="token string">'configparser'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>If the file is part of a package, <code>__name__</code> will also include the parent package’s path:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> process
<span class="token operator">>></span><span class="token operator">></span> process<span class="token punctuation">.</span>__name__
<span class="token string">'concurrent.futures.process'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>However, if the module is executed in the top-level code environment, its <code>__name__</code> is set to the string <code>'__main__'</code>.</p>
<h4 id="What-is-the-“top-level-code-environment”"><a href="#What-is-the-“top-level-code-environment”" class="headerlink" title="What is the “top-level code environment”?"></a>What is the “top-level code environment”?</h4><p><code>__main__</code> is the name of the environment where top-level code is run. “Top-level code” is the first user-specified Python module that starts running. It’s “top-level” because it imports all other modules that the program needs. Sometimes “top-level code” is called an <em>entry point</em> to the application.</p>
<p>The top-level code environment can be:</p>
<ul>
<li><p>the scope of an interactive prompt:</p>
<pre><code>&gt;&gt;&gt; __name__
'__main__'</code></pre></li>
<li><p>the Python module passed to the Python interpreter as a file argument:</p>
<blockquote>
<pre><code>$ python3 helloworld.py
Hello, world!</code></pre></blockquote>
</li>
<li><p>the Python module or package passed to the Python interpreter with the <code>-m</code> argument:</p>
<blockquote>
<pre><code>$ python3 -m tarfile
usage: tarfile.py [-h] [-v] (...)</code></pre></blockquote>
</li>
<li><p>Python code read by the Python interpreter from standard input:</p>
<blockquote>
<pre><code>$ echo "import this" | python3
The Zen of Python, by Tim Peters
Beautiful is better than ugly.
Explicit is better than implicit.
...</code></pre></blockquote>
</li>
<li><p>Python code passed to the Python interpreter with the <code>-c</code> argument:</p>
<blockquote>
<pre><code>$ python3 -c "import this"
The Zen of Python, by Tim Peters
Beautiful is better than ugly.
Explicit is better than implicit.
...</code></pre></blockquote>
</li>
</ul>
<p>In each of these situations, the top-level module’s <code>__name__</code> is set to <code>'__main__'</code>.</p>
<p>As a result, a module can discover whether or not it is running in the top-level environment by checking its own <code>__name__</code>, which allows a common idiom for conditionally executing code when the module is not initialized from an import statement:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__mainif __name__ == '</span>__main__'<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Execute when the module is not initialized from an import statement.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>__'<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># Execute when the module is not initialized from an import statement.    ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>参见</p>
<p>For a more detailed look at how <code>__name__</code> is set in all situations, see the tutorial section 模块.</p>
<h4 id="Idiomatic-Usage"><a href="#Idiomatic-Usage" class="headerlink" title="Idiomatic Usage"></a>Idiomatic Usage</h4><p>Some modules contain code that is intended for script use only, like parsing command-line arguments or fetching data from standard input. When a module like this were to be imported from a different module, for example to unit test it, the script code would unintentionally execute as well.</p>
<p>This is where using the <code>if __name__ == '__main__'</code> code block comes in handy. Code within this block won’t run unless the module is executed in the top-level environment.</p>
<p>Putting as few statements as possible in the block below <code>if __name___ == '__main__'</code> can improve code clarity and correctness. Most often, a function named <code>main</code> encapsulates the program’s primary behavior:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># echo.py</span>
<span class="token keyword">import</span> shlex
<span class="token keyword">import</span> sys
<span class="token keyword">def</span> <span class="token function">echo</span><span class="token punctuation">(</span>phrase<span class="token punctuation">:</span> str<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>
   <span class="token triple-quoted-string string">"""A dummy wrapper around print."""</span>
   <span class="token comment" spellcheck="true"># for demonstration purposes, you can imagine that there is some</span>
   <span class="token comment" spellcheck="true"># valuable and reusable logic inside this function</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Echo the input arguments to standard output"""</span>
    phrase <span class="token operator">=</span> shlex<span class="token punctuation">.</span>join<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    echo<span class="token punctuation">(</span>phrase<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># next section explains the use of sys.exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note that if the module didn’t encapsulate code inside the <code>main</code> function but instead put it directly within the <code>if __name__ == '__main__'</code> block, the <code>phrase</code> variable would be global to the entire module. This is error-prone as other functions within the module could be unintentionally using the global variable instead of a local name. A <code>main</code> function solves this problem.</p>
<p>Using a <code>main</code> function has the added benefit of the <code>echo</code> function itself being isolated and importable elsewhere. When <code>echo.py</code> is imported, the <code>echo</code> and <code>main</code> functions will be defined, but neither of them will be called, because <code>__name__ != '__main__'</code>.</p>
<h4 id="Packaging-Considerations"><a href="#Packaging-Considerations" class="headerlink" title="Packaging Considerations"></a>Packaging Considerations</h4><p><code>main</code> functions are often used to create command-line tools by specifying them as entry points for console scripts. When this is done, pip inserts the function call into a template script, where the return value of <code>main</code> is passed into <code>sys.exit()</code>. For example:</p>
<pre><code>sys.exit(main())</code></pre><p>Since the call to <code>main</code> is wrapped in <code>sys.exit()</code>, the expectation is that your function will return some value acceptable as an input to <code>sys.exit()</code>; typically, an integer or <code>None</code> (which is implicitly returned if your function does not have a return statement).</p>
<p>By proactively following this convention ourselves, our module will have the same behavior when run directly (i.e. <code>python3 echo.py</code>) as it will have if we later package it as a console script entry-point in a pip-installable package.</p>
<p>In particular, be careful about returning strings from your <code>main</code> function. <code>sys.exit()</code> will interpret a string argument as a failure message, so your program will have an exit code of <code>1</code>, indicating failure, and the string will be written to <code>sys.stderr</code>. The <code>echo.py</code> example from earlier exemplifies using the <code>sys.exit(main())</code> convention.</p>
<p>参见</p>
<p>Python Packaging User Guide contains a collection of tutorials and references on how to distribute and install Python packages with modern tools.</p>
<h3 id="main-py-in-Python-Packages"><a href="#main-py-in-Python-Packages" class="headerlink" title="__main__.py in Python Packages"></a><code>__main__.py</code> in Python Packages</h3><p>If you are not familiar with Python packages, see section 包 of the tutorial. Most commonly, the <code>__main__.py</code> file is used to provide a command-line interface for a package. Consider the following hypothetical package, “bandclass”:</p>
<pre><code>bandclass
  ├── __init__.py
  ├── __main__.py
  └── student.py</code></pre><p><code>__main__.py</code> will be executed when the package itself is invoked directly from the command line using the <code>-m</code> flag. For example:</p>
<pre><code>$ python3 -m bandclass</code></pre><p>This command will cause <code>__main__.py</code> to run. How you utilize this mechanism will depend on the nature of the package you are writing, but in this hypothetical case, it might make sense to allow the teacher to search for students:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># bandclass/__main__.py</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> <span class="token punctuation">.</span>student <span class="token keyword">import</span> search_students
student_name <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">if</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token string">''</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Found student: {search_students(student_name)}'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note that <code>from .student import search_students</code> is an example of a relative import. This import style must be used when referencing modules within a package. For more details, see 子包参考 in the 模块 section of the tutorial.</p>
<h4 id="Idiomatic-Usage-1"><a href="#Idiomatic-Usage-1" class="headerlink" title="Idiomatic Usage"></a>Idiomatic Usage</h4><p>The contents of <code>__main__.py</code> typically isn’t fenced with <code>if __name__ == '__main__'</code> blocks. Instead, those files are kept short, functions to execute from other modules. Those other modules can then be easily unit-tested and are properly reusable.</p>
<p>If used, an <code>if __name__ == '__main__'</code> block will still work as expected for a <code>__main__.py</code> file within a package, because its <code>__name__</code> attribute will include the package’s path if imported:</p>
<pre><code>&gt;&gt;&gt; import asyncio.__main__
&gt;&gt;&gt; asyncio.__main__.__name__
'asyncio.__main__'</code></pre><p>This won’t work for <code>__main__.py</code> files in the root directory of a .zip file though. Hence, for consistency, minimal <code>__main__.py</code> like the <code>venv</code> one mentioned above are preferred.</p>
<p>参见</p>
<p>See <code>venv</code> for an example of a package with a minimal <code>__main__.py</code> in the standard library. It doesn’t contain a <code>if __name__ == '__main__'</code> block. You can invoke it with <code>python3 -m venv [directory]</code>.</p>
<p>See <code>runpy</code> for more details on the <code>-m</code> flag to the interpreter executable.</p>
<p>See <code>zipapp</code> for how to run applications packaged as <em>.zip</em> files. In this case Python looks for a <code>__main__.py</code> file in the root directory of the archive.</p>
<h3 id="import-main"><a href="#import-main" class="headerlink" title="import __main__"></a><code>import __main__</code></h3><p>Regardless of which module a Python program was started with, other modules running within that same program can import the top-level environment’s scope (namespace) by importing the <code>__main__</code> module. This doesn’t import a <code>__main__.py</code> file but rather whichever module that received the special name <code>'__main__'</code>.</p>
<p>Here is an example module that consumes the <code>__main__</code> namespace:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># namely.py</span>
<span class="token keyword">import</span> __main__
<span class="token keyword">def</span> <span class="token function">did_user_define_their_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'my_name'</span> <span class="token keyword">in</span> dir<span class="token punctuation">(</span>__main__<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">print_user_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> did_user_define_their_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'Define the variable `my_name`!'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'__file__'</span> <span class="token keyword">in</span> dir<span class="token punctuation">(</span>__main__<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>__main__<span class="token punctuation">.</span>my_name<span class="token punctuation">,</span> <span class="token string">"found in file"</span><span class="token punctuation">,</span> __main__<span class="token punctuation">.</span>__file__<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>__main__<span class="token punctuation">.</span>my_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Example usage of this module could be as follows:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># start.py</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> namely <span class="token keyword">import</span> print_user_name
<span class="token comment" spellcheck="true"># my_name = "Dinsdale"</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        print_user_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> ve<span class="token punctuation">:</span>
        <span class="token keyword">return</span> str<span class="token punctuation">(</span>ve<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Now, if we started our program, the result would look like this:</p>
<pre><code>$ python3 start.py
Define the variable `my_name`!</code></pre><p>The exit code of the program would be 1, indicating an error. Uncommenting the line with <code>my_name = "Dinsdale"</code> fixes the program and now it exits with status code 0, indicating success:</p>
<pre><code>$ python3 start.py
Dinsdale found in file /path/to/start.py</code></pre><p>Note that importing <code>__main__</code> doesn’t cause any issues with unintentionally running top-level code meant for script use which is put in the <code>if __name__ == "__main__"</code> block of the <code>start</code> module. Why does this work?</p>
<p>Python inserts an empty <code>__main__</code> module in <code>sys.modules</code> at interpreter startup, and populates it by running top-level code. In our example this is the <code>start</code> module which runs line by line and imports <code>namely</code>. In turn, <code>namely</code> imports <code>__main__</code> (which is really <code>start</code>). That’s an import cycle! Fortunately, since the partially populated <code>__main__</code> module is present in <code>sys.modules</code>, Python passes that to <code>namely</code>. See Special considerations for <strong>main</strong> in the import system’s reference for details on how this works.</p>
<p>The Python REPL is another example of a “top-level environment”, so anything defined in the REPL becomes part of the <code>__main__</code> scope:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> namely
<span class="token operator">>></span><span class="token operator">></span> namely<span class="token punctuation">.</span>did_user_define_their_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> namely<span class="token punctuation">.</span>print_user_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ValueError<span class="token punctuation">:</span> Define the variable `my_name`!
<span class="token operator">>></span><span class="token operator">></span> my_name <span class="token operator">=</span> <span class="token string">'Jabberwocky'</span>
<span class="token operator">>></span><span class="token operator">></span> namely<span class="token punctuation">.</span>did_user_define_their_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> namely<span class="token punctuation">.</span>print_user_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
Jabberwocky<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note that in this case the <code>__main__</code> scope doesn’t contain a <code>__file__</code> attribute as it’s interactive.</p>
<p>The <code>__main__</code> scope is used in the implementation of <code>pdb</code> and <code>rlcompleter</code>.</p>
<h2 id="warnings-——-警告信息的控制"><a href="#warnings-——-警告信息的控制" class="headerlink" title="warnings —— 警告信息的控制"></a><code>warnings</code> —— 警告信息的控制</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/warnings.py" target="_blank" rel="noopener">Lib/warnings.py</a></p>
<hr>
<p>通常以下情况会引发警告：提醒用户注意程序中的某些情况，而这些情况（通常）还不值得触发异常并终止程序。例如，当程序用到了某个过时的模块时，就可能需要发出一条警告。</p>
<p>Python 程序员可调用本模块中定义的 <code>warn()</code> 函数来发布警告。（C 语言程序员则用 <code>PyErr_WarnEx()</code>  ）。</p>
<p>警告信息通常会写入 <code>sys.stderr</code> ，但可以灵活改变，从忽略所有警告到变成异常都可以。警告的处理方式可以依据 警告类型 、警告信息的文本和发出警告的源位置而进行变化。同一源位置重复出现的警告通常会被抑制。</p>
<p>控制警告信息有两个阶段：首先，每次引发警告时，决定信息是否要发出；然后，如果要发出信息，就用可由用户设置的钩子进行格式化并打印输出。</p>
<p>警告过滤器 控制着是否发出警告信息，也即一系列的匹配规则和动作。调用 <code>filterwarnings()</code> 可将规则加入过滤器，调用 <code>resetwarnings()</code> 则可重置为默认状态。</p>
<p>警告信息的打印输出是通过调用 <code>showwarning()</code> 完成的，该函数可被重写；默认的实现代码是调用 <code>formatwarning()</code> 进行格式化，自己编写的代码也可以调用此格式化函数。</p>
<p>参见</p>
<p>利用 <code>logging.captureWarnings()</code> 可以采用标准的日志架构处理所有警告。</p>
<h3 id="警告类别"><a href="#警告类别" class="headerlink" title="警告类别"></a>警告类别</h3><p>警告的类别由一些内置的异常表示。这种分类有助于对警告信息进行分组过滤。</p>
<p>虽然在技术上警告类别属于 内置异常，但也只是在此记录一下而已，因为在概念上他们属于警告机制的一部分。</p>
<p>通过对某个标准的警告类别进行派生，用户代码可以定义其他的警告类别。 警告类别必须是 <code>Warning</code> 类的子类。</p>
<p>目前已定义了以下警告类别的类：</p>
<table>
<thead>
<tr>
<th align="left">类</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Warning</code></td>
<td align="left">这是所有警告类别的基类。它是 <code>Exception</code> 的子类。</td>
</tr>
<tr>
<td align="left"><code>UserWarning</code></td>
<td align="left">The default category for <code>warn()</code>.</td>
</tr>
<tr>
<td align="left"><code>DeprecationWarning</code></td>
<td align="left">已废弃特性警告的基类，这些警告是为其他 Python 开发者准备的（默认会忽略，除非在 <code>**main**</code> 中用代码触发）。</td>
</tr>
<tr>
<td align="left"><code>SyntaxWarning</code></td>
<td align="left">用于警告可疑语法的基类。</td>
</tr>
<tr>
<td align="left"><code>RuntimeWarning</code></td>
<td align="left">用于警告可疑运行时特性的基类。</td>
</tr>
<tr>
<td align="left"><code>FutureWarning</code></td>
<td align="left">用于警告已废弃特性的基类，这些警告是为 Python 应用程序的最终用户准备的。</td>
</tr>
<tr>
<td align="left"><code>PendingDeprecationWarning</code></td>
<td align="left">用于警告即将废弃功能的基类（默认忽略）。</td>
</tr>
<tr>
<td align="left"><code>ImportWarning</code></td>
<td align="left">导入模块时触发的警告的基类（默认忽略）。</td>
</tr>
<tr>
<td align="left"><code>UnicodeWarning</code></td>
<td align="left">用于 Unicode 相关警告的基类。</td>
</tr>
<tr>
<td align="left"><code>BytesWarning</code></td>
<td align="left"><code>bytes</code> 和 <code>bytearray</code> 相关警告的基类。</td>
</tr>
<tr>
<td align="left"><code>ResourceWarning</code></td>
<td align="left">资源利用相关警告的基类。</td>
</tr>
</tbody></table>
<p>在 3.7 版更改: 以前 <code>DeprecationWarning</code> 和 <code>FutureWarning</code> 是根据某个功能是否完全删除或改变其行为来区分的。现在是根据受众和默认警告过滤器的处理方式来区分的。</p>
<h3 id="警告过滤器"><a href="#警告过滤器" class="headerlink" title="警告过滤器"></a>警告过滤器</h3><p>警告过滤器控制着警告是否被忽略、显示或转为错误（触发异常）。</p>
<p>从概念上讲，警告过滤器维护着一个经过排序的过滤器类别列表；任何具体的警告都会依次与列表中的每种过滤器进行匹配，直到找到一个匹配项；过滤器决定了匹配项的处理方式。每个列表项均为 ( <em>action</em> , <em>message</em> , <em>category</em> , <em>module</em> , <em>lineno</em> ) 格式的元组，其中：</p>
<ul>
<li><p><em>action</em> 是以下字符串之一：</p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">处置</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>“default”</code></td>
<td align="left">为发出警告的每个位置（模块+行号）打印第一个匹配警告</td>
</tr>
<tr>
<td align="left"><code>“error”</code></td>
<td align="left">将匹配警告转换为异常</td>
</tr>
<tr>
<td align="left"><code>“ignore”</code></td>
<td align="left">从不打印匹配的警告</td>
</tr>
<tr>
<td align="left"><code>“always”</code></td>
<td align="left">总是打印匹配的警告</td>
</tr>
<tr>
<td align="left"><code>“module”</code></td>
<td align="left">为发出警告的每个模块打印第一次匹配警告（无论行号如何）</td>
</tr>
<tr>
<td align="left"><code>“once”</code></td>
<td align="left">无论位置如何，仅打印第一次出现的匹配警告</td>
</tr>
</tbody></table>
</li>
<li><p><em>message</em> 是包含正则表达式的字符串，警告信息的开头必须与之匹配。该表达式编译时不区分大小写。</p>
</li>
<li><p><em>category</em> 是警告类别的类（<code>Warning</code> 的子类），警告类别必须是其子类，才能匹配。</p>
</li>
<li><p><em>module</em> 是个字符串，包含了模块名称必须匹配的正则表达式。该表达式编译时大小写敏感。</p>
</li>
<li><p><em>lineno</em> 是个整数，发生警告的行号必须与之匹配，或为 <code>0</code> 表示与所有行号匹配。</p>
</li>
</ul>
<p>由于 <code>Warning</code> 类是由内置类 <code>Exception</code> 派生出来的，要把某个警告变成错误，只要触发<code>category(message)</code> 即可。</p>
<p>如果警告不匹配所有已注册的过滤器，那就会应用 “default” 动作（正如其名）。</p>
<h4 id="警告过滤器的介绍"><a href="#警告过滤器的介绍" class="headerlink" title="警告过滤器的介绍"></a>警告过滤器的介绍</h4><p>警告过滤器由传给 Python 解释器的命令行 <code>-W</code> 选项和 <code>PYTHONWARNINGS</code> 环境变量初始化。解释器在 <code>sys.warningoptions</code> 中保存了所有给出的参数，但不作解释；<code>warnings</code> 模块在第一次导入时会解析这些参数（无效的选项被忽略，并会先向 <code>sys.stderr</code> 打印一条信息）。</p>
<p>每个警告过滤器的设定格式为冒号分隔的字段序列：</p>
<pre><code>action:message:category:module:line</code></pre><p>这些字段的含义在 警告过滤器 中描述。当一行中列出多个过滤器时（如 <code>PYTHONWARNINGS</code>），过滤器间用逗号隔开，后面的优先于前面的（因为是从左到右应用的，最近应用的过滤器优先于前面的）。</p>
<p>常用的警告过滤器适用于所有的警告、特定类别的警告、由特定模块和包引发的警告。下面是一些例子：</p>
<pre><code>default                      # Show all warnings (even those ignored by default)
ignore                       # Ignore all warnings
error                        # Convert all warnings to errors
error::ResourceWarning       # Treat ResourceWarning messages as errors
default::DeprecationWarning  # Show DeprecationWarning messages
ignore,default:::mymodule    # Only report warnings triggered by "mymodule"
error:::mymodule[.*]         # Convert warnings to errors in "mymodule"
                             # and any subpackages of "mymodule"</code></pre><h4 id="默认警告过滤器"><a href="#默认警告过滤器" class="headerlink" title="默认警告过滤器"></a>默认警告过滤器</h4><p>Python 默认安装了几个警告过滤器，可以通过 <code>-W</code> 命令行参数、 <code>PYTHONWARNINGS</code> 环境变量及调用 <code>filterwarnings()</code> 进行覆盖。</p>
<p>在常规发布的版本中，默认的警告过滤器包括（按优先顺序排列）：</p>
<pre><code>default::DeprecationWarning:__main__
ignore::DeprecationWarning
ignore::PendingDeprecationWarning
ignore::ImportWarning
ignore::ResourceWarning</code></pre><p>在 调试版本 中，默认警告过滤器的列表是空的。</p>
<p>在 3.2 版更改: 除了 <code>PendingDeprecationWarning</code> 之外，<code>DeprecationWarning</code> 现在默认会被忽略。</p>
<p>在 3.7 版更改: <code>DeprecationWarning</code> 在被 <code>__main__</code> 中的代码直接触发时，默认会再次显示。</p>
<p>在 3.7 版更改: 如果指定两次 <code>-b</code>，则 <code>BytesWarning</code> 不再出现在默认的过滤器列表中，而是通过 <code>sys.warningoptions</code> 进行配置。</p>
<h4 id="重写默认的过滤器"><a href="#重写默认的过滤器" class="headerlink" title="重写默认的过滤器"></a>重写默认的过滤器</h4><p>Python 应用程序的开发人员可能希望在默认情况下向用户隐藏 <em>所有</em> Python级别的警告，而只在运行测试或其他调试时显示这些警告。用于向解释器传递过滤器配置的 <code>sys.warningoptions</code> 属性可以作为一个标记，表示是否应该禁用警告：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">if</span> <span class="token operator">not</span> sys<span class="token punctuation">.</span>warnoptions<span class="token punctuation">:</span>
    <span class="token keyword">import</span> warnings
    warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>建议 Python 代码测试的开发者使用如下代码，以确保被测代码默认显示 <em>所有</em> 警告：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">if</span> <span class="token operator">not</span> sys<span class="token punctuation">.</span>warnoptions<span class="token punctuation">:</span>
    <span class="token keyword">import</span> os<span class="token punctuation">,</span> warnings
    warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Change the filter in this process</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"PYTHONWARNINGS"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"default"</span> <span class="token comment" spellcheck="true"># Also affect subprocesses</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后，建议在 <code>__main__</code> 以外的命名空间运行用户代码的交互式开发者，请确保 <code>DeprecationWarning</code> 在默认情况下是可见的，可采用如下代码（这里 <code>user_ns</code> 是用于执行交互式输入代码的模块）：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span> category<span class="token operator">=</span>DeprecationWarning<span class="token punctuation">,</span>
                                   module<span class="token operator">=</span>user_ns<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"__name__"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="暂时禁止警告"><a href="#暂时禁止警告" class="headerlink" title="暂时禁止警告"></a>暂时禁止警告</h3><p>如果明知正在使用会引起警告的代码，比如某个废弃函数，但不想看到警告（即便警告已经通过命令行作了显式配置），那么可以使用 <code>catch_warnings</code> 上下文管理器来抑制警告。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> warnings
<span class="token keyword">def</span> <span class="token function">fxn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    warnings<span class="token punctuation">.</span>warn<span class="token punctuation">(</span><span class="token string">"deprecated"</span><span class="token punctuation">,</span> DeprecationWarning<span class="token punctuation">)</span>
<span class="token keyword">with</span> warnings<span class="token punctuation">.</span>catch_warnings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>
    fxn<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在上下文管理器中，所有的警告将被简单地忽略。这样就能使用已知的过时代码而又不必看到警告，同时也不会限制警告其他可能不知过时的代码。注意：只能保证在单线程应用程序中生效。如果两个以上的线程同时使用 <code>catch_warnings</code> 上下文管理器，行为不可预知。</p>
<h3 id="测试警告"><a href="#测试警告" class="headerlink" title="测试警告"></a>测试警告</h3><p>要测试由代码引发的警告，请采用 <code>catch_warnings</code> 上下文管理器。有了它，就可以临时改变警告过滤器以方便测试。例如，以下代码可捕获所有的警告以便查看：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> warnings
<span class="token keyword">def</span> <span class="token function">fxn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    warnings<span class="token punctuation">.</span>warn<span class="token punctuation">(</span><span class="token string">"deprecated"</span><span class="token punctuation">,</span> DeprecationWarning<span class="token punctuation">)</span>
<span class="token keyword">with</span> warnings<span class="token punctuation">.</span>catch_warnings<span class="token punctuation">(</span>record<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token keyword">as</span> w<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Cause all warnings to always be triggered.</span>
    warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"always"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Trigger a warning.</span>
    fxn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Verify some things</span>
    <span class="token keyword">assert</span> len<span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
    <span class="token keyword">assert</span> issubclass<span class="token punctuation">(</span>w<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>category<span class="token punctuation">,</span> DeprecationWarning<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token string">"deprecated"</span> <span class="token keyword">in</span> str<span class="token punctuation">(</span>w<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以用 <code>error</code> 取代 <code>always</code> ，让所有的警告都成为异常。需要注意的是，如果某条警告已经因为 <code>once</code> / <code>default</code> 规则而被引发，那么无论设置什么过滤器，该条警告都不会再出现，除非该警告有关的注册数据被清除。</p>
<p>一旦上下文管理器退出，警告过滤器将恢复到刚进此上下文时的状态。这样在多次测试时可防止意外改变警告过滤器，从而导致不确定的测试结果。模块中的 <code>showwarning()</code> 函数也被恢复到初始值。注意：这只能在单线程应用程序中得到保证。如果两个以上的线程同时使用 <code>catch_warnings</code> 上下文管理器，行为未定义。</p>
<p>当测试多项操作会引发同类警告时，重点是要确保每次操作都会触发新的警告（比如，将警告设置为异常并检查操作是否触发异常，检查每次操作后警告列表的长度是否有增加，否则就在每次新操作前将以前的警告列表项删除）。</p>
<h3 id="为新版本的依赖关系更新代码"><a href="#为新版本的依赖关系更新代码" class="headerlink" title="为新版本的依赖关系更新代码"></a>为新版本的依赖关系更新代码</h3><p>在默认情况下，主要针对 Python 开发者（而不是 Python 应用程序的最终用户）的警告类别，会被忽略。</p>
<p>值得注意的是，这个“默认忽略”的列表包含 <code>DeprecationWarning</code> （适用于每个模块，除了 <code>__main__</code>），这意味着开发人员应该确保在测试代码时应将通常忽略的警告显示出来，以便未来破坏性 API 变化时及时收到通知（无论是在标准库还是第三方包）。</p>
<p>理想情况下，代码会有一个合适的测试套件，在运行测试时会隐含地启用所有警告（由 <code>unittest</code> 模块提供的测试运行程序就是如此）。</p>
<p>在不太理想的情况下，可以通过向 Python 解释器传入 <code>-Wd</code> (这是 <code>-W default</code> 的简写) 或设置环境变量 <code>PYTHONWARNINGS=default</code> 来检查应用程序是否用到了已弃用的接口。 这样可以启用对所有警告的默认处理操作，包括那些默认忽略的警告。 要改变遇到警告后执行的动作，可以改变传给 <code>-W</code> 的参数 (例如 <code>-W error</code>)。 </p>
<h3 id="可用的函数"><a href="#可用的函数" class="headerlink" title="可用的函数"></a>可用的函数</h3><p><code>warnings.warn</code>(<em>message</em>, <em>category=None</em>, <em>stacklevel=1</em>, <em>source=None</em>)</p>
<p>引发警告、忽略或者触发异常。 如果给出 <em>category</em> 参数，则必须是 警告类别类 ；默认为 <code>UserWarning</code>。 或者 <em>message</em> 可为 <code>Warning</code> 的实例，这时 <em>category</em> 将被忽略，转而采用 <code>message.__class__</code>。 在这种情况下，错误信息文本将是 <code>str(message)</code>。 如果某条警告被 警告过滤器 改成了错误，本函数将触发一条异常。 参数 <em>stacklevel</em> 可供 Python 包装函数使用，比如:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">deprecation</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    warnings<span class="token punctuation">.</span>warn<span class="token punctuation">(</span>message<span class="token punctuation">,</span> DeprecationWarning<span class="token punctuation">,</span> stacklevel<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这会让警告指向 <code>deprecation()</code> 的调用者，而不是 <code>deprecation()</code> 本身的来源（因为后者会破坏引发警告的目的）。</p>
<p><em>source</em> 是发出 <code>ResourceWarning</code> 的被销毁对象。</p>
<p>在 3.6 版更改: 加入 <em>source</em> 参数。</p>
<p><code>warnings.warn_explicit</code>(<em>message</em>, <em>category</em>, <em>filename</em>, <em>lineno</em>, <em>module=None</em>, <em>registry=None</em>, <em>module_globals=None</em>, <em>source=None</em>)</p>
<p>这是 <code>warn()</code> 函数的底层接口，显式传入消息、类别、文件名和行号，以及可选的模块名和注册表（应为模块的 <code>__warningregistry__</code> 字典）。 模块名称默认为去除了 <code>.py</code> 的文件名；如果未传递注册表，警告就不会被抑制。 <em>message</em> 必须是个字符串，<em>category</em> 是 <code>Warning</code> 的子类；或者<em>message</em> 可为 <code>Warning</code> 的实例，且 <em>category</em> 将被忽略。</p>
<p><em>module_globals</em> 应为发出警告的代码所用的全局命名空间。（该参数用于从 zip 文件或其他非文件系统导入模块时显式源码）。</p>
<p><em>source</em> 是发出 <code>ResourceWarning</code> 的被销毁对象。</p>
<p>在 3.6 版更改: 加入 <em>source</em> 参数。</p>
<p><code>warnings.showwarning</code>(<em>message</em>, <em>category</em>, <em>filename</em>, <em>lineno</em>, <em>file=None</em>, <em>line=None</em>)</p>
<p>将警告信息写入文件。默认的实现代码是调用<code>formatwarning(message, category, filename, lineno, line)</code> 并将结果字符串写入 <em>file</em> ，默认文件为 <code>sys.stderr</code>。通过将任何可调用对象赋给 <code>warnings.showwarning</code> 可替换掉该函数。<em>line</em> 是要包含在警告信息中的一行源代码；如果未提供 <em>line<em>，<code>showwarning()</code> 将尝试读取由</em>filename</em> 和 <em>lineno</em> 指定的行。</p>
<p><code>warnings.formatwarning</code>(<em>message</em>, <em>category</em>, <em>filename</em>, <em>lineno</em>, <em>line=None</em>)</p>
<p>以标准方式格式化一条警告信息。将返回一个字符串，可能包含内嵌的换行符，并以换行符结束。如果未提供 <em>line*，<code>formatwarning()</code> 将尝试读取由 *filename</em> 和 <em>lineno</em> 指定的行。</p>
<p><code>warnings.filterwarnings</code>(<em>action</em>, <em>message=’’</em>, <em>category=Warning</em>, <em>module=’’</em>, <em>lineno=0</em>, <em>append=False</em>)</p>
<p>在 警告过滤器种类 列表中插入一条数据项。默认情况下，该数据项将被插到前面；如果 <em>append</em> 为 True，则会插到后面。这里会检查参数的类型，编译 <em>message</em> 和 <em>module</em> 正则表达式，并将他们作为一个元组插入警告过滤器的列表中。如果两者都与某种警告匹配，那么靠近列表前面的数据项就会覆盖后面的项。省略的参数默认匹配任意值。</p>
<p><code>warnings.simplefilter</code>(<em>action</em>, <em>category=Warning</em>, <em>lineno=0</em>, <em>append=False</em>)</p>
<p>在 警告过滤器种类 列表中插入一条简单数据项。函数参数的含义与 <code>filterwarnings()</code> 相同，但不需要正则表达式，因为插入的过滤器总是匹配任何模块中的任何信息，只要类别和行号匹配即可。</p>
<p><code>warnings.resetwarnings</code>()</p>
<p>重置警告过滤器。这将丢弃之前对 <code>filterwarnings()</code> 的所有调用，包括 <code>-W</code> 命令行选项和对 <code>simplefilter()</code> 的调用效果。</p>
<h3 id="可用的上下文管理器"><a href="#可用的上下文管理器" class="headerlink" title="可用的上下文管理器"></a>可用的上下文管理器</h3><p><em>class</em> <code>warnings.catch_warnings</code>(<em>**,</em> record=False<em>,</em> module=None*)</p>
<p>该上下文管理器会复制警告过滤器和 <code>showwarning()</code> 函数，并在退出时恢复。 如果 <em>record</em> 参数是 <code>False</code> (默认)，则在进入时会返回 <code>None</code>。 如果 <em>record</em> 为 <code>True</code>，则返回一个列表，列表由自定义 <code>showwarning()</code> 函数所用对象逐步填充（该函数还会抑制 <code>sys.stdout</code> 的输出）。 列表中每个对象的属性与 <code>showwarning()</code> 的参数名称相同。</p>
<p><em>module</em> 参数代表一个模块，当导入 <code>warnings</code> 时，将被用于代替返回的模块，其过滤器将被保护。该参数主要是为了测试 <code>warnings</code> 模块自身。</p>
<p>注解</p>
<p><code>catch_warnings</code> 管理器的工作方式，是替换并随后恢复模块的 <code>showwarning()</code> 函数和内部的过滤器种类列表。这意味着上下文管理器将会修改全局状态，因此不是线程安全的。</p>
<h2 id="dataclasses-—-数据类"><a href="#dataclasses-—-数据类" class="headerlink" title="dataclasses —- 数据类"></a><code>dataclasses</code> —- 数据类</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/dataclasses.py" target="_blank" rel="noopener">Lib/dataclasses.py</a></p>
<hr>
<p>这个模块提供了一个装饰器和一些函数，用于自动添加生成的 special method，例如 <code>__init__()</code> 和 <code>__repr__()</code> 到用户定义的类。 它最初描述于 <a href="https://www.python.org/dev/peps/pep-0557" target="_blank" rel="noopener"><strong>PEP 557</strong></a> 。</p>
<p>在这些生成的方法中使用的成员变量是使用 <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a> 类型标注来定义的。 例如以下代码:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass
@dataclass
<span class="token keyword">class</span> <span class="token class-name">InventoryItem</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Class for keeping track of an item in inventory."""</span>
    name<span class="token punctuation">:</span> str
    unit_price<span class="token punctuation">:</span> float
    quantity_on_hand<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">total_cost</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> float<span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>unit_price <span class="token operator">*</span> self<span class="token punctuation">.</span>quantity_on_hand<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将在添加的内容中包括如下所示的 <code>__init__()</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> str<span class="token punctuation">,</span> unit_price<span class="token punctuation">:</span> float<span class="token punctuation">,</span> quantity_on_hand<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    self<span class="token punctuation">.</span>unit_price <span class="token operator">=</span> unit_price
    self<span class="token punctuation">.</span>quantity_on_hand <span class="token operator">=</span> quantity_on_hand<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>请注意，此方法会自动添加到类中：它不会在上面显示的 <code>InventoryItem</code> 定义中直接指定。</p>
<p>3.7 新版功能.</p>
<h3 id="模块内容-1"><a href="#模块内容-1" class="headerlink" title="模块内容"></a>模块内容</h3><p><code>@``dataclasses.dataclass</code>(<em>**,</em> init=True<em>,</em> repr=True<em>,</em> eq=True<em>,</em> order=False<em>,</em> unsafe_hash=False<em>,</em> frozen=False<em>,</em> match_args=True<em>,</em> kw_only=False<em>,</em> slots=False*)</p>
<p>这个函数是 decorator ，用于将生成的 special method 添加到类中，如下所述。</p>
<p><code>dataclass()</code> 装饰器会检查类以查找 <code>field</code>。 <code>field</code> 被定义为具有 类型标注 的类变量。 除了下面描述的两个例外，在 <code>dataclass()</code> 中没有什么东西会去检查在变量标注中所指定的类型。</p>
<p>所有生成的方法中的字段顺序是它们在类定义中出现的顺序。</p>
<p><code>dataclass()</code> 装饰器将向类中添加各种“dunder”方法，如下所述。 如果所添加的方法已存在于类中，则行为将取决于下面所列出的参数。 装饰器会返回调用它的类本身；不会创建新的类。</p>
<p>如果 <code>dataclass()</code> 仅用作没有参数的简单装饰器，它就像它具有此签名中记录的默认值一样。也就是说，这三种 <code>dataclass()</code> 用法是等价的:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
@dataclass<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
@dataclass<span class="token punctuation">(</span>init<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> repr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> eq<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> order<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> unsafe_hash<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> frozen<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> match_args<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> kw_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> slots<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>dataclass()</code> 的参数有：</p>
<ul>
<li><p><code>init</code>: 如果为真值（默认），将生成一个 <code>__init__()</code> 方法。</p>
<p>如果类已定义 <code>__init__()</code> ，则忽略此参数。</p>
</li>
<li><p><code>repr</code> ：如果为真值（默认），将生成一个 <code>__repr__()</code> 方法。 生成的 repr 字符串将具有类名以及每个字段的名称和 repr ，按照它们在类中定义的顺序。不包括标记为从 repr 中排除的字段。 例如：<code>InventoryItem(name='widget', unit_price=3.0, quantity_on_hand=10)</code>。</p>
<p>如果类已定义 <code>__repr__()</code> ，则忽略此参数。</p>
</li>
<li><p><code>eq</code> ：如果为true（默认值），将生成 <code>__eq__()</code> 方法。此方法将类作为其字段的元组按顺序比较。比较中的两个实例必须是相同的类型。</p>
<p>如果类已定义 <code>__eq__()</code> ，则忽略此参数。</p>
</li>
<li><p><code>order</code> ：如果为真值（默认为 <code>False</code> ），则 <code>__lt__()</code> 、 <code>__le__()</code> 、 <code>__gt__()</code> 和 <code>__ge__()</code> 方法将生成。 这将类作为其字段的元组按顺序比较。比较中的两个实例必须是相同的类型。如果 <code>order</code> 为真值并且 <code>eq</code> 为假值 ，则引发 <code>ValueError</code> 。</p>
<p>如果类已经定义了 <code>__lt__()</code> 、 <code>__le__()</code> 、 <code>__gt__()</code> 或者 <code>__ge__()</code> 中的任意一个，将引发 <code>TypeError</code> 。</p>
</li>
<li><p><code>unsafe_hash</code> ：如果为 <code>False</code> （默认值），则根据 <code>eq</code> 和 <code>frozen</code> 的设置方式生成 <code>__hash__()</code> 方法。</p>
<p><code>__hash__()</code> 由内置的 <code>hash()</code> 使用，当对象被添加到散列集合（如字典和集合）时。有一个 <code>__hash__()</code> 意味着类的实例是不可变的。可变性是一个复杂的属性，取决于程序员的意图， <code>__eq__()</code> 的存在性和行为，以及 <code>dataclass()</code> 装饰器中 <code>eq</code> 和 <code>frozen</code> 标志的值。</p>
<p>默认情况下， <code>dataclass()</code> 不会隐式添加 <code>__hash__()</code> 方法，除非这样做是安全的。 它也不会添加或更改现有的明确定义的 <code>__hash__()</code> 方法。 设置类属性 <code>__hash__ = None</code> 对 Python 具有特定含义，如 <code>__hash__()</code> 文档中所述。</p>
<p>如果 <code>__hash__()</code> 没有显式定义，或者它被设为 <code>None</code>，则 <code>dataclass()</code> <em>可能</em> 会添加一个隐式 <code>__hash__()</code> 方法。 虽然并不推荐，但你可以用 <code>unsafe_hash=True</code> 来强制 <code>dataclass()</code> 创建一个 <code>__hash__()</code> 方法。 如果你的类在逻辑上不可变但却仍然可被修改那么可能就是这种情况。 这是一个特殊用例并且应当被仔细地考虑。</p>
<p>以下是隐式创建 <code>__hash__()</code> 方法的规则。请注意，你不能在数据类中都使用显式的 <code>__hash__()</code> 方法并设置 <code>unsafe_hash=True</code> ；这将导致 <code>TypeError</code> 。</p>
<p>如果 <code>eq</code> 和 <code>frozen</code> 都是 true，默认情况下 <code>dataclass()</code> 将为你生成一个 <code>__hash__()</code> 方法。如果 <code>eq</code> 为 true 且 <code>frozen</code> 为 false ，则 <code>__hash__()</code> 将被设置为 <code>None</code> ，标记它不可用（因为它是可变的）。如果 <code>eq</code> 为 false ，则 <code>__hash__()</code> 将保持不变，这意味着将使用超类的 <code>__hash__()</code> 方法（如果超类是 <code>object</code> ，这意味着它将回到基于id的hash）。</p>
</li>
<li><p><code>frozen</code>: 如为真值 (默认值为 <code>False</code>)，则对字段赋值将会产生异常。 这模拟了只读的冻结实例。 如果在类中定义了 <code>__setattr__()</code> 或 <code>__delattr__()</code> 则将会引发 <code>TypeError</code>。 参见下文的讨论。</p>
</li>
<li><p><code>match_args</code>: 如果为真值 (默认值为 <code>True</code>)，则将根据传给生成的 <code>__init__()</code> 方法的形参列表来创建 <code>__match_args__</code> 元组 (即使没有生成 <code>__init__()</code> 也会创建，见上文)。 如果为假值，或者如果 <code>__match_args__</code> 已在类中定义，则将不生成 <code>__match_args__</code>。</p>
</li>
</ul>
<blockquote>
<p>3.10 新版功能.</p>
</blockquote>
<ul>
<li><code>kw_only</code>: 如果为真值 (默认值为 <code>False</code>)，则所有字段都将被标记为仅限关键字。 如果一个字段被标记为仅限关键字，则其唯一的影响是根据仅限关键字的字段生成的 <code>__init__()</code> 形参必须使用调用 <code>__init__()</code> 时传入的关键字来指定。 对于 dataclass 的任何其它方面都没有影响。</li>
</ul>
<blockquote>
<p>3.10 新版功能.</p>
</blockquote>
<ul>
<li><code>slots</code>: 如果为真值 (默认值为 <code>False</code>)，则将生成 <code>__slots__</code> 属性并将返回一个新类而非原来的类。 如果 <code>__slots__</code> 已在类中定义，则会引发 <code>TypeError</code>。</li>
</ul>
<blockquote>
<p>3.10 新版功能.</p>
</blockquote>
<p><code>field</code>s 可以选择使用普通的 Python 语法指定默认值:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    a<span class="token punctuation">:</span> int       <span class="token comment" spellcheck="true"># 'a' has no default value</span>
    b<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment" spellcheck="true"># assign a default value for 'b'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在这个例子中， <code>a</code> 和 <code>b</code> 都将包含在添加的 <code>__init__()</code> 方法中，它们将被定义为:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">:</span> int<span class="token punctuation">,</span> b<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果具有默认值的字段之后存在没有默认值的字段，将会引发 <code>TypeError</code>。 无论此情况是发生在单个类中还是作为类继承的结果，都是如此。</p>
<p><code>dataclasses.field</code>(<em>**,</em> default=MISSING<em>,</em> default_factory=MISSING<em>,</em> init=True<em>,</em> repr=True<em>,</em> hash=None<em>,</em> compare=True<em>,</em> metadata=None<em>,</em> kw_only=MISSING*)</p>
<p>对于常见和简单的用例，不需要其他功能。但是，有些数据类功能需要额外的每字段信息。为了满足这种对附加信息的需求，你可以通过调用提供的 <code>field()</code> 函数来替换默认字段值。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    mylist<span class="token punctuation">:</span> list<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>list<span class="token punctuation">)</span>
c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>mylist <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>As shown above, the <code>MISSING</code> value is a sentinel object used to detect if some parameters are provided by the user. This sentinel is used because <code>None</code> is a valid value for some parameters with a distinct meaning. No code should directly use the <code>MISSING</code> value.</p>
<p><code>field()</code> 参数有：</p>
<ul>
<li><p><code>default</code> ：如果提供，这将是该字段的默认值。这是必需的，因为 <code>field()</code> 调用本身会替换一般的默认值。</p>
</li>
<li><p><code>default_factory</code> ：如果提供，它必须是一个零参数可调用对象，当该字段需要一个默认值时，它将被调用。除了其他目的之外，这可以用于指定具有可变默认值的字段，如下所述。 同时指定 <code>default</code> 和 <code>default_factory</code> 将产生错误。</p>
</li>
<li><p><code>init</code> ：如果为true（默认值），则该字段作为参数包含在生成的 <code>__init__()</code> 方法中。</p>
</li>
<li><p><code>repr</code> ：如果为true（默认值），则该字段包含在生成的 <code>__repr__()</code> 方法返回的字符串中。</p>
</li>
<li><p><code>hash</code> ：这可以是布尔值或 <code>None</code> 。如果为true，则此字段包含在生成的 <code>__hash__()</code> 方法中。如果为 <code>None</code> （默认值），请使用 <code>compare</code> 的值，这通常是预期的行为。如果字段用于比较，则应在 hash 中考虑该字段。不鼓励将此值设置为 <code>None</code> 以外的任何值。</p>
<p>设置 <code>hash=False</code> 但 <code>compare=True</code> 的一个可能原因是，如果一个计算 hash 的代价很高的字段是检验等价性需要的，但还有其他字段可以计算类型的 hash 。 即使从 hash 中排除某个字段，它仍将用于比较。</p>
</li>
<li><p><code>compare</code> ：如果为true（默认值），则该字段包含在生成的相等性和比较方法中（ <code>__eq__()</code> ， <code>__gt__()</code> 等等）。</p>
</li>
<li><p><code>metadata</code> ：这可以是映射或 None 。 None 被视为一个空的字典。这个值包含在 <code>MappingProxyType()</code> 中，使其成为只读，并暴露在 <code>Field</code> 对象上。数据类根本不使用它，它是作为第三方扩展机制提供的。多个第三方可以各自拥有自己的键值，以用作元数据中的命名空间。</p>
</li>
<li><p><code>kw_only</code>: 如果为真值，则此字段将被标记为仅限关键字。 这将在当计算出所生成的 <code>__init__()</code> 方法的形参时被使用。</p>
</li>
</ul>
<blockquote>
<p>3.10 新版功能.</p>
</blockquote>
<p>如果通过调用 <code>field()</code> 指定字段的默认值，则该字段的类属性将替换为指定的 <code>default</code> 值。如果没有提供 <code>default</code> ，那么将删除类属性。目的是在 <code>dataclass()</code> 装饰器运行之后，类属性将包含字段的默认值，就像指定了默认值一样。例如，之后:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> int
    y<span class="token punctuation">:</span> int <span class="token operator">=</span> field<span class="token punctuation">(</span>repr<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    z<span class="token punctuation">:</span> int <span class="token operator">=</span> field<span class="token punctuation">(</span>repr<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    t<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>类属性 <code>C.z</code> 将是 <code>10</code> ，类属性 <code>C.t</code> 将是 <code>20</code>，类属性 <code>C.x</code> 和 <code>C.y</code> 将不设置。</p>
<p><em>class</em> <code>dataclasses.Field</code></p>
<p><code>Field</code> 对象描述每个定义的字段。这些对象在内部创建，并由 <code>fields()</code> 模块级方法返回（见下文）。用户永远不应该直接实例化 <code>Field</code> 对象。 其有文档的属性是：</p>
<blockquote>
<ul>
<li><code>name</code> ：字段的名字。</li>
<li><code>type</code> ：字段的类型。</li>
<li><code>default</code>, <code>default_factory</code>, <code>init</code>, <code>repr</code>, <code>hash</code>, <code>compare</code>, <code>metadata</code> 和 <code>kw_only</code> 具有与 <code>field()</code> 函数中对应参数相同的含义和值。</li>
</ul>
</blockquote>
<p>可能存在其他属性，但它们是私有的，不能被审查或依赖。</p>
<p><code>dataclasses.fields</code>(<em>class_or_instance</em>)</p>
<p>返回 <code>Field</code> 对象的元组，用于定义此数据类的字段。 接受数据类或数据类的实例。如果没有传递一个数据类或实例将引发 <code>TypeError</code> 。 不返回 <code>ClassVar</code> 或 <code>InitVar</code> 的伪字段。</p>
<p><code>dataclasses.asdict</code>(<em>instance</em>, <em>**,</em> dict_factory=dict*)</p>
<p>将数据类 <code>instance</code> 转换为字典（使用工厂函数 <code>dict_factory</code> ）。每个数据类都转换为其字段的字典，如 <code>name: value</code> 对。数据类、字典、列表和元组被递归。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span>
     x<span class="token punctuation">:</span> int
     y<span class="token punctuation">:</span> int
@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
     mylist<span class="token punctuation">:</span> list<span class="token punctuation">[</span>Point<span class="token punctuation">]</span>
p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> asdict<span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span>
c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">[</span>Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> asdict<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'mylist'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>引发 <code>TypeError</code> 如果 <code>instance</code> 不是数据类实例。</p>
<p><code>dataclasses.astuple</code>(<em>instance</em>, <em>**,</em> tuple_factory=tuple*)</p>
<p>将数据类 <code>instance</code> 转换为元组（通过使用工厂函数 <code>tuple_factory</code> ）。每个数据类都转换为其字段值的元组。数据类、字典、列表和元组被递归。</p>
<p>继续前一个例子:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">assert</span> astuple<span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> astuple<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>引发 <code>TypeError</code> 如果 <code>instance</code> 不是数据类实例。</p>
<p><code>dataclasses.make_dataclass</code>(<em>cls_name</em>, <em>fields</em>, <em>**,</em> bases=()<em>,</em> namespace=None<em>,</em> init=True<em>,</em> repr=True<em>,</em> eq=True<em>,</em> order=False<em>,</em> unsafe_hash=False<em>,</em> frozen=False<em>,</em> match_args=True<em>,</em> kw_only=False<em>,</em> slots=False*)</p>
<p>新建一个名为 <code>cls_name</code> 的数据库，其字段在 <code>fields</code> 中定义，基类在 <code>bases</code> 中给出，并使用在 <code>namespace</code> 中给出的命名空间进行初始化。 <code>fields</code> 是一个可迭代对象，其中的每个元素均为 <code>name</code>, <code>(name, type)</code> 或 <code>(name, type, Field)</code>。 如果只提供了 <code>name</code>，则 <code>typing.Any</code> 会被用作 <code>type</code>。 <code>init</code>, <code>repr</code>, <code>eq</code>, <code>order</code>, <code>unsafe_hash</code>, <code>frozen</code>, <code>match_args</code>, <code>kw_only</code> 和 <code>slots</code> 等值与它们在 <code>dataclass()</code> 中的含义相同。</p>
<p>此函数不是严格要求的，因为用于任何创建带有 <code>__annotations__</code> 的新类的 Python 机制都可以应用 <code>dataclass()</code> 函数将该类转换为数据类。提供此功能是为了方便。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">C <span class="token operator">=</span> make_dataclass<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span>
                   <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> int<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token string">'y'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">'z'</span><span class="token punctuation">,</span> int<span class="token punctuation">,</span> field<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   namespace<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'add_one'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> self<span class="token punctuation">:</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>等价于</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> int
    y<span class="token punctuation">:</span> <span class="token string">'typing.Any'</span>
    z<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">def</span> <span class="token function">add_one</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>dataclasses.replace</code>(<em>instance</em>, <em>/</em>, <em>**changes</em>)</p>
<p>创建一个与 <code>instance</code> 的类型相同的新对象，用来自 <code>changes</code> 的值替换各个字段。 如果 <code>instance</code> 不是数据类，则会引发 <code>TypeError</code>。 如果 <code>changes</code> 中的值没有指定字段，则会引发 <code>TypeError</code>。</p>
<p>新返回的对象通过调用数据类的 <code>__init__()</code> 方法创建。这确保了如果存在 <code>__post_init__()</code> ，其也被调用。</p>
<p>如果存在没有默认值的仅初始化变量，必须在调用 <code>replace()</code> 时指定，以便它们可以传递给 <code>__init__()</code> 和 <code>__post_init__()</code> 。</p>
<p><code>changes</code> 包含任何定义为 <code>init=False</code> 的字段是错误的。在这种情况下会引发 <code>ValueError</code> 。</p>
<p>提前提醒 <code>init=False</code> 字段在调用 <code>replace()</code> 时的工作方式。如果它们完全被初始化的话，它们不是从源对象复制的，而是在 <code>__post_init__()</code> 中初始化。估计 <code>init=False</code> 字段很少能被正确地使用。如果使用它们，那么使用备用类构造函数或者可能是处理实例复制的自定义 <code>replace()</code> （或类似命名的）方法可能是明智的。</p>
<p><code>dataclasses.is_dataclass</code>(<em>class_or_instance</em>)</p>
<p>如果其形参为 dataclass 或其实例则返回 <code>True</code>，否则返回 <code>False</code>。</p>
<p>如果你需要知道一个类是否是一个数据类的实例（而不是一个数据类本身），那么再添加一个 <code>not isinstance(obj, type)</code> 检查:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">is_dataclass_instance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> is_dataclass<span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>dataclasses.MISSING</code></p>
<p>一个表示缺失 default 或 default_factory 的监视值。</p>
<pre><code>dataclasses.KW_ONLY</code></pre><p>一个用作类型标注的监视值。 任何在伪字段之后的类型为 <code>KW_ONLY</code> 的字段会被标记为仅限关键字字段。 请注意在其他情况下 <code>KW_ONLY</code> 类型的伪字段会被完全忽略。 这包括此类字段的名称。 根据惯例，名称 <code>_</code> 会被用作 <code>KW_ONLY</code> 字段。 仅限关键字字段指明当类被实例化时 <code>__init__()</code> 形参必须以关键字形式来指定。</p>
<p>在这个例子中，字段 <code>y</code> 和 <code>z</code> 将被标记为仅限关键字字段:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span>
  x<span class="token punctuation">:</span> float
  _<span class="token punctuation">:</span> KW_ONLY
  y<span class="token punctuation">:</span> float
  z<span class="token punctuation">:</span> float
p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在单个数据类中，指定一个以上 <code>KW_ONLY</code> 类型的字段将导致错误。</p>
<p><em>exception</em> <code>dataclasses.FrozenInstanceError</code></p>
<p>在使用 <code>frozen=True</code> 定义的数据类上调用隐式定义的 <code>__setattr__()</code> 或 <code>__delattr__()</code> 时引发。 这是 <code>AttributeError</code> 的一个子类。</p>
<h3 id="初始化后处理"><a href="#初始化后处理" class="headerlink" title="初始化后处理"></a>初始化后处理</h3><p>生成的 <code>__init__()</code> 代码将调用一个名为 <code>__post_init__()</code> 的方法，如果在类上已经定义了 <code>__post_init__()</code> 。它通常被称为 <code>self.__post_init__()</code> 。但是，如果定义了任何 <code>InitVar</code> 字段，它们也将按照它们在类中定义的顺序传递给 <code>__post_init__()</code> 。 如果没有 <code>__init__()</code> 方法生成，那么 <code>__post_init__()</code> 将不会被自动调用。</p>
<p>在其他用途中，这允许初始化依赖于一个或多个其他字段的字段值。例如:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    a<span class="token punctuation">:</span> float
    b<span class="token punctuation">:</span> float
    c<span class="token punctuation">:</span> float <span class="token operator">=</span> field<span class="token punctuation">(</span>init<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>c <span class="token operator">=</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由 <code>dataclass()</code> 所生成的 <code>__init__()</code> 方法不会调用基类的 <code>__init__()</code> 方法。 如果基类有需要被调用的 <code>__init__()</code> 方法，通常是在 <code>__post_init__()</code> 方法中调用此方法:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">Rectangle</span><span class="token punctuation">:</span>
    height<span class="token punctuation">:</span> float
    width<span class="token punctuation">:</span> float
@dataclass
<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">(</span>Rectangle<span class="token punctuation">)</span><span class="token punctuation">:</span>
    side<span class="token punctuation">:</span> float
    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">.</span>side<span class="token punctuation">,</span> self<span class="token punctuation">.</span>side<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是请注意，一般来说 dataclass 生成的 <code>__init__()</code> 方法不需要被调用，因为派生的 dataclass 将负责初始化任何自身为 dataclass 的基类的所有字段。</p>
<p>有关将参数传递给 <code>__post_init__()</code> 的方法，请参阅下面有关仅初始化变量的段落。</p>
<h3 id="类变量"><a href="#类变量" class="headerlink" title="类变量"></a>类变量</h3><p>两个地方 <code>dataclass()</code> 实际检查字段类型的之一是确定字段是否是如 <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a> 所定义的类变量。它通过检查字段的类型是否为 <code>typing.ClassVar</code> 来完成此操作。如果一个字段是一个 <code>ClassVar</code> ，它将被排除在考虑范围之外，并被数据类机制忽略。这样的 <code>ClassVar</code> 伪字段不会由模块级的 <code>fields()</code> 函数返回。</p>
<h3 id="仅初始化变量"><a href="#仅初始化变量" class="headerlink" title="仅初始化变量"></a>仅初始化变量</h3><p>另一个 <code>dataclass()</code> 检查类型注解地方是为了确定一个字段是否是一个仅初始化变量。它通过查看字段的类型是否为 <code>dataclasses.InitVar</code> 类型来实现。如果一个字段是一个 <code>InitVar</code> ，它被认为是一个称为仅初始化字段的伪字段。因为它不是一个真正的字段，所以它不会被模块级的 <code>fields()</code> 函数返回。仅初始化字段作为参数添加到生成的 <code>__init__()</code> 方法中，并传递给可选的 <code>__post_init__()</code> 方法。数据类不会使用它们。</p>
<p>例如，假设一个字段将从数据库初始化，如果在创建类时未提供其值:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    i<span class="token punctuation">:</span> int
    j<span class="token punctuation">:</span> int <span class="token operator">=</span> None
    database<span class="token punctuation">:</span> InitVar<span class="token punctuation">[</span>DatabaseType<span class="token punctuation">]</span> <span class="token operator">=</span> None
    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>j <span class="token keyword">is</span> None <span class="token operator">and</span> database <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>j <span class="token operator">=</span> database<span class="token punctuation">.</span>lookup<span class="token punctuation">(</span><span class="token string">'j'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> database<span class="token operator">=</span>my_database<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在这种情况下， <code>fields()</code> 将返回 <code>i</code> 和 <code>j</code> 的 <code>Field</code> 对象，但不包括 <code>database</code> 。</p>
<h3 id="冻结的实例"><a href="#冻结的实例" class="headerlink" title="冻结的实例"></a>冻结的实例</h3><p>无法创建真正不可变的 Python 对象。但是，通过将 <code>frozen=True</code> 传递给 <code>dataclass()</code> 装饰器，你可以模拟不变性。在这种情况下，数据类将向类添加 <code>__setattr__()</code> 和 <code>__delattr__()</code> 方法。 些方法在调用时会引发 <code>FrozenInstanceError</code> 。</p>
<p>使用 <code>frozen=True</code> 时会有很小的性能损失： <code>__ init__()</code> 不能使用简单的赋值来初始化字段，并必须使用 <code>object.__setattr__()</code>。</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>当数组由 <code>dataclass()</code> 装饰器创建时，它会查看反向 MRO 中的所有类的基类（即从 <code>object</code> 开始 ），并且对于它找到的每个数据类， 将该基类中的字段添加到字段的有序映射中。添加完所有基类字段后，它会将自己的字段添加到有序映射中。所有生成的方法都将使用这种组合的，计算的有序字段映射。由于字段是按插入顺序排列的，因此派生类会重载基类。一个例子:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> Any <span class="token operator">=</span> <span class="token number">15.0</span>
    y<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span>
@dataclass
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    z<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span>
    x<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后的字段列表依次是 <code>x</code> 、 <code>y</code> 、 <code>z</code> 。 <code>x</code> 的最终类型是 <code>int</code> ，如类 <code>C</code> 中所指定的那样。</p>
<p>为 <code>C</code> 生成的 <code>__init__()</code> 方法看起来像:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="init-中仅限关键字字段的重新排序"><a href="#init-中仅限关键字字段的重新排序" class="headerlink" title="__init__() 中仅限关键字字段的重新排序"></a><code>__init__()</code> 中仅限关键字字段的重新排序</h3><p>在计算出 <code>__init__()</code> 所需要的形参之后，任何仅限关键字形参会被移至所有常规（非仅限关键字）形参的后面。 这是This is a requirement of how keyword-only parameters are implemented in Python 中实现仅限关键字形参所要求的：它们必须位于非仅限关键字形参之后。</p>
<p>在这个例子中，<code>Base.y</code>, <code>Base.w</code>, and <code>D.t</code> 是仅限关键字字段，而 <code>Base.x</code> 和 <code>D.z</code> 是常规字段:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> Any <span class="token operator">=</span> <span class="token number">15.0</span>
    _<span class="token punctuation">:</span> KW_ONLY
    y<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span>
    w<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">1</span>
@dataclass
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    z<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span>
    t<span class="token punctuation">:</span> int <span class="token operator">=</span> field<span class="token punctuation">(</span>kw_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为 <code>D</code> 生成的 <code>__init__()</code> 方法看起来像是这样:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> Any <span class="token operator">=</span> <span class="token number">15.0</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请注意形参原来在字段列表中出现的位置已被重新排序：前面是来自常规字段的形参而后面是来自仅限关键字字段的形参。</p>
<p>仅限关键字形参的相对顺序会在重新排序的 <code>__init__()</code> 形参列表中保持原样。</p>
<h3 id="默认工厂函数"><a href="#默认工厂函数" class="headerlink" title="默认工厂函数"></a>默认工厂函数</h3><blockquote>
<p>如果一个 <code>field()</code> 指定了一个 <code>default_factory</code> ，当需要该字段的默认值时，将使用零参数调用它。例如，要创建列表的新实例，请使用:</p>
<pre class="line-numbers language-python"><code class="language-python">mylist<span class="token punctuation">:</span> list <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>list<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果一个字段被排除在 <code>__init__()</code> 之外（使用 <code>init=False</code> ）并且字段也指定 <code>default_factory</code> ，则默认的工厂函数将始终从生成的 <code>__init__()</code> 函数调用。发生这种情况是因为没有其他方法可以为字段提供初始值。</p>
</blockquote>
<h3 id="可变的默认值"><a href="#可变的默认值" class="headerlink" title="可变的默认值"></a>可变的默认值</h3><blockquote>
<p>Python 在类属性中存储默认成员变量值。思考这个例子，不使用数据类:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>element<span class="token punctuation">)</span>
o1 <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>
o2 <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>
o1<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
o2<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> o1<span class="token punctuation">.</span>x <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">assert</span> o1<span class="token punctuation">.</span>x <span class="token keyword">is</span> o2<span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>请注意，类 <code>C</code> 的两个实例共享相同的类变量 <code>x</code> ，如预期的那样。</p>
<p>使用数据类， <em>如果</em> 此代码有效:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> List <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">+=</span> element<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>它生成的代码类似于:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">D</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">+=</span> element
<span class="token keyword">assert</span> D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token keyword">is</span> D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这与使用 <code>C</code> 类的原始示例具有相同的问题。 也就是说，当在创建类实例的时候 <code>D</code> 类的两个实例没有为 <code>x</code> 指定值则将共享同一个 <code>x</code> 的副本。 因为数据类只是使用普通的 Python 类创建方式所以它们也会共享此行为。 数据类没有任何通用方式来检测这种情况。 相反地，<code>dataclass()</code> 装饰器在检测到类型为 <code>list</code>, <code>dict</code> 或 <code>set</code> 的默认形参时将会引发 <code>TypeError</code>。 这是一个部分解决方案，但它确实能防止许多常见错误。</p>
<p>使用默认工厂函数是一种创建可变类型新实例的方法，并将其作为字段的默认值:</p>
<pre class="line-numbers language-python"><code class="language-python">@dataclass
<span class="token keyword">class</span> <span class="token class-name">D</span><span class="token punctuation">:</span>
    x<span class="token punctuation">:</span> list <span class="token operator">=</span> field<span class="token punctuation">(</span>default_factory<span class="token operator">=</span>list<span class="token punctuation">)</span>
<span class="token keyword">assert</span> D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token keyword">is</span> <span class="token operator">not</span> D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="contextlib-—-为-with语句上下文提供的工具"><a href="#contextlib-—-为-with语句上下文提供的工具" class="headerlink" title="contextlib —- 为 with语句上下文提供的工具"></a><code>contextlib</code> —- 为 <code>with</code>语句上下文提供的工具</h2><p><strong>源代码</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/contextlib.py" target="_blank" rel="noopener">Lib/contextlib.py</a></p>
<hr>
<p>此模块为涉及 <code>with</code> 语句的常见任务提供了实用的工具。</p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>提供的函数和类：</p>
<p><em>class</em> <code>contextlib.AbstractContextManager</code></p>
<p>一个为实现了 <code>object.__aenter__()</code> 与 <code>object.__aexit__()</code> 的类提供的 abstract base class。 为 <code>object.__aenter__()</code> 提供的一个默认实现是返回 <code>self</code> 而 <code>object.__aexit__()</code> 是一个默认返回 <code>None</code> 的抽象方法。 </p>
<p>3.6 新版功能.</p>
<p><em>class</em> <code>contextlib.AbstractAsyncContextManager</code></p>
<p>一个为实现了 <code>object.__aenter__()</code> 与 <code>object.__aexit__()</code> 的类提供的 abstract base class。 为 <code>object.__aenter__()</code> 提供的一个默认实现是返回 <code>self</code> 而 <code>object.__aexit__()</code> 是一个默认返回 <code>None</code> 的抽象方法。 </p>
<p>3.7 新版功能.</p>
<pre><code>@``contextlib.contextmanager</code></pre><p>这个函数是一个 decorator ，它可以定义一个支持 <code>with</code> 语句上下文管理器的工厂函数， 而不需要创建一个类或区 <code>__enter__()</code> 与 <code>__exit__()</code> 方法。</p>
<p>尽管许多对象原生支持使用 with 语句，但有些需要被管理的资源并不是上下文管理器，并且没有实现 <code>close()</code> 方法而不能使用 <code>contextlib.closing</code> 。</p>
<p>下面是一个抽象的示例，展示如何确保正确的资源管理:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager
@contextmanager
<span class="token keyword">def</span> <span class="token function">managed_resource</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Code to acquire resource, e.g.:</span>
    resource <span class="token operator">=</span> acquire_resource<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> resource
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Code to release resource, e.g.:</span>
        release_resource<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> managed_resource<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">)</span> <span class="token keyword">as</span> resource<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token comment" spellcheck="true"># Resource is released at the end of this block,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token comment" spellcheck="true"># even if code in the block raises an exception</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>被装饰的函数在被调用时，必须返回一个 generator 迭代器。 这个迭代器必须只 yield 一个值出来，这个值会被用在 <code>with</code> 语句中，绑定到 <code>as</code> 后面的变量，如果给定了的话。</p>
<p>当生成器发生 yield 时，嵌套在 <code>with</code> 语句中的语句体会被执行。 语句体执行完毕离开之后，该生成器将被恢复执行。 如果在该语句体中发生了未处理的异常，则该异常会在生成器发生 yield 时重新被引发。 因此，你可以使用 <code>try</code>…<code>except</code>…<code>finally</code> 语句来捕获该异常（如果有的话），或确保进行了一些清理。 如果仅出于记录日志或执行某些操作（而非完全抑制异常）的目的捕获了异常，生成器必须重新引发该异常。 否则生成器的上下文管理器将向 <code>with</code> 语句指示该异常已经被处理，程序将立即在 <code>with</code> 语句之后恢复并继续执行。</p>
<p><code>contextmanager()</code> 使用 <code>ContextDecorator</code> 因此它创建的上下文管理器不仅可以用在 <code>with</code> 语句中，还可以用作一个装饰器。当它用作一个装饰器时，每一次函数调用时都会隐式创建一个新的生成器实例（这使得 <code>contextmanager()</code> 创建的上下文管理器满足了支持多次调用以用作装饰器的需求，而非“一次性”的上下文管理器）。</p>
<p>在 3.2 版更改: <code>ContextDecorator</code> 的使用。</p>
<pre><code>@``contextlib.asynccontextmanager</code></pre><blockquote>
<p>与 <code>contextmanager()</code> 类似，但创建的是 asynchronous context manager 。</p>
<p>这个函数是一个 decorator ，它可以定义一个支持 <code>async with</code> 语句的异步上下文管理器的工厂函数， 而不需要创建一个类或区分 <code>__aenter__()</code> 与 <code>__aexit__()</code> 方法。它必须被作用在一个 asynchronous generator 函数上</p>
<p>一个简单的示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> asynccontextmanager
@asynccontextmanager
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> <span class="token keyword">await</span> acquire_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> conn
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> release_db_connection<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_all_users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> get_connection<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
        <span class="token keyword">return</span> conn<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'SELECT ...'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.7 新版功能.</p>
<p>Context managers defined with <code>asynccontextmanager()</code> can be used either as decorators or with <code>async with</code> statements:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">timeit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    now <span class="token operator">=</span> time<span class="token punctuation">.</span>monotonic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'it took {time.monotonic() - now}s to run'</span><span class="token punctuation">)</span>
 @timeit<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment" spellcheck="true"># ... async code ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>When used as a decorator, a new generator instance is implicitly created on each function call. This allows the otherwise “one-shot” context managers created by <code>asynccontextmanager()</code> to meet the requirement that context managers support multiple invocations in order to be used as decorators.</p>
</blockquote>
<p>在 3.10 版更改: Async context managers created with <code>asynccontextmanager()</code> can be used as decorators.</p>
<p><code>contextlib.closing</code>(<em>thing</em>)</p>
<p>返回一个在语句块执行完成时关闭 <em>things</em> 的上下文管理器。这基本上等价于：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager
@contextmanager
<span class="token keyword">def</span> <span class="token function">closing</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> thing
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        thing<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>并允许你编写这样的代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> urlopen
<span class="token keyword">with</span> closing<span class="token punctuation">(</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> page<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> page<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>而无需显式地关闭 <code>page</code> 。 即使发生错误，在退出 <code>with</code> 语句块时， <code>page.close()</code> 也同样会被调用。</p>
<p><em>class</em> <code>contextlib.aclosing</code>(<em>thing</em>)</p>
<p>Return an async context manager that calls the <code>aclose()</code> method of <em>thing</em> upon completion of the block. This is basically equivalent to:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> asynccontextmanager
@asynccontextmanager
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">aclosing</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> thing
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> thing<span class="token punctuation">.</span>aclose<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Significantly, <code>aclosing()</code> supports deterministic cleanup of async generators when they happen to exit early by <code>break</code> or an exception. For example:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> aclosing
<span class="token keyword">async</span> <span class="token keyword">with</span> aclosing<span class="token punctuation">(</span>my_generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> values<span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">:</span>
        <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token number">42</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This pattern ensures that the generator’s async exit code is executed in the same context as its iterations (so that exceptions and context variables work as expected, and the exit code isn’t run after the lifetime of some task it depends on).</p>
<p>3.10 新版功能.</p>
<p><code>contextlib.nullcontext</code>(<em>enter_result=None</em>)</p>
<p>返回一个从 <code>__enter__</code> 返回 <em>enter_result</em> 的上下文管理器，除此之外不执行任何操作。它旨在用于可选上下文管理器的一种替代，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">myfunction</span><span class="token punctuation">(</span>arg<span class="token punctuation">,</span> ignore_exceptions<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> ignore_exceptions<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Use suppress to ignore all exceptions.</span>
        cm <span class="token operator">=</span> contextlib<span class="token punctuation">.</span>suppress<span class="token punctuation">(</span>Exception<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Do not ignore any exceptions, cm has no effect.</span>
        cm <span class="token operator">=</span> contextlib<span class="token punctuation">.</span>nullcontext<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> cm<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Do something</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一个使用 <em>enter_result</em> 的例子：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">process_file</span><span class="token punctuation">(</span>file_or_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>file_or_path<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># If string, open file</span>
        cm <span class="token operator">=</span> open<span class="token punctuation">(</span>file_or_path<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Caller is responsible for closing file</span>
        cm <span class="token operator">=</span> nullcontext<span class="token punctuation">(</span>file_or_path<span class="token punctuation">)</span>
    <span class="token keyword">with</span> cm <span class="token keyword">as</span> file<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Perform processing on the file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>It can also be used as a stand-in for asynchronous context managers:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">send_http</span><span class="token punctuation">(</span>session<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> <span class="token operator">not</span> session<span class="token punctuation">:</span>
       <span class="token comment" spellcheck="true"># If no http session, create it with aiohttp</span>
       cm <span class="token operator">=</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
       <span class="token comment" spellcheck="true"># Caller is responsible for closing the session</span>
       cm <span class="token operator">=</span> nullcontext<span class="token punctuation">(</span>session<span class="token punctuation">)</span>
   <span class="token keyword">async</span> <span class="token keyword">with</span> cm <span class="token keyword">as</span> session<span class="token punctuation">:</span>
       <span class="token comment" spellcheck="true"># Send http requests with session</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.7 新版功能.</p>
<p>在 3.10 版更改: asynchronous context manager support was added.</p>
<p><code>contextlib.suppress</code>(<em>\</em>exceptions*)</p>
<p>Return a context manager that suppresses any of the specified exceptions if they occur in the body of a <code>with</code> statement and then resumes execution with the first statement following the end of the <code>with</code> statement.</p>
<p>与完全抑制异常的任何其他机制一样，该上下文管理器应当只用来抑制非常具体的错误，并确保该场景下静默地继续执行程序是通用的正确做法。</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> suppress
<span class="token keyword">with</span> suppress<span class="token punctuation">(</span>FileNotFoundError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'somefile.tmp'</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> suppress<span class="token punctuation">(</span>FileNotFoundError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'someotherfile.tmp'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这段代码等价于：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'somefile.tmp'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'someotherfile.tmp'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该上下文管理器是 reentrant 。</p>
<p>3.4 新版功能.</p>
<p><code>contextlib.redirect_stdout</code>(<em>new_target</em>)</p>
<p>用于将 <code>sys.stdout</code> 临时重定向到一个文件或类文件对象的上下文管理器。</p>
<p>该工具给已有的将输出硬编码写到 stdout 的函数或类提供了额外的灵活性。</p>
<p>For example, the output of <code>help()</code> normally is sent to <em>sys.stdout</em>. You can capture that output in a string by redirecting the output to an <code>io.StringIO</code> object. The replacement stream is returned from the <code>__enter__</code> method and so is available as the target of the <code>with</code> statement:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> redirect_stdout<span class="token punctuation">(</span>io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    help<span class="token punctuation">(</span>pow<span class="token punctuation">)</span>
s <span class="token operator">=</span> f<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果要把 <code>help()</code> 的输出写到磁盘上的一个文件，重定向该输出到一个常规文件：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'help.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">with</span> redirect_stdout<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        help<span class="token punctuation">(</span>pow<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果要把 <code>help()</code> 的输出写到 <em>sys.stderr</em> ：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> redirect_stdout<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    help<span class="token punctuation">(</span>pow<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>需要注意的点在于， <code>sys.stdout</code> 的全局副作用意味着此上下文管理器不适合在库代码和大多数多线程应用程序中使用。它对子进程的输出没有影响。不过对于许多工具脚本而言，它仍然是一个有用的方法。</p>
<p>该上下文管理器是 reentrant 。</p>
<p>3.4 新版功能.</p>
<p><code>contextlib.redirect_stderr</code>(<em>new_target</em>)</p>
<p>与 <code>redirect_stdout()</code> 类似，不过是将 <code>sys.stderr</code> 重定向到一个文件或类文件对象。</p>
<p>该上下文管理器是 reentrant 。</p>
<p>3.5 新版功能.</p>
<p><em>class</em> <code>contextlib.ContextDecorator</code></p>
<p>一个使上下文管理器能用作装饰器的基类。</p>
<p>与往常一样，继承自 <code>ContextDecorator</code> 的上下文管理器必须实现 <code>__enter__</code> 与 <code>__exit__</code> 。即使用作装饰器， <code>__exit__</code> 依旧会保持可能的异常处理。</p>
<p><code>ContextDecorator</code> 被用在 <code>contextmanager()</code> 中，因此你自然获得了这项功能。</p>
<p><code>ContextDecorator</code> 的示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ContextDecorator
<span class="token keyword">class</span> <span class="token class-name">mycontext</span><span class="token punctuation">(</span>ContextDecorator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Starting'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>exc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Finishing'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> @mycontext<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">def</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The bit in the middle'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> function<span class="token punctuation">(</span><span class="token punctuation">)</span>
Starting
The bit <span class="token keyword">in</span> the middle
Finishing
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> mycontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The bit in the middle'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Starting
The bit <span class="token keyword">in</span> the middle
Finishing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个改动只是针对如下形式的一个语法糖：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> cm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Do stuff</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>ContextDecorator</code> 使得你可以这样改写：</p>
<pre class="line-numbers language-python"><code class="language-python">@cm<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Do stuff</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这能清楚地表明， <code>cm</code> 作用于整个函数，而不仅仅是函数的一部分（同时也能保持不错的缩进层级）。</p>
<p>现有的上下文管理器即使已经有基类，也可以使用 <code>ContextDecorator</code> 作为混合类进行扩展：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ContextDecorator
<span class="token keyword">class</span> <span class="token class-name">mycontext</span><span class="token punctuation">(</span>ContextBaseClass<span class="token punctuation">,</span> ContextDecorator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>exc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p>由于被装饰的函数必须能够被多次调用，因此对应的上下文管理器必须支持在多个 <code>with</code> 语句中使用。如果不是这样，则应当使用原来的具有显式 <code>with</code> 语句的形式使用该上下文管理器。</p>
<p>3.2 新版功能.</p>
<p><em>class</em> <code>contextlib.AsyncContextDecorator</code></p>
<p>Similar to <code>ContextDecorator</code> but only for asynchronous functions.</p>
<p>Example of <code>AsyncContextDecorator</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> asyncio <span class="token keyword">import</span> run
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> AsyncContextDecorator
<span class="token keyword">class</span> <span class="token class-name">mycontext</span><span class="token punctuation">(</span>AsyncContextDecorator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aenter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Starting'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aexit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>exc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Finishing'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> @mycontext<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The bit in the middle'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> run<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Starting
The bit <span class="token keyword">in</span> the middle
Finishing
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">async</span> <span class="token keyword">with</span> mycontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The bit in the middle'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> run<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Starting
The bit <span class="token keyword">in</span> the middle
Finishing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.10 新版功能.</p>
<p><em>class</em> <code>contextlib.ExitStack</code></p>
<p>该上下文管理器的设计目标是使得在编码中组合其他上下文管理器和清理函数更加容易，尤其是那些可选的或由输入数据驱动的上下文管理器。</p>
<p>例如，通过一个如下的 with 语句可以很容易处理一组文件：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span>stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span>open<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> fname <span class="token keyword">in</span> filenames<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># All opened files will automatically be closed at the end of</span>
    <span class="token comment" spellcheck="true"># the with statement, even if attempts to open files later</span>
    <span class="token comment" spellcheck="true"># in the list raise an exception</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>每个实例维护一个注册了一组回调的栈，这些回调在实例关闭时以相反的顺序被调用（显式或隐式地在 <code>with</code> 语句的末尾）。请注意，当一个栈实例被垃圾回收时，这些回调将 <em>不会</em> 被隐式调用。</p>
<p>通过使用这个基于栈的模型，那些通过 <code>__init__</code> 方法获取资源的上下文管理器（如文件对象）能够被正确处理。</p>
<p>由于注册的回调函数是按照与注册相反的顺序调用的，因此最终的行为就像多个嵌套的 <code>with</code> 语句用在这些注册的回调函数上。这个行为甚至扩展到了异常处理：如果内部的回调函数抑制或替换了异常，则外部回调收到的参数是基于该更新后的状态得到的。</p>
<p>这是一个相对底层的 API，它负责正确处理栈里回调退出时依次展开的细节。它为相对高层的上下文管理器提供了一个合适的基础，使得它能根据应用程序的需求使用特定方式操作栈。</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>enter_context</code>(<em>cm</em>)</p>
<p>Enters a new context manager and adds its <code>__exit__()</code> method to the callback stack. The return value is the result of the context manager’s own <code>__enter__()</code> method.</p>
<p>These context managers may suppress exceptions just as they normally would if used directly as part of a <code>with</code> statement.</p>
</li>
<li><p><code>push</code>(<em>exit</em>)</p>
<p>Adds a context manager’s <code>__exit__()</code> method to the callback stack.</p>
<p>As <code>__enter__</code> is <em>not</em> invoked, this method can be used to cover part of an <code>__enter__()</code> implementation with a context manager’s own <code>__exit__()</code> method.</p>
<p>If passed an object that is not a context manager, this method assumes it is a callback with the same signature as a context manager’s <code>__exit__()</code> method and adds it directly to the callback stack.</p>
<p>By returning true values, these callbacks can suppress exceptions the same way context manager <code>__exit__()</code> methods can.</p>
<p>The passed in object is returned from the function, allowing this method to be used as a function decorator.</p>
</li>
<li><p><code>callback</code>(<em>callback</em>, <em>/</em>, <em>\</em>args<em>,</em> <em>*kwds</em>)</p>
<p>Accepts an arbitrary callback function and arguments and adds it to the callback stack.</p>
<p>Unlike the other methods, callbacks added this way cannot suppress exceptions (as they are never passed the exception details).</p>
<p>The passed in callback is returned from the function, allowing this method to be used as a function decorator.</p>
</li>
<li><p><code>pop_all</code>()</p>
<p>Transfers the callback stack to a fresh <code>ExitStack</code> instance and returns it. No callbacks are invoked by this operation - instead, they will now be invoked when the new stack is closed (either explicitly or implicitly at the end of a <code>with</code> statement).</p>
<p>For example, a group of files can be opened as an “all or nothing” operation as follows:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span>stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span>open<span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> fname <span class="token keyword">in</span> filenames<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># Hold onto the close method, but don't call it yet.</span>
    close_files <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>close
    <span class="token comment" spellcheck="true"># If opening any file fails, all previously opened files will be</span>
    <span class="token comment" spellcheck="true"># closed automatically. If all files are opened successfully,</span>
    <span class="token comment" spellcheck="true"># they will remain open even after the with statement ends.</span>
    <span class="token comment" spellcheck="true"># close_files() can then be invoked explicitly to close them all.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>close</code>()</p>
<p>Immediately unwinds the callback stack, invoking callbacks in the reverse order of registration. For any context managers and exit callbacks registered, the arguments passed in will indicate that no exception occurred.</p>
</li>
</ul>
<p><em>class</em> <code>contextlib.AsyncExitStack</code></p>
<p>An asynchronous context manager, similar to <code>ExitStack</code>, that supports combining both synchronous and asynchronous context managers, as well as having coroutines for cleanup logic.</p>
<p>The <code>close()</code> method is not implemented, <code>aclose()</code> must be used instead.</p>
<ul>
<li><p><em>coroutine</em> <code>enter_async_context</code>(<em>cm</em>)</p>
<p>Similar to <code>enter_context()</code> but expects an asynchronous context manager.</p>
</li>
<li><p><code>push_async_exit</code>(<em>exit</em>)</p>
<p>Similar to <code>push()</code> but expects either an asynchronous context manager or a coroutine function.</p>
</li>
<li><p><code>push_async_callback</code>(<em>callback</em>, <em>/</em>, <em>\</em>args<em>,</em> <em>*kwds</em>)</p>
<p>Similar to <code>callback()</code> but expects a coroutine function.</p>
</li>
<li><p><em>coroutine</em> <code>aclose</code>()</p>
<p>Similar to <code>close()</code> but properly handles awaitables.</p>
</li>
</ul>
<p>Continuing the example for <code>asynccontextmanager()</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">with</span> AsyncExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    connections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">await</span> stack<span class="token punctuation">.</span>enter_async_context<span class="token punctuation">(</span>get_connection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># All opened connections will automatically be released at the end of</span>
    <span class="token comment" spellcheck="true"># the async with statement, even if attempts to open a connection</span>
    <span class="token comment" spellcheck="true"># later in the list raise an exception.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.7 新版功能.</p>
<h3 id="例子和配方"><a href="#例子和配方" class="headerlink" title="例子和配方"></a>例子和配方</h3><p>This section describes some examples and recipes for making effective use of the tools provided by <code>contextlib</code>.</p>
<h4 id="Supporting-a-variable-number-of-context-managers"><a href="#Supporting-a-variable-number-of-context-managers" class="headerlink" title="Supporting a variable number of context managers"></a>Supporting a variable number of context managers</h4><p>The primary use case for <code>ExitStack</code> is the one given in the class documentation: supporting a variable number of context managers and other cleanup operations in a single <code>with</code> statement. The variability may come from the number of context managers needed being driven by user input (such as opening a user specified collection of files), or from some of the context managers being optional:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    <span class="token keyword">for</span> resource <span class="token keyword">in</span> resources<span class="token punctuation">:</span>
        stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>
    <span class="token keyword">if</span> need_special_resource<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        special <span class="token operator">=</span> acquire_special_resource<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span>release_special_resource<span class="token punctuation">,</span> special<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Perform operations that use the acquired resources</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>As shown, <code>ExitStack</code> also makes it quite easy to use <code>with</code> statements to manage arbitrary resources that don’t natively support the context management protocol.</p>
<h4 id="Catching-exceptions-from-enter-methods"><a href="#Catching-exceptions-from-enter-methods" class="headerlink" title="Catching exceptions from __enter__ methods"></a>Catching exceptions from <code>__enter__</code> methods</h4><p>It is occasionally desirable to catch exceptions from an <code>__enter__</code> method implementation, <em>without</em> inadvertently catching exceptions from the <code>with</code> statement body or the context manager’s <code>__exit__</code> method. By using <code>ExitStack</code> the steps in the context management protocol can be separated slightly in order to allow this:</p>
<pre class="line-numbers language-python"><code class="language-python">stack <span class="token operator">=</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span>cm<span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># handle __enter__ exception</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> stack<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Handle normal case</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Actually needing to do this is likely to indicate that the underlying API should be providing a direct resource management interface for use with <code>try</code>/<code>except</code>/<code>finally</code> statements, but not all APIs are well designed in that regard. When a context manager is the only resource management API provided, then <code>ExitStack</code> can make it easier to handle various situations that can’t be handled directly in a <code>with</code> statement.</p>
<h4 id="Cleaning-up-in-an-enter-implementation"><a href="#Cleaning-up-in-an-enter-implementation" class="headerlink" title="Cleaning up in an __enter__ implementation"></a>Cleaning up in an <code>__enter__</code> implementation</h4><p>As noted in the documentation of <code>ExitStack.push()</code>, this method can be useful in cleaning up an already allocated resource if later steps in the <code>__enter__()</code> implementation fail.</p>
<p>Here’s an example of doing this for a context manager that accepts resource acquisition and release functions, along with an optional validation function, and maps them to the context management protocol:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager<span class="token punctuation">,</span> AbstractContextManager<span class="token punctuation">,</span> ExitStack
<span class="token keyword">class</span> <span class="token class-name">ResourceManager</span><span class="token punctuation">(</span>AbstractContextManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> acquire_resource<span class="token punctuation">,</span> release_resource<span class="token punctuation">,</span> check_resource_ok<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>acquire_resource <span class="token operator">=</span> acquire_resource
        self<span class="token punctuation">.</span>release_resource <span class="token operator">=</span> release_resource
        <span class="token keyword">if</span> check_resource_ok <span class="token keyword">is</span> None<span class="token punctuation">:</span>
            <span class="token keyword">def</span> <span class="token function">check_resource_ok</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>check_resource_ok <span class="token operator">=</span> check_resource_ok
    @contextmanager
    <span class="token keyword">def</span> <span class="token function">_cleanup_on_error</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
            stack<span class="token punctuation">.</span>push<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            <span class="token keyword">yield</span>
            <span class="token comment" spellcheck="true"># The validation check passed and didn't raise an exception</span>
            <span class="token comment" spellcheck="true"># Accordingly, we want to keep the resource, and pass it</span>
            <span class="token comment" spellcheck="true"># back to our caller</span>
            stack<span class="token punctuation">.</span>pop_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        resource <span class="token operator">=</span> self<span class="token punctuation">.</span>acquire_resource<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>_cleanup_on_error<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>check_resource_ok<span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">:</span>
                msg <span class="token operator">=</span> <span class="token string">"Failed validation for {!r}"</span>
                <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>format<span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> resource
    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>exc_details<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># We don't need to duplicate any of our resource release logic</span>
        self<span class="token punctuation">.</span>release_resource<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Replacing-any-use-of-try-finally-and-flag-variables"><a href="#Replacing-any-use-of-try-finally-and-flag-variables" class="headerlink" title="Replacing any use of try-finally and flag variables"></a>Replacing any use of <code>try-finally</code> and flag variables</h4><p>A pattern you will sometimes see is a <code>try-finally</code> statement with a flag variable to indicate whether or not the body of the <code>finally</code> clause should be executed. In its simplest form (that can’t already be handled just by using an <code>except</code> clause instead), it looks something like this:</p>
<pre class="line-numbers language-python"><code class="language-python">cleanup_needed <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> perform_operation<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> result<span class="token punctuation">:</span>
        cleanup_needed <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> cleanup_needed<span class="token punctuation">:</span>
        cleanup_resources<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>As with any <code>try</code> statement based code, this can cause problems for development and review, because the setup code and the cleanup code can end up being separated by arbitrarily long sections of code.</p>
<p><code>ExitStack</code> makes it possible to instead register a callback for execution at the end of a <code>with</code> statement, and then later decide to skip executing that callback:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack
<span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span>cleanup_resources<span class="token punctuation">)</span>
    result <span class="token operator">=</span> perform_operation<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> result<span class="token punctuation">:</span>
        stack<span class="token punctuation">.</span>pop_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This allows the intended cleanup up behaviour to be made explicit up front, rather than requiring a separate flag variable.</p>
<p>If a particular application uses this pattern a lot, it can be simplified even further by means of a small helper class:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack
<span class="token keyword">class</span> <span class="token class-name">Callback</span><span class="token punctuation">(</span>ExitStack<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>callback<span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>pop_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> Callback<span class="token punctuation">(</span>cleanup_resources<span class="token punctuation">)</span> <span class="token keyword">as</span> cb<span class="token punctuation">:</span>
    result <span class="token operator">=</span> perform_operation<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> result<span class="token punctuation">:</span>
        cb<span class="token punctuation">.</span>cancel<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If the resource cleanup isn’t already neatly bundled into a standalone function, then it is still possible to use the decorator form of <code>ExitStack.callback()</code> to declare the resource cleanup in advance:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack
<span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
    @stack<span class="token punctuation">.</span>callback
    <span class="token keyword">def</span> <span class="token function">cleanup_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    result <span class="token operator">=</span> perform_operation<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> result<span class="token punctuation">:</span>
        stack<span class="token punctuation">.</span>pop_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Due to the way the decorator protocol works, a callback function declared this way cannot take any parameters. Instead, any resources to be released must be accessed as closure variables.</p>
<h4 id="Using-a-context-manager-as-a-function-decorator"><a href="#Using-a-context-manager-as-a-function-decorator" class="headerlink" title="Using a context manager as a function decorator"></a>Using a context manager as a function decorator</h4><p><code>ContextDecorator</code> makes it possible to use a context manager in both an ordinary <code>with</code> statement and also as a function decorator.</p>
<p>For example, it is sometimes useful to wrap functions or groups of statements with a logger that can track the time of entry and time of exit. Rather than writing both a function decorator and a context manager for the task, inheriting from <code>ContextDecorator</code> provides both capabilities in a single definition:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ContextDecorator
<span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">track_entry_and_exit</span><span class="token punctuation">(</span>ContextDecorator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Entering: %s'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Exiting: %s'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Instances of this class can be used as both a context manager:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> track_entry_and_exit<span class="token punctuation">(</span><span class="token string">'widget loader'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Some time consuming activity goes here'</span><span class="token punctuation">)</span>
    load_widget<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>And also as a function decorator:</p>
<pre class="line-numbers language-python"><code class="language-python">@track_entry_and_exit<span class="token punctuation">(</span><span class="token string">'widget loader'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">activity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Some time consuming activity goes here'</span><span class="token punctuation">)</span>
    load_widget<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Note that there is one additional limitation when using context managers as function decorators: there’s no way to access the return value of <code>__enter__()</code>. If that value is needed, then it is still necessary to use an explicit <code>with</code> statement.</p>
<p>参见</p>
<p><a href="https://www.python.org/dev/peps/pep-0343" target="_blank" rel="noopener"><strong>PEP 343</strong></a> - “with” 语句</p>
<p>Python <code>with</code> 语句的规范描述、背景和示例。</p>
<h3 id="Single-use-reusable-and-reentrant-context-managers"><a href="#Single-use-reusable-and-reentrant-context-managers" class="headerlink" title="Single use, reusable and reentrant context managers"></a>Single use, reusable and reentrant context managers</h3><p>Most context managers are written in a way that means they can only be used effectively in a <code>with</code> statement once. These single use context managers must be created afresh each time they’re used - attempting to use them a second time will trigger an exception or otherwise not work correctly.</p>
<p>This common limitation means that it is generally advisable to create context managers directly in the header of the <code>with</code> statement where they are used (as shown in all of the usage examples above).</p>
<p>Files are an example of effectively single use context managers, since the first <code>with</code> statement will close the file, preventing any further IO operations using that file object.</p>
<p>Context managers created using <code>contextmanager()</code> are also single use context managers, and will complain about the underlying generator failing to yield if an attempt is made to use them a second time:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager
<span class="token operator">>></span><span class="token operator">></span> @contextmanager
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">def</span> <span class="token function">singleuse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Before"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">yield</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"After"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> cm <span class="token operator">=</span> singleuse<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> cm<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Before
After
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> cm<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
RuntimeError<span class="token punctuation">:</span> generator didn't <span class="token keyword">yield</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Reentrant-context-managers"><a href="#Reentrant-context-managers" class="headerlink" title="Reentrant context managers"></a>Reentrant context managers</h4><p>More sophisticated context managers may be “reentrant”. These context managers can not only be used in multiple <code>with</code> statements, but may also be used <em>inside</em> a <code>with</code> statement that is already using the same context manager.</p>
<p><code>threading.RLock</code> is an example of a reentrant context manager, as are <code>suppress()</code> and <code>redirect_stdout()</code>. Here’s a very simple example of reentrant use:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> contextlib <span class="token keyword">import</span> redirect_stdout
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
<span class="token operator">>></span><span class="token operator">></span> stream <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> write_to_stream <span class="token operator">=</span> redirect_stdout<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> write_to_stream<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This is written to the stream rather than stdout"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">with</span> write_to_stream<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This is also written to the stream"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This is written directly to stdout"</span><span class="token punctuation">)</span>
This <span class="token keyword">is</span> written directly to stdout
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
This <span class="token keyword">is</span> written to the stream rather than stdout
This <span class="token keyword">is</span> also written to the stream<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Real world examples of reentrancy are more likely to involve multiple functions calling each other and hence be far more complicated than this example.</p>
<p>Note also that being reentrant is <em>not</em> the same thing as being thread safe. <code>redirect_stdout()</code>, for example, is definitely not thread safe, as it makes a global modification to the system state by binding <code>sys.stdout</code> to a different stream.</p>
<h4 id="Reusable-context-managers"><a href="#Reusable-context-managers" class="headerlink" title="Reusable context managers"></a>Reusable context managers</h4><p>Distinct from both single use and reentrant context managers are “reusable” context managers (or, to be completely explicit, “reusable, but not reentrant” context managers, since reentrant context managers are also reusable). These context managers support being used multiple times, but will fail (or otherwise not work correctly) if the specific context manager instance has already been used in a containing with statement.</p>
<p><code>threading.Lock</code> is an example of a reusable, but not reentrant, context manager (for a reentrant lock, it is necessary to use <code>threading.RLock</code> instead).</p>
<p>Another example of a reusable, but not reentrant, context manager is <code>ExitStack</code>, as it invokes <em>all</em> currently registered callbacks when leaving any with statement, regardless of where those callbacks were added:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack
<span class="token operator">>></span><span class="token operator">></span> stack <span class="token operator">=</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from first context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving first context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Leaving first context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> first context
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from second context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving second context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Leaving second context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> second context
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from outer context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">with</span> stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from inner context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving inner context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving outer context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Leaving inner context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> inner context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> outer context
Leaving outer context<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>As the output from the example shows, reusing a single stack object across multiple with statements works correctly, but attempting to nest them will cause the stack to be cleared at the end of the innermost with statement, which is unlikely to be desirable behaviour.</p>
<p>Using separate <code>ExitStack</code> instances instead of reusing a single instance avoids that problem:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> outer_stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     outer_stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from outer context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> inner_stack<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         inner_stack<span class="token punctuation">.</span>callback<span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">,</span> <span class="token string">"Callback: from inner context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving inner context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Leaving outer context"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Leaving inner context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> inner context
Leaving outer context
Callback<span class="token punctuation">:</span> <span class="token keyword">from</span> outer context<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="abc-—-抽象基类"><a href="#abc-—-抽象基类" class="headerlink" title="abc —- 抽象基类"></a><code>abc</code> —- 抽象基类</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/abc.py" target="_blank" rel="noopener">Lib/abc.py</a></p>
<hr>
<p>该模块提供了在 Python 中定义 抽象基类 (ABC) 的组件，在 <a href="https://www.python.org/dev/peps/pep-3119" target="_blank" rel="noopener"><strong>PEP 3119</strong></a> 中已有概述。查看 PEP 文档了解为什么需要在 Python 中增加这个模块。（也可查看 <a href="https://www.python.org/dev/peps/pep-3141" target="_blank" rel="noopener"><strong>PEP 3141</strong></a> 以及 <code>numbers</code> 模块了解基于 ABC 的数字类型继承关系。）</p>
<p><code>collections</code> 模块中有一些派生自 ABC 的具体类；当然这些类还可以进一步被派生。此外，<code>collections.abc</code> 子模块中有一些 ABC 可被用于测试一个类或实例是否提供特定的接口，例如它是否可哈希或它是否为映射等。</p>
<p>该模块提供了一个元类 <code>ABCMeta</code>，可以用来定义抽象类，另外还提供一个工具类 <code>ABC</code>，可以用它以继承的方式定义抽象基类。</p>
<p><em>class</em> <code>abc.ABC</code></p>
<p>一个使用 <code>ABCMeta</code> 作为元类的工具类。抽象基类可以通过从 <code>ABC</code> 派生来简单地创建，这就避免了在某些情况下会令人混淆的元类用法，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC
<span class="token keyword">class</span> <span class="token class-name">MyABC</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意 <code>ABC</code> 的类型仍然是 <code>ABCMeta</code>，因此继承 <code>ABC</code> 仍然需要关注元类使用中的注意事项，比如可能会导致元类冲突的多重继承。当然你也可以直接使用 <code>ABCMeta</code> 作为元类来定义抽象基类，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABCMeta
<span class="token keyword">class</span> <span class="token class-name">MyABC</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3.4 新版功能.</p>
<p><em>class</em> <code>abc.ABCMeta</code></p>
<p>用于定义抽象基类（ABC）的元类。</p>
<p>使用该元类以创建抽象基类。抽象基类可以像 mix-in 类一样直接被子类继承。你也可以将不相关的具体类（包括内建类）和抽象基类注册为“抽象子类” —— 这些类以及它们的子类会被内建函数 <code>issubclass()</code> 识别为对应的抽象基类的子类，但是该抽象基类不会出现在其 MRO（Method Resolution Order，方法解析顺序）中，抽象基类中实现的方法也不可调用（即使通过 <code>super()</code> 调用也不行）。</p>
<p>使用 <code>ABCMeta</code> 作为元类创建的类含有如下方法：</p>
<ul>
<li><p><code>register</code>(<em>subclass</em>)</p>
<p>将“子类”注册为该抽象基类的“抽象子类”，例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC
<span class="token keyword">class</span> <span class="token class-name">MyABC</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
MyABC<span class="token punctuation">.</span>register<span class="token punctuation">(</span>tuple<span class="token punctuation">)</span>
<span class="token keyword">assert</span> issubclass<span class="token punctuation">(</span>tuple<span class="token punctuation">,</span> MyABC<span class="token punctuation">)</span>
<span class="token keyword">assert</span> isinstance<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyABC<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 3.3 版更改: 返回注册的子类，使其能够作为类装饰器。</p>
<p>在 3.4 版更改: 你可以使用 <code>get_cache_token()</code> 函数来检测对 <code>register()</code> 的调用。</p>
</li>
</ul>
<p>你也可以在虚基类中重载这个方法。</p>
<ul>
<li><p><code>__subclasshook__</code>(<em>subclass</em>)</p>
<p>（必须定义为类方法。）</p>
<p>检查 <em>subclass</em> 是否是该抽象基类的子类。也就是说对于那些你希望定义为该抽象基类的子类的类，你不用对每个类都调用 <code>register()</code> 方法了，而是可以直接自定义 <code>issubclass</code> 的行为。（这个类方法是在抽象基类的 <code>__subclasscheck__()</code> 方法中调用的。）</p>
<p>该方法必须返回 <code>True</code>, <code>False</code> 或是 <code>NotImplemented</code>。如果返回 <code>True</code>，<em>subclass</em> 就会被认为是这个抽象基类的子类。如果返回 <code>False</code>，无论正常情况是否应该认为是其子类，统一视为不是。如果返回 <code>NotImplemented</code>，子类检查会按照正常机制继续执行。</p>
</li>
</ul>
<p>为了对这些概念做一演示，请看以下定义 ABC 的示例：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">get_iterator</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> iter<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyIterable</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> None
    <span class="token keyword">def</span> <span class="token function">get_iterator</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__iter__<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @classmethod
    <span class="token keyword">def</span> <span class="token function">__subclasshook__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cls <span class="token keyword">is</span> MyIterable<span class="token punctuation">:</span>
            <span class="token keyword">if</span> any<span class="token punctuation">(</span><span class="token string">"__iter__"</span> <span class="token keyword">in</span> B<span class="token punctuation">.</span>__dict__ <span class="token keyword">for</span> B <span class="token keyword">in</span> C<span class="token punctuation">.</span>__mro__<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> NotImplemented
MyIterable<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ABC <code>MyIterable</code> 定义了标准的迭代方法 <code>__iter__()</code> 作为一个抽象方法。这里给出的实现仍可在子类中被调用。<code>get_iterator()</code> 方法也是 <code>MyIterable</code> 抽象基类的一部分，但它并非必须被非抽象派生类所重载。</p>
<p>这里定义的 <code>__subclasshook__()</code> 类方法指明了任何在其 <code>__dict__</code> (或在其通过 <code>__mro__</code> 列表访问的基类) 中具有 <code>__iter__()</code> 方法的类也都会被视为 <code>MyIterable</code>。</p>
<p>最后，末尾行使得 <code>Foo</code> 成为 <code>MyIterable</code> 的一个虚子类，即使它没有定义 <code>__iter__()</code> 方法（它使用了以 <code>__len__()</code> 和 <code>__getitem__()</code> 术语定义的旧式可迭代对象协议）。 请注意这将不会使 <code>get_iterator</code> 成为 <code>Foo</code> 的一个可用方法，它是被另外提供的。</p>
<p>此外，<code>abc</code> 模块还提供了这些装饰器：</p>
<pre><code>@``abc.abstractmethod</code></pre><p>用于声明抽象方法的装饰器。</p>
<p>使用此装饰器要求类的元类是 <code>ABCMeta</code> 或是从该类派生。一个具有派生自 <code>ABCMeta</code> 的元类的类不可以被实例化，除非它全部的抽象方法和特征属性均已被重载。抽象方法可通过任何普通的“super”调用机制来调用。 <code>abstractmethod()</code> 可被用于声明特性属性和描述器的抽象方法。</p>
<p>动态地添加抽象方法到一个类，或尝试在方法或类被创建后修改其抽象状态等操作仅在使用 <code>update_abstractmethods()</code> 函数时受到支持。 <code>abstractmethod()</code> 只会影响使用常规继承所派生的子类；通过 ABC 的 <code>register()</code> 方法注册的“虚子类”不会受到影响。</p>
<p>当 <code>abstractmethod()</code> 与其他方法描述符配合应用时，它应当被应用为最内层的装饰器，如以下用法示例所示:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_method</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @classmethod
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_classmethod</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @staticmethod
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_staticmethod</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @property
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_property</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @my_abstract_property<span class="token punctuation">.</span>setter
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_property</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">_get_x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">_set_x</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    x <span class="token operator">=</span> property<span class="token punctuation">(</span>_get_x<span class="token punctuation">,</span> _set_x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了能正确地与抽象基类机制实现互操作，描述符必须使用 <code>__isabstractmethod__</code> 将自身标识为抽象的。 通常，如果被用于组成描述符的任何方法都是抽象的则此属性应当为 <code>True</code>。 例如，Python 的内置 <code>property</code> 所做的就等价于:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Descriptor</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @property
    <span class="token keyword">def</span> <span class="token function">__isabstractmethod__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> any<span class="token punctuation">(</span>getattr<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">'__isabstractmethod__'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">for</span>
                   f <span class="token keyword">in</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_fget<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_fset<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_fdel<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p>不同于 Java 抽象方法，这些抽象方法可能具有一个实现。 这个实现可在重载它的类上通过 <code>super()</code> 机制来调用。 这在使用协作多重继承的框架中可以被用作超调用的一个端点。</p>
<p><code>abc</code> 模块还支持下列旧式装饰器:</p>
<pre><code>@``abc.abstractclassmethod</code></pre><p>3.2 新版功能.</p>
<p>3.3 版后已移除: 现在可以让 <code>classmethod</code> 配合 <code>abstractmethod()</code> 使用，使得此装饰器变得冗余。</p>
<p>内置 <code>classmethod()</code> 的子类，指明一个抽象类方法。 在其他方面它都类似于 <code>abstractmethod()</code>。</p>
<p>这个特例已被弃用，因为现在当 <code>classmethod()</code> 装饰器应用于抽象方法时它会被正确地标识为抽象的:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @classmethod
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_classmethod</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.2 新版功能.</p>
<p>3.3 版后已移除: 现在可以让 <code>staticmethod</code> 配合 <code>abstractmethod()</code> 使用，使得此装饰器变得冗余。</p>
<p>内置 <code>staticmethod()</code> 的子类，指明一个抽象静态方法。 在其他方面它都类似于 <code>abstractmethod()</code>。</p>
<p>这个特例已被弃用，因为现在当 <code>staticmethod()</code> 装饰器应用于抽象方法时它会被正确地标识为抽象的:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @staticmethod
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_staticmethod</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.3 版后已移除: 现在可以让 <code>property</code>, <code>property.getter()</code>, <code>property.setter()</code> 和 <code>property.deleter()</code> 配合 <code>abstractmethod()</code> 使用，使得此装饰器变得冗余。</p>
<p>内置 <code>property()</code> 的子类，指明一个抽象特性属性。</p>
<p>这个特例已被弃用，因为现在当 <code>property()</code> 装饰器应用于抽象方法时它会被正确地标识为抽象的:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @property
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">my_abstract_property</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的例子定义了一个只读特征属性；你也可以通过适当地将一个或多个下层方法标记为抽象的来定义可读写的抽象特征属性:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @property
    <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @x<span class="token punctuation">.</span>setter
    @abstractmethod
    <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果只有某些组件是抽象的，则只需更新那些组件即可在子类中创建具体的特征属性:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">D</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @C<span class="token punctuation">.</span>x<span class="token punctuation">.</span>setter
    <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>abc</code> 模块还提供了这些函数：</p>
<p><code>abc.get_cache_token</code>()</p>
<p>返回当前抽象基类的缓存令牌</p>
<p>此令牌是一个不透明对象（支持相等性测试），用于为虚子类标识抽象基类缓存的当前版本。 此令牌会在任何 ABC 上每次调用 <code>ABCMeta.register()</code> 时发生更改。</p>
<p>3.4 新版功能.</p>
<p><code>abc.update_abstractmethods</code>(<em>cls</em>)</p>
<p>重新计算一个抽象类的抽象状态的函数。 如果一个类的抽象方法在类被创建后被实现或被修改则应当调用此函数。 通常，此函数应当在一个类装饰器内部被调用。</p>
<p>返回 <em>cls</em>，使其能够用作类装饰器。</p>
<p>如果 <em>cls</em> 不是 <code>ABCMeta</code> 的子类，则不做任何操作。</p>
<p>注解</p>
<p>此函数会假定 <em>cls</em> 的上级类已经被更新。 它不会更新任何子类。</p>
<p>3.10 新版功能.</p>
<h2 id="atexit-—-退出处理器"><a href="#atexit-—-退出处理器" class="headerlink" title="atexit —- 退出处理器"></a><code>atexit</code> —- 退出处理器</h2><p><code>atexit</code> 模块定义了清理函数的注册和反注册函数. 被注册的函数会在解释器正常终止时执行. <code>atexit</code> 会按照注册顺序的<em>逆序</em>执行; 如果你注册了 <code>A</code>, <code>B</code> 和 <code>C</code>, 那么在解释器终止时会依序执行 <code>C</code>, <code>B</code>, <code>A</code>.</p>
<p><strong>注意:</strong> 通过该模块注册的函数, 在程序被未被 Python 捕获的信号杀死时并不会执行, 在检测到 Python 内部致命错误以及调用了 <code>os._exit()</code> 时也不会执行.</p>
<p>在 3.7 版更改: 当配合 C-API 子解释器使用时，已注册函数是它们所注册解释器中的局部对象。</p>
<p><code>atexit.register</code>(<em>func</em>, <em>\</em>args<em>,</em> <em>*kwargs</em>)</p>
<p>将 <em>func</em> 注册为终止时执行的函数. 任何传给 <em>func</em> 的可选的参数都应当作为参数传给 <code>register()</code>. 可以多次注册同样的函数及参数.</p>
<p>在正常的程序终止时 (举例来说, 当调用了 <code>sys.exit()</code> 或是主模块的执行完成时), 所有注册过的函数都会以后进先出的顺序执行. 这样做是假定更底层的模块通常会比高层模块更早引入, 因此需要更晚清理.</p>
<p>如果在 exit 处理句柄执行期间引发了异常，将会打印回溯信息 (除非引发的是 <code>SystemExit</code>) 并且异常信息会被保存。 在所有 exit 处理句柄都获得运行机会之后，所引发的最后一个异常会被重新引发。</p>
<p>这个函数返回 <em>func</em> 对象，可以把它当作装饰器使用。</p>
<p><code>atexit.unregister</code>(<em>func</em>)</p>
<p>将 <em>func</em> 移出当解释器关闭时要运行的函数列表。 如果 <em>func</em> 之前未被注册则 <code>unregister()</code> 将静默地不做任何事。 如果 <em>func</em> 已被注册一次以上，则该函数每次在 <code>atexit</code> 调用栈中的出现都将被移除。 当取消注册时会在内部使用相等性比较 (<code>==</code>)，因而函数引用不需要具有匹配的标识号。</p>
<h3 id="atexit-示例"><a href="#atexit-示例" class="headerlink" title="atexit 示例"></a><code>atexit</code> 示例</h3><p>以下简单例子演示了一个模块在被导入时如何从文件初始化一个计数器，并在程序终结时自动保存计数器的更新值，此操作不依赖于应用在终结时对此模块进行显式调用。:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'counterfile'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> infile<span class="token punctuation">:</span>
        _count <span class="token operator">=</span> int<span class="token punctuation">(</span>infile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
    _count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">incrcounter</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> _count
    _count <span class="token operator">=</span> _count <span class="token operator">+</span> n
<span class="token keyword">def</span> <span class="token function">savecounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'counterfile'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> outfile<span class="token punctuation">:</span>
        outfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'%d'</span> <span class="token operator">%</span> _count<span class="token punctuation">)</span>
<span class="token keyword">import</span> atexit
atexit<span class="token punctuation">.</span>register<span class="token punctuation">(</span>savecounter<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>位置和关键字参数也可传入 <code>register()</code> 以便传递给被调用的已注册函数:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">goodbye</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> adjective<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Goodbye %s, it was %s to meet you.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> adjective<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> atexit
atexit<span class="token punctuation">.</span>register<span class="token punctuation">(</span>goodbye<span class="token punctuation">,</span> <span class="token string">'Donny'</span><span class="token punctuation">,</span> <span class="token string">'nice'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># or:</span>
atexit<span class="token punctuation">.</span>register<span class="token punctuation">(</span>goodbye<span class="token punctuation">,</span> adjective<span class="token operator">=</span><span class="token string">'nice'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Donny'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>作为 decorator: 使用:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> atexit
@atexit<span class="token punctuation">.</span>register
<span class="token keyword">def</span> <span class="token function">goodbye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'You are now leaving the Python sector.'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>只有在函数不需要任何参数调用时才能工作.</p>
<h2 id="traceback-—-打印或检索堆栈回溯"><a href="#traceback-—-打印或检索堆栈回溯" class="headerlink" title="traceback —- 打印或检索堆栈回溯"></a><code>traceback</code> —- 打印或检索堆栈回溯</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/traceback.py" target="_blank" rel="noopener">Lib/traceback.py</a></p>
<hr>
<p>该模块提供了一个标准接口来提取、格式化和打印 Python 程序的堆栈跟踪结果。它完全模仿Python 解释器在打印堆栈跟踪结果时的行为。当您想要在程序控制下打印堆栈跟踪结果时，例如在“封装”解释器时，这是非常有用的。</p>
<p>这个模块使用 traceback 对象 —— 这是存储在 <code>sys.last_traceback</code> 中的对象类型变量，并作为 <code>sys.exc_info()</code> 的第三项被返回。</p>
<p>这个模块定义了以下函数：</p>
<p><code>traceback.print_tb</code>(<em>tb</em>, <em>limit=None</em>, <em>file=None</em>)</p>
<p>如果<em>limit*是正整数，那么从 traceback 对象 “tb” 输出最高 *limit</em> 个（从调用函数开始的）栈的堆栈回溯‎条目‎；如果 <em>limit</em> 是负数就输出 <code>abs(limit)</code> 个回溯条目；又如果 <em>limit</em> 被省略或者为 <code>None</code>，那么就会输出所有回溯条目。如果 <em>file</em> 被省略或为 <code>None</code> 那么就会输出至标准输出<code>sys.stderr</code>否则它应该是一个打开的文件或者文件类对象来接收输出</p>
<p>在 3.5 版更改: 添加了对负数值 <em>limit</em> 的支持</p>
<p><code>traceback.print_exception</code>(<em>exc</em>, <em>/</em>, [<em>value</em>, <em>tb</em>, ]<em>limit=None</em>, <em>file=None</em>, <em>chain=True</em>)</p>
<p>打印回溯对象 <em>tb</em> 到 <em>file</em> 的异常信息和整个堆栈回溯。这和 <code>print_tb()</code> 比有以下方面不同：</p>
<ul>
<li>如果 <em>tb</em> 不为 <code>None</code>，它将打印头部 <code>Traceback (most recent call last):</code></li>
<li>it prints the exception type and <em>value</em> after the stack trace</li>
<li>if <em>type(value)</em> is <code>SyntaxError</code> and <em>value</em> has the appropriate format, it prints the line where the syntax error occurred with a caret indicating the approximate position of the error.</li>
</ul>
<p>Since Python 3.10, instead of passing <em>value</em> and <em>tb</em>, an exception object can be passed as the first argument. If <em>value</em> and <em>tb</em> are provided, the first argument is ignored in order to provide backwards compatibility.</p>
<p>The optional <em>limit</em> argument has the same meaning as for <code>print_tb()</code>. If <em>chain</em> is true (the default), then chained exceptions (the <code>__cause__</code> or <code>__context__</code> attributes of the exception) will be printed as well, like the interpreter itself does when printing an unhandled exception.</p>
<p>在 3.5 版更改: The <em>etype</em> argument is ignored and inferred from the type of <em>value</em>.</p>
<p>在 3.10 版更改: The <em>etype</em> parameter has been renamed to <em>exc</em> and is now positional-only.</p>
<p><code>traceback.print_exc</code>(<em>limit=None</em>, <em>file=None</em>, <em>chain=True</em>)</p>
<p>This is a shorthand for <code>print_exception(*sys.exc_info(), limit, file, chain)</code>.</p>
<p><code>traceback.print_last</code>(<em>limit=None</em>, <em>file=None</em>, <em>chain=True</em>)</p>
<p>This is a shorthand for <code>print_exception(sys.last_type, sys.last_value, sys.last_traceback, limit, file, chain)</code>. In general it will work only after an exception has reached an interactive prompt (see <code>sys.last_type</code>).</p>
<p><code>traceback.print_stack</code>(<em>f=None</em>, <em>limit=None</em>, <em>file=None</em>)</p>
<p>Print up to <em>limit</em> stack trace entries (starting from the invocation point) if <em>limit</em> is positive. Otherwise, print the last <code>abs(limit)</code> entries. If <em>limit</em> is omitted or <code>None</code>, all entries are printed. The optional <em>f</em> argument can be used to specify an alternate stack frame to start. The optional <em>file</em> argument has the same meaning as for <code>print_tb()</code>.</p>
<p>在 3.5 版更改: 添加了对负数值 <em>limit</em> 的支持</p>
<p><code>traceback.extract_tb</code>(<em>tb</em>, <em>limit=None</em>)</p>
<p>Return a <code>StackSummary</code> object representing a list of “pre-processed” stack trace entries extracted from the traceback object <em>tb</em>. It is useful for alternate formatting of stack traces. The optional <em>limit</em> argument has the same meaning as for <code>print_tb()</code>. A “pre-processed” stack trace entry is a <code>FrameSummary</code> object containing attributes <code>filename</code>, <code>lineno</code>, <code>name</code>, and <code>line</code> representing the information that is usually printed for a stack trace. The <code>line</code> is a string with leading and trailing whitespace stripped; if the source is not available it is <code>None</code>.</p>
<p><code>traceback.extract_stack</code>(<em>f=None</em>, <em>limit=None</em>)</p>
<p>Extract the raw traceback from the current stack frame. The return value has the same format as for <code>extract_tb()</code>. The optional <em>f</em> and <em>limit</em> arguments have the same meaning as for <code>print_stack()</code>.</p>
<p><code>traceback.format_list</code>(<em>extracted_list</em>)</p>
<p>Given a list of tuples or <code>FrameSummary</code> objects as returned by <code>extract_tb()</code> or <code>extract_stack()</code>, return a list of strings ready for printing. Each string in the resulting list corresponds to the item with the same index in the argument list. Each string ends in a newline; the strings may contain internal newlines as well, for those items whose source text line is not <code>None</code>.</p>
<p><code>traceback.format_exception_only</code>(<em>exc</em>, <em>/</em>[, <em>value</em>])</p>
<p>Format the exception part of a traceback using an exception value such as given by <code>sys.last_value</code>. The return value is a list of strings, each ending in a newline. Normally, the list contains a single string; however, for <code>SyntaxError</code> exceptions, it contains several lines that (when printed) display detailed information about where the syntax error occurred. The message indicating which exception occurred is the always last string in the list.</p>
<p>Since Python 3.10, instead of passing <em>value</em>, an exception object can be passed as the first argument. If <em>value</em> is provided, the first argument is ignored in order to provide backwards compatibility.</p>
<p>在 3.10 版更改: The <em>etype</em> parameter has been renamed to <em>exc</em> and is now positional-only.</p>
<p><code>traceback.format_exception</code>(<em>exc</em>, <em>/</em>, [<em>value</em>, <em>tb</em>, ]<em>limit=None</em>, <em>chain=True</em>)</p>
<p>Format a stack trace and the exception information. The arguments have the same meaning as the corresponding arguments to <code>print_exception()</code>. The return value is a list of strings, each ending in a newline and some containing internal newlines. When these lines are concatenated and printed, exactly the same text is printed as does <code>print_exception()</code>.</p>
<p>在 3.5 版更改: The <em>etype</em> argument is ignored and inferred from the type of <em>value</em>.</p>
<p>在 3.10 版更改: This function’s behavior and signature were modified to match <code>print_exception()</code>.</p>
<p><code>traceback.format_exc</code>(<em>limit=None</em>, <em>chain=True</em>)</p>
<p>This is like <code>print_exc(limit)</code> but returns a string instead of printing to a file.</p>
<p><code>traceback.format_tb</code>(<em>tb</em>, <em>limit=None</em>)</p>
<p>A shorthand for <code>format_list(extract_tb(tb, limit))</code>.</p>
<p><code>traceback.format_stack</code>(<em>f=None</em>, <em>limit=None</em>)</p>
<p>A shorthand for <code>format_list(extract_stack(f, limit))</code>.</p>
<p><code>traceback.clear_frames</code>(<em>tb</em>)</p>
<p>Clears the local variables of all the stack frames in a traceback <em>tb</em> by calling the <code>clear()</code> method of each frame object.</p>
<p>3.4 新版功能.</p>
<p><code>traceback.walk_stack</code>(<em>f</em>)</p>
<p>Walk a stack following <code>f.f_back</code> from the given frame, yielding the frame and line number for each frame. If <em>f</em> is <code>None</code>, the current stack is used. This helper is used with <code>StackSummary.extract()</code>.</p>
<p>3.5 新版功能.</p>
<p><code>traceback.walk_tb</code>(<em>tb</em>)</p>
<p>Walk a traceback following <code>tb_next</code> yielding the frame and line number for each frame. This helper is used with <code>StackSummary.extract()</code>.</p>
<p>3.5 新版功能.</p>
<p>The module also defines the following classes:</p>
<h3 id="TracebackException-Objects"><a href="#TracebackException-Objects" class="headerlink" title="TracebackException Objects"></a><code>TracebackException</code> Objects</h3><p>3.5 新版功能.</p>
<p><code>TracebackException</code> objects are created from actual exceptions to capture data for later printing in a lightweight fashion.</p>
<p><em>class</em> <code>traceback.TracebackException</code>(<em>exc_type</em>, <em>exc_value</em>, <em>exc_traceback</em>, <em>**,</em> limit=None<em>,</em> lookup_lines=True<em>,</em> capture_locals=False<em>,</em> compact=False*)</p>
<p>Capture an exception for later rendering. <em>limit</em>, <em>lookup_lines</em> and <em>capture_locals</em> are as for the <code>StackSummary</code> class.</p>
<p>If <em>compact</em> is true, only data that is required by <code>TracebackException</code>‘s <code>format</code> method is saved in the class attributes. In particular, the <code>__context__</code> field is calculated only if <code>__cause__</code> is <code>None</code> and <code>__suppress_context__</code> is false.</p>
<p>Note that when locals are captured, they are also shown in the traceback.</p>
<ul>
<li><p><code>__cause__</code></p>
<p>A <code>TracebackException</code> of the original <code>__cause__</code>.</p>
</li>
<li><p><code>__context__</code></p>
<p>A <code>TracebackException</code> of the original <code>__context__</code>.</p>
</li>
<li><p><code>__suppress_context__</code></p>
<p>The <code>__suppress_context__</code> value from the original exception.</p>
</li>
<li><p><code>stack</code></p>
<p>A <code>StackSummary</code> representing the traceback.</p>
</li>
<li><p><code>exc_type</code></p>
<p>The class of the original traceback.</p>
</li>
<li><p><code>filename</code></p>
<p>For syntax errors - the file name where the error occurred.</p>
</li>
<li><p><code>lineno</code></p>
<p>For syntax errors - the line number where the error occurred.</p>
</li>
<li><p><code>text</code></p>
<p>For syntax errors - the text where the error occurred.</p>
</li>
<li><p><code>offset</code></p>
<p>For syntax errors - the offset into the text where the error occurred.</p>
</li>
<li><p><code>msg</code></p>
<p>For syntax errors - the compiler error message.</p>
</li>
<li><p><em>classmethod</em> <code>from_exception</code>(<em>exc</em>, <em>**,</em> limit=None<em>,</em> lookup_lines=True<em>,</em> capture_locals=False*)</p>
<p>Capture an exception for later rendering. <em>limit</em>, <em>lookup_lines</em> and <em>capture_locals</em> are as for the <code>StackSummary</code> class.</p>
<p>Note that when locals are captured, they are also shown in the traceback.</p>
</li>
<li><p><code>format</code>(<em>**,</em> chain=True*)</p>
<p>Format the exception.</p>
<p>If <em>chain</em> is not <code>True</code>, <code>__cause__</code> and <code>__context__</code> will not be formatted.</p>
<p>The return value is a generator of strings, each ending in a newline and some containing internal newlines. <code>print_exception()</code> is a wrapper around this method which just prints the lines to a file.</p>
<p>The message indicating which exception occurred is always the last string in the output.</p>
</li>
<li><p><code>format_exception_only</code>()</p>
<p>Format the exception part of the traceback.</p>
<p>The return value is a generator of strings, each ending in a newline.</p>
<p>Normally, the generator emits a single string; however, for <code>SyntaxError</code> exceptions, it emits several lines that (when printed) display detailed information about where the syntax error occurred.</p>
<p>The message indicating which exception occurred is always the last string in the output.</p>
</li>
</ul>
<p>在 3.10 版更改: 增加了 <em>compact</em> 形参。</p>
<h3 id="StackSummary-Objects"><a href="#StackSummary-Objects" class="headerlink" title="StackSummary Objects"></a><code>StackSummary</code> Objects</h3><p>3.5 新版功能.</p>
<p><code>StackSummary</code> objects represent a call stack ready for formatting.</p>
<p><em>class</em> <code>traceback.StackSummary</code></p>
<ul>
<li><p><em>classmethod</em> <code>extract</code>(<em>frame_gen</em>, <em>**,</em> limit=None<em>,</em> lookup_lines=True<em>,</em> capture_locals=False*)</p>
<p>Construct a <code>StackSummary</code> object from a frame generator (such as is returned by <code>walk_stack()</code> or <code>walk_tb()</code>).</p>
<p>If <em>limit</em> is supplied, only this many frames are taken from <em>frame_gen</em>. If <em>lookup_lines</em> is <code>False</code>, the returned <code>FrameSummary</code> objects will not have read their lines in yet, making the cost of creating the <code>StackSummary</code> cheaper (which may be valuable if it may not actually get formatted). If <em>capture_locals</em> is <code>True</code> the local variables in each <code>FrameSummary</code> are captured as object representations.</p>
</li>
<li><p><em>classmethod</em> <code>from_list</code>(<em>a_list</em>)</p>
<p>Construct a <code>StackSummary</code> object from a supplied list of <code>FrameSummary</code> objects or old-style list of tuples. Each tuple should be a 4-tuple with filename, lineno, name, line as the elements.</p>
</li>
<li><p><code>format</code>()</p>
<p>Returns a list of strings ready for printing. Each string in the resulting list corresponds to a single frame from the stack. Each string ends in a newline; the strings may contain internal newlines as well, for those items with source text lines.</p>
<p>For long sequences of the same frame and line, the first few repetitions are shown, followed by a summary line stating the exact number of further repetitions.</p>
<p>在 3.6 版更改: Long sequences of repeated frames are now abbreviated.</p>
</li>
</ul>
<h3 id="FrameSummary-Objects"><a href="#FrameSummary-Objects" class="headerlink" title="FrameSummary Objects"></a><code>FrameSummary</code> Objects</h3><p>3.5 新版功能.</p>
<p><code>FrameSummary</code> objects represent a single frame in a traceback.</p>
<p><em>class</em> <code>traceback.FrameSummary</code>(<em>filename</em>, <em>lineno</em>, <em>name</em>, <em>lookup_line=True</em>, <em>locals=None</em>, <em>line=None</em>)</p>
<p>Represent a single frame in the traceback or stack that is being formatted or printed. It may optionally have a stringified version of the frames locals included in it. If <em>lookup_line</em> is <code>False</code>, the source code is not looked up until the <code>FrameSummary</code> has the <code>line</code> attribute accessed (which also happens when casting it to a tuple). <code>line</code> may be directly provided, and will prevent line lookups happening at all. <em>locals</em> is an optional local variable dictionary, and if supplied the variable representations are stored in the summary for later display.</p>
<h3 id="Traceback-Examples"><a href="#Traceback-Examples" class="headerlink" title="Traceback Examples"></a>Traceback Examples</h3><p>This simple example implements a basic read-eval-print loop, similar to (but less useful than) the standard Python interactive interpreter loop. For a more complete implementation of the interpreter loop, refer to the <code>code</code> module.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token punctuation">,</span> traceback
<span class="token keyword">def</span> <span class="token function">run_user_code</span><span class="token punctuation">(</span>envdir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    source <span class="token operator">=</span> input<span class="token punctuation">(</span><span class="token string">">>> "</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> envdir<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exception in user code:"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span>
        traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span>file<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">)</span>
envdir <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    run_user_code<span class="token punctuation">(</span>envdir<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The following example demonstrates the different ways to print and format the exception and traceback:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token punctuation">,</span> traceback
<span class="token keyword">def</span> <span class="token function">lumberjack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bright_side_of_death<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">bright_side_of_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> tuple<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    lumberjack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> exc_traceback <span class="token operator">=</span> sys<span class="token punctuation">.</span>exc_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** print_tb:"</span><span class="token punctuation">)</span>
    traceback<span class="token punctuation">.</span>print_tb<span class="token punctuation">(</span>exc_traceback<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> file<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** print_exception:"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># exc_type below is ignored on 3.5 and later</span>
    traceback<span class="token punctuation">.</span>print_exception<span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> exc_traceback<span class="token punctuation">,</span>
                              limit<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> file<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** print_exc:"</span><span class="token punctuation">)</span>
    traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span>limit<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> file<span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** format_exc, first and last line:"</span><span class="token punctuation">)</span>
    formatted_lines <span class="token operator">=</span> traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>formatted_lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>formatted_lines<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** format_exception:"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># exc_type below is ignored on 3.5 and later</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>repr<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>format_exception<span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span>
                                          exc_traceback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** extract_tb:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>repr<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>extract_tb<span class="token punctuation">(</span>exc_traceback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** format_tb:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>repr<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>format_tb<span class="token punctuation">(</span>exc_traceback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*** tb_lineno:"</span><span class="token punctuation">,</span> exc_traceback<span class="token punctuation">.</span>tb_lineno<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The output for the example would look similar to this:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">**</span><span class="token operator">*</span> print_tb<span class="token punctuation">:</span>
  File <span class="token string">"&lt;doctest...>"</span><span class="token punctuation">,</span> line <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    lumberjack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">**</span><span class="token operator">*</span> print_exception<span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;doctest...>"</span><span class="token punctuation">,</span> line <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    lumberjack<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"&lt;doctest...>"</span><span class="token punctuation">,</span> line <span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">in</span> lumberjack
    bright_side_of_death<span class="token punctuation">(</span><span class="token punctuation">)</span>
IndexError<span class="token punctuation">:</span> tuple index out of range
<span class="token operator">**</span><span class="token operator">*</span> print_exc<span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;doctest...>"</span><span class="token punctuation">,</span> line <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    lumberjack<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"&lt;doctest...>"</span><span class="token punctuation">,</span> line <span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">in</span> lumberjack
    bright_side_of_death<span class="token punctuation">(</span><span class="token punctuation">)</span>
IndexError<span class="token punctuation">:</span> tuple index out of range
<span class="token operator">**</span><span class="token operator">*</span> format_exc<span class="token punctuation">,</span> first <span class="token operator">and</span> last line<span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
IndexError<span class="token punctuation">:</span> tuple index out of range
<span class="token operator">**</span><span class="token operator">*</span> format_exception<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">'Traceback (most recent call last):\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest...>", line 10, in &lt;module>\n    lumberjack()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest...>", line 4, in lumberjack\n    bright_side_of_death()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest...>", line 7, in bright_side_of_death\n    return tuple()[0]\n'</span><span class="token punctuation">,</span>
 <span class="token string">'IndexError: tuple index out of range\n'</span><span class="token punctuation">]</span>
<span class="token operator">**</span><span class="token operator">*</span> extract_tb<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>FrameSummary file <span class="token operator">&lt;</span>doctest<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">,</span> line <span class="token number">10</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">>></span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span>FrameSummary file <span class="token operator">&lt;</span>doctest<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">,</span> line <span class="token number">4</span> <span class="token keyword">in</span> lumberjack<span class="token operator">></span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span>FrameSummary file <span class="token operator">&lt;</span>doctest<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">,</span> line <span class="token number">7</span> <span class="token keyword">in</span> bright_side_of_death<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">**</span><span class="token operator">*</span> format_tb<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">'  File "&lt;doctest...>", line 10, in &lt;module>\n    lumberjack()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest...>", line 4, in lumberjack\n    bright_side_of_death()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest...>", line 7, in bright_side_of_death\n    return tuple()[0]\n'</span><span class="token punctuation">]</span>
<span class="token operator">**</span><span class="token operator">*</span> tb_lineno<span class="token punctuation">:</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The following example shows the different ways to print and format the stack:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> traceback
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     lumberstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">lumberstack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     traceback<span class="token punctuation">.</span>print_stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>repr<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>extract_stack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>repr<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>format_stack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> another_function<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"&lt;doctest>"</span><span class="token punctuation">,</span> line <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    another_function<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"&lt;doctest>"</span><span class="token punctuation">,</span> line <span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">in</span> another_function
    lumberstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
  File <span class="token string">"&lt;doctest>"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> lumberstack
    traceback<span class="token punctuation">.</span>print_stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'&lt;doctest>'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'&lt;module>'</span><span class="token punctuation">,</span> <span class="token string">'another_function()'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'&lt;doctest>'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'another_function'</span><span class="token punctuation">,</span> <span class="token string">'lumberstack()'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'&lt;doctest>'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'lumberstack'</span><span class="token punctuation">,</span> <span class="token string">'print(repr(traceback.extract_stack()))'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'  File "&lt;doctest>", line 10, in &lt;module>\n    another_function()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest>", line 3, in another_function\n    lumberstack()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "&lt;doctest>", line 8, in lumberstack\n    print(repr(traceback.format_stack()))\n'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>This last example demonstrates the final few formatting functions:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> traceback
<span class="token operator">>></span><span class="token operator">></span> traceback<span class="token punctuation">.</span>format_list<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'spam.py'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'&lt;module>'</span><span class="token punctuation">,</span> <span class="token string">'spam.eggs()'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        <span class="token punctuation">(</span><span class="token string">'eggs.py'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'eggs'</span><span class="token punctuation">,</span> <span class="token string">'return "bacon"'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'  File "spam.py", line 3, in &lt;module>\n    spam.eggs()\n'</span><span class="token punctuation">,</span>
 <span class="token string">'  File "eggs.py", line 42, in eggs\n    return "bacon"\n'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> an_error <span class="token operator">=</span> IndexError<span class="token punctuation">(</span><span class="token string">'tuple index out of range'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> traceback<span class="token punctuation">.</span>format_exception_only<span class="token punctuation">(</span>type<span class="token punctuation">(</span>an_error<span class="token punctuation">)</span><span class="token punctuation">,</span> an_error<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'IndexError: tuple index out of range\n'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="future-—-Future-语句定义"><a href="#future-—-Future-语句定义" class="headerlink" title="__future__ —- Future 语句定义"></a><code>__future__</code> —- Future 语句定义</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/__future__.py" target="_blank" rel="noopener">Lib/<strong>future</strong>.py</a></p>
<hr>
<p><code>__future__</code> 是一个真正的模块，这主要有 3 个原因：</p>
<ul>
<li>避免混淆已有的分析 import 语句并查找 import 的模块的工具。</li>
<li>确保 future 语句 在 2.1 之前的版本运行时至少能抛出 runtime 异常（import <code>__future__</code> 会失败，因为 2.1 版本之前没有这个模块）。</li>
<li>当引入不兼容的修改时，可以记录其引入的时间以及强制使用的时间。这是一种可执行的文档，并且可以通过 import <code>__future__</code> 来做程序性的检查。</li>
</ul>
<p><code>__future__.py</code> 中的每一条语句都是以下格式的：</p>
<pre class="line-numbers language-python"><code class="language-python">FeatureName <span class="token operator">=</span> _Feature<span class="token punctuation">(</span>OptionalRelease<span class="token punctuation">,</span> MandatoryRelease<span class="token punctuation">,</span>
                       CompilerFlag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通常 <em>OptionalRelease</em> 要比 <em>MandatoryRelease</em> 小，并且都是和 <code>sys.version_info</code> 格式一致的 5 元素元组。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">(</span>PY_MAJOR_VERSION<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># the 2 in 2.1.0a3; an int</span>
 PY_MINOR_VERSION<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># the 1; an int</span>
 PY_MICRO_VERSION<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># the 0; an int</span>
 PY_RELEASE_LEVEL<span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># "alpha", "beta", "candidate" or "final"; string</span>
 PY_RELEASE_SERIAL <span class="token comment" spellcheck="true"># the 3; an int</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>OptionalRelease</em> 记录了一个特性首次发布时的 Python 版本。</p>
<p>在 <em>MandatoryRelases</em> 还没有发布时，<em>MandatoryRelease</em> 表示该特性会变成语言的一部分的预测时间。</p>
<p>其他情况下，<em>MandatoryRelease</em> 用来记录这个特性是何时成为语言的一部分的。从该版本往后，使用该特性将不需要 future 语句，不过很多人还是会加上对应的 import。</p>
<p><em>MandatoryRelease</em> 也可能是 <code>None</code>, 表示这个特性已经被撤销。</p>
<p><code>_Feature</code> 类的实例有两个对应的方法，<code>getOptionalRelease()</code> 和 <code>getMandatoryRelease()</code>。</p>
<p><em>CompilerFlag</em> 是一个（位）标记，对于动态编译的代码，需要将这个标记作为第四个参数传入内建函数 <code>compile()</code> 中以开启对应的特性。这个标记存储在 <code>_Feature</code> 类实例的 <code>compiler_flag</code> 属性中。</p>
<p><code>__future__</code> 中不会删除特性的描述。从 Python 2.1 中首次加入以来，通过这种方式引入了以下特性：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">可选版本</th>
<th align="left">强制加入版本</th>
<th align="left">效果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">nested_scopes</td>
<td align="left">2.1.0b1</td>
<td align="left">2.2</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0227" target="_blank" rel="noopener"><strong>PEP 227</strong></a>: <em>静态嵌套作用域</em></td>
</tr>
<tr>
<td align="left">generators</td>
<td align="left">2.2.0a1</td>
<td align="left">2.3</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0255" target="_blank" rel="noopener"><strong>PEP 255</strong></a>: <em>简单生成器</em></td>
</tr>
<tr>
<td align="left">division</td>
<td align="left">2.2.0a2</td>
<td align="left">3.0</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0238" target="_blank" rel="noopener"><strong>PEP 238</strong></a>: <em>修改除法运算符</em></td>
</tr>
<tr>
<td align="left">absolute_import</td>
<td align="left">2.5.0a1</td>
<td align="left">3.0</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0328" target="_blank" rel="noopener"><strong>PEP 328</strong></a>: <em>导入：多行与绝对/相对</em></td>
</tr>
<tr>
<td align="left">with_statement</td>
<td align="left">2.5.0a1</td>
<td align="left">2.6</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0343" target="_blank" rel="noopener"><strong>PEP 343</strong></a>: <em>“with” 语句</em></td>
</tr>
<tr>
<td align="left">print_function</td>
<td align="left">2.6.0a2</td>
<td align="left">3.0</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-3105" target="_blank" rel="noopener"><strong>PEP 3105</strong></a>: <em>print 改为函数</em></td>
</tr>
<tr>
<td align="left">unicode_literals</td>
<td align="left">2.6.0a2</td>
<td align="left">3.0</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-3112" target="_blank" rel="noopener"><strong>PEP 3112</strong></a>: <em>Python 3000 中的字节字面值</em></td>
</tr>
<tr>
<td align="left">generator_stop</td>
<td align="left">3.5.0b1</td>
<td align="left">3.7</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0479" target="_blank" rel="noopener"><strong>PEP 479</strong></a>: <em>在生成器中处理 StopIteration</em></td>
</tr>
<tr>
<td align="left">annotations</td>
<td align="left">3.7.0b1</td>
<td align="left">3.11</td>
<td align="left"><a href="https://www.python.org/dev/peps/pep-0563" target="_blank" rel="noopener"><strong>PEP 563</strong></a>: <em>Postponed evaluation of annotations</em></td>
</tr>
</tbody></table>
<p>参见</p>
<p>future 语句</p>
<p>编译器怎样处理 future import。</p>
<h2 id="gc-—-垃圾回收器接口"><a href="#gc-—-垃圾回收器接口" class="headerlink" title="gc —- 垃圾回收器接口"></a><code>gc</code> —- 垃圾回收器接口</h2><p>此模块提供可选的垃圾回收器的接口，提供的功能包括：关闭收集器、调整收集频率、设置调试选项。它同时提供对回收器找到但是无法释放的不可达对象的访问。由于 Python 使用了带有引用计数的回收器，如果你确定你的程序不会产生循环引用，你可以关闭回收器。可以通过调用 <code>gc.disable()</code> 关闭自动垃圾回收。若要调试一个存在内存泄漏的程序，调用 <code>gc.set_debug(gc.DEBUG_LEAK)</code> ；需要注意的是，它包含 <code>gc.DEBUG_SAVEALL</code> ，使得被垃圾回收的对象会被存放在 gc.garbage 中以待检查。</p>
<p><code>gc</code> 模块提供下列函数：</p>
<p><code>gc.enable</code>()</p>
<p>启用自动垃圾回收</p>
<p><code>gc.disable</code>()</p>
<p>停用自动垃圾回收</p>
<p><code>gc.isenabled</code>()</p>
<p>如果启用了自动回收则返回 <code>True</code>。</p>
<p><code>gc.collect</code>(<em>generation=2</em>)</p>
<p>若被调用时不包含参数，则启动完全的垃圾回收。可选的参数 <em>generation</em> 可以是一个整数，指明需要回收哪一代（从 0 到 2 ）的垃圾。当参数 <em>generation</em> 无效时，会引发 <code>ValueError</code> 异常。返回发现的不可达对象的数目。</p>
<p>每当运行完整收集或最高代 (2) 收集时，为多个内置类型所维护的空闲列表会被清空。 由于特定类型特别是 <code>float</code> 的实现，在某些空闲列表中并非所有项都会被释放。</p>
<p><code>gc.set_debug</code>(<em>flags</em>)</p>
<p>设置垃圾回收器的调试标识位。调试信息会被写入 <code>sys.stderr</code> 。此文档末尾列出了各个标志位及其含义；可以使用位操作对多个标志位进行设置以控制调试器。</p>
<p><code>gc.get_debug</code>()</p>
<p>返回当前调试标识位。</p>
<p><code>gc.get_objects</code>(<em>generation=None</em>)</p>
<p>返回一个收集器所跟踪的所有对象的列表，所返回的列表除外。 如果 <em>generation</em> 不为 None，则只返回收集器所跟踪的属于该生成的对象。</p>
<p>在 3.8 版更改: 新的 <em>generation</em> 形参。</p>
<p>引发一个 审计事件 <code>gc.get_objects</code>，附带参数 <code>generation</code>。</p>
<p><code>gc.get_stats</code>()</p>
<p>返回一个包含三个字典对象的列表，每个字典分别包含对应代的从解释器开始运行的垃圾回收统计数据。字典的键的数目在将来可能发生改变，目前每个字典包含以下内容：</p>
<ul>
<li><code>collections</code> 是该代被回收的次数；</li>
<li><code>collected</code> 是该代中被回收的对象总数；</li>
<li><code>uncollectable</code> 是在这一代中被发现无法收集的对象总数 （因此被移动到 <code>garbage</code> 列表中）。</li>
</ul>
<p>3.4 新版功能.</p>
<p><code>gc.set_threshold</code>(<em>threshold0</em>[, <em>threshold1</em>[, <em>threshold2</em>]])</p>
<p>设置垃圾回收阈值（收集频率）。 将 <em>threshold0</em> 设为零会禁用回收。</p>
<p>垃圾回收器把所有对象分类为三代，其依据是对象在多少次垃圾回收后幸存。 新建对象会被放在最年轻代（第 <code>0</code> 代）。 如果一个对象在一次垃圾回收后幸存，它会被移入下一个较老代。 由于第 <code>2</code> 代是最老代，这一代的对象在一次垃圾回收后仍会保留原样。 为了确定何时要运行，垃圾回收器会跟踪自上一次回收后对象分配和释放的数量。 当分配数量减去释放数量的结果值大于 <em>threshold0</em> 时，垃圾回收就会开始。 初始时只有第 <code>0</code> 代会被检查。 如果自第 <code>1</code> 代被检查后第 <code>0</code> 代已被检查超过 <em>threshold1</em> 次，则第 <code>1</code> 也会被检查。 对于第三代来说情况还会更复杂。</p>
<p><code>gc.get_count</code>()</p>
<p>将当前回收计数以形为 <code>(count0, count1, count2)</code> 的元组返回。</p>
<p><code>gc.get_threshold</code>()</p>
<p>将当前回收阈值以形为 <code>(threshold0, threshold1, threshold2)</code> 的元组返回。</p>
<p><code>gc.get_referrers</code>(<em>\</em>objs*)</p>
<p>返回直接引用任意一个 <em>ojbs</em> 的对象列表。这个函数只定位支持垃圾回收的容器；引用了其它对象但不支持垃圾回收的扩展类型不会被找到。</p>
<p>需要注意的是，已经解除对 <em>objs</em> 引用的对象，但仍存在于循环引用中未被回收时，仍然会被作为引用者出现在返回的列表当中。若要获取当前正在引用 <em>objs</em> 的对象，需要调用 <code>collect()</code> 然后再调用 <code>get_referrers()</code> 。</p>
<p>警告</p>
<p>在使用 <code>get_referrers()</code> 返回的对象时必须要小心，因为其中一些对象可能仍在构造中因此处于暂时的无效状态。不要把 <code>get_referrers()</code> 用于调试以外的其它目的。</p>
<p>引发一个 审计事件 <code>gc.get_referrers</code>，附带参数 <code>objs</code>。</p>
<p><code>gc.get_referents</code>(<em>\</em>objs*)</p>
<p>返回被任意一个参数中的对象直接引用的对象的列表。返回的被引用对象是被参数中的对象的C语言级别方法（若存在） <code>tp_traverse</code> 访问到的对象，可能不是所有的实际直接可达对象。只有支持垃圾回收的对象支持 <code>tp_traverse</code> 方法，并且此方法只会在需要访问涉及循环引用的对象时使用。因此，可以有以下例子：一个整数对其中一个参数是直接可达的，这个整数有可能出现或不出现在返回的结果列表当中。</p>
<p>引发一个 审计事件 <code>gc.get_referents</code>，附带参数 <code>objs</code>。</p>
<p><code>gc.is_tracked</code>(<em>obj</em>)</p>
<p>当对象正在被垃圾回收器监控时返回 <code>True</code> ，否则返回 <code>False</code> 。一般来说，原子类的实例不会被监控，而非原子类（如容器、用户自定义的对象）会被监控。然而，会有一些特定类型的优化以便减少垃圾回收器在简单实例（如只含有原子性的键和值的字典）上的消耗。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_tracked<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.1 新版功能.</p>
<p><code>gc.is_finalized</code>(<em>obj</em>)</p>
<p>如果给定对象已被垃圾回收器终结则返回 <code>True</code>，否则返回 <code>False</code>。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> None
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Lazarus</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">global</span> x
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         x <span class="token operator">=</span> self
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> lazarus <span class="token operator">=</span> Lazarus<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_finalized<span class="token punctuation">(</span>lazarus<span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">del</span> lazarus
<span class="token operator">>></span><span class="token operator">></span> gc<span class="token punctuation">.</span>is_finalized<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.9 新版功能.</p>
<p><code>gc.freeze</code>()</p>
<p>冻结 gc 所跟踪的所有对象 —— 将它们移至永久代并忽略所有未来的集合。 这可以在 POSIX fork() 调用之前使用以便令对写入复制保持友好或加速收集。 并且在 POSIX fork() 调用之前的收集也可以释放页面以供未来分配，这也可能导致写入时复制，因此建议在主进程中禁用 gc 并在 fork 之前冻结，而在子进程中启用 gc。</p>
<p>3.7 新版功能.</p>
<p><code>gc.unfreeze</code>()</p>
<p>解冻永久代中的对象，并将它们放回到年老代中。</p>
<p>3.7 新版功能.</p>
<p><code>gc.get_freeze_count</code>()</p>
<p>返回永久代中的对象数量。</p>
<p>3.7 新版功能.</p>
<p>提供以下变量仅供只读访问（你可以修改但不应该重绑定它们）：</p>
<pre><code>gc.garbage</code></pre><p>一个回收器发现不可达而又无法被释放的对象（不可回收对象）列表。 从 Python 3.4 开始，该列表在大多数时候都应该是空的，除非使用了含有非 <code>NULL</code> <code>tp_del</code> 空位的 C 扩展类型的实例。</p>
<p>如果设置了 <code>DEBUG_SAVEALL</code> ，则所有不可访问对象将被添加至该列表而不会被释放。</p>
<p>在 3.2 版更改: 当 interpreter shutdown 即解释器关闭时，若此列表非空，会产生 <code>ResourceWarning</code> ，即资源警告，在默认情况下此警告不会被提醒。如果设置了 <code>DEBUG_UNCOLLECTABLE</code> ，所有无法被回收的对象会被打印。</p>
<p>在 3.4 版更改: 根据 <a href="https://www.python.org/dev/peps/pep-0442" target="_blank" rel="noopener"><strong>PEP 442</strong></a> ，带有 <code>__del__()</code> 方法的对象最终不再会进入 <code>gc.garbage</code> 。</p>
<pre><code>gc.callbacks</code></pre><p>在垃圾回收器开始前和完成后会被调用的一系列回调函数。这些回调函数在被调用时使用两个参数： <em>phase</em> 和 <em>info</em> 。</p>
<p><em>phase</em> 可为以下两值之一：</p>
<blockquote>
<p>“start”: 垃圾回收即将开始。</p>
<p>“stop”: 垃圾回收已结束。</p>
</blockquote>
<p><em>info</em> is a dict providing more information for the callback. The following keys are currently defined:</p>
<blockquote>
<p>“generation”（代） ：正在被回收的最久远的一代。</p>
<p>“collected”（已回收的 ）: 当<em>phase</em> 为 “stop” 时，被成功回收的对象的数目。</p>
<p>“uncollectable”（不可回收的）: 当 <em>phase</em> 为 “stop” 时，不能被回收并被放入 <code>garbage</code> 的对象的数目。</p>
</blockquote>
<p>应用程序可以把他们自己的回调函数加入此列表。主要的使用场景有：</p>
<blockquote>
<p>统计垃圾回收的数据，如：不同代的回收频率、回收所花费的时间。</p>
<p>使应用程序可以识别和清理他们自己的在 <code>garbage</code> 中的不可回收类型的对象。</p>
</blockquote>
<p>3.3 新版功能.</p>
<p>以下常量被用于 <code>set_debug()</code> ：</p>
<pre><code>gc.DEBUG_STATS</code></pre><p>在回收完成后打印统计信息。当回收频率设置较高时，这些信息会比较有用。</p>
<pre><code>gc.DEBUG_COLLECTABLE</code></pre><p>当发现可回收对象时打印信息。</p>
<pre><code>gc.DEBUG_UNCOLLECTABLE</code></pre><p>打印找到的不可回收对象的信息（指不能被回收器回收的不可达对象）。这些对象会被添加到 <code>garbage</code> 列表中。</p>
<p>在 3.2 版更改: 当 interpreter shutdown 时，即解释器关闭时，若 <code>garbage</code> 列表中存在对象，这些对象也会被打印输出。</p>
<pre><code>gc.DEBUG_SAVEALL</code></pre><p>设置后，所有回收器找到的不可达对象会被添加进 <em>garbage</em> 而不是直接被释放。这在调试一个内存泄漏的程序时会很有用。</p>
<pre><code>gc.DEBUG_LEAK</code></pre><p>调试内存泄漏的程序时，使回收器打印信息的调试标识位。（等价于 <code>DEBUG_COLLECTABLE | DEBUG_UNCOLLECTABLE | DEBUG_SAVEALL</code> ）。</p>
<h2 id="inspect-—-检查对象"><a href="#inspect-—-检查对象" class="headerlink" title="inspect —- 检查对象"></a><code>inspect</code> —- 检查对象</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/inspect.py" target="_blank" rel="noopener">Lib/inspect.py</a></p>
<hr>
<p><code>inspect</code> 模块提供了一些有用的函数帮助获取对象的信息，例如模块、类、方法、函数、回溯、帧对象以及代码对象。例如它可以帮助你检查类的内容，获取某个方法的源代码，取得并格式化某个函数的参数列表，或者获取你需要显示的回溯的详细信息。</p>
<p>该模块提供了4种主要的功能：类型检查、获取源代码、检查类与函数、检查解释器的调用堆栈。</p>
<h3 id="类型和成员"><a href="#类型和成员" class="headerlink" title="类型和成员"></a>类型和成员</h3><p><code>getmembers()</code> 函数获取对象的成员，例如类或模块。函数名以”is”开始的函数主要作为 <code>getmembers()</code> 的第2个参数使用。它们也可用于判定某对象是否有如下的特殊属性:</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">module — 模块</td>
<td align="left"><strong>doc</strong></td>
<td align="left">文档字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>file</strong></td>
<td align="left">文件名(内置模块没有文件名)</td>
</tr>
<tr>
<td align="left">class — 类</td>
<td align="left"><strong>doc</strong></td>
<td align="left">文档字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>name</strong></td>
<td align="left">类定义时所使用的名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>qualname</strong></td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>module</strong></td>
<td align="left">该类型被定义时所在的模块的名称</td>
</tr>
<tr>
<td align="left">method — 方法</td>
<td align="left"><strong>doc</strong></td>
<td align="left">文档字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>name</strong></td>
<td align="left">该方法定义时所使用的名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>qualname</strong></td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>func</strong></td>
<td align="left">实现该方法的函数对象</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>self</strong></td>
<td align="left">该方法被绑定的实例，若没有绑定则为 <code>None</code></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>module</strong></td>
<td align="left">定义此方法的模块的名称</td>
</tr>
<tr>
<td align="left">function — 函数</td>
<td align="left"><strong>doc</strong></td>
<td align="left">文档字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>name</strong></td>
<td align="left">用于定义此函数的名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>qualname</strong></td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>code</strong></td>
<td align="left">包含已编译函数的代码对象 bytecode</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>defaults</strong></td>
<td align="left">所有位置或关键字参数的默认值的元组</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>kwdefaults</strong></td>
<td align="left">mapping of any default values for keyword-only parameters</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>globals</strong></td>
<td align="left">global namespace in which this function was defined</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>builtins</strong></td>
<td align="left">builtins namespace</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>annotations</strong></td>
<td align="left">mapping of parameters names to annotations; <code>“return”</code> key is reserved for return annotations.</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>module</strong></td>
<td align="left">name of module in which this function was defined</td>
</tr>
<tr>
<td align="left">回溯</td>
<td align="left">tb<em>frame</em></td>
<td align="left">此级别的框架对象</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">tb_lasti</td>
<td align="left">index of last attempted instruction in bytecode</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">tb_lineno</td>
<td align="left">current line number in Python source code</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">tb_next</td>
<td align="left">next inner traceback object (called by this level)</td>
</tr>
<tr>
<td align="left">框架</td>
<td align="left">f_back</td>
<td align="left">next outer frame object (this frame’s caller)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_builtins</td>
<td align="left">builtins namespace seen by this frame</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_code</td>
<td align="left">code object being executed in this frame</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_globals</td>
<td align="left">global namespace seen by this frame</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_lasti</td>
<td align="left">index of last attempted instruction in bytecode</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_lineno</td>
<td align="left">current line number in Python source code</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_locals</td>
<td align="left">local namespace seen by this frame</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">f_trace</td>
<td align="left">tracing function for this frame, or <code>None</code></td>
</tr>
<tr>
<td align="left">code</td>
<td align="left">co_argcount</td>
<td align="left">number of arguments (not including keyword only arguments, <em>or *</em> args)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_code</td>
<td align="left">原始编译字节码的字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_cellvars</td>
<td align="left">单元变量名称的元组(通过包含作用域引用)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_consts</td>
<td align="left">字节码中使用的常量元组</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_filename</td>
<td align="left">创建此代码对象的文件的名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_firstlineno</td>
<td align="left">number of first line in Python source code</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_flags</td>
<td align="left">bitmap of <code>CO</code> <em>flags, read more here</em></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_lnotab</td>
<td align="left">编码的行号到字节码索引的映射</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_freevars</td>
<td align="left">tuple of names of free variables (referenced via a function’s closure)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_posonlyargcount</td>
<td align="left">number of positional only arguments</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co_kwonlyargcount</td>
<td align="left">number of keyword only arguments (not including * arg)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co<em>name</em></td>
<td align="left">定义此代码对象的名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co<em>names</em></td>
<td align="left">局部变量名称的元组</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co<em>nlocals</em></td>
<td align="left">局部变量的数量</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co<em>stacksize</em></td>
<td align="left">需要虚拟机堆栈空间</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">co<em>varnames</em></td>
<td align="left">参数名和局部变量的元组</td>
</tr>
<tr>
<td align="left">generator — 生成器</td>
<td align="left"><strong>name</strong></td>
<td align="left">名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>qualname</strong></td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">gi<em>frame</em></td>
<td align="left">框架</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">gi<em>running</em></td>
<td align="left">生成器在运行吗？</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">gi<em>code</em></td>
<td align="left">code</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">gi<em>yieldfrom</em></td>
<td align="left">object being iterated by <code>yield from</code>, or <code>None</code></td>
</tr>
<tr>
<td align="left">coroutine — 协程</td>
<td align="left"><strong>name</strong></td>
<td align="left">名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><em>_qualname</em></td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cr_await</td>
<td align="left">object being awaited on, or <code>None</code></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cr_frame</td>
<td align="left">框架</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cr_running</td>
<td align="left">is the coroutine running?</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cr_code</td>
<td align="left">code</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cr_origin</td>
<td align="left">where coroutine was created, or <code>None</code>. See <code>sys.set_coroutine_origin_tracking_depth()</code></td>
</tr>
<tr>
<td align="left">builtin</td>
<td align="left">__doc</td>
<td align="left">文档字符串</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">__name</td>
<td align="left">此函数或方法的原始名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">__qualname</td>
<td align="left">qualified name — 限定名称</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">__self</td>
<td align="left">instance to which a method is bound, or <code>None</code></td>
</tr>
</tbody></table>
<p>在 3.5 版更改: Add <code>__qualname__</code> and <code>gi_yieldfrom</code> attributes to generators.</p>
<p>The <code>__name__</code> attribute of generators is now set from the function name, instead of the code name, and it can now be modified.</p>
<p>在 3.7 版更改: Add <code>cr_origin</code> attribute to coroutines.</p>
<p>在 3.10 版更改: Add <code>__builtins__</code> attribute to functions.</p>
<p><code>inspect.getmembers</code>(<em>object</em>[, <em>predicate</em>])</p>
<p>Return all the members of an object in a list of <code>(name, value)</code> pairs sorted by name. If the optional <em>predicate</em> argument—which will be called with the <code>value</code> object of each member—is supplied, only members for which the predicate returns a true value are included.</p>
<p>注解</p>
<p><code>getmembers()</code> will only return class attributes defined in the metaclass when the argument is a class and those attributes have been listed in the metaclass’ custom <code>__dir__()</code>.</p>
<p><code>inspect.getmodulename</code>(<em>path</em>)</p>
<p>Return the name of the module named by the file <em>path</em>, without including the names of enclosing packages. The file extension is checked against all of the entries in <code>importlib.machinery.all_suffixes()</code>. If it matches, the final path component is returned with the extension removed. Otherwise, <code>None</code> is returned.</p>
<p>Note that this function <em>only</em> returns a meaningful name for actual Python modules - paths that potentially refer to Python packages will still return <code>None</code>.</p>
<p>在 3.3 版更改: The function is based directly on <code>importlib</code>.</p>
<p><code>inspect.ismodule</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a module.</p>
<p><code>inspect.isclass</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a class, whether built-in or created in Python code.</p>
<p><code>inspect.ismethod</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a bound method written in Python.</p>
<p><code>inspect.isfunction</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a Python function, which includes functions created by a lambda expression.</p>
<p><code>inspect.isgeneratorfunction</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a Python generator function.</p>
<p>在 3.8 版更改: Functions wrapped in <code>functools.partial()</code> now return <code>True</code> if the wrapped function is a Python generator function.</p>
<p><code>inspect.isgenerator</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a generator.</p>
<p><code>inspect.iscoroutinefunction</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a coroutine function (a function defined with an <code>async def</code> syntax).</p>
<p>3.5 新版功能.</p>
<p>在 3.8 版更改: Functions wrapped in <code>functools.partial()</code> now return <code>True</code> if the wrapped function is a coroutine function.</p>
<p><code>inspect.iscoroutine</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a coroutine created by an <code>async def</code> function.</p>
<p>3.5 新版功能.</p>
<p><code>inspect.isawaitable</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object can be used in <code>await</code> expression.</p>
<p>Can also be used to distinguish generator-based coroutines from regular generators:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span>
@types<span class="token punctuation">.</span>coroutine
<span class="token keyword">def</span> <span class="token function">gen_coro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span>
<span class="token keyword">assert</span> <span class="token operator">not</span> isawaitable<span class="token punctuation">(</span>gen<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> isawaitable<span class="token punctuation">(</span>gen_coro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.5 新版功能.</p>
<p><code>inspect.isasyncgenfunction</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is an asynchronous generator function, for example:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">agen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">yield</span> <span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> inspect<span class="token punctuation">.</span>isasyncgenfunction<span class="token punctuation">(</span>agen<span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.6 新版功能.</p>
<p>在 3.8 版更改: Functions wrapped in <code>functools.partial()</code> now return <code>True</code> if the wrapped function is a asynchronous generator function.</p>
<p><code>inspect.isasyncgen</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is an asynchronous generator iterator created by an asynchronous generator function.</p>
<p>3.6 新版功能.</p>
<p><code>inspect.istraceback</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a traceback.</p>
<p><code>inspect.isframe</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a frame.</p>
<p><code>inspect.iscode</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a code.</p>
<p><code>inspect.isbuiltin</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a built-in function or a bound built-in method.</p>
<p><code>inspect.isroutine</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a user-defined or built-in function or method.</p>
<p><code>inspect.isabstract</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is an abstract base class.</p>
<p><code>inspect.ismethoddescriptor</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a method descriptor, but not if <code>ismethod()</code>, <code>isclass()</code>, <code>isfunction()</code> or <code>isbuiltin()</code> are true.</p>
<p>This, for example, is true of <code>int.__add__</code>. An object passing this test has a <code>__get__()</code> method but not a <code>__set__()</code> method, but beyond that the set of attributes varies. A <code>__name__</code> attribute is usually sensible, and <code>__doc__</code> often is.</p>
<p>Methods implemented via descriptors that also pass one of the other tests return <code>False</code> from the <code>ismethoddescriptor()</code> test, simply because the other tests promise more — you can, e.g., count on having the <code>__func__</code> attribute (etc) when an object passes <code>ismethod()</code>.</p>
<p><code>inspect.isdatadescriptor</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a data descriptor.</p>
<p>Data descriptors have a <code>__set__</code> or a <code>__delete__</code> method. Examples are properties (defined in Python), getsets, and members. The latter two are defined in C and there are more specific tests available for those types, which is robust across Python implementations. Typically, data descriptors will also have <code>__name__</code> and <code>__doc__</code> attributes (properties, getsets, and members have both of these attributes), but this is not guaranteed.</p>
<p><code>inspect.isgetsetdescriptor</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a getset descriptor.</p>
<p><strong>CPython implementation detail:</strong> getsets are attributes defined in extension modules via <code>PyGetSetDef</code> structures. For Python implementations without such types, this method will always return <code>False</code>.</p>
<p><code>inspect.ismemberdescriptor</code>(<em>object</em>)</p>
<p>Return <code>True</code> if the object is a member descriptor.</p>
<p><strong>CPython implementation detail:</strong> Member descriptors are attributes defined in extension modules via <code>PyMemberDef</code> structures. For Python implementations without such types, this method will always return <code>False</code>.</p>
<h3 id="Retrieving-source-code"><a href="#Retrieving-source-code" class="headerlink" title="Retrieving source code"></a>Retrieving source code</h3><p><code>inspect.getdoc</code>(<em>object</em>)</p>
<p>Get the documentation string for an object, cleaned up with <code>cleandoc()</code>. If the documentation string for an object is not provided and the object is a class, a method, a property or a descriptor, retrieve the documentation string from the inheritance hierarchy.</p>
<p>在 3.5 版更改: Documentation strings are now inherited if not overridden.</p>
<p><code>inspect.getcomments</code>(<em>object</em>)</p>
<p>Return in a single string any lines of comments immediately preceding the object’s source code (for a class, function, or method), or at the top of the Python source file (if the object is a module). If the object’s source code is unavailable, return <code>None</code>. This could happen if the object has been defined in C or the interactive shell.</p>
<p><code>inspect.getfile</code>(<em>object</em>)</p>
<p>Return the name of the (text or binary) file in which an object was defined. This will fail with a <code>TypeError</code> if the object is a built-in module, class, or function.</p>
<p><code>inspect.getmodule</code>(<em>object</em>)</p>
<p>Try to guess which module an object was defined in.</p>
<p><code>inspect.getsourcefile</code>(<em>object</em>)</p>
<p>Return the name of the Python source file in which an object was defined. This will fail with a <code>TypeError</code> if the object is a built-in module, class, or function.</p>
<p><code>inspect.getsourcelines</code>(<em>object</em>)</p>
<p>Return a list of source lines and starting line number for an object. The argument may be a module, class, method, function, traceback, frame, or code object. The source code is returned as a list of the lines corresponding to the object and the line number indicates where in the original source file the first line of code was found. An <code>OSError</code> is raised if the source code cannot be retrieved.</p>
<p>在 3.3 版更改: <code>OSError</code> is raised instead of <code>IOError</code>, now an alias of the former.</p>
<p><code>inspect.getsource</code>(<em>object</em>)</p>
<p>Return the text of the source code for an object. The argument may be a module, class, method, function, traceback, frame, or code object. The source code is returned as a single string. An <code>OSError</code> is raised if the source code cannot be retrieved.</p>
<p>在 3.3 版更改: <code>OSError</code> is raised instead of <code>IOError</code>, now an alias of the former.</p>
<p><code>inspect.cleandoc</code>(<em>doc</em>)</p>
<p>Clean up indentation from docstrings that are indented to line up with blocks of code.</p>
<p>All leading whitespace is removed from the first line. Any leading whitespace that can be uniformly removed from the second line onwards is removed. Empty lines at the beginning and end are subsequently removed. Also, all tabs are expanded to spaces.</p>
<h3 id="Introspecting-callables-with-the-Signature-object"><a href="#Introspecting-callables-with-the-Signature-object" class="headerlink" title="Introspecting callables with the Signature object"></a>Introspecting callables with the Signature object</h3><p>3.3 新版功能.</p>
<p>The Signature object represents the call signature of a callable object and its return annotation. To retrieve a Signature object, use the <code>signature()</code> function.</p>
<p><code>inspect.signature</code>(<em>callable</em>, <em>**,</em> follow_wrapped=True<em>,</em> globals=None<em>,</em> locals=None<em>,</em> eval_str=False*)</p>
<p>Return a <code>Signature</code> object for the given <code>callable</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> inspect <span class="token keyword">import</span> signature
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span>int<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>sig<span class="token punctuation">)</span>
<span class="token string">'(a, *, b:int, **kwargs)'</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>sig<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token string">'b:int'</span>
<span class="token operator">>></span><span class="token operator">></span> sig<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>annotation
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Accepts a wide range of Python callables, from plain functions and classes to <code>functools.partial()</code> objects.</p>
<p>For objects defined in modules using stringized annotations (<code>from __future__ import annotations</code>), <code>signature()</code> will attempt to automatically un-stringize the annotations using <code>inspect.get_annotations()</code>. The <code>global</code>, <code>locals</code>, and <code>eval_str</code> parameters are passed into <code>inspect.get_annotations()</code> when resolving the annotations; see the documentation for <code>inspect.get_annotations()</code> for instructions on how to use these parameters.</p>
<p>Raises <code>ValueError</code> if no signature can be provided, and <code>TypeError</code> if that type of object is not supported. Also, if the annotations are stringized, and <code>eval_str</code> is not false, the <code>eval()</code> call(s) to un-stringize the annotations could potentially raise any kind of exception.</p>
<p>A slash(/) in the signature of a function denotes that the parameters prior to it are positional-only. For more info, see the FAQ entry on positional-only parameters.</p>
<p>3.5 新版功能: <code>follow_wrapped</code> parameter. Pass <code>False</code> to get a signature of <code>callable</code> specifically (<code>callable.__wrapped__</code> will not be used to unwrap decorated callables.)</p>
<p>3.10 新版功能: <code>globals</code>, <code>locals</code>, and <code>eval_str</code> parameters.</p>
<p>注解</p>
<p>Some callables may not be introspectable in certain implementations of Python. For example, in CPython, some built-in functions defined in C provide no metadata about their arguments.</p>
<p><em>class</em> <code>inspect.Signature</code>(<em>parameters=None</em>, <em>**,</em> return_annotation=Signature.empty*)</p>
<p>A Signature object represents the call signature of a function and its return annotation. For each parameter accepted by the function it stores a <code>Parameter</code> object in its <code>parameters</code> collection.</p>
<p>The optional <em>parameters</em> argument is a sequence of <code>Parameter</code> objects, which is validated to check that there are no parameters with duplicate names, and that the parameters are in the right order, i.e. positional-only first, then positional-or-keyword, and that parameters with defaults follow parameters without defaults.</p>
<p>The optional <em>return_annotation</em> argument, can be an arbitrary Python object, is the “return” annotation of the callable.</p>
<p>Signature objects are <em>immutable</em>. Use <code>Signature.replace()</code> to make a modified copy.</p>
<p>在 3.5 版更改: Signature objects are picklable and hashable.</p>
<ul>
<li><p><code>empty</code></p>
<p>A special class-level marker to specify absence of a return annotation.</p>
</li>
<li><p><code>parameters</code></p>
<p>An ordered mapping of parameters’ names to the corresponding <code>Parameter</code> objects. Parameters appear in strict definition order, including keyword-only parameters.</p>
<p>在 3.7 版更改: Python only explicitly guaranteed that it preserved the declaration order of keyword-only parameters as of version 3.7, although in practice this order had always been preserved in Python 3.</p>
</li>
<li><p><code>return_annotation</code></p>
<p>The “return” annotation for the callable. If the callable has no “return” annotation, this attribute is set to <code>Signature.empty</code>.</p>
</li>
<li><p><code>bind</code>(<em>\</em>args<em>,</em> <em>*kwargs</em>)</p>
<p>Create a mapping from positional and keyword arguments to parameters. Returns <code>BoundArguments</code> if <code>*args</code> and <code>**kwargs</code> match the signature, or raises a <code>TypeError</code>.</p>
</li>
<li><p><code>bind_partial</code>(<em>\</em>args<em>,</em> <em>*kwargs</em>)</p>
<p>Works the same way as <code>Signature.bind()</code>, but allows the omission of some required arguments (mimics <code>functools.partial()</code> behavior.) Returns <code>BoundArguments</code>, or raises a <code>TypeError</code> if the passed arguments do not match the signature.</p>
</li>
<li><p><code>replace</code>(<em>\</em>, parameters*)</p>
<p>Create a new Signature instance based on the instance replace was invoked on. It is possible to pass different <code>parameters</code> and/or <code>return_annotation</code> to override the corresponding properties of the base signature. To remove return_annotation from the copied Signature, pass in <code>Signature.empty</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>test<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> new_sig <span class="token operator">=</span> sig<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>return_annotation<span class="token operator">=</span><span class="token string">"new return anno"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>new_sig<span class="token punctuation">)</span>
<span class="token string">"(a, b) -> 'new return anno'"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><em>classmethod</em> <code>from_callable</code>(<em>obj</em>, <em>**,</em> follow_wrapped=True<em>,</em> globalns=None<em>,</em> localns=None*)</p>
<p>Return a <code>Signature</code> (or its subclass) object for a given callable <code>obj</code>. Pass <code>follow_wrapped=False</code> to get a signature of <code>obj</code> without unwrapping its <code>__wrapped__</code> chain. <code>globalns</code> and <code>localns</code> will be used as the namespaces when resolving annotations.</p>
<p>This method simplifies subclassing of <code>Signature</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MySignature</span><span class="token punctuation">(</span>Signature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
sig <span class="token operator">=</span> MySignature<span class="token punctuation">.</span>from_callable<span class="token punctuation">(</span>min<span class="token punctuation">)</span>
<span class="token keyword">assert</span> isinstance<span class="token punctuation">(</span>sig<span class="token punctuation">,</span> MySignature<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.5 新版功能.</p>
<p>3.10 新版功能: <code>globalns</code> and <code>localns</code> parameters.</p>
</li>
</ul>
<p><em>class</em> <code>inspect.Parameter</code>(<em>name</em>, <em>kind</em>, <em>**,</em> default=Parameter.empty<em>,</em> annotation=Parameter.empty*)</p>
<p>Parameter objects are <em>immutable</em>. Instead of modifying a Parameter object, you can use <code>Parameter.replace()</code> to create a modified copy.</p>
<p>在 3.5 版更改: Parameter objects are picklable and hashable.</p>
<ul>
<li><p><code>empty</code></p>
<p>A special class-level marker to specify absence of default values and annotations.</p>
</li>
<li><p><code>name</code></p>
<p>The name of the parameter as a string. The name must be a valid Python identifier.</p>
<p><strong>CPython implementation detail:</strong> CPython generates implicit parameter names of the form <code>.0</code> on the code objects used to implement comprehensions and generator expressions.</p>
<p>在 3.6 版更改: These parameter names are exposed by this module as names like <code>implicit0</code>.</p>
</li>
<li><p><code>default</code></p>
<p>The default value for the parameter. If the parameter has no default value, this attribute is set to <code>Parameter.empty</code>.</p>
</li>
<li><p><code>annotation</code></p>
<p>The annotation for the parameter. If the parameter has no annotation, this attribute is set to <code>Parameter.empty</code>.</p>
</li>
<li><p><code>kind</code></p>
<p>Describes how argument values are bound to the parameter. Possible values (accessible via <code>Parameter</code>, like <code>Parameter.KEYWORD_ONLY</code>):</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">含意</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>POSITIONAL_ONLY</em></td>
<td align="left">Value must be supplied as a positional argument. Positional only parameters are those which appear before a <code>/</code> entry (if present) in a Python function definition.</td>
</tr>
<tr>
<td align="left"><em>POSITIONAL_OR_KEYWORD</em></td>
<td align="left">Value may be supplied as either a keyword or positional argument (this is the standard binding behaviour for functions implemented in Python.)</td>
</tr>
<tr>
<td align="left"><em>VAR_POSITIONAL</em></td>
<td align="left">A tuple of positional arguments that aren’t bound to any other parameter. This corresponds to a <code>*args*</code> <em>parameter in a Python function definition.</em></td>
</tr>
<tr>
<td align="left"><em>KEYWORD_ONLY</em></td>
<td align="left">Value must be supplied as a keyword argument. Keyword only parameters are those which appear after a `` or <code>*args*</code> <em>entry in a Python function definition.</em></td>
</tr>
<tr>
<td align="left"><em>VAR_KEYWORD</em></td>
<td align="left">A dict of keyword arguments that aren’t bound to any other parameter. This corresponds to a <code>*kwargs</code> parameter in a Python function definition.</td>
</tr>
</tbody></table>
<p>Example: print all keyword-only arguments without default values:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> param <span class="token keyword">in</span> sig<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span>kind <span class="token operator">==</span> param<span class="token punctuation">.</span>KEYWORD_ONLY <span class="token operator">and</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        param<span class="token punctuation">.</span>default <span class="token keyword">is</span> param<span class="token punctuation">.</span>empty<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parameter:'</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>
Parameter<span class="token punctuation">:</span> c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>kind.description</code></p>
<p>Describes a enum value of Parameter.kind.</p>
<p>3.8 新版功能.</p>
<p>Example: print all descriptions of arguments:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> param <span class="token keyword">in</span> sig<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>kind<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
positional <span class="token operator">or</span> keyword
positional <span class="token operator">or</span> keyword
keyword<span class="token operator">-</span>only
keyword<span class="token operator">-</span>only<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>replace</code>(<em>\</em>, name, default*)</p>
<p>Create a new Parameter instance based on the instance replaced was invoked on. To override a <code>Parameter</code> attribute, pass the corresponding argument. To remove a default value or/and an annotation from a Parameter, pass <code>Parameter.empty</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> inspect <span class="token keyword">import</span> Parameter
<span class="token operator">>></span><span class="token operator">></span> param <span class="token operator">=</span> Parameter<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> Parameter<span class="token punctuation">.</span>KEYWORD_ONLY<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>param<span class="token punctuation">)</span>
<span class="token string">'foo=42'</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>param<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Will create a shallow copy of 'param'</span>
<span class="token string">'foo=42'</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>param<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>default<span class="token operator">=</span>Parameter<span class="token punctuation">.</span>empty<span class="token punctuation">,</span> annotation<span class="token operator">=</span><span class="token string">'spam'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token string">"foo:'spam'"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>在 3.4 版更改: In Python 3.3 Parameter objects were allowed to have <code>name</code> set to <code>None</code> if their <code>kind</code> was set to <code>POSITIONAL_ONLY</code>. This is no longer permitted.</p>
<p><em>class</em> <code>inspect.BoundArguments</code></p>
<p>Result of a <code>Signature.bind()</code> or <code>Signature.bind_partial()</code> call. Holds the mapping of arguments to the function’s parameters.</p>
<ul>
<li><p><code>arguments</code></p>
<p>A mutable mapping of parameters’ names to arguments’ values. Contains only explicitly bound arguments. Changes in <code>arguments</code> will reflect in <code>args</code> and <code>kwargs</code>.</p>
<p>Should be used in conjunction with <code>Signature.parameters</code> for any argument processing purposes.</p>
<p>注解</p>
<p>Arguments for which <code>Signature.bind()</code> or <code>Signature.bind_partial()</code> relied on a default value are skipped. However, if needed, use <code>BoundArguments.apply_defaults()</code> to add them.</p>
<p>在 3.9 版更改: <code>arguments</code> is now of type <code>dict</code>. Formerly, it was of type <code>collections.OrderedDict</code>.</p>
</li>
<li><p><code>args</code></p>
<p>A tuple of positional arguments values. Dynamically computed from the <code>arguments</code> attribute.</p>
</li>
<li><p><code>kwargs</code></p>
<p>A dict of keyword arguments values. Dynamically computed from the <code>arguments</code> attribute.</p>
</li>
<li><p><code>signature</code></p>
<p>A reference to the parent <code>Signature</code> object.</p>
</li>
<li><p><code>apply_defaults</code>()</p>
<p>Set default values for missing arguments.</p>
<p>For variable-positional arguments (<code>*args</code>) the default is an empty tuple.</p>
<p>For variable-keyword arguments (<code>**kwargs</code>) the default is an empty dict.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'ham'</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> ba <span class="token operator">=</span> inspect<span class="token punctuation">.</span>signature<span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token string">'spam'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> ba<span class="token punctuation">.</span>apply_defaults<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> ba<span class="token punctuation">.</span>arguments
<span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'spam'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token string">'ham'</span><span class="token punctuation">,</span> <span class="token string">'args'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.5 新版功能.</p>
</li>
</ul>
<p>The <code>args</code> and <code>kwargs</code> properties can be used to invoke functions:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>test<span class="token punctuation">)</span>
ba <span class="token operator">=</span> sig<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
test<span class="token punctuation">(</span><span class="token operator">*</span>ba<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>ba<span class="token punctuation">.</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>参见</p>
<p><a href="https://www.python.org/dev/peps/pep-0362" target="_blank" rel="noopener"><strong>PEP 362</strong></a> - Function Signature Object.</p>
<p>The detailed specification, implementation details and examples.</p>
<h3 id="类与函数"><a href="#类与函数" class="headerlink" title="类与函数"></a>类与函数</h3><p><code>inspect.getclasstree</code>(<em>classes</em>, <em>unique=False</em>)</p>
<p>Arrange the given list of classes into a hierarchy of nested lists. Where a nested list appears, it contains classes derived from the class whose entry immediately precedes the list. Each entry is a 2-tuple containing a class and a tuple of its base classes. If the <em>unique</em> argument is true, exactly one entry appears in the returned structure for each class in the given list. Otherwise, classes using multiple inheritance and their descendants will appear multiple times.</p>
<p><code>inspect.getargspec</code>(<em>func</em>)</p>
<p>Get the names and default values of a Python function’s parameters. A named tuple <code>ArgSpec(args, varargs, keywords, defaults)</code> is returned. <em>args</em> is a list of the parameter names. <em>varargs</em> and <em>keywords</em> are the names of the <code>*</code> and <code>**</code> parameters or <code>None</code>. <em>defaults</em> is a tuple of default argument values or <code>None</code> if there are no default arguments; if this tuple has <em>n</em> elements, they correspond to the last <em>n</em> elements listed in <em>args</em>.</p>
<p>3.0 版后已移除: Use <code>getfullargspec()</code> for an updated API that is usually a drop-in replacement, but also correctly handles function annotations and keyword-only parameters.</p>
<p>Alternatively, use <code>signature()</code> and Signature Object, which provide a more structured introspection API for callables.</p>
<p><code>inspect.getfullargspec</code>(<em>func</em>)</p>
<p>Get the names and default values of a Python function’s parameters. A named tuple is returned:</p>
<pre><code>FullArgSpec(args, varargs, varkw, defaults, kwonlyargs, kwonlydefaults, annotations)</code></pre><p><em>args</em> is a list of the positional parameter names. <em>varargs</em> is the name of the <code>*</code> parameter or <code>None</code> if arbitrary positional arguments are not accepted. <em>varkw</em> is the name of the <code>**</code> parameter or <code>None</code> if arbitrary keyword arguments are not accepted. <em>defaults</em> is an <em>n</em>-tuple of default argument values corresponding to the last <em>n</em> positional parameters, or <code>None</code> if there are no such defaults defined. <em>kwonlyargs</em> is a list of keyword-only parameter names in declaration order. <em>kwonlydefaults</em> is a dictionary mapping parameter names from <em>kwonlyargs</em> to the default values used if no argument is supplied. <em>annotations</em> is a dictionary mapping parameter names to annotations. The special key <code>"return"</code> is used to report the function return value annotation (if any).</p>
<p>Note that <code>signature()</code> and Signature Object provide the recommended API for callable introspection, and support additional behaviours (like positional-only arguments) that are sometimes encountered in extension module APIs. This function is retained primarily for use in code that needs to maintain compatibility with the Python 2 <code>inspect</code> module API.</p>
<p>在 3.4 版更改: This function is now based on <code>signature()</code>, but still ignores <code>__wrapped__</code> attributes and includes the already bound first parameter in the signature output for bound methods.</p>
<p>在 3.6 版更改: This method was previously documented as deprecated in favour of <code>signature()</code> in Python 3.5, but that decision has been reversed in order to restore a clearly supported standard interface for single-source Python 2/3 code migrating away from the legacy <code>getargspec()</code> API.</p>
<p>在 3.7 版更改: Python only explicitly guaranteed that it preserved the declaration order of keyword-only parameters as of version 3.7, although in practice this order had always been preserved in Python 3.</p>
<p><code>inspect.getargvalues</code>(<em>frame</em>)</p>
<p>Get information about arguments passed into a particular frame. A named tuple <code>ArgInfo(args, varargs, keywords, locals)</code> is returned. <em>args</em> is a list of the argument names. <em>varargs</em> and <em>keywords</em> are the names of the <code>*</code> and <code>**</code> arguments or <code>None</code>. <em>locals</em> is the locals dictionary of the given frame.</p>
<p>注解</p>
<p>This function was inadvertently marked as deprecated in Python 3.5.</p>
<p><code>inspect.formatargspec</code>(<em>args</em>[, <em>varargs</em>, <em>varkw</em>, <em>defaults</em>, <em>kwonlyargs</em>, <em>kwonlydefaults</em>, <em>annotations</em>[, <em>formatarg</em>, <em>formatvarargs</em>, <em>formatvarkw</em>, <em>formatvalue</em>, <em>formatreturns</em>, <em>formatannotations</em>]])</p>
<p>Format a pretty argument spec from the values returned by <code>getfullargspec()</code>.</p>
<p>The first seven arguments are (<code>args</code>, <code>varargs</code>, <code>varkw</code>, <code>defaults</code>, <code>kwonlyargs</code>, <code>kwonlydefaults</code>, <code>annotations</code>).</p>
<p>The other six arguments are functions that are called to turn argument names, <code>*</code> argument name, <code>**</code> argument name, default values, return annotation and individual annotations into strings, respectively.</p>
<p>例如:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> inspect <span class="token keyword">import</span> formatargspec<span class="token punctuation">,</span> getfullargspec
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> int<span class="token punctuation">,</span> b<span class="token punctuation">:</span> float<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> formatargspec<span class="token punctuation">(</span><span class="token operator">*</span>getfullargspec<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token string">'(a: int, b: float)'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.5 版后已移除: Use <code>signature()</code> and Signature Object, which provide a better introspecting API for callables.</p>
<p><code>inspect.formatargvalues</code>(<em>args</em>[, <em>varargs</em>, <em>varkw</em>, <em>locals</em>, <em>formatarg</em>, <em>formatvarargs</em>, <em>formatvarkw</em>, <em>formatvalue</em>])</p>
<p>Format a pretty argument spec from the four values returned by <code>getargvalues()</code>. The format* arguments are the corresponding optional formatting functions that are called to turn names and values into strings.</p>
<p>注解</p>
<p>This function was inadvertently marked as deprecated in Python 3.5.</p>
<p><code>inspect.getmro</code>(<em>cls</em>)</p>
<p>Return a tuple of class cls’s base classes, including cls, in method resolution order. No class appears more than once in this tuple. Note that the method resolution order depends on cls’s type. Unless a very peculiar user-defined metatype is in use, cls will be the first element of the tuple.</p>
<p><code>inspect.getcallargs</code>(<em>func</em>, <em>/</em>, <em>\</em>args<em>,</em> <em>*kwds</em>)</p>
<p>Bind the <em>args</em> and <em>kwds</em> to the argument names of the Python function or method <em>func</em>, as if it was called with them. For bound methods, bind also the first argument (typically named <code>self</code>) to the associated instance. A dict is returned, mapping the argument names (including the names of the <code>*</code> and <code>**</code> arguments, if any) to their values from <em>args</em> and <em>kwds</em>. In case of invoking <em>func</em> incorrectly, i.e. whenever <code>func(*args, **kwds)</code> would raise an exception because of incompatible signature, an exception of the same type and the same or similar message is raised. For example:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> inspect <span class="token keyword">import</span> getcallargs
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span>pos<span class="token punctuation">,</span> <span class="token operator">**</span>named<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token operator">>></span><span class="token operator">></span> getcallargs<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'named'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> getcallargs<span class="token punctuation">(</span>f<span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'named'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> getcallargs<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
TypeError<span class="token punctuation">:</span> f<span class="token punctuation">(</span><span class="token punctuation">)</span> missing <span class="token number">1</span> required positional argument<span class="token punctuation">:</span> <span class="token string">'a'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.2 新版功能.</p>
<p>3.5 版后已移除: Use <code>Signature.bind()</code> and <code>Signature.bind_partial()</code> instead.</p>
<p><code>inspect.getclosurevars</code>(<em>func</em>)</p>
<p>Get the mapping of external name references in a Python function or method <em>func</em> to their current values. A named tuple <code>ClosureVars(nonlocals, globals, builtins, unbound)</code> is returned. <em>nonlocals</em> maps referenced names to lexical closure variables, <em>globals</em> to the function’s module globals and <em>builtins</em> to the builtins visible from the function body. <em>unbound</em> is the set of names referenced in the function that could not be resolved at all given the current module globals and builtins.</p>
<p><code>TypeError</code> is raised if <em>func</em> is not a Python function or method.</p>
<p>3.3 新版功能.</p>
<p><code>inspect.unwrap</code>(<em>func</em>, <em>**,</em> stop=None*)</p>
<p>Get the object wrapped by <em>func</em>. It follows the chain of <code>__wrapped__</code> attributes returning the last object in the chain.</p>
<p><em>stop</em> is an optional callback accepting an object in the wrapper chain as its sole argument that allows the unwrapping to be terminated early if the callback returns a true value. If the callback never returns a true value, the last object in the chain is returned as usual. For example, <code>signature()</code> uses this to stop unwrapping if any object in the chain has a <code>__signature__</code> attribute defined.</p>
<p><code>ValueError</code> is raised if a cycle is encountered.</p>
<p>3.4 新版功能.</p>
<p><code>inspect.get_annotations</code>(<em>obj</em>, <em>**,</em> globals=None<em>,</em> locals=None<em>,</em> eval_str=False*)</p>
<p>Compute the annotations dict for an object.</p>
<p><code>obj</code> may be a callable, class, or module. Passing in an object of any other type raises <code>TypeError</code>.</p>
<p>Returns a dict. <code>get_annotations()</code> returns a new dict every time it’s called; calling it twice on the same object will return two different but equivalent dicts.</p>
<p>This function handles several details for you:</p>
<ul>
<li>If <code>eval_str</code> is true, values of type <code>str</code> will be un-stringized using <code>eval()</code>. This is intended for use with stringized annotations (<code>from __future__ import annotations</code>).</li>
<li>If <code>obj</code> doesn’t have an annotations dict, returns an empty dict. (Functions and methods always have an annotations dict; classes, modules, and other types of callables may not.)</li>
<li>Ignores inherited annotations on classes. If a class doesn’t have its own annotations dict, returns an empty dict.</li>
<li>All accesses to object members and dict values are done using <code>getattr()</code> and <code>dict.get()</code> for safety.</li>
<li>Always, always, always returns a freshly-created dict.</li>
</ul>
<p><code>eval_str</code> controls whether or not values of type <code>str</code> are replaced with the result of calling <code>eval()</code> on those values:</p>
<ul>
<li>If eval_str is true, <code>eval()</code> is called on values of type <code>str</code>. (Note that <code>get_annotations</code> doesn’t catch exceptions; if <code>eval()</code> raises an exception, it will unwind the stack past the <code>get_annotations</code> call.)</li>
<li>If eval_str is false (the default), values of type <code>str</code> are unchanged.</li>
</ul>
<p><code>globals</code> and <code>locals</code> are passed in to <code>eval()</code>; see the documentation for <code>eval()</code> for more information. If <code>globals</code> or <code>locals</code> is <code>None</code>, this function may replace that value with a context-specific default, contingent on <code>type(obj)</code>:</p>
<ul>
<li>If <code>obj</code> is a module, <code>globals</code> defaults to <code>obj.__dict__</code>.</li>
<li>If <code>obj</code> is a class, <code>globals</code> defaults to <code>sys.modules[obj.__module__].__dict__</code> and <code>locals</code> defaults to the <code>obj</code> class namespace.</li>
<li>If <code>obj</code> is a callable, <code>globals</code> defaults to <code>obj.__globals__</code>, although if <code>obj</code> is a wrapped function (using <code>functools.update_wrapper()</code>) it is first unwrapped.</li>
</ul>
<p>Calling <code>get_annotations</code> is best practice for accessing the annotations dict of any object. See 对象注解属性的最佳实践 for more information on annotations best practices.</p>
<p>3.10 新版功能.</p>
<h3 id="The-interpreter-stack"><a href="#The-interpreter-stack" class="headerlink" title="The interpreter stack"></a>The interpreter stack</h3><p>When the following functions return “frame records,” each record is a named tuple <code>FrameInfo(frame, filename, lineno, function, code_context, index)</code>. The tuple contains the frame object, the filename, the line number of the current line, the function name, a list of lines of context from the source code, and the index of the current line within that list.</p>
<p>在 3.5 版更改: Return a named tuple instead of a tuple.</p>
<p>注解</p>
<p>Keeping references to frame objects, as found in the first element of the frame records these functions return, can cause your program to create reference cycles. Once a reference cycle has been created, the lifespan of all objects which can be accessed from the objects which form the cycle can become much longer even if Python’s optional cycle detector is enabled. If such cycles must be created, it is important to ensure they are explicitly broken to avoid the delayed destruction of objects and increased memory consumption which occurs.</p>
<p>Though the cycle detector will catch these, destruction of the frames (and local variables) can be made deterministic by removing the cycle in a <code>finally</code> clause. This is also important if the cycle detector was disabled when Python was compiled or using <code>gc.disable()</code>. For example:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">handle_stackframe_without_leak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    frame <span class="token operator">=</span> inspect<span class="token punctuation">.</span>currentframe<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># do something with the frame</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">del</span> frame<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If you want to keep the frame around (for example to print a traceback later), you can also break reference cycles by using the <code>frame.clear()</code> method.</p>
<p>The optional <em>context</em> argument supported by most of these functions specifies the number of lines of context to return, which are centered around the current line.</p>
<p><code>inspect.getframeinfo</code>(<em>frame</em>, <em>context=1</em>)</p>
<p>Get information about a frame or traceback object. A named tuple <code>Traceback(filename, lineno, function, code_context, index)</code> is returned.</p>
<p><code>inspect.getouterframes</code>(<em>frame</em>, <em>context=1</em>)</p>
<p>Get a list of frame records for a frame and all outer frames. These frames represent the calls that lead to the creation of <em>frame</em>. The first entry in the returned list represents <em>frame</em>; the last entry represents the outermost call on <em>frame</em>‘s stack.</p>
<p>在 3.5 版更改: A list of named tuples <code>FrameInfo(frame, filename, lineno, function, code_context, index)</code> is returned.</p>
<p><code>inspect.getinnerframes</code>(<em>traceback</em>, <em>context=1</em>)</p>
<p>Get a list of frame records for a traceback’s frame and all inner frames. These frames represent calls made as a consequence of <em>frame</em>. The first entry in the list represents <em>traceback</em>; the last entry represents where the exception was raised.</p>
<p>在 3.5 版更改: A list of named tuples <code>FrameInfo(frame, filename, lineno, function, code_context, index)</code> is returned.</p>
<p><code>inspect.currentframe</code>()</p>
<p>Return the frame object for the caller’s stack frame.</p>
<p><strong>CPython implementation detail:</strong> This function relies on Python stack frame support in the interpreter, which isn’t guaranteed to exist in all implementations of Python. If running in an implementation without Python stack frame support this function returns <code>None</code>.</p>
<p><code>inspect.stack</code>(<em>context=1</em>)</p>
<p>Return a list of frame records for the caller’s stack. The first entry in the returned list represents the caller; the last entry represents the outermost call on the stack.</p>
<p>在 3.5 版更改: A list of named tuples <code>FrameInfo(frame, filename, lineno, function, code_context, index)</code> is returned.</p>
<p><code>inspect.trace</code>(<em>context=1</em>)</p>
<p>Return a list of frame records for the stack between the current frame and the frame in which an exception currently being handled was raised in. The first entry in the list represents the caller; the last entry represents where the exception was raised.</p>
<p>在 3.5 版更改: A list of named tuples <code>FrameInfo(frame, filename, lineno, function, code_context, index)</code> is returned.</p>
<h3 id="Fetching-attributes-statically"><a href="#Fetching-attributes-statically" class="headerlink" title="Fetching attributes statically"></a>Fetching attributes statically</h3><p>Both <code>getattr()</code> and <code>hasattr()</code> can trigger code execution when fetching or checking for the existence of attributes. Descriptors, like properties, will be invoked and <code>__getattr__()</code> and <code>__getattribute__()</code> may be called.</p>
<p>For cases where you want passive introspection, like documentation tools, this can be inconvenient. <code>getattr_static()</code> has the same signature as <code>getattr()</code> but avoids executing code when it fetches attributes.</p>
<p><code>inspect.getattr_static</code>(<em>obj</em>, <em>attr</em>, <em>default=None</em>)</p>
<p>Retrieve attributes without triggering dynamic lookup via the descriptor protocol, <code>__getattr__()</code> or <code>__getattribute__()</code>.</p>
<p>Note: this function may not be able to retrieve all attributes that getattr can fetch (like dynamically created attributes) and may find attributes that getattr can’t (like descriptors that raise AttributeError). It can also return descriptors objects instead of instance members.</p>
<p>If the instance <code>__dict__</code> is shadowed by another member (for example a property) then this function will be unable to find instance members.</p>
<p>3.2 新版功能.</p>
<p><code>getattr_static()</code> does not resolve descriptors, for example slot descriptors or getset descriptors on objects implemented in C. The descriptor object is returned instead of the underlying attribute.</p>
<p>You can handle these with code like the following. Note that for arbitrary getset descriptors invoking these may trigger code execution:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># example code for resolving the builtin descriptor types</span>
<span class="token keyword">class</span> <span class="token class-name">_foo</span><span class="token punctuation">:</span>
    __slots__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span>
slot_descriptor <span class="token operator">=</span> type<span class="token punctuation">(</span>_foo<span class="token punctuation">.</span>foo<span class="token punctuation">)</span>
getset_descriptor <span class="token operator">=</span> type<span class="token punctuation">(</span>type<span class="token punctuation">(</span>open<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
wrapper_descriptor <span class="token operator">=</span> type<span class="token punctuation">(</span>str<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'__add__'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
descriptor_types <span class="token operator">=</span> <span class="token punctuation">(</span>slot_descriptor<span class="token punctuation">,</span> getset_descriptor<span class="token punctuation">,</span> wrapper_descriptor<span class="token punctuation">)</span>
result <span class="token operator">=</span> getattr_static<span class="token punctuation">(</span>some_object<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> type<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token keyword">in</span> descriptor_types<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> result<span class="token punctuation">.</span>__get__<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># descriptors can raise AttributeError to</span>
        <span class="token comment" spellcheck="true"># indicate there is no underlying value</span>
        <span class="token comment" spellcheck="true"># in which case the descriptor itself will</span>
        <span class="token comment" spellcheck="true"># have to do</span>
        <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Current-State-of-Generators-and-Coroutines"><a href="#Current-State-of-Generators-and-Coroutines" class="headerlink" title="Current State of Generators and Coroutines"></a>Current State of Generators and Coroutines</h3><p>When implementing coroutine schedulers and for other advanced uses of generators, it is useful to determine whether a generator is currently executing, is waiting to start or resume or execution, or has already terminated. <code>getgeneratorstate()</code> allows the current state of a generator to be determined easily.</p>
<p><code>inspect.getgeneratorstate</code>(<em>generator</em>)</p>
<p>Get current state of a generator-iterator.</p>
<ul>
<li>Possible states are:<ul>
<li>GEN_CREATED: Waiting to start execution.</li>
<li>GEN_RUNNING: Currently being executed by the interpreter.</li>
<li>GEN_SUSPENDED: Currently suspended at a yield expression.</li>
<li>GEN_CLOSED: Execution has completed.</li>
</ul>
</li>
</ul>
<p>3.2 新版功能.</p>
<p><code>inspect.getcoroutinestate</code>(<em>coroutine</em>)</p>
<p>Get current state of a coroutine object. The function is intended to be used with coroutine objects created by <code>async def</code> functions, but will accept any coroutine-like object that has <code>cr_running</code> and <code>cr_frame</code> attributes.</p>
<ul>
<li>Possible states are:<ul>
<li>CORO_CREATED: Waiting to start execution.</li>
<li>CORO_RUNNING: Currently being executed by the interpreter.</li>
<li>CORO_SUSPENDED: Currently suspended at an await expression.</li>
<li>CORO_CLOSED: Execution has completed.</li>
</ul>
</li>
</ul>
<p>3.5 新版功能.</p>
<p>The current internal state of the generator can also be queried. This is mostly useful for testing purposes, to ensure that internal state is being updated as expected:</p>
<p><code>inspect.getgeneratorlocals</code>(<em>generator</em>)</p>
<p>Get the mapping of live local variables in <em>generator</em> to their current values. A dictionary is returned that maps from variable names to values. This is the equivalent of calling <code>locals()</code> in the body of the generator, and all the same caveats apply.</p>
<p>If <em>generator</em> is a generator with no currently associated frame, then an empty dictionary is returned. <code>TypeError</code> is raised if <em>generator</em> is not a Python generator object.</p>
<p><strong>CPython implementation detail:</strong> This function relies on the generator exposing a Python stack frame for introspection, which isn’t guaranteed to be the case in all implementations of Python. In such cases, this function will always return an empty dictionary.</p>
<p>3.3 新版功能.</p>
<p><code>inspect.getcoroutinelocals</code>(<em>coroutine</em>)</p>
<p>This function is analogous to <code>getgeneratorlocals()</code>, but works for coroutine objects created by <code>async def</code> functions.</p>
<p>3.5 新版功能.</p>
<h3 id="Code-Objects-Bit-Flags"><a href="#Code-Objects-Bit-Flags" class="headerlink" title="Code Objects Bit Flags"></a>Code Objects Bit Flags</h3><p>Python code objects have a <code>co_flags</code> attribute, which is a bitmap of the following flags:</p>
<pre><code>inspect.CO_OPTIMIZED</code></pre><p>The code object is optimized, using fast locals.</p>
<pre><code>inspect.CO_NEWLOCALS</code></pre><p>If set, a new dict will be created for the frame’s <code>f_locals</code> when the code object is executed.</p>
<pre><code>inspect.CO_VARARGS</code></pre><p>The code object has a variable positional parameter (<code>*args</code>-like).</p>
<pre><code>inspect.CO_VARKEYWORDS</code></pre><p>The code object has a variable keyword parameter (<code>**kwargs</code>-like).</p>
<pre><code>inspect.CO_NESTED</code></pre><p>The flag is set when the code object is a nested function.</p>
<pre><code>inspect.CO_GENERATOR</code></pre><p>The flag is set when the code object is a generator function, i.e. a generator object is returned when the code object is executed.</p>
<pre><code>inspect.CO_NOFREE</code></pre><p>The flag is set if there are no free or cell variables.</p>
<pre><code>inspect.CO_COROUTINE</code></pre><p>The flag is set when the code object is a coroutine function. When the code object is executed it returns a coroutine object. See <a href="https://www.python.org/dev/peps/pep-0492" target="_blank" rel="noopener"><strong>PEP 492</strong></a> for more details.</p>
<p>3.5 新版功能.</p>
<pre><code>inspect.CO_ITERABLE_COROUTINE</code></pre><p>The flag is used to transform generators into generator-based coroutines. Generator objects with this flag can be used in <code>await</code> expression, and can <code>yield from</code> coroutine objects. See <a href="https://www.python.org/dev/peps/pep-0492" target="_blank" rel="noopener"><strong>PEP 492</strong></a> for more details.</p>
<p>3.5 新版功能.</p>
<pre><code>inspect.CO_ASYNC_GENERATOR</code></pre><p>The flag is set when the code object is an asynchronous generator function. When the code object is executed it returns an asynchronous generator object. See <a href="https://www.python.org/dev/peps/pep-0525" target="_blank" rel="noopener"><strong>PEP 525</strong></a> for more details.</p>
<p>3.6 新版功能.</p>
<p>注解</p>
<p>The flags are specific to CPython, and may not be defined in other Python implementations. Furthermore, the flags are an implementation detail, and can be removed or deprecated in future Python releases. It’s recommended to use public APIs from the <code>inspect</code> module for any introspection needs.</p>
<h3 id="命令行界面"><a href="#命令行界面" class="headerlink" title="命令行界面"></a>命令行界面</h3><p>The <code>inspect</code> module also provides a basic introspection capability from the command line.</p>
<p>By default, accepts the name of a module and prints the source of that module. A class or function within the module can be printed instead by appended a colon and the qualified name of the target object.</p>
<pre><code>--details</code></pre><p>Print information about the specified object rather than the source code</p>
<h2 id="site-——-指定域的配置钩子"><a href="#site-——-指定域的配置钩子" class="headerlink" title="site —— 指定域的配置钩子"></a><code>site</code> —— 指定域的配置钩子</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/site.py" target="_blank" rel="noopener">Lib/site.py</a></p>
<hr>
<p><strong>这个模块将在初始化时被自动导入。</strong> 此自动导入可以通过使用解释器的 <code>-S</code> 选项来屏蔽。</p>
<p>导入此模块将会附加域特定的路径到模块搜索路径并且添加一些内建对象，除非使用了 <code>-S</code> 选项。 那样的话，模块可以被安全地导入，而不会对模块搜索路径和内建对象有自动的修改或添加。要明确地触发通常域特定的添加，调用函数 <code>site.main()</code>。</p>
<p>在 3.3 版更改: 在之前即便使用了 <code>-S</code>，导入此模块仍然会触发路径操纵。</p>
<p>It starts by constructing up to four directories from a head and a tail part. For the head part, it uses <code>sys.prefix</code> and <code>sys.exec_prefix</code>; empty heads are skipped. For the tail part, it uses the empty string and then <code>lib/site-packages</code> (on Windows) or <code>lib/python*X.Y*/site-packages</code> (on Unix and macOS). For each of the distinct head-tail combinations, it sees if it refers to an existing directory, and if so, adds it to <code>sys.path</code> and also inspects the newly added path for configuration files.</p>
<p>在 3.5 版更改: 对 “site-python” 目录的支持已被移除。</p>
<p>如果名为 “pyvenv.cfg” 的文件存在于 sys.executable 之上的一个目录中，则 sys.prefix 和 sys.exec_prefix 将被设置为该目录，并且还会检查 site-packages （ sys.base_prefix 和 sys.base_exec_prefix 始终是 Python 安装的 “真实” 前缀）。 如果 “pyvenv.cfg” （引导程序配置文件）包含设置为非 “true”（不区分大小写）的 “include-system-site-packages” 键，则不会在系统级前缀中搜索 site-packages；反之则会。</p>
<p>一个路径配置文件是具有 <code>*name*.pth</code> 命名格式的文件，并且存在上面提到的四个目录之一中；它的内容是要添加到 <code>sys.path</code> 中的额外项目（每行一个）。不存在的项目不会添加到 <code>sys.path</code>，并且不会检查项目指向的是目录还是文件。项目不会被添加到 <code>sys.path</code> 超过一次。空行和由 <code>#</code> 起始的行会被跳过。以 <code>import</code> 开始的行（跟着空格或 TAB）会被执行。</p>
<p>注解</p>
<p>每次启动 Python，在 <code>.pth</code> 文件中的可执行行都将会被运行，而不管特定的模块实际上是否需要被使用。 因此，其影响应降至最低。可执行行的主要预期目的是使相关模块可导入（加载第三方导入钩子，调整 <code>PATH</code> 等）。如果它发生了，任何其他的初始化都应当在模块实际导入之前完成。将代码块限制为一行是一种有意采取的措施，不鼓励在此处放置更复杂的内容。</p>
<p>例如，假设 <code>sys.prefix</code> 和 <code>sys.exec_prefix</code> 已经被设置为 <code>/usr/local</code>。 Python X.Y 的库之后被安装为 <code>/usr/local/lib/python*X.Y*</code>。假设有一个拥有三个孙目录 <code>foo</code>, <code>bar</code> 和 <code>spam</code> 的子目录 <code>/usr/local/lib/python*X.Y*/site-packages</code>，并且有两个路径配置文件 <code>foot.pth</code> 和 <code>bar.pth</code>。假定 <code>foo.pth</code> 内容如下:</p>
<pre><code># foo package configuration
foo
bar
bletch</code></pre><p>并且 <code>bar.pth</code> 包含:</p>
<pre><code># bar package configuration
bar</code></pre><p>则下面特定版目录将以如下顺序被添加到 <code>sys.path</code>。</p>
<pre><code>/usr/local/lib/pythonX.Y/site-packages/bar
/usr/local/lib/pythonX.Y/site-packages/foo</code></pre><p>请注意 <code>bletch</code> 已被省略因为它并不存在；<code>bar</code> 目前在 <code>foo</code> 目录之前因为 <code>bar.pth</code> 按字母顺序排在 <code>foo.pth</code> 之前；而 <code>spam</code> 已被省略因为它在两个路径配置文件中都未被提及。</p>
<p>在这些路径操作之后，会尝试导入一个名为 <code>sitecustomize</code> 的模块，它可以执行任意站点专属的定制。 它通常是由系统管理员在 site-packages 目录下创建的。 如此此导入失败并引发 <code>ImportError</code> 或其子类异常，并且异常的 <code>name</code> 属性等于 <code>'sitecustomize'</code>，则它会被静默地忽略。 如果 Python 是在没有可用输出流的情况下启动的，例如在 Windows 上使用 <code>pythonw.exe</code> (它默认被用于启动 start IDLE)，则来自 <code>sitecustomize</code> 的输出尝试会被忽略。 任何其他异常都会导致静默且可能令人迷惑不解的进程失败。</p>
<p>在此之后，会尝试导入一个名为 <code>usercustomize</code> 的模块，它可以执行任意用户专属的定制，如果 <code>ENABLE_USER_SITE</code> 为真值的话。 这个文件应该在用户的 site-packages 目录中创建（见下文），该目录是 <code>sys.path</code> 的组成部分，除非被 <code>-s</code> 所禁用。 如果此导入失败并引发 <code>ImportError</code> 或者其子类异常，并且异常的 <code>name</code> 属性等于 <code>'usercustomize'</code>，它会被静默地忽略。</p>
<p>请注意对于某些非 Unix 系统来说，<code>sys.prefix</code> 和 <code>sys.exec_prefix</code> 均为空值，并且路径操作会被跳过；但是仍然会尝试导入 <code>sitecustomize</code> 和 <code>usercustomize</code>。</p>
<h3 id="Readline-配置"><a href="#Readline-配置" class="headerlink" title="Readline 配置"></a>Readline 配置</h3><p>在支持 <code>readline</code> 的系统上，这个模块也将导入并配置 <code>rlcompleter</code> 模块，如果 Python 是以 交互模式 启动并且不带 <code>-S</code> 选项的话。 默认的行为是启用 tab 键补全并使用 <code>~/.python_history</code> 作为历史存档文件。 要禁用它，请删除（或重载）你的 <code>sitecustomize</code> 或 <code>usercustomize</code> 模块或 <code>PYTHONSTARTUP</code> 文件中的 <code>sys.__interactivehook__</code> 属性。</p>
<p>在 3.4 版更改: rlcompleter 和 history 会被自动激活。</p>
<h3 id="模块内容-2"><a href="#模块内容-2" class="headerlink" title="模块内容"></a>模块内容</h3><pre><code>site.PREFIXES</code></pre><p>site-packages 目录的前缀列表。</p>
<pre><code>site.ENABLE_USER_SITE</code></pre><p>显示用户 site-packages 目录状态的旗标。 <code>True</code> 意味着它被启用并被添加到 <code>sys.path</code>。 <code>False</code> 意味着它按照用户请求被禁用 (通过 <code>-s</code> 或 <code>PYTHONNOUSERSITE</code>)。 <code>None</code> 意味着它因安全理由（user 或 group id 和 effective id 之间不匹配）或是被管理员所禁用。</p>
<pre><code>site.USER_SITE</code></pre><p>Path to the user site-packages for the running Python. Can be <code>None</code> if <code>getusersitepackages()</code> hasn’t been called yet. Default value is <code>~/.local/lib/python*X.Y*/site-packages</code> for UNIX and non-framework macOS builds, <code>~/Library/Python/*X.Y*/lib/python/site-packages</code> for macOS framework builds, and <code>*%APPDATA%*\Python\Python*XY*\site-packages</code> on Windows. This directory is a site directory, which means that <code>.pth</code> files in it will be processed.</p>
<pre><code>site.USER_BASE</code></pre><p>Path to the base directory for the user site-packages. Can be <code>None</code> if <code>getuserbase()</code> hasn’t been called yet. Default value is <code>~/.local</code> for UNIX and macOS non-framework builds, <code>~/Library/Python/*X.Y*</code> for macOS framework builds, and <code>*%APPDATA%*\Python</code> for Windows. This value is used by Distutils to compute the installation directories for scripts, data files, Python modules, etc. for the user installation scheme. See also <code>PYTHONUSERBASE</code>.</p>
<p><code>site.main</code>()</p>
<p>将所有的标准站点专属目录添加到模块搜索路径。 这个函数会在导入此模块时被自动调用，除非 Python 解释器启动时附带了 <a href="https://www.bookstack.cn/read/python-3.10.0-zh/ec5d5b3d3a9e7fcc.md#cmdoption-S" target="_blank" rel="noopener"><code>-S</code></a> 旗标。</p>
<p>在 3.3 版更改: 这个函数使用无条件调用。</p>
<p><code>site.addsitedir</code>(<em>sitedir</em>, <em>known_paths=None</em>)</p>
<p>将一个目录添加到 sys.path 并处理其 <code>.pth</code> 文件。 通常被用于 <code>sitecustomize</code> 或 <code>usercustomize</code> (见下文)。</p>
<p><code>site.getsitepackages</code>()</p>
<p>返回包含所有全局 site-packages 目录的列表。</p>
<p>3.2 新版功能.</p>
<p><code>site.getuserbase</code>()</p>
<p>返回用户基准目录的路径 <code>USER_BASE</code>。 如果它尚未被初始化，则此函数还将参照 <code>PYTHONUSERBASE</code> 来设置它。</p>
<p>3.2 新版功能.</p>
<p><code>site.getusersitepackages</code>()</p>
<p>返回用户专属 site-packages 目录的路径 <code>USER_SITE</code>。 如果它尚未被初始化，则此函数还将参照 <code>USER_BASE</code> 来设置它。 要确定用户专属 site-packages 是否已被添加到 <code>sys.path</code> 则应当使用 <code>ENABLE_USER_SITE</code>。</p>
<p>3.2 新版功能.</p>
<h3 id="命令行界面-1"><a href="#命令行界面-1" class="headerlink" title="命令行界面"></a>命令行界面</h3><p><code>site</code> 模块还提供了一个从命令行获取用户目录的方式:</p>
<pre><code>$ python3 -m site --user-site
/home/user/.local/lib/python3.3/site-packages</code></pre><p>如果它被不带参数地调用，它将在标准输出打印 <code>sys.path</code> 的内容，再打印 <code>USER_BASE</code> 的值以及该目录是否存在，然后打印 <code>USER_SITE</code> 的相应信息，最后打印 <code>ENABLE_USER_SITE</code> 的值。</p>
<pre><code>--user-base</code></pre><p>输出用户基本的路径。</p>
<pre><code>--user-site</code></pre><p>输出用户site-packages目录的路径。</p>
<p>如果同时给出了两个选项，则将打印用户基准目录和用户站点信息（总是按此顺序），并以 <code>os.pathsep</code> 分隔。</p>
<p>如果给出了其中一个选项，脚本将退出并返回以下值中的一个：如果用户级 site-packages 目录被启用则为 <code>0</code>，如果它被用户禁用则为 <code>1</code>，如果它因安全理由或被管理员禁用则为 <code>2</code>，如果发生错误则为大于 2 的值。</p>
<p>参见</p>
<p><a href="https://www.python.org/dev/peps/pep-0370" target="_blank" rel="noopener"><strong>PEP 370</strong></a> — 分用户的 site-packages 目录</p>
<h1 id="自定义-Python-解释器"><a href="#自定义-Python-解释器" class="headerlink" title="自定义 Python 解释器"></a>自定义 Python 解释器</h1><p>本章中描述的模块允许编写类似于 Python 的交互式解释器的接口。 如果你想要一个支持附加一些特殊功能到 Python 语言的 Python 解释器，你应该看看 <code>code</code> 模块。 （ <code>codeop</code> 模块是低层级的，用于支持编译可能不完整的 Python 代码块。）</p>
<p>本章描述的完整模块列表如下：</p>
<ul>
<li><code>code</code> —- 解释器基类<ul>
<li>交互解释器对象</li>
<li>交互式控制台对象</li>
</ul>
</li>
<li><code>codeop</code> —- 编译Python代码</li>
</ul>
<h2 id="code-—-解释器基类"><a href="#code-—-解释器基类" class="headerlink" title="code —- 解释器基类"></a><code>code</code> —- 解释器基类</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/code.py" target="_blank" rel="noopener">Lib/code.py</a></p>
<hr>
<p><code>code</code> 模块提供了在 Python 中实现 read-eval-print 循环的功能。它包含两个类和一些快捷功能，可用于构建提供交互式解释器的应用程序。</p>
<p><em>class</em> <code>code.InteractiveInterpreter</code>(<em>locals=None</em>)</p>
<p>这个类处理解析器和解释器状态（用户命名空间的）；它不处理缓冲器、终端提示区或着输入文件名（文件名总是显示地传递）。可选的 <em>locals</em> 参数指定一个字典，字典里面包含将在此类执行的代码；它默认创建新的字典，其键 <code>'__name__'</code> 设置为 <code>'__console__'</code> ，键 <code>'__doc__'</code> 设置为 <code>None</code> 。</p>
<p><em>class</em> <code>code.InteractiveConsole</code>(<em>locals=None</em>, <em>filename=’&lt;console&gt;’</em>)</p>
<p>尽可能模拟交互式 Python 解释器的行为。此类建立在 <code>InteractiveInterpreter</code> 的基础上，使用熟悉的 <code>sys.ps1</code> 和 <code>sys.ps2</code> 作为输入提示符，并有输入缓冲。</p>
<p><code>code.interact</code>(<em>banner=None</em>, <em>readfunc=None</em>, <em>local=None</em>, <em>exitmsg=None</em>)</p>
<p>运行一个 read-eval-print 循环的便捷函数。这会创建一个新的 <code>InteractiveConsole</code> 实例。如果提供了 <em>readfunc</em> ，会设置为 <code>InteractiveConsole.raw_input()</code> 方法。如果提供了 <em>local</em> ，则将其传递给 <code>InteractiveConsole</code> 的构造函数，以用作解释器循环的默认命名空间。然后，如果提供了 <em>banner</em> 和 <em>exitmsg</em> ，实例的 <code>interact()</code> 方法会以此为标题和退出消息。控制台对象在使用后将被丢弃。</p>
<p>在 3.6 版更改: 加入 <em>exitmsg</em> 参数。</p>
<p><code>code.compile_command</code>(<em>source</em>, <em>filename=’&lt;input&gt;’</em>, <em>symbol=’single’</em>)</p>
<p>这个函数主要用来模拟 Python 解释器的主循环（即 read-eval-print 循环）。难点的部分是当用户输入不完整命令时，判断能否通过之后的输入来完成（要么成为完整的命令，要么语法错误）。该函数 <em>几乎</em> 和实际的解释器主循环的判断是相同的。</p>
<p><em>source</em> 是源字符串；<em>filename</em> 是可选的用作读取源的文件名，默认为 <code>'&lt;input&gt;'</code>；<em>symbol</em> 是可选的语法开启符号，应为 <code>'single'</code> (默认), <code>'eval'</code> 或 <code>'exec'</code>。</p>
<p>如果命令完整且有效则返回一个代码对象 (等价于 <code>compile(source, filename, symbol)</code>)；如果命令不完整则返回 <code>None</code>；如果命令完整但包含语法错误则会引发 <code>SyntaxError</code> 或 <code>OverflowError</code> 而如果命令包含无效字面值则将引发 <code>ValueError</code>。</p>
<h3 id="交互解释器对象"><a href="#交互解释器对象" class="headerlink" title="交互解释器对象"></a>交互解释器对象</h3><p><code>InteractiveInterpreter.runsource</code>(<em>source</em>, <em>filename=’&lt;input&gt;’</em>, <em>symbol=’single’</em>)</p>
<p>在解释器中编译并运行一段源码。 所用参数与 <code>compile_command()</code> 一样；<em>filename</em> 的默认值为 <code>'&lt;input&gt;'</code>，<em>symbol</em> 则为 <code>'single'</code>。 可能发生以下情况之一：</p>
<ul>
<li>输入不正确；<code>compile_command()</code> 引发了一个异常 (<code>SyntaxError</code> 或 <code>OverflowError</code>)。 将通过调用 <code>showsyntaxerror()</code> 方法打印语法回溯信息。 <code>runsource()</code> 返回 <code>False</code>。</li>
<li>输入不完整，需要更多输入；函数 <code>compile_command()</code> 返回 <code>None</code> 。方法 <code>runsource()</code> 返回 <code>True</code> 。</li>
<li>输入完整；<code>compile_command()</code> 返回了一个代码对象。 将通过调用 <code>runcode()</code> 执行代码（该方法也会处理运行时异常，<code>SystemExit</code> 除外）。 <code>runsource()</code> 返回 <code>False</code>。</li>
</ul>
<p>该返回值用于决定使用 <code>sys.ps1</code> 还是 <code>sys.ps2</code> 来作为下一行的输入提示符。</p>
<p><code>InteractiveInterpreter.runcode</code>(<em>code</em>)</p>
<p>执行一个代码对象。当发生异常时，调用 <code>showtraceback()</code> 来显示回溯。除 <code>SystemExit</code> （允许传播）以外的所有异常都会被捕获。</p>
<p>有关 <code>KeyboardInterrupt</code> 的说明，该异常可能发生于此代码的其他位置，并且并不总能被捕获。 调用者应当准备好处理它。</p>
<p><code>InteractiveInterpreter.showsyntaxerror</code>(<em>filename=None</em>)</p>
<p>显示刚发生的语法错误。 这不会显示堆栈回溯因为语法错误并无此种信息。 如果给出了 <em>filename</em>，它会被放入异常来替代 Python 解析器所提供的默认文件名，因为它在从一个字符串读取时总是会使用 <code>'&lt;string&gt;'</code>。 输出将由 <code>write()</code> 方法来写入。</p>
<p><code>InteractiveInterpreter.showtraceback</code>()</p>
<p>显示刚发生的异常。 我们移除了第一个堆栈条目因为它从属于解释器对象的实现。 输出将由 <code>write()</code> 方法来写入。</p>
<p>在 3.5 版更改: 将显示完整的链式回溯，而不只是主回溯。</p>
<p><code>InteractiveInterpreter.write</code>(<em>data</em>)</p>
<p>将一个字符串写入到标准错误流 (<code>sys.stderr</code>)。 所有派生类都应重载此方法以提供必要的正确输出处理。</p>
<h3 id="交互式控制台对象"><a href="#交互式控制台对象" class="headerlink" title="交互式控制台对象"></a>交互式控制台对象</h3><p><code>InteractiveConsole</code> 类是 <code>InteractiveInterpreter</code> 的子类，因此它提供了解释器对象的所有方法，还有以下的额外方法。</p>
<p><code>InteractiveConsole.interact</code>(<em>banner=None</em>, <em>exitmsg=None</em>)</p>
<p>近似地模拟交互式 Python 终端。 可选的 <em>banner</em> 参数指定要在第一次交互前打印的条幅；默认情况下会类似于标准 Python 解释器所打印的内容，并附上外加圆括号的终端对象类名（这样就不会与真正的解释器混淆 —— 因为确实太像了！）</p>
<p>可选的 <em>exitmsg</em> 参数指定要在退出时打印的退出消息。 传入空字符串可以屏蔽退出消息。 如果 <em>exitmsg</em> 未给出或为 <code>None</code>，则将打印默认消息。</p>
<p>在 3.4 版更改: 要禁止打印任何条幅消息，请传递一个空字符串。</p>
<p>在 3.6 版更改: 退出时打印退出消息。</p>
<p><code>InteractiveConsole.push</code>(<em>line</em>)</p>
<p>将一行源文本推入解释器。 行内容不应带有末尾换行符；它可以有内部换行符。 行内容会被添加到一个缓冲区并且会调用解释器的 <code>runsource()</code> 方法，附带缓冲区内容的拼接结果作为源文本。 如果显示命令已执行或不合法，缓冲区将被重置；否则，则命令尚未结束，缓冲区将在添加行后保持原样。 如果要求更多输入则返回值为 <code>True</code>，如果行已按某种方式被处理则返回值为 <code>False</code> (这与 <code>runsource()</code> 相同)。</p>
<p><code>InteractiveConsole.resetbuffer</code>()</p>
<p>从输入缓冲区中删除所有未处理的内容。</p>
<p><code>InteractiveConsole.raw_input</code>(<em>prompt=’’</em>)</p>
<p>输出提示并读取一行。返回的行不包含末尾的换行符。当用户输入 EOF 键序列时，会引发 <code>EOFError</code> 异常。默认实现是从 <code>sys.stdin</code> 读取；子类可以用其他实现代替。</p>
<h2 id="codeop-—-编译Python代码"><a href="#codeop-—-编译Python代码" class="headerlink" title="codeop —- 编译Python代码"></a><code>codeop</code> —- 编译Python代码</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/codeop.py" target="_blank" rel="noopener">Lib/codeop.py</a></p>
<hr>
<p><code>codeop</code> 模块提供了可以模拟Python读取-执行-打印循环的实用程序，就像在 <code>code</code> 模块中一样。因此，您可能不希望直接使用该模块；如果你想在程序中包含这样一个循环，你可能需要使用 <code>code</code> 模块。</p>
<p>这个任务有两个部分:</p>
<ol>
<li>能够判断一行输入是否完成了一个Python语句：简而言之，告诉我们是否要打印 ‘<code>&gt;&gt;&gt;</code>‘ 或 ‘<code>...</code>‘。</li>
<li>记住用户已输入了哪些 future 语句，这样后续的输入可以在这些语句被启用的状态下被编译。</li>
</ol>
<p><code>codeop</code> 模块提供了分别以及同时执行这两个部分的方式。</p>
<p>只执行前一部分：</p>
<p><code>codeop.compile_command</code>(<em>source</em>, <em>filename=’<input>’</em>, <em>symbol=’single’</em>)</p>
<p>尝试编译 <em>source*，这应当是一个 Python 代码字符串，并且在 *source</em> 是有效的 Python 代码时返回一个代码对象。 在此情况下，代码对象的 filename 属性将为 <em>filename*，其默认值为 <code>'&lt;input&gt;'</code>。 如果 *source</em> <em>不是</em> 有效的 Python 代码而是有效的 Python 代码的一个前缀时将返回 <code>None</code>。</p>
<p>如果 <em>source</em> 存在问题，将引发异常。 如果存在无效的 Python 语法将引发 <code>SyntaxError</code>，而如果存在无效的字面值则将引发 <code>OverflowError</code> 或 <code>ValueError</code>。</p>
<p><em>symbol</em> 参数确定 <em>source</em> 是作为一条语句 (对应默认值 <code>'single'</code>)，作为一系列语句 (<code>'exec'</code>) 还是作为一个 expression (<code>'eval'</code>) 进行编译。 任何其他值都将导致引发 <code>ValueError</code>。</p>
<p>注解</p>
<p>解析器有可能（但很不常见）会在到达源码结尾之前停止解析并成功输出结果；在这种情况下，末尾的符号可能会被忽略而不是引发错误。 例如，一个反斜杠加两个换行符之后可以跟随任何无意义的符号。 一旦解析器 API 得到改进将修正这个问题。</p>
<p><em>class</em> <code>codeop.Compile</code></p>
<p>这个类的实例具有 <code>__call__()</code> 方法，其签名与内置函数 <code>compile()</code> 相似，区别在于如果该实例编译了包含 <code>__future__</code> 语句的程序文本，则实例会‘记住’并使用已生效的语句编译所有后续程序文本。</p>
<p><em>class</em> <code>codeop.CommandCompiler</code></p>
<p>这个类的实例具有 <code>__call__()</code> 方法，其签名与 <code>compile_command()</code> 相似；区别在于如果该实例编译了包含 <code>__future__</code> 语句的程序文本，则实例会‘记住’并使用已生效的语句编译编译所有后续程序文本。</p>
<h1 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a>导入模块</h1><p>本章中介绍的模块提供了导入其他Python模块和挂钩以自定义导入过程的新方法。</p>
<p>本章描述的完整模块列表如下：</p>
<ul>
<li><code>zipimport</code> —- 从 Zip 存档中导入模块<ul>
<li>zipimporter 对象</li>
<li>例子</li>
</ul>
</li>
<li><code>pkgutil</code> —- 包扩展工具</li>
<li><code>modulefinder</code> —- 查找脚本使用的模块<ul>
<li><code>ModuleFinder</code> 的示例用法</li>
</ul>
</li>
<li><code>runpy</code> ——查找并执行 Python 模块</li>
<li><code>importlib</code> —- <code>import</code> 的实现<ul>
<li>概述</li>
<li>函数</li>
<li><code>importlib.abc</code> —— 关于导入的抽象基类</li>
<li><code>importlib.resources</code> — 资源</li>
<li><code>importlib.machinery</code> — Importers and path hooks</li>
<li><code>importlib.util</code> — Utility code for importers</li>
<li>例子<ul>
<li>Importing programmatically</li>
<li>Checking if a module can be imported</li>
<li>Importing a source file directly</li>
<li>Implementing lazy imports</li>
<li>Setting up an importer</li>
<li>Approximating <code>importlib.import_module()</code></li>
</ul>
</li>
</ul>
</li>
<li>Using <code>importlib.metadata</code><ul>
<li>概述</li>
<li>功能性 API<ul>
<li>Entry points</li>
<li>Distribution metadata</li>
<li>Distribution versions</li>
<li>Distribution files</li>
<li>Distribution requirements</li>
<li>Package distributions</li>
</ul>
</li>
<li>Distributions</li>
<li>Extending the search algorithm</li>
</ul>
</li>
</ul>
<h2 id="zipimport-—-从-Zip-存档中导入模块"><a href="#zipimport-—-从-Zip-存档中导入模块" class="headerlink" title="zipimport —- 从 Zip 存档中导入模块"></a><code>zipimport</code> —- 从 Zip 存档中导入模块</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/zipimport.py" target="_blank" rel="noopener">Lib/zipimport.py</a></p>
<hr>
<p>此模块添加了从 ZIP 格式档案中导入 Python 模块（ <code>*.py</code> ， <code>*.pyc</code> ）和包的能力。通常不需要明确地使用 <code>zipimport</code> 模块，内置的 <code>import</code> 机制会自动将此模块用于 ZIP 档案路径的 <code>sys.path</code> 项目上。</p>
<p>通常， <code>sys.path</code> 是字符串的目录名称列表。此模块同样允许 <code>sys.path</code> 的一项成为命名 ZIP 文件档案的字符串。 ZIP 档案可以容纳子目录结构去支持包的导入，并且可以将归档文件中的路径指定为仅从子目录导入。比如说，路径 <code>example.zip/lib/</code> 将只会从档案中的 <code>lib/</code> 子目录导入。</p>
<p>任何文件都可以存在于 ZIP档案之中，但是只有 <code>.py</code> 和 <code>.pyc</code> 文件是能够导入的。不允许导入 ZIP 中的动态模组（ <code>.pyd</code> ， <code>.so</code> ）。请注意，如果档案中只包含 <code>.py</code> 文件， Python不会尝试通过添加对应的 <code>.pyc</code> 文件修改档案，意思是如果 ZIP 档案不包含 <code>.pyc</code> 文件，导入或许会变慢。</p>
<p>在 3.8 版更改: 以前，不支持带有档案注释的 ZIP 档案。</p>
<p>参见</p>
<p><a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT" target="_blank" rel="noopener">PKZIP Application Note</a></p>
<p>Phil Katz 编写的 ZIP 文件格式文档，此格式和使用的算法的创建者。</p>
<p><a href="https://www.python.org/dev/peps/pep-0273" target="_blank" rel="noopener"><strong>PEP 273</strong></a> - 从ZIP压缩包导入模块</p>
<p>由 James C. Ahlstrom 编写，他也提供了实现。 Python 2.3 遵循 <a href="https://www.python.org/dev/peps/pep-0273" target="_blank" rel="noopener"><strong>PEP 273</strong></a> 的规范，但是使用 Just van Rossum 编写的使用了 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 中描述的导入钩的实现。</p>
<p><code>importlib</code> - 导入机制的实现</p>
<p>为所有导入器的实现提供相关协议的包。</p>
<p>此模块定义了一个异常：</p>
<p><em>exception</em> <code>zipimport.ZipImportError</code></p>
<p>异常由 zipimporter 对象引发。这是 <code>ImportError</code> 的子类，因此，也可以捕获为 <code>ImportError</code> 。</p>
<h3 id="zipimporter-对象"><a href="#zipimporter-对象" class="headerlink" title="zipimporter 对象"></a>zipimporter 对象</h3><p><code>zipimporter</code> 是用于导入 ZIP 文件的类。</p>
<p><em>class</em> <code>zipimport.zipimporter</code>(<em>archivepath</em>)</p>
<p>创建新的 zipimporter 实例。 <em>archivepath</em> 必须是指向 ZIP 文件的路径，或者 ZIP 文件中的特定路径。例如， <code>foo/bar.zip/lib</code> 的 <em>archivepath</em> 将在 ZIP 文件 <code>foo/bar.zip</code> 中的 <code>lib</code> 目录中查找模块（只要它存在）。</p>
<p>如果 <em>archivepath</em> 没有指向一个有效的 ZIP 档案，引发 <code>ZipImportError</code> 。</p>
<ul>
<li><p><code>create_module</code>(<em>spec</em>)</p>
<p>返回 <code>None</code> 来显式地请求默认语义的 <code>importlib.abc.Loader.create_module()</code> 实现。</p>
<p>3.10 新版功能.</p>
</li>
<li><p><code>exec_module</code>(<em>module</em>)</p>
<p><code>importlib.abc.Loader.exec_module()</code> 的实现。</p>
<p>3.10 新版功能.</p>
</li>
<li><p><code>find_loader</code>(<em>fullname</em>, <em>path=None</em>)</p>
<p><code>importlib.abc.PathEntryFinder.find_loader()</code> 的实现。</p>
<p>3.10 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>find_module</code>(<em>fullname</em>, <em>path=None</em>)</p>
<p>搜索由 <em>fullname</em> 指定的模块。 <em>fullname</em> 必须是完全合格的（点分的）模块名。它返回 zipimporter 实例本身如果模块被找到，或者返回 <code>None</code> 如果没找到指定模块。可选的 <em>path</em> 被忽略，这是为了与导入器协议兼容。</p>
<p>3.10 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>find_spec</code>(<em>fullname</em>, <em>target=None</em>)</p>
<p><code>importlib.abc.PathEntryFinder.find_spec()</code> 的实现。</p>
<p>3.10 新版功能.</p>
</li>
<li><p><code>get_code</code>(<em>fullname</em>)</p>
<p>返回指定模块的代码对象。 如果模块无法被导入则引发 <code>ZipImportError</code>。</p>
</li>
<li><p><code>get_data</code>(<em>pathname</em>)</p>
<p>返回与 <em>pathname</em> 相关联的数据。如果不能找到文件则引发 <code>OSError</code> 错误。</p>
<p>在 3.3 版更改: 曾经是 <code>IOError</code> 被引发而不是 <code>OSError</code> 。</p>
</li>
<li><p><code>get_filename</code>(<em>fullname</em>)</p>
<p>返回如果指定模块被导入则应当要设置的 <code>__file__</code> 值。 如果模块无法被导入则引发 <code>ZipImportError</code>。</p>
<p>3.1 新版功能.</p>
</li>
<li><p><code>get_source</code>(<em>fullname</em>)</p>
<p>返回指定模块的源代码。如果没有找到模块则引发 <code>ZipImportError</code> ，如果档案包含模块但是没有源代码，返回 <code>None</code> 。</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p>如果由 <em>fullname</em> 指定的模块是一个包则返回 <code>True</code> 。如果不能找到模块则引发 <code>ZipImportError</code> 错误。</p>
</li>
<li><p><code>load_module</code>(<em>fullname</em>)</p>
<p>导入由 <em>fullname</em> 所指定的模块。 <em>fullname</em> 必须为（带点号的）完整限定名称。 成功时返回导入的模块，失败时引发 <code>ZipImportError</code>。</p>
<p>3.10 版后已移除: 使用 <code>exec_module()</code> 来代替。</p>
</li>
<li><p><code>invalidate_caches</code>()</p>
<p>清除在 ZIP 归档文件中找到的相关文件信息的内部缓存。</p>
<p>3.10 新版功能.</p>
</li>
<li><p><code>archive</code></p>
<p>导入器关联的 ZIP 文件的文件名，没有可能的子路径。</p>
</li>
<li><p><code>prefix</code></p>
<p>ZIP 文件中搜索的模块的子路径。这是一个指向 ZIP 文件根目录的 zipimporter 对象的空字符串。</p>
</li>
</ul>
<p>当与斜杠结合使用时， <code>archive</code> 和 <code>prefix</code> 属性等价于赋予 <code>zipimporter</code> 构造器的原始 <em>archivepath</em> 参数。</p>
<h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>这是一个从 ZIP 档案中导入模块的例子 - 请注意 <code>zipimport</code> 模块不需要明确地使用。</p>
<pre class="line-numbers language-python"><code class="language-python">$ unzip <span class="token operator">-</span>l example<span class="token punctuation">.</span>zip
Archive<span class="token punctuation">:</span>  example<span class="token punctuation">.</span>zip
  Length     Date   Time    Name
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>    <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
     <span class="token number">8467</span>  <span class="token number">11</span><span class="token operator">-</span><span class="token number">26</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">30</span>   jwzthreading<span class="token punctuation">.</span>py
 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>                   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
     <span class="token number">8467</span>                   <span class="token number">1</span> file
$ <span class="token punctuation">.</span><span class="token operator">/</span>python
Python <span class="token number">2.3</span> <span class="token punctuation">(</span><span class="token comment" spellcheck="true">#1, Aug 1 2003, 19:54:32)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'example.zip'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Add .zip file to front of path</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> jwzthreading
<span class="token operator">>></span><span class="token operator">></span> jwzthreading<span class="token punctuation">.</span>__file__
<span class="token string">'example.zip/jwzthreading.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="pkgutil-—-包扩展工具"><a href="#pkgutil-—-包扩展工具" class="headerlink" title="pkgutil —- 包扩展工具"></a><code>pkgutil</code> —- 包扩展工具</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/pkgutil.py" target="_blank" rel="noopener">Lib/pkgutil.py</a></p>
<hr>
<p>该模块为导入系统提供了工具，尤其是在包支持方面。</p>
<p><em>class</em> <code>pkgutil.ModuleInfo</code>(<em>module_finder</em>, <em>name</em>, <em>ispkg</em>)</p>
<p>一个包含模块信息的简短摘要的命名元组。</p>
<p>3.6 新版功能.</p>
<p><code>pkgutil.extend_path</code>(<em>path</em>, <em>name</em>)</p>
<p>Extend the search path for the modules which comprise a package. Intended use is to place the following code in a package’s <code>__init__.py</code>:</p>
<pre><code>from pkgutil import extend_path
__path__ = extend_path(__path__, __name__)</code></pre><p>This will add to the package’s <code>__path__</code> all subdirectories of directories on <code>sys.path</code> named after the package. This is useful if one wants to distribute different parts of a single logical package as multiple directories.</p>
<p>It also looks for <code>*.pkg</code> files beginning where <code>*</code> matches the <em>name</em> argument. This feature is similar to <code>*.pth</code> files (see the <code>site</code> module for more information), except that it doesn’t special-case lines starting with <code>import</code>. A <code>*.pkg</code> file is trusted at face value: apart from checking for duplicates, all entries found in a <code>*.pkg</code> file are added to the path, regardless of whether they exist on the filesystem. (This is a feature.)</p>
<p>If the input path is not a list (as is the case for frozen packages) it is returned unchanged. The input path is not modified; an extended copy is returned. Items are only appended to the copy at the end.</p>
<p>It is assumed that <code>sys.path</code> is a sequence. Items of <code>sys.path</code> that are not strings referring to existing directories are ignored. Unicode items on <code>sys.path</code> that cause errors when used as filenames may cause this function to raise an exception (in line with <code>os.path.isdir()</code> behavior).</p>
<p><em>class</em> <code>pkgutil.ImpImporter</code>(<em>dirname=None</em>)</p>
<p><a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> Finder that wraps Python’s “classic” import algorithm.</p>
<p>If <em>dirname</em> is a string, a <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> finder is created that searches that directory. If <em>dirname</em> is <code>None</code>, a <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> finder is created that searches the current <code>sys.path</code>, plus any modules that are frozen or built-in.</p>
<p>Note that <code>ImpImporter</code> does not currently support being used by placement on <code>sys.meta_path</code>.</p>
<p>3.3 版后已移除: This emulation is no longer needed, as the standard import mechanism is now fully <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> compliant and available in <code>importlib</code>.</p>
<p><em>class</em> <code>pkgutil.ImpLoader</code>(<em>fullname</em>, <em>file</em>, <em>filename</em>, <em>etc</em>)</p>
<p>Loader that wraps Python’s “classic” import algorithm.</p>
<p>3.3 版后已移除: This emulation is no longer needed, as the standard import mechanism is now fully <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> compliant and available in <code>importlib</code>.</p>
<p><code>pkgutil.find_loader</code>(<em>fullname</em>)</p>
<p>Retrieve a module loader for the given <em>fullname</em>.</p>
<p>This is a backwards compatibility wrapper around <code>importlib.util.find_spec()</code> that converts most failures to <code>ImportError</code> and only returns the loader rather than the full <code>ModuleSpec</code>.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p>在 3.4 版更改: Updated to be based on <a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a></p>
<p><code>pkgutil.get_importer</code>(<em>path_item</em>)</p>
<p>Retrieve a finder for the given <em>path_item</em>.</p>
<p>The returned finder is cached in <code>sys.path_importer_cache</code> if it was newly created by a path hook.</p>
<p>The cache (or part of it) can be cleared manually if a rescan of <code>sys.path_hooks</code> is necessary.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p><code>pkgutil.get_loader</code>(<em>module_or_name</em>)</p>
<p>Get a loader object for <em>module_or_name</em>.</p>
<p>If the module or package is accessible via the normal import mechanism, a wrapper around the relevant part of that machinery is returned. Returns <code>None</code> if the module cannot be found or imported. If the named module is not already imported, its containing package (if any) is imported, in order to establish the package <code>__path__</code>.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p>在 3.4 版更改: Updated to be based on <a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a></p>
<p><code>pkgutil.iter_importers</code>(<em>fullname=’’</em>)</p>
<p>Yield finder objects for the given module name.</p>
<p>If fullname contains a ‘.’, the finders will be for the package containing fullname, otherwise they will be all registered top level finders (i.e. those on both sys.meta_path and sys.path_hooks).</p>
<p>If the named module is in a package, that package is imported as a side effect of invoking this function.</p>
<p>If no module name is specified, all top level finders are produced.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p><code>pkgutil.iter_modules</code>(<em>path=None</em>, <em>prefix=’’</em>)</p>
<p>Yields <code>ModuleInfo</code> for all submodules on <em>path</em>, or, if <em>path</em> is <code>None</code>, all top-level modules on <code>sys.path</code>.</p>
<p><em>path</em> should be either <code>None</code> or a list of paths to look for modules in.</p>
<p><em>prefix</em> is a string to output on the front of every module name on output.</p>
<p>注解</p>
<p>Only works for a finder which defines an <code>iter_modules()</code> method. This interface is non-standard, so the module also provides implementations for <code>importlib.machinery.FileFinder</code> and <code>zipimport.zipimporter</code>.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p><code>pkgutil.walk_packages</code>(<em>path=None</em>, <em>prefix=’’</em>, <em>onerror=None</em>)</p>
<p>Yields <code>ModuleInfo</code> for all modules recursively on <em>path</em>, or, if <em>path</em> is <code>None</code>, all accessible modules.</p>
<p><em>path</em> should be either <code>None</code> or a list of paths to look for modules in.</p>
<p><em>prefix</em> is a string to output on the front of every module name on output.</p>
<p>Note that this function must import all <em>packages</em> (<em>not</em> all modules!) on the given <em>path</em>, in order to access the <code>__path__</code> attribute to find submodules.</p>
<p><em>onerror</em> is a function which gets called with one argument (the name of the package which was being imported) if any exception occurs while trying to import a package. If no <em>onerror</em> function is supplied, <code>ImportError</code>s are caught and ignored, while all other exceptions are propagated, terminating the search.</p>
<p>示例:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># list all modules python can access</span>
walk_packages<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># list all submodules of ctypes</span>
walk_packages<span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>__path__<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>__name__ <span class="token operator">+</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解</p>
<p>Only works for a finder which defines an <code>iter_modules()</code> method. This interface is non-standard, so the module also provides implementations for <code>importlib.machinery.FileFinder</code> and <code>zipimport.zipimporter</code>.</p>
<p>在 3.3 版更改: Updated to be based directly on <code>importlib</code> rather than relying on the package internal <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> import emulation.</p>
<p><code>pkgutil.get_data</code>(<em>package</em>, <em>resource</em>)</p>
<p>从包中获取一个资源。</p>
<p>This is a wrapper for the loader <code>get_data</code> API. The <em>package</em> argument should be the name of a package, in standard module format (<code>foo.bar</code>). The <em>resource</em> argument should be in the form of a relative filename, using <code>/</code> as the path separator. The parent directory name <code>..</code> is not allowed, and nor is a rooted name (starting with a <code>/</code>).</p>
<p>The function returns a binary string that is the contents of the specified resource.</p>
<p>For packages located in the filesystem, which have already been imported, this is the rough equivalent of:</p>
<pre class="line-numbers language-python"><code class="language-python">d <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>package<span class="token punctuation">]</span><span class="token punctuation">.</span>__file__<span class="token punctuation">)</span>
data <span class="token operator">=</span> open<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>d<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>If the package cannot be located or loaded, or it uses a loader which does not support <code>get_data</code>, then <code>None</code> is returned. In particular, the loader for namespace packages does not support <code>get_data</code>.</p>
<p><code>pkgutil.resolve_name</code>(<em>name</em>)</p>
<p>Resolve a name to an object.</p>
<p>This functionality is used in numerous places in the standard library (see <a href="https://bugs.python.org/issue12915" target="_blank" rel="noopener">bpo-12915</a>) - and equivalent functionality is also in widely used third-party packages such as setuptools, Django and Pyramid.</p>
<p>It is expected that <em>name</em> will be a string in one of the following formats, where W is shorthand for a valid Python identifier and dot stands for a literal period in these pseudo-regexes:</p>
<ul>
<li><code>W(.W)*</code></li>
<li><code>W(.W)*:(W(.W)*)?</code></li>
</ul>
<p>The first form is intended for backward compatibility only. It assumes that some part of the dotted name is a package, and the rest is an object somewhere within that package, possibly nested inside other objects. Because the place where the package stops and the object hierarchy starts can’t be inferred by inspection, repeated attempts to import must be done with this form.</p>
<p>In the second form, the caller makes the division point clear through the provision of a single colon: the dotted name to the left of the colon is a package to be imported, and the dotted name to the right is the object hierarchy within that package. Only one import is needed in this form. If it ends with the colon, then a module object is returned.</p>
<p>The function will return an object (which might be a module), or raise one of the following exceptions:</p>
<p><code>ValueError</code> — if <em>name</em> isn’t in a recognised format.</p>
<p><code>ImportError</code> — if an import failed when it shouldn’t have.</p>
<p><code>AttributeError</code> — If a failure occurred when traversing the object hierarchy within the imported package to get to the desired object.</p>
<p>3.9 新版功能.</p>
<h2 id="modulefinder-—-查找脚本使用的模块"><a href="#modulefinder-—-查找脚本使用的模块" class="headerlink" title="modulefinder —- 查找脚本使用的模块"></a><code>modulefinder</code> —- 查找脚本使用的模块</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/modulefinder.py" target="_blank" rel="noopener">Lib/modulefinder.py</a></p>
<hr>
<p>该模块提供了一个 <code>ModuleFinder</code> 类，可用于确定脚本导入的模块集。 <code>modulefinder.py</code> 也可以作为脚本运行，给出 Python 脚本的文件名作为参数，之后将打印导入模块的报告。</p>
<p><code>modulefinder.AddPackagePath</code>(<em>pkg_name</em>, <em>path</em>)</p>
<p>记录名为 <em>pkg_name</em> 的包可以在指定的 <em>path</em> 中找到。</p>
<p><code>modulefinder.ReplacePackage</code>(<em>oldname</em>, <em>newname</em>)</p>
<p>允许指定名为 <em>oldname</em> 的模块实际上是名为 <em>newname</em> 的包。</p>
<p><em>class</em> <code>modulefinder.ModuleFinder</code>(<em>path=None</em>, <em>debug=0</em>, <em>excludes=[]</em>, <em>replace_paths=[]</em>)</p>
<p>该类提供 <code>run_script()</code> 和 <code>report()</code> 方法，用于确定脚本导入的模块集。 <em>path</em> 可以是搜索模块的目录列表；如果没有指定，则使用 <code>sys.path</code> 。 <em>debug</em> 设置调试级别；更高的值使类打印调试消息，关于它正在做什么。 <em>excludes</em> 是要从分析中排除的模块名称列表。 <em>replace_paths</em> 是将在模块路径中替换的 <code>(oldpath, newpath)</code> 元组的列表。</p>
<ul>
<li><p><code>report</code>()</p>
<p>将报告打印到标准输出，列出脚本导入的模块及其路径，以及缺少或似乎缺失的模块。</p>
</li>
<li><p><code>run_script</code>(<em>pathname</em>)</p>
<p>分析 <em>pathname</em> 文件的内容，该文件必须包含 Python 代码。</p>
</li>
<li><p><code>modules</code></p>
<p>一个将模块名称映射到模块的字典。 </p>
</li>
</ul>
<h3 id="ModuleFinder-的示例用法"><a href="#ModuleFinder-的示例用法" class="headerlink" title="ModuleFinder 的示例用法"></a><code>ModuleFinder</code> 的示例用法</h3><p>稍后将分析的脚本（bacon.py）:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token punctuation">,</span> itertools
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> baconhameggs
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> guido<span class="token punctuation">.</span>python<span class="token punctuation">.</span>ham
<span class="token keyword">except</span> ImportError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将输出 bacon.py 报告的脚本:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> modulefinder <span class="token keyword">import</span> ModuleFinder
finder <span class="token operator">=</span> ModuleFinder<span class="token punctuation">(</span><span class="token punctuation">)</span>
finder<span class="token punctuation">.</span>run_script<span class="token punctuation">(</span><span class="token string">'bacon.py'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Loaded modules:'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> mod <span class="token keyword">in</span> finder<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: '</span> <span class="token operator">%</span> name<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>list<span class="token punctuation">(</span>mod<span class="token punctuation">.</span>globalnames<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Modules not imported:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>finder<span class="token punctuation">.</span>badmodules<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出样例（可能因架构而异）:</p>
<pre class="line-numbers language-python"><code class="language-python">Loaded modules<span class="token punctuation">:</span>
_types<span class="token punctuation">:</span>
copyreg<span class="token punctuation">:</span>  _inverted_registry<span class="token punctuation">,</span>_slotnames<span class="token punctuation">,</span>__all__
sre_compile<span class="token punctuation">:</span>  isstring<span class="token punctuation">,</span>_sre<span class="token punctuation">,</span>_optimize_unicode
_sre<span class="token punctuation">:</span>
sre_constants<span class="token punctuation">:</span>  REPEAT_ONE<span class="token punctuation">,</span>makedict<span class="token punctuation">,</span>AT_END_LINE
sys<span class="token punctuation">:</span>
re<span class="token punctuation">:</span>  __module__<span class="token punctuation">,</span>finditer<span class="token punctuation">,</span>_expand
itertools<span class="token punctuation">:</span>
__main__<span class="token punctuation">:</span>  re<span class="token punctuation">,</span>itertools<span class="token punctuation">,</span>baconhameggs
sre_parse<span class="token punctuation">:</span>  _PATTERNENDERS<span class="token punctuation">,</span>SRE_FLAG_UNICODE
array<span class="token punctuation">:</span>
types<span class="token punctuation">:</span>  __module__<span class="token punctuation">,</span>IntType<span class="token punctuation">,</span>TypeType
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Modules <span class="token operator">not</span> imported<span class="token punctuation">:</span>
guido<span class="token punctuation">.</span>python<span class="token punctuation">.</span>ham
baconhameggs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="runpy-——查找并执行-Python-模块"><a href="#runpy-——查找并执行-Python-模块" class="headerlink" title="runpy ——查找并执行 Python 模块"></a><code>runpy</code> ——查找并执行 Python 模块</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/runpy.py" target="_blank" rel="noopener">Lib/runpy.py</a></p>
<hr>
<p><code>runpy</code> 模块用于找到并运行 Python 的模块，而无需首先导入。主要用于实现 <code>-m</code> 命令行开关，以允许用 Python 模块命名空间而不是文件系统来定位脚本。</p>
<p>请注意，这 <em>并非</em> 一个沙盒模块——所有代码都在当前进程中运行，所有副作用（如其他模块对导入操作进行了缓存）在函数返回后都会留存。</p>
<p>此外，在 <code>runpy</code> 函数返回后，任何由已执行代码定义的函数和类都不能保证正确工作。如果某使用场景不能接收此限制，那么选用 <code>importlib</code> 可能更合适些。</p>
<p><code>runpy</code> 模块提供两个函数：</p>
<p><code>runpy.run_module</code>(<em>mod_name</em>, <em>init_globals=None</em>, <em>run_name=None</em>, <em>alter_sys=False</em>)</p>
<p>执行给定模块的代码，并返回结果模块的 globals 字典。 该模块的代码首先会用标准的导入机制去查找定位 (详情请参阅 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a>)，然后在全新的模块命名空间中运行。</p>
<p>参数 <em>mod_name</em> 应该是一个绝对模块名。如果模块名指向一个包，而不是普通的模块，那么该包会被导入，然后执行包中的 <code>__main__</code> 子模块，并返回结果模块的 globals 字典。</p>
<p>可选的字典参数 <em>init_globals</em> 可用来在代码执行前预填充模块的 globals 字典。给出的字典参数不会被修改。如果字典中定义了以下任意一个特殊全局变量，这些定义都会被 <code>run_module()</code> 覆盖。</p>
<p>The special global variables <code>__name__</code>, <code>__spec__</code>, <code>__file__</code>, <code>__cached__</code>, <code>__loader__</code> and <code>__package__</code> are set in the globals dictionary before the module code is executed (Note that this is a minimal set of variables - other variables may be set implicitly as an interpreter implementation detail).</p>
<p>若可选参数 <code>__name__</code> 不为 <code>None</code> 则设为 <em>run_name*，若此名称的模块是一个包则设为 <code>mod_name + '.__main__'</code>，否则设为 *mod_name</em> 参数。</p>
<p><code>__spec__</code> 将设为合适的 <em>实际</em> 导入模块（也就是说，<code>__spec__.name</code> 一定是 <em>mod_name</em> 或 <code>mod_name + '.__main__</code>，而不是 <em>run_name</em>）。</p>
<p><code>__file__</code> 、<code>__cached__</code>、 <code>__loader__</code> 和 <code>__package__</code> 根据模块规格进行 常规设置</p>
<p>如果给出了参数 <em>alter_sys</em> 并且值为 <code>True</code>，那么 <code>sys.argv[0]</code> 将被更新为 <code>__file__</code> 的值，<code>sys.modules[__name__]</code> 将被更新为临时模块对象。在函数返回前， <code>sys.argv[0]</code> 和 <code>sys.modules[__name__]</code> 将会复原。</p>
<p>注意，这种对 <code>sys</code> 的操作不是线程安全的。其他线程可能会看到初始化不完整的模块，以及变动后的参数列表。如果从线程中的代码调用此函数，建议单实例运行 <code>sys</code> 模块。</p>
<p>参见</p>
<p><code>-m</code> 选项由命令行提供相同功能。</p>
<p>在 3.1 版更改: 加入了 查找 <code>__main__</code> 子模块并执行软件包的能力。</p>
<p>在 3.2 版更改: 加入了 <code>__cached__</code> 全局变量（参见 <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> ）。</p>
<p>在 3.4 版更改: 充分利用 <a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a> 加入的模块规格功能。使得以这种方式运行的模块能够正确设置 <code>__cached__</code>，并确保真正的模块名称总是可以通过 <code>__spec__.name</code> 的形式访问。</p>
<p><code>runpy.run_path</code>(<em>file_path</em>, <em>init_globals=None</em>, <em>run_name=None</em>)</p>
<p>执行指定位置的代码，并返回结果模块的 globals 字典。与提供给 CPython 命令行的脚本名称一样，给出的路径可以指向 Python 源文件、编译过的字节码文件或包含<code>__main__</code> 模块的有效 sys.path 项（例如一个包含顶级<code>__main__.py</code> 文件的 zip 文件）。</p>
<p>对于直接的脚本而言，指定代码将直接在一个新的模块命名空间中运行。对于一个有效的 sys.path 项（通常是一个 zip 文件或目录），其首先会被添加到 <code>sys.path</code> 的开头。然后，本函数用更新后的路径查找并执行 <code>__main__</code> 模块。请注意，即便在指定位置不存在主模块，也没有特别的保护措施来防止调用存在于 <code>sys.path</code> 其他地方的 <code>__main__</code>。</p>
<p>利用可选的字典参数 <em>init_globals</em> ，可在代码执行前预填模块的 globals 字典。给出的字典参数不会被修改。如果给出的字典中定义了下列特殊全局变量，这些定义均会被 <code>run_module()</code> 覆盖。</p>
<p>The special global variables <code>__name__</code>, <code>__spec__</code>, <code>__file__</code>, <code>__cached__</code>, <code>__loader__</code> and <code>__package__</code> are set in the globals dictionary before the module code is executed (Note that this is a minimal set of variables - other variables may be set implicitly as an interpreter implementation detail).</p>
<p>如果该可选参数不为 <code>None</code>，则 <code>__name__</code> 被设为 <em>run_name</em>，否则为 <code>'&lt;run_path&gt;'</code>。</p>
<p>如果提供的路径直接引用了一个脚本文件（无论是源码文件还是预编译的字节码），那么 <code>__file__</code> 将设为给出的路径，而 <code>__spec__</code>、<code>__cached__</code>、<code>__loader__</code> 和 <code>__package__</code> 都将设为 <code>None</code>。</p>
<p>如果给出的路径是对有效 sys.path 项的引用，那么 <code>__spec__</code> 将为导入的 <code>__main__</code> 模块进行正确设置 (也就是说，<code>__spec__.name</code> 将一定是 <code>__main__</code>)。 <code>__file__</code>, <code>__cached__</code>, <code>__loader__</code> 和 <code>__package__</code> 将依据模块规格 进行常规设置。</p>
<p><code>sys</code> 模块也做了一些改动。 首先，如上所述，<code>sys.path</code> 可能会被修改。 <code>sys.argv[0]</code> 被更新为 <code>file_path</code> 的值，<code>sys.modules[__name__]</code> 被更新为正在被执行的模块的临时模块对象。 在函数返回之前，对 <code>sys</code> 中条目的所有修改都会被复原。</p>
<p>注意，与 <code>run_module()</code> 不同的是，本函数对 <code>sys</code> 的修改不是可有可无的，因为这些调整对于 sys.path 项能够顺利执行至关重要。由于依然存在线程安全的限制，在线程代码中使用本函数时应采用导入锁进行序列运行，或者委托给一个单独的进程。</p>
<p>参见</p>
<p>接口选项 用于在命令行上实现同等功能（<code>python path/to/script</code>）。</p>
<p>3.2 新版功能.</p>
<p>在 3.4 版更改: 已作更新，以便充分利用 <a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a> 加入的模块规格功能。使得从有效 sys.path 项导入<code>__main__</code> 而不是直接执行的情况下，能够正确设置 <code>__cached__</code>。</p>
<p>参见</p>
<p><a href="https://www.python.org/dev/peps/pep-0338" target="_blank" rel="noopener"><strong>PEP 338</strong></a> — 将模块作为脚本执行</p>
<p>PEP 由 Nick Coghlan 撰写并实现。</p>
<p><a href="https://www.python.org/dev/peps/pep-0366" target="_blank" rel="noopener"><strong>PEP 366</strong></a> ——主模块的显式相对导入</p>
<p>PEP 由 Nick Coghlan 撰写并实现。</p>
<p><a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a> —— 导入系统采用的 ModuleSpec 类型</p>
<p>PEP 由 Eric Snow 撰写并实现。</p>
<p>命令行与环境 —— CPython 命令行详解</p>
<p><code>importlib.import_module()</code> 函数</p>
<h2 id="importlib-—-import-的实现"><a href="#importlib-—-import-的实现" class="headerlink" title="importlib —- import 的实现"></a><code>importlib</code> —- <code>import</code> 的实现</h2><p>3.1 新版功能.</p>
<p><strong>源代码</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/__init__.py" target="_blank" rel="noopener">Lib/importlib/<strong>init</strong>.py</a></p>
<hr>
<h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p><code>importlib</code> 包的目的有两个。 第一个目的是在 Python 源代码中提供 <code>import</code> 语句的实现（并且因此而扩展 <code>__import__()</code> 函数）。 这提供了一个可移植到任何 Python 解释器的 <code>import</code> 实现。 相比使用 Python 以外的编程语言实现方式，这一实现更加易于理解。</p>
<p>第二个目的是实现 <code>import</code> 的部分被公开在这个包中，使得用户更容易创建他们自己的自定义对象 (通常被称为 importer) 来参与到导入过程中。</p>
<p>参见</p>
<p>import 语句</p>
<p><code>import</code> 语句的语言参考</p>
<p>包规格说明</p>
<p>包的初始规范。自从编写这个文档开始，一些语义已经发生改变了（比如基于 <code>sys.modules</code> 中 <code>None</code> 的重定向）。</p>
<p><code>__import__()</code> 函数</p>
<p><code>import</code> 语句是这个函数的语法糖。</p>
<p><a href="https://www.python.org/dev/peps/pep-0235" target="_blank" rel="noopener"><strong>PEP 235</strong></a></p>
<p>在忽略大小写的平台上进行导入</p>
<p><a href="https://www.python.org/dev/peps/pep-0263" target="_blank" rel="noopener"><strong>PEP 263</strong></a></p>
<p>定义 Python 源代码编码</p>
<p><a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a></p>
<p>新导入钩子</p>
<p><a href="https://www.python.org/dev/peps/pep-0328" target="_blank" rel="noopener"><strong>PEP 328</strong></a></p>
<p>导入：多行和绝对/相对</p>
<p><a href="https://www.python.org/dev/peps/pep-0366" target="_blank" rel="noopener"><strong>PEP 366</strong></a></p>
<p>主模块显式相对导入</p>
<p><a href="https://www.python.org/dev/peps/pep-0420" target="_blank" rel="noopener"><strong>PEP 420</strong></a></p>
<p>隐式命名空间包</p>
<p><a href="https://www.python.org/dev/peps/pep-0451" target="_blank" rel="noopener"><strong>PEP 451</strong></a></p>
<p>导入系统的一个模块规范类型</p>
<p><a href="https://www.python.org/dev/peps/pep-0488" target="_blank" rel="noopener"><strong>PEP 488</strong></a></p>
<p>消除PYO文件</p>
<p><a href="https://www.python.org/dev/peps/pep-0489" target="_blank" rel="noopener"><strong>PEP 489</strong></a></p>
<p>多阶段扩展模块初始化</p>
<p><a href="https://www.python.org/dev/peps/pep-0552" target="_blank" rel="noopener"><strong>PEP 552</strong></a></p>
<p>确定性的 pyc 文件</p>
<p><a href="https://www.python.org/dev/peps/pep-3120" target="_blank" rel="noopener"><strong>PEP 3120</strong></a></p>
<p>使用 UTF-8 作为默认的源编码</p>
<p><a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a></p>
<p>PYC 仓库目录</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p><code>importlib.__import__</code>(<em>name</em>, <em>globals=None</em>, <em>locals=None</em>, <em>fromlist=()</em>, <em>level=0</em>)</p>
<p>内置 <code>__import__()</code> 函数的实现。</p>
<p>注解</p>
<p>程序式地导入模块应该使用 <code>import_module()</code> 而不是这个函数。</p>
<p><code>importlib.import_module</code>(<em>name</em>, <em>package=None</em>)</p>
<p>导入一个模块。参数 <em>name</em> 指定了以绝对或相对导入方式导入什么模块 (比如要么像这样 <code>pkg.mod</code> 或者这样 <code>..mod</code>)。如果参数 name 使用相对导入的方式来指定，那么那个参数 <em>packages</em> 必须设置为那个包名，这个包名作为解析这个包名的锚点 (比如 <code>import_module('..mod', 'pkg.subpkg')</code> 将会导入 <code>pkg.mod</code>)。</p>
<p><code>import_module()</code> 函数是一个对 <code>importlib.__import__()</code> 进行简化的包装器。 这意味着该函数的所有主义都来自于 <code>importlib.__import__()</code>。 这两个函数之间最重要的不同点在于 <code>import_module()</code> 返回指定的包或模块 (例如 <code>pkg.mod</code>)，而 <code>__import__()</code> 返回最高层级的包或模块 (例如 <code>pkg</code>)。</p>
<p>如果动态导入一个自从解释器开始执行以来被创建的模块（即创建了一个 Python 源代码文件），为了让导入系统知道这个新模块，可能需要调用 <code>invalidate_caches()</code>。</p>
<p>在 3.3 版更改: 父包会被自动导入。</p>
<p><code>importlib.find_loader</code>(<em>name</em>, <em>path=None</em>)</p>
<p>查找一个模块的加载器，可选择地在指定的 <em>path</em> 里面。如果这个模块是在 <code>sys.modules</code>，那么返回 <code>sys.modules[name].__loader__</code> (除非这个加载器是 <code>None</code> 或者是没有被设置， 在这样的情况下，会引起 <code>ValueError</code> 异常）。 否则使用 <code>sys.meta_path</code> 的一次搜索就结束。如果未发现加载器，则返回 <code>None</code>。</p>
<p>点状的名称没有使得它父包或模块隐式地导入，因为它需要加载它们并且可能不需要。为了适当地导入一个子模块，需要导入子模块的所有父包并且使用正确的参数提供给 <em>path</em>。</p>
<p>3.3 新版功能.</p>
<p>在 3.4 版更改: 如果没有设置 <code>__loader__</code>，会引起 <code>ValueError</code> 异常，就像属性设置为 <code>None</code> 的时候一样。</p>
<p>3.4 版后已移除: 使用 <code>importlib.util.find_spec()</code> 来代替。</p>
<p><code>importlib.invalidate_caches</code>()</p>
<p>使查找器存储在 <code>sys.meta_path</code> 中的内部缓存无效。如果一个查找器实现了 <code>invalidate_caches()</code>，那么它会被调用来执行那个无效过程。 如果创建/安装任何模块，同时正在运行的程序是为了保证所有的查找器知道新模块的存在，那么应该调用这个函数。</p>
<p>3.3 新版功能.</p>
<p><code>importlib.reload</code>(<em>module</em>)</p>
<p>重新加载之前导入的 <em>module</em>。那个参数必须是一个模块对象，所以它之前必须已经成功导入了。这样做是有用的，如果使用外部编辑器编已经辑过了那个模块的源代码文件并且想在退出 Python 解释器之前试验这个新版本的模块。函数的返回值是那个模块对象（如果重新导入导致一个不同的对象放置在 <code>sys.modules</code> 中，那么那个模块对象是有可能会不同）。</p>
<p>当执行 <code>reload()</code> 的时候：</p>
<ul>
<li>Python 模块的代码会被重新编译并且那个模块级的代码被重新执行，通过重新使用一开始加载那个模块的 loader，定义一个新的绑定在那个模块字典中的名称的对象集合。扩展模块的<code>init</code>函数不会被调用第二次。</li>
<li>与Python中的所有的其它对象一样，旧的对象只有在它们的引用计数为0之后才会被回收。</li>
<li>模块命名空间中的名称重新指向任何新的或更改后的对象。</li>
<li>其他旧对象的引用（例如那个模块的外部名称）不会被重新绑定到引用的新对象的，并且如果有需要，必须在出现的每个命名空间中进行更新。</li>
</ul>
<p>有一些其他注意事项：</p>
<p>当一个模块被重新加载的时候，它的字典（包含了那个模块的全区变量）会被保留。名称的重新定义会覆盖旧的定义，所以通常来说这不是问题。如果一个新模块没有定义在旧版本模块中定义的名称，则将保留旧版本中的定义。这一特性可用于作为那个模块的优点，如果它维护一个全局表或者对象的缓存 —— 使用 <code>try</code> 语句，就可以测试表的存在并且跳过它的初始化，如果有需要的话:</p>
<pre><code>try:
    cache
except NameError:
    cache = {}</code></pre><p>重新加载内置的或者动态加载模块，通常来说不是很有用处。不推荐重新加载”<code>sys</code>，<code>__main__</code>，<code>builtins</code> 和其它关键模块。在很多例子中，扩展模块并不是设计为不止一次的初始化，并且当重新加载时，可能会以任意方式失败。</p>
<p>如果一个模块使用 <code>from</code> … <code>import</code> … 导入的对象来自另外一个模块，给其它模块调用 <code>reload()</code> 不会重新定义来自这个模块的对象 —— 解决这个问题的一种方式是重新执行 <code>from</code> 语句，另一种方式是使用 <code>import</code> 和限定名称(<em>module.name</em>)来代替。</p>
<p>如果一个模块创建一个类的实例，重新加载定义那个类的模块不影响那些实例的方法定义———它们继续使用旧类中的定义。对于子类来说同样是正确的。</p>
<p>3.4 新版功能.</p>
<p>在 3.7 版更改: <code>ModuleNotFoundError</code> is raised when the module being reloaded lacks a <code>ModuleSpec</code>.</p>
<h3 id="importlib-abc-——-关于导入的抽象基类"><a href="#importlib-abc-——-关于导入的抽象基类" class="headerlink" title="importlib.abc —— 关于导入的抽象基类"></a><code>importlib.abc</code> —— 关于导入的抽象基类</h3><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/abc.py" target="_blank" rel="noopener">Lib/importlib/abc.py</a></p>
<hr>
<p>The <code>importlib.abc</code> module contains all of the core abstract base classes used by <code>import</code>. Some subclasses of the core abstract base classes are also provided to help in implementing the core ABCs.</p>
<p>ABC 类的层次结构：</p>
<pre><code>object
 +-- Finder (deprecated)
 |    +-- MetaPathFinder
 |    +-- PathEntryFinder
 +-- Loader
      +-- ResourceLoader --------+
      +-- InspectLoader          |
           +-- ExecutionLoader --+
                                 +-- FileLoader
                                 +-- SourceLoader</code></pre><p><em>class</em> <code>importlib.abc.Finder</code></p>
<p>代表 finder 的一个抽象基类</p>
<p>3.3 版后已移除: 使用 <code>MetaPathFinder</code> 或 <code>PathEntryFinder</code> 来代替。</p>
<ul>
<li><p><em>abstractmethod</em> <code>find_module</code>(<em>fullname</em>, <em>path=None</em>)</p>
<p>为指定的模块查找 loader 定义的抽象方法。本来是在 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 指定的，这个方法是在 <code>sys.meta_path</code> 和基于路径的导入子系统中使用。</p>
<p>在 3.4 版更改: 当被调用的时候，返回 <code>None</code> 而不是引发 <code>NotImplementedError</code>。</p>
<p>3.10 版后已移除: Implement <code>MetaPathFinder.find_spec()</code> or <code>PathEntryFinder.find_spec()</code> instead.</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.MetaPathFinder</code></p>
<p>代表 meta path finder 的一个抽象基类。 为了保持兼容性，这是 <code>Finder</code> 的一个子类。</p>
<p>3.3 新版功能.</p>
<p>在 3.10 版更改: No longer a subclass of <code>Finder</code>.</p>
<ul>
<li><p><code>find_spec</code>(<em>fullname</em>, <em>path</em>, <em>target=None</em>)</p>
<p>An abstract method for finding a spec for the specified module. If this is a top-level import, <em>path</em> will be <code>None</code>. Otherwise, this is a search for a subpackage or module and <em>path</em> will be the value of <code>__path__</code> from the parent package. If a spec cannot be found, <code>None</code> is returned. When passed in, <code>target</code> is a module object that the finder may use to make a more educated guess about what spec to return. <code>importlib.util.spec_from_loader()</code> may be useful for implementing concrete <code>MetaPathFinders</code>.</p>
<p>3.4 新版功能.</p>
</li>
<li><p><code>find_module</code>(<em>fullname</em>, <em>path</em>)</p>
<p>一个用于查找指定的模块中 loader 的遗留方法。如果这是最高层级的导入，<em>path</em> 的值将会是 <code>None</code>。否则，这是一个查找子包或者模块的方法，并且 <em>path</em> 的值将会是来自父包的 <code>__path__</code> 的值。如果未发现加载器，返回 <code>None</code>。</p>
<p>如果定义了 <code>find_spec()</code> 方法，则提供了向后兼容的功能。</p>
<p>在 3.4 版更改: 当调用这个方法的时候返回 <code>None</code> 而不是引发 <code>NotImplementedError</code>。 可以使用 <code>find_spec()</code> 来提供功能。</p>
<p>3.4 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>invalidate_caches</code>()</p>
<p>当被调用的时候，一个可选的方法应该将查找器使用的任何内部缓存进行无效。将在 <code>sys.meta_path</code> 上的所有查找器的缓存进行无效的时候，这个函数被 <code>importlib.invalidate_caches()</code> 所使用。</p>
<p>在 3.4 版更改: 当方法被调用的时候，方法返回是 <code>None</code> 而不是 <code>NotImplemented</code> 。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.PathEntryFinder</code></p>
<p>An abstract base class representing a path entry finder. Though it bears some similarities to <code>MetaPathFinder</code>, <code>PathEntryFinder</code> is meant for use only within the path-based import subsystem provided by <code>importlib.machinery.PathFinder</code>.</p>
<p>3.3 新版功能.</p>
<p>在 3.10 版更改: No longer a subclass of <code>Finder</code>.</p>
<ul>
<li><p><code>find_spec</code>(<em>fullname</em>, <em>target=None</em>)</p>
<p>An abstract method for finding a spec for the specified module. The finder will search for the module only within the path entry to which it is assigned. If a spec cannot be found, <code>None</code> is returned. When passed in, <code>target</code> is a module object that the finder may use to make a more educated guess about what spec to return. <code>importlib.util.spec_from_loader()</code> may be useful for implementing concrete <code>PathEntryFinders</code>.</p>
<p>3.4 新版功能.</p>
</li>
<li><p><code>find_loader</code>(<em>fullname</em>)</p>
<p>一个用于在模块中查找一个 loader 的遗留方法。 返回一个 <code>(loader, portion)</code> 的2元组，<code>portion</code> 是一个贡献给命名空间包部分的文件系统位置的序列。 加载器可能是 <code>None</code>，同时正在指定的 <code>portion</code> 表示的是贡献给命名空间包的文件系统位置。<code>portion</code> 可以使用一个空列表来表示加载器不是命名空间包的一部分。 如果 <code>loader</code> 是 <code>None</code> 并且 <code>portion</code> 是一个空列表，那么命名空间包中无加载器或者文件系统位置可查找到（即在那个模块中未能找到任何东西）。</p>
<p>如果定义了 <code>find_spec()</code> ，则提供了向后兼容的功能。</p>
<p>在 3.4 版更改: 返回 <code>(None, [])</code> 而不是引发 <code>NotImplementedError</code>。 当可于提供相应的功能的时候，使用 <code>find_spec()</code>。</p>
<p>3.4 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>find_module</code>(<em>fullname</em>)</p>
<p><code>Finder.find_module</code>的具体实现，该方法等价于``self.find_loader(fullname)[0]<code>()</code>。</p>
<p>3.4 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>invalidate_caches</code>()</p>
<p>An optional method which, when called, should invalidate any internal cache used by the finder. Used by <code>importlib.machinery.PathFinder.invalidate_caches()</code> when invalidating the caches of all cached finders.</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.Loader</code></p>
<p>loader 的抽象基类。 关于一个加载器的实际定义请查看 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a>。</p>
<p>加载器想要支持资源读取应该实现一个由 <code>importlib.abc.ResourceReader</code> 指定的<code>get_resource_reader(fullname)</code> 方法。</p>
<p>在 3.7 版更改: 引入了可选的 <code>get_resource_reader()</code> 方法。</p>
<ul>
<li><p><code>create_module</code>(<em>spec</em>)</p>
<p>当导入一个模块的时候，一个返回将要使用的那个模块对象的方法。这个方法可能返回 <code>None</code> ，这暗示着应该发生默认的模块创建语义。”</p>
<p>3.4 新版功能.</p>
<p>在 3.5 版更改: 从 Python 3.6 开始，当定义了 <code>exec_module()</code> 的时候，这个方法将不会是可选的。</p>
</li>
<li><p><code>exec_module</code>(<em>module</em>)</p>
<p>当一个模块被导入或重新加载时，一个抽象方法在它自己的命名空间中执行那个模块。当调用 <code>exec_module()</code> 的时候，那个模块应该已经被初始化 了。当这个方法存在时，必须定义 <code>create_module()</code> 。</p>
<p>3.4 新版功能.</p>
<p>在 3.6 版更改: <code>create_module()</code> 也必须被定义。</p>
</li>
<li><p><code>load_module</code>(<em>fullname</em>)</p>
<p>用于加载一个模块的传统方法。如果这个模块不能被导入，将引起 <code>ImportError</code> 异常，否则返回那个被加载的模块。</p>
<p>如果请求的模块已经存在 <code>sys.modules</code>，应该使用并且重新加载那个模块。 否则加载器应该是创建一个新的模块并且在任何家过程开始之前将这个新模块插入到 <code>sys.modules</code> 中，来阻止递归导入。 如果加载器插入了一个模块并且加载失败了，加载器必须从 <code>sys.modules</code> 中将这个模块移除。在加载器开始执行之前，已经在 <code>sys.modules</code> 中的模块应该被忽略 (查看 <code>importlib.util.module_for_loader()</code>)。</p>
<p>加载器应该在模块上面设置几个属性。（要知道当重新加载一个模块的时候，那些属性某部分可以改变）：</p>
<ul>
<li><p><code>__name__</code></p>
<p>模块的名字</p>
</li>
</ul>
</li>
</ul>
<pre><code>-   [`__file__`]($e6a440f13a5f432a.md#file__ "__file__")
    模块数据存储的路径(不是为了内置的模块而设置)
-   [`__cached__`]($e6a440f13a5f432a.md#cached__ "__cached__")
    被存储或应该被存储的模块的编译版本的路径（当这个属性不恰当的时候不设置）。
-   [`__path__`]($e6a440f13a5f432a.md#path__ "__path__")
    指定在一个包中搜索路径的一个字符串列表。这个属性不在模块上面进行设置。
-   [`__package__`]($e6a440f13a5f432a.md#package__ "__package__")
    The fully-qualified name of the package under which the module was loaded as a submodule (or the empty string for top-level modules). For packages, it is the same as [`__name__`]($e6a440f13a5f432a.md#name__ "__name__"). The [`importlib.util.module_for_loader()`](#importlib.util.module_for_loader "importlib.util.module_for_loader") decorator can handle the details for [`__package__`]($e6a440f13a5f432a.md#package__ "__package__").
-   [`__loader__`]($e6a440f13a5f432a.md#loader__ "__loader__")
    用来加载那个模块的加载器。 [`importlib.util.module_for_loader()`](#importlib.util.module_for_loader "importlib.util.module_for_loader") 装饰器可以处理 [`__package__`]($e6a440f13a5f432a.md#package__ "__package__") 的细节。
当 [`exec_module()`](#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") 可用的时候，那么则提供了向后兼容的功能。
在 3.4 版更改: 当这个方法被调用的时候，触发 [`ImportError`]($177bd954d1cc6696.md#ImportError "ImportError") 异常而不是 [`NotImplementedError`]($177bd954d1cc6696.md#NotImplementedError "NotImplementedError")。当 [`exec_module()`](#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") 可用的时候，使用它的功能。
3.4 版后已移除: 加载模块推荐的使用的 API 是 [`exec_module()`](#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") (和 [`create_module()`](#importlib.abc.Loader.create_module "importlib.abc.Loader.create_module"))。 加载器应该实现它而不是 load\_module()。 当 exec\_module() 被实现的时候，导入机制关心的是 load\_module() 所有其他的责任。</code></pre><ul>
<li><p><code>module_repr</code>(<em>module</em>)</p>
<p>一个遗留方法，在实现时计算并返回给定模块的 repr，作为字符串。 模块类型的默认 repr() 将根据需要使用此方法的结果。</p>
<p>3.3 新版功能.</p>
<p>在 3.4 版更改: 是可选的方法而不是一个抽象方法。</p>
<p>3.4 版后已移除: 现在导入机制会自动地关注这个方法。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.ResourceReader</code></p>
<p><em>Superseded by TraversableResources</em></p>
<p>提供读取 <em>resources</em> 能力的一个 abstract base class 。</p>
<p>从这个 ABC 的视角出发，<em>resource</em> 指一个包附带的二进制文件。常见的如在包的 <code>__init__.py</code> 文件旁的数据文件。这个类存在的目的是为了将对数据文件的访问进行抽象，这样包就和其数据文件的存储方式无关了。不论这些文件是存放在一个 zip 文件里还是直接在文件系统内。</p>
<p>对于该类中的任一方法，<em>resource</em> 参数的值都需要是一个在概念上表示文件名称的 path-like object。 这意味着任何子目录的路径都不该出现在 <em>resouce</em> 参数值内。 因为对于阅读器而言，包的位置就代表着「目录」。 因此目录和文件名就分别对应于包和资源。 这也是该类的实例都需要和一个包直接关联（而不是潜在指代很多包或者一整个模块）的原因。</p>
<p>想支持资源读取的加载器需要提供一个返回实现了此 ABC 的接口的 <code>get_resource_reader(fullname)</code> 方法。如果通过全名指定的模块不是一个包，这个方法应该返回 <code>None</code>。 当指定的模块是一个包时，应该只返回一个与这个抽象类ABC兼容的对象。</p>
<p>3.7 新版功能.</p>
<ul>
<li><p><em>abstractmethod</em> <code>open_resource</code>(<em>resource</em>)</p>
<p>返回一个打开的 file-like object 用于 <em>resource</em> 的二进制读取。</p>
<p>如果无法找到资源，将会引发 <code>FileNotFoundError</code>。</p>
</li>
<li><p><em>abstractmethod</em> <code>resource_path</code>(<em>resource</em>)</p>
<p>返回 <em>resource</em> 的文件系统路径。</p>
<p>如果资源并不实际存在于文件系统中，将会引发 <code>FileNotFoundError</code>。</p>
</li>
<li><p><em>abstractmethod</em> <code>is_resource</code>(<em>name</em>)</p>
<p>如果<em>name</em> 被视作资源，则返回True。如果<em>name</em>不存在，则引发 <code>FileNotFoundError</code> 异常。</p>
</li>
<li><p><em>abstractmethod</em> <code>contents</code>()</p>
<p>反回由字符串组成的 iterable，表示这个包的所有内容。 请注意并不要求迭代器返回的所有名称都是实际的资源，例如返回 <code>is_resource()</code> 为假值的名称也是可接受的。</p>
<p>允许非资源名字被返回是为了允许存储的一个包和它的资源的方式是已知先验的并且非资源名字会有用的情况。比如，允许返回子目录名字，目的是当得知包和资源存储在文件系统上面的时候，能够直接使用子目录的名字。</p>
<p>这个抽象方法返回了一个不包含任何内容的可迭代对象。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.ResourceLoader</code></p>
<p>一个 loader 的抽象基类，它实现了可选的 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 协议用于从存储后端加载任意资源。</p>
<p>3.7 版后已移除: 由于要支持使用 <code>importlib.abc.ResourceReader</code> 类来加载资源，这个 ABC 已经被弃用了。</p>
<ul>
<li><p><em>abstractmethod</em> <code>get_data</code>(<em>path</em>)</p>
<p>一个用于返回位于 <em>path</em> 的字节数据的抽象方法。有一个允许存储任意数据的类文件存储后端的加载器能够实现这个抽象方法来直接访问这些被存储的数据。如果不能够找到 <em>path<em>，则会引发 <code>OSError</code> 异常。</em>path</em> 被希望使用一个模块的 <code>__file</code> 属性或来自一个包的 <code>__path__</code> 来构建。</p>
<p>在 3.4 版更改: 引发 <code>OSError</code> 异常而不是 <code>NotImplementedError</code> 异常。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.InspectLoader</code></p>
<p>一个实现加载器检查模块可选的 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 协议的 loader 的抽象基类。</p>
<ul>
<li><p><code>get_code</code>(<em>fullname</em>)</p>
<p>返回一个模块的代码对象，或如果模块没有一个代码对象（例如，对于内置的模块来说，这会是这种情况），则为 <code>None</code>。 如果加载器不能找到请求的模块，则引发 <code>ImportError</code> 异常。</p>
<p>注解</p>
<p>当这个方法有一个默认的实现的时候，出于性能方面的考虑，如果有可能的话，建议覆盖它。</p>
<p>在 3.4 版更改: 不再抽象并且提供一个具体的实现。</p>
</li>
<li><p><em>abstractmethod</em> <code>get_source</code>(<em>fullname</em>)</p>
<p>一个返回模块源的抽象方法。使用 universal newlines 作为文本字符串被返回，将所有可识别行分割符翻译成 <code>'\n'</code> 字符。 如果没有可用的源（例如，一个内置模块），则返回 <code>None</code>。 如果加载器不能找到指定的模块，则引发 <code>ImportError</code> 异常。</p>
<p>在 3.4 版更改: 引发 <code>ImportError</code> 而不是 <code>NotImplementedError</code>。</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p>An optional method to return a true value if the module is a package, a false value otherwise. <code>ImportError</code> is raised if the loader cannot find the module.</p>
<p>在 3.4 版更改: 引发 <code>ImportError</code> 而不是 <code>NotImplementedError</code>。</p>
</li>
<li><p><em>static</em> <code>source_to_code</code>(<em>data</em>, <em>path=’&lt;string&gt;’</em>)</p>
<p>创建一个来自Python源码的代码对象。</p>
<p>参数 <em>data</em> 可以是任意 <code>compile()</code> 函数支持的类型（例如字符串或字节串）。 参数 <em>path</em> 应该是源代码来源的路径，这可能是一个抽象概念（例如位于一个 zip 文件中）。</p>
<p>在有后续代码对象的情况下，可以在一个模块中通过运行<code>exec(code, module.__dict__)</code>来执行它。</p>
<p>3.4 新版功能.</p>
<p>在 3.5 版更改: 使得这个方法变成静态的。</p>
</li>
<li><p><code>exec_module</code>(<em>module</em>)</p>
<p><code>Loader.exec_module()</code> 的实现。</p>
<p>3.4 新版功能.</p>
</li>
<li><p><code>load_module</code>(<em>fullname</em>)</p>
<p><code>Loader.load_module()</code> 的实现。</p>
<p>3.4 版后已移除: 使用 <code>exec_module()</code> 来代替。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.ExecutionLoader</code></p>
<p>一个继承自 <code>InspectLoader</code> 的抽象基类，当被实现时，帮助一个模块作为脚本来执行。 这个抽象基类表示可选的 <a href="https://www.python.org/dev/peps/pep-0302" target="_blank" rel="noopener"><strong>PEP 302</strong></a> 协议。</p>
<ul>
<li><p><em>abstractmethod</em> <code>get_filename</code>(<em>fullname</em>)</p>
<p>一个用来为指定模块返回 <code>__file__</code> 的值的抽象方法。如果无路径可用，则引发 <code>ImportError</code>。</p>
<p>如果源代码可用，那么这个方法返回源文件的路径，不管是否是用来加载模块的字节码。</p>
<p>在 3.4 版更改: 引发 <code>ImportError</code> 而不是 <code>NotImplementedError</code>。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.FileLoader</code>(<em>fullname</em>, <em>path</em>)</p>
<p>一个继承自 <code>ResourceLoader</code> 和 <code>ExecutionLoader</code>，提供 <code>ResourceLoader.get_data()</code> 和 <code>ExecutionLoader.get_filename()</code> 具体实现的抽象基类。</p>
<p>参数<em>fullname</em>是加载器要处理的模块的完全解析的名字。参数<em>path</em>是模块文件的路径。</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>name</code></p>
<p>加载器可以处理的模块的名字。</p>
</li>
<li><p><code>path</code></p>
<p>模块的文件路径</p>
</li>
<li><p><code>load_module</code>(<em>fullname</em>)</p>
<p>调用super的<code>load_module()</code>。</p>
<p>3.4 版后已移除: 使用 <code>Loader.exec_module()</code> 来代替。</p>
</li>
<li><p><em>abstractmethod</em> <code>get_filename</code>(<em>fullname</em>)</p>
<p>返回 <code>path</code>。</p>
</li>
<li><p><em>abstractmethod</em> <code>get_data</code>(<em>path</em>)</p>
<p>读取 <em>path</em> 作为二进制文件并且返回来自它的字节数据。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.SourceLoader</code></p>
<p>一个用于实现源文件（和可选地字节码）加载的抽象基类。这个类继承自 <code>ResourceLoader</code> 和 <code>ExecutionLoader</code>，需要实现：</p>
<ul>
<li><p><code>ResourceLoader.get_data()</code></p>
</li>
<li><p><code>ExecutionLoader.get_filename()</code></p>
<p>应该是只返回源文件的路径；不支持无源加载。</p>
</li>
</ul>
<p>由这个类定义的抽象方法用来添加可选的字节码文件支持。不实现这些可选的方法（或导致它们引发 <code>NotImplementedError</code> 异常）导致这个加载器只能与源代码一起工作。 实现这些方法允许加载器能与源 <em>和</em> 字节码文件一起工作。不允许只提供字节码的 <em>无源式</em> 加载。字节码文件是通过移除 Python 编译器的解析步骤来加速加载的优化，并且因此没有开放出字节码专用的 API。</p>
<ul>
<li><p><code>path_stats</code>(<em>path</em>)</p>
<p>返回一个包含关于指定路径的元数据的 <code>dict</code> 的可选的抽象方法。 支持的字典键有：</p>
<ul>
<li><code>'mtime'</code> (必选项): 一个表示源码修改时间的整数或浮点数；</li>
<li><code>'size'</code> (可选项)：源码的字节大小。</li>
</ul>
</li>
</ul>
<p>​            字典中任何其他键会被忽略，以允许将来的扩展。 如果不能处理该路径，则会引发 <code>OSError</code>。<br>​            3.3 新版功能.<br>​            在 3.4 版更改: 引发 <code>OSError</code> 而不是 <code>NotImplemented</code>。</p>
<ul>
<li><p><code>path_mtime</code>(<em>path</em>)</p>
<p>返回指定文件路径修改时间的可选的抽象方法。</p>
<p>3.3 版后已移除: 在有了 <code>path_stats()</code> 的情况下，这个方法被弃用了。 没必要去实现它了，但是为了兼容性，它依然处于可用状态。 如果文件路径不能被处理，则引发 <code>OSError</code> 异常。</p>
<p>在 3.4 版更改: 引发 <code>OSError</code> 而不是 <code>NotImplemented</code>。</p>
</li>
<li><p><code>set_data</code>(<em>path</em>, <em>data</em>)</p>
<p>往一个文件路径写入指定字节的的可选的抽象方法。任何中间不存在的目录不会被自动创建。</p>
<p>由于路径是只读的，当写入的路径产生错误时（<code>errno.EACCES</code>/<code>PermissionError</code>），不会传播异常。</p>
<p>在 3.4 版更改: 当被调用时，不再引起 <code>NotImplementedError</code> 异常。</p>
</li>
<li><p><code>get_code</code>(<em>fullname</em>)</p>
<p><code>InspectLoader.get_code()</code> 的具体实现。</p>
</li>
<li><p><code>exec_module</code>(<em>module</em>)</p>
<p><code>Loader.exec_module()</code> 的具体实现。</p>
<p>3.4 新版功能.</p>
</li>
<li><p><code>load_module</code>(<em>fullname</em>)</p>
<p>Concrete implementation of <code>Loader.load_module()</code>.</p>
<p>3.4 版后已移除: 使用 <code>exec_module()</code> 来代替。</p>
</li>
<li><p><code>get_source</code>(<em>fullname</em>)</p>
<p><code>InspectLoader.get_source()</code> 的具体实现。</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p><code>InspectLoader.is_package()</code> 的具体实现。一个模块被确定为一个包的条件是：它的文件路径（由 <code>ExecutionLoader.get_filename()</code> 提供）当文件扩展名被移除时是一个命名为 <code>__init__</code> 的文件，<strong>并且</strong> 这个模块名字本身不是以<code>__init__</code>结束。</p>
</li>
</ul>
<p><em>class</em> <code>importlib.abc.Traversable</code></p>
<p>An object with a subset of pathlib.Path methods suitable for traversing directories and opening files.</p>
<p>3.9 新版功能.</p>
<p><em>class</em> <code>importlib.abc.TraversableResources</code></p>
<p>An abstract base class for resource readers capable of serving the <code>files</code> interface. Subclasses ResourceReader and provides concrete implementations of the ResourceReader’s abstract methods. Therefore, any loader supplying TraversableReader also supplies ResourceReader.</p>
<p>Loaders that wish to support resource reading are expected to implement this interface.</p>
<p>3.9 新版功能.</p>
<h3 id="importlib-resources-—-资源"><a href="#importlib-resources-—-资源" class="headerlink" title="importlib.resources — 资源"></a><code>importlib.resources</code> — 资源</h3><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/resources.py" target="_blank" rel="noopener">Lib/importlib/resources.py</a></p>
<hr>
<p>3.7 新版功能.</p>
<p>这个模块使得Python的导入系统提供了访问<em>包</em>内的<em>资源</em>的功能。如果能够导入一个包，那么就能够访问那个包里面的资源。资源可以以二进制或文本模式方式被打开或读取。</p>
<p>资源非常类似于目录内部的文件，要牢记的是这仅仅是一个比喻。资源和包不是与文件系统上的物理文件和目录一样存在着。</p>
<p>注解</p>
<p>This module provides functionality similar to pkg_resources Basic Resource Access without the performance overhead of that package. This makes reading resources included in packages easier, with more stable and consistent semantics.</p>
<p>The standalone backport of this module provides more information on using importlib.resources and migrating from pkg_resources to importlib.resources.</p>
<p>加载器想要支持资源读取应该实现一个由 <code>importlib.abc.ResourceReader</code> 指定的<code>get_resource_reader(fullname)</code> 方法。</p>
<p>The following types are defined.</p>
<pre><code>importlib.resources.Package</code></pre><p>The <code>Package</code> type is defined as <code>Union[str, ModuleType]</code>. This means that where the function describes accepting a <code>Package</code>, you can pass in either a string or a module. Module objects must have a resolvable <code>__spec__.submodule_search_locations</code> that is not <code>None</code>.</p>
<pre><code>importlib.resources.Resource</code></pre><p>This type describes the resource names passed into the various functions in this package. This is defined as <code>Union[str, os.PathLike]</code>.</p>
<p>The following functions are available.</p>
<p><code>importlib.resources.files</code>(<em>package</em>)</p>
<p>Returns an <code>importlib.resources.abc.Traversable</code> object representing the resource container for the package (think directory) and its resources (think files). A Traversable may contain other containers (think subdirectories).</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements.</p>
<p>3.9 新版功能.</p>
<p><code>importlib.resources.as_file</code>(<em>traversable</em>)</p>
<p>Given a <code>importlib.resources.abc.Traversable</code> object representing a file, typically from <code>importlib.resources.files()</code>, return a context manager for use in a <code>with</code> statement. The context manager provides a <code>pathlib.Path</code> object.</p>
<p>Exiting the context manager cleans up any temporary file created when the resource was extracted from e.g. a zip file.</p>
<p>Use <code>as_file</code> when the Traversable methods (<code>read_text</code>, etc) are insufficient and an actual file on the file system is required.</p>
<p>3.9 新版功能.</p>
<p><code>importlib.resources.open_binary</code>(<em>package</em>, <em>resource</em>)</p>
<p>Open for binary reading the <em>resource</em> within <em>package</em>.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements. <em>resource</em> is the name of the resource to open within <em>package</em>; it may not contain path separators and it may not have sub-resources (i.e. it cannot be a directory). This function returns a <code>typing.BinaryIO</code> instance, a binary I/O stream open for reading.</p>
<p><code>importlib.resources.open_text</code>(<em>package</em>, <em>resource</em>, <em>encoding=’utf-8’</em>, <em>errors=’strict’</em>)</p>
<p>Open for text reading the <em>resource</em> within <em>package</em>. By default, the resource is opened for reading as UTF-8.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements. <em>resource</em> is the name of the resource to open within <em>package</em>; it may not contain path separators and it may not have sub-resources (i.e. it cannot be a directory). <em>encoding</em> and <em>errors</em> have the same meaning as with built-in <code>open()</code>.</p>
<p>This function returns a <code>typing.TextIO</code> instance, a text I/O stream open for reading.</p>
<p><code>importlib.resources.read_binary</code>(<em>package</em>, <em>resource</em>)</p>
<p>Read and return the contents of the <em>resource</em> within <em>package</em> as <code>bytes</code>.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements. <em>resource</em> is the name of the resource to open within <em>package</em>; it may not contain path separators and it may not have sub-resources (i.e. it cannot be a directory). This function returns the contents of the resource as <code>bytes</code>.</p>
<p><code>importlib.resources.read_text</code>(<em>package</em>, <em>resource</em>, <em>encoding=’utf-8’</em>, <em>errors=’strict’</em>)</p>
<p>Read and return the contents of <em>resource</em> within <em>package</em> as a <code>str</code>. By default, the contents are read as strict UTF-8.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements. <em>resource</em> is the name of the resource to open within <em>package</em>; it may not contain path separators and it may not have sub-resources (i.e. it cannot be a directory). <em>encoding</em> and <em>errors</em> have the same meaning as with built-in <code>open()</code>. This function returns the contents of the resource as <code>str</code>.</p>
<p><code>importlib.resources.path</code>(<em>package</em>, <em>resource</em>)</p>
<p>Return the path to the <em>resource</em> as an actual file system path. This function returns a context manager for use in a <code>with</code> statement. The context manager provides a <code>pathlib.Path</code> object.</p>
<p>Exiting the context manager cleans up any temporary file created when the resource needs to be extracted from e.g. a zip file.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements. <em>resource</em> is the name of the resource to open within <em>package</em>; it may not contain path separators and it may not have sub-resources (i.e. it cannot be a directory).</p>
<p><code>importlib.resources.is_resource</code>(<em>package</em>, <em>name</em>)</p>
<p>Return <code>True</code> if there is a resource named <em>name</em> in the package, otherwise <code>False</code>. Remember that directories are <em>not</em> resources! <em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements.</p>
<p><code>importlib.resources.contents</code>(<em>package</em>)</p>
<p>Return an iterable over the named items within the package. The iterable returns <code>str</code> resources (e.g. files) and non-resources (e.g. directories). The iterable does not recurse into subdirectories.</p>
<p><em>package</em> is either a name or a module object which conforms to the <code>Package</code> requirements.</p>
<h3 id="importlib-machinery-—-Importers-and-path-hooks"><a href="#importlib-machinery-—-Importers-and-path-hooks" class="headerlink" title="importlib.machinery — Importers and path hooks"></a><code>importlib.machinery</code> — Importers and path hooks</h3><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/machinery.py" target="_blank" rel="noopener">Lib/importlib/machinery.py</a></p>
<hr>
<p>This module contains the various objects that help <code>import</code> find and load modules.</p>
<pre><code>importlib.machinery.SOURCE_SUFFIXES</code></pre><p>A list of strings representing the recognized file suffixes for source modules.</p>
<p>3.3 新版功能.</p>
<pre><code>importlib.machinery.DEBUG_BYTECODE_SUFFIXES</code></pre><p>A list of strings representing the file suffixes for non-optimized bytecode modules.</p>
<p>3.3 新版功能.</p>
<p>3.5 版后已移除: Use <code>BYTECODE_SUFFIXES</code> instead.</p>
<pre><code>importlib.machinery.OPTIMIZED_BYTECODE_SUFFIXES</code></pre><p>A list of strings representing the file suffixes for optimized bytecode modules.</p>
<p>3.3 新版功能.</p>
<p>3.5 版后已移除: Use <code>BYTECODE_SUFFIXES</code> instead.</p>
<pre><code>importlib.machinery.BYTECODE_SUFFIXES</code></pre><p>A list of strings representing the recognized file suffixes for bytecode modules (including the leading dot).</p>
<p>3.3 新版功能.</p>
<p>在 3.5 版更改: The value is no longer dependent on <code>__debug__</code>.</p>
<pre><code>importlib.machinery.EXTENSION_SUFFIXES</code></pre><p>A list of strings representing the recognized file suffixes for extension modules.</p>
<p>3.3 新版功能.</p>
<p><code>importlib.machinery.all_suffixes</code>()</p>
<p>Returns a combined list of strings representing all file suffixes for modules recognized by the standard import machinery. This is a helper for code which simply needs to know if a filesystem path potentially refers to a module without needing any details on the kind of module (for example, <code>inspect.getmodulename()</code>).</p>
<p>3.3 新版功能.</p>
<p><em>class</em> <code>importlib.machinery.BuiltinImporter</code></p>
<p>An importer for built-in modules. All known built-in modules are listed in <code>sys.builtin_module_names</code>. This class implements the <code>importlib.abc.MetaPathFinder</code> and <code>importlib.abc.InspectLoader</code> ABCs.</p>
<p>Only class methods are defined by this class to alleviate the need for instantiation.</p>
<p>在 3.5 版更改: As part of <a href="https://www.python.org/dev/peps/pep-0489" target="_blank" rel="noopener"><strong>PEP 489</strong></a>, the builtin importer now implements <code>Loader.create_module()</code> and <code>Loader.exec_module()</code></p>
<p><em>class</em> <code>importlib.machinery.FrozenImporter</code></p>
<p>An importer for frozen modules. This class implements the <code>importlib.abc.MetaPathFinder</code> and <code>importlib.abc.InspectLoader</code> ABCs.</p>
<p>Only class methods are defined by this class to alleviate the need for instantiation.</p>
<p>在 3.4 版更改: Gained <code>create_module()</code> and <code>exec_module()</code> methods.</p>
<p><em>class</em> <code>importlib.machinery.WindowsRegistryFinder</code></p>
<p>Finder for modules declared in the Windows registry. This class implements the <code>importlib.abc.MetaPathFinder</code> ABC.</p>
<p>Only class methods are defined by this class to alleviate the need for instantiation.</p>
<p>3.3 新版功能.</p>
<p>3.6 版后已移除: Use <code>site</code> configuration instead. Future versions of Python may not enable this finder by default.</p>
<p><em>class</em> <code>importlib.machinery.PathFinder</code></p>
<p>A Finder for <code>sys.path</code> and package <code>__path__</code> attributes. This class implements the <code>importlib.abc.MetaPathFinder</code> ABC.</p>
<p>Only class methods are defined by this class to alleviate the need for instantiation.</p>
<ul>
<li><p><em>classmethod</em> <code>find_spec</code>(<em>fullname</em>, <em>path=None</em>, <em>target=None</em>)</p>
<p>Class method that attempts to find a spec for the module specified by <em>fullname</em> on <code>sys.path</code> or, if defined, on <em>path</em>. For each path entry that is searched, <code>sys.path_importer_cache</code> is checked. If a non-false object is found then it is used as the path entry finder to look for the module being searched for. If no entry is found in <code>sys.path_importer_cache</code>, then <code>sys.path_hooks</code> is searched for a finder for the path entry and, if found, is stored in <code>sys.path_importer_cache</code> along with being queried about the module. If no finder is ever found then <code>None</code> is both stored in the cache and returned.</p>
<p>3.4 新版功能.</p>
<p>在 3.5 版更改: If the current working directory — represented by an empty string — is no longer valid then <code>None</code> is returned but no value is cached in <code>sys.path_importer_cache</code>.</p>
</li>
<li><p><em>classmethod</em> <code>find_module</code>(<em>fullname</em>, <em>path=None</em>)</p>
<p>A legacy wrapper around <code>find_spec()</code>.</p>
<p>3.4 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><em>classmethod</em> <code>invalidate_caches</code>()</p>
<p>Calls <code>importlib.abc.PathEntryFinder.invalidate_caches()</code> on all finders stored in <code>sys.path_importer_cache</code> that define the method. Otherwise entries in <code>sys.path_importer_cache</code> set to <code>None</code> are deleted.</p>
<p>在 3.7 版更改: Entries of <code>None</code> in <code>sys.path_importer_cache</code> are deleted.</p>
</li>
</ul>
<p>在 3.4 版更改: Calls objects in <code>sys.path_hooks</code> with the current working directory for <code>''</code> (i.e. the empty string).</p>
<p><em>class</em> <code>importlib.machinery.FileFinder</code>(<em>path</em>, <em>\</em>loader_details*)</p>
<p>A concrete implementation of <code>importlib.abc.PathEntryFinder</code> which caches results from the file system.</p>
<p>The <em>path</em> argument is the directory for which the finder is in charge of searching.</p>
<p>The <em>loader_details</em> argument is a variable number of 2-item tuples each containing a loader and a sequence of file suffixes the loader recognizes. The loaders are expected to be callables which accept two arguments of the module’s name and the path to the file found.</p>
<p>The finder will cache the directory contents as necessary, making stat calls for each module search to verify the cache is not outdated. Because cache staleness relies upon the granularity of the operating system’s state information of the file system, there is a potential race condition of searching for a module, creating a new file, and then searching for the module the new file represents. If the operations happen fast enough to fit within the granularity of stat calls, then the module search will fail. To prevent this from happening, when you create a module dynamically, make sure to call <code>importlib.invalidate_caches()</code>.</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>path</code></p>
<p>The path the finder will search in.</p>
</li>
<li><p><code>find_spec</code>(<em>fullname</em>, <em>target=None</em>)</p>
<p>Attempt to find the spec to handle <em>fullname</em> within <code>path</code>.</p>
<p>3.4 新版功能.</p>
</li>
<li><p><code>find_loader</code>(<em>fullname</em>)</p>
<p>Attempt to find the loader to handle <em>fullname</em> within <code>path</code>.</p>
<p>3.10 版后已移除: 使用 <code>find_spec()</code> 来代替。</p>
</li>
<li><p><code>invalidate_caches</code>()</p>
<p>Clear out the internal cache.</p>
</li>
<li><p><em>classmethod</em> <code>path_hook</code>(<em>\</em>loader_details*)</p>
<p>A class method which returns a closure for use on <code>sys.path_hooks</code>. An instance of <code>FileFinder</code> is returned by the closure using the path argument given to the closure directly and <em>loader_details</em> indirectly.</p>
<p>If the argument to the closure is not an existing directory, <code>ImportError</code> is raised.</p>
</li>
</ul>
<p><em>class</em> <code>importlib.machinery.SourceFileLoader</code>(<em>fullname</em>, <em>path</em>)</p>
<p>A concrete implementation of <code>importlib.abc.SourceLoader</code> by subclassing <code>importlib.abc.FileLoader</code> and providing some concrete implementations of other methods.</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>name</code></p>
<p>The name of the module that this loader will handle.</p>
</li>
<li><p><code>path</code></p>
<p>The path to the source file.</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p>Return <code>True</code> if <code>path</code> appears to be for a package.</p>
</li>
<li><p><code>path_stats</code>(<em>path</em>)</p>
<p>Concrete implementation of <code>importlib.abc.SourceLoader.path_stats()</code>.</p>
</li>
<li><p><code>set_data</code>(<em>path</em>, <em>data</em>)</p>
<p>Concrete implementation of <code>importlib.abc.SourceLoader.set_data()</code>.</p>
</li>
<li><p><code>load_module</code>(<em>name=None</em>)</p>
<p>Concrete implementation of <code>importlib.abc.Loader.load_module()</code> where specifying the name of the module to load is optional.</p>
<p>3.6 版后已移除: Use <code>importlib.abc.Loader.exec_module()</code> instead.</p>
</li>
</ul>
<p><em>class</em> <code>importlib.machinery.SourcelessFileLoader</code>(<em>fullname</em>, <em>path</em>)</p>
<p>A concrete implementation of <code>importlib.abc.FileLoader</code> which can import bytecode files (i.e. no source code files exist).</p>
<p>Please note that direct use of bytecode files (and thus not source code files) inhibits your modules from being usable by all Python implementations or new versions of Python which change the bytecode format.</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>name</code></p>
<p>The name of the module the loader will handle.</p>
</li>
<li><p><code>path</code></p>
<p>The path to the bytecode file.</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p>Determines if the module is a package based on <code>path</code>.</p>
</li>
<li><p><code>get_code</code>(<em>fullname</em>)</p>
<p>Returns the code object for <code>name</code> created from <code>path</code>.</p>
</li>
<li><p><code>get_source</code>(<em>fullname</em>)</p>
<p>Returns <code>None</code> as bytecode files have no source when this loader is used.</p>
</li>
<li><p><code>load_module</code>(<em>name=None</em>)</p>
</li>
</ul>
<p>Concrete implementation of <code>importlib.abc.Loader.load_module()</code> where specifying the name of the module to load is optional.</p>
<p>3.6 版后已移除: Use <code>importlib.abc.Loader.exec_module()</code> instead.</p>
<p><em>class</em> <code>importlib.machinery.ExtensionFileLoader</code>(<em>fullname</em>, <em>path</em>)</p>
<p>A concrete implementation of <code>importlib.abc.ExecutionLoader</code> for extension modules.</p>
<p>The <em>fullname</em> argument specifies the name of the module the loader is to support. The <em>path</em> argument is the path to the extension module’s file.</p>
<p>3.3 新版功能.</p>
<ul>
<li><p><code>name</code></p>
<p>Name of the module the loader supports.</p>
</li>
<li><p><code>path</code></p>
<p>Path to the extension module.</p>
</li>
<li><p><code>create_module</code>(<em>spec</em>)</p>
<p>Creates the module object from the given specification in accordance with <a href="https://www.python.org/dev/peps/pep-0489" target="_blank" rel="noopener"><strong>PEP 489</strong></a>.</p>
<p>3.5 新版功能.</p>
</li>
<li><p><code>exec_module</code>(<em>module</em>)</p>
<p>Initializes the given module object in accordance with <a href="https://www.python.org/dev/peps/pep-0489" target="_blank" rel="noopener"><strong>PEP 489</strong></a>.</p>
<p>3.5 新版功能.</p>
</li>
<li><p><code>is_package</code>(<em>fullname</em>)</p>
<p>Returns <code>True</code> if the file path points to a package’s <code>__init__</code> module based on <code>EXTENSION_SUFFIXES</code>.</p>
</li>
<li><p><code>get_code</code>(<em>fullname</em>)</p>
<p>Returns <code>None</code> as extension modules lack a code object.</p>
</li>
<li><p><code>get_source</code>(<em>fullname</em>)</p>
<p>Returns <code>None</code> as extension modules do not have source code.</p>
</li>
<li><p><code>get_filename</code>(<em>fullname</em>)</p>
<p>返回 <code>path</code>。</p>
<p>3.4 新版功能.</p>
</li>
</ul>
<p><em>class</em> <code>importlib.machinery.ModuleSpec</code>(<em>name</em>, <em>loader</em>, <em>**,</em> origin=None<em>,</em> loader_state=None<em>,</em> is_package=None*)</p>
<p>A specification for a module’s import-system-related state. This is typically exposed as the module’s <code>__spec__</code> attribute. In the descriptions below, the names in parentheses give the corresponding attribute available directly on the module object. E.g. <code>module.__spec__.origin == module.__file__</code>. Note however that while the <em>values</em> are usually equivalent, they can differ since there is no synchronization between the two objects. Thus it is possible to update the module’s <code>__path__</code> at runtime, and this will not be automatically reflected in <code>__spec__.submodule_search_locations</code>.</p>
<p>3.4 新版功能.</p>
<ul>
<li><code>name</code></li>
</ul>
<p>(<code>__name__</code>)</p>
<p>A string for the fully-qualified name of the module.</p>
<ul>
<li><code>loader</code></li>
</ul>
<p>(<code>__loader__</code>)</p>
<p>The Loader that should be used when loading the module. Finders should always set this.</p>
<ul>
<li><code>origin</code></li>
</ul>
<p>(<code>__file__</code>)</p>
<p>Name of the place from which the module is loaded, e.g. “builtin” for built-in modules and the filename for modules loaded from source. Normally “origin” should be set, but it may be <code>None</code> (the default) which indicates it is unspecified (e.g. for namespace packages).</p>
<ul>
<li><code>submodule_search_locations</code></li>
</ul>
<p>(<code>__path__</code>)</p>
<p>List of strings for where to find submodules, if a package (<code>None</code> otherwise).</p>
<ul>
<li><code>loader_state</code></li>
</ul>
<p>Container of extra module-specific data for use during loading (or <code>None</code>).</p>
<ul>
<li><code>cached</code></li>
</ul>
<p>(<code>__cached__</code>)</p>
<p>String for where the compiled module should be stored (or <code>None</code>).</p>
<ul>
<li><code>parent</code></li>
</ul>
<p>(<code>__package__</code>)</p>
<p>(Read-only) The fully-qualified name of the package under which the module should be loaded as a submodule (or the empty string for top-level modules). For packages, it is the same as <code>__name__</code>.</p>
<ul>
<li><code>has_location</code></li>
</ul>
<p>Boolean indicating whether or not the module’s “origin” attribute refers to a loadable location.</p>
<h3 id="importlib-util-—-Utility-code-for-importers"><a href="#importlib-util-—-Utility-code-for-importers" class="headerlink" title="importlib.util — Utility code for importers"></a><code>importlib.util</code> — Utility code for importers</h3><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/util.py" target="_blank" rel="noopener">Lib/importlib/util.py</a></p>
<hr>
<p>This module contains the various objects that help in the construction of an importer.</p>
<pre><code>importlib.util.MAGIC_NUMBER</code></pre><p>The bytes which represent the bytecode version number. If you need help with loading/writing bytecode then consider <code>importlib.abc.SourceLoader</code>.</p>
<p>3.4 新版功能.</p>
<p><code>importlib.util.cache_from_source</code>(<em>path</em>, <em>debug_override=None</em>, <em>**,</em> optimization=None*)</p>
<p>Return the <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a>/<a href="https://www.python.org/dev/peps/pep-0488" target="_blank" rel="noopener"><strong>PEP 488</strong></a> path to the byte-compiled file associated with the source <em>path</em>. For example, if <em>path</em> is <code>/foo/bar/baz.py</code> the return value would be <code>/foo/bar/__pycache__/baz.cpython-32.pyc</code> for Python 3.2. The <code>cpython-32</code> string comes from the current magic tag (see <code>get_tag()</code>; if <code>sys.implementation.cache_tag</code> is not defined then <code>NotImplementedError</code> will be raised).</p>
<p>The <em>optimization</em> parameter is used to specify the optimization level of the bytecode file. An empty string represents no optimization, so <code>/foo/bar/baz.py</code> with an <em>optimization</em> of <code>''</code> will result in a bytecode path of <code>/foo/bar/__pycache__/baz.cpython-32.pyc</code>. <code>None</code> causes the interpreter’s optimization level to be used. Any other value’s string representation is used, so <code>/foo/bar/baz.py</code> with an <em>optimization</em> of <code>2</code> will lead to the bytecode path of <code>/foo/bar/__pycache__/baz.cpython-32.opt-2.pyc</code>. The string representation of <em>optimization</em> can only be alphanumeric, else <code>ValueError</code> is raised.</p>
<p>The <em>debug_override</em> parameter is deprecated and can be used to override the system’s value for <code>__debug__</code>. A <code>True</code> value is the equivalent of setting <em>optimization</em> to the empty string. A <code>False</code> value is the same as setting <em>optimization</em> to <code>1</code>. If both <em>debug_override</em> an <em>optimization</em> are not <code>None</code> then <code>TypeError</code> is raised.</p>
<p>3.4 新版功能.</p>
<p>在 3.5 版更改: The <em>optimization</em> parameter was added and the <em>debug_override</em> parameter was deprecated.</p>
<p>在 3.6 版更改: 接受一个 path-like object。</p>
<p><code>importlib.util.source_from_cache</code>(<em>path</em>)</p>
<p>Given the <em>path</em> to a <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> file name, return the associated source code file path. For example, if <em>path</em> is <code>/foo/bar/__pycache__/baz.cpython-32.pyc</code> the returned path would be <code>/foo/bar/baz.py</code>. <em>path</em> need not exist, however if it does not conform to <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> or <a href="https://www.python.org/dev/peps/pep-0488" target="_blank" rel="noopener"><strong>PEP 488</strong></a> format, a <code>ValueError</code> is raised. If <code>sys.implementation.cache_tag</code> is not defined, <code>NotImplementedError</code> is raised.</p>
<p>3.4 新版功能.</p>
<p>在 3.6 版更改: 接受一个 path-like object。</p>
<p><code>importlib.util.decode_source</code>(<em>source_bytes</em>)</p>
<p>Decode the given bytes representing source code and return it as a string with universal newlines (as required by <code>importlib.abc.InspectLoader.get_source()</code>).</p>
<p>3.4 新版功能.</p>
<p><code>importlib.util.resolve_name</code>(<em>name</em>, <em>package</em>)</p>
<p>Resolve a relative module name to an absolute one.</p>
<p>If <strong>name</strong> has no leading dots, then <strong>name</strong> is simply returned. This allows for usage such as <code>importlib.util.resolve_name('sys', __spec__.parent)</code> without doing a check to see if the <strong>package</strong> argument is needed.</p>
<p><code>ImportError</code> is raised if <strong>name</strong> is a relative module name but <strong>package</strong> is a false value (e.g. <code>None</code> or the empty string). <code>ImportError</code> is also raised a relative name would escape its containing package (e.g. requesting <code>..bacon</code> from within the <code>spam</code> package).</p>
<p>3.3 新版功能.</p>
<p>在 3.9 版更改: To improve consistency with import statements, raise <code>ImportError</code> instead of <code>ValueError</code> for invalid relative import attempts.</p>
<p><code>importlib.util.find_spec</code>(<em>name</em>, <em>package=None</em>)</p>
<p>Find the spec for a module, optionally relative to the specified <strong>package</strong> name. If the module is in <code>sys.modules</code>, then <code>sys.modules[name].__spec__</code> is returned (unless the spec would be <code>None</code> or is not set, in which case <code>ValueError</code> is raised). Otherwise a search using <code>sys.meta_path</code> is done. <code>None</code> is returned if no spec is found.</p>
<p>If <strong>name</strong> is for a submodule (contains a dot), the parent module is automatically imported.</p>
<p><strong>name</strong> and <strong>package</strong> work the same as for <code>import_module()</code>.</p>
<p>3.4 新版功能.</p>
<p>在 3.7 版更改: Raises <code>ModuleNotFoundError</code> instead of <code>AttributeError</code> if <strong>package</strong> is in fact not a package (i.e. lacks a <code>__path__</code> attribute).</p>
<p><code>importlib.util.module_from_spec</code>(<em>spec</em>)</p>
<p>Create a new module based on <strong>spec</strong> and <code>spec.loader.create_module</code>.</p>
<p>If <code>spec.loader.create_module</code> does not return <code>None</code>, then any pre-existing attributes will not be reset. Also, no <code>AttributeError</code> will be raised if triggered while accessing <strong>spec</strong> or setting an attribute on the module.</p>
<p>This function is preferred over using <code>types.ModuleType</code> to create a new module as <strong>spec</strong> is used to set as many import-controlled attributes on the module as possible.</p>
<p>3.5 新版功能.</p>
<pre><code>@``importlib.util.module_for_loader</code></pre><p>A decorator for <code>importlib.abc.Loader.load_module()</code> to handle selecting the proper module object to load with. The decorated method is expected to have a call signature taking two positional arguments (e.g. <code>load_module(self, module)</code>) for which the second argument will be the module <strong>object</strong> to be used by the loader. Note that the decorator will not work on static methods because of the assumption of two arguments.</p>
<p>The decorated method will take in the <strong>name</strong> of the module to be loaded as expected for a loader. If the module is not found in <code>sys.modules</code> then a new one is constructed. Regardless of where the module came from, <code>__loader__</code> set to <strong>self</strong> and <code>__package__</code> is set based on what <code>importlib.abc.InspectLoader.is_package()</code> returns (if available). These attributes are set unconditionally to support reloading.</p>
<p>If an exception is raised by the decorated method and a module was added to <code>sys.modules</code>, then the module will be removed to prevent a partially initialized module from being in left in <code>sys.modules</code>. If the module was already in <code>sys.modules</code> then it is left alone.</p>
<p>在 3.3 版更改: <code>__loader__</code> and <code>__package__</code> are automatically set (when possible).</p>
<p>在 3.4 版更改: Set <code>__name__</code>, <code>__loader__</code> <code>__package__</code> unconditionally to support reloading.</p>
<p>3.4 版后已移除: The import machinery now directly performs all the functionality provided by this function.</p>
<pre><code>@``importlib.util.set_loader</code></pre><p>A decorator for <code>importlib.abc.Loader.load_module()</code> to set the <code>__loader__</code> attribute on the returned module. If the attribute is already set the decorator does nothing. It is assumed that the first positional argument to the wrapped method (i.e. <code>self</code>) is what <code>__loader__</code> should be set to.</p>
<p>在 3.4 版更改: Set <code>__loader__</code> if set to <code>None</code>, as if the attribute does not exist.</p>
<p>3.4 版后已移除: The import machinery takes care of this automatically.</p>
<pre><code>@``importlib.util.set_package</code></pre><p>A decorator for <code>importlib.abc.Loader.load_module()</code> to set the <code>__package__</code> attribute on the returned module. If <code>__package__</code> is set and has a value other than <code>None</code> it will not be changed.</p>
<p>3.4 版后已移除: The import machinery takes care of this automatically.</p>
<p><code>importlib.util.spec_from_loader</code>(<em>name</em>, <em>loader</em>, <em>**,</em> origin=None<em>,</em> is_package=None*)</p>
<p>A factory function for creating a <code>ModuleSpec</code> instance based on a loader. The parameters have the same meaning as they do for ModuleSpec. The function uses available loader APIs, such as <code>InspectLoader.is_package()</code>, to fill in any missing information on the spec.</p>
<p>3.4 新版功能.</p>
<p><code>importlib.util.spec_from_file_location</code>(<em>name</em>, <em>location</em>, <em>**,</em> loader=None<em>,</em> submodule_search_locations=None*)</p>
<p>A factory function for creating a <code>ModuleSpec</code> instance based on the path to a file. Missing information will be filled in on the spec by making use of loader APIs and by the implication that the module will be file-based.</p>
<p>3.4 新版功能.</p>
<p>在 3.6 版更改: 接受一个 path-like object。</p>
<p><code>importlib.util.source_hash</code>(<em>source_bytes</em>)</p>
<p>Return the hash of <em>source_bytes</em> as bytes. A hash-based <code>.pyc</code> file embeds the <code>source_hash()</code> of the corresponding source file’s contents in its header.</p>
<p>3.7 新版功能.</p>
<p><em>class</em> <code>importlib.util.LazyLoader</code>(<em>loader</em>)</p>
<p>A class which postpones the execution of the loader of a module until the module has an attribute accessed.</p>
<p>This class <strong>only</strong> works with loaders that define <code>exec_module()</code> as control over what module type is used for the module is required. For those same reasons, the loader’s <code>create_module()</code> method must return <code>None</code> or a type for which its <code>__class__</code> attribute can be mutated along with not using slots. Finally, modules which substitute the object placed into <code>sys.modules</code> will not work as there is no way to properly replace the module references throughout the interpreter safely; <code>ValueError</code> is raised if such a substitution is detected.</p>
<p>注解</p>
<p>For projects where startup time is critical, this class allows for potentially minimizing the cost of loading a module if it is never used. For projects where startup time is not essential then use of this class is <strong>heavily</strong> discouraged due to error messages created during loading being postponed and thus occurring out of context.</p>
<p>3.5 新版功能.</p>
<p>在 3.6 版更改: Began calling <code>create_module()</code>, removing the compatibility warning for <code>importlib.machinery.BuiltinImporter</code> and <code>importlib.machinery.ExtensionFileLoader</code>.</p>
<ul>
<li><p><em>classmethod</em> <code>factory</code>(<em>loader</em>)</p>
<p>A static method which returns a callable that creates a lazy loader. This is meant to be used in situations where the loader is passed by class instead of by instance.</p>
<pre class="line-numbers language-python"><code class="language-python">suffixes <span class="token operator">=</span> importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>SOURCE_SUFFIXES
loader <span class="token operator">=</span> importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>SourceFileLoader
lazy_loader <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>LazyLoader<span class="token punctuation">.</span>factory<span class="token punctuation">(</span>loader<span class="token punctuation">)</span>
finder <span class="token operator">=</span> importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>FileFinder<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span>lazy_loader<span class="token punctuation">,</span> suffixes<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><h4 id="Importing-programmatically"><a href="#Importing-programmatically" class="headerlink" title="Importing programmatically"></a>Importing programmatically</h4><p>To programmatically import a module, use <code>importlib.import_module()</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> importlib
itertools <span class="token operator">=</span> importlib<span class="token punctuation">.</span>import_module<span class="token punctuation">(</span><span class="token string">'itertools'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="Checking-if-a-module-can-be-imported"><a href="#Checking-if-a-module-can-be-imported" class="headerlink" title="Checking if a module can be imported"></a>Checking if a module can be imported</h4><p>If you need to find out if a module can be imported without actually doing the import, then you should use <code>importlib.util.find_spec()</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> importlib<span class="token punctuation">.</span>util
<span class="token keyword">import</span> sys
<span class="token comment" spellcheck="true"># For illustrative purposes.</span>
name <span class="token operator">=</span> <span class="token string">'itertools'</span>
<span class="token keyword">if</span> name <span class="token keyword">in</span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{name!r} already in sys.modules"</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> <span class="token punctuation">(</span>spec <span class="token punctuation">:</span><span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>find_spec<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># If you chose to perform the actual import ...</span>
    module <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>module_from_spec<span class="token punctuation">(</span>spec<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> module
    spec<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>exec_module<span class="token punctuation">(</span>module<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{name!r} has been imported"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"can't find the {name!r} module"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Importing-a-source-file-directly"><a href="#Importing-a-source-file-directly" class="headerlink" title="Importing a source file directly"></a>Importing a source file directly</h4><p>To import a Python source file directly, use the following recipe (Python 3.5 and newer only):</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> importlib<span class="token punctuation">.</span>util
<span class="token keyword">import</span> sys
<span class="token comment" spellcheck="true"># For illustrative purposes.</span>
<span class="token keyword">import</span> tokenize
file_path <span class="token operator">=</span> tokenize<span class="token punctuation">.</span>__file__
module_name <span class="token operator">=</span> tokenize<span class="token punctuation">.</span>__name__
spec <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>spec_from_file_location<span class="token punctuation">(</span>module_name<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span>
module <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>module_from_spec<span class="token punctuation">(</span>spec<span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>module_name<span class="token punctuation">]</span> <span class="token operator">=</span> module
spec<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>exec_module<span class="token punctuation">(</span>module<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Implementing-lazy-imports"><a href="#Implementing-lazy-imports" class="headerlink" title="Implementing lazy imports"></a>Implementing lazy imports</h4><p>The example below shows how to implement lazy imports:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> importlib<span class="token punctuation">.</span>util
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">lazy_import</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     spec <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>find_spec<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     loader <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>LazyLoader<span class="token punctuation">(</span>spec<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     spec<span class="token punctuation">.</span>loader <span class="token operator">=</span> loader
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     module <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>module_from_spec<span class="token punctuation">(</span>spec<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> module
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     loader<span class="token punctuation">.</span>exec_module<span class="token punctuation">(</span>module<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> module
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> lazy_typing <span class="token operator">=</span> lazy_import<span class="token punctuation">(</span><span class="token string">"typing"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token comment" spellcheck="true">#lazy_typing is a real module object,</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token comment" spellcheck="true">#but it is not loaded in memory yet.</span>
<span class="token operator">>></span><span class="token operator">></span> lazy_typing<span class="token punctuation">.</span>TYPE_CHECKING
<span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Setting-up-an-importer"><a href="#Setting-up-an-importer" class="headerlink" title="Setting up an importer"></a>Setting up an importer</h4><p>For deep customizations of import, you typically want to implement an importer. This means managing both the finder and loader side of things. For finders there are two flavours to choose from depending on your needs: a meta path finder or a path entry finder. The former is what you would put on <code>sys.meta_path</code> while the latter is what you create using a path entry hook on <code>sys.path_hooks</code> which works with <code>sys.path</code> entries to potentially create a finder. This example will show you how to register your own importers so that import will use them (for creating an importer for yourself, read the documentation for the appropriate classes defined within this package):</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> importlib<span class="token punctuation">.</span>machinery
<span class="token keyword">import</span> sys
<span class="token comment" spellcheck="true"># For illustrative purposes only.</span>
SpamMetaPathFinder <span class="token operator">=</span> importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>PathFinder
SpamPathEntryFinder <span class="token operator">=</span> importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>FileFinder
loader_details <span class="token operator">=</span> <span class="token punctuation">(</span>importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>SourceFileLoader<span class="token punctuation">,</span>
                  importlib<span class="token punctuation">.</span>machinery<span class="token punctuation">.</span>SOURCE_SUFFIXES<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Setting up a meta path finder.</span>
<span class="token comment" spellcheck="true"># Make sure to put the finder in the proper location in the list in terms of</span>
<span class="token comment" spellcheck="true"># priority.</span>
sys<span class="token punctuation">.</span>meta_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>SpamMetaPathFinder<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Setting up a path entry finder.</span>
<span class="token comment" spellcheck="true"># Make sure to put the path hook in the proper location in the list in terms</span>
<span class="token comment" spellcheck="true"># of priority.</span>
sys<span class="token punctuation">.</span>path_hooks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>SpamPathEntryFinder<span class="token punctuation">.</span>path_hook<span class="token punctuation">(</span>loader_details<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Approximating-importlib-import-module"><a href="#Approximating-importlib-import-module" class="headerlink" title="Approximating importlib.import_module()"></a>Approximating <code>importlib.import_module()</code></h4><p>Import itself is implemented in Python code, making it possible to expose most of the import machinery through importlib. The following helps illustrate the various APIs that importlib exposes by providing an approximate implementation of <code>importlib.import_module()</code> (Python 3.4 and newer for the importlib usage, Python 3.6 and newer for other parts of the code).</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> importlib<span class="token punctuation">.</span>util
<span class="token keyword">import</span> sys
<span class="token keyword">def</span> <span class="token function">import_module</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> package<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""An approximate implementation of import."""</span>
    absolute_name <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>resolve_name<span class="token punctuation">(</span>name<span class="token punctuation">,</span> package<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>absolute_name<span class="token punctuation">]</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    path <span class="token operator">=</span> None
    <span class="token keyword">if</span> <span class="token string">'.'</span> <span class="token keyword">in</span> absolute_name<span class="token punctuation">:</span>
        parent_name<span class="token punctuation">,</span> _<span class="token punctuation">,</span> child_name <span class="token operator">=</span> absolute_name<span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
        parent_module <span class="token operator">=</span> import_module<span class="token punctuation">(</span>parent_name<span class="token punctuation">)</span>
        path <span class="token operator">=</span> parent_module<span class="token punctuation">.</span>__spec__<span class="token punctuation">.</span>submodule_search_locations
    <span class="token keyword">for</span> finder <span class="token keyword">in</span> sys<span class="token punctuation">.</span>meta_path<span class="token punctuation">:</span>
        spec <span class="token operator">=</span> finder<span class="token punctuation">.</span>find_spec<span class="token punctuation">(</span>absolute_name<span class="token punctuation">,</span> path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> spec <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        msg <span class="token operator">=</span> f<span class="token string">'No module named {absolute_name!r}'</span>
        <span class="token keyword">raise</span> ModuleNotFoundError<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> name<span class="token operator">=</span>absolute_name<span class="token punctuation">)</span>
    module <span class="token operator">=</span> importlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>module_from_spec<span class="token punctuation">(</span>spec<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>absolute_name<span class="token punctuation">]</span> <span class="token operator">=</span> module
    spec<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>exec_module<span class="token punctuation">(</span>module<span class="token punctuation">)</span>
    <span class="token keyword">if</span> path <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>
        setattr<span class="token punctuation">(</span>parent_module<span class="token punctuation">,</span> child_name<span class="token punctuation">,</span> module<span class="token punctuation">)</span>
    <span class="token keyword">return</span> module<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Using-importlib-metadata"><a href="#Using-importlib-metadata" class="headerlink" title="Using importlib.metadata"></a>Using <code>importlib.metadata</code></h3><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/importlib/metadata.py" target="_blank" rel="noopener">Lib/importlib/metadata.py</a></p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/importlib.metadata.html" target="_blank" rel="noopener">Using <code>importlib.metadata</code></a></li>
</ul>
<h1 id="Python-语言服务"><a href="#Python-语言服务" class="headerlink" title="Python 语言服务"></a>Python 语言服务</h1><p>Python 提供了许多模块来帮助使用 Python 语言。 这些模块支持标记化、解析、语法分析、字节码反汇编以及各种其他工具。</p>
<p>这些模块包括：</p>
<ul>
<li><code>ast</code> —- 抽象语法树<ul>
<li>抽象文法</li>
<li>节点类<ul>
<li>字面值</li>
<li>Variables</li>
<li>表达式<ul>
<li>Subscripting</li>
<li>Comprehensions</li>
</ul>
</li>
<li>Statements<ul>
<li>Imports</li>
</ul>
</li>
<li>Control flow</li>
<li>Pattern matching</li>
<li>Function and class definitions</li>
<li>Async and await</li>
</ul>
</li>
<li><code>ast</code> 中的辅助函数</li>
<li>Compiler Flags</li>
<li>Command-Line Usage</li>
</ul>
</li>
<li><code>symtable</code> —- Access to the compiler’s symbol tables<ul>
<li>Generating Symbol Tables</li>
<li>Examining Symbol Tables</li>
</ul>
</li>
<li><code>token</code> —- 与Python解析树一起使用的常量</li>
<li><code>keyword</code> —- 检验Python关键字</li>
<li><code>tokenize</code> —- 对 Python 代码使用的标记解析器<ul>
<li>对输入进行解析标记</li>
<li>Command-Line Usage</li>
<li>例子</li>
</ul>
</li>
<li><code>tabnanny</code> —- 模糊缩进检测</li>
<li><code>pyclbr</code> —- Python 模块浏览器支持<ul>
<li>Function 对象</li>
<li>Class 对象</li>
</ul>
</li>
<li><code>py_compile</code> —- 编译 Python 源文件<ul>
<li>命令行接口</li>
</ul>
</li>
<li><code>compileall</code> —- Byte-compile Python libraries<ul>
<li>Command-line use</li>
<li>Public functions</li>
</ul>
</li>
<li><code>dis</code> —- Python 字节码反汇编器<ul>
<li>字节码分析</li>
<li>分析函数</li>
<li>Python字节码说明</li>
<li>操作码集合</li>
</ul>
</li>
<li><code>pickletools</code> —- pickle 开发者工具集<ul>
<li>命令行语法<ul>
<li>命令行选项</li>
</ul>
</li>
<li>编程接口</li>
</ul>
</li>
</ul>
<h2 id="ast-—-抽象语法树"><a href="#ast-—-抽象语法树" class="headerlink" title="ast —- 抽象语法树"></a><code>ast</code> —- 抽象语法树</h2><p><strong>源代码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/ast.py" target="_blank" rel="noopener">Lib/ast.py</a></p>
<hr>
<p><code>ast</code> 模块帮助 Python 程序处理 Python 语法的抽象语法树。抽象语法或许会随着 Python 的更新发布而改变；该模块能够帮助理解当前语法在编程层面的样貌。</p>
<p>抽象语法树可通过将 <code>ast.PyCF_ONLY_AST</code> 作为旗标传递给 <code>compile()</code> 内置函数来生成，或是使用此模块中提供的 <code>parse()</code> 辅助函数。返回结果将是一个对象树，，其中的类都继承自 <code>ast.AST</code>。抽象语法树可被内置的 <code>compile()</code> 函数编译为一个 Python 代码对象。</p>
<h3 id="抽象文法"><a href="#抽象文法" class="headerlink" title="抽象文法"></a>抽象文法</h3><p>抽象文法目前定义如下</p>
<pre><code>-- ASDL's 4 builtin types are:
-- identifier, int, string, constant
module Python
{
    mod = Module(stmt* body, type_ignore* type_ignores)
        | Interactive(stmt* body)
        | Expression(expr body)
        | FunctionType(expr* argtypes, expr returns)
    stmt = FunctionDef(identifier name, arguments args,
                       stmt* body, expr* decorator_list, expr? returns,
                       string? type_comment)
          | AsyncFunctionDef(identifier name, arguments args,
                             stmt* body, expr* decorator_list, expr? returns,
                             string? type_comment)
          | ClassDef(identifier name,
             expr* bases,
             keyword* keywords,
             stmt* body,
             expr* decorator_list)
          | Return(expr? value)
          | Delete(expr* targets)
          | Assign(expr* targets, expr value, string? type_comment)
          | AugAssign(expr target, operator op, expr value)
          -- 'simple' indicates that we annotate simple name without parens
          | AnnAssign(expr target, expr annotation, expr? value, int simple)
          -- use 'orelse' because else is a keyword in target languages
          | For(expr target, expr iter, stmt* body, stmt* orelse, string? type_comment)
          | AsyncFor(expr target, expr iter, stmt* body, stmt* orelse, string? type_comment)
          | While(expr test, stmt* body, stmt* orelse)
          | If(expr test, stmt* body, stmt* orelse)
          | With(withitem* items, stmt* body, string? type_comment)
          | AsyncWith(withitem* items, stmt* body, string? type_comment)
          | Match(expr subject, match_case* cases)
          | Raise(expr? exc, expr? cause)
          | Try(stmt* body, excepthandler* handlers, stmt* orelse, stmt* finalbody)
          | Assert(expr test, expr? msg)
          | Import(alias* names)
          | ImportFrom(identifier? module, alias* names, int? level)
          | Global(identifier* names)
          | Nonlocal(identifier* names)
          | Expr(expr value)
          | Pass | Break | Continue
          -- col_offset is the byte offset in the utf8 string the parser uses
          attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
          -- BoolOp() can use left &amp; right?
    expr = BoolOp(boolop op, expr* values)
         | NamedExpr(expr target, expr value)
         | BinOp(expr left, operator op, expr right)
         | UnaryOp(unaryop op, expr operand)
         | Lambda(arguments args, expr body)
         | IfExp(expr test, expr body, expr orelse)
         | Dict(expr* keys, expr* values)
         | Set(expr* elts)
         | ListComp(expr elt, comprehension* generators)
         | SetComp(expr elt, comprehension* generators)
         | DictComp(expr key, expr value, comprehension* generators)
         | GeneratorExp(expr elt, comprehension* generators)
         -- the grammar constrains where yield expressions can occur
         | Await(expr value)
         | Yield(expr? value)
         | YieldFrom(expr value)
         -- need sequences for compare to distinguish between
         -- x &lt; 4 &lt; 3 and (x &lt; 4) &lt; 3
         | Compare(expr left, cmpop* ops, expr* comparators)
         | Call(expr func, expr* args, keyword* keywords)
         | FormattedValue(expr value, int? conversion, expr? format_spec)
         | JoinedStr(expr* values)
         | Constant(constant value, string? kind)
         -- the following expression can appear in assignment context
         | Attribute(expr value, identifier attr, expr_context ctx)
         | Subscript(expr value, expr slice, expr_context ctx)
         | Starred(expr value, expr_context ctx)
         | Name(identifier id, expr_context ctx)
         | List(expr* elts, expr_context ctx)
         | Tuple(expr* elts, expr_context ctx)
         -- can appear only in Subscript
         | Slice(expr? lower, expr? upper, expr? step)
          -- col_offset is the byte offset in the utf8 string the parser uses
          attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
    expr_context = Load | Store | Del
    boolop = And | Or
    operator = Add | Sub | Mult | MatMult | Div | Mod | Pow | LShift
                 | RShift | BitOr | BitXor | BitAnd | FloorDiv
    unaryop = Invert | Not | UAdd | USub
    cmpop = Eq | NotEq | Lt | LtE | Gt | GtE | Is | IsNot | In | NotIn
    comprehension = (expr target, expr iter, expr* ifs, int is_async)
    excepthandler = ExceptHandler(expr? type, identifier? name, stmt* body)
                    attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
    arguments = (arg* posonlyargs, arg* args, arg? vararg, arg* kwonlyargs,
                 expr* kw_defaults, arg? kwarg, expr* defaults)
    arg = (identifier arg, expr? annotation, string? type_comment)
           attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
    -- keyword arguments supplied to call (NULL identifier for **kwargs)
    keyword = (identifier? arg, expr value)
               attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
    -- import name with optional 'as' alias.
    alias = (identifier name, identifier? asname)
             attributes (int lineno, int col_offset, int? end_lineno, int? end_col_offset)
    withitem = (expr context_expr, expr? optional_vars)
    match_case = (pattern pattern, expr? guard, stmt* body)
    pattern = MatchValue(expr value)
            | MatchSingleton(constant value)
            | MatchSequence(pattern* patterns)
            | MatchMapping(expr* keys, pattern* patterns, identifier? rest)
            | MatchClass(expr cls, pattern* patterns, identifier* kwd_attrs, pattern* kwd_patterns)
            | MatchStar(identifier? name)
            -- The optional "rest" MatchMapping parameter handles capturing extra mapping keys
            | MatchAs(pattern? pattern, identifier? name)
            | MatchOr(pattern* patterns)
             attributes (int lineno, int col_offset, int end_lineno, int end_col_offset)
    type_ignore = TypeIgnore(int lineno, string tag)
}</code></pre><h3 id="节点类"><a href="#节点类" class="headerlink" title="节点类"></a>节点类</h3><p><em>class</em> <code>ast.AST</code></p>
<p>这是所有 AST 节点类的基类。实际上，这些节点类派生自 <code>Parser/Python.asdl</code> 文件，其中定义的语法树示例 如下。它们在 C 语言模块 <code>_ast</code> 中定义，并被导出至 <code>ast</code> 模块。</p>
<p>抽象语法定义的每个左侧符号(比方说， <code>ast.stmt</code> 或者 <code>ast.expr</code>)定义了一个类。另外，在抽象语法定义的右侧，对每一个构造器也定义了一个类；这些类继承自树左侧的类。比如，<code>ast.BinOp</code> 继承自 <code>ast.expr</code>。对于多分支产生式(也就是”和规则”)，树右侧的类是抽象的；只有特定构造器结点的实例能被构造。</p>
<ul>
<li><p><code>_fields</code></p>
<p>每个具体类都有个属性 <code>_fields</code>, 用来给出所有子节点的名字。</p>
<p>每个具体类的实例对它每个子节点都有一个属性，对应类型如文法中所定义。比如，<code>ast.BinOp</code> 的实例有个属性 <code>left</code>，类型是 <code>ast.expr</code>.</p>
<p>如果这些属性在文法中标记为可选（使用问号），对应值可能会是 <code>None</code>。如果这些属性有零或多个（用星号标记），对应值会用Python的列表来表示。所有可能的属性必须在用 <code>compile()</code> 编译得到AST时给出，且是有效的值。</p>
</li>
<li><p><code>lineno</code></p>
<p><code>col_offset</code></p>
<p><code>end_lineno</code></p>
<p><code>end_col_offset</code></p>
<p>Instances of <code>ast.expr</code> and <code>ast.stmt</code> subclasses have <code>lineno</code>, <code>col_offset</code>, <code>end_lineno</code>, and <code>end_col_offset</code> attributes. The <code>lineno</code> and <code>end_lineno</code> are the first and last line numbers of source text span (1-indexed so the first line is line 1) and the <code>col_offset</code> and <code>end_col_offset</code> are the corresponding UTF-8 byte offsets of the first and last tokens that generated the node. The UTF-8 offset is recorded because the parser uses UTF-8 internally.</p>
<p>Note that the end positions are not required by the compiler and are therefore optional. The end offset is <em>after</em> the last symbol, for example one can get the source segment of a one-line expression node using <code>source_line[node.col_offset : node.end_col_offset]</code>.</p>
</li>
</ul>
<p>一个类的构造器 <code>ast.T</code> 像下面这样parse它的参数。</p>
<ul>
<li>如果有位置参数，它们必须和 <code>T._fields</code> 中的元素一样多；他们会像这些名字的属性一样被赋值。</li>
<li>如果有关键字参数，它们必须被设为和给定值同名的属性。</li>
</ul>
<p>比方说，要创建和填充节点 <code>ast.UnaryOp</code>，你得用</p>
<pre class="line-numbers language-python"><code class="language-python">node <span class="token operator">=</span> ast<span class="token punctuation">.</span>UnaryOp<span class="token punctuation">(</span><span class="token punctuation">)</span>
node<span class="token punctuation">.</span>op <span class="token operator">=</span> ast<span class="token punctuation">.</span>USub<span class="token punctuation">(</span><span class="token punctuation">)</span>
node<span class="token punctuation">.</span>operand <span class="token operator">=</span> ast<span class="token punctuation">.</span>Constant<span class="token punctuation">(</span><span class="token punctuation">)</span>
node<span class="token punctuation">.</span>operand<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">5</span>
node<span class="token punctuation">.</span>operand<span class="token punctuation">.</span>lineno <span class="token operator">=</span> <span class="token number">0</span>
node<span class="token punctuation">.</span>operand<span class="token punctuation">.</span>col_offset <span class="token operator">=</span> <span class="token number">0</span>
node<span class="token punctuation">.</span>lineno <span class="token operator">=</span> <span class="token number">0</span>
node<span class="token punctuation">.</span>col_offset <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者更紧凑点</p>
<pre class="line-numbers language-python"><code class="language-python">node <span class="token operator">=</span> ast<span class="token punctuation">.</span>UnaryOp<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>USub<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ast<span class="token punctuation">.</span>Constant<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> lineno<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> col_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   lineno<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> col_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在 3.8 版更改: Class <code>ast.Constant</code> is now used for all constants.</p>
<p>在 3.9 版更改: Simple indices are represented by their value, extended slices are represented as tuples.</p>
<p>3.8 版后已移除: Old classes <code>ast.Num</code>, <code>ast.Str</code>, <code>ast.Bytes</code>, <code>ast.NameConstant</code> and <code>ast.Ellipsis</code> are still available, but they will be removed in future Python releases. In the meantime, instantiating them will return an instance of a different class.</p>
<p>3.9 版后已移除: Old classes <code>ast.Index</code> and <code>ast.ExtSlice</code> are still available, but they will be removed in future Python releases. In the meantime, instantiating them will return an instance of a different class.</p>
<p>注解</p>
<p>The descriptions of the specific node classes displayed here were initially adapted from the fantastic Green Tree Snakes project and all its contributors.</p>
<h4 id="字面值"><a href="#字面值" class="headerlink" title="字面值"></a>字面值</h4><p><em>class</em> <code>ast.Constant</code>(<em>value</em>)</p>
<p>A constant value. The <code>value</code> attribute of the <code>Constant</code> literal contains the Python object it represents. The values represented can be simple types such as a number, string or <code>None</code>, but also immutable container types (tuples and frozensets) if all of their elements are constant.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.FormattedValue</code>(<em>value</em>, <em>conversion</em>, <em>format_spec</em>)</p>
<p>Node representing a single formatting field in an f-string. If the string contains a single formatting field and nothing else the node can be isolated otherwise it appears in <code>JoinedStr</code>.</p>
<ul>
<li><code>value</code> is any expression node (such as a literal, a variable, or a function call).</li>
<li><code>conversion</code> is an integer:<ul>
<li>-1: no formatting</li>
<li>115: <code>!s</code> string formatting</li>
<li>114: <code>!r</code> repr formatting</li>
<li>97: <code>!a</code> ascii formatting</li>
</ul>
</li>
<li><code>format_spec</code> is a <code>JoinedStr</code> node representing the formatting of the value, or <code>None</code> if no format was specified. Both <code>conversion</code> and <code>format_spec</code> can be set at the same time.</li>
</ul>
<p><em>class</em> <code>ast.JoinedStr</code>(<em>values</em>)</p>
<p>An f-string, comprising a series of <code>FormattedValue</code> and <code>Constant</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'f"sin({a}) is {sin(a):.3}"'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>JoinedStr<span class="token punctuation">(</span>
        values<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'sin('</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            FormattedValue<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                conversion<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">') is '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            FormattedValue<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Call<span class="token punctuation">(</span>
                    func<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'sin'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    args<span class="token operator">=</span><span class="token punctuation">[</span>
                        Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    keywords<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                conversion<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                format_spec<span class="token operator">=</span>JoinedStr<span class="token punctuation">(</span>
                    values<span class="token operator">=</span><span class="token punctuation">[</span>
                        Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'.3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.List</code>(<em>elts</em>, <em>ctx</em>)</p>
<p><em>class</em> <code>ast.Tuple</code>(<em>elts</em>, <em>ctx</em>)</p>
<p>A list or tuple. <code>elts</code> holds a list of nodes representing the elements. <code>ctx</code> is <code>Store</code> if the container is an assignment target (i.e. <code>(x,y)=something</code>), and <code>Load</code> otherwise.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'[1, 2, 3]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>List<span class="token punctuation">(</span>
        elts<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'(1, 2, 3)'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Tuple<span class="token punctuation">(</span>
        elts<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Set</code>(<em>elts</em>)</p>
<p>A set. <code>elts</code> holds a list of nodes representing the set’s elements.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'{1, 2, 3}'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Set<span class="token punctuation">(</span>
        elts<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Dict</code>(<em>keys</em>, <em>values</em>)</p>
<p>A dictionary. <code>keys</code> and <code>values</code> hold lists of nodes representing the keys and the values respectively, in matching order (what would be returned when calling <code>dictionary.keys()</code> and <code>dictionary.values()</code>).</p>
<p>When doing dictionary unpacking using dictionary literals the expression to be expanded goes in the <code>values</code> list, with a <code>None</code> at the corresponding position in <code>keys</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'{"a":1, **d}'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Dict<span class="token punctuation">(</span>
        keys<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            None<span class="token punctuation">]</span><span class="token punctuation">,</span>
        values<span class="token operator">=</span><span class="token punctuation">[</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h4><p><em>class</em> <code>ast.Name</code>(<em>id</em>, <em>ctx</em>)</p>
<p>A variable name. <code>id</code> holds the name as a string, and <code>ctx</code> is one of the following types.</p>
<p><em>class</em> <code>ast.Load</code></p>
<p><em>class</em> <code>ast.Store</code></p>
<p><em>class</em> <code>ast.Del</code></p>
<p>Variable references can be used to load the value of a variable, to assign a new value to it, or to delete it. Variable references are given a context to distinguish these cases.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Expr<span class="token punctuation">(</span>
            value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a = 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Assign<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'del a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Delete<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Del<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Starred</code>(<em>value</em>, <em>ctx</em>)</p>
<p>A <code>*var</code> variable reference. <code>value</code> holds the variable, typically a <code>Name</code> node. This type must be used when building a <code>Call</code> node with <code>*args</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a, *b = it'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Assign<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Tuple<span class="token punctuation">(</span>
                    elts<span class="token operator">=</span><span class="token punctuation">[</span>
                        Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        Starred<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'it'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><p><em>class</em> <code>ast.Expr</code>(<em>value</em>)</p>
<p>When an expression, such as a function call, appears as a statement by itself with its return value not used or stored, it is wrapped in this container. <code>value</code> holds one of the other nodes in this section, a <code>Constant</code>, a <code>Name</code>, a <code>Lambda</code>, a <code>Yield</code> or <code>YieldFrom</code> node.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'-a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Expr<span class="token punctuation">(</span>
            value<span class="token operator">=</span>UnaryOp<span class="token punctuation">(</span>
                op<span class="token operator">=</span>USub<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                operand<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.UnaryOp</code>(<em>op</em>, <em>operand</em>)</p>
<p>A unary operation. <code>op</code> is the operator, and <code>operand</code> any expression node.</p>
<p><em>class</em> <code>ast.UAdd</code></p>
<p><em>class</em> <code>ast.USub</code></p>
<p><em>class</em> <code>ast.Not</code></p>
<p><em>class</em> <code>ast.Invert</code></p>
<p>Unary operator tokens. <code>Not</code> is the <code>not</code> keyword, <code>Invert</code> is the <code>~</code> operator.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'not x'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>UnaryOp<span class="token punctuation">(</span>
        op<span class="token operator">=</span>Not<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        operand<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.BinOp</code>(<em>left</em>, <em>op</em>, <em>right</em>)</p>
<p>A binary operation (like addition or division). <code>op</code> is the operator, and <code>left</code> and <code>right</code> are any expression nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'x + y'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>BinOp<span class="token punctuation">(</span>
        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        op<span class="token operator">=</span>Add<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        right<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Add</code></p>
<p><em>class</em> <code>ast.Sub</code></p>
<p><em>class</em> <code>ast.Mult</code></p>
<p><em>class</em> <code>ast.Div</code></p>
<p><em>class</em> <code>ast.FloorDiv</code></p>
<p><em>class</em> <code>ast.Mod</code></p>
<p><em>class</em> <code>ast.Pow</code></p>
<p><em>class</em> <code>ast.LShift</code></p>
<p><em>class</em> <code>ast.RShift</code></p>
<p><em>class</em> <code>ast.BitOr</code></p>
<p><em>class</em> <code>ast.BitXor</code></p>
<p><em>class</em> <code>ast.BitAnd</code></p>
<p><em>class</em> <code>ast.MatMult</code></p>
<p>Binary operator tokens.</p>
<p><em>class</em> <code>ast.BoolOp</code>(<em>op</em>, <em>values</em>)</p>
<p>A boolean operation, ‘or’ or ‘and’. <code>op</code> is <code>Or</code> or <code>And</code>. <code>values</code> are the values involved. Consecutive operations with the same operator, such as <code>a or b or c</code>, are collapsed into one node with several values.</p>
<p>This doesn’t include <code>not</code>, which is a <code>UnaryOp</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'x or y'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>BoolOp<span class="token punctuation">(</span>
        op<span class="token operator">=</span>Or<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        values<span class="token operator">=</span><span class="token punctuation">[</span>
            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.And</code></p>
<p><em>class</em> <code>ast.Or</code></p>
<p>Boolean operator tokens.</p>
<p><em>class</em> <code>ast.Compare</code>(<em>left</em>, <em>ops</em>, <em>comparators</em>)</p>
<p>A comparison of two or more values. <code>left</code> is the first value in the comparison, <code>ops</code> the list of operators, and <code>comparators</code> the list of values after the first element in the comparison.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'1 &lt;= a &lt; 10'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Compare<span class="token punctuation">(</span>
        left<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ops<span class="token operator">=</span><span class="token punctuation">[</span>
            LtE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Lt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        comparators<span class="token operator">=</span><span class="token punctuation">[</span>
            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Eq</code></p>
<p><em>class</em> <code>ast.NotEq</code></p>
<p><em>class</em> <code>ast.Lt</code></p>
<p><em>class</em> <code>ast.LtE</code></p>
<p><em>class</em> <code>ast.Gt</code></p>
<p><em>class</em> <code>ast.GtE</code></p>
<p><em>class</em> <code>ast.Is</code></p>
<p><em>class</em> <code>ast.IsNot</code></p>
<p><em>class</em> <code>ast.In</code></p>
<p><em>class</em> <code>ast.NotIn</code></p>
<p>Comparison operator tokens.</p>
<p><em>class</em> <code>ast.Call</code>(<em>func</em>, <em>args</em>, <em>keywords</em>, <em>starargs</em>, <em>kwargs</em>)</p>
<p>A function call. <code>func</code> is the function, which will often be a <code>Name</code> or <code>Attribute</code> object. Of the arguments:</p>
<ul>
<li><code>args</code> holds a list of the arguments passed by position.</li>
<li><code>keywords</code> holds a list of <code>keyword</code> objects representing arguments passed by keyword.</li>
</ul>
<p>When creating a <code>Call</code> node, <code>args</code> and <code>keywords</code> are required, but they can be empty lists. <code>starargs</code> and <code>kwargs</code> are optional.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'func(a, b=c, *d, **e)'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Call<span class="token punctuation">(</span>
        func<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'func'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span>
            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Starred<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        keywords<span class="token operator">=</span><span class="token punctuation">[</span>
            keyword<span class="token punctuation">(</span>
                arg<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            keyword<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.keyword</code>(<em>arg</em>, <em>value</em>)</p>
<p>A keyword argument to a function call or class definition. <code>arg</code> is a raw string of the parameter name, <code>value</code> is a node to pass in.</p>
<p><em>class</em> <code>ast.IfExp</code>(<em>test</em>, <em>body</em>, <em>orelse</em>)</p>
<p>An expression such as <code>a if b else c</code>. Each field holds a single node, so in the following example, all three are <code>Name</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a if b else c'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>IfExp<span class="token punctuation">(</span>
        test<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        orelse<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Attribute</code>(<em>value</em>, <em>attr</em>, <em>ctx</em>)</p>
<p>Attribute access, e.g. <code>d.keys</code>. <code>value</code> is a node, typically a <code>Name</code>. <code>attr</code> is a bare string giving the name of the attribute, and <code>ctx</code> is <code>Load</code>, <code>Store</code> or <code>Del</code> according to how the attribute is acted on.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'snake.colour'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Attribute<span class="token punctuation">(</span>
        value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'snake'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        attr<span class="token operator">=</span><span class="token string">'colour'</span><span class="token punctuation">,</span>
        ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.NamedExpr</code>(<em>target</em>, <em>value</em>)</p>
<blockquote>
<p>A named expression. This AST node is produced by the assignment expressions operator (also known as the walrus operator). As opposed to the <code>Assign</code> node in which the first argument can be multiple nodes, in this case both <code>target</code> and <code>value</code> must be single nodes.</p>
</blockquote>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'(x := 4)'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>NamedExpr<span class="token punctuation">(</span>
        target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="Subscripting"><a href="#Subscripting" class="headerlink" title="Subscripting"></a>Subscripting</h5><p><em>class</em> <code>ast.Subscript</code>(<em>value</em>, <em>slice</em>, <em>ctx</em>)</p>
<p>A subscript, such as <code>l[1]</code>. <code>value</code> is the subscripted object (usually sequence or mapping). <code>slice</code> is an index, slice or key. It can be a <code>Tuple</code> and contain a <code>Slice</code>. <code>ctx</code> is <code>Load</code>, <code>Store</code> or <code>Del</code> according to the action performed with the subscript.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'l[1:2, 3]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Subscript<span class="token punctuation">(</span>
        value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'l'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        slice<span class="token operator">=</span>Tuple<span class="token punctuation">(</span>
            elts<span class="token operator">=</span><span class="token punctuation">[</span>
                Slice<span class="token punctuation">(</span>
                    lower<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    upper<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Slice</code>(<em>lower</em>, <em>upper</em>, <em>step</em>)</p>
<p>Regular slicing (on the form <code>lower:upper</code> or <code>lower:upper:step</code>). Can occur only inside the <em>slice</em> field of <code>Subscript</code>, either directly or as an element of <code>Tuple</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'l[1:2]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>Subscript<span class="token punctuation">(</span>
        value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'l'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        slice<span class="token operator">=</span>Slice<span class="token punctuation">(</span>
            lower<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            upper<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="Comprehensions"><a href="#Comprehensions" class="headerlink" title="Comprehensions"></a>Comprehensions</h5><p><em>class</em> <code>ast.ListComp</code>(<em>elt</em>, <em>generators</em>)</p>
<p><em>class</em> <code>ast.SetComp</code>(<em>elt</em>, <em>generators</em>)</p>
<p><em>class</em> <code>ast.GeneratorExp</code>(<em>elt</em>, <em>generators</em>)</p>
<p><em>class</em> <code>ast.DictComp</code>(<em>key</em>, <em>value</em>, <em>generators</em>)</p>
<p>List and set comprehensions, generator expressions, and dictionary comprehensions. <code>elt</code> (or <code>key</code> and <code>value</code>) is a single node representing the part that will be evaluated for each item.</p>
<p><code>generators</code> is a list of <code>comprehension</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'[x for x in numbers]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>ListComp<span class="token punctuation">(</span>
        elt<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'numbers'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'{x: x**2 for x in numbers}'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>DictComp<span class="token punctuation">(</span>
        key<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        value<span class="token operator">=</span>BinOp<span class="token punctuation">(</span>
            left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            op<span class="token operator">=</span>Pow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            right<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'numbers'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'{x for x in numbers}'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>SetComp<span class="token punctuation">(</span>
        elt<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'numbers'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.comprehension</code>(<em>target</em>, <em>iter</em>, <em>ifs</em>, <em>is_async</em>)</p>
<p>One <code>for</code> clause in a comprehension. <code>target</code> is the reference to use for each element - typically a <code>Name</code> or <code>Tuple</code> node. <code>iter</code> is the object to iterate over. <code>ifs</code> is a list of test expressions: each <code>for</code> clause can have multiple <code>ifs</code>.</p>
<p><code>is_async</code> indicates a comprehension is asynchronous (using an <code>async for</code> instead of <code>for</code>). The value is an integer (0 or 1).</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'[ord(c) for line in file for c in line]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Multiple comprehensions in one.</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>ListComp<span class="token punctuation">(</span>
        elt<span class="token operator">=</span>Call<span class="token punctuation">(</span>
            func<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'ord'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            args<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            keywords<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'line'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'file'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'line'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'(n**2 for n in it if n>5 if n&lt;10)'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># generator comprehension</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>GeneratorExp<span class="token punctuation">(</span>
        elt<span class="token operator">=</span>BinOp<span class="token punctuation">(</span>
            left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            op<span class="token operator">=</span>Pow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            right<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'it'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span>
                    Compare<span class="token punctuation">(</span>
                        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        ops<span class="token operator">=</span><span class="token punctuation">[</span>
                            Gt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        comparators<span class="token operator">=</span><span class="token punctuation">[</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Compare<span class="token punctuation">(</span>
                        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        ops<span class="token operator">=</span><span class="token punctuation">[</span>
                            Lt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        comparators<span class="token operator">=</span><span class="token punctuation">[</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'[i async for i in soc]'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Async comprehension</span>
Expression<span class="token punctuation">(</span>
    body<span class="token operator">=</span>ListComp<span class="token punctuation">(</span>
        elt<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        generators<span class="token operator">=</span><span class="token punctuation">[</span>
            comprehension<span class="token punctuation">(</span>
                target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'soc'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ifs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                is_async<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Statements"><a href="#Statements" class="headerlink" title="Statements"></a>Statements</h4><p><em>class</em> <code>ast.Assign</code>(<em>targets</em>, <em>value</em>, <em>type_comment</em>)</p>
<p>An assignment. <code>targets</code> is a list of nodes, and <code>value</code> is a single node.</p>
<p>Multiple nodes in <code>targets</code> represents assigning the same value to each. Unpacking is represented by putting a <code>Tuple</code> or <code>List</code> within <code>targets</code>.</p>
<ul>
<li><p><code>type_comment</code></p>
<p><code>type_comment</code> is an optional string with the type annotation as a comment.</p>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a = b = 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Multiple assignment</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Assign<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a,b = c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Unpacking</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Assign<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Tuple<span class="token punctuation">(</span>
                    elts<span class="token operator">=</span><span class="token punctuation">[</span>
                        Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.AnnAssign</code>(<em>target</em>, <em>annotation</em>, <em>value</em>, <em>simple</em>)</p>
<p>An assignment with a type annotation. <code>target</code> is a single node and can be a <code>Name</code>, a <code>Attribute</code> or a <code>Subscript</code>. <code>annotation</code> is the annotation, such as a <code>Constant</code> or <code>Name</code> node. <code>value</code> is a single optional node. <code>simple</code> is a boolean integer set to True for a <code>Name</code> node in <code>target</code> that do not appear in between parenthesis and are hence pure names and not expressions.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'c: int'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AnnAssign<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            annotation<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'int'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            simple<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'(a): int = 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Annotation with parenthesis</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AnnAssign<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            annotation<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'int'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            simple<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a.b: int'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Attribute annotation</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AnnAssign<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Attribute<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                attr<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>
                ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            annotation<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'int'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            simple<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'a[1]: int'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Subscript annotation</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AnnAssign<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Subscript<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                slice<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            annotation<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'int'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            simple<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.AugAssign</code>(<em>target</em>, <em>op</em>, <em>value</em>)</p>
<p>Augmented assignment, such as <code>a += 1</code>. In the following example, <code>target</code> is a <code>Name</code> node for <code>x</code> (with the <code>Store</code> context), <code>op</code> is <code>Add</code>, and <code>value</code> is a <code>Constant</code> with value for 1.</p>
<p>The <code>target</code> attribute cannot be of class <code>Tuple</code> or <code>List</code>, unlike the targets of <code>Assign</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'x += 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AugAssign<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            op<span class="token operator">=</span>Add<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Raise</code>(<em>exc</em>, <em>cause</em>)</p>
<p>A <code>raise</code> statement. <code>exc</code> is the exception object to be raised, normally a <code>Call</code> or <code>Name</code>, or <code>None</code> for a standalone <code>raise</code>. <code>cause</code> is the optional part for <code>y</code> in <code>raise x from y</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'raise x from y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Raise<span class="token punctuation">(</span>
            exc<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cause<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Assert</code>(<em>test</em>, <em>msg</em>)</p>
<p>An assertion. <code>test</code> holds the condition, such as a <code>Compare</code> node. <code>msg</code> holds the failure message.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'assert x,y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Assert<span class="token punctuation">(</span>
            test<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            msg<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Delete</code>(<em>targets</em>)</p>
<p>Represents a <code>del</code> statement. <code>targets</code> is a list of nodes, such as <code>Name</code>, <code>Attribute</code> or <code>Subscript</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'del x,y,z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Delete<span class="token punctuation">(</span>
            targets<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Del<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Del<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'z'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Del<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Pass</code></p>
<p>A <code>pass</code> statement.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'pass'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Pass<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Other statements which are only applicable inside functions or loops are described in other sections.</p>
<h5 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h5><p><em>class</em> <code>ast.Import</code>(<em>names</em>)</p>
<p>An import statement. <code>names</code> is a list of <code>alias</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'import x,y,z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Import<span class="token punctuation">(</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.ImportFrom</code>(<em>module</em>, <em>names</em>, <em>level</em>)</p>
<p>Represents <code>from x import y</code>. <code>module</code> is a raw string of the ‘from’ name, without any leading dots, or <code>None</code> for statements such as <code>from . import foo</code>. <code>level</code> is an integer holding the level of the relative import (0 means absolute import).</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'from y import x,y,z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        ImportFrom<span class="token punctuation">(</span>
            module<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.alias</code>(<em>name</em>, <em>asname</em>)</p>
<p>Both parameters are raw strings of the names. <code>asname</code> can be <code>None</code> if the regular name is to be used.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'from ..foo.bar import a as b, c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        ImportFrom<span class="token punctuation">(</span>
            module<span class="token operator">=</span><span class="token string">'foo.bar'</span><span class="token punctuation">,</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> asname<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                alias<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Control-flow"><a href="#Control-flow" class="headerlink" title="Control flow"></a>Control flow</h4><p>注解</p>
<p>Optional clauses such as <code>else</code> are stored as an empty list if they’re not present.</p>
<p><em>class</em> <code>ast.If</code>(<em>test</em>, <em>body</em>, <em>orelse</em>)</p>
<p>An <code>if</code> statement. <code>test</code> holds a single node, such as a <code>Compare</code> node. <code>body</code> and <code>orelse</code> each hold a list of nodes.</p>
<p><code>elif</code> clauses don’t have a special representation in the AST, but rather appear as extra <code>If</code> nodes within the <code>orelse</code> section of the previous one.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... if x:
...    ...
... elif y:
...    ...
... else:
...    ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        If<span class="token punctuation">(</span>
            test<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                If<span class="token punctuation">(</span>
                    test<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.For</code>(<em>target</em>, <em>iter</em>, <em>body</em>, <em>orelse</em>, <em>type_comment</em>)</p>
<p>A <code>for</code> loop. <code>target</code> holds the variable(s) the loop assigns to, as a single <code>Name</code>, <code>Tuple</code> or <code>List</code> node. <code>iter</code> holds the item to be looped over, again as a single node. <code>body</code> and <code>orelse</code> contain lists of nodes to execute. Those in <code>orelse</code> are executed if the loop finishes normally, rather than via a <code>break</code> statement.</p>
<ul>
<li><p><code>type_comment</code></p>
<p><code>type_comment</code> is an optional string with the type annotation as a comment.</p>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... for x in y:
...     ...
... else:
...     ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        For<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.While</code>(<em>test</em>, <em>body</em>, <em>orelse</em>)</p>
<p>A <code>while</code> loop. <code>test</code> holds the condition, such as a <code>Compare</code> node.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... while x:
...    ...
... else:
...    ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        While<span class="token punctuation">(</span>
            test<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Break</code></p>
<p><em>class</em> <code>ast.Continue</code></p>
<p>The <code>break</code> and <code>continue</code> statements.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... for a in b:
...     if a > 5:
...         break
...     else:
...         continue
...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        For<span class="token punctuation">(</span>
            target<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            iter<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                If<span class="token punctuation">(</span>
                    test<span class="token operator">=</span>Compare<span class="token punctuation">(</span>
                        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        ops<span class="token operator">=</span><span class="token punctuation">[</span>
                            Gt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        comparators<span class="token operator">=</span><span class="token punctuation">[</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Break<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                        Continue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Try</code>(<em>body</em>, <em>handlers</em>, <em>orelse</em>, <em>finalbody</em>)</p>
<p><code>try</code> blocks. All attributes are list of nodes to execute, except for <code>handlers</code>, which is a list of <code>ExceptHandler</code> nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... try:
...    ...
... except Exception:
...    ...
... except OtherException as e:
...    ...
... else:
...    ...
... finally:
...    ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Try<span class="token punctuation">(</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            handlers<span class="token operator">=</span><span class="token punctuation">[</span>
                ExceptHandler<span class="token punctuation">(</span>
                    type<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'Exception'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ExceptHandler<span class="token punctuation">(</span>
                    type<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'OtherException'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    name<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            finalbody<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.ExceptHandler</code>(<em>type</em>, <em>name</em>, <em>body</em>)</p>
<p>A single <code>except</code> clause. <code>type</code> is the exception type it will match, typically a <code>Name</code> node (or <code>None</code> for a catch-all <code>except:</code> clause). <code>name</code> is a raw string for the name to hold the exception, or <code>None</code> if the clause doesn’t have <code>as foo</code>. <code>body</code> is a list of nodes.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... try:
...     a + 1
... except TypeError:
...     pass
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Try<span class="token punctuation">(</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>BinOp<span class="token punctuation">(</span>
                        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        op<span class="token operator">=</span>Add<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        right<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            handlers<span class="token operator">=</span><span class="token punctuation">[</span>
                ExceptHandler<span class="token punctuation">(</span>
                    type<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'TypeError'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Pass<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            orelse<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            finalbody<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.With</code>(<em>items</em>, <em>body</em>, <em>type_comment</em>)</p>
<p>A <code>with</code> block. <code>items</code> is a list of <code>withitem</code> nodes representing the context managers, and <code>body</code> is the indented block inside the context.</p>
<ul>
<li><p><code>type_comment</code></p>
<p><code>type_comment</code> is an optional string with the type annotation as a comment.</p>
</li>
</ul>
<p><em>class</em> <code>ast.withitem</code>(<em>context_expr</em>, <em>optional_vars</em>)</p>
<p>A single context manager in a <code>with</code> block. <code>context_expr</code> is the context manager, often a <code>Call</code> node. <code>optional_vars</code> is a <code>Name</code>, <code>Tuple</code> or <code>List</code> for the <code>as foo</code> part, or <code>None</code> if that isn’t used.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... with a as b, c as d:
...    something(b, d)
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        With<span class="token punctuation">(</span>
            items<span class="token operator">=</span><span class="token punctuation">[</span>
                withitem<span class="token punctuation">(</span>
                    context_expr<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    optional_vars<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                withitem<span class="token punctuation">(</span>
                    context_expr<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    optional_vars<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Store<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Call<span class="token punctuation">(</span>
                        func<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'something'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        args<span class="token operator">=</span><span class="token punctuation">[</span>
                            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        keywords<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Pattern-matching"><a href="#Pattern-matching" class="headerlink" title="Pattern matching"></a>Pattern matching</h4><p><em>class</em> <code>ast.Match</code>(<em>subject</em>, <em>cases</em>)</p>
<p>A <code>match</code> statement. <code>subject</code> holds the subject of the match (the object that is being matched against the cases) and <code>cases</code> contains an iterable of <code>match_case</code> nodes with the different cases.</p>
<p><em>class</em> <code>ast.match_case</code>(<em>pattern</em>, <em>guard</em>, <em>body</em>)</p>
<p>A single case pattern in a <code>match</code> statement. <code>pattern</code> contains the match pattern that the subject will be matched against. Note that the <code>AST</code> nodes produced for patterns differ from those produced for expressions, even when they share the same syntax.</p>
<p>The <code>guard</code> attribute contains an expression that will be evaluated if the pattern matches the subject.</p>
<p><code>body</code> contains a list of nodes to execute if the pattern matches and the result of evaluating the guard expression is true.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case [x] if x>0:
...         ...
...     case tuple():
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchSequence<span class="token punctuation">(</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchAs<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    guard<span class="token operator">=</span>Compare<span class="token punctuation">(</span>
                        left<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        ops<span class="token operator">=</span><span class="token punctuation">[</span>
                            Gt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        comparators<span class="token operator">=</span><span class="token punctuation">[</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchClass<span class="token punctuation">(</span>
                        cls<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'tuple'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_attrs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_patterns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchValue</code>(<em>value</em>)</p>
<p>A match literal or value pattern that compares by equality. <code>value</code> is an expression node. Permitted value nodes are restricted as described in the match statement documentation. This pattern succeeds if the match subject is equal to the evaluated value.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case "Relevant":
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchValue<span class="token punctuation">(</span>
                        value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'Relevant'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchSingleton</code>(<em>value</em>)</p>
<p>A match literal pattern that compares by identity. <code>value</code> is the singleton to be compared against: <code>None</code>, <code>True</code>, or <code>False</code>. This pattern succeeds if the match subject is the given constant.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case None:
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchSingleton<span class="token punctuation">(</span>value<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchSequence</code>(<em>patterns</em>)</p>
<p>A match sequence pattern. <code>patterns</code> contains the patterns to be matched against the subject elements if the subject is a sequence. Matches a variable length sequence if one of the subpatterns is a <code>MatchStar</code> node, otherwise matches a fixed length sequence.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case [1, 2]:
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchSequence<span class="token punctuation">(</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchStar</code>(<em>name</em>)</p>
<p>Matches the rest of the sequence in a variable length match sequence pattern. If <code>name</code> is not <code>None</code>, a list containing the remaining sequence elements is bound to that name if the overall sequence pattern is successful.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case [1, 2, *rest]:
...         ...
...     case [*_]:
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchSequence<span class="token punctuation">(</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchStar<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'rest'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchSequence<span class="token punctuation">(</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchStar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchMapping</code>(<em>keys</em>, <em>patterns</em>, <em>rest</em>)</p>
<p>A match mapping pattern. <code>keys</code> is a sequence of expression nodes. <code>patterns</code> is a corresponding sequence of pattern nodes. <code>rest</code> is an optional name that can be specified to capture the remaining mapping elements. Permitted key expressions are restricted as described in the match statement documentation.</p>
<p>This pattern succeeds if the subject is a mapping, all evaluated key expressions are present in the mapping, and the value corresponding to each key matches the corresponding subpattern. If <code>rest</code> is not <code>None</code>, a dict containing the remaining mapping elements is bound to that name if the overall mapping pattern is successful.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case {1: _, 2: _}:
...         ...
...     case {**rest}:
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchMapping<span class="token punctuation">(</span>
                        keys<span class="token operator">=</span><span class="token punctuation">[</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchAs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchAs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchMapping<span class="token punctuation">(</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> patterns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rest<span class="token operator">=</span><span class="token string">'rest'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchClass</code>(<em>cls</em>, <em>patterns</em>, <em>kwd_attrs</em>, <em>kwd_patterns</em>)</p>
<p>A match class pattern. <code>cls</code> is an expression giving the nominal class to be matched. <code>patterns</code> is a sequence of pattern nodes to be matched against the class defined sequence of pattern matching attributes. <code>kwd_attrs</code> is a sequence of additional attributes to be matched (specified as keyword arguments in the class pattern), <code>kwd_patterns</code> are the corresponding patterns (specified as keyword values in the class pattern).</p>
<p>This pattern succeeds if the subject is an instance of the nominated class, all positional patterns match the corresponding class-defined attributes, and any specified keyword attributes match their corresponding pattern.</p>
<p>Note: classes may define a property that returns self in order to match a pattern node against the instance being matched. Several builtin types are also matched that way, as described in the match statement documentation.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case Point2D(0, 0):
...         ...
...     case Point3D(x=0, y=0, z=0):
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchClass<span class="token punctuation">(</span>
                        cls<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'Point2D'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_attrs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_patterns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchClass<span class="token punctuation">(</span>
                        cls<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'Point3D'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_attrs<span class="token operator">=</span><span class="token punctuation">[</span>
                            <span class="token string">'x'</span><span class="token punctuation">,</span>
                            <span class="token string">'y'</span><span class="token punctuation">,</span>
                            <span class="token string">'z'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        kwd_patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchValue<span class="token punctuation">(</span>
                                value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchAs</code>(<em>pattern</em>, <em>name</em>)</p>
<p>A match “as-pattern”, capture pattern or wildcard pattern. <code>pattern</code> contains the match pattern that the subject will be matched against. If the pattern is <code>None</code>, the node represents a capture pattern (i.e a bare name) and will always succeed.</p>
<p>The <code>name</code> attribute contains the name that will be bound if the pattern is successful. If <code>name</code> is <code>None</code>, <code>pattern</code> must also be <code>None</code> and the node represents the wildcard pattern.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case [x] as y:
...         ...
...     case _:
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchAs<span class="token punctuation">(</span>
                        pattern<span class="token operator">=</span>MatchSequence<span class="token punctuation">(</span>
                            patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                                MatchAs<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchAs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.MatchOr</code>(<em>patterns</em>)</p>
<p>A match “or-pattern”. An or-pattern matches each of its subpatterns in turn to the subject, until one succeeds. The or-pattern is then deemed to succeed. If none of the subpatterns succeed the or-pattern fails. The <code>patterns</code> attribute contains a list of match pattern nodes that will be matched against the subject.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
... match x:
...     case [x] | (y):
...         ...
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Match<span class="token punctuation">(</span>
            subject<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cases<span class="token operator">=</span><span class="token punctuation">[</span>
                match_case<span class="token punctuation">(</span>
                    pattern<span class="token operator">=</span>MatchOr<span class="token punctuation">(</span>
                        patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                            MatchSequence<span class="token punctuation">(</span>
                                patterns<span class="token operator">=</span><span class="token punctuation">[</span>
                                    MatchAs<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            MatchAs<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token operator">=</span><span class="token punctuation">[</span>
                        Expr<span class="token punctuation">(</span>
                            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Function-and-class-definitions"><a href="#Function-and-class-definitions" class="headerlink" title="Function and class definitions"></a>Function and class definitions</h4><p><em>class</em> <code>ast.FunctionDef</code>(<em>name</em>, <em>args</em>, <em>body</em>, <em>decorator_list</em>, <em>returns</em>, <em>type_comment</em>)</p>
<p>A function definition.</p>
<ul>
<li><p><code>name</code> is a raw string of the function name.</p>
</li>
<li><p><code>args</code> is an <code>arguments</code> node.</p>
</li>
<li><p><code>body</code> is the list of nodes inside the function.</p>
</li>
<li><p><code>decorator_list</code> is the list of decorators to be applied, stored outermost first (i.e. the first in the list will be applied last).</p>
</li>
<li><p><code>returns</code> is the return annotation.</p>
</li>
<li><p><code>type_comment</code></p>
<p><code>type_comment</code> is an optional string with the type annotation as a comment.</p>
</li>
</ul>
<p><em>class</em> <code>ast.Lambda</code>(<em>args</em>, <em>body</em>)</p>
<p><code>lambda</code> is a minimal function definition that can be used inside an expression. Unlike <code>FunctionDef</code>, <code>body</code> holds a single node.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'lambda x,y: ...'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Expr<span class="token punctuation">(</span>
            value<span class="token operator">=</span>Lambda<span class="token punctuation">(</span>
                args<span class="token operator">=</span>arguments<span class="token punctuation">(</span>
                    posonlyargs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    args<span class="token operator">=</span><span class="token punctuation">[</span>
                        arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    kwonlyargs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    kw_defaults<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    defaults<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                body<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>Ellipsis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.arguments</code>(<em>posonlyargs</em>, <em>args</em>, <em>vararg</em>, <em>kwonlyargs</em>, <em>kw_defaults</em>, <em>kwarg</em>, <em>defaults</em>)</p>
<p>The arguments for a function.</p>
<ul>
<li><code>posonlyargs</code>, <code>args</code> and <code>kwonlyargs</code> are lists of <code>arg</code> nodes.</li>
<li><code>vararg</code> and <code>kwarg</code> are single <code>arg</code> nodes, referring to the <code>*args, **kwargs</code> parameters.</li>
<li><code>kw_defaults</code> is a list of default values for keyword-only arguments. If one is <code>None</code>, the corresponding argument is required.</li>
<li><code>defaults</code> is a list of default values for arguments that can be passed positionally. If there are fewer defaults, they correspond to the last n arguments.</li>
</ul>
<p><em>class</em> <code>ast.arg</code>(<em>arg</em>, <em>annotation</em>, <em>type_comment</em>)</p>
<p>A single argument in a list. <code>arg</code> is a raw string of the argument name, <code>annotation</code> is its annotation, such as a <code>Str</code> or <code>Name</code> node.</p>
<ul>
<li><p><code>type_comment</code></p>
<p><code>type_comment</code> is an optional string with the type annotation as a comment</p>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... @decorator1
... @decorator2
... def f(a: 'annotation', b=1, c=2, *d, e, f=3, **g) -> 'return annotation':
...     pass
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        FunctionDef<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">'f'</span><span class="token punctuation">,</span>
            args<span class="token operator">=</span>arguments<span class="token punctuation">(</span>
                posonlyargs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                args<span class="token operator">=</span><span class="token punctuation">[</span>
                    arg<span class="token punctuation">(</span>
                        arg<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span>
                        annotation<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'annotation'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                vararg<span class="token operator">=</span>arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                kwonlyargs<span class="token operator">=</span><span class="token punctuation">[</span>
                    arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                kw_defaults<span class="token operator">=</span><span class="token punctuation">[</span>
                    None<span class="token punctuation">,</span>
                    Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                kwarg<span class="token operator">=</span>arg<span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                defaults<span class="token operator">=</span><span class="token punctuation">[</span>
                    Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Pass<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            decorator_list<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'decorator1'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'decorator2'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            returns<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">'return annotation'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Return</code>(<em>value</em>)</p>
<p>A <code>return</code> statement.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'return 4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Return<span class="token punctuation">(</span>
            value<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Yield</code>(<em>value</em>)</p>
<p><em>class</em> <code>ast.YieldFrom</code>(<em>value</em>)</p>
<p>A <code>yield</code> or <code>yield from</code> expression. Because these are expressions, they must be wrapped in a <code>Expr</code> node if the value sent back is not used.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'yield x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Expr<span class="token punctuation">(</span>
            value<span class="token operator">=</span>Yield<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'yield from x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Expr<span class="token punctuation">(</span>
            value<span class="token operator">=</span>YieldFrom<span class="token punctuation">(</span>
                value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.Global</code>(<em>names</em>)</p>
<p><em>class</em> <code>ast.Nonlocal</code>(<em>names</em>)</p>
<p><code>global</code> and <code>nonlocal</code> statements. <code>names</code> is a list of raw strings.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'global x,y,z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Global<span class="token punctuation">(</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span>
                <span class="token string">'x'</span><span class="token punctuation">,</span>
                <span class="token string">'y'</span><span class="token punctuation">,</span>
                <span class="token string">'z'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'nonlocal x,y,z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        Nonlocal<span class="token punctuation">(</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span>
                <span class="token string">'x'</span><span class="token punctuation">,</span>
                <span class="token string">'y'</span><span class="token punctuation">,</span>
                <span class="token string">'z'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.ClassDef</code>(<em>name</em>, <em>bases</em>, <em>keywords</em>, <em>starargs</em>, <em>kwargs</em>, <em>body</em>, <em>decorator_list</em>)</p>
<p>A class definition.</p>
<ul>
<li><code>name</code> is a raw string for the class name</li>
<li><code>bases</code> is a list of nodes for explicitly specified base classes.</li>
<li><code>keywords</code> is a list of <code>keyword</code> nodes, principally for ‘metaclass’. Other keywords will be passed to the metaclass, as per <a href="https://www.python.org/dev/peps/pep-3115/" target="_blank" rel="noopener">PEP-3115</a>.</li>
<li><code>starargs</code> and <code>kwargs</code> are each a single node, as in a function call. starargs will be expanded to join the list of base classes, and kwargs will be passed to the metaclass.</li>
<li><code>body</code> is a list of nodes representing the code within the class definition.</li>
<li><code>decorator_list</code> is a list of nodes, as in <code>FunctionDef</code>.</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... @decorator1
... @decorator2
... class Foo(base1, base2, metaclass=meta):
...     pass
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        ClassDef<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">'Foo'</span><span class="token punctuation">,</span>
            bases<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'base1'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'base2'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            keywords<span class="token operator">=</span><span class="token punctuation">[</span>
                keyword<span class="token punctuation">(</span>
                    arg<span class="token operator">=</span><span class="token string">'metaclass'</span><span class="token punctuation">,</span>
                    value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'meta'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Pass<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            decorator_list<span class="token operator">=</span><span class="token punctuation">[</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'decorator1'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'decorator2'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Async-and-await"><a href="#Async-and-await" class="headerlink" title="Async and await"></a>Async and await</h4><p><em>class</em> <code>ast.AsyncFunctionDef</code>(<em>name</em>, <em>args</em>, <em>body</em>, <em>decorator_list</em>, <em>returns</em>, <em>type_comment</em>)</p>
<p>An <code>async def</code> function definition. Has the same fields as <code>FunctionDef</code>.</p>
<p><em>class</em> <code>ast.Await</code>(<em>value</em>)</p>
<p>An <code>await</code> expression. <code>value</code> is what it waits for. Only valid in the body of an <code>AsyncFunctionDef</code>.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
... async def f():
...     await other_func()
... """</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Module<span class="token punctuation">(</span>
    body<span class="token operator">=</span><span class="token punctuation">[</span>
        AsyncFunctionDef<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">'f'</span><span class="token punctuation">,</span>
            args<span class="token operator">=</span>arguments<span class="token punctuation">(</span>
                posonlyargs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                kwonlyargs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                kw_defaults<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                defaults<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token operator">=</span><span class="token punctuation">[</span>
                Expr<span class="token punctuation">(</span>
                    value<span class="token operator">=</span>Await<span class="token punctuation">(</span>
                        value<span class="token operator">=</span>Call<span class="token punctuation">(</span>
                            func<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'other_func'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            keywords<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            decorator_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    type_ignores<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><em>class</em> <code>ast.AsyncFor</code>(<em>target</em>, <em>iter</em>, <em>body</em>, <em>orelse</em>, <em>type_comment</em>)</p>
<p><em>class</em> <code>ast.AsyncWith</code>(<em>items</em>, <em>body</em>, <em>type_comment</em>)</p>
<p><code>async for</code> loops and <code>async with</code> context managers. They have the same fields as <code>For</code> and <code>With</code>, respectively. Only valid in the body of an <code>AsyncFunctionDef</code>.</p>
<p>注解</p>
<p>When a string is parsed by <code>ast.parse()</code>, operator nodes (subclasses of <code>ast.operator</code>, <code>ast.unaryop</code>, <code>ast.cmpop</code>, <code>ast.boolop</code> and <code>ast.expr_context</code>) on the returned tree will be singletons. Changes to one will be reflected in all other occurrences of the same value (e.g. <code>ast.Add</code>).</p>
<h3 id="ast-中的辅助函数"><a href="#ast-中的辅助函数" class="headerlink" title="ast 中的辅助函数"></a><code>ast</code> 中的辅助函数</h3><p>除了节点类， <code>ast</code> 模块里为遍历抽象语法树定义了这些工具函数和类:</p>
<p><code>ast.parse</code>(<em>source</em>, <em>filename=’&lt;unknown&gt;’</em>, <em>mode=’exec’</em>, <em>**,</em> type_comments=False<em>,</em> feature_version=None*)</p>
<p>把源码解析为AST节点。和 <code>compile(source, filename, mode,ast.PyCF_ONLY_AST)</code> 等价。</p>
<p>If <code>type_comments=True</code> is given, the parser is modified to check and return type comments as specified by <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> and <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a>. This is equivalent to adding <code>ast.PyCF_TYPE_COMMENTS</code> to the flags passed to <code>compile()</code>. This will report syntax errors for misplaced type comments. Without this flag, type comments will be ignored, and the <code>type_comment</code> field on selected AST nodes will always be <code>None</code>. In addition, the locations of <code># type: ignore</code> comments will be returned as the <code>type_ignores</code> attribute of <code>Module</code> (otherwise it is always an empty list).</p>
<p>In addition, if <code>mode</code> is <code>'func_type'</code>, the input syntax is modified to correspond to <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> “signature type comments”, e.g. <code>(str, int) -&gt; List[str]</code>.</p>
<p>Also, setting <code>feature_version</code> to a tuple <code>(major, minor)</code> will attempt to parse using that Python version’s grammar. Currently <code>major</code> must equal to <code>3</code>. For example, setting <code>feature_version=(3, 4)</code> will allow the use of <code>async</code> and <code>await</code> as variable names. The lowest supported version is <code>(3, 4)</code>; the highest is <code>sys.version_info[0:2]</code>.</p>
<p>If source contains a null character (‘0’), <code>ValueError</code> is raised.</p>
<blockquote>
<p>警告</p>
<p>Note that succesfully parsing souce code into an AST object doesn’t guarantee that the source code provided is valid Python code that can be executed as the compilation step can raise further <code>SyntaxError</code> exceptions. For instance, the source <code>return 42</code> generates a valid AST node for a return statement, but it cannot be compiled alone (it needs to be inside a function node).</p>
<p>In particular, <code>ast.parse()</code> won’t do any scoping checks, which the compilation step does.</p>
</blockquote>
<p>警告</p>
<p>足够复杂或是巨大的字符串可能导致Python解释器的崩溃，因为Python的AST编译器是有栈深限制的。</p>
<p>在 3.8 版更改: Added <code>type_comments</code>, <code>mode='func_type'</code> and <code>feature_version</code>.</p>
<p><code>ast.unparse</code>(<em>ast_obj</em>)</p>
<p>Unparse an <code>ast.AST</code> object and generate a string with code that would produce an equivalent <code>ast.AST</code> object if parsed back with <code>ast.parse()</code>.</p>
<p>警告</p>
<p>The produced code string will not necessarily be equal to the original code that generated the <code>ast.AST</code> object (without any compiler optimizations, such as constant tuples/frozensets).</p>
<p>警告</p>
<p>Trying to unparse a highly complex expression would result with <code>RecursionError</code>.</p>
<p>3.9 新版功能.</p>
<p><code>ast.literal_eval</code>(<em>node_or_string</em>)</p>
<p>Safely evaluate an expression node or a string containing a Python literal or container display. The string or node provided may only consist of the following Python literal structures: strings, bytes, numbers, tuples, lists, dicts, sets, booleans, <code>None</code> and <code>Ellipsis</code>.</p>
<p>This can be used for safely evaluating strings containing Python values from untrusted sources without the need to parse the values oneself. It is not capable of evaluating arbitrarily complex expressions, for example involving operators or indexing.</p>
<p>警告</p>
<p>足够复杂或是巨大的字符串可能导致Python解释器的崩溃，因为Python的AST编译器是有栈深限制的。</p>
<p>It can raise <code>ValueError</code>, <code>TypeError</code>, <code>SyntaxError</code>, <code>MemoryError</code> and <code>RecursionError</code> depending on the malformed input.</p>
<p>在 3.2 版更改: 目前支持字节和集合。</p>
<p>在 3.9 版更改: Now supports creating empty sets with <code>'set()'</code>.</p>
<p>在 3.10 版更改: For string inputs, leading spaces and tabs are now stripped.</p>
<p><code>ast.get_docstring</code>(<em>node</em>, <em>clean=True</em>)</p>
<p>Return the docstring of the given <em>node</em> (which must be a <code>FunctionDef</code>, <code>AsyncFunctionDef</code>, <code>ClassDef</code>, or <code>Module</code> node), or <code>None</code> if it has no docstring. If <em>clean</em> is true, clean up the docstring’s indentation with <code>inspect.cleandoc()</code>.</p>
<p>在 3.5 版更改: 目前支持 <code>AsyncFunctionDef</code></p>
<p><code>ast.get_source_segment</code>(<em>source</em>, <em>node</em>, <em>**,</em> padded=False*)</p>
<p>Get source code segment of the <em>source</em> that generated <em>node</em>. If some location information (<code>lineno</code>, <code>end_lineno</code>, <code>col_offset</code>, or <code>end_col_offset</code>) is missing, return <code>None</code>.</p>
<p>If <em>padded</em> is <code>True</code>, the first line of a multi-line statement will be padded with spaces to match its original position.</p>
<p>3.8 新版功能.</p>
<p><code>ast.fix_missing_locations</code>(<em>node</em>)</p>
<p>When you compile a node tree with <code>compile()</code>, the compiler expects <code>lineno</code> and <code>col_offset</code> attributes for every node that supports them. This is rather tedious to fill in for generated nodes, so this helper adds these attributes recursively where not already set, by setting them to the values of the parent node. It works recursively starting at <em>node</em>.</p>
<p><code>ast.increment_lineno</code>(<em>node</em>, <em>n=1</em>)</p>
<p>Increment the line number and end line number of each node in the tree starting at <em>node</em> by <em>n</em>. This is useful to “move code” to a different location in a file.</p>
<p><code>ast.copy_location</code>(<em>new_node</em>, <em>old_node</em>)</p>
<p>Copy source location (<code>lineno</code>, <code>col_offset</code>, <code>end_lineno</code>, and <code>end_col_offset</code>) from <em>old_node</em> to <em>new_node</em> if possible, and return <em>new_node</em>.</p>
<p><code>ast.iter_fields</code>(<em>node</em>)</p>
<p>Yield a tuple of <code>(fieldname, value)</code> for each field in <code>node._fields</code> that is present on <em>node</em>.</p>
<p><code>ast.iter_child_nodes</code>(<em>node</em>)</p>
<p>Yield all direct child nodes of <em>node</em>, that is, all fields that are nodes and all items of fields that are lists of nodes.</p>
<p><code>ast.walk</code>(<em>node</em>)</p>
<p>Recursively yield all descendant nodes in the tree starting at <em>node</em> (including <em>node</em> itself), in no specified order. This is useful if you only want to modify nodes in place and don’t care about the context.</p>
<p><em>class</em> <code>ast.NodeVisitor</code></p>
<p>A node visitor base class that walks the abstract syntax tree and calls a visitor function for every node found. This function may return a value which is forwarded by the <code>visit()</code> method.</p>
<p>This class is meant to be subclassed, with the subclass adding visitor methods.</p>
<ul>
<li><p><code>visit</code>(<em>node</em>)</p>
<p>Visit a node. The default implementation calls the method called <code>self.visit_*classname*</code> where <em>classname</em> is the name of the node class, or <code>generic_visit()</code> if that method doesn’t exist.</p>
</li>
<li><p><code>generic_visit</code>(<em>node</em>)</p>
<p>This visitor calls <code>visit()</code> on all children of the node.</p>
<p>Note that child nodes of nodes that have a custom visitor method won’t be visited unless the visitor calls <code>generic_visit()</code> or visits them itself.</p>
</li>
</ul>
<p>Don’t use the <code>NodeVisitor</code> if you want to apply changes to nodes during traversal. For this a special visitor exists (<code>NodeTransformer</code>) that allows modifications.</p>
<p>3.8 版后已移除: Methods <code>visit_Num()</code>, <code>visit_Str()</code>, <code>visit_Bytes()</code>, <code>visit_NameConstant()</code> and <code>visit_Ellipsis()</code> are deprecated now and will not be called in future Python versions. Add the <code>visit_Constant()</code> method to handle all constant nodes.</p>
<p><em>class</em> <code>ast.NodeTransformer</code></p>
<p>子类 <code>NodeVisitor</code> 用于遍历抽象语法树，并允许修改节点。</p>
<p><code>NodeTransformer</code> 将遍历抽象语法树并使用visitor方法的返回值去替换或移除旧节点。如果visitor方法的返回值为 <code>None</code> , 则该节点将从其位置移除，否则将替换为返回值。当返回值是原始节点时，无需替换。</p>
<p>如下是一个转换器示例，它将所有出现的名称 (<code>foo</code>) 重写为 <code>data['foo']</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">RewriteName</span><span class="token punctuation">(</span>NodeTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">visit_Name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Subscript<span class="token punctuation">(</span>
            value<span class="token operator">=</span>Name<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'data'</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>Load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            slice<span class="token operator">=</span>Constant<span class="token punctuation">(</span>value<span class="token operator">=</span>node<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            ctx<span class="token operator">=</span>node<span class="token punctuation">.</span>ctx
        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>请记住，如果您正在操作的节点具有子节点，则必须先转换其子节点或为该节点调用 <code>generic_visit()</code> 方法。</p>
<p>对于属于语句集合（适用于所有语句节点）的节点，访问者还可以返回节点列表而不仅仅是单个节点。</p>
<p>If <code>NodeTransformer</code> introduces new nodes (that weren’t part of original tree) without giving them location information (such as <code>lineno</code>), <code>fix_missing_locations()</code> should be called with the new sub-tree to recalculate the location information:</p>
<pre class="line-numbers language-python"><code class="language-python">tree <span class="token operator">=</span> ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span>
new_tree <span class="token operator">=</span> fix_missing_locations<span class="token punctuation">(</span>RewriteName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>visit<span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通常你可以像这样使用转换器:</p>
<pre class="line-numbers language-python"><code class="language-python">node <span class="token operator">=</span> YourTransformer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>visit<span class="token punctuation">(</span>node<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>ast.dump</code>(<em>node</em>, <em>annotate_fields=True</em>, <em>include_attributes=False</em>, <em>**,</em> indent=None*)</p>
<p>Return a formatted dump of the tree in <em>node</em>. This is mainly useful for debugging purposes. If <em>annotate_fields</em> is true (by default), the returned string will show the names and the values for fields. If <em>annotate_fields</em> is false, the result string will be more compact by omitting unambiguous field names. Attributes such as line numbers and column offsets are not dumped by default. If this is wanted, <em>include_attributes</em> can be set to true.</p>
<p>If <em>indent</em> is a non-negative integer or string, then the tree will be pretty-printed with that indent level. An indent level of 0, negative, or <code>""</code> will only insert newlines. <code>None</code> (the default) selects the single line representation. Using a positive integer indent indents that many spaces per level. If <em>indent</em> is a string (such as <code>"\t"</code>), that string is used to indent each level.</p>
<p>在 3.9 版更改: Added the <em>indent</em> option.</p>
<h3 id="Compiler-Flags"><a href="#Compiler-Flags" class="headerlink" title="Compiler Flags"></a>Compiler Flags</h3><p>The following flags may be passed to <code>compile()</code> in order to change effects on the compilation of a program:</p>
<pre><code>ast.PyCF_ALLOW_TOP_LEVEL_AWAIT</code></pre><p>Enables support for top-level <code>await</code>, <code>async for</code>, <code>async with</code> and async comprehensions.</p>
<p>3.8 新版功能.</p>
<pre><code>ast.PyCF_ONLY_AST</code></pre><p>Generates and returns an abstract syntax tree instead of returning a compiled code object.</p>
<pre><code>ast.PyCF_TYPE_COMMENTS</code></pre><p>Enables support for <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener"><strong>PEP 484</strong></a> and <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener"><strong>PEP 526</strong></a> style type comments (<code># type: &lt;type&gt;</code>, <code># type: ignore &lt;stuff&gt;</code>).</p>
<p>3.8 新版功能.</p>
<h3 id="Command-Line-Usage"><a href="#Command-Line-Usage" class="headerlink" title="Command-Line Usage"></a>Command-Line Usage</h3><p>3.9 新版功能.</p>
<p>The <code>ast</code> module can be executed as a script from the command line. It is as simple as:</p>
<pre><code>python -m ast [-m &lt;mode&gt;] [-a] [infile]</code></pre><p>The following options are accepted:</p>
<pre><code>-h``,` `--help</code></pre><p>Show the help message and exit.</p>
<pre><code>-m` `&lt;mode&gt;
--mode` `&lt;mode&gt;</code></pre><p>Specify what kind of code must be compiled, like the <em>mode</em> argument in <code>parse()</code>.</p>
<pre><code>--no-type-comments</code></pre><p>Don’t parse type comments.</p>
<pre><code>-a``,` `--include-attributes</code></pre><p>Include attributes such as line numbers and column offsets.</p>
<pre><code>-i` `&lt;indent&gt;
--indent` `&lt;indent&gt;</code></pre><p>Indentation of nodes in AST (number of spaces).</p>
<p>If <code>infile</code> is specified its contents are parsed to AST and dumped to stdout. Otherwise, the content is read from stdin.</p>
<p>参见</p>
<p><a href="https://greentreesnakes.readthedocs.io/" target="_blank" rel="noopener">Green Tree Snakes</a>, an external documentation resource, has good details on working with Python ASTs.</p>
<p><a href="https://asttokens.readthedocs.io/en/latest/user-guide.html" target="_blank" rel="noopener">ASTTokens</a> annotates Python ASTs with the positions of tokens and text in the source code that generated them. This is helpful for tools that make source code transformations.</p>
<p><a href="http://leoeditor.com/appendices.html#leoast-py" target="_blank" rel="noopener">leoAst.py</a> unifies the token-based and parse-tree-based views of python programs by inserting two-way links between tokens and ast nodes.</p>
<p><a href="https://libcst.readthedocs.io/" target="_blank" rel="noopener">LibCST</a> parses code as a Concrete Syntax Tree that looks like an ast tree and keeps all formatting details. It’s useful for building automated refactoring (codemod) applications and linters.</p>
<p><a href="https://parso.readthedocs.io/" target="_blank" rel="noopener">Parso</a> is a Python parser that supports error recovery and round-trip parsing for different Python versions (in multiple Python versions). Parso is also able to list multiple syntax errors in your python file.</p>
<h2 id="symtable-—-Access-to-the-compiler’s-symbol-tables"><a href="#symtable-—-Access-to-the-compiler’s-symbol-tables" class="headerlink" title="symtable —- Access to the compiler’s symbol tables"></a><code>symtable</code> —- Access to the compiler’s symbol tables</h2><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/symtable.py" target="_blank" rel="noopener">Lib/symtable.py</a></p>
<hr>
<p>Symbol tables are generated by the compiler from AST just before bytecode is generated. The symbol table is responsible for calculating the scope of every identifier in the code. <code>symtable</code> provides an interface to examine these tables.</p>
<h3 id="Generating-Symbol-Tables"><a href="#Generating-Symbol-Tables" class="headerlink" title="Generating Symbol Tables"></a>Generating Symbol Tables</h3><p><code>symtable.symtable</code>(<em>code</em>, <em>filename</em>, <em>compile_type</em>)</p>
<p>Return the toplevel <code>SymbolTable</code> for the Python source <em>code</em>. <em>filename</em> is the name of the file containing the code. <em>compile_type</em> is like the <em>mode</em> argument to <code>compile()</code>.</p>
<h3 id="Examining-Symbol-Tables"><a href="#Examining-Symbol-Tables" class="headerlink" title="Examining Symbol Tables"></a>Examining Symbol Tables</h3><p><em>class</em> <code>symtable.SymbolTable</code></p>
<p>A namespace table for a block. The constructor is not public.</p>
<ul>
<li><p><code>get_type</code>()</p>
<p>Return the type of the symbol table. Possible values are <code>'class'</code>, <code>'module'</code>, and <code>'function'</code>.</p>
</li>
<li><p><code>get_id</code>()</p>
<p>Return the table’s identifier.</p>
</li>
<li><p><code>get_name</code>()</p>
<p>Return the table’s name. This is the name of the class if the table is for a class, the name of the function if the table is for a function, or <code>'top'</code> if the table is global (<code>get_type()</code> returns <code>'module'</code>).</p>
</li>
<li><p><code>get_lineno</code>()</p>
<p>Return the number of the first line in the block this table represents.</p>
</li>
<li><p><code>is_optimized</code>()</p>
<p>Return <code>True</code> if the locals in this table can be optimized.</p>
</li>
<li><p><code>is_nested</code>()</p>
<p>Return <code>True</code> if the block is a nested class or function.</p>
</li>
<li><p><code>has_children</code>()</p>
<p>Return <code>True</code> if the block has nested namespaces within it. These can be obtained with <code>get_children()</code>.</p>
</li>
<li><p><code>get_identifiers</code>()</p>
<p>Return a list of names of symbols in this table.</p>
</li>
<li><p><code>lookup</code>(<em>name</em>)</p>
<p>Lookup <em>name</em> in the table and return a <code>Symbol</code> instance.</p>
</li>
<li><p><code>get_symbols</code>()</p>
<p>Return a list of <code>Symbol</code> instances for names in the table.</p>
</li>
<li><p><code>get_children</code>()</p>
<p>Return a list of the nested symbol tables.</p>
</li>
</ul>
<p><em>class</em> <code>symtable.Function</code></p>
<p>A namespace for a function or method. This class inherits <code>SymbolTable</code>.</p>
<ul>
<li><p><code>get_parameters</code>()</p>
<p>Return a tuple containing names of parameters to this function.</p>
</li>
<li><p><code>get_locals</code>()</p>
<p>Return a tuple containing names of locals in this function.</p>
</li>
<li><p><code>get_globals</code>()</p>
<p>Return a tuple containing names of globals in this function.</p>
</li>
<li><p><code>get_nonlocals</code>()</p>
<p>Return a tuple containing names of nonlocals in this function.</p>
</li>
<li><p><code>get_frees</code>()</p>
<p>Return a tuple containing names of free variables in this function.</p>
</li>
</ul>
<p><em>class</em> <code>symtable.Class</code></p>
<p>A namespace of a class. This class inherits <code>SymbolTable</code>.</p>
<ul>
<li><p><code>get_methods</code>()</p>
<p>Return a tuple containing the names of methods declared in the class.</p>
</li>
</ul>
<p><em>class</em> <code>symtable.Symbol</code></p>
<p>An entry in a <code>SymbolTable</code> corresponding to an identifier in the source. The constructor is not public.</p>
<ul>
<li><p><code>get_name</code>()</p>
<p>Return the symbol’s name.</p>
</li>
<li><p><code>is_referenced</code>()</p>
<p>Return <code>True</code> if the symbol is used in its block.</p>
</li>
<li><p><code>is_imported</code>()</p>
<p>Return <code>True</code> if the symbol is created from an import statement.</p>
</li>
<li><p><code>is_parameter</code>()</p>
<p>Return <code>True</code> if the symbol is a parameter.</p>
</li>
<li><p><code>is_global</code>()</p>
<p>Return <code>True</code> if the symbol is global.</p>
</li>
<li><p><code>is_nonlocal</code>()</p>
<p>Return <code>True</code> if the symbol is nonlocal.</p>
</li>
<li><p><code>is_declared_global</code>()</p>
<p>Return <code>True</code> if the symbol is declared global with a global statement.</p>
</li>
<li><p><code>is_local</code>()</p>
<p>Return <code>True</code> if the symbol is local to its block.</p>
</li>
<li><p><code>is_annotated</code>()</p>
<p>Return <code>True</code> if the symbol is annotated.</p>
<p>3.6 新版功能.</p>
</li>
<li><p><code>is_free</code>()</p>
<p>Return <code>True</code> if the symbol is referenced in its block, but not assigned to.</p>
</li>
<li><p><code>is_assigned</code>()</p>
<p>Return <code>True</code> if the symbol is assigned to in its block.</p>
</li>
<li><p><code>is_namespace</code>()</p>
<p>Return <code>True</code> if name binding introduces new namespace.</p>
<p>If the name is used as the target of a function or class statement, this will be true.</p>
<p>例如：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> table <span class="token operator">=</span> symtable<span class="token punctuation">.</span>symtable<span class="token punctuation">(</span><span class="token string">"def some_func(): pass"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"exec"</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> table<span class="token punctuation">.</span>lookup<span class="token punctuation">(</span><span class="token string">"some_func"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_namespace<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Note that a single name can be bound to multiple objects. If the result is <code>True</code>, the name may also be bound to other objects, like an int or list, that does not introduce a new namespace.</p>
</li>
<li><p><code>get_namespaces</code>()</p>
<p>Return a list of namespaces bound to this name.</p>
</li>
<li><p><code>get_namespace</code>()</p>
<p>Return the namespace bound to this name. If more than one namespace is bound, <code>ValueError</code> is raised.</p>
</li>
</ul>
<h2 id="token-—-与Python解析树一起使用的常量"><a href="#token-—-与Python解析树一起使用的常量" class="headerlink" title="token —- 与Python解析树一起使用的常量"></a><code>token</code> —- 与Python解析树一起使用的常量</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/token.py" target="_blank" rel="noopener">Lib/token.py</a></p>
<hr>
<p>This module provides constants which represent the numeric values of leaf nodes of the parse tree (terminal tokens). Refer to the file <code>Grammar/Tokens</code> in the Python distribution for the definitions of the names in the context of the language grammar. The specific numeric values which the names map to may change between Python versions.</p>
<p>该模块还提供从数字代码到名称和一些函数的映射。 这些函数镜像了 Python C 头文件中的定义。</p>
<pre><code>token.tok_name</code></pre><p>将此模块中定义的常量的数值映射回名称字符串的字典，允许生成更加人类可读的解析树表示。</p>
<p><code>token.ISTERMINAL</code>(<em>x</em>)</p>
<p>对终端标记值返回 <code>True</code>。</p>
<p><code>token.ISNONTERMINAL</code>(<em>x</em>)</p>
<p>对非终端标记值返回 <code>True</code>。</p>
<p><code>token.ISEOF</code>(<em>x</em>)</p>
<p>如果 <em>x</em> 是表示输入结束的标记则返回 <code>True</code>。</p>
<p>标记常量是：</p>
<pre><code>token.ENDMARKER
token.NAME
token.NUMBER
token.STRING
token.NEWLINE
token.INDENT
token.DEDENT
token.LPAR</code></pre><p><code>"("</code> 的权标值。</p>
<pre><code>token.RPAR</code></pre><p><code>")"</code> 的权标值。</p>
<pre><code>token.LSQB</code></pre><p><code>"["</code> 的权标值。</p>
<pre><code>token.RSQB</code></pre><p><code>"]"</code> 的权标值。</p>
<pre><code>token.COLON</code></pre><p><code>":"</code> 的权标值。</p>
<pre><code>token.COMMA</code></pre><p><code>","</code> 的权标值。</p>
<pre><code>token.SEMI</code></pre><p><code>";"</code> 的权标值。</p>
<pre><code>token.PLUS</code></pre><p><code>"+"</code> 的权标值。</p>
<pre><code>token.MINUS</code></pre><p><code>"-"</code> 的权标值。</p>
<pre><code>token.STAR</code></pre><p><code>"*"</code> 的权标值。</p>
<pre><code>token.SLASH</code></pre><p><code>"/"</code> 的权标值。</p>
<pre><code>token.VBAR</code></pre><p><code>"|"</code> 的权标值。</p>
<pre><code>token.AMPER</code></pre><p><code>"&amp;"</code> 的权标值。</p>
<pre><code>token.LESS</code></pre><p><code>"&lt;"</code> 的权标值。</p>
<pre><code>token.GREATER</code></pre><p><code>"&gt;"</code> 的权标值。</p>
<pre><code>token.EQUAL</code></pre><p>Token value for <code>"="</code>.</p>
<pre><code>token.DOT</code></pre><p>Token value for <code>"."</code>.</p>
<pre><code>token.PERCENT</code></pre><p>Token value for <code>"%"</code>.</p>
<pre><code>token.LBRACE</code></pre><p>Token value for <code>"{"</code>.</p>
<pre><code>token.RBRACE</code></pre><p>Token value for <code>"}"</code>.</p>
<pre><code>token.EQEQUAL</code></pre><p>Token value for <code>"=="</code>.</p>
<pre><code>token.NOTEQUAL</code></pre><p>Token value for <code>"!="</code>.</p>
<pre><code>token.LESSEQUAL</code></pre><p>Token value for <code>"&lt;="</code>.</p>
<pre><code>token.GREATEREQUAL</code></pre><p>Token value for <code>"&gt;="</code>.</p>
<pre><code>token.TILDE</code></pre><p>Token value for <code>"~"</code>.</p>
<pre><code>token.CIRCUMFLEX</code></pre><p>Token value for <code>"^"</code>.</p>
<pre><code>token.LEFTSHIFT</code></pre><p>Token value for <code>"&lt;&lt;"</code>.</p>
<pre><code>token.RIGHTSHIFT</code></pre><p>Token value for <code>"&gt;&gt;"</code>.</p>
<pre><code>token.DOUBLESTAR</code></pre><p>Token value for <code>"**"</code>.</p>
<pre><code>token.PLUSEQUAL</code></pre><p>Token value for <code>"+="</code>.</p>
<pre><code>token.MINEQUAL</code></pre><p>Token value for <code>"-="</code>.</p>
<pre><code>token.STAREQUAL</code></pre><p>Token value for <code>"*="</code>.</p>
<pre><code>token.SLASHEQUAL</code></pre><p>Token value for <code>"/="</code>.</p>
<pre><code>token.PERCENTEQUAL</code></pre><p>Token value for <code>"%="</code>.</p>
<pre><code>token.AMPEREQUAL</code></pre><p>Token value for <code>"&amp;="</code>.</p>
<pre><code>token.VBAREQUAL</code></pre><p>Token value for <code>"|="</code>.</p>
<pre><code>token.CIRCUMFLEXEQUAL</code></pre><p>Token value for <code>"^="</code>.</p>
<pre><code>token.LEFTSHIFTEQUAL</code></pre><p>Token value for <code>"&lt;&lt;="</code>.</p>
<pre><code>token.RIGHTSHIFTEQUAL</code></pre><p>Token value for <code>"&gt;&gt;="</code>.</p>
<pre><code>token.DOUBLESTAREQUAL</code></pre><p>Token value for <code>"**="</code>.</p>
<pre><code>token.DOUBLESLASH</code></pre><p>Token value for <code>"//"</code>.</p>
<pre><code>token.DOUBLESLASHEQUAL</code></pre><p>Token value for <code>"//="</code>.</p>
<pre><code>token.AT</code></pre><p>Token value for <code>"@"</code>.</p>
<pre><code>token.ATEQUAL</code></pre><p>Token value for <code>"@="</code>.</p>
<pre><code>token.RARROW</code></pre><p>Token value for <code>"-&gt;"</code>.</p>
<pre><code>token.ELLIPSIS</code></pre><p>Token value for <code>"..."</code>.</p>
<pre><code>token.COLONEQUAL</code></pre><p>Token value for <code>":="</code>.</p>
<pre><code>token.OP
token.AWAIT
token.ASYNC
token.TYPE_IGNORE
token.TYPE_COMMENT
token.SOFT_KEYWORD
token.ERRORTOKEN
token.N_TOKENS
token.NT_OFFSET</code></pre><p>C 标记生成器不使用以下标记类型值，但 <code>tokenize</code> 模块需要这些标记类型值。</p>
<pre><code>token.COMMENT</code></pre><p>标记值用于表示注释。</p>
<pre><code>token.NL</code></pre><p>标记值用于表示非终止换行符。 <code>NEWLINE</code> 标记表示 Python 代码逻辑行的结束；当在多条物理线路上继续执行逻辑代码行时，会生成 <code>NL</code> 标记。</p>
<pre><code>token.ENCODING</code></pre><p>指示用于将源字节解码为文本的编码的标记值。 <code>tokenize.tokenize()</code> 返回的第一个标记将始终是一个 <code>ENCODING</code> 标记。</p>
<pre><code>token.TYPE_COMMENT</code></pre><p>Token value indicating that a type comment was recognized. Such tokens are only produced when <code>ast.parse()</code> is invoked with <code>type_comments=True</code>.</p>
<p>在 3.5 版更改: 补充 <code>AWAIT</code> 和 <code>ASYNC</code> 标记。</p>
<p>在 3.7 版更改: 补充 <code>COMMENT</code> 、 <code>NL</code> 和 <code>ENCODING</code> 标记。</p>
<p>在 3.7 版更改: 移除 <code>AWAIT</code>和 <code>ASYNC</code> 标记。 “async” 和 “await” 现在被标记为 <code>NAME</code> 标记。</p>
<p>在 3.8 版更改: Added <code>TYPE_COMMENT</code>, <code>TYPE_IGNORE</code>, <code>COLONEQUAL</code>. Added <code>AWAIT</code> and <code>ASYNC</code> tokens back (they’re needed to support parsing older Python versions for <code>ast.parse()</code> with <code>feature_version</code> set to 6 or lower).</p>
<h2 id="keyword-—-检验Python关键字"><a href="#keyword-—-检验Python关键字" class="headerlink" title="keyword —- 检验Python关键字"></a><code>keyword</code> —- 检验Python关键字</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/keyword.py" target="_blank" rel="noopener">Lib/keyword.py</a></p>
<hr>
<p>此模块允许 Python 程序确定某个字符串是否为 关键字。</p>
<p><code>keyword.iskeyword</code>(<em>s</em>)</p>
<p>如果 <em>s</em> 是一个 Python 关键字 则返回 <code>True</code>。</p>
<pre><code>keyword.kwlist</code></pre><p>包含解释器定义的所有 关键字 的序列。 如果所定义的任何关键字仅在特定 <code>__future__</code> 语句生效时被激活，它们也将被包含在内。</p>
<p><code>keyword.issoftkeyword</code>(<em>s</em>)</p>
<p>如果 <em>s</em> 是一个 Python 的软 关键字 则返回 <code>True</code>。</p>
<p>3.9 新版功能.</p>
<pre><code>keyword.softkwlist</code></pre><p>包含解释器定义的所有软 关键字 的序列。 如果所定义的任何软关键字仅在特定 <code>__future__</code> 语句生效时被激活，它们也将被包含在内。</p>
<p>3.9 新版功能.</p>
<h2 id="tokenize-—-对-Python-代码使用的标记解析器"><a href="#tokenize-—-对-Python-代码使用的标记解析器" class="headerlink" title="tokenize —- 对 Python 代码使用的标记解析器"></a><code>tokenize</code> —- 对 Python 代码使用的标记解析器</h2><p><strong>源码：</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/tokenize.py" target="_blank" rel="noopener">Lib/tokenize.py</a></p>
<hr>
<p>The <code>tokenize</code> module provides a lexical scanner for Python source code, implemented in Python. The scanner in this module returns comments as tokens as well, making it useful for implementing “pretty-printers”, including colorizers for on-screen displays.</p>
<p>为了简化标记流的处理，所有的 运算符 和 定界符 以及 <code>Ellipsis</code> 返回时都会打上通用的 <code>OP</code> 标记。 可以通过 <code>tokenize.tokenize()</code> 返回的 named tuple 对象的 <code>exact_type</code> 属性来获得确切的标记类型。</p>
<h3 id="对输入进行解析标记"><a href="#对输入进行解析标记" class="headerlink" title="对输入进行解析标记"></a>对输入进行解析标记</h3><p>主要的入口是一个 generator:</p>
<p><code>tokenize.tokenize</code>(<em>readline</em>)</p>
<p>生成器 <code>tokenize()</code> 需要一个 <em>readline</em> 参数，这个参数必须是一个可调用对象，且能提供与文件对象的 <code>io.IOBase.readline()</code> 方法相同的接口。每次调用这个函数都要 返回字节类型输入的一行数据。</p>
<p>The generator produces 5-tuples with these members: the token type; the token string; a 2-tuple <code>(srow, scol)</code> of ints specifying the row and column where the token begins in the source; a 2-tuple <code>(erow, ecol)</code> of ints specifying the row and column where the token ends in the source; and the line on which the token was found. The line passed (the last tuple item) is the <em>physical</em> line. The 5 tuple is returned as a named tuple with the field names: <code>type string start end line</code>.</p>
<p>The returned named tuple has an additional property named <code>exact_type</code> that contains the exact operator type for <code>OP</code> tokens. For all other token types <code>exact_type</code> equals the named tuple <code>type</code> field.</p>
<p>在 3.1 版更改: Added support for named tuples.</p>
<p>在 3.3 版更改: Added support for <code>exact_type</code>.</p>
<p><code>tokenize()</code> determines the source encoding of the file by looking for a UTF-8 BOM or encoding cookie, according to <a href="https://www.python.org/dev/peps/pep-0263" target="_blank" rel="noopener"><strong>PEP 263</strong></a>.</p>
<p><code>tokenize.generate_tokens</code>(<em>readline</em>)</p>
<p>Tokenize a source reading unicode strings instead of bytes.</p>
<p>Like <code>tokenize()</code>, the <em>readline</em> argument is a callable returning a single line of input. However, <code>generate_tokens()</code> expects <em>readline</em> to return a str object rather than bytes.</p>
<p>The result is an iterator yielding named tuples, exactly like <code>tokenize()</code>. It does not yield an <code>ENCODING</code> token.</p>
<p>All constants from the <code>token</code> module are also exported from <code>tokenize</code>.</p>
<p>Another function is provided to reverse the tokenization process. This is useful for creating tools that tokenize a script, modify the token stream, and write back the modified script.</p>
<p><code>tokenize.untokenize</code>(<em>iterable</em>)</p>
<p>Converts tokens back into Python source code. The <em>iterable</em> must return sequences with at least two elements, the token type and the token string. Any additional sequence elements are ignored.</p>
<p>The reconstructed script is returned as a single string. The result is guaranteed to tokenize back to match the input so that the conversion is lossless and round-trips are assured. The guarantee applies only to the token type and token string as the spacing between tokens (column positions) may change.</p>
<p>It returns bytes, encoded using the <code>ENCODING</code> token, which is the first token sequence output by <code>tokenize()</code>. If there is no encoding token in the input, it returns a str instead.</p>
<p><code>tokenize()</code> needs to detect the encoding of source files it tokenizes. The function it uses to do this is available:</p>
<p><code>tokenize.detect_encoding</code>(<em>readline</em>)</p>
<p>The <code>detect_encoding()</code> function is used to detect the encoding that should be used to decode a Python source file. It requires one argument, readline, in the same way as the <code>tokenize()</code> generator.</p>
<p>It will call readline a maximum of twice, and return the encoding used (as a string) and a list of any lines (not decoded from bytes) it has read in.</p>
<p>It detects the encoding from the presence of a UTF-8 BOM or an encoding cookie as specified in <a href="https://www.python.org/dev/peps/pep-0263" target="_blank" rel="noopener"><strong>PEP 263</strong></a>. If both a BOM and a cookie are present, but disagree, a <code>SyntaxError</code> will be raised. Note that if the BOM is found, <code>'utf-8-sig'</code> will be returned as an encoding.</p>
<p>If no encoding is specified, then the default of <code>'utf-8'</code> will be returned.</p>
<p>Use <code>open()</code> to open Python source files: it uses <code>detect_encoding()</code> to detect the file encoding.</p>
<p><code>tokenize.open</code>(<em>filename</em>)</p>
<p>Open a file in read only mode using the encoding detected by <code>detect_encoding()</code>.</p>
<p>3.2 新版功能.</p>
<p><em>exception</em> <code>tokenize.TokenError</code></p>
<p>Raised when either a docstring or expression that may be split over several lines is not completed anywhere in the file, for example:</p>
<pre><code>"""Beginning of
docstring</code></pre><p>或者：</p>
<pre><code>[1,
 2,
 3</code></pre><p>Note that unclosed single-quoted strings do not cause an error to be raised. They are tokenized as <code>ERRORTOKEN</code>, followed by the tokenization of their contents.</p>
<h3 id="Command-Line-Usage-1"><a href="#Command-Line-Usage-1" class="headerlink" title="Command-Line Usage"></a>Command-Line Usage</h3><p>3.3 新版功能.</p>
<p>The <code>tokenize</code> module can be executed as a script from the command line. It is as simple as:</p>
<pre><code>python -m tokenize [-e] [filename.py]</code></pre><p>The following options are accepted:</p>
<pre><code>-h``,` `--help</code></pre><p>show this help message and exit</p>
<pre><code>-e``,` `--exact</code></pre><p>display token names using the exact type</p>
<p>If <code>filename.py</code> is specified its contents are tokenized to stdout. Otherwise, tokenization is performed on stdin.</p>
<h3 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h3><p>Example of a script rewriter that transforms float literals into Decimal objects:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> tokenize <span class="token keyword">import</span> tokenize<span class="token punctuation">,</span> untokenize<span class="token punctuation">,</span> NUMBER<span class="token punctuation">,</span> STRING<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> OP
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">def</span> <span class="token function">decistmt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Substitute Decimals for floats in a string of statements.
    >>> from decimal import Decimal
    >>> s = 'print(+21.3e-5*-.1234/81.7)'
    >>> decistmt(s)
    "print (+Decimal ('21.3e-5')*-Decimal ('.1234')/Decimal ('81.7'))"
    The format of the exponent is inherited from the platform C library.
    Known cases are "e-007" (Windows) and "e-07" (not Windows).  Since
    we're only showing 12 digits, and the 13th isn't close to 5, the
    rest of the output should be platform-independent.
    >>> exec(s)  #doctest: +ELLIPSIS
    -3.21716034272e-0...7
    Output from calculations with Decimal should be identical across all
    platforms.
    >>> exec(decistmt(s))
    -3.217160342717258261933904529E-7
    """</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    g <span class="token operator">=</span> tokenize<span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readline<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># tokenize the string</span>
    <span class="token keyword">for</span> toknum<span class="token punctuation">,</span> tokval<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _ <span class="token keyword">in</span> g<span class="token punctuation">:</span>
        <span class="token keyword">if</span> toknum <span class="token operator">==</span> NUMBER <span class="token operator">and</span> <span class="token string">'.'</span> <span class="token keyword">in</span> tokval<span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># replace NUMBER tokens</span>
            result<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> <span class="token string">'Decimal'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>OP<span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>STRING<span class="token punctuation">,</span> repr<span class="token punctuation">(</span>tokval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>OP<span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>toknum<span class="token punctuation">,</span> tokval<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> untokenize<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Example of tokenizing from the command line. The script:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>
say_hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>will be tokenized to the following output where the first column is the range of the line/column coordinates where the token is found, the second column is the name of the token, and the final column is the value of the token (if any)</p>
<pre><code>$ python -m tokenize hello.py
0,0-0,0:            ENCODING       'utf-8'
1,0-1,3:            NAME           'def'
1,4-1,13:           NAME           'say_hello'
1,13-1,14:          OP             '('
1,14-1,15:          OP             ')'
1,15-1,16:          OP             ':'
1,16-1,17:          NEWLINE        '\n'
2,0-2,4:            INDENT         '    '
2,4-2,9:            NAME           'print'
2,9-2,10:           OP             '('
2,10-2,25:          STRING         '"Hello, World!"'
2,25-2,26:          OP             ')'
2,26-2,27:          NEWLINE        '\n'
3,0-3,1:            NL             '\n'
4,0-4,0:            DEDENT         ''
4,0-4,9:            NAME           'say_hello'
4,9-4,10:           OP             '('
4,10-4,11:          OP             ')'
4,11-4,12:          NEWLINE        '\n'
5,0-5,0:            ENDMARKER      ''</code></pre><p>The exact token type names can be displayed using the <code>-e</code> option:</p>
<pre><code>$ python -m tokenize -e hello.py
0,0-0,0:            ENCODING       'utf-8'
1,0-1,3:            NAME           'def'
1,4-1,13:           NAME           'say_hello'
1,13-1,14:          LPAR           '('
1,14-1,15:          RPAR           ')'
1,15-1,16:          COLON          ':'
1,16-1,17:          NEWLINE        '\n'
2,0-2,4:            INDENT         '    '
2,4-2,9:            NAME           'print'
2,9-2,10:           LPAR           '('
2,10-2,25:          STRING         '"Hello, World!"'
2,25-2,26:          RPAR           ')'
2,26-2,27:          NEWLINE        '\n'
3,0-3,1:            NL             '\n'
4,0-4,0:            DEDENT         ''
4,0-4,9:            NAME           'say_hello'
4,9-4,10:           LPAR           '('
4,10-4,11:          RPAR           ')'
4,11-4,12:          NEWLINE        '\n'
5,0-5,0:            ENDMARKER      ''</code></pre><p>Example of tokenizing a file programmatically, reading unicode strings instead of bytes with <code>generate_tokens()</code>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tokenize
<span class="token keyword">with</span> tokenize<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'hello.py'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    tokens <span class="token operator">=</span> tokenize<span class="token punctuation">.</span>generate_tokens<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">)</span>
    <span class="token keyword">for</span> token <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者通过 <code>tokenize()</code> 直接读取字节数据:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tokenize
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'hello.py'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    tokens <span class="token operator">=</span> tokenize<span class="token punctuation">.</span>tokenize<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">)</span>
    <span class="token keyword">for</span> token <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="tabnanny-—-模糊缩进检测"><a href="#tabnanny-—-模糊缩进检测" class="headerlink" title="tabnanny —- 模糊缩进检测"></a><code>tabnanny</code> —- 模糊缩进检测</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/tabnanny.py" target="_blank" rel="noopener">Lib/tabnanny.py</a></p>
<hr>
<p>目前，该模块旨在作为脚本调用。但是可以使用下面描述的 <code>check()</code> 函数将其导入IDE。</p>
<p>注解</p>
<p>此模块提供的API可能会在将来的版本中更改；此类更改可能无法向后兼容。</p>
<p><code>tabnanny.check</code>(<em>file_or_dir</em>)</p>
<p>如果 <em>file_or_dir</em> 是目录而非符号链接，则递归地在名为 <em>file_or_dir</em> 的目录树中下行，沿途检查所有 <code>.py</code> 文件。 如果 <em>file_or_dir</em> 是一个普通 Python 源文件，将检查其中的空格相关问题。 诊断消息将使用 <code>print()</code> 函数写入到标准输出。</p>
<pre><code>tabnanny.verbose</code></pre><p>此旗标指明是否打印详细消息。 如果作为脚本调用则是通过 <code>-v</code> 选项来增加。</p>
<pre><code>tabnanny.filename_only</code></pre><p>此旗标指明是否只打印包含空格相关问题文件的文件名。 如果作为脚本调用则是通过 <code>-q</code> 选项来设为真值。</p>
<p><em>exception</em> <code>tabnanny.NannyNag</code></p>
<p>如果检测到模糊缩进则由 <code>process_tokens()</code> 引发。 在 <code>check()</code> 中捕获并处理。</p>
<p><code>tabnanny.process_tokens</code>(<em>tokens</em>)</p>
<p>此函数由 <code>check()</code> 用来处理由 <code>tokenize</code> 模块所生成的标记。</p>
<h2 id="pyclbr-—-Python-模块浏览器支持"><a href="#pyclbr-—-Python-模块浏览器支持" class="headerlink" title="pyclbr —- Python 模块浏览器支持"></a><code>pyclbr</code> —- Python 模块浏览器支持</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/pyclbr.py" target="_blank" rel="noopener">Lib/pyclbr.py</a></p>
<hr>
<p><code>pyclbr</code> 模块提供了对于以 Python 编写的模块中定义的函数、类和方法的受限信息。 这种信息足够用来实现一个模块浏览器。 这种信息是从 Python 源代码中直接提取而非通过导入模块，因此该模块可以安全地用于不受信任的代码。 此限制使得非 Python 实现的模块无法使用此模块，包括所有标准和可选的扩展模块。</p>
<p><code>pyclbr.readmodule</code>(<em>module</em>, <em>path=None</em>)</p>
<p>返回一个将模块层级的类名映射到类描述器的字典。 如果可能，将会包括已导入基类的描述器。 形参 <em>module</em> 为要读取模块名称的字符串；它可能是某个包内部的模块名称。 <em>path</em> 如果给出则为添加到 <code>sys.path</code> 开头的目录路径序列，它会被用于定位模块的源代码。</p>
<p>此函数为原始接口，仅保留用于向下兼容。 它会返回以下内容的过滤版本。</p>
<p><code>pyclbr.readmodule_ex</code>(<em>module</em>, <em>path=None</em>)</p>
<p>返回一个基于字典的树，其中包含与模块中每个用 <code>def</code> 或 <code>class</code> 语句定义的函数和类相对应的函数和类描述器。 被返回的字典会将模块层级的函数和类名映射到它们的描述器。 嵌套的对象会被输入到它们的上级子目录中。 与 readmodule 一样，<em>module</em> 指明要读取的模块而 <em>path</em> 会被添加到 sys.path。 如果被读取的模块是一个包，则返回的字典将具有 <code>'__path__'</code> 键，其值是一个包含包搜索路径的列表。</p>
<p>3.7 新版功能: 嵌套定义的描述器。 它们通过新的子属性来访问。 每个定义都会有一个新的上级属性。</p>
<p>这些函数所返回的描述器是 Function 和 Class 类的实例。 用户不应自行创建这些类的实例。</p>
<h3 id="Function-对象"><a href="#Function-对象" class="headerlink" title="Function 对象"></a>Function 对象</h3><p><code>Function</code> 类的实例描述了由 def 语句所定义的函数。 它们具有下列属性:</p>
<pre><code>Function.file</code></pre><p>函数定义所在的文件名称。</p>
<pre><code>Function.module</code></pre><p>定义了所描述函数的模块名称。</p>
<pre><code>Function.name</code></pre><p>函数名称。</p>
<pre><code>Function.lineno</code></pre><p>定义在文件中起始位置的行号。</p>
<pre><code>Function.parent</code></pre><p>对于最高层级函数为 None。 对于嵌套函数则为上级函数。</p>
<p>3.7 新版功能.</p>
<pre><code>Function.children</code></pre><p>将名称映射到嵌套函数和类描述器的字典。</p>
<p>3.7 新版功能.</p>
<pre><code>Function.is_async</code></pre><p><code>True</code> 针对使用 <code>async</code> 前缀定义的函数，其他情况下为 <code>False</code>。</p>
<p>3.10 新版功能.</p>
<h3 id="Class-对象"><a href="#Class-对象" class="headerlink" title="Class 对象"></a>Class 对象</h3><p><code>Class</code> 类的实例描述了由 class 语句所定义的类。 它们具有与 Function 对象相同的属性以及两个额外属性。</p>
<pre><code>Class.file</code></pre><p>类定义所在的文件名称。</p>
<pre><code>Class.module</code></pre><p>定义了所描述类的模块名称。</p>
<pre><code>Class.name</code></pre><p>类名称。</p>
<pre><code>Class.lineno</code></pre><p>定义在文件中起始位置的行号。</p>
<pre><code>Class.parent</code></pre><p>对于最高层级类为 None。 对于嵌套类则为上级类。</p>
<p>3.7 新版功能.</p>
<pre><code>Class.children</code></pre><p>将名称映射到嵌套函数和类描述器的字典。</p>
<p>3.7 新版功能.</p>
<pre><code>Class.super</code></pre><p>一个 <code>Class</code> 对象的列表，它们描述了所描述类的直接基类。 被命名为超类但无法被 <code>readmodule_ex()</code> 发现的类会作为类名字符串而非 <code>Class</code> 对象列出。</p>
<pre><code>Class.methods</code></pre><p>一个将方法名映射到行号的字典。 此属性可从更新的子目录中获取，仅保留用于向下兼容。</p>
<h2 id="py-compile-—-编译-Python-源文件"><a href="#py-compile-—-编译-Python-源文件" class="headerlink" title="py_compile —- 编译 Python 源文件"></a><code>py_compile</code> —- 编译 Python 源文件</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/py_compile.py" target="_blank" rel="noopener">Lib/py_compile.py</a></p>
<hr>
<p><code>py_compile</code> 模块提供了用来从源文件生成字节码的函数和另一个用于当模块源文件作为脚本被调用时的函数。</p>
<p>虽然不太常用，但这个函数在安装共享模块时还是很有用的，特别是当一些用户可能没有权限在包含源代码的目录中写字节码缓存文件时。</p>
<p><em>exception</em> <code>py_compile.PyCompileError</code></p>
<p>当编译文件过程中发生错误时，抛出的异常。</p>
<p><code>py_compile.compile</code>(<em>file</em>, <em>cfile=None</em>, <em>dfile=None</em>, <em>doraise=False</em>, <em>optimize=- 1</em>, <em>invalidation_mode=PycInvalidationMode.TIMESTAMP</em>, <em>quiet=0</em>)</p>
<p>将源文件编译成字节码并写出字节码缓存文件。 源代码从名为 <em>file</em> 的文件中加载。 字节码会写入到 <em>cfile<em>，默认为 [*</em>PEP 3147<strong>](<a href="https://www.python.org/dev/peps/pep-3147)/[" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-3147)/[</a></strong>PEP 488**](<a href="https://www.python.org/dev/peps/pep-0488" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0488</a>) 路径，以 <code>.pyc</code> 结尾。 例如，如果 *file</em> 是 <code>/foo/bar/baz.py</code> 则对于 Python 3.2 <em>cfile</em> 将默认为 <code>/foo/bar/__pycache__/baz.cpython-32.pyc</code>。 如果指定了 <em>dfile*，则在错误信息中它将代替 *file</em> 作为源文件的名称。 如果 <em>doraise</em> 为真值，则当编译 <em>file</em> 遇到错误时将会引发 <code>PyCompileError</code>。 如果 <em>doraise</em> 为假值（默认），则将错误信息写入到 <code>sys.stderr</code>，但不会引发异常。 此函数返回编译后字节码文件的路径，即 <em>cfile</em> 所使用的值。</p>
<p><em>doraise</em> 和 <em>quiet</em> 参数确定在编译文件时如何处理错误。 如果 <em>quiet</em> 为 0 或 1，并且 <em>doraise</em> 为假值，则会启用默认行为：写入错误信息到 <code>sys.stderr</code>，并且函数将返回 <code>None</code> 而非一个路径。 如果 <em>doraise</em> 为真值，则将改为引发 <code>PyCompileError</code>。 但是如果 <em>quiet</em> 为 2，则不会写入消息，并且 <em>doraise</em> 也不会有效果。</p>
<p>如果 <em>cfile</em> 所表示（显式指定或计算得出）的路径为符号链接或非常规文件，则将引发 <code>FileExistsError</code>。 此行为是用来警告如果允许写入编译后字节码文件到这些路径则导入操作将会把它们转为常规文件。 这是使用文件重命名来将最终编译后字节码文件放置到位以防止并发文件写入问题的导入操作的附带效果。</p>
<p><em>optimize</em> 控制优化级别并会被传给内置的 <code>compile()</code> 函数。 默认值 <code>-1</code> 表示选择当前解释器的优化级别。</p>
<p><em>invalidation_mode</em> 应当是 <code>PycInvalidationMode</code> 枚举的成员，它控制在运行时如何让已生成的字节码缓存失效。 如果设置了 <code>SOURCE_DATE_EPOCH</code> 环境变量则默认值为 <code>PycInvalidationMode.CHECKED_HASH</code>，否则默认值为 <code>PycInvalidationMode.TIMESTAMP</code>。</p>
<p>在 3.2 版更改: 将 <em>cfile</em> 的默认值改成与 <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> 兼容。 之前的默认值是 <em>file</em> + <code>'c'</code> (如果启用优化则为 <code>'o'</code>)。 同时也添加了 <em>optimize</em> 形参。</p>
<p>在 3.4 版更改: 将代码更改为使用 <code>importlib</code> 执行字节码缓存文件写入。 这意味着文件创建/写入的语义现在与 <code>importlib</code> 所做的相匹配，例如权限、写入和移动语义等等。 同时也添加了当 <em>cfile</em> 为符号链接或非常规文件时引发 <code>FileExistsError</code> 的预警设置。</p>
<p>在 3.7 版更改: <em>invalidation_mode</em> 形参是根据 <a href="https://www.python.org/dev/peps/pep-0552" target="_blank" rel="noopener"><strong>PEP 552</strong></a> 的描述添加的。 如果设置了 <code>SOURCE_DATE_EPOCH</code> 环境变量，<em>invalidation_mode</em> 将被强制设为 <code>PycInvalidationMode.CHECKED_HASH</code>。</p>
<p>在 3.7.2 版更改: <code>SOURCE_DATE_EPOCH</code> 环境变量不会再覆盖 <em>invalidation_mode</em> 参数的值，而改为确定其默认值。</p>
<p>在 3.8 版更改: 增加了 <em>quiet</em> 形参。</p>
<p><em>class</em> <code>py_compile.PycInvalidationMode</code></p>
<p>一个由可用方法组成的枚举，解释器可以用来确定字节码文件是否与源文件保持一致。 <code>.pyc</code> 文件在其标头中指明了所需的失效模式。 Python 在运行时如何让 <code>.pyc</code> 文件失效的更多信息。</p>
<p>3.7 新版功能.</p>
<ul>
<li><p><code>TIMESTAMP</code></p>
<p><code>.pyc</code> 文件包括时间戳和源文件的大小，Python 将在运行时将其与源文件的元数据进行比较以确定 <code>.pyc</code> 文件是否需要重新生成。</p>
</li>
<li><p><code>CHECKED_HASH</code></p>
<p><code>.pyc</code> 文件包括源文件内容的哈希值，Python 将在运行时将其与源文件内容进行比较以确定 <code>.pyc</code> 文件是否需要重新生成。</p>
</li>
<li><p><code>UNCHECKED_HASH</code></p>
<p>类似于 <code>CHECKED_HASH</code>，<code>.pyc</code> 文件包括源文件内容的哈希值。 但是，Python 将在运行时假定 <code>.pyc</code> 文件是最新的而完全不会将 <code>.pyc</code> 与源文件进行验证。</p>
<p>此选项适用于 <code>.pycs</code> 由 Python 以外的某个系统例如构建系统来确保最新的情况。</p>
</li>
</ul>
<h3 id="命令行接口-1"><a href="#命令行接口-1" class="headerlink" title="命令行接口"></a>命令行接口</h3><p>这个模块可作为脚本发起调用以编译多个源文件。 在 <em>filenames</em> 中指定的文件会被编译并将结果字节码以普通方式进行缓存。 这个程序不会搜索目录结构来定位源文件；它只编译显式指定的文件。 如果某个文件无法被编译则退出状态为非零值。</p>
<pre><code>&lt;file&gt;` `... &lt;fileN&gt;
-</code></pre><p>位置参数是要编译的文件。 如果 <code>-</code> 是唯一的形参，则文件列表将从标准输入获取。</p>
<pre><code>-q``,` `--quiet</code></pre><p>屏蔽错误输出。</p>
<p>在 3.2 版更改: 添加了对 <code>-</code> 的支持。</p>
<p>在 3.10 版更改: 添加了对 <code>-q</code> 的支持。</p>
<h2 id="compileall-—-Byte-compile-Python-libraries"><a href="#compileall-—-Byte-compile-Python-libraries" class="headerlink" title="compileall —- Byte-compile Python libraries"></a><code>compileall</code> —- Byte-compile Python libraries</h2><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/compileall.py" target="_blank" rel="noopener">Lib/compileall.py</a></p>
<hr>
<p>This module provides some utility functions to support installing Python libraries. These functions compile Python source files in a directory tree. This module can be used to create the cached byte-code files at library installation time, which makes them available for use even by users who don’t have write permission to the library directories.</p>
<h3 id="Command-line-use"><a href="#Command-line-use" class="headerlink" title="Command-line use"></a>Command-line use</h3><p>This module can work as a script (using <strong>python -m compileall</strong>) to compile Python sources.</p>
<pre><code>directory` `...
file` `...</code></pre><p>Positional arguments are files to compile or directories that contain source files, traversed recursively. If no argument is given, behave as if the command line was <code>-l &lt;directories from sys.path&gt;</code>.</p>
<pre><code>-l</code></pre><p>Do not recurse into subdirectories, only compile source code files directly contained in the named or implied directories.</p>
<pre><code>-f</code></pre><p>Force rebuild even if timestamps are up-to-date.</p>
<pre><code>-q</code></pre><p>Do not print the list of files compiled. If passed once, error messages will still be printed. If passed twice (<code>-qq</code>), all output is suppressed.</p>
<pre><code>-d` `destdir</code></pre><p>Directory prepended to the path to each file being compiled. This will appear in compilation time tracebacks, and is also compiled in to the byte-code file, where it will be used in tracebacks and other messages in cases where the source file does not exist at the time the byte-code file is executed.</p>
<pre><code>-s` `strip_prefix
-p` `prepend_prefix</code></pre><p>Remove (<code>-s</code>) or append (<code>-p</code>) the given prefix of paths recorded in the <code>.pyc</code> files. Cannot be combined with <code>-d</code>.</p>
<pre><code>-x` `regex</code></pre><p>regex is used to search the full path to each file considered for compilation, and if the regex produces a match, the file is skipped.</p>
<pre><code>-i` `list</code></pre><p>Read the file <code>list</code> and add each line that it contains to the list of files and directories to compile. If <code>list</code> is <code>-</code>, read lines from <code>stdin</code>.</p>
<pre><code>-b</code></pre><p>Write the byte-code files to their legacy locations and names, which may overwrite byte-code files created by another version of Python. The default is to write files to their <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> locations and names, which allows byte-code files from multiple versions of Python to coexist.</p>
<pre><code>-r</code></pre><p>Control the maximum recursion level for subdirectories. If this is given, then <code>-l</code> option will not be taken into account. <strong>python -m compileall &lt;directory&gt; -r 0</strong> is equivalent to <strong>python -m compileall &lt;directory&gt; -l</strong>.</p>
<pre><code>-j` `N</code></pre><p>Use <em>N</em> workers to compile the files within the given directory. If <code>0</code> is used, then the result of <code>os.cpu_count()</code> will be used.</p>
<pre><code>--invalidation-mode` `[timestamp|checked-hash|unchecked-hash]</code></pre><p>Control how the generated byte-code files are invalidated at runtime. The <code>timestamp</code> value, means that <code>.pyc</code> files with the source timestamp and size embedded will be generated. The <code>checked-hash</code> and <code>unchecked-hash</code> values cause hash-based pycs to be generated. Hash-based pycs embed a hash of the source file contents rather than a timestamp. See 已缓存字节码的失效 for more information on how Python validates bytecode cache files at runtime. The default is <code>timestamp</code> if the <code>SOURCE_DATE_EPOCH</code> environment variable is not set, and <code>checked-hash</code> if the <code>SOURCE_DATE_EPOCH</code> environment variable is set.</p>
<pre><code>-o` `level</code></pre><p>Compile with the given optimization level. May be used multiple times to compile for multiple levels at a time (for example, <code>compileall -o 1 -o 2</code>).</p>
<pre><code>-e` `dir</code></pre><p>Ignore symlinks pointing outside the given directory.</p>
<pre><code>--hardlink-dupes</code></pre><p>If two <code>.pyc</code> files with different optimization level have the same content, use hard links to consolidate duplicate files.</p>
<p>在 3.2 版更改: Added the <code>-i</code>, <code>-b</code> and <code>-h</code> options.</p>
<p>在 3.5 版更改: Added the <code>-j</code>, <code>-r</code>, and <code>-qq</code> options. <code>-q</code> option was changed to a multilevel value. <code>-b</code> will always produce a byte-code file ending in <code>.pyc</code>, never <code>.pyo</code>.</p>
<p>在 3.7 版更改: Added the <code>--invalidation-mode</code> option.</p>
<p>在 3.9 版更改: Added the <code>-s</code>, <code>-p</code>, <code>-e</code> and <code>--hardlink-dupes</code> options. Raised the default recursion limit from 10 to <code>sys.getrecursionlimit()</code>. Added the possibility to specify the <code>-o</code> option multiple times.</p>
<p>There is no command-line option to control the optimization level used by the <code>compile()</code> function, because the Python interpreter itself already provides the option: <strong>python -O -m compileall</strong>.</p>
<p>Similarly, the <code>compile()</code> function respects the <code>sys.pycache_prefix</code> setting. The generated bytecode cache will only be useful if <code>compile()</code> is run with the same <code>sys.pycache_prefix</code> (if any) that will be used at runtime.</p>
<h3 id="Public-functions"><a href="#Public-functions" class="headerlink" title="Public functions"></a>Public functions</h3><p><code>compileall.compile_dir</code>(<em>dir</em>, <em>maxlevels=sys.getrecursionlimit()</em>, <em>ddir=None</em>, <em>force=False</em>, <em>rx=None</em>, <em>quiet=0</em>, <em>legacy=False</em>, <em>optimize=- 1</em>, <em>workers=1</em>, <em>invalidation_mode=None</em>, <em>**,</em> stripdir=None<em>,</em> prependdir=None<em>,</em> limit_sl_dest=None<em>,</em> hardlink_dupes=False*)</p>
<p>Recursively descend the directory tree named by <em>dir</em>, compiling all <code>.py</code> files along the way. Return a true value if all the files compiled successfully, and a false value otherwise.</p>
<p>The <em>maxlevels</em> parameter is used to limit the depth of the recursion; it defaults to <code>sys.getrecursionlimit()</code>.</p>
<p>If <em>ddir</em> is given, it is prepended to the path to each file being compiled for use in compilation time tracebacks, and is also compiled in to the byte-code file, where it will be used in tracebacks and other messages in cases where the source file does not exist at the time the byte-code file is executed.</p>
<p>If <em>force</em> is true, modules are re-compiled even if the timestamps are up to date.</p>
<p>If <em>rx</em> is given, its <code>search</code> method is called on the complete path to each file considered for compilation, and if it returns a true value, the file is skipped. This can be used to exclude files matching a regular expression, given as a re.Pattern object.</p>
<p>If <em>quiet</em> is <code>False</code> or <code>0</code> (the default), the filenames and other information are printed to standard out. Set to <code>1</code>, only errors are printed. Set to <code>2</code>, all output is suppressed.</p>
<p>If <em>legacy</em> is true, byte-code files are written to their legacy locations and names, which may overwrite byte-code files created by another version of Python. The default is to write files to their <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> locations and names, which allows byte-code files from multiple versions of Python to coexist.</p>
<p><em>optimize</em> specifies the optimization level for the compiler. It is passed to the built-in <code>compile()</code> function. Accepts also a sequence of optimization levels which lead to multiple compilations of one <code>.py</code> file in one call.</p>
<p>The argument <em>workers</em> specifies how many workers are used to compile files in parallel. The default is to not use multiple workers. If the platform can’t use multiple workers and <em>workers</em> argument is given, then sequential compilation will be used as a fallback. If <em>workers</em> is 0, the number of cores in the system is used. If <em>workers</em> is lower than <code>0</code>, a <code>ValueError</code> will be raised.</p>
<p><em>invalidation_mode</em> should be a member of the <code>py_compile.PycInvalidationMode</code> enum and controls how the generated pycs are invalidated at runtime.</p>
<p>The <em>stripdir</em>, <em>prependdir</em> and <em>limit_sl_dest</em> arguments correspond to the <code>-s</code>, <code>-p</code> and <code>-e</code> options described above. They may be specified as <code>str</code>, <code>bytes</code> or <code>os.PathLike</code>.</p>
<p>If <em>hardlink_dupes</em> is true and two <code>.pyc</code> files with different optimization level have the same content, use hard links to consolidate duplicate files.</p>
<p>在 3.2 版更改: Added the <em>legacy</em> and <em>optimize</em> parameter.</p>
<p>在 3.5 版更改: Added the <em>workers</em> parameter.</p>
<p>在 3.5 版更改: <em>quiet</em> parameter was changed to a multilevel value.</p>
<p>在 3.5 版更改: The <em>legacy</em> parameter only writes out <code>.pyc</code> files, not <code>.pyo</code> files no matter what the value of <em>optimize</em> is.</p>
<p>在 3.6 版更改: 接受一个 path-like object。</p>
<p>在 3.7 版更改: The <em>invalidation_mode</em> parameter was added.</p>
<p>在 3.7.2 版更改: The <em>invalidation_mode</em> parameter’s default value is updated to None.</p>
<p>在 3.8 版更改: Setting <em>workers</em> to 0 now chooses the optimal number of cores.</p>
<p>在 3.9 版更改: Added <em>stripdir</em>, <em>prependdir</em>, <em>limit_sl_dest</em> and <em>hardlink_dupes</em> arguments. Default value of <em>maxlevels</em> was changed from <code>10</code> to <code>sys.getrecursionlimit()</code></p>
<p><code>compileall.compile_file</code>(<em>fullname</em>, <em>ddir=None</em>, <em>force=False</em>, <em>rx=None</em>, <em>quiet=0</em>, <em>legacy=False</em>, <em>optimize=- 1</em>, <em>invalidation_mode=None</em>, <em>**,</em> stripdir=None<em>,</em> prependdir=None<em>,</em> limit_sl_dest=None<em>,</em> hardlink_dupes=False*)</p>
<p>Compile the file with path <em>fullname</em>. Return a true value if the file compiled successfully, and a false value otherwise.</p>
<p>If <em>ddir</em> is given, it is prepended to the path to the file being compiled for use in compilation time tracebacks, and is also compiled in to the byte-code file, where it will be used in tracebacks and other messages in cases where the source file does not exist at the time the byte-code file is executed.</p>
<p>If <em>rx</em> is given, its <code>search</code> method is passed the full path name to the file being compiled, and if it returns a true value, the file is not compiled and <code>True</code> is returned. This can be used to exclude files matching a regular expression, given as a re.Pattern object.</p>
<p>If <em>quiet</em> is <code>False</code> or <code>0</code> (the default), the filenames and other information are printed to standard out. Set to <code>1</code>, only errors are printed. Set to <code>2</code>, all output is suppressed.</p>
<p>If <em>legacy</em> is true, byte-code files are written to their legacy locations and names, which may overwrite byte-code files created by another version of Python. The default is to write files to their <a href="https://www.python.org/dev/peps/pep-3147" target="_blank" rel="noopener"><strong>PEP 3147</strong></a> locations and names, which allows byte-code files from multiple versions of Python to coexist.</p>
<p><em>optimize</em> specifies the optimization level for the compiler. It is passed to the built-in <code>compile()</code> function. Accepts also a sequence of optimization levels which lead to multiple compilations of one <code>.py</code> file in one call.</p>
<p><em>invalidation_mode</em> should be a member of the <code>py_compile.PycInvalidationMode</code> enum and controls how the generated pycs are invalidated at runtime.</p>
<p>The <em>stripdir</em>, <em>prependdir</em> and <em>limit_sl_dest</em> arguments correspond to the <code>-s</code>, <code>-p</code> and <code>-e</code> options described above. They may be specified as <code>str</code>, <code>bytes</code> or <code>os.PathLike</code>.</p>
<p>If <em>hardlink_dupes</em> is true and two <code>.pyc</code> files with different optimization level have the same content, use hard links to consolidate duplicate files.</p>
<p>3.2 新版功能.</p>
<p>在 3.5 版更改: <em>quiet</em> parameter was changed to a multilevel value.</p>
<p>在 3.5 版更改: The <em>legacy</em> parameter only writes out <code>.pyc</code> files, not <code>.pyo</code> files no matter what the value of <em>optimize</em> is.</p>
<p>在 3.7 版更改: The <em>invalidation_mode</em> parameter was added.</p>
<p>在 3.7.2 版更改: The <em>invalidation_mode</em> parameter’s default value is updated to None.</p>
<p>在 3.9 版更改: Added <em>stripdir</em>, <em>prependdir</em>, <em>limit_sl_dest</em> and <em>hardlink_dupes</em> arguments.</p>
<p><code>compileall.compile_path</code>(<em>skip_curdir=True</em>, <em>maxlevels=0</em>, <em>force=False</em>, <em>quiet=0</em>, <em>legacy=False</em>, <em>optimize=- 1</em>, <em>invalidation_mode=None</em>)</p>
<p>Byte-compile all the <code>.py</code> files found along <code>sys.path</code>. Return a true value if all the files compiled successfully, and a false value otherwise.</p>
<p>If <em>skip_curdir</em> is true (the default), the current directory is not included in the search. All other parameters are passed to the <code>compile_dir()</code> function. Note that unlike the other compile functions, <code>maxlevels</code> defaults to <code>0</code>.</p>
<p>在 3.2 版更改: Added the <em>legacy</em> and <em>optimize</em> parameter.</p>
<p>在 3.5 版更改: <em>quiet</em> parameter was changed to a multilevel value.</p>
<p>在 3.5 版更改: The <em>legacy</em> parameter only writes out <code>.pyc</code> files, not <code>.pyo</code> files no matter what the value of <em>optimize</em> is.</p>
<p>在 3.7 版更改: The <em>invalidation_mode</em> parameter was added.</p>
<p>在 3.7.2 版更改: The <em>invalidation_mode</em> parameter’s default value is updated to None.</p>
<p>To force a recompile of all the <code>.py</code> files in the <code>Lib/</code> subdirectory and all its subdirectories:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> compileall
compileall<span class="token punctuation">.</span>compile_dir<span class="token punctuation">(</span><span class="token string">'Lib/'</span><span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Perform same compilation, excluding files in .svn directories.</span>
<span class="token keyword">import</span> re
compileall<span class="token punctuation">.</span>compile_dir<span class="token punctuation">(</span><span class="token string">'Lib/'</span><span class="token punctuation">,</span> rx<span class="token operator">=</span>re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'[/\\][.]svn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># pathlib.Path objects can also be used.</span>
<span class="token keyword">import</span> pathlib
compileall<span class="token punctuation">.</span>compile_dir<span class="token punctuation">(</span>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'Lib/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="dis-—-Python-字节码反汇编器"><a href="#dis-—-Python-字节码反汇编器" class="headerlink" title="dis —- Python 字节码反汇编器"></a><code>dis</code> —- Python 字节码反汇编器</h2><p><strong>Source code:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/dis.py" target="_blank" rel="noopener">Lib/dis.py</a></p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/dis.html" target="_blank" rel="noopener"><code>dis</code> — Python 字节码反汇编器</a></li>
</ul>
<h2 id="pickletools-—-pickle-开发者工具集"><a href="#pickletools-—-pickle-开发者工具集" class="headerlink" title="pickletools —- pickle 开发者工具集"></a><code>pickletools</code> —- pickle 开发者工具集</h2><p><strong>源代码:</strong> <a href="https://github.com/python/cpython/tree/3.10/Lib/pickletools.py" target="_blank" rel="noopener">Lib/pickletools.py</a></p>
<hr>
<p>此模块包含与 <code>pickle</code> 模块内部细节有关的多个常量，一些关于具体实现的详细注释，以及一些能够分析封存数据的有用函数。 此模块的内容对需要操作 <code>pickle</code> 的 Python 核心开发者来说很有用处；<code>pickle</code> 的一般用户则可能会感觉 <code>pickletools</code> 模块与他们无关。</p>
<h3 id="命令行语法"><a href="#命令行语法" class="headerlink" title="命令行语法"></a>命令行语法</h3><p>3.2 新版功能.</p>
<p>当从命令行发起调用时，<code>python -m pickletools</code> 将对一个或更多 pickle 文件的内容进行拆解。 请注意如果你查看 pickle 中保存的 Python 对象而非 pickle 格式的细节，你可能需要改用 <code>-m pickle</code>。 但是，当你想检查的 pickle 文件来自某个不受信任的源时，<code>-m pickletools</code> 是更安全的选择，因为它不会执行 pickle 字节码。</p>
<p>例如，对于一个封存在文件 <code>x.pickle</code> 中的元组 <code>(1, 2)</code>:</p>
<pre><code>$ python -m pickle x.pickle
(1, 2)
$ python -m pickletools x.pickle
    0: \x80 PROTO      3
    2: K    BININT1    1
    4: K    BININT1    2
    6: \x86 TUPLE2
    7: q    BINPUT     0
    9: .    STOP
highest protocol among opcodes = 2</code></pre><h4 id="命令行选项"><a href="#命令行选项" class="headerlink" title="命令行选项"></a>命令行选项</h4><pre><code>-a``,` `--annotate</code></pre><p>使用简短的操作码描述来标注每一行。</p>
<pre><code>-o``,` `--output``=&lt;file&gt;</code></pre><p>输出应当写入到的文件名称。</p>
<pre><code>-l``,` `--indentlevel``=&lt;num&gt;</code></pre><p>一个新的 MARK 层级所需缩进的空格数。</p>
<pre><code>-m``,` `--memo</code></pre><p>当反汇编多个对象时，保留各个反汇编的备忘记录。</p>
<pre><code>-p``,` `--preamble``=&lt;preamble&gt;</code></pre><p>当指定一个以上的 pickle 文件时，在每次反汇编之前打印给定的前言。</p>
<h3 id="编程接口"><a href="#编程接口" class="headerlink" title="编程接口"></a>编程接口</h3><p><code>pickletools.dis</code>(<em>pickle</em>, <em>out=None</em>, <em>memo=None</em>, <em>indentlevel=4</em>, <em>annotate=0</em>)</p>
<p>将 pickle 的符号化反汇编数据输出到文件类对象 <em>out*，默认为 <code>sys.stdout</code>。 *pickle</em> 可以是一个字符串或一个文件类对象。 <em>memo</em> 可以是一个将被用作 pickle 的备忘记录的 Python 字典；它可被用来对由同一封存器创建的多个封存对象执行反汇编。 由 <code>MARK</code> 操作码指明的每个连续级别将会缩进 <em>indentlevel</em> 个空格。 如果为 <em>annotate</em> 指定了一个非零值，则输出中的每个操作码将以一个简短描述来标注。 <em>annotate</em> 的值会被用作标注所应开始的列的提示。</p>
<p>3.2 新版功能: <em>annotate</em> 参数。</p>
<p><code>pickletools.genops</code>(<em>pickle</em>)</p>
<p>提供包含 pickle 中所有操作码的 iterator，返回一个 <code>(opcode, arg, pos)</code> 三元组的序列。 <em>opcode</em> 是 <code>OpcodeInfo</code> 类的一个实例；<em>arg</em> 是 Python 对象形式的 opcode 参数的已解码值；<em>pos</em> 是 opcode 所在的位置。 <em>pickle</em> 可以是一个字符串或一个文件类对象。</p>
<p><code>pickletools.optimize</code>(<em>picklestring</em>)</p>
<p>在消除未使用的 <code>PUT</code> 操作码之后返回一个新的等效 pickle 字符串。 优化后的 pickle 将更为简短，耗费更为的传输时间，要求更少的存储空间并能更高效地解封。</p>
<h1 id="Windows系统相关模块"><a href="#Windows系统相关模块" class="headerlink" title="Windows系统相关模块"></a>Windows系统相关模块</h1><p>本章节叙述的模块只在 Windows 平台上可用。</p>
<ul>
<li><code>msilib</code> — Read and write Microsoft Installer files<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#database-objects" target="_blank" rel="noopener">Database Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#view-objects" target="_blank" rel="noopener">View Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#summary-information-objects" target="_blank" rel="noopener">Summary Information Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#record-objects" target="_blank" rel="noopener">Record Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#errors" target="_blank" rel="noopener">Errors</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#cab-objects" target="_blank" rel="noopener">CAB Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#directory-objects" target="_blank" rel="noopener">Directory Objects</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#features" target="_blank" rel="noopener">相关特性</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#gui-classes" target="_blank" rel="noopener">GUI classes</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msilib.html#precomputed-tables" target="_blank" rel="noopener">Precomputed tables</a></li>
</ul>
</li>
<li><code>msvcrt</code> — 来自 MS VC++ 运行时的有用例程<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#file-operations" target="_blank" rel="noopener">文件操作</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#console-i-o" target="_blank" rel="noopener">控制台 I/O</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/msvcrt.html#other-functions" target="_blank" rel="noopener">其他函数</a></li>
</ul>
</li>
<li><code>winreg</code> — 访问 Windows 注册表<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#functions" target="_blank" rel="noopener">函数</a></li>
<li>常量<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#hkey-constants" target="_blank" rel="noopener">HKEY_* 常量</a></li>
<li>访问权限<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#bit-specific" target="_blank" rel="noopener">64 位系统特有</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#value-types" target="_blank" rel="noopener">注册表值的类型</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winreg.html#registry-handle-objects" target="_blank" rel="noopener">注册表句柄对象</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/winsound.html" target="_blank" rel="noopener"><code>winsound</code> —— Windows 系统的音频播放接口</a></li>
</ul>
<h1 id="Unix-专有服务"><a href="#Unix-专有服务" class="headerlink" title="Unix 专有服务"></a>Unix 专有服务</h1><p>本章描述的模块提供了 Unix 操作系统独有特性的接口，在某些情况下也适用于它的某些或许多衍生版。 以下为模块概览：</p>
<ul>
<li><code>posix</code> — 最常见的 POSIX 系统调用<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/posix.html#large-file-support" target="_blank" rel="noopener">大文件支持</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/posix.html#notable-module-contents" target="_blank" rel="noopener">重要的模块内容</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/pwd.html" target="_blank" rel="noopener"><code>pwd</code> — 用户密码数据库</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/spwd.html" target="_blank" rel="noopener"><code>spwd</code> —— shadow 密码库</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/grp.html" target="_blank" rel="noopener"><code>grp</code> — 组数据库</a></li>
<li><code>crypt</code> —— 验证 Unix 口令的函数<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/crypt.html#hashing-methods" target="_blank" rel="noopener">哈希方法</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/crypt.html#module-attributes" target="_blank" rel="noopener">模块属性</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/crypt.html#module-functions" target="_blank" rel="noopener">模块函数</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/crypt.html#examples" target="_blank" rel="noopener">例子</a></li>
</ul>
</li>
<li><code>termios</code> — POSIX 风格的 tty 控制<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/termios.html#example" target="_blank" rel="noopener">示例</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tty.html" target="_blank" rel="noopener"><code>tty</code> — 终端控制功能</a></li>
<li><code>pty</code> — 伪终端工具<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/pty.html#example" target="_blank" rel="noopener">示例</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/fcntl.html" target="_blank" rel="noopener"><code>fcntl</code> —— 系统调用 <code>fcntl</code> 和 <code>ioctl</code></a></li>
<li><code>pipes</code> — 终端管道接口<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/pipes.html#template-objects" target="_blank" rel="noopener">模板对象</a></li>
</ul>
</li>
<li><code>resource</code> — 资源使用信息<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/resource.html#resource-limits" target="_blank" rel="noopener">资源限制</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/resource.html#resource-usage" target="_blank" rel="noopener">资源用量</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/nis.html" target="_blank" rel="noopener"><code>nis</code> — Sun 的 NIS (黄页) 接口</a></li>
<li>Unix syslog 库例程<ul>
<li>例子<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/syslog.html#simple-example" target="_blank" rel="noopener">简单示例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="被取代的模块"><a href="#被取代的模块" class="headerlink" title="被取代的模块"></a>被取代的模块</h1><p>本章中描述的模块均已弃用，仅保留用于向后兼容。 它们已经被其他模块所取代。</p>
<ul>
<li><code>optparse</code> — 解析器的命令行选项<ul>
<li>背景<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#terminology" target="_blank" rel="noopener">术语</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#what-are-options-for" target="_blank" rel="noopener">What are options for?</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#what-are-positional-arguments-for" target="_blank" rel="noopener">位置位置</a></li>
</ul>
</li>
<li>教程<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#understanding-option-actions" target="_blank" rel="noopener">Understanding option actions</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#the-store-action" target="_blank" rel="noopener">The store action</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#handling-boolean-flag-options" target="_blank" rel="noopener">Handling boolean (flag) options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#other-actions" target="_blank" rel="noopener">Other actions</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#default-values" target="_blank" rel="noopener">默认值</a></li>
<li>Generating help<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#grouping-options" target="_blank" rel="noopener">Grouping Options</a></li>
</ul>
</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#printing-a-version-string" target="_blank" rel="noopener">Printing a version string</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#how-optparse-handles-errors" target="_blank" rel="noopener">How <code>optparse</code> handles errors</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#putting-it-all-together" target="_blank" rel="noopener">Putting it all together</a></li>
</ul>
</li>
<li>参考指南<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#creating-the-parser" target="_blank" rel="noopener">创建解析器</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#populating-the-parser" target="_blank" rel="noopener">填充解析器</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#defining-options" target="_blank" rel="noopener">定义选项</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#option-attributes" target="_blank" rel="noopener">Option attributes</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#standard-option-actions" target="_blank" rel="noopener">Standard option actions</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#standard-option-types" target="_blank" rel="noopener">Standard option types</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#parsing-arguments" target="_blank" rel="noopener">解析参数</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#querying-and-manipulating-your-option-parser" target="_blank" rel="noopener">Querying and manipulating your option parser</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#conflicts-between-options" target="_blank" rel="noopener">Conflicts between options</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#cleanup" target="_blank" rel="noopener">清理</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#other-methods" target="_blank" rel="noopener">Other methods</a></li>
</ul>
</li>
<li>Option Callbacks<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#defining-a-callback-option" target="_blank" rel="noopener">Defining a callback option</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#how-callbacks-are-called" target="_blank" rel="noopener">How callbacks are called</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#raising-errors-in-a-callback" target="_blank" rel="noopener">Raising errors in a callback</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-1-trivial-callback" target="_blank" rel="noopener">Callback example 1: trivial callback</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-2-check-option-order" target="_blank" rel="noopener">Callback example 2: check option order</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-3-check-option-order-generalized" target="_blank" rel="noopener">Callback example 3: check option order (generalized)</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-4-check-arbitrary-condition" target="_blank" rel="noopener">Callback example 4: check arbitrary condition</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-5-fixed-arguments" target="_blank" rel="noopener">Callback example 5: fixed arguments</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#callback-example-6-variable-arguments" target="_blank" rel="noopener">Callback example 6: variable arguments</a></li>
</ul>
</li>
<li>Extending <code>optparse</code><ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#adding-new-types" target="_blank" rel="noopener">Adding new types</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/optparse.html#adding-new-actions" target="_blank" rel="noopener">Adding new actions</a></li>
</ul>
</li>
</ul>
</li>
<li><code>imp</code> —— 由代码内部访问 import 。<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/imp.html#examples" target="_blank" rel="noopener">例子</a></li>
</ul>
</li>
</ul>
<h1 id="未创建文档的模块"><a href="#未创建文档的模块" class="headerlink" title="未创建文档的模块"></a>未创建文档的模块</h1><p>以下是应当记入文档但是目前尚无文档的模块速览列表。 </p>
<p>本章的想法和原内容取自 Fredrik Lundh 的帖子；本章的具体内容已经大幅修改。</p>
<h2 id="平台特定模块"><a href="#平台特定模块" class="headerlink" title="平台特定模块"></a>平台特定模块</h2><p>这些模块用于实现 <code>os.path</code> 模块，除此之外没有文档。几乎没有必要创建这些文档。</p>
<pre><code>ntpath</code></pre><p>— 在 Win32 和 Win64 平台上实现 <code>os.path</code> 。</p>
<pre><code>posixpath</code></pre><p>— 在 POSIX 上实现 <code>os.path</code> 。</p>
<h1 id="Security-Considerations"><a href="#Security-Considerations" class="headerlink" title="Security Considerations"></a>Security Considerations</h1><p>The following modules have specific security considerations:</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3.10/library/base64.html#module-base64" target="_blank" rel="noopener"><code>base64</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/base64.html#base64-security" target="_blank" rel="noopener">base64 security considerations</a> in <a href="https://tools.ietf.org/html/rfc4648.html" target="_blank" rel="noopener"><strong>RFC 4648</strong></a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/cgi.html#module-cgi" target="_blank" rel="noopener"><code>cgi</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/cgi.html#cgi-security" target="_blank" rel="noopener">CGI security considerations</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/hashlib.html#module-hashlib" target="_blank" rel="noopener"><code>hashlib</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/hashlib.html#hashlib-usedforsecurity" target="_blank" rel="noopener">all constructors take a “usedforsecurity” keyword-only argument disabling known insecure and blocked algorithms</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/http.server.html#module-http.server" target="_blank" rel="noopener"><code>http.server</code></a> is not suitable for production use, only implementing basic security checks</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/logging.html#module-logging" target="_blank" rel="noopener"><code>logging</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/logging.config.html#logging-eval-security" target="_blank" rel="noopener">Logging configuration uses eval()</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/multiprocessing.html#module-multiprocessing" target="_blank" rel="noopener"><code>multiprocessing</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/multiprocessing.html#multiprocessing-recv-pickle-security" target="_blank" rel="noopener">Connection.recv() uses pickle</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/pickle.html#module-pickle" target="_blank" rel="noopener"><code>pickle</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/pickle.html#pickle-restrict" target="_blank" rel="noopener">Restricting globals in pickle</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/random.html#module-random" target="_blank" rel="noopener"><code>random</code></a> shouldn’t be used for security purposes, use <a href="https://docs.python.org/zh-cn/3.10/library/secrets.html#module-secrets" target="_blank" rel="noopener"><code>secrets</code></a> instead</li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/shelve.html#module-shelve" target="_blank" rel="noopener"><code>shelve</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/shelve.html#shelve-security" target="_blank" rel="noopener">shelve is based on pickle and thus unsuitable for dealing with untrusted sources</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/ssl.html#module-ssl" target="_blank" rel="noopener"><code>ssl</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/ssl.html#ssl-security" target="_blank" rel="noopener">SSL/TLS security considerations</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/subprocess.html#module-subprocess" target="_blank" rel="noopener"><code>subprocess</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/subprocess.html#subprocess-security" target="_blank" rel="noopener">Subprocess security considerations</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#module-tempfile" target="_blank" rel="noopener"><code>tempfile</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/tempfile.html#tempfile-mktemp-deprecated" target="_blank" rel="noopener">mktemp is deprecated due to vulnerability to race conditions</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/xml.html#module-xml" target="_blank" rel="noopener"><code>xml</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/xml.html#xml-vulnerabilities" target="_blank" rel="noopener">XML vulnerabilities</a></li>
<li><a href="https://docs.python.org/zh-cn/3.10/library/zipfile.html#module-zipfile" target="_blank" rel="noopener"><code>zipfile</code></a>: <a href="https://docs.python.org/zh-cn/3.10/library/zipfile.html#zipfile-resources-limitations" target="_blank" rel="noopener">maliciously prepared .zip files can cause disk volume exhaustion</a></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/Language-Python-Lib4.html">https://jackhcc.github.io/posts/Language-Python-Lib4.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-11-14T16-00-08',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/dl-series19.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/6.jpg" class="responsive-img" alt="DL专栏19-Awesome Dataset">
                        
                        <span class="card-title">DL专栏19-Awesome Dataset</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            机器学习常用数据集
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-11-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Dataset/">
                        <span class="chip bg-color">Dataset</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/blog-python28.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/0.jpg" class="responsive-img" alt="Python-学习资料">
                        
                        <span class="card-title">Python-学习资料</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Python-学习资料汇总【Archived】
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-11-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

