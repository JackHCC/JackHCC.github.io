<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="LSH(Locality Sensitive Hashing)详解, JackHCC">
    <meta name="description" content="LSH(Locality Sensitive Hashing)学习记录">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LSH(Locality Sensitive Hashing)详解 | JackHCC</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my.css">
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="JackHCC" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">JackHCC</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="https://creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Creative工具导航</span>
        </a>
      </li>
      
      <li>
        <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/" target="_blank" rel="noopener">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>NLP每日论文</span>
        </a>
      </li>
      
      <li>
        <a href="http://chat.creativecc.cn/" target="_blank" rel="noopener">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>RocketChat聊天室</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Contact留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/me.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">JackHCC</div>
        <div class="logo-desc">
            
            Make the world betterrrr!!!
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="https://creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Creative工具导航</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="https://blog.creativecc.cn/Arxiv-NLP-Reporter/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>NLP每日论文</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="http://chat.creativecc.cn/ " target="_blank" rel="noopener" style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>RocketChat聊天室</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/contact " style="margin-left:75px";>
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>Contact留言板</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JackHCC/JackHCC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JackHCC/JackHCC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/10.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">LSH(Locality Sensitive Hashing)详解</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 30px;
        bottom: 146px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/LSH/">
                                <span class="chip bg-color">LSH</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Algorithm/" class="post-category">
                                Algorithm
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-08-17
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-08-25
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    26 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="数据相似性的度量方法"><a href="#数据相似性的度量方法" class="headerlink" title="数据相似性的度量方法"></a>数据相似性的度量方法</h1><p>现实中，我们需要处理的数据具有着不同的形式和特征。而对数据相似性的度量又是数据挖掘分析中非常重要的环节。针对这些不同形式的数据，不可能找到一种具备普遍意义的相似性度量算法，甚至可以说，每种类型的数据都有它对应的相似度度量标准。</p>
<h2 id="数据属性分类"><a href="#数据属性分类" class="headerlink" title="数据属性分类"></a>数据属性分类</h2><p>现实世界，任何事物其实都可以描述成一个对象。这个概念其实跟面向对象编程中对象的含义是一致的。对象有很多属性，属性的类型当然也有所不同。打个比方说，如果把我看做一个对象，那我就基本拥有“姓名”、“性别”、“年龄”、“籍贯”等等，这些都是我的属性，和起来就是一条数据，也就是户籍部门拿到的关于我这个对象的数据。同理，如果把一张图片看做一个对象，那么“像素值”，“亮度”、“对比度”，“饱和度”等等就是图片的属性。处理图像数据，当然要从这些属性入手。</p>
<p>所以，看到这里，我们大概能总结出来2点：</p>
<ol>
<li>一般情况下的数据挖掘工作，其实就是针对1个或多个对象及其属性做的运算，而数据一般就被表示为：object: attributes的形式。</li>
<li>不同对象（甚至相同对象在不同的应用场景下）的属性类型不同。需要分类讨论。</li>
</ol>
<h3 id="标称属性"><a href="#标称属性" class="headerlink" title="标称属性"></a>标称属性</h3><p>属性值一般是一些符号或事物的名称。比如说，对相亲网站的注册用户，系统可会记录如下信息：性别，年龄，职业，地点，学历等等。这些数据都是通过名称来描述的。</p>
<h3 id="二元属性"><a href="#二元属性" class="headerlink" title="二元属性"></a>二元属性</h3><p>这个好理解了，所有属性都可以通过最简单的0，1描述。一般常用来表示存在性。比如说，一个感冒患者一般会用是否存在“发烧”、“流涕”、“咽痛”等症状来做记录，存在这些状况，记录为1，不存在，记录为0。当一个患者来看病时，当然就可以通过这些属性值是否为1来做出诊断的结果。</p>
<h3 id="序数属性"><a href="#序数属性" class="headerlink" title="序数属性"></a>序数属性</h3><p>属性值是由有意义的排序数决定的。例如，对一部电影评价，可以分为“剧情”、“演员”、“音乐”、“特技”等几个方面评价，而每个方面都有“好”、“中”、“差”3个选项供选择。而这些有排序意义的选择之间我们是无法说明具体差距的。也就是说，是定性，而非定量。</p>
<p>到此为止，上面的3种属性都是定性的，而非定量的。</p>
<h3 id="数值属性"><a href="#数值属性" class="headerlink" title="数值属性"></a>数值属性</h3><p>那么对于属性可以定量的这种属性类型，只怕也是我们生活中遇到情况最多的了，这种属性，就叫“数值属性”，有关于这些属性值的分析可以说是最多的，常见的平均数，众数、中位数等等，就是处理这些属性的。后面我们还可以看到，对于拥有数值属性的对象相似度的度量，也有着相应的方法。</p>
<h2 id="相似性度量"><a href="#相似性度量" class="headerlink" title="相似性度量"></a>相似性度量</h2><p>我们分别就刚才所说的4种属性，看看当一个对象拥有不同类型的属性时，应该用什么方法度量。其实，没有人能告诉你一种对象到底该用什么样的方法度量其相似性，因为现实中，可能很多情况下你所需要测量的数据是非常复杂的，所以这里也只是给出一些常见的处理方法，具体问题还要具体分析。</p>
<h3 id="标称属性相似度度量"><a href="#标称属性相似度度量" class="headerlink" title="标称属性相似度度量"></a>标称属性相似度度量</h3><p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817150920834.png" alt=""></p>
<h3 id="二元属性相似度度量"><a href="#二元属性相似度度量" class="headerlink" title="二元属性相似度度量"></a>二元属性相似度度量</h3><p>总的来说，和标称属性是类似的，但是情况稍微复杂一点。要分成对称和非对称2种形式。</p>
<p><strong>(1)对称二元属性</strong></p>
<p>先看对称的情况，所谓对称，是说对象的所有属性都是一样重要的。这就和标称属性类似了，用所有具有相同属性值的属性个数除总的属性数。公式和标称属性一致：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151013139.png" alt=""></p>
<p><strong>(2)非对称二元属性</strong></p>
<p>所谓非对称，是说我们只关心“正匹配”的情况，也就是只关心两个对象属性中，都是1的情况。公式如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151052835.png" alt=""></p>
<h3 id="数值属性相似度度量"><a href="#数值属性相似度度量" class="headerlink" title="数值属性相似度度量"></a>数值属性相似度度量</h3><p>当然，我们还有序数属性的相似度没讲。但是序数属性的相似性测量与数值属性确是有一定联系的，所以，先看数值属性对象如何度量其相似度。</p>
<p>对于数值属性的相似度度量有一套完整的方法，那就是大名鼎鼎的“闵可夫斯基”距离，也叫Lp范数。</p>
<p><strong>(1) 欧氏距离</strong></p>
<p>因为数值属性一般都是以数值向量表示的。所以，当然也要从数值向量上下功夫。最常见的判断两个向量距离的方法就是我们熟知的欧氏距离，公式如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151206188.png" alt=""></p>
<p><strong>(2) 曼哈顿距离</strong></p>
<p>除了欧氏距离，还有一种方法叫曼哈顿距离，起名的由来是计量由方块形构成的曼哈顿街区的距离，因为街区不能横穿，只能按照方格走到。所以，这种距离的度量方式也就很清晰了，就是两个向量之间各个维度的差的绝对值之和，公式如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151226626.png" alt=""></p>
<p><strong>(3) 闵可夫斯基距离</strong></p>
<p>将曼哈顿距离与欧氏距离推广，可以得到闵可夫斯基距离，也叫Lp范数。公式如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151301964.png" alt=""></p>
<h3 id="序数属性相似度度量"><a href="#序数属性相似度度量" class="headerlink" title="序数属性相似度度量"></a>序数属性相似度度量</h3><p>序数属性的每个属性值都代表了一种次序，所以，不论使用数字表示的，还是用文字性的叙述，都可以表示成数字的形式。例如，一个对象的某个属性有“大”、“中”、“小”3个可能的属性值，我们当然可以用相应的1、2、3来替代这种文字性的叙述。</p>
<p>当转换成对应的整数之后，为了使每个属性都有相同的权重（这个很容易理解，有些属性只有“大”、“中”、“小”3中选项，有些却有“下”、“中下”、“中”、“中上”、“上”5个属性，这样，不同属性之间的权重当然没有可比性了），将通过以下公式将每个整数型的属性值映射到[0.0, 1.0]的区间上。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151355922.png" alt=""></p>
<h3 id="混合类型属性相似度度量"><a href="#混合类型属性相似度度量" class="headerlink" title="混合类型属性相似度度量"></a>混合类型属性相似度度量</h3><p>上面说的这几种情况都是数据库中的数据相对类型比较统一，但是很多时候，实际工作中遇到的情况却并非如此。我们遇到的一组数据可能拥有多种类型的属性，也就是混合类型属性。</p>
<p>碰到这种情况，一种一般的处理办法是按照如下公式：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151438231.png" alt=""></p>
<h3 id="余弦相似性"><a href="#余弦相似性" class="headerlink" title="余弦相似性"></a>余弦相似性</h3><p>余弦相似性是一种针对文档数据的，特殊的相似度测量方法。</p>
<p>在处理文档的时候，我们一般采用文档所拥有的关键词来刻画一个文档的特征。容易想象，如果能定义一个字典，（所谓字典，就是包含了所处理的文档集的所有可能的关键词的一个有序的关键词集合。从这个角度讲，好像叫词典更为合适，但是字典的叫法已经是惯例了），那么就能通过字典为每个文档生成一个bool型的向量，这个向量与字典等长，每个位置用0、1表示字典中对应的关键词在该文档的存在性。</p>
<p>这么看，好像和前面说的二元属性没有什么不同。但是如果为了实现一种更准确的度量，再给这个二元向量加个权重，比如每个词的词频，那么用上面讲的任何度量方法就都不是特别合适了。例如，如果用欧氏距离判断相似度的话，因为这种向量很多位都是0，就是说很稀疏，这就导致大部分词是两个文档所不共有的，从而判断结果是2个文档很不相似。</p>
<p>对于这种文档-关键词的特殊情形，我们一般采用余弦相似度。<br><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817151622058.png" alt=""></p>
<p>其中，x,y是2个文档解析出来的词频向量。当然，有关于文档的相似度判断是整个信息检索领域的基础问题，也是核心问题。这里面内容相当丰富，以后再详谈，这里只是将余弦相似度做个简略的介绍。</p>
<h1 id="LSH简介"><a href="#LSH简介" class="headerlink" title="LSH简介"></a>LSH简介</h1><p>LSH(Locality Sensitive Hashing)翻译成中文，叫做“局部敏感哈希”，它是一种针对海量高维数据的快速最近邻查找算法。</p>
<p>在信息检索，数据挖掘以及推荐系统等应用中，我们经常会遇到的一个问题就是面临着海量的高维数据，查找最近邻。如果使用线性查找，那么对于低维数据效率尚可，而对于高维数据，就显得非常耗时了。为了解决这样的问题，人们设计了一种特殊的hash函数，使得2个相似度很高的数据以较高的概率映射成同一个hash值，而令2个相似度很低的数据以极低的概率映射成同一个hash值。我们把这样的函数，叫做LSH（局部敏感哈希）。LSH最根本的作用，就是能高效处理海量高维数据的最近邻问题。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817150019737.png" alt=""></p>
<p>相似度的定义根据实际情况自己决定，后面我们可以看到，针对不同的相似度测量方法，局部敏感哈希的算法设计也不同，当然，无论是哪种LSH，其实说白了，都是将高维数据降维到低维数据，同时，还能在一定程度上，保持原始数据的相似度不变。LSH不是确定性的，而是概率性的，也就是说有一定的概率导致原本很相似的数据映射成2个不同的hash值，或者原本不相似的数据映射成同一hash值。这是高维数据降维过程中所不能避免的（因为降维势必会造成某种程度上数据的失真），不过好在LSH的设计能够通过相应的参数控制出现这种错误的概率，这也是LSH为什么被广泛应用的原因。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li>Min-Hash：使用Jaccard系数度量数据相似度</li>
<li>P-stable Hash：使用欧氏距离度量数据相似度</li>
<li>E2LSH：P-stable LSH在欧氏空间的一种随机化实现方法</li>
<li><a href="http://www.vldb.org/pvldb/vol13/p643-zheng.pdf" target="_blank" rel="noopener">PM_LSH</a></li>
<li><a href="https://cloud.kaust.edu.sa/Documents/sigmod09-tao.pdf" target="_blank" rel="noopener">LSB-tree</a></li>
<li><a href="http://www.cse.ust.hk/~wilfred/paper/sigmod12.pdf" target="_blank" rel="noopener">C2LSH</a></li>
<li>SimHash</li>
</ul>
<h2 id="Min-Hash"><a href="#Min-Hash" class="headerlink" title="Min-Hash"></a>Min-Hash</h2><h3 id="hash函数的选择"><a href="#hash函数的选择" class="headerlink" title="hash函数的选择"></a>hash函数的选择</h3><p>了解min-hash之前，首先需要了解一下Jaccard系数的概念。Jaccard系数主要用来解决的是非对称二元属性相似度的度量问题，常用的场景是度量2个集合之间的相似度，公式这里我不写了，就是2个集合的交比2个集合的并。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817153959867.png" alt=""></p>
<p>首先，我们现在将上面这个word-document的矩阵按行置换，比如可以置换成以下的形式：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817154040244.png" alt=""></p>
<p>可以确定的是，这没有改变文档与词项的关系。现在做这样一件事：对这个矩阵按行进行多次置换，每次置换之后，统计每一列（其实对应的就是每个文档）第一个不为0的位置（行号），这样每次统计的结果能构成一个与文档数等大的向量，这个向量，我们称之为<strong>签名向量</strong>。</p>
<p>比如，如果对最上面的矩阵做这样的统计，得到[1,2,1,2]，对于下面的矩阵做统计，得到[1,1,2,1].</p>
<p>简单来想这个问题，就拿上面的文档来说，如果两个文档足够相似，那也就是说这两个文档中有很多元素是共有的，换句话说，这样置换之后统计出来的签名向量，如果其中有一些文档的相似度很高，那么这些文档所对应的签名向量的相应的元素，值相同的概率就很高。</p>
<p>我们把最初始时的矩阵叫做input matrix，由m个文档，n个词项组成。而把由t次置换后得到的一个t×m的矩阵叫做<strong>signature matrix</strong>.<br><img src="/images/loading.gif" data-original="../images/algorithm/20161103213855627.png" alt=""></p>
<p>图中，4个文档，做了3次置换，得到了一个3 x 4的签名矩阵。</p>
<p>需要注意的是，置换矩阵的行，在代码实现的时候，可以用这样的算法实现：</p>
<ol>
<li><p>在当下剩余的行中（初始时，剩余的行为全部行），随机选取任意一行，看看这一行哪些位置（这里的位置其实是列号）的元素是1，如果签名向量中这个位置的元素还未被写入，则在这个位置写入随机选取的这个行的行号。并将这一行排除。</p>
</li>
<li><p>持续进行1步的工作，直到签名向量全部被写满为止。</p>
</li>
</ol>
<p>以上2步的意义跟对整个矩阵置换、再统计，结果是一样的。这么说可能有点抽象，我把函数放在下面：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sigGen</span><span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    * generate the signature vector

    :param matrix: a ndarray var
    :return a signature vector: a list var
    """</span>

    <span class="token comment" spellcheck="true"># the row sequence set</span>
    seqSet <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>matrix<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token comment" spellcheck="true"># initialize the sig vector as [-1, -1, ..., -1]</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>matrix<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span> len<span class="token punctuation">(</span>seqSet<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true"># choose a row of matrix randomly</span>
        randomSeq <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>seqSet<span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>matrix<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

            <span class="token keyword">if</span> matrix<span class="token punctuation">[</span>randomSeq<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">and</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> randomSeq
                count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> count <span class="token operator">==</span> matrix<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>

        seqSet<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>randomSeq<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># return a list</span>
    <span class="token keyword">return</span> result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817154517345.png" alt=""></p>
<h3 id="构造LSH函数族"><a href="#构造LSH函数族" class="headerlink" title="构造LSH函数族"></a>构造LSH函数族</h3><p>为了能实现前面LSH定义中的2个条件的要求，我们通过多次置换，求取向量，构建了一组hash函数。也就是最终得到了一个signature matrix. 为了控制相似度与映射概率之间的关系，我们需要按下面的操作进行，一共三步。</p>
<p>(1) 将signature matrix水平分割成一些区块（记为band），每个band包含了signature matrix中的r行。需要注意的是，同一列的每个band都是属于同一个文档的。如下图所示。<br><img src="/images/loading.gif" data-original="../images/algorithm/20161103222613743.jpeg" alt=""></p>
<p>(2) 对每个band计算hash值，这里的hash算法没有特殊要求，MD5，SHA1等等均可。一般情况下，我们需要将这些hash值做处理，使之成为事先设定好的hash桶的tag，然后把这些band“扔”进hash桶中。如下图所示。但是这里，我们只是关注算法原理，不考虑实际操作的效率问题。所以，省略处理hash值得这一项，得到每个band的hash值就OK了，这个hash值也就作为每个hash bucket的tag。<br><img src="/images/loading.gif" data-original="../images/algorithm/20161103222721131.jpeg" alt=""></p>
<p>(3) 如果某两个文档的，同一水平方向上的band，映射成了同一hash值（如果你选的hash函数比较安全，抗碰撞性好，那这基本说明这两个band是一样的），我们就将这两个文档映射到同一个hash bucket中，也就是认为这两个文档是足够相近的。</p>
<p>好了，既然执行的是上面三步的操作，那不难计算出两个文档被映射到同一个hash bucket中的概率：<br><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817154659901.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817154728452.png" alt=""></p>
<p>不难看出，这样的设计通过调节参数值，达到了“越相似，越容易在一个哈希桶；越不相似，越不容易在一个哈希桶”的效果。这也就能实现我们上边说的LSH的两个性质。</p>
<p>画出了在r=5,b=20参数环境下的概率图:</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/20161104144141255.jpeg" alt=""></p>
<p>当相似度高于某个值的时候，概率会变得非常大，并且快速靠近1，而当相似度低于某个值的时候，概率会变得非常小，并且快速靠近0.</p>
<p>另外， 需要注意的是，每一层的band只能和同一层的band相比，若hash值相同，则放入同一个哈希桶中。</p>
<p><strong>代码实现</strong>：<a href="https://github.com/guoziqingbupt/Locality-sensitive-hashing/blob/master/min_hash.py" target="_blank" rel="noopener">MinHash</a></p>
<h2 id="P-stable-Hash"><a href="#P-stable-Hash" class="headerlink" title="P-stable Hash"></a>P-stable Hash</h2><p>最开始的时候，我们已经说过，不同的相似度判别方法，对应着不同的LSH，那对于最常见的Lp范数下的欧几里得空间，应该用怎样的LSH呢？这就要介绍P-stable hash了。</p>
<h3 id="P-stable-distribution"><a href="#P-stable-distribution" class="headerlink" title="P-stable distribution"></a>P-stable distribution</h3><p>在了解P-stable hash之前，先了解一下p稳定分布的概念。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817161248356.png" alt=""></p>
<h3 id="P-stable-分布构造LSH函数族"><a href="#P-stable-分布构造LSH函数族" class="headerlink" title="P-stable 分布构造LSH函数族"></a>P-stable 分布构造LSH函数族</h3><p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817161517158.png" alt=""></p>
<p>hash函数族：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817162649458.png" alt=""></p>
<p>当r的值取定的时候，这个公式可以看做是一个仅与c的取值相关的函数。c越大，函数值越小（碰撞的概率越低）；c越小，函数值越大（碰撞的概率越高）。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817172248244.png" alt=""></p>
<p>选取合适的r值，能够使得<img src="/images/loading.gif" data-original="../images/algorithm/image-20210817172450760.png" alt="">尽可能地小。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817172611679.png" alt=""></p>
<h3 id="P-stable-分布LSH相似性搜索算法"><a href="#P-stable-分布LSH相似性搜索算法" class="headerlink" title="P-stable 分布LSH相似性搜索算法"></a>P-stable 分布LSH相似性搜索算法</h3><p>上面完成了对p-stable 分布LSH函数族构造。那么接下来的问题是怎样具体实现hash table的构造以及查询最近邻。<br>我们构建hash table的过程就是要用这个函数族的每一个函数对每一个向量执行hash运算。为了减少漏报率False Negative（就是本来很相近的两条数据被认为是不相似的），一种解决方案是用多个hash函数对向量执行hash运算。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817173023733.png" alt=""></p>
<p>但是，现在有一个问题，那就是上面这种做法的结果，确实减少了漏报率，但与此同时，也增加了误报率（本来不很相近的两条数据被认为是相近的）。所以，需要在上面方法的基础上，再增加一个措施。我们从LSH函数族中，随机选取L组这样的函数组，每个函数组都由k个随机选取的函数构成，当然L个函数组之间不一定是一样的。现在这L组函数分别对数据处理，只要有一组完全相等，就认为两条数据是相近的。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817173150498.png" alt=""></p>
<p>通过这两个新建的函数，我们可以将hash table的构建步骤作以下详细说明：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817173256143.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/20161108160157589.jpeg" alt=""></p>
<p><strong>代码实现：</strong><a href="https://github.com/guoziqingbupt/Locality-sensitive-hashing/blob/master/e2LSH.py" target="_blank" rel="noopener">E2LSH</a></p>
<h2 id="E2LSH"><a href="#E2LSH" class="headerlink" title="E2LSH"></a>E2LSH</h2><p>欧氏局部敏感哈希(E2LSH，Exact Euclidean locality sensitive Hashing)是 P-stable LSH在欧氏空间的一种随机化实现方法，其基本原理是：利用基于p-稳定分布的位置敏感函数对高维数据进行降维映射，使原始空间中距离很近的两个点经映射操作后依然很近。</p>
<h3 id="一组哈希函数的情况"><a href="#一组哈希函数的情况" class="headerlink" title="一组哈希函数的情况"></a>一组哈希函数的情况</h3><p>为拉大距离近的点与距离远的点经映射后碰撞概率之间的差距，E2LSH 常将 k 个 p-stable LSH 哈希函数联合使用。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174305047.png" alt=""></p>
<p>对每个形式为 k 元组的桶标号 a，使用如下两个哈希函数 H1 和 H2 计算得到两个值：</p>
<ul>
<li>其中 H1 的值是数组中的位置，数组的大小也就相当于是哈希表的大小。</li>
<li>其中 H2 的值作为 k 元组的代表，链接到对应 H1 数组位置的链表中。</li>
</ul>
<p>H1 和H2 的具体形式如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174441077.png" alt=""></p>
<p>索引构建过程：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174508160.png" alt=""></p>
<p>查询过程如下：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174527463.png" alt=""></p>
<h3 id="多组哈希函数的情况"><a href="#多组哈希函数的情况" class="headerlink" title="多组哈希函数的情况"></a>多组哈希函数的情况</h3><p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174608797.png" alt=""></p>
<p><img src="/images/loading.gif" data-original="https://img-blog.csdnimg.cn/20201013120513501.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTgzNDUw,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<p>在构建索引时，对数据集中的每个数据点 v，计算其 L个哈希函数的值，并将其存在 L个哈希表对应的哈希桶内。</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817174823144.png" alt=""></p>
<h2 id="SimHash"><a href="#SimHash" class="headerlink" title="SimHash"></a>SimHash</h2><p>simhash是google于2007年发布的一篇论文《<a href="https://storage.googleapis.com/pub-tools-public-publication-data/pdf/33026.pdf" target="_blank" rel="noopener">Detecting Near-duplicates for web crawling</a>》中提出的算法，初衷是用于解决亿万级别的网页去重任务，simhash通常用于长文本，通过降维处理，将长文本压缩至几个关键词来代表一篇文章，然后再将这些关键词编码成一个固定长度的二进制字符串（一般为32位或是64位），这样即用一个固定长度的编码来表示一整篇文章，我们想要对比多篇文章，只需要对比这些固定长度的编码就可以了。</p>
<p>simhash作为locality sensitive hash（局部敏感哈希）的一种：</p>
<ul>
<li>其主要思想是降维，将高维的特征向量映射成低维的特征向量，通过两个向量的Hamming Distance来确定文章是否重复或者高度近似。<ul>
<li>其中，Hamming Distance，又称汉明距离，在信息论中，两个等长字符串之间的汉明距离是两个字符串对应位置的不同字符的个数。也就是说，它就是将一个字符串变换成另外一个字符串所需要替换的字符个数。例如：1011101 与 1001001 之间的汉明距离是 2。至于我们常说的字符串编辑距离则是一般形式的汉明距离。</li>
</ul>
</li>
</ul>
<p>如此，通过比较多个文档的simHash值的海明距离，可以获取它们的相似度。</p>
<h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><p><img src="/images/loading.gif" data-original="../images/algorithm/20161114000908955.jpeg" alt=""></p>
<p>simhash算法分为5个步骤：分词、hash、加权、合并、降维，具体过程如下所述：</p>
<ul>
<li><p>分词</p>
<ul>
<li>给定一段语句，进行分词，得到有效的特征向量，然后为每一个特征向量设置1-5等5个级别的权重（如果是给定一个文本，那么特征向量可以是文本中的词，其权重可以是这个词出现的次数）。例如给定一段语句：“CSDN博客结构之法算法之道的作者July”，分词后为：“CSDN 博客 结构 之 法 算法 之 道 的 作者 July”，然后为每个特征向量赋予权值：CSDN(4) 博客(5) 结构(3) 之(1) 法(2) 算法(3) 之(1) 道(2) 的(1) 作者(5) July(5)，其中括号里的数字代表这个单词在整条语句中的重要程度，数字越大代表越重要。</li>
</ul>
</li>
<li><p>hash</p>
<ul>
<li>通过hash函数计算各个特征向量的hash值，hash值为二进制数01组成的n-bit签名。比如“CSDN”的hash值Hash(CSDN)为100101，“博客”的hash值Hash(博客)为“101011”。就这样，字符串就变成了一系列数字。Hash的具体算法可以是<a href="https://zh.wikipedia.org/wiki/MD5" target="_blank" rel="noopener">MD5</a>，<a href="https://zh.wikipedia.org/zh-cn/SHA-1" target="_blank" rel="noopener">SHA-1</a>等。</li>
</ul>
</li>
<li><p>加权</p>
<ul>
<li><p>在hash值的基础上，给所有特征向量进行加权，即W = Hash weight，且遇到1则hash值和权值正相乘，遇到0则hash值和权值负相乘。例如给“CSDN”的hash值“100101”加权得到：W(CSDN) = 1001014 = 4 -4 -4 4 -4 4，给“博客”的hash值“101011”加权得到：W(博客)=101011*5 = 5 -5 5 -5 5 5，其余特征向量类似此般操作。权值的来源采用tf-idf：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817193839137.png" alt=""></p>
</li>
</ul>
</li>
<li><p>合并</p>
<ul>
<li>将上述各个特征向量的加权结果累加，变成只有一个序列串。拿前两个特征向量举例，例如“CSDN”的“4 -4 -4 4 -4 4”和“博客”的“5 -5 5 -5 5 5”进行累加，得到“4+5 -4+-5 -4+5 4+-5 -4+5 4+5”，得到“9 -9 1 -1 1”。</li>
</ul>
</li>
<li><p>降维</p>
<ul>
<li>对于n-bit签名的累加结果，如果大于0则置1，否则置0，从而得到该语句的simhash值，最后我们便可以根据不同语句simhash的海明距离来判断它们的相似度。例如把上面计算出来的“9 -9 1 -1 1 9”降维（某位大于0记为1，小于0记为0），得到的01串为：“1 0 1 0 1 1”，从而形成它们的simhash签名。</li>
</ul>
</li>
</ul>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ul>
<li>每篇文档得到SimHash签名值后，接着计算两个签名的海明距离即可。根据经验值，对64位的 SimHash值，海明距离在3以内的可认为相似度比较高。<ul>
<li>海明距离的求法：异或时，只有在两个比较的位不同时其结果是1 ，否则结果为0，两个二进制“异或”后得到1的个数即为海明距离的大小。</li>
</ul>
</li>
</ul>
<p>举个例子，上面我们计算到的“CSDN博客”的simhash签名值为“1 0 1 0 1 1”，假定我们计算出另外一个短语的签名值为“1 0 1 0 0 0”，那么根据异或规则，我们可以计算出这两个签名的海明距离为2，从而判定这两个短语的相似度是比较高的。</p>
<p>换言之，现在问题转换为：对于64位的SimHash值，我们只要找到海明距离在<strong>3以内</strong>的所有签名，即可找出所有相似的短语。</p>
<p>但关键是，如何将其扩展到海量数据呢？譬如如何在海量的样本库中查询与其海明距离在3以内的记录呢？</p>
<ul>
<li>一种方案是查找待查询文本的64位simhash code的所有3位以内变化的组合<ul>
<li>大约需要四万多次的查询。</li>
</ul>
</li>
<li>另一种方案是预生成库中所有样本simhash code的3位变化以内的组合<ul>
<li>大约需要占据4万多倍的原始空间。</li>
</ul>
</li>
</ul>
<p>这两种方案，要么时间复杂度高，要么空间复杂度复杂，能否有一种方案可以达到时空复杂度的绝佳平衡呢？答案是肯定的：</p>
<ul>
<li>我们可以把 64 位的二进制simhash签名均分成4块，每块16位。根据鸽巢原理（也称抽屉原理），如果两个签名的海明距离在 3 以内，它们必有一块完全相同。如下图所示： <img src="/images/loading.gif" data-original="../images/algorithm/689719df-54b7-318c-bc90-e289f84344b9.jpg" alt=""></li>
<li>然后把分成的4 块中的每一个块分别作为前16位来进行查找，建倒排索引。</li>
</ul>
<p>具体如下图所示：</p>
<p><img src="/images/loading.gif" data-original="../images/algorithm/b72b8dc2-9139-3078-ad24-b689f64fd71a.jpg" alt=""></p>
<p>如此，如果样本库中存有2^34（差不多10亿）的simhash签名，则每个table返回2^(34-16)=262144个候选结果，大大减少了海明距离的计算成本。</p>
<ul>
<li>假设数据是均匀分布，16位的数据，产生的像限为2^16个，则平均每个像限分布的文档数则为2^34/2^16 = 2^(34-16)) ，四个块返回的总结果数为 4* 262144 （大概 100 万）。<ul>
<li>这样，原本需要比较10亿次，经过索引后，大概只需要处理100万次。</li>
</ul>
</li>
</ul>
<p><strong>代码实现1：</strong> <a href="https://github.com/1e0ng/simhash" target="_blank" rel="noopener">SimHash</a></p>
<p><strong>代码实现2：</strong> <a href="https://github.com/seomoz/simhash-py" target="_blank" rel="noopener">SimHash_py</a></p>
<h2 id="LSH-with-Cosine-Distance"><a href="#LSH-with-Cosine-Distance" class="headerlink" title="LSH with Cosine Distance"></a>LSH with Cosine Distance</h2><h3 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h3><p>Here is the code for LSH based on <strong>cosine distance</strong>:</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> division
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math

<span class="token keyword">def</span> <span class="token function">signature_bit</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> planes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    LSH signature generation using random projection
    Returns the signature bits for two data points.
    The signature bits of the two points are different
     only for the plane that divides the two points.
     """</span>
    sig <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> planes<span class="token punctuation">:</span>
        sig <span class="token operator">&lt;&lt;</span><span class="token operator">=</span>  <span class="token number">1</span>        
        <span class="token keyword">if</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            sig <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> sig

<span class="token keyword">def</span> <span class="token function">bitcount</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    gets the number of bits set to 1
    """</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> n<span class="token punctuation">:</span>
        count <span class="token operator">+=</span> <span class="token number">1</span>
        n <span class="token operator">=</span> n <span class="token operator">&amp;</span> <span class="token punctuation">(</span>n<span class="token number">-1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> count

<span class="token keyword">def</span> <span class="token function">length</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""returns the length of a vector"""</span>
      <span class="token keyword">return</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>v<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    dim <span class="token operator">=</span> <span class="token number">20</span>       <span class="token comment" spellcheck="true"># dimension of data points (# of features)</span>
    bits <span class="token operator">=</span> <span class="token number">1024</span>    <span class="token comment" spellcheck="true"># number of bits (planes) per signature</span>
    run <span class="token operator">=</span> <span class="token number">10</span>       <span class="token comment" spellcheck="true"># number of runs</span>
    avg <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> r <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Generate two data points p1, p2</span>
        pt1 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>dim<span class="token punctuation">)</span>
        pt2 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>dim<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># reference planes as many as bits (= signature bits)</span>
        ref_planes <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>bits<span class="token punctuation">,</span> dim<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># signature bits for two data points</span>
        sig1 <span class="token operator">=</span> signature_bit<span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> ref_planes<span class="token punctuation">)</span>
        sig2 <span class="token operator">=</span> signature_bit<span class="token punctuation">(</span>pt2<span class="token punctuation">,</span> ref_planes<span class="token punctuation">)</span>

         <span class="token comment" spellcheck="true"># Calculates exact angle difference</span>
        cosine <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>pt1<span class="token punctuation">,</span>pt2<span class="token punctuation">)</span><span class="token operator">/</span>length<span class="token punctuation">(</span>pt1<span class="token punctuation">)</span><span class="token operator">/</span>length<span class="token punctuation">(</span>pt2<span class="token punctuation">)</span>
        exact <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>acos<span class="token punctuation">(</span>cosine<span class="token punctuation">)</span><span class="token operator">/</span>math<span class="token punctuation">.</span>pi

        <span class="token comment" spellcheck="true"># Calculates angle difference using LSH based on cosine distance</span>
        <span class="token comment" spellcheck="true"># It's using signature bits' count</span>
        cosine_hash <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> bitcount<span class="token punctuation">(</span>sig1<span class="token operator">^</span>sig2<span class="token punctuation">)</span><span class="token operator">/</span>bits

        <span class="token comment" spellcheck="true"># Difference between exact and LSH</span>
        diff <span class="token operator">=</span> abs<span class="token punctuation">(</span>cosine_hash<span class="token operator">-</span>exact<span class="token punctuation">)</span><span class="token operator">/</span>exact
        avg <span class="token operator">+=</span> diff
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'exact %.3f, hash %.3f, diff %.3f'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">(</span>exact<span class="token punctuation">,</span> cosine_hash<span class="token punctuation">,</span> diff<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'avg diff = %.3f'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">(</span>avg<span class="token operator">/</span>run<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Output:</p>
<pre><code>exact 0.477, hash 0.447, diff 0.062
exact 0.439, hash 0.454, diff 0.035
exact 0.433, hash 0.467, diff 0.077
exact 0.503, hash 0.522, diff 0.040
exact 0.583, hash 0.613, diff 0.052
exact 0.490, hash 0.494, diff 0.009
exact 0.563, hash 0.570, diff 0.014
exact 0.482, hash 0.479, diff 0.006
exact 0.506, hash 0.521, diff 0.029
exact 0.485, hash 0.479, diff 0.010
avg diff = 0.033</code></pre><p>The code has two important parameters:</p>
<ol>
<li><p>dim - This is the dimension of data points which are the features. These are generated using NumPy’s random function:</p>
<pre class="line-numbers language-python"><code class="language-python">pt1 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>dim<span class="token punctuation">)</span>
pt2 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>dim<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>We created two points to test the similarity.</p>
</li>
<li><p>bits - This is the number of bits (planes) per signature. The reference planes are generated as many as bits.</p>
<pre class="line-numbers language-python"><code class="language-python">ref_planes <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>bits<span class="token punctuation">,</span> dim<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>These bits are used as signature bits for the points we are interested in their similarity. These signature bits of the two points are different only for the plane that divides the two points. as we can see from the function signature_bit():</p>
<pre class="line-numbers language-python"><code class="language-python">sig <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> p <span class="token keyword">in</span> planes<span class="token punctuation">:</span>
    sig <span class="token operator">&lt;&lt;</span><span class="token operator">=</span>  <span class="token number">1</span>        
    <span class="token keyword">if</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    sig <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">return</span> sig<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<p>We run the code several times to get averaged difference, and it’s because for each we’re testing with different points and different features.</p>
<h2 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h2><p><img src="/images/loading.gif" data-original="../images/algorithm/image-20210817211359112.png" alt=""></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io" rel="external nofollow noreferrer">杰克成</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jackhcc.github.io/posts/lsh.html">https://jackhcc.github.io/posts/lsh.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/LSH/">
                                    <span class="chip bg-color">LSH</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/aliqr.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/reward/wxqr.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '3821a0bbb773038a51fc',
        clientSecret: '4b30b507d67ec5497ec0e77f43f80cb3e0d7dd3a',
        repo: 'JackHCC.github.io',
        owner: 'JackHCC',
        admin: "JackHCC",
        id: '2021-08-17T14-53-24',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/blog-python14.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/9.jpg" class="responsive-img" alt="Python-Redis详解">
                        
                        <span class="card-title">Python-Redis详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Python Redis使用详解
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redis/">
                        <span class="chip bg-color">Redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/bert.html">
                    <div class="card-image">
                        
                        
                        <img src="/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/medias/featureimages/2.jpg" class="responsive-img" alt="Bert详解">
                        
                        <span class="card-title">Bert详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Bert学习记录
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-08-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Deep-Learning/" class="post-category">
                                    Deep Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/NLP/">
                        <span class="chip bg-color">NLP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://jackhcc.github.io" target="_blank">杰克成</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">3591.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "2";
                    var startDate = "27";
                    var startHour = "6";
                    var startMinute = "30";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JackHCC" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jackcc0701@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=100046343443643" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=100046343443643" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/JackChe66021834" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/JackChe66021834" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2508074836" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2508074836" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/6885584679" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/6885584679" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/8f8482f01f0d6a04e844efe32e0f0710" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/js/matery.js"></script>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>'); }
    </script>

    <!-- weather -->
	<script type="text/javascript">
	WIDGET = {FID: 'TToslpmkVO'}
	</script>
	<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

    
    
    <script async src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/kqhlkxviiccyoa0czpfpu4ijuey9hfre.js"></script>
        <script> 
            $(document).ready(function () {
                setInterval(change_Tidio, 50);  
                function change_Tidio() { 
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";   
                        document.getElementById("tidio-chat-iframe").style.right="-15px";   
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    } 
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                        document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                } 
            }); 
        </script>
    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://cdn.jsdelivr.net/gh/JackHCC/JackHCC.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        $('a').each(function() {
          const $this = $(this);
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'your_domain' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script><script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>

</html>

